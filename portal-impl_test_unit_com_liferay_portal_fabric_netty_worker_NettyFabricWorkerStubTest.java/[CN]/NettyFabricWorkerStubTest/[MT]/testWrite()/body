{
  EmbeddedChannel embeddedChannel=new EmbeddedChannel(NettyRPCChannelHandler.INSTANCE);
  NettyFabricWorkerStub<String> nettyFabricWorkerStub=new NettyFabricWorkerStub<String>(0,embeddedChannel,new MockRepository<Channel>(),Collections.<Path,Path>emptyMap(),0);
  NettyChannelAttributes.putFabricWorker(embeddedChannel,0,new LocalFabricWorker<String>(new EmbeddedProcessChannel<String>(new DefaultNoticeableFuture<String>())));
  String result="Test result";
  NoticeableFuture<String> noticeableFuture=nettyFabricWorkerStub.write(new ReturnProcessCallable<String>(result));
  embeddedChannel.writeInbound(embeddedChannel.readOutbound());
  embeddedChannel.writeInbound(embeddedChannel.readOutbound());
  Assert.assertEquals(result,noticeableFuture.get());
}
