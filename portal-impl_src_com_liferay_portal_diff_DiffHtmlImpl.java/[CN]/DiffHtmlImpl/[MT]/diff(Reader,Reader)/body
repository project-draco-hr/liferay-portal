{
  if (source == null) {
    throw new NullPointerException("Source is null");
  }
  if (target == null) {
    throw new NullPointerException("Target is null");
  }
  InputSource oldSource=new InputSource(source);
  InputSource newSource=new InputSource(target);
  UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
  SAXTransformerFactory saxTransformerFactory=(SAXTransformerFactory)TransformerFactory.newInstance();
  TransformerHandler tranformHandler=saxTransformerFactory.newTransformerHandler();
  tranformHandler.setResult(new StreamResult(unsyncStringWriter));
  XslFilter xslFilter=new XslFilter();
  ContentHandler contentHandler=xslFilter.xsl(tranformHandler,"com/liferay/portal/util/dependencies/diff_html.xsl");
  HtmlCleaner htmlCleaner=new HtmlCleaner();
  DomTreeBuilder oldDomTreeBuilder=new DomTreeBuilder();
  htmlCleaner.cleanAndParse(oldSource,oldDomTreeBuilder);
  Locale locale=LocaleUtil.getDefault();
  TextNodeComparator leftTextNodeComparator=new TextNodeComparator(oldDomTreeBuilder,locale);
  DomTreeBuilder newDomTreeBuilder=new DomTreeBuilder();
  htmlCleaner.cleanAndParse(newSource,newDomTreeBuilder);
  TextNodeComparator rightTextNodeComparator=new TextNodeComparator(newDomTreeBuilder,locale);
  contentHandler.startDocument();
  contentHandler.startElement(StringPool.BLANK,_DIFF_REPORT,_DIFF_REPORT,new AttributesImpl());
  contentHandler.startElement(StringPool.BLANK,_DIFF,_DIFF,new AttributesImpl());
  HtmlSaxDiffOutput htmlSaxDiffOutput=new HtmlSaxDiffOutput(contentHandler,_DIFF);
  HTMLDiffer htmlDiffer=new HTMLDiffer(htmlSaxDiffOutput);
  htmlDiffer.diff(leftTextNodeComparator,rightTextNodeComparator);
  contentHandler.endElement(StringPool.BLANK,_DIFF,_DIFF);
  contentHandler.endElement(StringPool.BLANK,_DIFF_REPORT,_DIFF_REPORT);
  contentHandler.endDocument();
  unsyncStringWriter.flush();
  String string=unsyncStringWriter.toString();
  if (string.startsWith("<?xml")) {
    int index=string.indexOf("?>");
    string=string.substring(index + 2);
  }
  return string;
}
