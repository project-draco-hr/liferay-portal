{
  try {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    long questionId=ParamUtil.getLong(request,"questionId");
    String chartType=ParamUtil.getString(request,"chartType","pie");
    CategoryDataset dataset=PollsUtil.getVotesDataset(questionId);
    String chartName=themeDisplay.translate("vote-results");
    String xName=themeDisplay.translate("choice");
    String yName=themeDisplay.translate("votes");
    JFreeChart chart=null;
    if (chartType.equals("area")) {
      chart=ChartFactory.createAreaChart(chartName,xName,yName,dataset,PlotOrientation.VERTICAL,true,false,false);
    }
 else     if (chartType.equals("horizontal_bar")) {
      chart=ChartFactory.createBarChart(chartName,xName,yName,dataset,PlotOrientation.HORIZONTAL,true,false,false);
    }
 else     if (chartType.equals("line")) {
      chart=ChartFactory.createLineChart(chartName,xName,yName,dataset,PlotOrientation.VERTICAL,true,false,false);
    }
 else     if (chartType.equals("vertical_bar")) {
      chart=ChartFactory.createBarChart(chartName,xName,yName,dataset,PlotOrientation.VERTICAL,true,false,false);
    }
 else {
      PieDataset pieData=DatasetUtilities.createPieDatasetForRow(dataset,0);
      chart=ChartFactory.createPieChart(chartName,pieData,true,false,false);
    }
    response.setContentType(ContentTypes.IMAGE_JPEG);
    OutputStream os=response.getOutputStream();
    ChartUtilities.writeChartAsJPEG(os,chart,400,400);
    return null;
  }
 catch (  Exception e) {
    PortalUtil.sendError(e,request,response);
    return null;
  }
}
