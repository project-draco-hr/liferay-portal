{
  try {
    String virtusertable=PropsUtil.get(PropsKeys.MAIL_HOOK_SENDMAIL_VIRTUSERTABLE);
    FileReader fr=new FileReader(virtusertable);
    UnsyncBufferedReader br=new UnsyncBufferedReader(fr);
    StringBuilder sb=new StringBuilder();
    for (String s=br.readLine(); s != null; s=br.readLine()) {
      if (!s.endsWith(" " + userId)) {
        sb.append(s);
        sb.append('\n');
      }
    }
    if ((emailAddress != null) && (!emailAddress.equals(""))) {
      sb.append(emailAddress);
      sb.append(" ");
      sb.append(userId);
      sb.append('\n');
    }
    br.close();
    fr.close();
    FileUtil.write(virtusertable,sb.toString());
    String virtusertableRefreshCmd=PropsUtil.get(PropsKeys.MAIL_HOOK_SENDMAIL_VIRTUSERTABLE_REFRESH);
    Runtime rt=Runtime.getRuntime();
    Process p=rt.exec(virtusertableRefreshCmd);
    ProcessUtil.close(p);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
