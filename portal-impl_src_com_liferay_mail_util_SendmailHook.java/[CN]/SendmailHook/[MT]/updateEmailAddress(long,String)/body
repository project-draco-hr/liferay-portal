{
  try {
    String virtusertable=PropsUtil.get(PropsUtil.MAIL_HOOK_SENDMAIL_VIRTUSERTABLE);
    FileReader fr=new FileReader(virtusertable);
    BufferedReader br=new BufferedReader(fr);
    StringMaker sm=new StringMaker();
    for (String s=br.readLine(); s != null; s=br.readLine()) {
      if (!s.endsWith(" " + userId)) {
        sm.append(s);
        sm.append('\n');
      }
    }
    if ((emailAddress != null) && (!emailAddress.equals(""))) {
      sm.append(emailAddress);
      sm.append(" ");
      sm.append(userId);
      sm.append('\n');
    }
    br.close();
    fr.close();
    FileUtil.write(virtusertable,sm.toString());
    String virtusertableRefreshCmd=PropsUtil.get(PropsUtil.MAIL_HOOK_SENDMAIL_VIRTUSERTABLE_REFRESH);
    Runtime rt=Runtime.getRuntime();
    Process p=rt.exec(virtusertableRefreshCmd);
    ProcessUtil.close(p);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
