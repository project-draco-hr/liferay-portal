{
  if ((_mBeanRegistry == null) || (_messageBus == null)) {
    throw new IllegalStateException("MBean server and message bus are not configured");
  }
  try {
    _mBeanRegistry.replace(_MESSAGE_BUS_MANAGER_OBJECT_NAME_CACHE_KEY,new MessageBusManager(_messageBus),MessageBusManager.createObjectName());
  }
 catch (  Exception e) {
    if (log.isWarnEnabled()) {
      log.warn("Unable to register message bus manager",e);
    }
  }
  Collection<Destination> destinations=_messageBus.getDestinations();
  for (  Destination destination : destinations) {
    try {
      registerDestination(destination);
    }
 catch (    Exception e) {
      if (log.isWarnEnabled()) {
        log.warn("Unable to register destination " + destination.getName(),e);
      }
    }
  }
}
