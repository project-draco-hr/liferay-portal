{
  final File bundle=bundleConfiguration.getSingleFile();
  final String bundleName=bundle.getName();
  AbstractArchiveTask archiveTask;
  if (bundleName.endsWith(".tar.gz")) {
    archiveTask=GradleUtil.addTask(project,DIST_BUNDLE_TASK_NAME,Tar.class);
  }
 else {
    archiveTask=GradleUtil.addTask(project,DIST_BUNDLE_TASK_NAME,Zip.class);
  }
  archiveTask.from(new Callable<FileTree>(){
    @Override public FileTree call() throws Exception {
      if (bundleName.endsWith(".tar.gz")) {
        return project.tarTree(bundleConfiguration.getSingleFile());
      }
 else {
        return project.zipTree(bundleConfiguration.getSingleFile());
      }
    }
  }
,new Closure<Void>(null){
    @SuppressWarnings("unused") public void doCall(    CopySpec copySpec){
      copySpec.eachFile(new StripPathSegmentsAction(1));
    }
  }
);
  archiveTask.setArchiveName(project.getName() + "-" + bundleName);
  archiveTask.setDescription("Assembles the bundle and zips it up.");
  archiveTask.setDestinationDir(project.getBuildDir());
  archiveTask.setIncludeEmptyDirs(false);
  return archiveTask;
}
