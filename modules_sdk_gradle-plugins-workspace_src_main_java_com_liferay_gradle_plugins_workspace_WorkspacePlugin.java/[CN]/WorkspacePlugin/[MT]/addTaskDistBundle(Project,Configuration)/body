{
  Zip zip=GradleUtil.addTask(project,DIST_BUNDLE_TASK_NAME,Zip.class);
  final File bundle=bundleConfiguration.getSingleFile();
  zip.from(new Callable<FileTree>(){
    @Override public FileTree call() throws Exception {
      String bundleName=bundle.getName();
      if (bundleName.endsWith(".tar.gz")) {
        return project.tarTree(bundleConfiguration.getSingleFile());
      }
 else {
        return project.zipTree(bundleConfiguration.getSingleFile());
      }
    }
  }
,new Closure<Void>(null){
    @SuppressWarnings("unused") public void doCall(    CopySpec copySpec){
      copySpec.eachFile(new StripPathSegmentsAction(1));
    }
  }
);
  zip.setArchiveName("bundle.zip");
  zip.setDescription("Assembles the bundle and zips it up.");
  zip.setDestinationDir(project.getBuildDir());
  zip.setIncludeEmptyDirs(false);
  return zip;
}
