{
  T task=GradleUtil.addTask(project,taskName,clazz);
  task.from(new Callable<FileTree>(){
    @Override public FileTree call() throws Exception {
      File file=bundleConfiguration.getSingleFile();
      String fileName=file.getName();
      if (fileName.endsWith(".tar.gz")) {
        return project.tarTree(file);
      }
 else {
        return project.zipTree(file);
      }
    }
  }
,new Closure<Void>(null){
    @SuppressWarnings("unused") public void doCall(    CopySpec copySpec){
      copySpec.eachFile(new StripPathSegmentsAction(1));
    }
  }
);
  task.from(project.file("configs/common"),project.file("configs/" + workspaceExtension.getEnvironment()));
  task.setBaseName(project.getName());
  task.setDescription("Assembles the bundle and zips it up.");
  task.setDestinationDir(project.getBuildDir());
  task.setIncludeEmptyDirs(false);
  return task;
}
