{
  super.initialize(companyId);
  ClusterHealthResponse clusterHealthResponse=null;
  if (PortalRunMode.isTestMode()) {
    clusterHealthResponse=_elasticsearchConnectionManager.getClusterHealthResponse(Time.HOUR,1);
  }
 else {
    clusterHealthResponse=_elasticsearchConnectionManager.getClusterHealthResponse(30 * Time.SECOND,2);
  }
  if (clusterHealthResponse.getStatus() == ClusterHealthStatus.RED) {
    throw new IllegalStateException("Unable to initialize Elasticsearch cluster: " + clusterHealthResponse);
  }
  try {
    _indexFactory.createIndices(_elasticsearchConnectionManager.getAdminClient(),companyId);
  }
 catch (  Exception e) {
    throw new IllegalStateException(e);
  }
}
