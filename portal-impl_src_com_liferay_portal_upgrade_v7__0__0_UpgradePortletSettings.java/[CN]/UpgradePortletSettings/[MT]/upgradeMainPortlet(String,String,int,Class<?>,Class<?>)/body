{
  if (_log.isDebugEnabled()) {
    _log.debug("Upgrading main portlet " + portletId + " settings");
  }
  copyPortletSettingsAsServiceSettings(portletId,ownerType,serviceName);
  if (portletInstanceSettingsClass != null) {
    SettingsDescriptor<?> portletInstanceSettingsDescriptor=new SettingsDescriptor<>(portletInstanceSettingsClass);
    if (_log.isDebugEnabled()) {
      _log.debug("Delete portlet instance keys from service settings");
    }
    resetPortletPreferencesValues(serviceName,PortletKeys.PREFS_OWNER_TYPE_GROUP,portletInstanceSettingsDescriptor);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Delete service keys from portlet settings");
  }
  SettingsDescriptor<?> serviceSettingsDescriptor=new SettingsDescriptor<>(serviceSettingsClass);
  resetPortletPreferencesValues(portletId,ownerType,serviceSettingsDescriptor);
  resetPortletPreferencesValues(portletId,PortletKeys.PREFS_OWNER_TYPE_ARCHIVED,serviceSettingsDescriptor);
}
