{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getUpgradeOptimizedConnection();
    StringBundler sb=new StringBundler(4);
    sb.append("select portletPreferencesId, ownerId, ownerType, ");
    sb.append("plid, portletId, preferences from PortletPreferences ");
    sb.append("where ownerType = ? and portletId = ?");
    String sql=sb.toString();
    ps=con.prepareStatement(sql);
    ps.setInt(1,ownerType);
    ps.setString(2,portletId);
    rs=ps.executeQuery();
    while (rs.next()) {
      PortletPreferencesRow portletPreferencesRow=new PortletPreferencesRow();
      portletPreferencesRow.portletPreferencesId=rs.getLong("portletPreferencesId");
      portletPreferencesRow.ownerId=rs.getLong("ownerId");
      portletPreferencesRow.ownerType=rs.getInt("ownerType");
      portletPreferencesRow.plid=rs.getLong("plid");
      portletPreferencesRow.portletId=rs.getString("portletId");
      portletPreferencesRow.preferences=GetterUtil.getString(rs.getString("preferences"));
      visitor.visit(portletPreferencesRow);
    }
  }
 catch (  SQLException sqle) {
    throw sqle;
  }
catch (  Exception e) {
    throw new RuntimeException(e);
  }
 finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
