{
  if (_log.isDebugEnabled()) {
    _log.debug("Copy portlet settings as service settings");
  }
  ResultSet rs=null;
  try {
    rs=getPortletPreferencesResultSet(portletId,ownerType);
    while (rs.next()) {
      PortletPreferencesRow portletPreferencesRow=getPortletPreferencesRow(rs);
      portletPreferencesRow.setPortletPreferencesId(increment());
      portletPreferencesRow.setOwnerType(PortletKeys.PREFS_OWNER_TYPE_GROUP);
      portletPreferencesRow.setPortletId(serviceName);
      if (ownerType == PortletKeys.PREFS_OWNER_TYPE_LAYOUT) {
        long plid=portletPreferencesRow.getPlid();
        long groupId=getGroupId(plid);
        portletPreferencesRow.setOwnerId(groupId);
        portletPreferencesRow.setPlid(0);
        if (_log.isInfoEnabled()) {
          _log.info("Copying settings of portlet " + portletId + " placed in layout "+ plid+ " to service "+ serviceName+ " in group "+ groupId);
        }
      }
      addPortletPreferences(portletPreferencesRow);
    }
  }
  finally {
    DataAccess.deepCleanUp(rs);
  }
}
