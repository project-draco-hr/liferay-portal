{
  ResultSet rs=null;
  try {
    rs=getPortletPreferencesResultSet(portletId,ownerType);
    while (rs.next()) {
      PortletPreferencesRow portletPreferencesRow=getPortletPreferencesRow(rs);
      portletPreferencesRow.setPortletPreferencesId(increment());
      portletPreferencesRow.setOwnerType(PortletKeys.PREFS_OWNER_TYPE_GROUP);
      portletPreferencesRow.setPortletId(serviceName);
      if (ownerType == PortletKeys.PREFS_OWNER_TYPE_LAYOUT) {
        long plid=portletPreferencesRow.getPlid();
        long groupId=getGroupId(plid);
        portletPreferencesRow.setOwnerId(groupId);
        portletPreferencesRow.setPlid(0);
        _logCopyOfPortletInstanceSettings(portletId,plid,serviceName,groupId);
      }
      addPortletPreferences(portletPreferencesRow);
    }
  }
 catch (  SQLException sqle) {
    throw new PortalException("Unable to create service settings for portlet " + portletId,sqle);
  }
catch (  RuntimeException re) {
    throw new SystemException("Unable to create service settings for portlet " + portletId,re);
  }
 finally {
    DataAccess.deepCleanUp(rs);
  }
}
