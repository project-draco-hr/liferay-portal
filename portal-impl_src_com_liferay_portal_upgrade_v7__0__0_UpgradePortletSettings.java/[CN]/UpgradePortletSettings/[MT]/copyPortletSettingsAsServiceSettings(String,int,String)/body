{
  if (_log.isDebugEnabled()) {
    _log.debug("Copy portlet settings as service settings");
  }
  ResultSet rs=null;
  try {
    rs=getPortletPreferencesResultSet(portletId,ownerType);
    while (rs.next()) {
      PortletPreferencesRow portletPreferencesRow=getPortletPreferencesRow(rs);
      portletPreferencesRow.setPortletPreferencesId(increment());
      portletPreferencesRow.setOwnerType(PortletKeys.PREFS_OWNER_TYPE_GROUP);
      portletPreferencesRow.setPortletId(serviceName);
      if (ownerType == PortletKeys.PREFS_OWNER_TYPE_LAYOUT) {
        long plid=portletPreferencesRow.getPlid();
        long groupId=getGroupId(plid);
        portletPreferencesRow.setOwnerId(groupId);
        portletPreferencesRow.setPlid(0);
        if (_log.isInfoEnabled()) {
          StringBundler sb=new StringBundler(7);
          sb.append("Copying portlet ");
          sb.append(portletId);
          sb.append(" settings from layout ");
          sb.append(plid);
          sb.append(" to service ");
          sb.append(serviceName);
          sb.append(" in group " + groupId);
          _log.info(sb.toString());
        }
      }
      addPortletPreferences(portletPreferencesRow);
    }
  }
  finally {
    DataAccess.deepCleanUp(rs);
  }
}
