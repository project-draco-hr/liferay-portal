{
  String name=null;
  String primKey=null;
  if (layout == null) {
    name=portletId;
    primKey=portletId;
    return permissionChecker.hasPermission(groupId,name,primKey,actionId);
  }
  Group group=layout.getGroup();
  name=PortletConstants.getRootPortletId(portletId);
  primKey=getPrimaryKey(layout.getPlid(),portletId);
  if (!group.isLayoutSetPrototype() && SitesUtil.isLayoutLocked(layout) && actionId.equals(ActionKeys.CONFIGURATION)) {
    return false;
  }
  Boolean hasPermission=StagingPermissionUtil.hasPermission(permissionChecker,group.getGroupId(),name,group.getGroupId(),name,actionId);
  if (hasPermission != null) {
    return hasPermission.booleanValue();
  }
  if ((layout.isPrivateLayout() && !PropsValues.LAYOUT_USER_PRIVATE_LAYOUTS_MODIFIABLE) || (layout.isPublicLayout() && !PropsValues.LAYOUT_USER_PUBLIC_LAYOUTS_MODIFIABLE)) {
    if (actionId.equals(ActionKeys.CONFIGURATION) && group.isUser()) {
      return false;
    }
  }
  if (actionId.equals(ActionKeys.VIEW) && group.isControlPanel()) {
    return true;
  }
  if (strict) {
    return permissionChecker.hasPermission(groupId,name,primKey,actionId);
  }
  if (LayoutPermissionUtil.contains(permissionChecker,groupId,layout.isPrivateLayout(),layout.getLayoutId(),ActionKeys.UPDATE) && hasLayoutManagerPermission(portletId,actionId)) {
    return true;
  }
  LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
  Portlet portlet=PortletLocalServiceUtil.getPortletById(layout.getCompanyId(),portletId);
  if (layoutTypePortlet.isCustomizedView() && layoutTypePortlet.isPortletCustomizable(portletId) && LayoutPermissionUtil.contains(permissionChecker,layout,ActionKeys.CUSTOMIZE)) {
    if (actionId.equals(ActionKeys.VIEW)) {
      return true;
    }
 else     if (actionId.equals(ActionKeys.CONFIGURATION) && portlet.isPreferencesUniquePerLayout()) {
      return true;
    }
  }
  return permissionChecker.hasPermission(groupId,name,primKey,actionId);
}
