{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  long companyId=themeDisplay.getCompanyId();
  String redirect=ParamUtil.getString(request,"redirect");
  if (!FacebookConnectUtil.isEnabled(companyId)) {
    return null;
  }
  String code=ParamUtil.get(request,"code",StringPool.BLANK);
  String token=getAccessToken(companyId,code,redirect);
  if (Validator.isNotNull(token)) {
    HttpSession session=request.getSession();
    session.setAttribute(WebKeys.FACEBOOK_ACCESS_TOKEN,token);
    setFacebookCredentials(session,companyId,token);
  }
  redirect=getRedirect(request,themeDisplay);
  response.sendRedirect(redirect);
  return null;
}
