{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  long companyId=themeDisplay.getCompanyId();
  String code=ParamUtil.get(request,"code",StringPool.BLANK);
  String token=getAccessToken(companyId,code);
  if (Validator.isNotNull(token)) {
    String emailAddress=getEmailAddress(companyId,token);
    if (Validator.isNotNull(emailAddress)) {
      HttpSession session=request.getSession();
      session.setAttribute(WebKeys.FACEBOOK_USER_EMAIL_ADDRESS,emailAddress);
    }
  }
  response.sendRedirect(themeDisplay.getPathContext());
  return null;
}
