{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String redirect=ParamUtil.getString(request,"redirect");
  HttpSession session=request.getSession();
  long facebookId=GetterUtil.getLong(session.getAttribute(WebKeys.FACEBOOK_INCOMPLETE_USER_ID));
  PortletURL portletURL=PortletURLFactoryUtil.create(request,PortletKeys.LOGIN,themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  portletURL.setWindowState(WindowState.MAXIMIZED);
  portletURL.setPortletMode(PortletMode.VIEW);
  portletURL.setParameter("struts_action","/login/update_account");
  portletURL.setParameter("saveLastPath",Boolean.FALSE.toString());
  portletURL.setParameter("userId",String.valueOf(user.getUserId()));
  portletURL.setParameter("emailAddress",user.getEmailAddress());
  portletURL.setParameter("facebookId",String.valueOf(facebookId));
  portletURL.setParameter("firstName",user.getFirstName());
  portletURL.setParameter("lastName",user.getLastName());
  portletURL.setParameter("redirect",redirect);
  response.sendRedirect(portletURL.toString());
}
