{
  JSONObject jsonObject=FacebookConnectUtil.getGraphResourcesAsJSON(companyId,"/me",token,"id,email,verified");
  if (Validator.isNotNull(jsonObject) && jsonObject.getBoolean("verified")) {
    String facebookId=jsonObject.getString("id");
    if (Validator.isNotNull(facebookId)) {
      session.setAttribute(WebKeys.FACEBOOK_USER_ID,facebookId);
    }
    String email=jsonObject.getString("email");
    if (Validator.isNotNull(email)) {
      try {
        UserLocalServiceUtil.getUserByEmailAddress(companyId,email);
        session.setAttribute(WebKeys.FACEBOOK_USER_EMAIL_ADDRESS,email);
      }
 catch (      NoSuchUserException nsue) {
        session.removeAttribute(WebKeys.FACEBOOK_USER_EMAIL_ADDRESS);
      }
    }
  }
}
