{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long companyId=themeDisplay.getCompanyId();
  if (!FacebookConnectUtil.isEnabled(companyId)) {
    return;
  }
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  if (cmd.equals(Constants.ADD)) {
    addUser(actionRequest,actionResponse,themeDisplay);
  }
 else {
    String facebookConnectRedirectURL=FacebookConnectUtil.getRedirectURL(companyId);
    facebookConnectRedirectURL=HttpUtil.addParameter(facebookConnectRedirectURL,"redirect",ParamUtil.getString(actionRequest,"redirect"));
    String redirect=HttpUtil.addParameter(FacebookConnectUtil.getAuthURL(companyId),"client_id",FacebookConnectUtil.getAppId(companyId));
    redirect=HttpUtil.addParameter(redirect,"redirect_uri",facebookConnectRedirectURL);
    redirect=HttpUtil.addParameter(redirect,"scope","email");
    actionResponse.sendRedirect(redirect);
  }
}
