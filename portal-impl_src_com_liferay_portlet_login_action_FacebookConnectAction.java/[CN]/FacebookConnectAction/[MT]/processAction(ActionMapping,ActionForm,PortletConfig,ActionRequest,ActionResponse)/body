{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long companyId=themeDisplay.getCompanyId();
  if (!FacebookConnectUtil.isEnabled(companyId)) {
    return;
  }
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  if (cmd.equals(Constants.ADD)) {
    addUser(actionRequest,actionResponse,themeDisplay);
  }
 else {
    String redirect=HttpUtil.addParameter(FacebookConnectUtil.getAuthURL(companyId),"client_id",FacebookConnectUtil.getAppId(companyId));
    String facebookRedirect=ParamUtil.getString(actionRequest,"redirect");
    String redirect_uri=FacebookConnectUtil.getRedirectURL(companyId);
    redirect_uri=HttpUtil.addParameter(redirect_uri,"redirect",facebookRedirect);
    redirect=HttpUtil.addParameter(redirect,"redirect_uri",redirect_uri);
    redirect=HttpUtil.addParameter(redirect,"scope","email");
    actionResponse.sendRedirect(redirect);
  }
}
