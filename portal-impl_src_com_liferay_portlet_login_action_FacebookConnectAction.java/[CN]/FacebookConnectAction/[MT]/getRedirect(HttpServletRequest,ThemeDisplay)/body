{
  HttpSession session=request.getSession();
  if (session.getAttribute(WebKeys.FACEBOOK_ACCESS_TOKEN) != null && session.getAttribute(WebKeys.FACEBOOK_USER_EMAIL_ADDRESS) != null) {
    return themeDisplay.getPathContext();
  }
 else {
    PortletURL portletURL=PortletURLFactoryUtil.create(request,PortletKeys.LOGIN,themeDisplay.getLayout().getPlid(),PortletRequest.RENDER_PHASE);
    portletURL.setWindowState(WindowState.MAXIMIZED);
    portletURL.setPortletMode(PortletMode.VIEW);
    portletURL.setParameter("struts_action","/login/facebook_connect_add_user");
    return portletURL.toString();
  }
}
