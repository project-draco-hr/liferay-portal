{
  HttpSession session=request.getSession();
  String redirect=ParamUtil.getString(request,"redirect",themeDisplay.getPathContext());
  if ((session.getAttribute(WebKeys.FACEBOOK_ACCESS_TOKEN) != null) && (session.getAttribute(WebKeys.FACEBOOK_USER_EMAIL_ADDRESS) != null)) {
    return redirect;
  }
 else {
    PortletURL portletURL=PortletURLFactoryUtil.create(request,PortletKeys.LOGIN,themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
    portletURL.setWindowState(WindowState.MAXIMIZED);
    portletURL.setPortletMode(PortletMode.VIEW);
    portletURL.setParameter("struts_action","/login/facebook_connect_add_user");
    portletURL.setParameter("redirect",redirect);
    return portletURL.toString();
  }
}
