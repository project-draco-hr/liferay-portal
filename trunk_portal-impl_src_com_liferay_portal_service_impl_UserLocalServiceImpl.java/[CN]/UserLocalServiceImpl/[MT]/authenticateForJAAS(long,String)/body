{
  if (PropsValues.AUTH_LOGIN_DISABLED) {
    return false;
  }
  try {
    User user=userPersistence.findByPrimaryKey(userId);
    if (user.isDefaultUser()) {
      if (_log.isInfoEnabled()) {
        _log.info("JAAS authentication is disabled for the default user");
      }
      return false;
    }
 else     if (!user.isActive()) {
      if (_log.isInfoEnabled()) {
        _log.info("JAAS authentication is disabled for inactive user " + userId);
      }
      return false;
    }
    String password=user.getPassword();
    if (user.isPasswordEncrypted()) {
      if (password.equals(encPassword)) {
        return true;
      }
      if (!PropsValues.PORTAL_JAAS_STRICT_PASSWORD) {
        encPassword=PwdEncryptor.encrypt(encPassword,password);
        if (password.equals(encPassword)) {
          return true;
        }
      }
    }
 else {
      if (!PropsValues.PORTAL_JAAS_STRICT_PASSWORD) {
        if (password.equals(encPassword)) {
          return true;
        }
      }
      password=PwdEncryptor.encrypt(password);
      if (password.equals(encPassword)) {
        return true;
      }
    }
  }
 catch (  Exception e) {
    _log.error(e);
  }
  return false;
}
