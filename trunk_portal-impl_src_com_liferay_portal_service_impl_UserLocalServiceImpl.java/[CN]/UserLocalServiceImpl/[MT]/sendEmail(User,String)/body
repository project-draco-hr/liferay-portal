{
  if (!PrefsPropsUtil.getBoolean(user.getCompanyId(),PropsKeys.ADMIN_EMAIL_USER_ADDED_ENABLED)) {
    return;
  }
  Company company=companyPersistence.findByPrimaryKey(user.getCompanyId());
  String fromName=PrefsPropsUtil.getString(user.getCompanyId(),PropsKeys.ADMIN_EMAIL_FROM_NAME);
  String fromAddress=PrefsPropsUtil.getString(user.getCompanyId(),PropsKeys.ADMIN_EMAIL_FROM_ADDRESS);
  String toName=user.getFullName();
  String toAddress=user.getEmailAddress();
  String subject=PrefsPropsUtil.getContent(user.getCompanyId(),PropsKeys.ADMIN_EMAIL_USER_ADDED_SUBJECT);
  String body=null;
  if (Validator.isNotNull(password)) {
    body=PrefsPropsUtil.getContent(user.getCompanyId(),PropsKeys.ADMIN_EMAIL_USER_ADDED_BODY);
  }
 else {
    body=PrefsPropsUtil.getContent(user.getCompanyId(),PropsKeys.ADMIN_EMAIL_USER_ADDED_NO_PASSWORD_BODY);
  }
  subject=StringUtil.replace(subject,new String[]{"[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$TO_ADDRESS$]","[$TO_NAME$]","[$USER_ID$]","[$USER_PASSWORD$]","[$USER_SCREENNAME$]"},new String[]{fromAddress,fromName,company.getVirtualHostname(),toAddress,toName,String.valueOf(user.getUserId()),password,user.getScreenName()});
  body=StringUtil.replace(body,new String[]{"[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$TO_ADDRESS$]","[$TO_NAME$]","[$USER_ID$]","[$USER_PASSWORD$]","[$USER_SCREENNAME$]"},new String[]{fromAddress,fromName,company.getVirtualHostname(),toAddress,toName,String.valueOf(user.getUserId()),password,user.getScreenName()});
  InternetAddress from=new InternetAddress(fromAddress,fromName);
  InternetAddress to=new InternetAddress(toAddress,toName);
  MailMessage message=new MailMessage(from,to,subject,body,true);
  mailService.sendEmail(message);
}
