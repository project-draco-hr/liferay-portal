{
  try {
    long companyId=webDavRequest.getCompanyId();
    long userId=webDavRequest.getUserId();
    List<Resource> resources=new ArrayList<Resource>();
    List<Group> groups=GroupLocalServiceUtil.getUserOrganizationsGroups(userId,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
    for (    Group group : groups) {
      Resource resource=getResource(group);
      resources.add(resource);
    }
    LinkedHashMap<String,Object> params=new LinkedHashMap<String,Object>();
    params.put("usersGroups",userId);
    groups=GroupLocalServiceUtil.search(companyId,null,null,params,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
    for (    Group group : groups) {
      Resource resource=getResource(group);
      resources.add(resource);
    }
    Group group=GroupLocalServiceUtil.getUserGroup(companyId,userId);
    Resource resource=getResource(group);
    resources.add(resource);
    return resources;
  }
 catch (  Exception e) {
    throw new WebDAVException(e);
  }
}
