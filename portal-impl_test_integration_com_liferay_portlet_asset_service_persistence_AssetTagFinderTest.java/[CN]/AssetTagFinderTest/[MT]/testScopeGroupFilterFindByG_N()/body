{
  Group scopeGroup=addScopeGroup();
  Group siteGroup=scopeGroup.getParentGroup();
  String tagName=ServiceTestUtil.randomString();
  addAssetTag(siteGroup.getGroupId(),tagName,null);
  User user=UserTestUtil.addUser(null,0);
  PermissionChecker originalPermissionChecker=PermissionThreadLocal.getPermissionChecker();
  try {
    PermissionChecker permissionChecker=PermissionCheckerFactoryUtil.create(user);
    PermissionThreadLocal.setPermissionChecker(permissionChecker);
    try {
      AssetTagFinderUtil.filterFindByG_N(scopeGroup.getGroupId(),tagName);
      Assert.fail();
    }
 catch (    NoSuchTagException nste) {
    }
    AssetTag finalTagsSiteGroup=AssetTagFinderUtil.filterFindByG_N(siteGroup.getGroupId(),tagName);
    Assert.assertEquals(tagName.toLowerCase(),finalTagsSiteGroup.getName());
  }
  finally {
    PermissionThreadLocal.setPermissionChecker(originalPermissionChecker);
  }
}
