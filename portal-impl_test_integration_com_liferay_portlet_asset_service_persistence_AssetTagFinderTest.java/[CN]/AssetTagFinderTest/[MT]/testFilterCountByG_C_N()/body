{
  Group scopeGroup=addScopeGroup();
  Group siteGroup=scopeGroup.getParentGroup();
  long classNameId=PortalUtil.getClassNameId(BlogsEntry.class);
  String assetTagName=ServiceTestUtil.randomString();
  int initialScopeGroupAssetTagsCount=AssetTagFinderUtil.filterCountByG_C_N(scopeGroup.getGroupId(),classNameId,assetTagName);
  int initialSiteGroupAssetTagsCount=AssetTagFinderUtil.filterCountByG_C_N(siteGroup.getGroupId(),classNameId,assetTagName);
  addBlogsEntry(scopeGroup.getGroupId(),assetTagName);
  User user=UserTestUtil.addUser(null,0);
  PermissionChecker originalPermissionChecker=PermissionThreadLocal.getPermissionChecker();
  try {
    PermissionChecker permissionChecker=PermissionCheckerFactoryUtil.create(user);
    PermissionThreadLocal.setPermissionChecker(permissionChecker);
    int scopeGroupAssetTagsCount=AssetTagFinderUtil.filterCountByG_C_N(scopeGroup.getGroupId(),classNameId,assetTagName);
    Assert.assertEquals(initialScopeGroupAssetTagsCount + 1,scopeGroupAssetTagsCount);
    int siteGroupAssetTagsCount=AssetTagFinderUtil.filterCountByG_C_N(siteGroup.getGroupId(),classNameId,assetTagName);
    Assert.assertEquals(initialSiteGroupAssetTagsCount,siteGroupAssetTagsCount);
  }
  finally {
    PermissionThreadLocal.setPermissionChecker(originalPermissionChecker);
  }
}
