{
  PortletImpl portlet=spy(new PortletImpl());
  List<String> portletResourcesList=Arrays.asList(portletResources);
  portlet.setFooterPortalCss(portletResourcesList);
  portlet.setFooterPortalJavaScript(portletResourcesList);
  portlet.setFooterPortletCss(portletResourcesList);
  portlet.setFooterPortletJavaScript(portletResourcesList);
  portlet.setHeaderPortalCss(portletResourcesList);
  portlet.setHeaderPortalJavaScript(portletResourcesList);
  portlet.setHeaderPortletCss(portletResourcesList);
  portlet.setHeaderPortletJavaScript(portletResourcesList);
  portlet.setPortletName(contextName);
  PortletAppImpl portletApp=new PortletAppImpl(contextName);
  ServletContext servletContext=new MockServletContext();
  portletApp.setServletContext(servletContext);
  portlet.setPortletApp(portletApp);
  ServletContextPool.put(contextName,servletContext);
  doReturn(contextName).when(portlet).getContextName();
  doReturn(PortletKeys.ACTIVITIES).when(portlet).getPortletId();
  return portlet;
}
