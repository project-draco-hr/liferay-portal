{
  if (xml == null) {
    return xml;
  }
  _requestedLocale=getLanguageId();
  try {
    Document document=SAXReaderUtil.read(xml);
    Element rootElement=document.getRootElement();
    String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getDefault());
    String[] availableLocales=StringUtil.split(rootElement.attributeValue("available-locales",defaultLanguageId));
    String defaultLocale=rootElement.attributeValue("default-locale",defaultLanguageId);
    boolean supportedLocale=false;
    for (    String availableLocale : availableLocales) {
      if (availableLocale.equalsIgnoreCase(getLanguageId())) {
        supportedLocale=true;
        break;
      }
    }
    if (!supportedLocale) {
      setLanguageId(defaultLocale);
    }
    replace(rootElement);
    xml=DDMXMLUtil.formatXML(document);
  }
 catch (  Exception e) {
    _log.error(e);
  }
  return xml;
}
