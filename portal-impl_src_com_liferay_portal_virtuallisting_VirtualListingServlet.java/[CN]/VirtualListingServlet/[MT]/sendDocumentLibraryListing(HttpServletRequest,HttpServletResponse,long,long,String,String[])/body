{
  long groupId=getGroupId(companyId,pathArray[0]);
  long folderId=DLFolderConstants.DEFAULT_PARENT_FOLDER_ID;
  for (int i=1; i < pathArray.length; i++) {
    String name=pathArray[i];
    try {
      DLFolder folder=DLFolderServiceUtil.getFolder(groupId,folderId,name);
      folderId=folder.getFolderId();
    }
 catch (    NoSuchFolderException nsfe) {
      if (i != pathArray.length - 1) {
        throw nsfe;
      }
      String title=name;
      sendFile(response,companyId,userId,groupId,folderId,title);
      return;
    }
  }
  try {
    sendFile(response,companyId,userId,groupId,folderId,"index.html");
    return;
  }
 catch (  Exception e) {
    if ((e instanceof NoSuchFileEntryException) || (e instanceof PrincipalException)) {
      try {
        sendFile(response,companyId,userId,groupId,folderId,"index.htm");
        return;
      }
 catch (      NoSuchFileEntryException nsfee) {
      }
catch (      PrincipalException pe) {
      }
    }
 else {
      throw e;
    }
  }
  List<Tuple> entries=new ArrayList<Tuple>();
  entries.add(buildEntry(fullPath,"../",null,null,null));
  List<DLFolder> folders=DLFolderServiceUtil.getFolders(groupId,folderId);
  for (  DLFolder folder : folders) {
    Tuple entry=buildEntry(fullPath,folder.getName() + StringPool.SLASH,folder.getModifiedDate(),null,folder.getDescription());
    entries.add(entry);
  }
  List<DLFileEntry> fileEntries=DLFileEntryServiceUtil.getFileEntries(groupId,folderId);
  for (  DLFileEntry fileEntry : fileEntries) {
    String size=String.valueOf(fileEntry.getSize());
    if (fileEntry.getSize() > 1024) {
      size=TextFormatter.formatKB(fileEntry.getSize(),PortalUtil.getLocale(request)) + "k";
    }
    Tuple entry=buildEntry(fullPath,fileEntry.getTitle(),fileEntry.getModifiedDate(),size,fileEntry.getDescription());
    entries.add(entry);
  }
  String directoryPath=HttpUtil.encodePath(StringPool.SLASH + StringUtil.merge(pathArray,StringPool.SLASH));
  sendHTML(response,directoryPath,entries);
}
