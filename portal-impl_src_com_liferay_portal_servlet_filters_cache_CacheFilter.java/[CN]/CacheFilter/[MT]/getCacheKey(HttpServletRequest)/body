{
  StringBundler sb=new StringBundler(13);
  sb.append(HttpUtil.getProtocol(request));
  sb.append(Http.PROTOCOL_DELIMITER);
  sb.append(request.getContextPath());
  sb.append(request.getServletPath());
  sb.append(request.getPathInfo());
  sb.append(StringPool.QUESTION);
  if (request.getQueryString() != null) {
    sb.append(request.getQueryString());
  }
 else {
    String url=(String)request.getAttribute(WebKeys.CURRENT_COMPLETE_URL);
    if (url.indexOf(StringPool.QUESTION) > -1) {
      sb.append(url.substring(url.indexOf(StringPool.QUESTION) + 1));
    }
  }
  sb.append(StringPool.POUND);
  String languageId=(String)request.getAttribute(WebKeys.I18N_LANGUAGE_ID);
  if (Validator.isNull(languageId)) {
    languageId=LanguageUtil.getLanguageId(request);
  }
  sb.append(languageId);
  String userAgent=GetterUtil.getString(request.getHeader(HttpHeaders.USER_AGENT));
  sb.append(StringPool.POUND);
  sb.append(userAgent.toLowerCase().hashCode());
  sb.append(StringPool.POUND);
  sb.append(BrowserSnifferUtil.acceptsGzip(request));
  return sb.toString().trim().toUpperCase();
}
