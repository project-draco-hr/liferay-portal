{
  capabilityRegistry.addExportedCapability(TrashCapability.class,_trashCapability);
  DocumentRepository documentRepository=capabilityRegistry.getTarget();
  DLFileEntryServiceAdapter dlFileEntryServiceAdapter=null;
  DLFolderServiceAdapter dlFolderServiceAdapter=null;
  GroupServiceAdapter groupServiceAdapter=null;
  if (documentRepository instanceof LocalRepository) {
    dlFileEntryServiceAdapter=new DLFileEntryServiceAdapter(DLFileEntryLocalServiceUtil.getService());
    dlFolderServiceAdapter=new DLFolderServiceAdapter(DLFolderLocalServiceUtil.getService());
    groupServiceAdapter=new GroupServiceAdapter(GroupLocalServiceUtil.getService());
  }
 else {
    dlFileEntryServiceAdapter=new DLFileEntryServiceAdapter(DLFileEntryLocalServiceUtil.getService(),DLFileEntryServiceUtil.getService());
    dlFolderServiceAdapter=new DLFolderServiceAdapter(DLFolderLocalServiceUtil.getService(),DLFolderServiceUtil.getService());
    groupServiceAdapter=new GroupServiceAdapter(GroupLocalServiceUtil.getService(),GroupServiceUtil.getService());
  }
  BulkOperationCapability bulkOperationCapability=new LiferayBulkOperationCapability(documentRepository,dlFileEntryServiceAdapter,dlFolderServiceAdapter);
  capabilityRegistry.addExportedCapability(BulkOperationCapability.class,bulkOperationCapability);
  RepositoryEntryConverter repositoryEntryConverter=new RepositoryEntryConverter();
  RepositoryEntryChecker repositoryEntryChecker=new RepositoryEntryChecker(documentRepository);
  capabilityRegistry.addExportedCapability(RelatedModelCapability.class,new LiferayRelatedModelCapability(repositoryEntryConverter,repositoryEntryChecker));
  capabilityRegistry.addExportedCapability(ThumbnailCapability.class,new LiferayThumbnailCapability(repositoryEntryConverter,repositoryEntryChecker));
  capabilityRegistry.addExportedCapability(WorkflowCapability.class,_workflowCapability);
  if (PropsValues.DL_FILE_ENTRY_COMMENTS_ENABLED) {
    capabilityRegistry.addSupportedCapability(CommentCapability.class,_commentCapability);
  }
  capabilityRegistry.addSupportedCapability(ProcessorCapability.class,_processorCapability);
  capabilityRegistry.addSupportedCapability(SyncCapability.class,new LiferaySyncCapability(groupServiceAdapter));
}
