{
  WikiGroupServiceOverriddenConfiguration wikiGroupServiceConfiguration=_wikiRequestHelper.getWikiGroupServiceSettings();
  if (!WikiPagePermissionChecker.contains(_wikiRequestHelper.getPermissionChecker(),wikiPage,ActionKeys.SUBSCRIBE) || (!wikiGroupServiceConfiguration.emailPageAddedEnabled() && !wikiGroupServiceConfiguration.emailPageUpdatedEnabled())) {
    return;
  }
  User user=_wikiRequestHelper.getUser();
  if (SubscriptionLocalServiceUtil.isSubscribed(user.getCompanyId(),user.getUserId(),WikiPage.class.getName(),wikiPage.getResourcePrimKey())) {
    URLMenuItem urlMenuItem=new URLMenuItem();
    urlMenuItem.setIcon("icon-remove-sign");
    urlMenuItem.setKey(WikiUIItemKeys.UNSUBSCRIBE);
    urlMenuItem.setLabel("unsubscribe");
    LiferayPortletResponse liferayPortletResponse=_wikiRequestHelper.getLiferayPortletResponse();
    PortletURL portletURL=liferayPortletResponse.createActionURL();
    portletURL.setParameter("struts_action","/wiki/edit_page");
    portletURL.setParameter(Constants.CMD,Constants.UNSUBSCRIBE);
    portletURL.setParameter("redirect",_wikiRequestHelper.getCurrentURL());
    portletURL.setParameter("nodeId",String.valueOf(wikiPage.getNodeId()));
    portletURL.setParameter("title",HtmlUtil.unescape(wikiPage.getTitle()));
    urlMenuItem.setURL(portletURL.toString());
    menuItems.add(urlMenuItem);
  }
 else {
    URLMenuItem urlMenuItem=new URLMenuItem();
    urlMenuItem.setIcon("icon-ok-sign");
    urlMenuItem.setKey(WikiUIItemKeys.SUBSCRIBE);
    urlMenuItem.setLabel("subscribe");
    LiferayPortletResponse liferayPortletResponse=_wikiRequestHelper.getLiferayPortletResponse();
    PortletURL portletURL=liferayPortletResponse.createActionURL();
    portletURL.setParameter("struts_action","/wiki/edit_page");
    portletURL.setParameter(Constants.CMD,Constants.SUBSCRIBE);
    portletURL.setParameter("redirect",_wikiRequestHelper.getCurrentURL());
    portletURL.setParameter("nodeId",String.valueOf(wikiPage.getNodeId()));
    portletURL.setParameter("title",HtmlUtil.unescape(wikiPage.getTitle()));
    urlMenuItem.setURL(portletURL.toString());
    menuItems.add(urlMenuItem);
  }
}
