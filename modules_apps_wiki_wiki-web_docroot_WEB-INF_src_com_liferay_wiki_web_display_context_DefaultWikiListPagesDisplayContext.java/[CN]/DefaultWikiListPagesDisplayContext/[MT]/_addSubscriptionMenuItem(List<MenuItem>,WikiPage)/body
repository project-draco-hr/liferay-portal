{
  WikiGroupServiceSettings wikiGroupServiceSettings=_wikiRequestHelper.getWikiGroupServiceSettings();
  if (!WikiPagePermissionChecker.contains(_wikiRequestHelper.getPermissionChecker(),wikiPage,ActionKeys.SUBSCRIBE) || (!wikiGroupServiceSettings.emailPageAddedEnabled() && !wikiGroupServiceSettings.emailPageUpdatedEnabled())) {
    return;
  }
  User user=_wikiRequestHelper.getUser();
  if (SubscriptionLocalServiceUtil.isSubscribed(user.getCompanyId(),user.getUserId(),WikiPage.class.getName(),wikiPage.getResourcePrimKey())) {
    URLMenuItem menuItem=new URLMenuItem();
    menuItem.setIcon("icon-remove-sign");
    menuItem.setKey(WikiUIItemKeys.UNSUBSCRIBE);
    menuItem.setLabel("unsubscribe");
    LiferayPortletResponse liferayPortletResponse=_wikiRequestHelper.getLiferayPortletResponse();
    PortletURL portletURL=liferayPortletResponse.createActionURL();
    portletURL.setParameter("struts_action","/wiki/edit_page");
    portletURL.setParameter(Constants.CMD,Constants.UNSUBSCRIBE);
    portletURL.setParameter("redirect",_wikiRequestHelper.getCurrentURL());
    portletURL.setParameter("nodeId",String.valueOf(wikiPage.getNodeId()));
    portletURL.setParameter("title",HtmlUtil.unescape(wikiPage.getTitle()));
    menuItem.setURL(portletURL.toString());
    menuItems.add(menuItem);
  }
 else {
    URLMenuItem menuItem=new URLMenuItem();
    menuItem.setIcon("icon-ok-sign");
    menuItem.setKey(WikiUIItemKeys.SUBSCRIBE);
    menuItem.setLabel("subscribe");
    LiferayPortletResponse liferayPortletResponse=_wikiRequestHelper.getLiferayPortletResponse();
    PortletURL portletURL=liferayPortletResponse.createActionURL();
    portletURL.setParameter("struts_action","/wiki/edit_page");
    portletURL.setParameter(Constants.CMD,Constants.SUBSCRIBE);
    portletURL.setParameter("redirect",_wikiRequestHelper.getCurrentURL());
    portletURL.setParameter("nodeId",String.valueOf(wikiPage.getNodeId()));
    portletURL.setParameter("title",HtmlUtil.unescape(wikiPage.getTitle()));
    menuItem.setURL(portletURL.toString());
    menuItems.add(menuItem);
  }
}
