{
  StringBuilder sb=new StringBuilder();
  sb.append(getGlobalScript());
  sb.append(code);
  String script=sb.toString();
  PortletConfig portletConfig=getPortletConfig();
  PortletContext portletContext=getPortletContext();
  PortletPreferences preferences=portletRequest.getPreferences();
  Map<String,String> userInfo=(Map<String,String>)portletRequest.getAttribute(PortletRequest.USER_INFO);
  Context context=Context.enter();
  try {
    Scriptable scope=context.initStandardObjects();
    Object out=Context.javaToJS(System.out,scope);
    ScriptableObject.putProperty(scope,"out",out);
    ScriptableObject.putProperty(scope,"portletConfig",Context.javaToJS(portletConfig,scope));
    ScriptableObject.putProperty(scope,"portletContext",Context.javaToJS(portletContext,scope));
    ScriptableObject.putProperty(scope,"preferences",Context.javaToJS(preferences,scope));
    ScriptableObject.putProperty(scope,"userInfo",Context.javaToJS(userInfo,scope));
    if (portletRequest instanceof ActionRequest) {
      ScriptableObject.putProperty(scope,"actionRequest",Context.javaToJS(portletRequest,scope));
    }
 else     if (portletRequest instanceof RenderRequest) {
      ScriptableObject.putProperty(scope,"renderRequest",Context.javaToJS(portletRequest,scope));
    }
 else     if (portletRequest instanceof ResourceRequest) {
      ScriptableObject.putProperty(scope,"resourceRequest",Context.javaToJS(portletRequest,scope));
    }
    if (portletResponse instanceof ActionResponse) {
      ScriptableObject.putProperty(scope,"actionResponse",Context.javaToJS(portletResponse,scope));
    }
 else     if (portletResponse instanceof RenderResponse) {
      ScriptableObject.putProperty(scope,"renderResponse",Context.javaToJS(portletResponse,scope));
    }
 else     if (portletResponse instanceof ResourceResponse) {
      ScriptableObject.putProperty(scope,"resourceResponse",Context.javaToJS(portletResponse,scope));
    }
    context.evaluateString(scope,script,"script",1,null);
  }
  finally {
    Context.exit();
  }
}
