{
  templateId=templateId.trim().toUpperCase();
  try {
    if (formatXsl) {
      xsl=JournalUtil.formatXML(xsl);
    }
  }
 catch (  DocumentException de) {
    throw new TemplateXslException();
  }
catch (  IOException ioe) {
    throw new TemplateXslException();
  }
  byte[] smallBytes=null;
  try {
    smallBytes=FileUtil.getBytes(smallFile);
  }
 catch (  IOException ioe) {
  }
  validate(name,description,xsl,smallImage,smallImageURL,smallFile,smallBytes);
  JournalTemplate template=JournalTemplateUtil.findByPrimaryKey(new JournalTemplatePK(companyId,templateId));
  template.setModifiedDate(new Date());
  if (Validator.isNull(template.getStructureId()) && Validator.isNotNull(structureId)) {
    template.setStructureId(structureId);
  }
  template.setName(name);
  template.setDescription(description);
  template.setXsl(xsl);
  template.setLangType(langType);
  template.setSmallImage(smallImage);
  template.setSmallImageURL(smallImageURL);
  JournalTemplateUtil.update(template);
  saveImages(smallImage,template.getSmallImageId(),smallFile,smallBytes);
  return template;
}
