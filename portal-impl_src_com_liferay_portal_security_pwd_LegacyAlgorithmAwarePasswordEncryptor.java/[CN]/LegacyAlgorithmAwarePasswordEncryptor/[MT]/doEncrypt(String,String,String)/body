{
  if (Validator.isNull(PropsValues.PASSWORDS_ENCRYPTION_ALGORITHM_LEGACY)) {
    return _parentPasswordEncryptor.encrypt(algorithm,clearTextPassword,currentEncryptedPassword);
  }
  boolean prependAlgorithm=true;
  if (Validator.isNotNull(currentEncryptedPassword) && (currentEncryptedPassword.charAt(0) != CharPool.OPEN_CURLY_BRACE)) {
    algorithm=PropsValues.PASSWORDS_ENCRYPTION_ALGORITHM_LEGACY;
    prependAlgorithm=false;
  }
 else   if (Validator.isNotNull(currentEncryptedPassword) && (currentEncryptedPassword.charAt(0) == CharPool.OPEN_CURLY_BRACE)) {
    int endPos=currentEncryptedPassword.indexOf(CharPool.CLOSE_CURLY_BRACE);
    if (endPos > 0) {
      algorithm=currentEncryptedPassword.substring(1,endPos);
      currentEncryptedPassword=currentEncryptedPassword.substring(endPos + 1);
    }
  }
  String encryptedPassword=_parentPasswordEncryptor.encrypt(algorithm,clearTextPassword,currentEncryptedPassword);
  if (!prependAlgorithm) {
    return encryptedPassword;
  }
  StringBuilder result=new StringBuilder(4);
  result.append(StringPool.OPEN_CURLY_BRACE);
  result.append(getAlgorithmName(algorithm));
  result.append(StringPool.CLOSE_CURLY_BRACE);
  result.append(encryptedPassword);
  return result.toString();
}
