{
  Class<?> clazz=getClass();
  ClassLoaderPool.register(StringPool.BLANK,clazz.getClassLoader());
  try {
    String className=clazz.getName();
    ByteBuffer byteBuffer=ByteBuffer.allocate(className.length() + 11);
    byteBuffer.put(SerializationConstants.TC_CLASS);
    byteBuffer.put((byte)1);
    byteBuffer.putInt(0);
    byteBuffer.put((byte)1);
    byteBuffer.putInt(className.length());
    byteBuffer.put(className.getBytes(StringPool.UTF8));
    byteBuffer.flip();
    Deserializer deserializer=new Deserializer(byteBuffer);
    Class<?> readClass=deserializer.readObject();
    Assert.assertSame(clazz,readClass);
  }
  finally {
    ClassLoaderPool.unregister(clazz.getClassLoader());
  }
}
