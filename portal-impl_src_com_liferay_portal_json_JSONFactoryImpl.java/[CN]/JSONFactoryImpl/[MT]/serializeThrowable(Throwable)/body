{
  if (throwable instanceof InvocationTargetException) {
    throwable=throwable.getCause();
  }
  String throwableTypeName=ClassUtil.getClassName(throwable);
  String throwableMessage=throwable.getMessage();
  if (Validator.isNull(throwableMessage)) {
    throwableMessage=throwable.toString();
  }
  Throwable rootCause=throwable;
  while (rootCause.getCause() != null) {
    rootCause=rootCause.getCause();
  }
  String rootCauseName=ClassUtil.getClassName(rootCause);
  String rootCauseMessage=rootCause.getMessage();
  if (Validator.isNull(rootCauseMessage)) {
    rootCauseMessage=rootCause.toString();
  }
  JSONObject jsonObject=createJSONObject();
  jsonObject.put("exception",throwableMessage);
  jsonObject.put("throwable",throwable.toString());
  JSONObject error=createJSONObject();
  error.put("message",throwableMessage);
  error.put("type",throwableTypeName);
  jsonObject.put("error",error);
  if (rootCause != throwable) {
    JSONObject cause=createJSONObject();
    cause.put("message",rootCauseMessage);
    cause.put("type",rootCauseName);
    jsonObject.put("cause",cause);
  }
  return jsonObject.toString();
}
