{
  if (_log.isDebugEnabled()) {
    _log.debug("Attempt to detect type for " + imageId);
  }
  byte[] textObj=(byte[])Base64.stringToObject(text_);
  if (textObj == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Abort attempt to detect type because image is null");
    }
    return null;
  }
  String type=TYPE_NOT_AVAILABLE;
  ByteArrayInputStream bais=null;
  MemoryCacheImageInputStream mcis=null;
  try {
    bais=new ByteArrayInputStream(textObj);
    mcis=new MemoryCacheImageInputStream(bais);
    Iterator itr=ImageIO.getImageReaders(mcis);
    while (itr.hasNext()) {
      ImageReader reader=(ImageReader)itr.next();
      if (reader instanceof GIFImageReader) {
        type=TYPE_GIF;
      }
 else       if (reader instanceof JPEGImageReader) {
        type=TYPE_JPEG;
      }
 else       if (reader instanceof PNGImageReader) {
        type=TYPE_PNG;
      }
      reader.dispose();
    }
  }
  finally {
    if (bais != null) {
      try {
        bais.close();
      }
 catch (      IOException ioe) {
        if (_log.isWarnEnabled()) {
          _log.warn(ioe);
        }
      }
    }
    if (mcis != null) {
      try {
        mcis.close();
      }
 catch (      IOException ioe) {
        if (_log.isWarnEnabled()) {
          _log.warn(ioe);
        }
      }
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Detected type " + type);
  }
  return type;
}
