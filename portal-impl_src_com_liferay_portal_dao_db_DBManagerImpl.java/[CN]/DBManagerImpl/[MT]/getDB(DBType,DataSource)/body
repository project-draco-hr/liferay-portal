{
  int dbMajorVersion=0;
  int dbMinorVersion=0;
  if (dataSource != null) {
    try (Connection connection=dataSource.getConnection()){
      DatabaseMetaData databaseMetaData=connection.getMetaData();
      dbMajorVersion=databaseMetaData.getDatabaseMajorVersion();
      dbMinorVersion=databaseMetaData.getDatabaseMinorVersion();
    }
 catch (    SQLException sqle) {
      return ReflectionUtil.throwException(sqle);
    }
  }
  DBFactory dbCreator=_dbCreators.get(dbType);
  if (dbCreator == null) {
    throw new IllegalArgumentException("Unsupported database type " + dbType);
  }
  return dbCreator.create(dbMajorVersion,dbMinorVersion);
}
