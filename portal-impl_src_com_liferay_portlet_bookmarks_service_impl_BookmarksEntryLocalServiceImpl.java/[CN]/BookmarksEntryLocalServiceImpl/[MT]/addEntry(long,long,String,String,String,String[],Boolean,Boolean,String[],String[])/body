{
  User user=UserUtil.findByPrimaryKey(userId);
  BookmarksFolder folder=BookmarksFolderUtil.findByPrimaryKey(folderId);
  if (Validator.isNull(name)) {
    name=url;
  }
  Date now=new Date();
  validate(url);
  long entryId=CounterLocalServiceUtil.increment();
  BookmarksEntry entry=BookmarksEntryUtil.create(entryId);
  entry.setCompanyId(user.getCompanyId());
  entry.setUserId(user.getUserId());
  entry.setCreateDate(now);
  entry.setModifiedDate(now);
  entry.setFolderId(folderId);
  entry.setName(name);
  entry.setUrl(url);
  entry.setComments(comments);
  BookmarksEntryUtil.update(entry);
  if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
    addEntryResources(folder,entry,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
  }
 else {
    addEntryResources(folder,entry,communityPermissions,guestPermissions);
  }
  TagsAssetLocalServiceUtil.updateAsset(userId,BookmarksEntry.class.getName(),String.valueOf(entry.getEntryId()),tagsEntries);
  return entry;
}
