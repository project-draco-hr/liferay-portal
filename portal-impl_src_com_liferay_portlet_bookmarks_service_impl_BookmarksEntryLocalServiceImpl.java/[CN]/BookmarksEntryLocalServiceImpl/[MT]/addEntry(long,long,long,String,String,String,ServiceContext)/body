{
  User user=userPersistence.findByPrimaryKey(userId);
  if (Validator.isNull(name)) {
    name=url;
  }
  Date now=new Date();
  validate(url);
  long entryId=counterLocalService.increment();
  BookmarksEntry entry=bookmarksEntryPersistence.create(entryId);
  entry.setUuid(serviceContext.getUuid());
  entry.setGroupId(groupId);
  entry.setCompanyId(user.getCompanyId());
  entry.setUserId(user.getUserId());
  entry.setUserName(user.getFullName());
  entry.setCreateDate(serviceContext.getCreateDate(now));
  entry.setModifiedDate(serviceContext.getModifiedDate(now));
  entry.setFolderId(folderId);
  entry.setName(name);
  entry.setUrl(url);
  entry.setDescription(description);
  entry.setExpandoBridgeAttributes(serviceContext);
  bookmarksEntryPersistence.update(entry,false);
  if (serviceContext.getAddGroupPermissions() || serviceContext.getAddGuestPermissions()) {
    addEntryResources(entry,serviceContext.getAddGroupPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addEntryResources(entry,serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions());
  }
  updateAsset(userId,entry,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames(),serviceContext.getAssetLinkEntryIds());
  Indexer indexer=IndexerRegistryUtil.getIndexer(BookmarksEntry.class);
  indexer.reindex(entry);
  return entry;
}
