{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portlet.getPortletId());
  List<PublicRenderParameterConfiguration> publicRenderParameterConfigurations=new ArrayList<PublicRenderParameterConfiguration>();
  for (  PublicRenderParameter publicRenderParameter : portlet.getPublicRenderParameters()) {
    String mappingKey=PublicRenderParameterConfiguration.getMappingKey(publicRenderParameter);
    String ignoreKey=PublicRenderParameterConfiguration.getIgnoreKey(publicRenderParameter);
    String mappingValue=null;
    boolean ignoreValue=false;
    if (SessionErrors.isEmpty(renderRequest)) {
      mappingValue=preferences.getValue(mappingKey,null);
      ignoreValue=GetterUtil.getBoolean(preferences.getValue(ignoreKey,null));
    }
 else {
      mappingValue=ParamUtil.getString(renderRequest,mappingKey);
      ignoreValue=GetterUtil.getBoolean(ParamUtil.getString(renderRequest,ignoreKey));
    }
    publicRenderParameterConfigurations.add(new PublicRenderParameterConfiguration(publicRenderParameter,mappingValue,ignoreValue));
  }
  Collections.sort(publicRenderParameterConfigurations,new PublicRenderParameterIdentifierConfigurationComparator());
  renderRequest.setAttribute(WebKeys.PUBLIC_RENDER_PARAMETER_CONFIGURATIONS,publicRenderParameterConfigurations);
}
