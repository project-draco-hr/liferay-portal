{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portlet.getPortletId());
  Map<String,String> mappings=new HashMap<String,String>();
  if (SessionErrors.isEmpty(renderRequest)) {
    Set<PublicRenderParameter> publicRenderParameters=(Set<PublicRenderParameter>)renderRequest.getAttribute(WebKeys.PUBLIC_RENDER_PARAMETERS);
    for (    PublicRenderParameter publicRenderParameter : publicRenderParameters) {
      String mapping=preferences.getValue(_MAPPING_PREFIX + publicRenderParameter.getIdentifier(),null);
      if (Validator.isNotNull(mapping)) {
        mappings.put(mapping,publicRenderParameter.getIdentifier());
      }
    }
  }
 else {
    for (    PublicRenderParameter publicRenderParameter : portlet.getPublicRenderParameters()) {
      String mapping=ParamUtil.getString(renderRequest,_MAPPING_PREFIX + publicRenderParameter.getIdentifier());
      mappings.put(publicRenderParameter.getIdentifier(),mapping);
    }
  }
  List<PublicRenderParameterConfiguration> publicRenderParameterConfigurations=new ArrayList<PublicRenderParameterConfiguration>();
  for (  PublicRenderParameter publicRenderParameter : portlet.getPublicRenderParameters()) {
    boolean ignore=false;
    String ignoreKey=_IGNORE_PREFIX + publicRenderParameter.getIdentifier();
    if (SessionErrors.isEmpty(renderRequest)) {
      ignore=GetterUtil.getBoolean(preferences.getValue(ignoreKey,null));
    }
 else {
      ignore=GetterUtil.getBoolean(ParamUtil.getString(renderRequest,ignoreKey));
    }
    publicRenderParameterConfigurations.add(new PublicRenderParameterConfiguration(publicRenderParameter,mappings.get(publicRenderParameter.getIdentifier()),ignore));
  }
  Collections.sort(publicRenderParameterConfigurations,new PublicRenderParameterIdentifierConfigurationComparator());
  renderRequest.setAttribute(WebKeys.PUBLIC_RENDER_PARAMETER_CONFIGURATIONS,publicRenderParameterConfigurations);
}
