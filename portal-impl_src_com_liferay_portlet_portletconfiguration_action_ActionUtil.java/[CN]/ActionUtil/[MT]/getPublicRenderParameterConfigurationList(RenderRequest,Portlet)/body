{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portlet.getPortletId());
  List<PublicRenderParameterConfiguration> publicRenderParameterConfigurations=new ArrayList<PublicRenderParameterConfiguration>();
  for (  PublicRenderParameter publicRenderParameter : portlet.getPublicRenderParameters()) {
    boolean ignore=false;
    String mapping=null;
    String ignoreKey=_IGNORE_PREFIX + PortletQNameUtil.getPublicRenderParameterName(publicRenderParameter.getQName());
    String mappingKey=_MAPPING_PREFIX + PortletQNameUtil.getPublicRenderParameterName(publicRenderParameter.getQName());
    if (SessionErrors.isEmpty(renderRequest)) {
      ignore=GetterUtil.getBoolean(preferences.getValue(ignoreKey,null));
      mapping=preferences.getValue(mappingKey,null);
    }
 else {
      ignore=GetterUtil.getBoolean(ParamUtil.getString(renderRequest,ignoreKey));
      mapping=ParamUtil.getString(renderRequest,mappingKey);
    }
    publicRenderParameterConfigurations.add(new PublicRenderParameterConfiguration(publicRenderParameter,mapping,ignore));
  }
  Collections.sort(publicRenderParameterConfigurations,new PublicRenderParameterIdentifierConfigurationComparator());
  renderRequest.setAttribute(WebKeys.PUBLIC_RENDER_PARAMETER_CONFIGURATIONS,publicRenderParameterConfigurations);
}
