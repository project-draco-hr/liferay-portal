{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  String portletId=ParamUtil.getString(portletRequest,"portletResource");
  Layout layout=PortletConfigurationLayoutUtil.getLayout(themeDisplay);
  if (!PortletPermissionUtil.contains(permissionChecker,themeDisplay.getScopeGroupId(),layout,portletId,ActionKeys.CONFIGURATION)) {
    throw new PrincipalException.MustHavePermission(permissionChecker.getUserId(),Portlet.class.getName(),portletId,ActionKeys.CONFIGURATION);
  }
  return PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),portletId);
}
