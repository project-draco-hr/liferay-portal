{
  ServletContext servletContext=(ServletContext)renderRequest.getAttribute(WebKeys.CTX);
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  HttpServletRequest request=PortalUtil.getHttpServletRequest(renderRequest);
  PortletPreferences portletPreferences=ActionUtil.getLayoutPortletSetup(renderRequest,portlet);
  portletPreferences=getPortletPreferences(request,renderRequest.getPreferences(),portletPreferences);
  String title=PortletConfigurationUtil.getPortletTitle(portletPreferences,themeDisplay.getLanguageId());
  if (Validator.isNull(title)) {
    title=PortalUtil.getPortletTitle(portlet,servletContext,themeDisplay.getLocale());
  }
  return title;
}
