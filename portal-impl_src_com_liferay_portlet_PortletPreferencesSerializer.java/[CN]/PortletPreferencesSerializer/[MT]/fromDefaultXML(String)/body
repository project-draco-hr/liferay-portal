{
  PortletPreferencesImpl portletPreferencesImpl=new PortletPreferencesImpl();
  if (Validator.isNull(xml)) {
    return portletPreferencesImpl;
  }
  Map<String,Preference> preferencesMap=portletPreferencesImpl.getPreferences();
  XMLEventReader xmlEventReader=null;
  try {
    XMLInputFactory xmlInputFactory=StAXReaderUtil.getXMLInputFactory();
    xmlEventReader=xmlInputFactory.createXMLEventReader(new UnsyncStringReader(xml));
    while (xmlEventReader.hasNext()) {
      XMLEvent xmlEvent=xmlEventReader.nextEvent();
      if (xmlEvent.isStartElement()) {
        StartElement startElement=xmlEvent.asStartElement();
        String elementName=startElement.getName().getLocalPart();
        if (elementName.equals("preference")) {
          Preference preference=_readPreference(xmlEventReader);
          preferencesMap.put(preference.getName(),preference);
        }
      }
    }
    return portletPreferencesImpl;
  }
 catch (  XMLStreamException xse) {
    throw new SystemException(xse);
  }
 finally {
    if (xmlEventReader != null) {
      try {
        xmlEventReader.close();
      }
 catch (      XMLStreamException xse) {
      }
    }
  }
}
