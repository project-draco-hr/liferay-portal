{
  PortletPreferencesImpl preferences=new PortletPreferencesImpl();
  if (Validator.isNull(xml)) {
    return preferences;
  }
  Map<String,Preference> preferencesMap=preferences.getPreferences();
  XMLEventReader xmlEventReader=null;
  try {
    xmlEventReader=_xmlInputFactory.createXMLEventReader(new UnsyncStringReader(xml));
    while (xmlEventReader.hasNext()) {
      XMLEvent xmlEvent=xmlEventReader.nextEvent();
      if (xmlEvent.isStartElement()) {
        StartElement startElement=xmlEvent.asStartElement();
        String elementName=startElement.getName().getLocalPart();
        if ("preference".equals(elementName)) {
          Preference preference=_readPreference(xmlEventReader);
          preferencesMap.put(preference.getName(),preference);
        }
      }
    }
    return preferences;
  }
 catch (  XMLStreamException xse) {
    throw new SystemException(xse);
  }
 finally {
    if (xmlEventReader != null) {
      try {
        xmlEventReader.close();
      }
 catch (      XMLStreamException e) {
      }
    }
  }
}
