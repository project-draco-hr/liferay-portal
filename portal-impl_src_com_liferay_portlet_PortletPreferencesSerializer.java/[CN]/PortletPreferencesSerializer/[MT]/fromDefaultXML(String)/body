{
  PortletPreferencesImpl prefs=new PortletPreferencesImpl();
  if (Validator.isNull(xml)) {
    return prefs;
  }
  Map<String,Preference> preferences=prefs.getPreferences();
  try {
    Document doc=SAXReaderUtil.read(xml);
    Element root=doc.getRootElement();
    Iterator<Element> itr1=root.elements("preference").iterator();
    while (itr1.hasNext()) {
      Element prefEl=itr1.next();
      String name=prefEl.elementTextTrim("name");
      List<String> values=new ArrayList<String>();
      Iterator<Element> itr2=prefEl.elements("value").iterator();
      while (itr2.hasNext()) {
        Element valueEl=itr2.next();
        values.add(valueEl.getTextTrim());
      }
      boolean readOnly=GetterUtil.getBoolean(prefEl.elementText("read-only"));
      Preference preference=new Preference(name,values.toArray(new String[values.size()]),readOnly);
      preferences.put(name,preference);
    }
    return prefs;
  }
 catch (  DocumentException de) {
    throw new SystemException(de);
  }
}
