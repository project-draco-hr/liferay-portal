{
  Map<String,Preference> preferencesMap=preferences.getPreferences();
  Element portletPreferencesElement=new Element("portlet-preferences",false);
  Iterator<Map.Entry<String,Preference>> itr=preferencesMap.entrySet().iterator();
  while (itr.hasNext()) {
    Map.Entry<String,Preference> entry=itr.next();
    Preference preference=entry.getValue();
    Element preferenceElement=portletPreferencesElement.addElement("preference");
    preferenceElement.addElement("name",preference.getName());
    for (    String value : preference.getValues()) {
      preferenceElement.addElement("value",value);
    }
    if (preference.isReadOnly()) {
      preferenceElement.addElement("read-only",Boolean.TRUE);
    }
  }
  return portletPreferencesElement.toXMLString();
}
