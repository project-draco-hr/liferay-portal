{
  Map<String,Preference> preferencesMap=preferences.getPreferences();
  Element portletPreferences=SAXReaderUtil.createElement("portlet-preferences");
  Iterator<Map.Entry<String,Preference>> itr=preferencesMap.entrySet().iterator();
  while (itr.hasNext()) {
    Map.Entry<String,Preference> entry=itr.next();
    Preference preference=entry.getValue();
    Element prefEl=SAXReaderUtil.createElement("preference");
    Element nameEl=SAXReaderUtil.createElement("name");
    nameEl.addText(preference.getName());
    prefEl.add(nameEl);
    String[] values=preference.getValues();
    for (int i=0; i < values.length; i++) {
      Element valueEl=SAXReaderUtil.createElement("value");
      valueEl.addText(values[i]);
      prefEl.add(valueEl);
    }
    if (preference.isReadOnly()) {
      Element valueEl=SAXReaderUtil.createElement("read-only");
      valueEl.addText("true");
      prefEl.add(valueEl);
    }
    portletPreferences.add(prefEl);
  }
  return portletPreferences.asXML();
}
