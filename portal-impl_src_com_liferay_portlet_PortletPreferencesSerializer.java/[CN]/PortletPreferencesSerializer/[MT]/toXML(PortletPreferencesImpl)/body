{
  Map<String,Preference> preferencesMap=preferences.getPreferences();
  Element portletPreferences=new Element("portlet-preferences",false);
  Iterator<Map.Entry<String,Preference>> itr=preferencesMap.entrySet().iterator();
  while (itr.hasNext()) {
    Map.Entry<String,Preference> entry=itr.next();
    Preference preference=entry.getValue();
    Element prefEl=portletPreferences.addElement("preference");
    prefEl.addElement("name",preference.getName());
    for (    String value : preference.getValues()) {
      prefEl.addElement("value",value);
    }
    if (preference.isReadOnly()) {
      prefEl.addElement("read-only","true");
    }
  }
  return portletPreferences.toXMLString();
}
