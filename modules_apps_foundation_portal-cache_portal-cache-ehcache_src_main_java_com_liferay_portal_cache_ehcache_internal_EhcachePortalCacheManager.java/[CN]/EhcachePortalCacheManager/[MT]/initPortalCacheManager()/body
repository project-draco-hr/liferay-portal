{
  setBlockingPortalCacheAllowed(GetterUtil.getBoolean(props.get(PropsKeys.EHCACHE_BLOCKING_CACHE_ALLOWED)));
  setTransactionalPortalCacheEnabled(GetterUtil.getBoolean(props.get(PropsKeys.TRANSACTIONAL_CACHE_ENABLED)));
  setTransactionalPortalCacheNames(GetterUtil.getStringValues(props.getArray(PropsKeys.TRANSACTIONAL_CACHE_NAMES)));
  if (Validator.isNull(_configFile)) {
    _configFile=_defaultConfigFile;
  }
  URL configFileURL=BaseEhcachePortalCacheManagerConfigurator.class.getResource(_configFile);
  if (configFileURL == null) {
    ClassLoader classLoader=PortalClassLoaderUtil.getClassLoader();
    configFileURL=classLoader.getResource(_configFile);
  }
  _usingDefault=_configFile.equals(_defaultConfigFile);
  ObjectValuePair<Configuration,PortalCacheManagerConfiguration> configurationObjectValuePair=baseEhcachePortalCacheManagerConfigurator.getConfigurationObjectValuePair(getPortalCacheManagerName(),configFileURL,_usingDefault);
  _cacheManager=new CacheManager(configurationObjectValuePair.getKey());
  _portalCacheManagerConfiguration=configurationObjectValuePair.getValue();
  if (_stopCacheManagerTimer) {
    FailSafeTimer failSafeTimer=_cacheManager.getTimer();
    failSafeTimer.cancel();
    try {
      Field cacheManagerTimerField=ReflectionUtil.getDeclaredField(CacheManager.class,"cacheManagerTimer");
      cacheManagerTimerField.set(_cacheManager,null);
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
  }
  CacheManagerEventListenerRegistry cacheManagerEventListenerRegistry=_cacheManager.getCacheManagerEventListenerRegistry();
  cacheManagerEventListenerRegistry.registerListener(new PortalCacheManagerEventListener(aggregatedPortalCacheManagerListener));
  if (GetterUtil.getBoolean(props.get(PropsKeys.EHCACHE_PORTAL_CACHE_MANAGER_JMX_ENABLED))) {
    _managementService=new ManagementService(_cacheManager,mBeanServer,_registerCacheManager,_registerCaches,_registerCacheConfigurations,_registerCacheStatistics);
    _managementService.init();
  }
}
