{
  if (ImportExportThreadLocal.isImportInProcess()) {
    return;
  }
  if ((activity.getActivityId() > 0) || ((mirrorActivity != null) && (mirrorActivity.getActivityId() > 0))) {
    throw new PortalException("Activity and mirror activity must not have primary keys set");
  }
  SocialActivityDefinition activityDefinition=socialActivitySettingLocalService.getActivityDefinition(activity.getGroupId(),activity.getClassName(),activity.getType());
  if (((activityDefinition == null) && (activity.getType() < 10000)) || ((activityDefinition != null) && activityDefinition.isLogActivity())) {
    long activityId=counterLocalService.increment(SocialActivity.class.getName());
    activity.setActivityId(activityId);
    socialActivityPersistence.update(activity);
    if (mirrorActivity != null) {
      long mirrorActivityId=counterLocalService.increment(SocialActivity.class.getName());
      mirrorActivity.setActivityId(mirrorActivityId);
      mirrorActivity.setMirrorActivityId(activity.getPrimaryKey());
      socialActivityPersistence.update(mirrorActivity);
    }
  }
  socialActivityCounterLocalService.addActivityCounters(activity);
}
