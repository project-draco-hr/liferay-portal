{
  if (thread.isInTrash()) {
    throw new TrashEntryException();
  }
  if (thread.getCategoryId() == MBCategoryConstants.DISCUSSION_CATEGORY_ID) {
    return thread;
  }
  int oldStatus=thread.getStatus();
  if (oldStatus == WorkflowConstants.STATUS_PENDING) {
    thread.setStatus(WorkflowConstants.STATUS_DRAFT);
    mbThreadPersistence.update(thread);
  }
  thread=updateStatus(userId,thread.getThreadId(),WorkflowConstants.STATUS_IN_TRASH);
  TrashEntry trashEntry=trashEntryLocalService.addTrashEntry(userId,thread.getGroupId(),MBThread.class.getName(),thread.getThreadId(),thread.getUuid(),null,oldStatus,null,null);
  moveDependentsToTrash(thread.getGroupId(),thread.getThreadId(),trashEntry.getEntryId());
  MBMessage message=mbMessageLocalService.getMBMessage(thread.getRootMessageId());
  JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
  extraDataJSONObject.put("rootMessageId",thread.getRootMessageId());
  extraDataJSONObject.put("title",message.getSubject());
  SocialActivityManagerUtil.addActivity(userId,thread,SocialActivityConstants.TYPE_MOVE_TO_TRASH,extraDataJSONObject.toString(),0);
  return thread;
}
