{
  MBMessage rootMessage=mbMessagePersistence.findByPrimaryKey(thread.getRootMessageId());
  try {
    Indexer.deleteMessages(rootMessage.getCompanyId(),thread.getThreadId());
  }
 catch (  IOException ioe) {
    _log.error("Deleting index " + thread.getThreadId(),ioe);
  }
catch (  ParseException pe) {
    _log.error("Deleting index " + thread.getThreadId(),pe);
  }
  long companyId=rootMessage.getCompanyId();
  String portletId=CompanyImpl.SYSTEM_STRING;
  long repositoryId=CompanyImpl.SYSTEM;
  String dirName=thread.getAttachmentsDir();
  try {
    dlService.deleteDirectory(companyId,portletId,repositoryId,dirName);
  }
 catch (  NoSuchDirectoryException nsde) {
  }
catch (  RemoteException re) {
    throw new SystemException(re);
  }
  Iterator itr=mbMessagePersistence.findByThreadId(thread.getThreadId()).iterator();
  while (itr.hasNext()) {
    MBMessage message=(MBMessage)itr.next();
    tagsAssetLocalService.deleteAsset(MBMessage.class.getName(),message.getMessageId());
    mbMessageFlagPersistence.removeByMessageId(message.getMessageId());
    if (!message.isDiscussion()) {
      resourceLocalService.deleteResource(message.getCompanyId(),MBMessage.class.getName(),ResourceImpl.SCOPE_INDIVIDUAL,message.getMessageId());
    }
    mbMessagePersistence.remove(message.getMessageId());
  }
  mbThreadPersistence.remove(thread.getThreadId());
}
