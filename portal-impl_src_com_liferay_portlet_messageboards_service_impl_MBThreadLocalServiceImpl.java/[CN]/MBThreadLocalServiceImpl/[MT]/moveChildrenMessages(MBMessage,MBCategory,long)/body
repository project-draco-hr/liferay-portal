{
  List<MBMessage> messages=mbMessagePersistence.findByT_P(oldThreadId,parentMessage.getMessageId());
  for (  MBMessage message : messages) {
    message.setCategoryId(parentMessage.getCategoryId());
    message.setThreadId(parentMessage.getThreadId());
    message.setRootMessageId(parentMessage.getRootMessageId());
    mbMessagePersistence.update(message);
    if (!message.isDiscussion()) {
      Indexer<MBMessage> indexer=IndexerRegistryUtil.nullSafeGetIndexer(MBMessage.class);
      indexer.reindex(message);
    }
    moveChildrenMessages(message,category,oldThreadId);
  }
}
