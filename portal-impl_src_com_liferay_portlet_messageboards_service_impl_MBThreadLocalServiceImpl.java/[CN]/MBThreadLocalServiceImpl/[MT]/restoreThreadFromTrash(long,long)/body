{
  MBThread thread=getThread(threadId);
  if (!thread.isInTrash()) {
    throw new RestoreEntryException(RestoreEntryException.INVALID_STATUS);
  }
  if (thread.getCategoryId() == MBCategoryConstants.DISCUSSION_CATEGORY_ID) {
    return;
  }
  TrashEntry trashEntry=trashEntryLocalService.getEntry(MBThread.class.getName(),threadId);
  updateStatus(userId,threadId,trashEntry.getStatus());
  restoreDependentsFromTrash(thread.getGroupId(),threadId);
  trashEntryLocalService.deleteEntry(trashEntry.getEntryId());
  MBMessage message=mbMessageLocalService.getMBMessage(thread.getRootMessageId());
  JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
  extraDataJSONObject.put("rootMessageId",thread.getRootMessageId());
  extraDataJSONObject.put("title",message.getSubject());
  SocialActivityManagerUtil.addActivity(userId,thread,SocialActivityConstants.TYPE_RESTORE_FROM_TRASH,extraDataJSONObject.toString(),0);
}
