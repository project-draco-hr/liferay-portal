{
  long repositoryId=CompanyConstants.SYSTEM;
  StringBundler sb=new StringBundler(4);
  sb.append(newAttachmentsDir);
  sb.append(StringPool.SLASH);
  sb.append(StringUtil.extractLast(fileName,StringPool.SLASH));
  String newFileName=sb.toString();
  try {
    File file=DLStoreUtil.getFile(companyId,repositoryId,fileName);
    DLStoreUtil.addFile(companyId,repositoryId,newFileName,false,file);
  }
 catch (  UnsupportedOperationException uoe) {
    InputStream is=DLStoreUtil.getFileAsStream(companyId,repositoryId,fileName);
    try {
      DLStoreUtil.addFile(companyId,repositoryId,newFileName,false,is);
    }
  finally {
      try {
        is.close();
      }
 catch (      IOException ioe) {
        _log.error(ioe);
      }
    }
  }
  DLStoreUtil.deleteFile(companyId,repositoryId,fileName);
}
