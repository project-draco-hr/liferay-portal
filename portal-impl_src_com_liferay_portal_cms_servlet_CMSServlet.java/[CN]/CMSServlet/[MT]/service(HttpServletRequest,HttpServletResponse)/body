{
  long groupId=_groupId;
  if (groupId <= 0) {
    groupId=ParamUtil.getLong(req,"groupId");
  }
  String path=GetterUtil.getString(req.getPathInfo());
  if (path.endsWith(StringPool.SLASH)) {
    path=path.substring(0,path.length() - 1);
  }
  if (path.startsWith(StringPool.SLASH)) {
    path=path.substring(1,path.length());
  }
  if ((_redirectProperties != null) && _redirectsEnabled) {
    String redirect=_redirectProperties.getProperty(path);
    if (Validator.isNotNull(redirect)) {
      res.sendRedirect(redirect);
      return;
    }
  }
  String languageId=LanguageUtil.getLanguageId(req);
  ThemeDisplay themeDisplay=null;
  try {
    themeDisplay=ThemeDisplayFactory.create();
    long companyId=PortalInstances.getCompanyId(req);
    Company company=CompanyLocalServiceUtil.getCompanyById(companyId);
    String contextPath=PortalUtil.getPathContext();
    themeDisplay.setCompany(company);
    themeDisplay.setPortletGroupId(groupId);
    themeDisplay.setPathContext(contextPath);
    themeDisplay.setPathFriendlyURLPrivateGroup(PortalUtil.getPathFriendlyURLPrivateGroup());
    themeDisplay.setPathFriendlyURLPrivateUser(PortalUtil.getPathFriendlyURLPrivateUser());
    themeDisplay.setPathFriendlyURLPublic(PortalUtil.getPathFriendlyURLPublic());
    themeDisplay.setPathImage(PortalUtil.getPathImage());
    themeDisplay.setPathMain(PortalUtil.getPathMain());
    String content=getContent(groupId,path,languageId,themeDisplay);
    if (Validator.isNotNull(content)) {
      if (_log.isDebugEnabled()) {
        _log.debug("Content found for " + path);
      }
      String mimeType=ParamUtil.getString(req,"mimeType",ContentTypes.TEXT_HTML_UTF8);
      res.setContentType(mimeType);
      try {
        ServletResponseUtil.write(res,content);
      }
 catch (      Exception e) {
        if (_log.isWarnEnabled()) {
          _log.warn(e,e);
        }
      }
    }
 else {
      if (_log.isDebugEnabled()) {
        _log.debug("Content NOT found for " + path);
      }
    }
  }
 catch (  Exception e) {
  }
 finally {
    try {
      ThemeDisplayFactory.recycle(themeDisplay);
    }
 catch (    Exception e) {
    }
  }
}
