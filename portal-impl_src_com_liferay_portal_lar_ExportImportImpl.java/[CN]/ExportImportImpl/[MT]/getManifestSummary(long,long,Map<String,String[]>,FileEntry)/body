{
  File file=DLFileEntryLocalServiceUtil.getFile(userId,fileEntry.getFileEntryId(),fileEntry.getVersion(),false);
  boolean successfulRename=false;
  File newFile=null;
  ManifestSummary manifestSummary=null;
  try {
    String newFileName=StringUtil.replace(file.getPath(),file.getName(),fileEntry.getTitle());
    newFile=new File(newFileName);
    successfulRename=file.renameTo(newFile);
    if (!successfulRename) {
      newFile=FileUtil.createTempFile(fileEntry.getExtension());
      FileUtil.copyFile(file,newFile);
    }
    manifestSummary=getManifestSummary(userId,groupId,parameterMap,newFile);
  }
  finally {
    if (successfulRename) {
      newFile.renameTo(file);
    }
 else {
      FileUtil.delete(newFile);
    }
  }
  return manifestSummary;
}
