{
  try {
    ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
    String companyId=themeDisplay.getCompanyId();
    String folderId=ParamUtil.getString(req,"folderId");
    String name=ParamUtil.getString(req,"name");
    double version=ParamUtil.getDouble(req,"version");
    DLFileEntryPermission.check(themeDisplay.getPermissionChecker(),folderId,name,ActionKeys.VIEW);
    InputStream is=null;
    if (version > 0) {
      is=DLFileEntryLocalServiceUtil.getFileAsStream(companyId,req.getRemoteUser(),folderId,name,version);
    }
 else {
      is=DLFileEntryLocalServiceUtil.getFileAsStream(companyId,req.getRemoteUser(),folderId,name);
    }
    HttpServletResponse httpRes=((ActionResponseImpl)res).getHttpServletResponse();
    ServletResponseUtil.sendFile(httpRes,name,is);
  }
 catch (  Exception e) {
    _log.error(e);
  }
}
