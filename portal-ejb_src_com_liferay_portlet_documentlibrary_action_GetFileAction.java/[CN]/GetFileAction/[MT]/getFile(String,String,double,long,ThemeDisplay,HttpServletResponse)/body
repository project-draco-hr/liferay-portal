{
  String companyId=themeDisplay.getCompanyId();
  String userId=themeDisplay.getUserId();
  if (fileShortcutId == 0) {
    DLFileEntryPermission.check(themeDisplay.getPermissionChecker(),folderId,name,ActionKeys.VIEW);
  }
 else {
    DLFileShortcut fileShortcut=DLFileShortcutServiceUtil.getFileShortcut(fileShortcutId);
    folderId=fileShortcut.getToFolderId();
    name=fileShortcut.getToName();
  }
  InputStream is=null;
  if (version > 0) {
    is=DLFileEntryLocalServiceUtil.getFileAsStream(companyId,userId,folderId,name,version);
  }
 else {
    is=DLFileEntryLocalServiceUtil.getFileAsStream(companyId,userId,folderId,name);
  }
  ServletResponseUtil.sendFile(res,name,is);
}
