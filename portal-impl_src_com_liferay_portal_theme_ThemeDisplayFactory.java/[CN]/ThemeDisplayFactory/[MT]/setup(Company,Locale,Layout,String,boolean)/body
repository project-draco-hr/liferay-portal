{
  long companyId=company.getCompanyId();
  String serverName=company.getVirtualHost();
  int serverPort=PortalUtil.getPortalPort();
  boolean secure=false;
  String contextPath=PortalUtil.getPathContext();
  String friendlyURLPrivateGroupPath=PortalUtil.getPathFriendlyURLPrivateGroup();
  String friendlyURLPrivateUserPath=PortalUtil.getPathFriendlyURLPrivateUser();
  String friendlyURLPublicPath=PortalUtil.getPathFriendlyURLPublic();
  String imagePath=PortalUtil.getPathImage();
  String mainPath=PortalUtil.getPathMain();
  String companyLogo=imagePath + "/company_logo?img_id=" + company.getLogoId()+ "&t="+ ImageServletTokenUtil.getToken(company.getLogoId());
  Image companyLogoImage=ImageLocalUtil.getCompanyLogo(company.getLogoId());
  int companyLogoHeight=companyLogoImage.getHeight();
  int companyLogoWidth=companyLogoImage.getWidth();
  String realCompanyLogo=companyLogo;
  int realCompanyLogoHeight=companyLogoHeight;
  int realCompanyLogoWidth=companyLogoWidth;
  String layoutSetLogo=null;
  if (layout != null) {
    if (company.isCommunityLogo()) {
      LayoutSet layoutSet=layout.getLayoutSet();
      if (layoutSet.isLogo()) {
        long logoId=layoutSet.getLogoId();
        layoutSetLogo=imagePath + "/layout_set_logo?img_id=" + logoId+ "&t="+ ImageServletTokenUtil.getToken(logoId);
        Image layoutSetLogoImage=ImageLocalUtil.getCompanyLogo(logoId);
        companyLogo=layoutSetLogo;
        companyLogoHeight=layoutSetLogoImage.getHeight();
        companyLogoWidth=layoutSetLogoImage.getWidth();
      }
    }
  }
  Theme theme=null;
  ColorScheme colorScheme=null;
  if (layout != null) {
    if (wapTheme) {
      theme=layout.getWapTheme();
      colorScheme=layout.getWapColorScheme();
    }
 else {
      theme=layout.getTheme();
      colorScheme=layout.getColorScheme();
    }
  }
 else {
    String themeId=null;
    String colorSchemeId=null;
    if (wapTheme) {
      themeId=ThemeImpl.getDefaultWapThemeId();
      colorSchemeId=ColorSchemeImpl.getDefaultWapColorSchemeId();
    }
 else {
      themeId=ThemeImpl.getDefaultRegularThemeId();
      colorSchemeId=ColorSchemeImpl.getDefaultRegularColorSchemeId();
    }
    theme=ThemeLocalUtil.getTheme(companyId,themeId,wapTheme);
    colorScheme=ThemeLocalUtil.getColorScheme(companyId,theme.getThemeId(),colorSchemeId,wapTheme);
  }
  ThemeDisplay themeDisplay=null;
  try {
    themeDisplay=create();
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
  themeDisplay.setCDNHost(cdnHost);
  themeDisplay.setCompany(company);
  themeDisplay.setCompanyLogo(companyLogo);
  themeDisplay.setCompanyLogoHeight(companyLogoHeight);
  themeDisplay.setCompanyLogoWidth(companyLogoWidth);
  themeDisplay.setRealCompanyLogo(realCompanyLogo);
  themeDisplay.setRealCompanyLogoHeight(realCompanyLogoHeight);
  themeDisplay.setRealCompanyLogoWidth(realCompanyLogoWidth);
  themeDisplay.setLayoutSetLogo(layoutSetLogo);
  themeDisplay.setLayout(layout);
  themeDisplay.setLocale(locale);
  themeDisplay.setLanguageId(LocaleUtil.toLanguageId(locale));
  themeDisplay.setLookAndFeel(contextPath,theme,colorScheme);
  themeDisplay.setServerName(serverName);
  themeDisplay.setServerPort(serverPort);
  themeDisplay.setSecure(secure);
  themeDisplay.setPathApplet(contextPath + "/applets");
  themeDisplay.setPathCms(contextPath + "/cms");
  themeDisplay.setPathContext(contextPath);
  themeDisplay.setPathFlash(contextPath + "/flash");
  themeDisplay.setPathFriendlyURLPrivateGroup(friendlyURLPrivateGroupPath);
  themeDisplay.setPathFriendlyURLPrivateUser(friendlyURLPrivateUserPath);
  themeDisplay.setPathFriendlyURLPublic(friendlyURLPublicPath);
  themeDisplay.setPathImage(imagePath);
  themeDisplay.setPathJavaScript(cdnHost + contextPath + "/html/js");
  themeDisplay.setPathMain(mainPath);
  themeDisplay.setPathSound(contextPath + "/html/sound");
  themeDisplay.setURLPortal(PortalUtil.getPortalURL(serverName,serverPort,secure));
  return themeDisplay;
}
