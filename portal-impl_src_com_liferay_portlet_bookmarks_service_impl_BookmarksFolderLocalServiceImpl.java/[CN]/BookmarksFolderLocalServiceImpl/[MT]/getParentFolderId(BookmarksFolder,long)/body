{
  if (parentFolderId == BookmarksFolderImpl.DEFAULT_PARENT_FOLDER_ID) {
    return parentFolderId;
  }
  if (folder.getFolderId() == parentFolderId) {
    return folder.getParentFolderId();
  }
 else {
    BookmarksFolder parentFolder=bookmarksFolderPersistence.fetchByPrimaryKey(parentFolderId);
    if ((parentFolder == null) || (folder.getGroupId() != parentFolder.getGroupId())) {
      return folder.getParentFolderId();
    }
    List subfolderIds=new ArrayList();
    getSubfolderIds(subfolderIds,folder.getGroupId(),folder.getFolderId());
    if (subfolderIds.contains(new Long(parentFolderId))) {
      return folder.getParentFolderId();
    }
    return parentFolderId;
  }
}
