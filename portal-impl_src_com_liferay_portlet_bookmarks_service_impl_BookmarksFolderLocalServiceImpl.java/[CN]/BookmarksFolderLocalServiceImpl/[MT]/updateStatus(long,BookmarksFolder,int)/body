{
  User user=userPersistence.findByPrimaryKey(userId);
  int oldStatus=folder.getStatus();
  folder.setStatus(status);
  folder.setStatusByUserId(userId);
  folder.setStatusByUserName(user.getFullName());
  folder.setStatusDate(new Date());
  bookmarksFolderPersistence.update(folder);
  List<Object> foldersAndEntries=bookmarksFolderLocalService.getFoldersAndEntries(folder.getGroupId(),folder.getFolderId());
  updateDependentStatus(foldersAndEntries,status);
  if (status == WorkflowConstants.STATUS_APPROVED) {
    assetEntryLocalService.updateVisible(BookmarksFolder.class.getName(),folder.getFolderId(),true);
  }
 else   if (status == WorkflowConstants.STATUS_IN_TRASH) {
    assetEntryLocalService.updateVisible(BookmarksFolder.class.getName(),folder.getFolderId(),false);
  }
  if (oldStatus == WorkflowConstants.STATUS_IN_TRASH) {
    trashEntryLocalService.deleteEntry(BookmarksFolder.class.getName(),folder.getFolderId());
  }
 else   if (status == WorkflowConstants.STATUS_IN_TRASH) {
    trashEntryLocalService.addTrashEntry(userId,folder.getGroupId(),BookmarksFolder.class.getName(),folder.getFolderId(),oldStatus,null,null);
  }
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(BookmarksFolder.class);
  indexer.reindex(folder);
  return folder;
}
