{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  validate(title,content);
  Date displayDate=PortalUtil.getDate(displayMonth,displayDay,displayYear,new AnnouncementDisplayDateException());
  Date expirationDate=PortalUtil.getDate(expirationMonth,expirationDay,expirationYear,new AnnouncementExpirationDateException());
  long announcementId=counterLocalService.increment();
  Announcement announcement=announcementPersistence.create(announcementId);
  announcement.setCompanyId(user.getCompanyId());
  announcement.setUserId(user.getUserId());
  announcement.setUserName(user.getFullName());
  announcement.setCreateDate(now);
  announcement.setModifiedDate(now);
  announcement.setClassNameId(classNameId);
  announcement.setClassPK(classPK);
  announcement.setTitle(title);
  announcement.setContent(content);
  announcement.setUrl(url);
  announcement.setType(type);
  announcement.setDisplayDate(displayDate);
  announcement.setExpirationDate(expirationDate);
  announcement.setPriority(priority);
  announcement.setAlert(alert);
  announcementPersistence.update(announcement);
  resourceLocalService.addResources(user.getCompanyId(),0,user.getUserId(),Announcement.class.getName(),announcement.getAnnouncementId(),false,false,false);
  return announcement;
}
