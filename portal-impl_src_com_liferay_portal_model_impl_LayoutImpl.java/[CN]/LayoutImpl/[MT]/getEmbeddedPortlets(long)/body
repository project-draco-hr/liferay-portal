{
  List<Portlet> portlets=new ArrayList<>();
  List<PortletPreferences> portletPreferences=PortletPreferencesLocalServiceUtil.getPortletPreferences(groupId,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,PortletKeys.PREFS_PLID_SHARED);
  if (isTypePortlet()) {
    LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)getLayoutType();
    PortalPreferences portalPreferences=layoutTypePortlet.getPortalPreferences();
    if (layoutTypePortlet.isCustomizable() && (portalPreferences != null)) {
      portletPreferences=ListUtil.copy(portletPreferences);
      portletPreferences.addAll(PortletPreferencesLocalServiceUtil.getPortletPreferences(portalPreferences.getUserId(),PortletKeys.PREFS_OWNER_TYPE_USER,getPlid()));
    }
  }
  for (  PortletPreferences portletPreference : portletPreferences) {
    String portletId=portletPreference.getPortletId();
    Portlet portlet=PortletLocalServiceUtil.getPortletById(getCompanyId(),portletId);
    if ((portlet == null) || !portlet.isReady() || portlet.isUndeployedPortlet()|| !portlet.isActive()) {
      continue;
    }
    Portlet embeddedPortlet=portlet;
    if (portlet.isInstanceable()) {
    }
 else {
      embeddedPortlet=(Portlet)embeddedPortlet.clone();
    }
    embeddedPortlet.setStatic(true);
    portlets.add(embeddedPortlet);
  }
  return portlets;
}
