{
  List<PortletPreferences> portletPreferences=_getPortletPreferences(groupId);
  if (portletPreferences.isEmpty()) {
    return Collections.emptyList();
  }
  List<Portlet> portlets=new ArrayList<>();
  Set<String> layoutPortletIds=_getLayoutPortletIds();
  for (  PortletPreferences portletPreference : portletPreferences) {
    String portletId=portletPreference.getPortletId();
    Portlet portlet=PortletLocalServiceUtil.getPortletById(getCompanyId(),portletId);
    if ((portlet == null) || !portlet.isReady() || portlet.isUndeployedPortlet()|| !portlet.isActive()|| !layoutPortletIds.contains(portletId)) {
      continue;
    }
    Portlet embeddedPortlet=portlet;
    if (portlet.isInstanceable()) {
    }
 else {
      embeddedPortlet=(Portlet)embeddedPortlet.clone();
    }
    embeddedPortlet.setStatic(true);
    portlets.add(embeddedPortlet);
  }
  return portlets;
}
