{
  List<PortletPreferences> portletPreferences=PortletPreferencesLocalServiceUtil.getPortletPreferences(groupId,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,PortletKeys.PREFS_PLID_SHARED);
  if (isTypePortlet()) {
    LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)getLayoutType();
    PortalPreferences portalPreferences=layoutTypePortlet.getPortalPreferences();
    if ((portalPreferences != null) && layoutTypePortlet.isCustomizable()) {
      portletPreferences=ListUtil.copy(portletPreferences);
      portletPreferences.addAll(PortletPreferencesLocalServiceUtil.getPortletPreferences(portalPreferences.getUserId(),PortletKeys.PREFS_OWNER_TYPE_USER,getPlid()));
    }
  }
  return portletPreferences;
}
