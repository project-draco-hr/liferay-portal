{
  if (Validator.isNull(xml) || (xml.indexOf("<root") == -1)) {
    xml="<root />";
  }
  String localeLanguageId=LocaleUtil.toLanguageId(locale);
  String defaultLanguageId=LocaleUtil.toLanguageId(Locale.getDefault());
  SAXReader reader=new SAXReader();
  Document doc=reader.read(new StringReader(xml));
  Element root=doc.getRootElement();
  String availableLocales=root.attributeValue("available-locales");
  Element localeEl=null;
  Iterator itr=root.elements().iterator();
  while (itr.hasNext()) {
    Element el=(Element)itr.next();
    String languageId=el.attributeValue("language-id",defaultLanguageId);
    if (languageId.equals(localeLanguageId)) {
      localeEl=el;
      break;
    }
  }
  if (localeEl != null) {
    localeEl.setText(value);
  }
 else {
    localeEl=root.addElement(key);
    if (!localeLanguageId.equals(defaultLanguageId)) {
      localeEl.addAttribute("language-id",localeLanguageId);
      if (availableLocales == null) {
        availableLocales=defaultLanguageId;
      }
      availableLocales+=StringPool.COMMA + localeLanguageId;
      root.addAttribute("available-locales",availableLocales);
    }
    localeEl.setText(value);
  }
  return XMLFormatter.toString(doc,"  ");
}
