{
  long userId=portletDataContext.getUserId(recordSet.getUserUuid());
  Map<Long,Long> ddmStructureIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(DDMStructure.class);
  long ddmStructureId=MapUtil.getLong(ddmStructureIds,recordSet.getDDMStructureId(),recordSet.getDDMStructureId());
  Element recordSetElement=portletDataContext.getImportDataElement(recordSet);
  ServiceContext serviceContext=portletDataContext.createServiceContext(recordSet);
  DDLRecordSet importedRecordSet=null;
  if (portletDataContext.isDataStrategyMirror()) {
    DDLRecordSet existingRecordSet=fetchStagedModelByUuidAndGroupId(recordSet.getUuid(),portletDataContext.getScopeGroupId());
    if (existingRecordSet == null) {
      serviceContext.setUuid(recordSet.getUuid());
      importedRecordSet=_ddlRecordSetLocalService.addRecordSet(userId,portletDataContext.getScopeGroupId(),ddmStructureId,recordSet.getRecordSetKey(),recordSet.getNameMap(),recordSet.getDescriptionMap(),recordSet.getMinDisplayRows(),recordSet.getScope(),serviceContext);
    }
 else {
      importedRecordSet=_ddlRecordSetLocalService.updateRecordSet(existingRecordSet.getRecordSetId(),ddmStructureId,recordSet.getNameMap(),recordSet.getDescriptionMap(),recordSet.getMinDisplayRows(),serviceContext);
    }
  }
 else {
    importedRecordSet=_ddlRecordSetLocalService.addRecordSet(userId,portletDataContext.getScopeGroupId(),ddmStructureId,recordSet.getRecordSetKey(),recordSet.getNameMap(),recordSet.getDescriptionMap(),recordSet.getMinDisplayRows(),recordSet.getScope(),serviceContext);
  }
  if (recordSet.getScope() == DDLRecordSetConstants.SCOPE_FORMS) {
    DDMFormValues settingsDDMFormValues=getImportRecordSetSettings(portletDataContext,recordSetElement);
    _ddlRecordSetLocalService.updateRecordSet(importedRecordSet.getRecordSetId(),settingsDDMFormValues);
  }
  portletDataContext.importClassedModel(recordSet,importedRecordSet);
}
