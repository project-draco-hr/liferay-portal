{
  String contentType=getContentType(fileName);
  if (!contentType.equals(ContentTypes.APPLICATION_OCTET_STREAM)) {
    return contentType;
  }
  List<MimeType> mimeTypes=new ArrayList<MimeType>(MimeUtil.getMimeTypes(inputStream));
  MimeType mimeType=mimeTypes.get(0);
  if ((mimeTypes.size() > 1) && (mimeType instanceof TextMimeType)) {
    mimeType=mimeTypes.get(1);
  }
  contentType=mimeType.getMediaType() + StringPool.SLASH + mimeType.getSubType();
  if (contentType.equals(ContentTypes.APPLICATION_OCTET_STREAM)) {
    contentType=getContentType(fileName);
  }
 else   if (contentType.equals(ContentTypes.APPLICATION_ZIP)) {
    String contentTypeByFileName=getContentType(fileName);
    if (contentTypeByFileName.contains("vnd.openxmlformats")) {
      contentType=contentTypeByFileName;
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Content type " + contentType + " returned for "+ fileName);
  }
  return contentType;
}
