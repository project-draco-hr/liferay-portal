{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long userId=permissionChecker.getUserId();
  User user=null;
  try {
    user=UserLocalServiceUtil.getUser(userId);
  }
 catch (  Exception e) {
  }
  if ((user != null) && !user.isDefaultUser()) {
    PortalUtil.sendError(HttpServletResponse.SC_UNAUTHORIZED,(Exception)t,request,response);
    return;
  }
  String redirect=request.getContextPath() + Portal.PATH_MAIN + "/portal/login";
  String currentURL=PortalUtil.getCurrentURL(request);
  redirect=HttpUtil.addParameter(redirect,"redirect",currentURL);
  response.sendRedirect(redirect);
}
