{
  PoolProperties poolProperties=new PoolProperties();
  for (  Map.Entry<Object,Object> entry : properties.entrySet()) {
    String key=(String)entry.getKey();
    String value=(String)entry.getValue();
    if (isPropertyLiferay(key)) {
      continue;
    }
    if (isPropertyHikariCP(key)) {
      continue;
    }
    if (isPropertyC3PO(key)) {
      continue;
    }
    try {
      BeanUtil.setProperty(poolProperties,key,value);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Property " + key + " is not a valid Tomcat JDBC "+ "Connection Pool property");
      }
    }
  }
  String poolName=StringUtil.randomString();
  poolProperties.setName(poolName);
  org.apache.tomcat.jdbc.pool.DataSource dataSource=new org.apache.tomcat.jdbc.pool.DataSource(poolProperties);
  if (poolProperties.isJmxEnabled()) {
    org.apache.tomcat.jdbc.pool.ConnectionPool jdbcConnectionPool=dataSource.createPool();
    ConnectionPool jmxConnectionPool=jdbcConnectionPool.getJmxPool();
    MBeanServer mBeanServer=ManagementFactory.getPlatformMBeanServer();
    ObjectName objectName=new ObjectName(_TOMCAT_JDBC_POOL_OBJECT_NAME_PREFIX + poolName);
    mBeanServer.registerMBean(jmxConnectionPool,objectName);
  }
  return dataSource;
}
