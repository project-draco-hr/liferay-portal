{
  LogWrapper logWrapper=(LogWrapper)LogFactoryUtil.getLog(name);
  Log log=logWrapper.getLog();
  if (!(log instanceof Log4jLogImpl)) {
    throw new IllegalStateException("Log " + name + " is not a log4j logger");
  }
  Log4jLogImpl log4jLogImpl=(Log4jLogImpl)log;
  Logger logger=log4jLogImpl.getLog();
  CaptureAppender captureAppender=new CaptureAppender(logger);
  logger.addAppender(captureAppender);
  logger.setLevel(level);
  return captureAppender;
}
