{
  List<BBCodeItem> bbCodeItems=new ArrayList<BBCodeItem>();
  BBCodeLexer bbCodeLexer=new BBCodeLexer(text);
  Stack<String> tags=new Stack<String>();
  IntegerWrapper marker=new IntegerWrapper();
  BBCodeToken bbCodeToken=null;
  while ((bbCodeToken=bbCodeLexer.getNextBBCodeToken()) != null) {
    handleData(bbCodeItems,bbCodeLexer,marker,bbCodeToken,text);
    if (bbCodeToken.getStartTag() == null) {
      handleTagEnd(bbCodeItems,tags,bbCodeToken);
      continue;
    }
    handleTagStart(bbCodeItems,tags,bbCodeToken);
    String startTag=bbCodeToken.getStartTag();
    if (!startTag.equals("code")) {
      continue;
    }
    while (true) {
      bbCodeToken=bbCodeLexer.getNextBBCodeToken();
      if (bbCodeToken == null) {
        break;
      }
      String endTag=bbCodeToken.getEndTag();
      if ("code".equals(endTag)) {
        break;
      }
    }
    handleData(bbCodeItems,bbCodeLexer,marker,bbCodeToken,text);
    if (bbCodeToken != null) {
      handleTagEnd(bbCodeItems,tags,bbCodeToken);
    }
 else {
      break;
    }
  }
  handleData(bbCodeItems,bbCodeLexer,marker,null,text);
  handleTagEnd(bbCodeItems,tags,null);
  return bbCodeItems;
}
