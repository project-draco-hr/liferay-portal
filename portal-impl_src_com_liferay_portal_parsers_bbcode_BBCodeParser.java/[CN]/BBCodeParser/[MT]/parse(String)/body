{
  _lexer=new BBCodeLexer(text);
  _tagsStack=new Stack();
  _itemsList=new ArrayList();
  BBCodeToken token=null;
  while ((token=_lexer.getNextToken()) != null) {
    _handleData(token,text);
    if (token.getStartTag() != null) {
      _handleTagStart(token);
      if (token.getStartTag().equals(STR_TAG_CODE)) {
        while ((token=_lexer.getNextToken()) != null && !(STR_TAG_CODE.equals(token.getEndTag())))         ;
        _handleData(token,text);
        if (token != null) {
          _handleTagEnd(token);
        }
 else {
          break;
        }
      }
    }
 else {
      _handleTagEnd(token);
    }
  }
  _handleData(null,text);
  _handleTagEnd(null);
  List<BBCodeItem> result=new ArrayList(_itemsList);
  _reset();
  return result;
}
