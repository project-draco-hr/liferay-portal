{
  _liveGroup=GroupTestUtil.addGroup();
  _stagingGroup=GroupTestUtil.addGroup();
  ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext(_stagingGroup.getGroupId(),TestPropsValues.getUserId());
  DLAppTestUtil.populateServiceContext(serviceContext,Constants.ADD,DLFileEntryTypeConstants.FILE_ENTRY_TYPE_ID_ALL,true);
  _fileEntry=DLAppLocalServiceUtil.addFileEntry(TestPropsValues.getUserId(),_stagingGroup.getGroupId(),DLFolderConstants.DEFAULT_PARENT_FOLDER_ID,RandomTestUtil.randomString() + ".txt",ContentTypes.TEXT_PLAIN,RandomTestUtil.randomBytes(),serviceContext);
  LiferayFileEntry liferayFileEntry=(LiferayFileEntry)_fileEntry;
  DLFileEntry dlFileEntry=liferayFileEntry.getDLFileEntry();
  dlFileEntry.setLargeImageId(dlFileEntry.getFileEntryId());
  DLFileEntryLocalServiceUtil.updateDLFileEntry(dlFileEntry);
  TestReaderWriter testReaderWriter=new TestReaderWriter();
  _portletDataContextExport=PortletDataContextFactoryUtil.createExportPortletDataContext(_stagingGroup.getCompanyId(),_stagingGroup.getGroupId(),new HashMap<String,String[]>(),new Date(System.currentTimeMillis() - Time.HOUR),new Date(),testReaderWriter);
  Document document=SAXReaderUtil.createDocument();
  Element manifestRootElement=document.addElement("root");
  manifestRootElement.addElement("header");
  testReaderWriter.addEntry("/manifest.xml",document.asXML());
  Element rootElement=SAXReaderUtil.createElement("root");
  _portletDataContextExport.setExportDataRootElement(rootElement);
  _stagingPrivateLayout=LayoutTestUtil.addLayout(_stagingGroup,true);
  _stagingPublicLayout=LayoutTestUtil.addLayout(_stagingGroup,false);
  _portletDataContextExport.setPlid(_stagingPublicLayout.getPlid());
  _portletDataContextImport=PortletDataContextFactoryUtil.createImportPortletDataContext(_liveGroup.getCompanyId(),_liveGroup.getGroupId(),new HashMap<String,String[]>(),new CurrentUserIdStrategy(TestPropsValues.getUser()),testReaderWriter);
  _portletDataContextImport.setImportDataRootElement(rootElement);
  _livePublicLayout=LayoutTestUtil.addLayout(_liveGroup,false);
  _portletDataContextImport.setPlid(_livePublicLayout.getPlid());
  _portletDataContextImport.setSourceGroupId(_stagingGroup.getGroupId());
  rootElement.addElement("entry");
  _referrerStagedModel=JournalTestUtil.addArticle(_stagingGroup.getGroupId(),RandomTestUtil.randomString(),RandomTestUtil.randomString());
}
