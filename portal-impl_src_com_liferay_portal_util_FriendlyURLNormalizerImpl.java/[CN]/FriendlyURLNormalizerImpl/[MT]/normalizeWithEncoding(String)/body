{
  if (Validator.isNull(friendlyURL)) {
    return friendlyURL;
  }
  StringBuilder sb=new StringBuilder(friendlyURL.length());
  boolean modified=false;
  ByteBuffer byteBuffer=null;
  CharBuffer charBuffer=null;
  CharsetEncoder charsetEncoder=null;
  for (int i=0; i < friendlyURL.length(); i++) {
    char c=friendlyURL.charAt(i);
    if ((CharPool.UPPER_CASE_A <= c) && (c <= CharPool.UPPER_CASE_Z)) {
      sb.append((char)(c + 32));
      modified=true;
    }
 else     if (((CharPool.LOWER_CASE_A <= c) && (c <= CharPool.LOWER_CASE_Z)) || ((CharPool.NUMBER_0 <= c) && (c <= CharPool.NUMBER_9)) || (c == CharPool.PERIOD)|| (c == CharPool.SLASH)|| (c == CharPool.STAR)|| (c == CharPool.UNDERLINE)) {
      sb.append(c);
    }
 else     if (Arrays.binarySearch(_REPLACE_CHARS,c) >= 0) {
      if ((i == 0) || (CharPool.DASH != sb.charAt(sb.length() - 1))) {
        sb.append(CharPool.DASH);
        if (c != CharPool.DASH) {
          modified=true;
        }
      }
 else {
        modified=true;
      }
    }
 else {
      if (charsetEncoder == null) {
        charsetEncoder=CharsetEncoderUtil.getCharsetEncoder(StringPool.UTF8);
        byteBuffer=ByteBuffer.allocate(8);
        charBuffer=CharBuffer.allocate(2);
      }
 else {
        byteBuffer.clear();
        charBuffer.clear();
      }
      charBuffer.put(c);
      if (Character.isHighSurrogate(c) && (i + 1) < friendlyURL.length()) {
        c=friendlyURL.charAt(i + 1);
        if (Character.isLowSurrogate(c)) {
          charBuffer.put(c);
          i++;
        }
      }
      charBuffer.flip();
      charsetEncoder.encode(charBuffer,byteBuffer,((friendlyURL.length() - 1) == i));
      byteBuffer.limit(8 - byteBuffer.remaining());
      byteBuffer.position(0);
      while (byteBuffer.hasRemaining()) {
        byte b=byteBuffer.get();
        sb.append(CharPool.PERCENT);
        sb.append(_HEX_DIGITS[(b >> 4) & 0x0F]);
        sb.append(_HEX_DIGITS[b & 0x0F]);
      }
      modified=true;
    }
  }
  if (modified) {
    return sb.toString();
  }
  return friendlyURL;
}
