{
  String portalPropertyKey=properties.getProperty("portalPropertyKey");
  if (Validator.isNull(portalPropertyKey)) {
    throw new RuntimeException("portalPropertyKey is null");
  }
  String portalPropertiesString=PropsUtil.getProperties().getProperty(portalPropertyKey);
  if (_log.isInfoEnabled()) {
    _log.info("portalPropertyKey " + portalPropertyKey + " has value "+ portalPropertiesString);
  }
  Properties portalProperties=null;
  if (portalPropertiesString.startsWith("peerDiscovery")) {
    portalPropertiesString=StringUtil.replace(portalPropertiesString,StringPool.COMMA,StringPool.NEW_LINE);
    try {
      portalProperties=PropertiesUtil.load(portalPropertiesString);
    }
 catch (    IOException ioe) {
      _log.error(ioe,ioe);
      throw new RuntimeException(ioe.getMessage());
    }
    if (_log.isDebugEnabled()) {
      _log.debug(PropertiesUtil.list(portalProperties));
    }
  }
 else {
    portalProperties=new Properties();
    String[] propertiesKeyAndValue=portalPropertiesString.split(StringPool.AMPERSAND);
    for (int i=0; i < propertiesKeyAndValue.length; i++) {
      String[] keyAndValue=propertiesKeyAndValue[i].split(StringPool.EQUAL,2);
      portalProperties.setProperty(keyAndValue[0],keyAndValue[1]);
    }
  }
  return _cacheManagerPeerProviderFactory.createCachePeerProvider(cacheManager,portalProperties);
}
