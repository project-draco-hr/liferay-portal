{
  try {
    long templateId=ParamUtil.getLong(request,"templateId");
    DDMTemplate template=DDMTemplateServiceUtil.getTemplate(templateId);
    String extension=DDMTemplateConstants.LANG_TYPE_VM;
    if (template.getLanguage() != null) {
      extension=template.getLanguage();
    }
    String script=template.getScript();
    String fileName=null;
    byte[] bytes=script.getBytes();
    String contentType;
    if (Validator.equals(extension,DDMTemplateConstants.LANG_TYPE_XSD)) {
      contentType=ContentTypes.TEXT_XML_UTF8;
    }
 else {
      contentType=ContentTypes.TEXT_PLAIN_UTF8;
    }
    ServletResponseUtil.sendFile(request,response,fileName,bytes,contentType);
    return null;
  }
 catch (  Exception e) {
    PortalUtil.sendError(e,request,response);
    return null;
  }
}
