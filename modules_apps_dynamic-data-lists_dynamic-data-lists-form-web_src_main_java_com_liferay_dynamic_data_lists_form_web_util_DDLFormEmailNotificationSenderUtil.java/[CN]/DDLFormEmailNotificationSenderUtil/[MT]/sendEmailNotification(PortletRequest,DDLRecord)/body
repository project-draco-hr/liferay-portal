{
  try {
    DDLRecordSet recordSet=record.getRecordSet();
    long companyId=recordSet.getCompanyId();
    String emailFromName=recordSet.getSettingsProperty("emailFromName",DDLFormEmailNotificationUtil.getDefaultEmailFromName(companyId));
    String emailFromAddress=recordSet.getSettingsProperty("emailFromAddress",DDLFormEmailNotificationUtil.getDefaultEmailFromAddress(companyId));
    String emailToAddress=recordSet.getSettingsProperty("emailToAddress",DDLFormEmailNotificationUtil.getDefaultEmailToAddress(recordSet));
    String subject=recordSet.getSettingsProperty("emailSubject",DDLFormEmailNotificationUtil.getDefaultSubject(recordSet));
    InternetAddress fromInternetAddress=new InternetAddress(emailFromAddress,emailFromName);
    String body=getMailBody(portletRequest,recordSet,record);
    MailMessage mailMessage=new MailMessage(fromInternetAddress,subject,body,true);
    InternetAddress[] toAddresses=InternetAddress.parse(emailToAddress);
    mailMessage.setTo(toAddresses);
    MailServiceUtil.sendEmail(mailMessage);
  }
 catch (  Exception e) {
    _log.error("The form email could not be sent",e);
  }
}
