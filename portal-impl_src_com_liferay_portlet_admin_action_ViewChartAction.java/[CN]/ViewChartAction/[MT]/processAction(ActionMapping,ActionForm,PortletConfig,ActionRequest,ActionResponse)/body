{
  try {
    Locale locale=actionRequest.getLocale();
    long maxMemory=ParamUtil.getLong(actionRequest,"maxMemory");
    long totalMemory=ParamUtil.getLong(actionRequest,"totalMemory");
    long usedMemory=ParamUtil.getLong(actionRequest,"usedMemory") * 100;
    String type=ParamUtil.getString(actionRequest,"type","max");
    DefaultValueDataset dataset=null;
    StringBundler sb=new StringBundler(5);
    sb.append(LanguageUtil.get(locale,"used-memory"));
    sb.append(StringPool.SPACE);
    sb.append(StringPool.FORWARD_SLASH);
    sb.append(StringPool.SPACE);
    if (type.equals("total")) {
      dataset=new DefaultValueDataset(usedMemory / totalMemory);
      sb.append(LanguageUtil.get(locale,"total-memory"));
    }
 else {
      dataset=new DefaultValueDataset(usedMemory / maxMemory);
      sb.append(LanguageUtil.get(locale,"maximum-memory"));
    }
    MeterPlot plot=_getMeterPlot(dataset,locale);
    JFreeChart chart=_getChart(sb.toString(),plot);
    HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
    response.setContentType(ContentTypes.IMAGE_JPEG);
    OutputStream os=response.getOutputStream();
    ChartUtilities.writeChartAsPNG(os,chart,280,180);
    setForward(actionRequest,ActionConstants.COMMON_NULL);
  }
 catch (  Exception e) {
    _log.error(e);
  }
}
