{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String type=ParamUtil.getString(actionRequest,"type","max");
  long maxMemory=ParamUtil.getLong(actionRequest,"maxMemory");
  long totalMemory=ParamUtil.getLong(actionRequest,"totalMemory");
  long usedMemory=ParamUtil.getLong(actionRequest,"usedMemory");
  ValueDataset valueDataset=null;
  StringBundler sb=new StringBundler(5);
  sb.append(themeDisplay.translate("used-memory"));
  sb.append(StringPool.SPACE);
  sb.append(StringPool.FORWARD_SLASH);
  sb.append(StringPool.SPACE);
  if (type.equals("total")) {
    valueDataset=new DefaultValueDataset((usedMemory * 100) / totalMemory);
    sb.append(themeDisplay.translate("total-memory"));
  }
 else {
    valueDataset=new DefaultValueDataset((usedMemory * 100) / maxMemory);
    sb.append(themeDisplay.translate("maximum-memory"));
  }
  MeterPlot meterPlot=getMeterPlot(themeDisplay,valueDataset);
  JFreeChart jFreeChart=getJFreeChart(sb.toString(),meterPlot);
  HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
  response.setContentType(ContentTypes.IMAGE_JPEG);
  OutputStream outputStream=response.getOutputStream();
  ChartUtilities.writeChartAsPNG(outputStream,jFreeChart,280,180);
  setForward(actionRequest,ActionConstants.COMMON_NULL);
}
