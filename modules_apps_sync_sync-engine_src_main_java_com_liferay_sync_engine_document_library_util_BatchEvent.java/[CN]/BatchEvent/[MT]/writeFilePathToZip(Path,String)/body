{
  InputStream inputStream=null;
  try {
    if (_zipOutputStream == null) {
      SyncAccount syncAccount=SyncAccountService.fetchSyncAccount(_syncAccountId);
      _zipFilePath=FileUtil.getFilePath(syncAccount.getFilePathName(),".data",String.valueOf(System.currentTimeMillis()) + ".zip");
      OutputStream outputStream=Files.newOutputStream(_zipFilePath);
      _zipOutputStream=new ZipOutputStream(outputStream);
      _zipOutputStream.setLevel(0);
    }
    ZipEntry zipEntry=new ZipEntry(name);
    _zipOutputStream.putNextEntry(zipEntry);
    inputStream=Files.newInputStream(filePath);
    byte[] buffer=new byte[1024];
    int length=0;
    while ((length=inputStream.read(buffer)) > 0) {
      _zipOutputStream.write(buffer,0,length);
    }
  }
  finally {
    if (_zipOutputStream != null) {
      _zipOutputStream.closeEntry();
    }
    StreamUtil.cleanUp(inputStream);
  }
}
