{
  PortletPreferencesImpl preferences=PortletPreferencesSerializer.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
  String selectionStyle=preferences.getValue("selection-style",null);
  if (Validator.isNotNull(selectionStyle) && !selectionStyle.equals("dynamic")) {
    String[] assetEntryXmls=preferences.getValues("asset-entry-xml",new String[0]);
    String[] newAssetEntryXmls=new String[assetEntryXmls.length];
    for (int i=0; i < assetEntryXmls.length; i++) {
      String assetEntryXml=assetEntryXmls[i];
      Document doc=SAXReaderUtil.read(assetEntryXml);
      Element root=doc.getRootElement();
      Element assetEntryIdElement=root.element("asset-entry-id");
      long assetEntryId=GetterUtil.getLong(assetEntryIdElement.getText());
      Connection con=null;
      PreparedStatement ps=null;
      ResultSet rs=null;
      try {
        con=DataAccess.getConnection();
        ps=con.prepareStatement("select * from AssetEntry where entryId = ?");
        ps.setLong(1,assetEntryId);
        rs=ps.executeQuery();
        rs.next();
        String classUuid=rs.getString("classUuid");
        root.addElement("asset-entry-uuid").addText(classUuid);
        root.remove(assetEntryIdElement);
        newAssetEntryXmls[i]=doc.formattedString(StringPool.BLANK);
      }
  finally {
        DataAccess.cleanUp(con,ps,rs);
      }
    }
    preferences.setValues("asset-entry-xml",newAssetEntryXmls);
  }
  return PortletPreferencesSerializer.toXML(preferences);
}
