{
  String filterName=filterMapping.getFilterName();
  while (true) {
    List<FilterMapping> oldFilterMappings=_filterMappingsMap.get(filterName);
    List<FilterMapping> newFilterMappings=null;
    if (oldFilterMappings == null) {
      newFilterMappings=new ArrayList<>();
    }
 else {
      newFilterMappings=new ArrayList<>(oldFilterMappings);
    }
    newFilterMappings.add(filterMapping);
    if (newFilterMappings.size() == 1) {
      if (_filterMappingsMap.putIfAbsent(filterName,newFilterMappings) == null) {
        int index=_filterNames.indexOf(positionFilterName);
        if (index == -1) {
          _filterNames.add(filterName);
        }
 else         if (after) {
          _filterNames.add(index + 1,filterName);
        }
 else {
          _filterNames.add(index,filterName);
        }
        break;
      }
    }
 else     if (_filterMappingsMap.replace(filterName,oldFilterMappings,newFilterMappings)) {
      break;
    }
  }
}
