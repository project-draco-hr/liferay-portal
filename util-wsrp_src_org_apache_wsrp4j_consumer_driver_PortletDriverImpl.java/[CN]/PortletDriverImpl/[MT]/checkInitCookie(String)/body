{
  UserSessionMgr userSession=this.consumerEnv.getSessionHandler().getUserSession(getPortlet().getPortletKey().getProducerId(),userID);
  if (initCookie.getValue().equalsIgnoreCase(CookieProtocol._perUser)) {
    this.markupPort=userSession.getWSRPBaseService();
    if (!userSession.isInitCookieDone()) {
      userSession.setInitCookieRequired(true);
      initCookie();
      userSession.setInitCookieDone(true);
    }
  }
 else   if (initCookie.getValue().equalsIgnoreCase(CookieProtocol._perGroup)) {
    PortletDescription portletDescription=producer.getPortletDescription(getPortlet().getParent());
    String groupID=null;
    if (portletDescription != null) {
      groupID=portletDescription.getGroupID();
    }
    if (groupID != null) {
      GroupSessionMgr groupSession=userSession.getGroupSession(groupID);
      this.markupPort=groupSession.getWSRPBaseService();
      if (!groupSession.isInitCookieDone()) {
        groupSession.setInitCookieRequired(true);
        initCookie();
        groupSession.setInitCookieDone(true);
      }
    }
 else {
    }
  }
 else {
    this.markupPort=userSession.getWSRPBaseService();
  }
}
