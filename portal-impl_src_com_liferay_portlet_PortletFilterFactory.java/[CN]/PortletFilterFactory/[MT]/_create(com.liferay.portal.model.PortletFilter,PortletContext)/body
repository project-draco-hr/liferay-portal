{
  PortletApp portletApp=portletFilterModel.getPortletApp();
  Map<String,PortletFilter> portletFilters=_pool.get(portletApp.getServletContextName());
  if (portletFilters == null) {
    portletFilters=new ConcurrentHashMap<String,PortletFilter>();
    _pool.put(portletApp.getServletContextName(),portletFilters);
  }
  PortletFilter portletFilter=portletFilters.get(portletFilterModel.getFilterName());
  if (portletFilter == null) {
    FilterConfig filterConfig=FilterConfigFactory.create(portletFilterModel,ctx);
    if (portletApp.isWARFile()) {
      PortletContextBag portletContextBag=PortletContextBagPool.get(portletApp.getServletContextName());
      portletFilter=portletContextBag.getPortletFilters().get(portletFilterModel.getFilterName());
      portletFilter=_init(portletFilterModel,filterConfig,portletFilter);
    }
 else {
      portletFilter=_init(portletFilterModel,filterConfig);
    }
    portletFilters.put(portletFilterModel.getFilterName(),portletFilter);
  }
  return portletFilter;
}
