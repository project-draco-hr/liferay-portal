{
  ActionRequestImpl actionRequestImpl=(ActionRequestImpl)req.getAttribute(WebKeys.JAVAX_PORTLET_REQUEST);
  Layout layout=(Layout)req.getAttribute(WebKeys.LAYOUT);
  PortletURL portletURL=new PortletURLImpl(actionRequestImpl,actionRequestImpl.getPortletName(),layout.getLayoutId(),false);
  Map renderParameters=actionResponseImpl.getRenderParameters();
  Iterator itr=renderParameters.entrySet().iterator();
  while (itr.hasNext()) {
    Map.Entry entry=(Map.Entry)itr.next();
    String key=(String)entry.getKey();
    Object value=entry.getValue();
    if (value instanceof String) {
      portletURL.setParameter(key,(String)value);
    }
 else     if (value instanceof String[]) {
      portletURL.setParameter(key,(String[])value);
    }
  }
  res.sendRedirect(portletURL.toString());
}
