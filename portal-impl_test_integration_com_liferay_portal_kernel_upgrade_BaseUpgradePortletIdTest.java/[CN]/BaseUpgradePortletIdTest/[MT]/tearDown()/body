{
  try (Connection con=DataAccess.getUpgradeOptimizedConnection()){
    connection=con;
    String[][] renamePortletIdsArray=getRenamePortletIdsArray();
    for (    String[] renamePortletIds : renamePortletIdsArray) {
      String oldRootPortletId=renamePortletIds[1];
      String newRootPortletId=renamePortletIds[0];
      updatePortlet(oldRootPortletId,newRootPortletId);
      updateLayoutRevisions(oldRootPortletId,newRootPortletId,false);
      updateLayouts(oldRootPortletId,newRootPortletId,false);
    }
  }
  finally {
    connection=null;
  }
  for (  String portletId : _PORTLET_IDS) {
    runSQL("delete from Portlet where portletId = '" + portletId + "_test'");
    runSQL("delete from ResourceAction where name = '" + portletId + "_test'");
    runSQL("delete from ResourcePermission where name = '" + portletId + "_test'");
  }
}
