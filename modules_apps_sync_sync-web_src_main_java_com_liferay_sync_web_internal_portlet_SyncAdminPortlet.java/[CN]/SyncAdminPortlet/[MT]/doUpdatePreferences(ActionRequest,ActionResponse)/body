{
  PortletPreferences portletPreferences=PrefsPropsUtil.getPreferences(CompanyThreadLocal.getCompanyId());
  boolean allowUserPersonalSites=ParamUtil.getBoolean(actionRequest,"allowUserPersonalSites");
  portletPreferences.setValue(SyncServiceConfigurationKeys.SYNC_ALLOW_USER_PERSONAL_SITES,String.valueOf(allowUserPersonalSites));
  boolean enabled=ParamUtil.getBoolean(actionRequest,"enabled");
  portletPreferences.setValue(SyncServiceConfigurationKeys.SYNC_SERVICES_ENABLED,String.valueOf(enabled));
  boolean forceSecurityMode=ParamUtil.getBoolean(actionRequest,"forceSecurityMode");
  portletPreferences.setValue(SyncServiceConfigurationKeys.SYNC_CLIENT_FORCE_SECURITY_MODE,String.valueOf(forceSecurityMode));
  int maxConnections=ParamUtil.getInteger(actionRequest,"maxConnections");
  portletPreferences.setValue(SyncServiceConfigurationKeys.SYNC_CLIENT_MAX_CONNECTIONS,String.valueOf(maxConnections));
  int maxDownloadRate=ParamUtil.getInteger(actionRequest,"maxDownloadRate");
  portletPreferences.setValue(SyncServiceConfigurationKeys.SYNC_CLIENT_MAX_DOWNLOAD_RATE,String.valueOf(maxDownloadRate));
  int maxUploadRate=ParamUtil.getInteger(actionRequest,"maxUploadRate");
  portletPreferences.setValue(SyncServiceConfigurationKeys.SYNC_CLIENT_MAX_UPLOAD_RATE,String.valueOf(maxUploadRate));
  boolean oAuthEnabled=ParamUtil.getBoolean(actionRequest,"oAuthEnabled");
  portletPreferences.setValue(SyncConstants.SYNC_OAUTH_ENABLED,String.valueOf(oAuthEnabled));
  int pollInterval=ParamUtil.getInteger(actionRequest,"pollInterval");
  portletPreferences.setValue(SyncServiceConfigurationKeys.SYNC_CLIENT_POLL_INTERVAL,String.valueOf(pollInterval));
  portletPreferences.setValue(SyncConstants.SYNC_CONTEXT_MODIFIED_TIME,String.valueOf(System.currentTimeMillis()));
  portletPreferences.store();
  if (oAuthEnabled) {
    if (!_syncOAuthHelperUtil.isDeployed()) {
      SessionErrors.add(actionRequest,OAuthPortletUndeployedException.class);
      return;
    }
    ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
    _syncOAuthHelperUtil.enableOAuth(CompanyThreadLocal.getCompanyId(),serviceContext);
  }
}
