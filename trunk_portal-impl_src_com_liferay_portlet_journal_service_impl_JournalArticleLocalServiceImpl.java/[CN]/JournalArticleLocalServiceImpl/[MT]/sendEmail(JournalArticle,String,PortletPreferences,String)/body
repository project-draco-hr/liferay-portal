{
  if (preferences == null) {
    return;
  }
 else   if (emailType.equals("denied") && JournalUtil.getEmailArticleApprovalDeniedEnabled(preferences)) {
  }
 else   if (emailType.equals("granted") && JournalUtil.getEmailArticleApprovalGrantedEnabled(preferences)) {
  }
 else   if (emailType.equals("requested") && JournalUtil.getEmailArticleApprovalRequestedEnabled(preferences)) {
  }
 else   if (emailType.equals("review") && JournalUtil.getEmailArticleReviewEnabled(preferences)) {
  }
 else {
    return;
  }
  Company company=companyPersistence.findByPrimaryKey(article.getCompanyId());
  User user=userPersistence.findByPrimaryKey(article.getUserId());
  articleURL+="&groupId=" + article.getGroupId() + "&articleId="+ article.getArticleId()+ "&version="+ article.getVersion();
  String portletName=PortalUtil.getPortletTitle(PortletKeys.JOURNAL,user);
  String fromName=JournalUtil.getEmailFromName(preferences);
  String fromAddress=JournalUtil.getEmailFromAddress(preferences);
  String toName=user.getFullName();
  String toAddress=user.getEmailAddress();
  if (emailType.equals("requested") || emailType.equals("review")) {
    String tempToName=fromName;
    String tempToAddress=fromAddress;
    fromName=toName;
    fromAddress=toAddress;
    toName=tempToName;
    toAddress=tempToAddress;
  }
  String subject=null;
  String body=null;
  if (emailType.equals("denied")) {
    subject=JournalUtil.getEmailArticleApprovalDeniedSubject(preferences);
    body=JournalUtil.getEmailArticleApprovalDeniedBody(preferences);
  }
 else   if (emailType.equals("granted")) {
    subject=JournalUtil.getEmailArticleApprovalGrantedSubject(preferences);
    body=JournalUtil.getEmailArticleApprovalGrantedBody(preferences);
  }
 else   if (emailType.equals("requested")) {
    subject=JournalUtil.getEmailArticleApprovalRequestedSubject(preferences);
    body=JournalUtil.getEmailArticleApprovalRequestedBody(preferences);
  }
 else   if (emailType.equals("review")) {
    subject=JournalUtil.getEmailArticleReviewSubject(preferences);
    body=JournalUtil.getEmailArticleReviewBody(preferences);
  }
  subject=StringUtil.replace(subject,new String[]{"[$ARTICLE_ID$]","[$ARTICLE_TITLE$]","[$ARTICLE_URL$]","[$ARTICLE_USER_NAME$]","[$ARTICLE_VERSION$]","[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$PORTLET_NAME$]","[$TO_ADDRESS$]","[$TO_NAME$]"},new String[]{article.getArticleId(),article.getTitle(),articleURL,article.getUserName(),String.valueOf(article.getVersion()),fromAddress,fromName,company.getVirtualHostname(),portletName,toAddress,toName});
  body=StringUtil.replace(body,new String[]{"[$ARTICLE_ID$]","[$ARTICLE_TITLE$]","[$ARTICLE_URL$]","[$ARTICLE_USER_NAME$]","[$ARTICLE_VERSION$]","[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$PORTLET_NAME$]","[$TO_ADDRESS$]","[$TO_NAME$]"},new String[]{article.getArticleId(),article.getTitle(),articleURL,article.getUserName(),String.valueOf(article.getVersion()),fromAddress,fromName,company.getVirtualHostname(),portletName,toAddress,toName});
  InternetAddress from=new InternetAddress(fromAddress,fromName);
  InternetAddress to=new InternetAddress(toAddress,toName);
  MailMessage message=new MailMessage(from,to,subject,body,true);
  mailService.sendEmail(message);
}
