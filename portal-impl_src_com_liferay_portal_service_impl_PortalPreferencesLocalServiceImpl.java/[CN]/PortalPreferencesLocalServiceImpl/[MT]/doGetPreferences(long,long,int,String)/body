{
  PortalPreferences portalPreferences=portalPreferencesPersistence.fetchByO_O(ownerId,ownerType);
  if (portalPreferences == null) {
    if (PortletPreferencesThreadLocal.isStrict() && Validator.isNull(defaultPreferences)) {
      return new PortalPreferencesWrapper(new PortalPreferencesImpl());
    }
    portalPreferences=portalPreferencesLocalService.addPortalPreferences(companyId,ownerId,ownerType,defaultPreferences);
  }
  PortalPreferencesImpl portalPreferencesImpl=(PortalPreferencesImpl)PortletPreferencesFactoryUtil.fromXML(companyId,ownerId,ownerType,portalPreferences.getPreferences());
  return new PortalPreferencesWrapper(portalPreferencesImpl);
}
