{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String portletId=ParamUtil.getString(request,"portletId");
  PortletPermissionUtil.check(themeDisplay.getPermissionChecker(),themeDisplay.getLayout(),portletId,ActionKeys.CONFIGURATION);
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.getStrictPortletSetup(themeDisplay.getLayout(),portletId);
  if (portletPreferences instanceof StrictPortletPreferencesImpl) {
    throw new PrincipalException();
  }
  String color=ParamUtil.getString(request,"color");
  String data=ParamUtil.getString(request,"data");
  if (Validator.isNotNull(color)) {
    portletPreferences.setValue("color",color);
  }
  if (Validator.isNotNull(data)) {
    portletPreferences.setValue("data",data);
  }
  portletPreferences.store();
  return null;
}
