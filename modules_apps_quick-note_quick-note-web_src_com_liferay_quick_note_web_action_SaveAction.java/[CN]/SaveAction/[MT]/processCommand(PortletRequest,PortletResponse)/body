{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String portletId=ParamUtil.getString(portletRequest,"portletId");
  try {
    PortletPermissionUtil.check(themeDisplay.getPermissionChecker(),themeDisplay.getLayout(),portletId,ActionKeys.CONFIGURATION);
  }
 catch (  Exception e) {
    _log.error(e);
    throw new PortletException(e);
  }
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.getStrictPortletSetup(themeDisplay.getLayout(),portletId);
  String color=ParamUtil.getString(portletRequest,"color");
  String data=ParamUtil.getString(portletRequest,"data");
  if (Validator.isNotNull(color)) {
    portletPreferences.setValue("color",color);
  }
  if (Validator.isNotNull(data)) {
    portletPreferences.setValue("data",data);
  }
  try {
    portletPreferences.store();
  }
 catch (  IOException ioe) {
    _log.error("Unable to store portlet preference",ioe);
  }
  return true;
}
