{
  int dbMajorVersion=0;
  int dbMinorVersion=0;
  if (dataSource != null) {
    try (Connection connection=dataSource.getConnection()){
      DatabaseMetaData databaseMetaData=connection.getMetaData();
      dbMajorVersion=databaseMetaData.getDatabaseMajorVersion();
      dbMinorVersion=databaseMetaData.getDatabaseMinorVersion();
    }
 catch (    SQLException sqle) {
      return ReflectionUtil.throwException(sqle);
    }
  }
  if (dbType == DBType.DB2) {
    return new DB2DB(dbMajorVersion,dbMinorVersion);
  }
  if (dbType == DBType.HYPERSONIC) {
    return new HypersonicDB(dbMajorVersion,dbMinorVersion);
  }
  if (dbType == DBType.MYSQL) {
    return new MySQLDB(dbMajorVersion,dbMinorVersion);
  }
  if (dbType == DBType.ORACLE) {
    return new OracleDB(dbMajorVersion,dbMinorVersion);
  }
  if (dbType == DBType.POSTGRESQL) {
    return new PostgreSQLDB(dbMajorVersion,dbMinorVersion);
  }
  if (dbType == DBType.SQLSERVER) {
    return new SQLServerDB(dbMajorVersion,dbMinorVersion);
  }
  if (dbType == DBType.SYBASE) {
    return new SybaseDB(dbMajorVersion,dbMinorVersion);
  }
  throw new IllegalArgumentException("Unknown database type " + dbType);
}
