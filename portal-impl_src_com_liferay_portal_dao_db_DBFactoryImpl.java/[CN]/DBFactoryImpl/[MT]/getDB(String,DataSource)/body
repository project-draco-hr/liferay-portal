{
  int dbMajorVersion=0;
  int dbMinorVersion=0;
  if (dataSource != null) {
    try (Connection connection=dataSource.getConnection()){
      DatabaseMetaData databaseMetaData=connection.getMetaData();
      dbMajorVersion=databaseMetaData.getDatabaseMajorVersion();
      dbMinorVersion=databaseMetaData.getDatabaseMinorVersion();
    }
 catch (    SQLException sqle) {
      return ReflectionUtil.throwException(sqle);
    }
  }
  if (type.equals(DB.TYPE_DB2)) {
    return new DB2DB(dbMajorVersion,dbMinorVersion);
  }
  if (type.equals(DB.TYPE_HYPERSONIC)) {
    return new HypersonicDB(dbMajorVersion,dbMinorVersion);
  }
  if (type.equals(DB.TYPE_MYSQL)) {
    return new MySQLDB(dbMajorVersion,dbMinorVersion);
  }
  if (type.equals(DB.TYPE_ORACLE)) {
    return new OracleDB(dbMajorVersion,dbMinorVersion);
  }
  if (type.equals(DB.TYPE_POSTGRESQL)) {
    return new PostgreSQLDB(dbMajorVersion,dbMinorVersion);
  }
  if (type.equals(DB.TYPE_SQLSERVER)) {
    return new SQLServerDB(dbMajorVersion,dbMinorVersion);
  }
  if (type.equals(DB.TYPE_SYBASE)) {
    return new SybaseDB(dbMajorVersion,dbMinorVersion);
  }
  throw new IllegalArgumentException("Unknown database type " + type);
}
