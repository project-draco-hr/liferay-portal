{
  JarFile jarFile=null;
  String resourcePath=conn.getJarFileURL().toString();
  try {
    if (redeployMode) {
      conn.setUseCaches(false);
    }
    jarFile=conn.getJarFile();
    if (tldNames != null) {
      for (      String tldName : tldNames) {
        JarEntry entry=jarFile.getJarEntry(tldName);
        InputStream stream=jarFile.getInputStream(entry);
        scanTld(resourcePath,tldName,stream);
      }
    }
 else {
      Enumeration entries=jarFile.entries();
      while (entries.hasMoreElements()) {
        JarEntry entry=(JarEntry)entries.nextElement();
        String name=entry.getName();
        if (!name.startsWith("META-INF/"))         continue;
        if (!name.endsWith(".tld"))         continue;
        InputStream stream=jarFile.getInputStream(entry);
        scanTld(resourcePath,name,stream);
      }
    }
  }
 catch (  Exception ex) {
    if (!redeployMode) {
      if (jarFile != null) {
        try {
          jarFile.close();
        }
 catch (        Throwable t) {
        }
      }
    }
    if (!ignore) {
      throw new JasperException(ex);
    }
  }
 finally {
    if (redeployMode) {
      if (jarFile != null) {
        try {
          jarFile.close();
        }
 catch (        Throwable t) {
        }
      }
    }
  }
}
