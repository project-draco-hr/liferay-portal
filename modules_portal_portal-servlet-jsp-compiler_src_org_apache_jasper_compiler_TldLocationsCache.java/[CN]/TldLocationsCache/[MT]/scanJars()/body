{
  ClassLoader webappLoader=Thread.currentThread().getContextClassLoader();
  ClassLoader loader=webappLoader;
  if (localTldsProcessed) {
    if (loader != null) {
      loader=loader.getParent();
    }
  }
  while (loader != null) {
    if (loader instanceof URLClassLoader) {
      boolean isLocal=(loader == webappLoader);
      URL[] urls=((URLClassLoader)loader).getURLs();
      for (int i=0; i < urls.length; i++) {
        URLConnection conn=urls[i].openConnection();
        if (conn instanceof JarURLConnection) {
          if (needScanJar(((JarURLConnection)conn).getJarFile().getName(),isLocal)) {
            scanJar((JarURLConnection)conn,true);
          }
        }
 else {
          String urlStr=urls[i].toString();
          if (urlStr.startsWith(FILE_PROTOCOL) && urlStr.endsWith(JAR_FILE_SUFFIX) && needScanJar(urlStr,isLocal)) {
            URL jarURL=new URL("jar:" + urlStr + "!/");
            scanJar((JarURLConnection)jarURL.openConnection(),true);
          }
        }
      }
    }
    loader=loader.getParent();
  }
  Map<URI,List<String>> tldMap=(Map<URI,List<String>>)ctxt.getAttribute("com.sun.appserv.tld.map");
  if (tldMap != null) {
    for (    URI uri : tldMap.keySet()) {
      URL jarURL=new URL("jar:" + uri.toString() + "!/");
      scanJar((JarURLConnection)jarURL.openConnection(),true,tldMap.get(uri));
    }
  }
}
