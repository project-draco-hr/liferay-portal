{
  LdapContext ctx=PortalLDAPUtil.getContext(companyId);
  if (ctx == null) {
    throw new SystemException("Failed to bind to the LDAP server");
  }
  try {
    String baseDN=PrefsPropsUtil.getString(companyId,PropsKeys.LDAP_BASE_DN);
    String filter=PortalLDAPUtil.getAuthSearchFilter(companyId,StringPool.BLANK,screenName,StringPool.BLANK);
    SearchControls cons=new SearchControls(SearchControls.SUBTREE_SCOPE,1,0,null,false,false);
    NamingEnumeration<SearchResult> enu=ctx.search(baseDN,filter,cons);
    User user=null;
    if (enu.hasMoreElements()) {
      if (_log.isInfoEnabled()) {
        _log.info("Search filter returned at least one result");
      }
      SearchResult result=enu.nextElement();
      String fullUserDN=PortalLDAPUtil.getNameInNamespace(companyId,result);
      Attributes attrs=PortalLDAPUtil.getUserAttributes(companyId,ctx,fullUserDN);
      user=PortalLDAPUtil.importLDAPUser(companyId,ctx,attrs,StringPool.BLANK,true);
    }
 else {
      if (_log.isDebugEnabled()) {
        _log.debug("Search filter did not return any results");
      }
    }
    enu.close();
    return user;
  }
 catch (  Exception e) {
    _log.error("Problem accessing LDAP server ",e);
    throw new SystemException("Problem accessing LDAP server " + e.getMessage());
  }
 finally {
    if (ctx != null) {
      ctx.close();
    }
  }
}
