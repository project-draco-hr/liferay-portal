{
  String[] sourceFileNames=sourceDirectory.listAll();
  Arrays.sort(sourceFileNames);
  String[] newFileNames=newDirectory.listAll();
  Arrays.sort(newFileNames);
  if (sourceFileNames.length != newFileNames.length) {
    fail("Source and new directory file names do not match, " + "source directory : " + Arrays.toString(sourceFileNames) + ", new directory : "+ Arrays.toString(newFileNames));
  }
  for (  String fileName : sourceFileNames) {
    long sourceLength=sourceDirectory.fileLength(fileName);
    long newLength=newDirectory.fileLength(fileName);
    if (sourceLength != newLength) {
      fail("Files length do not match, name : " + fileName + ", source length : "+ sourceLength+ ", new length : "+ newLength);
    }
    _assertSameContent(fileName,sourceDirectory.openInput(fileName),newDirectory.openInput(fileName));
  }
}
