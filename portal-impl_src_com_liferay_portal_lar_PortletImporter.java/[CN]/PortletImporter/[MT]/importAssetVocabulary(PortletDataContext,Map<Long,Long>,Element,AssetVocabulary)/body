{
  long userId=portletDataContext.getUserId(assetVocabulary.getUserUuid());
  long groupId=portletDataContext.getScopeGroupId();
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddGroupPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  serviceContext.setCreateDate(assetVocabulary.getCreateDate());
  serviceContext.setModifiedDate(assetVocabulary.getModifiedDate());
  boolean global=GetterUtil.getBoolean(assetVocabularyElement.attributeValue("global"));
  if (global) {
    Group companyGroup=GroupLocalServiceUtil.getCompanyGroup(portletDataContext.getCompanyId());
    try {
      AssetPermission.check(PermissionThreadLocal.getPermissionChecker(),companyGroup.getGroupId(),ActionKeys.ADD_VOCABULARY);
      serviceContext.setScopeGroupId(companyGroup.getGroupId());
    }
 catch (    PortalException e) {
      serviceContext.setScopeGroupId(portletDataContext.getScopeGroupId());
    }
  }
 else {
    serviceContext.setScopeGroupId(portletDataContext.getScopeGroupId());
  }
  AssetVocabulary importedAssetVocabulary=null;
  AssetVocabulary existingAssetVocabulary=AssetVocabularyUtil.fetchByUUID_G(assetVocabulary.getUuid(),groupId);
  if (existingAssetVocabulary == null) {
    Group companyGroup=GroupLocalServiceUtil.getCompanyGroup(portletDataContext.getCompanyId());
    existingAssetVocabulary=AssetVocabularyUtil.fetchByUUID_G(assetVocabulary.getUuid(),companyGroup.getGroupId());
  }
  if (existingAssetVocabulary == null) {
    String name=getAssetVocabularyName(null,groupId,assetVocabulary.getName(),2);
    serviceContext.setUuid(assetVocabulary.getUuid());
    importedAssetVocabulary=AssetVocabularyLocalServiceUtil.addVocabulary(userId,StringPool.BLANK,getAssetVocabularyTitleMap(assetVocabulary,name),assetVocabulary.getDescriptionMap(),assetVocabulary.getSettings(),serviceContext);
  }
 else {
    String name=getAssetVocabularyName(assetVocabulary.getUuid(),groupId,assetVocabulary.getName(),2);
    importedAssetVocabulary=AssetVocabularyLocalServiceUtil.updateVocabulary(existingAssetVocabulary.getVocabularyId(),StringPool.BLANK,getAssetVocabularyTitleMap(assetVocabulary,name),assetVocabulary.getDescriptionMap(),assetVocabulary.getSettings(),serviceContext);
  }
  assetVocabularyPKs.put(assetVocabulary.getVocabularyId(),importedAssetVocabulary.getVocabularyId());
  portletDataContext.importPermissions(AssetVocabulary.class,assetVocabulary.getVocabularyId(),importedAssetVocabulary.getVocabularyId());
}
