{
  String rootPotletId=PortletConstants.getRootPortletId(portletId);
  if (!rootPotletId.equals(PortletKeys.ASSET_PUBLISHER)) {
    return xml;
  }
  PortletPreferencesImpl portletPreferences=(PortletPreferencesImpl)PortletPreferencesFactoryUtil.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
  Enumeration<String> enu=portletPreferences.getNames();
  while (enu.hasMoreElements()) {
    String name=enu.nextElement();
    String value=GetterUtil.getString(portletPreferences.getValue(name,StringPool.BLANK));
    String prefix="queryName";
    if (value.equalsIgnoreCase("assetCategories") && name.startsWith(prefix)) {
      String index=name.substring(prefix.length(),name.length());
      String queryValuesName="queryValues" + index;
      String[] importedAssetCategoryPKs=portletPreferences.getValues(queryValuesName,null);
      Map<Long,Long> assetCategoryPKs=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(AssetCategory.class);
      String[] newAssetCategoryPKs=new String[importedAssetCategoryPKs.length];
      int i=0;
      for (      String importedAssetCategoryPK : importedAssetCategoryPKs) {
        String newAssetCategoryPK=StringUtil.valueOf(assetCategoryPKs.get(new Long(importedAssetCategoryPK)));
        if (Validator.isNull(newAssetCategoryPK)) {
          newAssetCategoryPK=importedAssetCategoryPK;
        }
        newAssetCategoryPKs[i++]=newAssetCategoryPK;
      }
      portletPreferences.setValues(queryValuesName,newAssetCategoryPKs);
    }
  }
  return PortletPreferencesFactoryUtil.toXML(portletPreferences);
}
