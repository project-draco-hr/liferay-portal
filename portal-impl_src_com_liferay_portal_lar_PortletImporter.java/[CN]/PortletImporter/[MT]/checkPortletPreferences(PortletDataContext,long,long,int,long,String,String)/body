{
  String rootPotletId=PortletConstants.getRootPortletId(portletId);
  if (!rootPotletId.equals(PortletKeys.ASSET_PUBLISHER)) {
    return xml;
  }
  PortletPreferencesImpl portletPreferences=(PortletPreferencesImpl)PortletPreferencesFactoryUtil.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
  Enumeration<String> enu=portletPreferences.getNames();
  while (enu.hasMoreElements()) {
    String name=enu.nextElement();
    String value=GetterUtil.getString(portletPreferences.getValue(name,StringPool.BLANK));
    String prefix="queryName";
    if (value.equalsIgnoreCase("assetCategories") && name.startsWith(prefix)) {
      String index=name.substring(prefix.length(),name.length());
      String queryValuesName="queryValues" + index;
      String[] importedCategoryPKs=portletPreferences.getValues(queryValuesName,null);
      Map<Long,Long> assetCategoryPKs=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(AssetCategory.class);
      String[] newCategoryPKs=new String[importedCategoryPKs.length];
      int i=0;
      for (      String importedCategoryPK : importedCategoryPKs) {
        String newCategoryPk=StringUtil.valueOf(assetCategoryPKs.get(new Long(importedCategoryPK)));
        if (Validator.isNull(newCategoryPk)) {
          newCategoryPk=importedCategoryPK;
        }
        newCategoryPKs[i++]=newCategoryPk;
      }
      portletPreferences.setValues(queryValuesName,newCategoryPKs);
    }
  }
  return PortletPreferencesFactoryUtil.toXML(portletPreferences);
}
