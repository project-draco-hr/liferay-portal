{
  if (importData) {
    PortletPreferencesLocalServiceUtil.updatePreferences(ownerId,ownerType,plid,portletId,xml);
  }
 else {
    Portlet portlet=PortletLocalServiceUtil.getPortletById(portletDataContext.getCompanyId(),portletId);
    if (portlet == null) {
      if (_log.isDebugEnabled()) {
        _log.debug("Do not update portlet preferences for " + portletId + " because the portlet does not exist");
      }
      return;
    }
    PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
    if (portletDataHandler == null) {
      PortletPreferencesLocalServiceUtil.updatePreferences(ownerId,ownerType,plid,portletId,xml);
      return;
    }
    String[] dataPortletPreferences=portletDataHandler.getDataPortletPreferences();
    javax.portlet.PortletPreferences portletPreferences=PortletPreferencesLocalServiceUtil.getPreferences(portletDataContext.getCompanyId(),ownerId,ownerType,plid,portletId);
    javax.portlet.PortletPreferences jxPreferences=PortletPreferencesFactoryUtil.fromXML(portletDataContext.getCompanyId(),ownerId,ownerType,plid,portletId,xml);
    Enumeration<String> enu=jxPreferences.getNames();
    while (enu.hasMoreElements()) {
      String name=enu.nextElement();
      if (!ArrayUtil.contains(dataPortletPreferences,name)) {
        String[] values=jxPreferences.getValues(name,null);
        portletPreferences.setValues(name,values);
      }
    }
    PortletPreferencesLocalServiceUtil.updatePreferences(ownerId,ownerType,plid,portletId,portletPreferences);
  }
}
