{
  if (importData) {
    PortletPreferencesLocalServiceUtil.updatePreferences(ownerId,ownerType,plid,portletId,xml);
  }
 else {
    Portlet portlet=PortletLocalServiceUtil.getPortletById(portletDataContext.getCompanyId(),portletId);
    PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
    String[] dataPortletPreferences=portletDataHandler.getDataPortletPreferences();
    javax.portlet.PortletPreferences portletPreferences=PortletPreferencesLocalServiceUtil.getPreferences(portletDataContext.getCompanyId(),ownerId,ownerType,plid,portletId);
    javax.portlet.PortletPreferences jxPreferences=PortletPreferencesFactoryUtil.fromXML(portletDataContext.getCompanyId(),ownerId,ownerType,plid,portletId,xml);
    Enumeration<String> enu=jxPreferences.getNames();
    while (enu.hasMoreElements()) {
      String name=enu.nextElement();
      if (!ArrayUtil.contains(dataPortletPreferences,name)) {
        String value=GetterUtil.getString(jxPreferences.getValue(name,null));
        portletPreferences.setValue(name,value);
      }
    }
    PortletPreferencesLocalServiceUtil.updatePreferences(ownerId,ownerType,plid,portletId,portletPreferences);
  }
}
