{
  String xml=zipReader.getEntryAsString("/manifest.xml");
  if (xml == null) {
    throw new LARFileException("manifest.xml not found in the LAR");
  }
  Element rootElement=null;
  try {
    Document document=SAXReaderUtil.read(xml);
    rootElement=document.getRootElement();
  }
 catch (  Exception e) {
    throw new LARFileException(e);
  }
  int buildNumber=ReleaseInfo.getBuildNumber();
  Element headerElement=rootElement.element("header");
  int importBuildNumber=GetterUtil.getInteger(headerElement.attributeValue("build-number"));
  if (buildNumber != importBuildNumber) {
    throw new LayoutImportException("LAR build number " + importBuildNumber + " does not match "+ "portal build number "+ buildNumber);
  }
  String larType=headerElement.attributeValue("type");
  if (!larType.equals("portlet")) {
    throw new LARTypeException(larType);
  }
  String rootPortletId=headerElement.attributeValue("root-portlet-id");
  if (!PortletConstants.getRootPortletId(portletId).equals(rootPortletId)) {
    throw new PortletIdException("Invalid portlet id " + rootPortletId);
  }
  Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletId);
  PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
  if (portletDataHandler.isDataLocalized()) {
    Locale[] sourceAvailableLocales=LocaleUtil.fromLanguageIds(StringUtil.split(headerElement.attributeValue("available-locales")));
    Locale[] targetAvailableLocales=LanguageUtil.getAvailableLocales(PortalUtil.getSiteGroupId(groupId));
    for (    Locale sourceAvailableLocale : sourceAvailableLocales) {
      if (!ArrayUtil.contains(targetAvailableLocales,sourceAvailableLocale)) {
        LocaleException le=new LocaleException(LocaleException.TYPE_EXPORT_IMPORT,"Locale " + sourceAvailableLocale + " is not "+ "available in company "+ companyId);
        le.setSourceAvailableLocales(sourceAvailableLocales);
        le.setTargetAvailableLocales(targetAvailableLocales);
        throw le;
      }
    }
  }
}
