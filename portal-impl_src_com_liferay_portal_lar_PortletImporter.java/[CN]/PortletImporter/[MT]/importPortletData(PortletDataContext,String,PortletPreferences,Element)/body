{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(portletDataContext.getCompanyId(),portletId);
  if (portlet == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Do not import portlet data for " + portletId + " because the portlet does not exist");
    }
    return null;
  }
  PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
  if (portletDataHandler == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Do not import portlet data for " + portletId + " because the portlet does not have a "+ "PortletDataHandler");
    }
    return null;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Importing data for " + portletId);
  }
  PortletPreferencesImpl portletPreferencesImpl=null;
  if (portletPreferences != null) {
    portletPreferencesImpl=(PortletPreferencesImpl)PortletPreferencesFactoryUtil.fromDefaultXML(portletPreferences.getPreferences());
  }
  String portletData=portletDataContext.getZipEntryAsString(portletDataElement.attributeValue("path"));
  portletPreferencesImpl=(PortletPreferencesImpl)portletDataHandler.importData(portletDataContext,portletId,portletPreferencesImpl,portletData);
  if (portletPreferencesImpl == null) {
    return null;
  }
  return PortletPreferencesFactoryUtil.toXML(portletPreferencesImpl);
}
