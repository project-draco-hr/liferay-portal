{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(context.getCompanyId(),portletId);
  if (portlet == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Do not delete portlet data for " + portletId + " because the portlet does not exist");
    }
    return null;
  }
  String portletDataHandlerClass=portlet.getPortletDataHandlerClass();
  if (portletDataHandlerClass == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Do not delete portlet data for " + portletId + " because the portlet does not have a "+ "PortletDataHandler");
    }
    return null;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Deleting data for " + portletId);
  }
  PortletPreferencesImpl prefsImpl=(PortletPreferencesImpl)PortletPreferencesSerializer.fromDefaultXML(portletPreferences.getPreferences());
  try {
    prefsImpl=(PortletPreferencesImpl)PortletClassInvoker.invoke(portletId,portletDataHandlerClass,"deleteData",context,portletId,prefsImpl);
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
  if (prefsImpl == null) {
    return null;
  }
  return PortletPreferencesSerializer.toXML(prefsImpl);
}
