{
  long userId=context.getUserId(category.getUserUuid());
  long vocabularyId=MapUtil.getLong(vocabularyPKs,category.getVocabularyId(),category.getVocabularyId());
  long parentCategoryId=MapUtil.getLong(categoryPKs,category.getParentCategoryId(),category.getParentCategoryId());
  if ((parentCategoryId != AssetCategoryConstants.DEFAULT_PARENT_CATEGORY_ID) && (parentCategoryId == category.getParentCategoryId())) {
    String path=getCategoryPath(context,parentCategoryId);
    AssetCategory parentCategory=(AssetCategory)context.getZipEntryAsObject(path);
    Node parentCategoryNode=categoryEl.getParent().selectSingleNode("./category[@path='" + path + "']");
    if (parentCategoryNode != null) {
      importCategory(context,vocabularyPKs,categoryPKs,(Element)parentCategoryNode,parentCategory);
      parentCategoryId=MapUtil.getLong(categoryPKs,category.getParentCategoryId(),category.getParentCategoryId());
    }
  }
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddCommunityPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  serviceContext.setCreateDate(category.getCreateDate());
  serviceContext.setModifiedDate(category.getModifiedDate());
  serviceContext.setScopeGroupId(context.getScopeGroupId());
  AssetCategory importedCategory=null;
  try {
    if (parentCategoryId != AssetCategoryConstants.DEFAULT_PARENT_CATEGORY_ID) {
      AssetCategoryUtil.findByPrimaryKey(parentCategoryId);
    }
    List<Element> propertyEls=categoryEl.elements("property");
    String[] properties=new String[propertyEls.size()];
    for (int i=0; i < properties.length; i++) {
      Element propertyEl=propertyEls.get(i);
      String key=propertyEl.attributeValue("key");
      String value=propertyEl.attributeValue("value");
      properties[i]=key.concat(StringPool.COLON).concat(value);
    }
    AssetCategory existingCategory=AssetCategoryUtil.fetchByV_P_N(vocabularyId,parentCategoryId,category.getName());
    if (existingCategory == null) {
      importedCategory=AssetCategoryLocalServiceUtil.addCategory(category.getUuid(),userId,parentCategoryId,category.getTitleMap(),vocabularyId,properties,serviceContext);
    }
 else {
      importedCategory=AssetCategoryLocalServiceUtil.updateCategory(userId,existingCategory.getCategoryId(),parentCategoryId,category.getTitleMap(),vocabularyId,properties,serviceContext);
    }
    categoryPKs.put(category.getCategoryId(),importedCategory.getCategoryId());
    context.importPermissions(AssetCategory.class,category.getCategoryId(),importedCategory.getCategoryId());
  }
 catch (  NoSuchCategoryException nsce) {
    _log.error("Could not find the parent category for category " + category.getCategoryId());
  }
}
