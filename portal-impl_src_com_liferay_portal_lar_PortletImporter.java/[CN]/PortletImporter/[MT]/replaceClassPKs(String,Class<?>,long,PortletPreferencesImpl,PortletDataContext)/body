{
  String[] oldValues=portletPreferences.getValues(preferenceName,null);
  if (oldValues == null) {
    return;
  }
  Map<Long,Long> primaryKeysMap=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(clazz);
  String[] newValues=new String[oldValues.length];
  int i=0;
  for (  String oldValue : oldValues) {
    String newValue=oldValue;
    String[] oldIdStrings=StringUtil.split(oldValue);
    for (    String oldIdString : oldIdStrings) {
      Long newId=null;
      try {
        long oldId=Long.parseLong(oldIdString);
        newId=MapUtil.getLong(primaryKeysMap,oldId,oldId);
      }
 catch (      NumberFormatException e) {
        newId=replacePrimaryKeyByUUID(oldIdString,clazz,globalGroupId,portletDataContext.getScopeGroupId());
      }
      if (newId != null) {
        newValue=newValue.replaceAll(oldIdString,newId.toString());
      }
    }
    newValues[i++]=newValue;
  }
  portletPreferences.setValues(preferenceName,newValues);
}
