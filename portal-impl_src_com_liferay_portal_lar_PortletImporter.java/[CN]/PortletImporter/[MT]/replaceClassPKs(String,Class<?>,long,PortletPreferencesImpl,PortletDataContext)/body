{
  String[] oldValues=portletPreferences.getValues(preferenceName,null);
  if (oldValues == null) {
    return;
  }
  Map<Long,Long> primaryKeysMap=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(clazz);
  String[] newValues=new String[oldValues.length];
  int i=0;
  for (  String value : oldValues) {
    String newValue=value;
    for (    String oldPK : StringUtil.split(value)) {
      String newPK=null;
      try {
        newPK=StringUtil.valueOf(primaryKeysMap.get(new Long(oldPK)));
      }
 catch (      NumberFormatException nfe) {
      }
      if (Validator.isNull(newPK)) {
        String className=clazz.getName();
        if (AssetCategory.class.getName().equals(className)) {
          AssetCategory category=null;
          try {
            category=AssetCategoryLocalServiceUtil.getAssetCategoryByUuidAndGroupId(oldPK,globalGroupId);
          }
 catch (          NoSuchCategoryException nsce) {
            try {
              category=AssetCategoryLocalServiceUtil.getAssetCategoryByUuidAndGroupId(oldPK,portletDataContext.getGroupId());
            }
 catch (            NoSuchCategoryException nsce2) {
              if (_log.isWarnEnabled()) {
                _log.warn(nsce2.getMessage());
              }
            }
          }
          if (category != null) {
            newPK=StringUtil.valueOf(category.getCategoryId());
          }
        }
 else         if (JournalStructure.class.getName().equals(className)) {
          JournalStructure structure=null;
          try {
            structure=JournalStructureLocalServiceUtil.getJournalStructureByUuidAndGroupId(oldPK,globalGroupId);
          }
 catch (          NoSuchStructureException nsse) {
            try {
              structure=JournalStructureLocalServiceUtil.getJournalStructureByUuidAndGroupId(oldPK,portletDataContext.getGroupId());
            }
 catch (            NoSuchStructureException nsse2) {
              if (_log.isWarnEnabled()) {
                _log.warn(nsse2.getMessage());
              }
            }
          }
          if (structure != null) {
            newPK=StringUtil.valueOf(structure.getId());
          }
        }
      }
      if (Validator.isNotNull(newPK)) {
        newValue=newValue.replaceAll(oldPK,newPK);
      }
    }
    newValues[i++]=newValue;
  }
  portletPreferences.setValues(preferenceName,newValues);
}
