{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(KBWebKeys.THEME_DISPLAY);
  PortletPreferences preferences=renderRequest.getPreferences();
  long defaultValue=GetterUtil.getLong(preferences.getValue("resourcePrimKey",null));
  KBArticle defaultKBArticle=kbArticleService.fetchLatestKBArticle(defaultValue,WorkflowConstants.STATUS_ANY);
  if (defaultKBArticle == null) {
    defaultValue=0;
  }
  String mvcPath=ParamUtil.getString(renderRequest,"mvcPath");
  if ((defaultValue == 0) && mvcPath.equals(viewTemplate)) {
    return 0;
  }
  long resourcePrimKey=ParamUtil.getLong(renderRequest,"resourcePrimKey",defaultValue);
  if ((resourcePrimKey == 0) || (resourcePrimKey != defaultValue)) {
    return resourcePrimKey;
  }
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  if (!KBArticlePermission.contains(permissionChecker,defaultValue,KBActionKeys.VIEW)) {
    return 0;
  }
  return defaultValue;
}
