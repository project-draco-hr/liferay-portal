{
  for (  String blacklistChar : PropsValues.SYNC_FILE_BLACKLIST_CHARS) {
    fileName=fileName.replace(blacklistChar,"_");
  }
  for (  String blacklistCharLast : PropsValues.SYNC_FILE_BLACKLIST_CHARS_LAST) {
    if (blacklistCharLast.startsWith("\\u")) {
      blacklistCharLast=StringEscapeUtils.unescapeJava(blacklistCharLast);
    }
    if (fileName.endsWith(blacklistCharLast)) {
      fileName=fileName.substring(0,fileName.length() - 1);
    }
  }
  if ((extension != null) && !extension.isEmpty()) {
    int x=fileName.lastIndexOf(".");
    if ((x == -1) || !extension.equalsIgnoreCase(fileName.substring(x + 1))) {
      fileName+="." + extension;
    }
  }
  if (fileName.length() > 255) {
    int x=fileName.length() - 1;
    if ((extension != null) && !extension.isEmpty()) {
      x=fileName.lastIndexOf(".");
    }
    int y=x - (fileName.length() - 255);
    fileName=fileName.substring(0,y) + fileName.substring(x);
  }
  return fileName;
}
