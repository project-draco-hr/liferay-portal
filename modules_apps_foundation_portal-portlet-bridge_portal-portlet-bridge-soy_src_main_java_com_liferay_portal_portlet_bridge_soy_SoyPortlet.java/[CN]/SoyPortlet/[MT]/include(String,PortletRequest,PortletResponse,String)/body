{
  try {
    String path=getPath(portletRequest,portletResponse);
    if (Validator.isNull(path)) {
      path=namespace;
    }
    template.put(TemplateConstants.NAMESPACE,_soyPortletHelper.getTemplateNamespace(path));
    if (propagateRequestParameters) {
      propagateRequestParameters(portletRequest);
    }
    Writer writer=null;
    if (portletResponse instanceof MimeResponse) {
      MimeResponse mimeResponse=(MimeResponse)portletResponse;
      writer=UnsyncPrintWriterPool.borrow(mimeResponse.getWriter());
    }
 else {
      writer=new UnsyncStringWriter();
    }
    String portletNamespace=portletResponse.getNamespace();
    String portletComponentId=portletNamespace.concat("PortletComponent");
    template.put("element",StringPool.POUND.concat(portletComponentId));
    template.put("id",portletComponentId);
    template.processTemplate(writer);
    Set<String> requiredModules=getRequiredModules(path);
    String portletJavaScript=_soyPortletHelper.getPortletJavaScript(template,requiredModules,portletResponse.getNamespace());
    writer.write(portletJavaScript);
  }
 catch (  Exception e) {
    throw new PortletException(e);
  }
  if (clearRequestParameters) {
    if (lifecycle.equals(PortletRequest.RENDER_PHASE)) {
      portletResponse.setProperty("clear-request-parameters","true");
    }
  }
}
