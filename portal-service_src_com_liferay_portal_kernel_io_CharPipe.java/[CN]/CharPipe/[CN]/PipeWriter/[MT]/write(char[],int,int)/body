{
  if (_closed) {
    throw new IOException("Stream closed");
  }
  if (length <= 0) {
    return;
  }
  bufferLock.lock();
  try {
    int remaining=length;
    while (remaining > 0) {
      waitUntilNotFull();
      int write=remaining;
      if (remaining > (buffer.length - count)) {
        write=buffer.length - count;
      }
      int sourceBegin=offset + length - remaining;
      if ((buffer.length - writeIndex) >= write) {
        System.arraycopy(chars,sourceBegin,buffer,writeIndex,write);
      }
 else {
        int tailLength=buffer.length - writeIndex;
        int headLength=write - tailLength;
        System.arraycopy(chars,sourceBegin,buffer,writeIndex,tailLength);
        System.arraycopy(chars,sourceBegin + tailLength,buffer,0,headLength);
      }
      increaseWriteIndex(write);
      remaining-=write;
    }
  }
  finally {
    bufferLock.unlock();
  }
}
