{
  while (count == buffer.length) {
    notFull.awaitUninterruptibly();
    if (closed) {
      throw new IOException("Stream closed");
    }
  }
}
