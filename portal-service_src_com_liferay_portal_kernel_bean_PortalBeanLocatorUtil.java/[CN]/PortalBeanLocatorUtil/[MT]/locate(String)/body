{
  BeanLocator beanLocator=getBeanLocator();
  if (beanLocator == null) {
    _log.error("BeanLocator is null");
    Thread.dumpStack();
    if (_log.isDebugEnabled()) {
      Exception e=new Exception();
      _log.debug(e,e);
    }
    throw new BeanLocatorException("BeanLocator has not been set");
  }
  Thread currentThread=Thread.currentThread();
  ClassLoader contextClassLoader=currentThread.getContextClassLoader();
  ClassLoader beanClassLoader=beanLocator.getClassLoader();
  try {
    if (contextClassLoader != beanClassLoader) {
      currentThread.setContextClassLoader(beanClassLoader);
    }
    return beanLocator.locate(name);
  }
  finally {
    if (contextClassLoader != beanClassLoader) {
      currentThread.setContextClassLoader(contextClassLoader);
    }
  }
}
