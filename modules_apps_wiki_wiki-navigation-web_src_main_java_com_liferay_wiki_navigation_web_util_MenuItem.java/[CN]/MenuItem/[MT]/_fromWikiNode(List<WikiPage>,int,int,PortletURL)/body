{
  List<MenuItem> menuItems=new LinkedList<>();
  for (  WikiPage wikiPage : wikiPages) {
    if ((wikiPage.fetchParentPage() != null) && (curDepth == 1)) {
      continue;
    }
    String title=wikiPage.getTitle();
    WikiNode wikiNode=wikiPage.getNode();
    portletURL.setParameter("nodeId",String.valueOf(wikiNode.getNodeId()));
    portletURL.setParameter("title",title);
    MenuItem menuItem=new MenuItem();
    menuItem.setLabel(title);
    menuItem.setURL(portletURL.toString());
    if ((depth >= curDepth) || (depth == WikiNavigationConstants.DEPTH_ALL)) {
      List<MenuItem> children=_fromWikiNode(wikiPage.getViewableChildPages(),curDepth + 1,depth,portletURL);
      menuItem.addChildren(children);
    }
    menuItems.add(menuItem);
  }
  return menuItems;
}
