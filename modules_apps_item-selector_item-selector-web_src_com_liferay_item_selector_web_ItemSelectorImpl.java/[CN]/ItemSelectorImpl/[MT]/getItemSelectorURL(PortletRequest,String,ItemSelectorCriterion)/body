{
  Map<String,String[]> parameters=getItemSelectorParameters(itemSelectedEventName,itemSelectorCriteria);
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PortletURL portletURL=PortletURLFactoryUtil.create(portletRequest,ItemSelectorPortletKeys.ITEM_SELECTOR,themeDisplay.getPlid(),PortletRequest.ACTION_PHASE);
  try {
    portletURL.setPortletMode(PortletMode.VIEW);
  }
 catch (  PortletModeException pme) {
    throw new SystemException(pme);
  }
  try {
    portletURL.setWindowState(LiferayWindowState.POP_UP);
  }
 catch (  WindowStateException wse) {
    throw new SystemException(wse);
  }
  portletURL.setParameter(ActionRequest.ACTION_NAME,"showItemSelector");
  for (  Map.Entry<String,String[]> entry : parameters.entrySet()) {
    portletURL.setParameter(entry.getKey(),entry.getValue());
  }
  return portletURL;
}
