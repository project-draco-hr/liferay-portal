{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  StringBuilder sb=new StringBuilder();
  sb.append("<span class=\"portlet-msg-error\">");
  sb.append(themeDisplay.translate("an-unexpected-error-occurred"));
  sb.append("</span>");
  if (PortalPermissionUtil.contains(permissionChecker,ActionKeys.CONFIGURATION)) {
    sb.append("<pre>");
    sb.append(HtmlUtil.escape(errorMessage));
    sb.append("</pre>");
  }
  renderResponse.setContentType(ContentTypes.TEXT_HTML);
  PortletResponseUtil.write(renderResponse,sb.toString());
}
