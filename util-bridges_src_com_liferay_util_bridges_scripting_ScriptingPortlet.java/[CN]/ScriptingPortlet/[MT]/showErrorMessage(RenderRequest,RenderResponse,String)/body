{
  boolean showDetailedInformation;
  PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
  showDetailedInformation=PortalPermissionUtil.contains(permissionChecker,ActionKeys.CONFIGURATION);
  renderResponse.resetBuffer();
  renderResponse.setContentType("text/html");
  OutputStream os=renderResponse.getPortletOutputStream();
  StringBuilder sb=new StringBuilder();
  if (showDetailedInformation) {
    User user=PortalUtil.getUser(renderRequest);
    sb.append("<span class='portlet-msg-error'>");
    sb.append(LanguageUtil.get(user.getLocale(),"error-running-script"));
    sb.append("</span>");
    sb.append("<pre>");
    sb.append(HtmlUtil.escape(errorMessage));
    sb.append("</pre>");
  }
 else {
    sb.append("<span class='portlet-msg-error'>");
    sb.append(LanguageUtil.get(LocaleUtil.getDefault(),"an-error-occurred.-please-contact-an-administrator"));
    sb.append("</span>");
  }
  os.write(sb.toString().getBytes());
}
