{
  Folder folder=addTempFolder(userId,callerUuid,folderPath);
  File file=null;
  try {
    file=FileUtil.createTempFile(inputStream);
    ServiceContext serviceContext=new ServiceContext();
    serviceContext.setAddGroupPermissions(true);
    serviceContext.setAddGuestPermissions(true);
    FileEntry fileEntry=_localRepository.addFileEntry(userId,folder.getFolderId(),fileName,mimeType,fileName,StringPool.BLANK,StringPool.BLANK,file,serviceContext);
    return fileEntry;
  }
 catch (  IOException ioe) {
    throw new SystemException("Unable to write temporary file",ioe);
  }
 finally {
    FileUtil.delete(file);
  }
}
