{
  User user=UserUtil.findByPrimaryKey(userId);
  String groupId=PortalUtil.getPortletGroupId(plid);
  parentFolderId=getParentFolderId(user.getCompanyId(),parentFolderId);
  Date now=new Date();
  validate(name);
  String folderId=Long.toString(CounterServiceUtil.increment(DLFolder.class.getName()));
  DLFolder folder=DLFolderUtil.create(folderId);
  folder.setGroupId(groupId);
  folder.setCompanyId(user.getCompanyId());
  folder.setUserId(user.getUserId());
  folder.setCreateDate(now);
  folder.setModifiedDate(now);
  folder.setParentFolderId(parentFolderId);
  folder.setName(name);
  folder.setDescription(description);
  DLFolderUtil.update(folder);
  addFolderResources(folder,addCommunityPermissions,addGuestPermissions);
  return folder;
}
