{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  long companyId=ParamUtil.getLong(request,"companyId");
  long nodeId=ParamUtil.getLong(request,"nodeId");
  String title=ParamUtil.getString(request,"title");
  int max=ParamUtil.getInteger(request,"max",SearchContainer.DEFAULT_DELTA);
  String type=ParamUtil.getString(request,"type",RSSUtil.DEFAULT_TYPE);
  double version=ParamUtil.getDouble(request,"version",RSSUtil.DEFAULT_VERSION);
  String displayStyle=ParamUtil.getString(request,"displayStyle",RSSUtil.DISPLAY_STYLE_FULL_CONTENT);
  PortletURL feedURL=PortletURLFactory.getInstance().create(request,PortletKeys.WIKI,layout.getPlid(),PortletRequest.RENDER_PHASE);
  feedURL.setParameter("nodeId",String.valueOf(nodeId));
  String feedUrlStr=feedURL.toString();
  feedURL.setParameter("title",title);
  String entryURL=feedURL.toString();
  Locale locale=themeDisplay.getLocale();
  String rss=StringPool.BLANK;
  if ((nodeId > 0) && (Validator.isNotNull(title))) {
    rss=WikiPageServiceUtil.getPagesRSS(companyId,nodeId,title,max,type,version,displayStyle,feedUrlStr,entryURL,locale);
  }
 else   if (nodeId > 0) {
    rss=WikiPageServiceUtil.getNodePagesRSS(nodeId,max,type,version,displayStyle,feedUrlStr,entryURL);
  }
  return rss.getBytes(StringPool.UTF8);
}
