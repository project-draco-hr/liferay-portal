{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  long plid=ParamUtil.getLong(req,"p_l_id");
  long companyId=ParamUtil.getLong(req,"companyId");
  long nodeId=ParamUtil.getLong(req,"nodeId");
  String title=ParamUtil.getString(req,"title");
  int max=ParamUtil.getInteger(req,"max",SearchContainer.DEFAULT_DELTA);
  String type=ParamUtil.getString(req,"type",RSSUtil.DEFAULT_TYPE);
  double version=ParamUtil.getDouble(req,"version",RSSUtil.DEFAULT_VERSION);
  String displayStyle=ParamUtil.getString(req,"displayStyle",RSSUtil.DISPLAY_STYLE_FULL_CONTENT);
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  String feedURL=PortalUtil.getPortalURL(req) + PortalUtil.getLayoutURL(layout,themeDisplay) + "/wiki/"+ nodeId;
  String entryURL=feedURL + StringPool.SLASH + title;
  Locale locale=req.getLocale();
  String rss=StringPool.BLANK;
  if ((nodeId > 0) && (Validator.isNotNull(title))) {
    try {
      rss=WikiPageServiceUtil.getPagesRSS(companyId,nodeId,title,max,type,version,displayStyle,feedURL,entryURL,locale);
    }
 catch (    Exception e) {
      if (!(e instanceof NoSuchPageException)) {
        if (_log.isWarnEnabled()) {
          _log.warn(e);
        }
      }
    }
  }
 else   if (nodeId > 0) {
    try {
      rss=WikiPageServiceUtil.getNodePagesRSS(nodeId,max,type,version,displayStyle,feedURL,entryURL);
    }
 catch (    Exception e) {
      if (!(e instanceof NoSuchNodeException)) {
        if (_log.isWarnEnabled()) {
          _log.warn(e);
        }
      }
    }
  }
  return rss.getBytes(StringPool.UTF8);
}
