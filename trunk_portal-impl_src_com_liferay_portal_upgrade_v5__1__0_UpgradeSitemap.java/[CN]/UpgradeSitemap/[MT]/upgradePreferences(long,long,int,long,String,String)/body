{
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
  long rootPlid=GetterUtil.getLong(portletPreferences.getValue("root-plid",StringPool.BLANK));
  if (rootPlid > 0) {
    Object[] layout=getLayout(rootPlid);
    if (layout != null) {
      long layoutId=(Long)layout[3];
      portletPreferences.setValue("root-layout-id",String.valueOf(layoutId));
    }
  }
  portletPreferences.setValue("root-plid",null);
  return PortletPreferencesFactoryUtil.toXML(portletPreferences);
}
