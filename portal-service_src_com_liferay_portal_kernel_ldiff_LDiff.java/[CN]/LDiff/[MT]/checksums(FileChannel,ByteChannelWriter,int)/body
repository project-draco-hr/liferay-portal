{
  RollingChecksum reader=new RollingChecksum(original,blockLength);
  checksums.resizeBuffer(BUFFER_FACTOR * 20);
  ByteBuffer buffer=checksums.getBuffer();
  int numBlocks=(int)Math.ceil(original.size() / (double)blockLength);
  checksums.ensureSpace(9);
  buffer.put(PROTOCOL_VERSION);
  buffer.putInt(blockLength);
  buffer.putInt(numBlocks);
  while (reader.hasNext()) {
    reader.nextBlock();
    checksums.ensureSpace(20);
    buffer.putInt(reader.weakChecksum());
    buffer.put(reader.strongChecksum());
  }
}
