{
  Set<Long> remoteSyncSiteIds=new HashSet<>();
  if (_remoteSyncSites == null) {
    _remoteSyncSites=JSONUtil.readValue(response,new TypeReference<List<SyncSite>>(){
    }
);
  }
  for (  SyncSite remoteSyncSite : _remoteSyncSites) {
    SyncSite localSyncSite=SyncSiteService.fetchSyncSite(remoteSyncSite.getGroupId(),getSyncAccountId());
    SyncAccount syncAccount=SyncAccountService.fetchSyncAccount(getSyncAccountId());
    String remoteSyncSiteName=remoteSyncSite.getName();
    if (!FileUtil.isValidFileName(remoteSyncSiteName)) {
      remoteSyncSiteName=String.valueOf(remoteSyncSite.getGroupId());
    }
    if (localSyncSite == null) {
      remoteSyncSite.setFilePathName(FileUtil.getFilePathName(syncAccount.getFilePathName(),remoteSyncSiteName));
      remoteSyncSite.setRemoteSyncTime(-1);
      remoteSyncSite.setSyncAccountId(getSyncAccountId());
      SyncSiteService.update(remoteSyncSite);
      remoteSyncSiteIds.add(remoteSyncSite.getSyncSiteId());
      SyncFileService.addSyncFile(null,null,null,remoteSyncSite.getFilePathName(),null,remoteSyncSite.getName(),0,remoteSyncSite.getGroupId(),SyncFile.STATE_SYNCED,remoteSyncSite.getSyncAccountId(),SyncFile.TYPE_SYSTEM,false);
    }
 else {
      String localSyncSiteName=localSyncSite.getName();
      localSyncSite.setDescription(remoteSyncSite.getDescription());
      localSyncSite.setFriendlyURL(remoteSyncSite.getFriendlyURL());
      localSyncSite.setName(remoteSyncSite.getName());
      localSyncSite.setType(remoteSyncSite.getType());
      localSyncSite.setTypeSettings(remoteSyncSite.getTypeSettings());
      localSyncSite.setSite(remoteSyncSite.getSite());
      SyncSiteService.update(localSyncSite);
      if (!localSyncSiteName.equals(remoteSyncSite.getName())) {
        SyncSiteService.setFilePathName(localSyncSite.getSyncSiteId(),remoteSyncSiteName);
        FileUtil.moveFile(Paths.get(localSyncSite.getFilePathName()),FileUtil.getFilePath(syncAccount.getFilePathName(),remoteSyncSiteName));
      }
      remoteSyncSiteIds.add(localSyncSite.getSyncSiteId());
    }
  }
  List<SyncSite> localSyncSites=SyncSiteService.findSyncSites(getSyncAccountId());
  for (  SyncSite localSyncSite : localSyncSites) {
    if (remoteSyncSiteIds.contains(localSyncSite.getSyncSiteId())) {
      continue;
    }
    SyncSiteService.deleteSyncSite(localSyncSite.getSyncSiteId());
  }
}
