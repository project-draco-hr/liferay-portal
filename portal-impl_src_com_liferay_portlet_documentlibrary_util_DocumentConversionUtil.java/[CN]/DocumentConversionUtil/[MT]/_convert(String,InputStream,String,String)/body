{
  if (!PrefsPropsUtil.getBoolean(PropsKeys.OPENOFFICE_SERVER_ENABLED,PropsValues.OPENOFFICE_SERVER_ENABLED)) {
    return null;
  }
  StringBuilder sb=new StringBuilder();
  sb.append(SystemProperties.get(SystemProperties.TMP_DIR));
  sb.append("/liferay/document_conversion/");
  sb.append(id);
  sb.append(StringPool.PERIOD);
  sb.append(targetExtension);
  String fileName=sb.toString();
  File file=new File(fileName);
  if (!PropsValues.OPENOFFICE_CACHE_ENABLED || !file.exists()) {
    DocumentFormatRegistry registry=new DefaultDocumentFormatRegistry();
    DocumentConverter converter=_getConverter(registry);
    if (sourceExtension.equals("htm")) {
      sourceExtension="html";
    }
    DocumentFormat inputFormat=registry.getFormatByFileExtension(sourceExtension);
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    DocumentFormat outputFormat=registry.getFormatByFileExtension(targetExtension);
    converter.convert(is,inputFormat,baos,outputFormat);
    FileUtil.write(file,baos.toByteArray());
  }
  return new FileInputStream(file);
}
