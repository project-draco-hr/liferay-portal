{
  try {
    IGImage image=igImagePersistence.findByPrimaryKey(imageId);
    IGFolder folder=getFolder(image,folderId);
    RenderedImage renderedImage=null;
    byte[] bytes=null;
    if (file != null) {
      if (file.exists()) {
        renderedImage=ImageUtil.read(file).getRenderedImage();
        bytes=FileUtil.getBytes(file);
      }
      validate(file,bytes);
    }
    image.setModifiedDate(new Date());
    image.setFolderId(folder.getFolderId());
    image.setDescription(description);
    igImagePersistence.update(image);
    if (renderedImage != null) {
      saveImages(image.getLargeImageId(),renderedImage,image.getSmallImageId(),file,bytes,contentType);
    }
    updateTagsAsset(userId,image,tagsEntries);
    try {
      Indexer.updateImage(image.getCompanyId(),folder.getGroupId(),folder.getFolderId(),imageId,description,tagsEntries);
    }
 catch (    IOException ioe) {
      _log.error("Indexing " + imageId,ioe);
    }
    return image;
  }
 catch (  IOException ioe) {
    throw new ImageSizeException(ioe);
  }
}
