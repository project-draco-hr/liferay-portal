{
  if ((nameWithExtension.indexOf("\\\\") != -1) || (nameWithExtension.indexOf("//") != -1) || (nameWithExtension.indexOf(":") != -1)|| (nameWithExtension.indexOf("*") != -1)|| (nameWithExtension.indexOf("?") != -1)|| (nameWithExtension.indexOf("\"") != -1)|| (nameWithExtension.indexOf("<") != -1)|| (nameWithExtension.indexOf(">") != -1)|| (nameWithExtension.indexOf("|") != -1)|| (nameWithExtension.indexOf("&") != -1)|| (nameWithExtension.indexOf("[") != -1)|| (nameWithExtension.indexOf("]") != -1)|| (nameWithExtension.indexOf("'") != -1)) {
    throw new ImageNameException();
  }
  boolean validImageExtension=false;
  String[] imageExtensions=PropsUtil.getArray(PropsUtil.IG_IMAGE_EXTENSIONS);
  for (int i=0; i < imageExtensions.length; i++) {
    if (StringPool.STAR.equals(imageExtensions[i]) || StringUtil.endsWith(nameWithExtension,imageExtensions[i])) {
      validImageExtension=true;
      break;
    }
  }
  if (!validImageExtension) {
    throw new ImageNameException();
  }
  String imageNameProper=FileUtil.stripExtension(nameWithExtension);
  String imageType=FileUtil.getExtension(nameWithExtension);
  List<IGImage> images=igImagePersistence.findByF_N(folderId,imageNameProper);
  if (imageType.matches("^jpe?g$")) {
    imageType=ImageUtil.TYPE_JPEG;
  }
 else   if (imageType.matches("^tiff?$")) {
    imageType=ImageUtil.TYPE_TIFF;
  }
  for (  IGImage image : images) {
    if (imageType.equals(image.getImageType())) {
      throw new DuplicateImageNameException();
    }
  }
}
