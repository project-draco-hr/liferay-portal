{
  RenderedImage thumbnail=ImageProcessorUtil.scale(renderedImage,dimension,dimension);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  if (contentType.indexOf("bmp") != -1) {
    ImageEncoder encoder=ImageCodec.createImageEncoder("BMP",baos,null);
    encoder.encode(thumbnail);
  }
 else   if (contentType.indexOf("gif") != -1) {
    ImageProcessorUtil.encodeGIF(thumbnail,baos);
  }
 else   if (contentType.indexOf("jpg") != -1 || contentType.indexOf("jpeg") != -1) {
    ImageIO.write(thumbnail,"jpeg",baos);
  }
 else   if (contentType.indexOf("png") != -1) {
    ImageIO.write(thumbnail,"png",baos);
  }
 else   if (contentType.indexOf("tif") != -1) {
    ImageEncoder encoder=ImageCodec.createImageEncoder("TIFF",baos,null);
    encoder.encode(thumbnail);
  }
  imageLocalService.updateImage(imageId,baos.toByteArray());
}
