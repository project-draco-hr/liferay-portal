{
  RenderedImage thumbnail=ImageUtil.scale(renderedImage,dimension,dimension);
  ByteArrayMaker bam=new ByteArrayMaker();
  if (contentType.indexOf("bmp") != -1) {
    ImageEncoder encoder=ImageCodec.createImageEncoder("BMP",bam,null);
    encoder.encode(thumbnail);
  }
 else   if (contentType.indexOf("gif") != -1) {
    ImageUtil.encodeGIF(thumbnail,bam);
  }
 else   if (contentType.indexOf("jpg") != -1 || contentType.indexOf("jpeg") != -1) {
    ImageIO.write(thumbnail,"jpeg",bam);
  }
 else   if (contentType.indexOf("png") != -1) {
    ImageIO.write(thumbnail,"png",bam);
  }
 else   if (contentType.indexOf("tif") != -1) {
    ImageEncoder encoder=ImageCodec.createImageEncoder("TIFF",bam,null);
    encoder.encode(thumbnail);
  }
  ImageLocalUtil.updateImage(imageId,bam.toByteArray());
}
