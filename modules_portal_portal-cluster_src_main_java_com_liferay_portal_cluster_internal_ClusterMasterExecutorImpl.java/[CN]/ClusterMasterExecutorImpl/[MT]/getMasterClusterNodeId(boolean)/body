{
  String masterClusterNodeId=null;
  boolean master=false;
  while (true) {
    ClusterChannel clusterChannel=_clusterExecutorImpl.getClusterChannel();
    Address localAddress=clusterChannel.getLocalAddress();
    ClusterReceiver clusterReceiver=clusterChannel.getClusterReceiver();
    Address coordinator=clusterReceiver.getCoordinator();
    master=localAddress.equals(coordinator);
    if (master) {
      masterClusterNodeId=_localClusterNodeId;
    }
 else {
      ClusterNode clusterNode=_clusterExecutorImpl.getClusterNode(coordinator);
      if (clusterNode != null) {
        masterClusterNodeId=clusterNode.getClusterNodeId();
      }
    }
    if (Validator.isNotNull(masterClusterNodeId)) {
      break;
    }
    if (_log.isInfoEnabled()) {
      _log.info("Unable to get cluster node information for coordinator " + coordinator + ", reattempting to acquire");
    }
  }
  if (master == _master) {
    return masterClusterNodeId;
  }
  _master=master;
  if (notify) {
    notifyMasterTokenTransitionListeners(master);
  }
  return masterClusterNodeId;
}
