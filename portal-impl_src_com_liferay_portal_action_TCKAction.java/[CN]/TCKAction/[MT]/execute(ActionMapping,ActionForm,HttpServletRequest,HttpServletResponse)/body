{
  try {
    if (!PropsValues.TCK_URL) {
      throw new PrincipalException();
    }
    ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
    String[] portletIds=req.getParameterValues("portletId");
    if (portletIds == null) {
      portletIds=req.getParameterValues("portletName");
    }
    for (int i=0; i < portletIds.length; i++) {
      String[] nameAndWar=StringUtil.split(portletIds[i],"/");
      portletIds[i]=PortalUtil.getJsSafePortletId(nameAndWar[1] + PortletConstants.WAR_SEPARATOR + nameAndWar[0]);
    }
    long userId=2;
    long groupId=14;
    Layout layout=LayoutLocalServiceUtil.addLayout(userId,groupId,false,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID,"TCKAction",StringPool.BLANK,StringPool.BLANK,LayoutConstants.TYPE_PORTLET,false,StringPool.BLANK);
    LayoutTypePortlet layoutType=(LayoutTypePortlet)layout.getLayoutType();
    for (int i=0; i < portletIds.length; i++) {
      layoutType.addPortletId(userId,portletIds[i]);
    }
    LayoutLocalServiceUtil.updateLayout(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId(),layout.getTypeSettings());
    req.setAttribute(WebKeys.FORWARD_URL,themeDisplay.getPathMain() + "/portal/layout?p_l_id=" + layout.getPlid());
    return mapping.findForward(ActionConstants.COMMON_FORWARD_JSP);
  }
 catch (  Exception e) {
    PortalUtil.sendError(e,req,res);
    return null;
  }
}
