{
  try {
    if (!GetterUtil.getBoolean(PropsUtil.get(PropsUtil.TCK_URL))) {
      throw new PrincipalException();
    }
    ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
    String[] portletIds=req.getParameterValues("portletId");
    for (int i=0; i < portletIds.length; i++) {
      String[] nameAndWar=StringUtil.split(portletIds[i],"/");
      portletIds[i]=PortalUtil.getJsSafePortletId(nameAndWar[1] + PortletImpl.WAR_SEPARATOR + nameAndWar[0]);
    }
    long userId=2;
    long groupId=13;
    Layout layout=LayoutLocalServiceUtil.addLayout(userId,groupId,false,LayoutImpl.DEFAULT_PARENT_LAYOUT_ID,"TCKAction",StringPool.BLANK,StringPool.BLANK,LayoutImpl.TYPE_PORTLET,false,StringPool.BLANK);
    LayoutTypePortlet layoutType=(LayoutTypePortlet)layout.getLayoutType();
    for (int i=0; i < portletIds.length; i++) {
      layoutType.addPortletId(userId,portletIds[i]);
    }
    LayoutLocalServiceUtil.updateLayout(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId(),layout.getTypeSettings());
    req.setAttribute(WebKeys.FORWARD_URL,themeDisplay.getPathMain() + "/portal/layout?p_l_id=" + layout.getPlid());
    return mapping.findForward(ActionConstants.COMMON_FORWARD_JSP);
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    return mapping.findForward(ActionConstants.COMMON_ERROR);
  }
}
