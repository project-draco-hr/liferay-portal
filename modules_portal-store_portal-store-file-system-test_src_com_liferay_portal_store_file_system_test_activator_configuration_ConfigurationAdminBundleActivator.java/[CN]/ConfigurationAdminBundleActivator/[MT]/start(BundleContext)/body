{
  ServiceReference<ConfigurationAdmin> serviceReference=bundleContext.getServiceReference(ConfigurationAdmin.class);
  try {
    _advancedFileSystemConfiguration=_getConfiguration(bundleContext,serviceReference,"com.liferay.portal.store.file.system.configuration." + "AdvancedFileSystemConfiguration");
    Dictionary<String,Object> properties=new Hashtable<>();
    properties.put("rootDir",_ADVANCED_ROOT_DIR);
    _advancedFileSystemConfiguration.update(properties);
    _waitForService(bundleContext,_advancedFileSystemConfiguration,"com.liferay.portal.store.file.system.AdvancedFileSystemStore");
    _fileSystemConfiguration=_getConfiguration(bundleContext,serviceReference,"com.liferay.portal.store.file.system.configuration." + "FileSystemConfiguration");
    properties=new Hashtable<>();
    properties.put("rootDir",_ROOT_DIR);
    _fileSystemConfiguration.update(properties);
    _waitForService(bundleContext,_fileSystemConfiguration,"com.liferay.portal.store.file.system.FileSystemStore");
  }
  finally {
    bundleContext.ungetService(serviceReference);
  }
}
