{
  ServiceReference<ConfigurationAdmin> serviceReference=bundleContext.getServiceReference(ConfigurationAdmin.class);
  try {
    _advancedFileSystemStoreConfiguration=getConfiguration(bundleContext,serviceReference,"com.liferay.portal.store.file.system.configuration." + "AdvancedFileSystemStoreConfiguration");
    Dictionary<String,Object> properties=new Hashtable<>();
    properties.put("rootDir",_ADVANCED_ROOT_DIR);
    _advancedFileSystemStoreConfiguration.update(properties);
    waitForService(bundleContext,_advancedFileSystemStoreConfiguration,"com.liferay.portal.store.file.system.AdvancedFileSystemStore");
    _fileSystemStoreConfiguration=getConfiguration(bundleContext,serviceReference,"com.liferay.portal.store.file.system.configuration." + "FileSystemStoreConfiguration");
    properties=new Hashtable<>();
    properties.put("rootDir",_ROOT_DIR);
    _fileSystemStoreConfiguration.update(properties);
    waitForService(bundleContext,_fileSystemStoreConfiguration,"com.liferay.portal.store.file.system.FileSystemStore");
  }
  finally {
    bundleContext.ungetService(serviceReference);
  }
}
