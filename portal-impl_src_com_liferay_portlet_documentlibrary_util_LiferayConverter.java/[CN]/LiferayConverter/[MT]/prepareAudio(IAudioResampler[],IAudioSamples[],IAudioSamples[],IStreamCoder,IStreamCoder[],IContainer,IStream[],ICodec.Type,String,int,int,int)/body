{
  IStream outputIStream=outputIContainer.addNewStream(index);
  outputIStreams[index]=outputIStream;
  IStreamCoder outputIStreamCoder=outputIStream.getStreamCoder();
  outputIStreamCoders[index]=outputIStreamCoder;
  int bitRate=inputIStreamCoder.getBitRate();
  if (bitRate == 0) {
    bitRate=DEFAULT_BIT_RATE;
  }
  outputIStreamCoder.setBitRate(bitRate);
  outputIStreamCoder.setChannels(getAudioEncodingChannels(outputIContainer,channels));
  ICodec iCodec=getAudioEncodingICodec(outputIContainer);
  if (iCodec == null) {
    iCodec=ICodec.guessEncodingCodec(null,null,outputURL,null,inputICodecType);
  }
  if (iCodec == null) {
    throw new RuntimeException("Unable to determine " + inputICodecType + " encoder for "+ outputURL);
  }
  outputIStreamCoder.setCodec(iCodec);
  outputIStreamCoder.setGlobalQuality(0);
  outputIStreamCoder.setSampleRate(rate);
  iAudioResamplers[index]=createIAudioResampler(inputIStreamCoder,outputIStreamCoder);
  inputIAudioSamples[index]=IAudioSamples.make(1024,inputIStreamCoder.getChannels());
  outputIAudioSamples[index]=IAudioSamples.make(1024,outputIStreamCoder.getChannels());
}
