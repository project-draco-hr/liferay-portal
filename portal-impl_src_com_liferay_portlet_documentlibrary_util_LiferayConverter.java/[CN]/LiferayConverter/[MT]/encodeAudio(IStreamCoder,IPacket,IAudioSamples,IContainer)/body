{
  int numSamplesConsumed=0;
  int returnValue=0;
  while (numSamplesConsumed < outputIAudioSample.getNumSamples()) {
    returnValue=outputIStreamCoder.encodeAudio(outputIPacket,outputIAudioSample,numSamplesConsumed);
    if (returnValue <= 0) {
      throw new RuntimeException("Cannot encode audio");
    }
    numSamplesConsumed+=returnValue;
    if (outputIPacket.isComplete()) {
      returnValue=outputIContainer.writePacket(outputIPacket,true);
      if (returnValue < 0) {
        throw new RuntimeException("Cannot write audio packet");
      }
    }
  }
}
