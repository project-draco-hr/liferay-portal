{
  int returnValue=inputIStreamCoder.decodeVideo(inputIVideoPicture,inputIPacket,0);
  if (returnValue <= 0) {
    return returnValue;
  }
  updateVideoTimeStamp(inputIVideoPicture,timeStampOffset);
  if (inputIVideoPicture.isComplete()) {
    if (thumbnailFile != null) {
      BufferedImage image=null;
      if (_converterType == null) {
        _converterType=ConverterFactory.findRegisteredConverter(ConverterFactory.XUGGLER_BGR_24);
      }
      if (_converterType == null) {
        throw new UnsupportedOperationException("No converter \"" + ConverterFactory.XUGGLER_BGR_24 + "\" found");
      }
      if (_videoConverter == null) {
        _videoConverter=ConverterFactory.createConverter(_converterType.getDescriptor(),inputIVideoPicture);
      }
      image=_videoConverter.toImage(inputIVideoPicture);
      thumbnailFile.createNewFile();
      RenderedImage renderedImage=ImageProcessorUtil.scale(image,thumbnailHeight,thumbnailWidth);
      ImageIO.write(renderedImage,thumbnailExtension,new FileOutputStream(thumbnailFile));
      return THUMBNAIL_GENERATED;
    }
 else {
      IVideoPicture outputIVideoPicture=null;
      outputIVideoPicture=resampleVideo(iVideoResampler,inputIVideoPicture,resampledIVideoPicture);
      outputIVideoPicture.setQuality(0);
      encodeVideo(outputIStreamCoder,outputIVideoPicture,outputIPacket,outputIContainer);
    }
  }
  return 1;
}
