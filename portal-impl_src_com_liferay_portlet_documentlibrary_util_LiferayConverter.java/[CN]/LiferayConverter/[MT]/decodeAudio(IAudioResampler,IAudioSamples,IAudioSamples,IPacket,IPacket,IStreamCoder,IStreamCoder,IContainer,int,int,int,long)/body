{
  int offset=0;
  while (offset < inputIPacket.getSize()) {
    boolean stopDecoding=false;
    int value=inputIStreamCoder.decodeAudio(inputIAudioSample,inputIPacket,offset);
    if (value <= 0) {
      if ((previousPacketSize == currentPacketSize) && (previousPacketSize != -1)) {
        throw new RuntimeException("Unable to decode audio stream " + streamIndex);
      }
 else {
        stopDecoding=true;
      }
    }
    updateAudioTimeStamp(inputIAudioSample,timeStampOffset);
    offset+=value;
    IAudioSamples outputIAudioSample=resampleAudio(iAudioResampler,inputIAudioSample,resampledIAudioSample);
    encodeAudio(outputIStreamCoder,outputIPacket,outputIAudioSample,outputIContainer);
    if (stopDecoding) {
      if (_log.isDebugEnabled()) {
        _log.debug("Stop decoding audio stream " + streamIndex);
      }
      break;
    }
  }
}
