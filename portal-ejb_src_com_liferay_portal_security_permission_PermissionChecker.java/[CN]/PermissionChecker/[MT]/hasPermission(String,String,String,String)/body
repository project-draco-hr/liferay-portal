{
  if (signedIn && (permissionCheckerBag == null)) {
    try {
      List userOrgs=OrganizationLocalServiceUtil.getUserOrganizations(user.getUserId());
      List userOrgGroups=GroupServiceUtil.getOrganizationsGroups(userOrgs);
      permissionCheckerBag=new PermissionCheckerBag(userOrgs,userOrgGroups);
    }
 catch (    Exception e) {
      _log.error(StackTraceUtil.getStackTrace(e));
    }
  }
  long start=0;
  if (_log.isDebugEnabled()) {
    start=System.currentTimeMillis();
  }
  if (user == null) {
    return false;
  }
  String resultsKey=getResultsKey(groupId,name,primKey,actionId);
  Boolean resultsValue=(Boolean)results.get(resultsKey);
  if (resultsValue == null) {
    resultsValue=new Boolean(hasPermissionImpl(groupId,name,primKey,actionId));
    results.put(resultsKey,resultsValue);
    if (_log.isDebugEnabled()) {
      long end=System.currentTimeMillis();
      _log.debug("Checking permission for " + groupId + " "+ name+ " "+ primKey+ " "+ actionId+ " takes "+ (end - start)+ " ms");
    }
  }
  return resultsValue.booleanValue();
}
