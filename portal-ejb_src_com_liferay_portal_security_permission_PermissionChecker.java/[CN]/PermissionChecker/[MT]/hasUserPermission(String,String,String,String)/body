{
  long start=0;
  if (_log.isDebugEnabled()) {
    start=System.currentTimeMillis();
  }
  String companyId=user.getActualCompanyId();
  if (isAdmin(companyId,groupId,name)) {
    return true;
  }
  String[] resourceIds=new String[3];
  try {
    Resource resource=ResourceServiceUtil.getResource(companyId,name,Resource.TYPE_CLASS,Resource.SCOPE_INDIVIDUAL,primKey);
    resourceIds[0]=resource.getResourceId();
  }
 catch (  NoSuchResourceException nsre) {
  }
  try {
    if (groupId != null) {
      Resource resource=ResourceServiceUtil.getResource(companyId,name,Resource.TYPE_CLASS,Resource.SCOPE_GROUP,groupId);
      resourceIds[1]=resource.getResourceId();
    }
  }
 catch (  NoSuchResourceException nsre) {
  }
  try {
    Resource resource=ResourceServiceUtil.getResource(companyId,name,Resource.TYPE_CLASS,Resource.SCOPE_COMPANY,companyId);
    resourceIds[2]=resource.getResourceId();
  }
 catch (  NoSuchResourceException nsre) {
  }
  if (_log.isDebugEnabled()) {
    long end=System.currentTimeMillis();
    _log.debug("Getting user resources for " + groupId + " "+ name+ " "+ primKey+ " "+ actionId+ " takes "+ (end - start)+ " ms");
  }
  boolean value=PermissionServiceUtil.hasUserPermissions(user.getUserId(),groupId,actionId,resourceIds,permissionCheckerBag);
  if (_log.isDebugEnabled()) {
    long end=System.currentTimeMillis();
    _log.debug("Checking user permission for " + groupId + " "+ name+ " "+ primKey+ " "+ actionId+ " takes "+ (end - start)+ " ms");
  }
  return value;
}
