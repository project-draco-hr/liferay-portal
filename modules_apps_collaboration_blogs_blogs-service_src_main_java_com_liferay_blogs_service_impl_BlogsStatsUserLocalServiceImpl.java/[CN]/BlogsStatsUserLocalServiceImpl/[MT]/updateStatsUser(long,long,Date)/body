{
  Date now=new Date();
  int entryCount=blogsEntryPersistence.countByG_U_LtD_S(groupId,userId,now,WorkflowConstants.STATUS_APPROVED);
  if (entryCount == 0) {
    try {
      blogsStatsUserPersistence.removeByG_U(groupId,userId);
    }
 catch (    NoSuchStatsUserException nssue) {
      if (_log.isWarnEnabled()) {
        _log.warn(nssue,nssue);
      }
    }
    return;
  }
  BlogsStatsUser statsUser=getStatsUser(groupId,userId);
  statsUser.setEntryCount(entryCount);
  BlogsEntry blogsEntry=blogsEntryPersistence.findByG_U_LtD_S_First(groupId,userId,now,WorkflowConstants.STATUS_APPROVED,new EntryDisplayDateComparator());
  Date lastDisplayDate=blogsEntry.getDisplayDate();
  Date lastPostDate=statsUser.getLastPostDate();
  if ((displayDate != null) && displayDate.before(now)) {
    if (lastPostDate == null) {
      statsUser.setLastPostDate(displayDate);
    }
 else     if (displayDate.after(lastPostDate)) {
      statsUser.setLastPostDate(displayDate);
    }
 else     if (lastDisplayDate.before(lastPostDate)) {
      statsUser.setLastPostDate(lastDisplayDate);
    }
  }
 else   if ((lastPostDate == null) || lastPostDate.before(lastDisplayDate)) {
    statsUser.setLastPostDate(lastDisplayDate);
  }
  blogsStatsUserPersistence.update(statsUser);
}
