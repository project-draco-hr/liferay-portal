{
  try {
    long groupId=ParamUtil.getLong(req,"groupId");
    String articleId=ParamUtil.getString(req,"articleId");
    JournalArticle article=JournalArticleLocalServiceUtil.getLatestArticle(groupId,articleId,Boolean.TRUE);
    ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
    String languageId=LanguageUtil.getLanguageId(req);
    if (Validator.isNull(languageId)) {
      languageId=themeDisplay.getLanguageId();
    }
    Map tokens=JournalUtil.getTokens(groupId,themeDisplay);
    String xml=article.getContentByLocale(languageId);
    String contentType=ContentTypes.TEXT_HTML_UTF8;
    Document doc=null;
    Element root=null;
    if (article.isTemplateDriven()) {
      SAXReader reader=new SAXReader();
      doc=reader.read(new StringReader(xml));
      root=doc.getRootElement();
      addProcessingInstructions(doc,themeDisplay,article);
      JournalUtil.addAllReservedEls(root,tokens,article);
      xml=JournalUtil.formatXML(doc);
      contentType=ContentTypes.TEXT_XML_UTF8;
    }
    String fileName=null;
    byte[] byteArray=xml.getBytes();
    ServletResponseUtil.sendFile(res,fileName,byteArray,contentType);
    return null;
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    return mapping.findForward(ActionConstants.COMMON_ERROR);
  }
}
