{
  try {
    long groupId=ParamUtil.getLong(request,"groupId");
    String articleId=ParamUtil.getString(request,"articleId");
    String languageId=LanguageUtil.getLanguageId(request);
    JournalArticle article=JournalArticleServiceUtil.getLatestArticle(groupId,articleId,WorkflowConstants.STATUS_APPROVED);
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    Map<String,String> tokens=JournalUtil.getTokens(groupId,themeDisplay);
    String xml=article.getContentByLocale(languageId);
    Document doc=SAXReaderUtil.read(xml);
    Element root=doc.getRootElement();
    addProcessingInstructions(doc,request,themeDisplay,article);
    JournalUtil.addAllReservedEls(root,tokens,article);
    xml=DDMXMLUtil.formatXML(doc);
    String contentType=ContentTypes.TEXT_XML_UTF8;
    String fileName=null;
    byte[] bytes=xml.getBytes();
    ServletResponseUtil.sendFile(request,response,fileName,bytes,contentType);
    return null;
  }
 catch (  Exception e) {
    PortalUtil.sendError(e,request,response);
    return null;
  }
}
