{
  if ((PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM != 5)) {
    return query;
  }
  BooleanQuery fullQuery=BooleanQueryFactoryUtil.create();
  BooleanQuery permissionQuery=BooleanQueryFactoryUtil.create();
  try {
    List<Role> roles=RoleLocalServiceUtil.getUserRoles(userId);
    for (    Role role : roles) {
      if (role.getName().equals(RoleConstants.ADMINISTRATOR)) {
        return query;
      }
      permissionQuery.addTerm(Field.ROLE_ID,role.getRoleId());
    }
    fullQuery.add(query,BooleanClauseOccur.MUST);
    fullQuery.add(permissionQuery,BooleanClauseOccur.MUST);
  }
 catch (  Exception e) {
    _log.error(e,e);
    return query;
  }
  return fullQuery;
}
