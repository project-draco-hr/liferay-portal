{
  File[] classPathFiles=null;
  if (classLoader != null) {
    URL servicePropertiesURL=classLoader.getResource("service.properties");
    String servicePropertiesPath=null;
    try {
      servicePropertiesPath=URLDecoder.decode(servicePropertiesURL.getPath(),StringPool.UTF8);
    }
 catch (    Exception e) {
    }
    File classPathFile=null;
    File libDir=null;
    int pos=servicePropertiesPath.indexOf("_wl_cls_gen.jar!");
    if (pos != -1) {
      String wlClsGenJarPath=servicePropertiesPath.substring(0,pos + 15);
      classPathFile=new File(wlClsGenJarPath);
      libDir=new File(classPathFile.getParent());
    }
 else {
      File servicePropertiesFile=new File(servicePropertiesPath);
      classPathFile=servicePropertiesFile.getParentFile();
      libDir=new File(classPathFile.getParent(),"lib");
    }
    classPathFiles=new File[2];
    classPathFiles[0]=classPathFile;
    FindFile findFile=new WildcardFindFile("*-portlet-service.jar");
    findFile.searchPath(libDir);
    classPathFiles[1]=findFile.nextFile();
    if (classPathFiles[1] == null) {
      File classesDir=new File(libDir.getParent(),"classes");
      classPathFiles[1]=classesDir;
    }
  }
 else {
    Thread currentThread=Thread.currentThread();
    classLoader=currentThread.getContextClassLoader();
    File portalImplJarFile=new File(PortalUtil.getPortalLibDir(),"portal-impl.jar");
    File portalServiceJarFile=new File(PortalUtil.getGlobalLibDir(),"portal-service.jar");
    if (portalImplJarFile.exists() && portalServiceJarFile.exists()) {
      classPathFiles=new File[2];
      classPathFiles[0]=portalImplJarFile;
      classPathFiles[1]=portalServiceJarFile;
    }
 else {
      classPathFiles=ClassLoaderUtil.getDefaultClasspath(classLoader);
    }
  }
  _classLoader=classLoader;
  _configure(classPathFiles);
}
