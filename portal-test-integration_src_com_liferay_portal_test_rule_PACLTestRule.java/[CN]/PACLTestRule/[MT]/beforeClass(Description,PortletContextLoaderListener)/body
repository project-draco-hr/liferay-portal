{
  _testClass=_loadTestClass(description.getTestClass());
  _instance=_testClass.newInstance();
  ServletContext servletContext=ServletContextPool.get(PortalUtil.getServletContextName());
  if (servletContext == null) {
    servletContext=new AutoDeployMockServletContext(new FileSystemResourceLoader());
    servletContext.setAttribute(InvokerFilterHelper.class.getName(),new InvokerFilterHelper());
    ServletContextPool.put(PortalUtil.getPathContext(),servletContext);
  }
  HotDeployUtil.reset();
  HotDeployUtil.registerListener(new HookHotDeployListener());
  HotDeployUtil.setCapturePrematureEvents(false);
  PortalLifecycleUtil.flushInits();
  ClassLoader classLoader=_testClass.getClassLoader();
  MockServletContext mockServletContext=new MockServletContext(new PACLResourceLoader(classLoader));
  mockServletContext.setServletContextName("a-test-hook");
  HotDeployEvent hotDeployEvent=getHotDeployEvent(mockServletContext,classLoader);
  HotDeployUtil.fireDeployEvent(hotDeployEvent);
  ClassLoaderPool.register(hotDeployEvent.getServletContextName(),hotDeployEvent.getContextClassLoader());
  PortletClassLoaderUtil.setServletContextName(hotDeployEvent.getServletContextName());
  try {
    portletContextLoaderListener.contextInitialized(new ServletContextEvent(mockServletContext));
  }
  finally {
    ClassLoaderPool.unregister(hotDeployEvent.getServletContextName());
    PortletClassLoaderUtil.setServletContextName(null);
  }
  LazyConnectionDataSourceProxy lazyConnectionDataSourceProxy=(LazyConnectionDataSourceProxy)InfrastructureUtil.getDataSource();
  DataSource paclDataSource=lazyConnectionDataSourceProxy.getTargetDataSource();
  Field field=ReflectionUtil.getDeclaredField(paclDataSource.getClass(),"_dataSource");
  _originalDataSource=(DataSource)field.get(paclDataSource);
  field.set(paclDataSource,getDummyDataSource());
  return hotDeployEvent;
}
