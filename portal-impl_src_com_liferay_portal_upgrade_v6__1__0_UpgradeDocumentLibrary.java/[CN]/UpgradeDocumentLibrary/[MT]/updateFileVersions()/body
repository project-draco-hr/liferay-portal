{
  try (LoggingTimer loggingTimer=new LoggingTimer()){
    try (PreparedStatement ps=connection.prepareStatement("select groupId, fileVersionId, folderId, name, extension" + " from DLFileVersion");ResultSet rs=ps.executeQuery()){
      while (rs.next()) {
        long groupId=rs.getLong("groupId");
        long fileVersionId=rs.getLong("fileVersionId");
        long folderId=rs.getLong("folderId");
        String name=rs.getString("name");
        String extension=rs.getString("extension");
        String mimeType=MimeTypesUtil.getExtensionContentType(extension);
        long fileEntryId=getFileEntryId(groupId,folderId,name);
        runSQL("update DLFileVersion set fileEntryId = " + fileEntryId + ", mimeType = '"+ mimeType+ "' where fileVersionId = "+ fileVersionId);
      }
    }
     alter(DLFileVersionTable.class,new AlterColumnType("extraSettings","TEXT null"),new AlterColumnType("title","VARCHAR(255) null"),new AlterTableDropColumn("name"));
  }
 }
