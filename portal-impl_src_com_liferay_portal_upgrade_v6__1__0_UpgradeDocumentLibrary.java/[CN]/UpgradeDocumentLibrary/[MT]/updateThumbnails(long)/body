{
  try (PreparedStatement ps=connection.prepareStatement("select fileVersionId, userId, extension, mimeType, version " + "from DLFileVersion where fileEntryId = " + fileEntryId + " order by version asc");ResultSet rs=ps.executeQuery()){
    while (rs.next()) {
      long fileVersionId=rs.getLong("fileVersionId");
      long userId=rs.getLong("userId");
      String extension=rs.getString("extension");
      String mimeType=rs.getString("mimeType");
      String version=rs.getString("version");
      if (_imageMimeTypes.contains(mimeType)) {
        DLFileVersion dlFileVersion=new DLFileVersionImpl();
        dlFileVersion.setFileVersionId(fileVersionId);
        dlFileVersion.setUserId(userId);
        dlFileVersion.setFileEntryId(fileEntryId);
        dlFileVersion.setExtension(extension);
        dlFileVersion.setMimeType(mimeType);
        dlFileVersion.setVersion(version);
        FileVersion fileVersion=new LiferayFileVersion(dlFileVersion);
        try {
          ImageProcessorUtil.generateImages(null,fileVersion);
        }
 catch (        Exception e) {
          if (_log.isWarnEnabled()) {
            _log.warn("Unable to generate thumbnails for " + fileVersion.getFileVersionId(),e);
          }
        }
      }
    }
  }
 }
