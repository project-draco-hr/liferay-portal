{
  ShoppingOrder order=shoppingOrderPersistence.findByPrimaryKey(orderId);
  ShoppingSettings shoppingSettings=ShoppingUtil.getShoppingSettings(order.getGroupId());
  validate(shoppingSettings,billingFirstName,billingLastName,billingEmailAddress,billingStreet,billingCity,billingState,billingZip,billingCountry,billingPhone,shipToBilling,shippingFirstName,shippingLastName,shippingEmailAddress,shippingStreet,shippingCity,shippingState,shippingZip,shippingCountry,shippingPhone,ccName,ccType,ccNumber,ccExpMonth,ccExpYear,ccVerNumber);
  order.setModifiedDate(new Date());
  order.setBillingFirstName(billingFirstName);
  order.setBillingLastName(billingLastName);
  order.setBillingEmailAddress(billingEmailAddress);
  order.setBillingCompany(billingCompany);
  order.setBillingStreet(billingStreet);
  order.setBillingCity(billingCity);
  order.setBillingState(billingState);
  order.setBillingZip(billingZip);
  order.setBillingCountry(billingCountry);
  order.setBillingPhone(billingPhone);
  order.setShipToBilling(shipToBilling);
  if (shipToBilling) {
    order.setShippingFirstName(billingFirstName);
    order.setShippingLastName(billingLastName);
    order.setShippingEmailAddress(billingEmailAddress);
    order.setShippingCompany(billingCompany);
    order.setShippingStreet(billingStreet);
    order.setShippingCity(billingCity);
    order.setShippingState(billingState);
    order.setShippingZip(billingZip);
    order.setShippingCountry(billingCountry);
    order.setShippingPhone(billingPhone);
  }
 else {
    order.setShippingFirstName(shippingFirstName);
    order.setShippingLastName(shippingLastName);
    order.setShippingEmailAddress(shippingEmailAddress);
    order.setShippingCompany(shippingCompany);
    order.setShippingStreet(shippingStreet);
    order.setShippingCity(shippingCity);
    order.setShippingState(shippingState);
    order.setShippingZip(shippingZip);
    order.setShippingCountry(shippingCountry);
    order.setShippingPhone(shippingPhone);
  }
  order.setCcName(ccName);
  order.setCcType(ccType);
  order.setCcNumber(ccNumber);
  order.setCcExpMonth(ccExpMonth);
  order.setCcExpYear(ccExpYear);
  order.setCcVerNumber(ccVerNumber);
  order.setComments(comments);
  shoppingOrderPersistence.update(order);
  return order;
}
