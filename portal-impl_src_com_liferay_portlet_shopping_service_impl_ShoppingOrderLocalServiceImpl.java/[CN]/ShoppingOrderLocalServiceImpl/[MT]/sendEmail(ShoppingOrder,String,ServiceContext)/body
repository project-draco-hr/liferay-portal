{
  ShoppingPreferences shoppingPrefs=ShoppingPreferences.getInstance(order.getCompanyId(),order.getGroupId());
  if (emailType.equals("confirmation") && shoppingPrefs.getEmailOrderConfirmationEnabled()) {
  }
 else   if (emailType.equals("shipping") && shoppingPrefs.getEmailOrderShippingEnabled()) {
  }
 else {
    return;
  }
  notifyUser(order,emailType,shoppingPrefs,serviceContext);
  if (emailType.equals("confirmation") && order.isSendOrderEmail()) {
    order.setSendOrderEmail(false);
    shoppingOrderPersistence.update(order);
  }
 else   if (emailType.equals("shipping") && order.isSendShippingEmail()) {
    order.setSendShippingEmail(false);
    shoppingOrderPersistence.update(order);
  }
}
