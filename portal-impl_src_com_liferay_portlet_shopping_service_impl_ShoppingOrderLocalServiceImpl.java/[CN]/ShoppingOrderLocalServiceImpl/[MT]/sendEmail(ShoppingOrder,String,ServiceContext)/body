{
  ShoppingSettings shoppingSettings=ShoppingUtil.getShoppingSettings(order.getGroupId());
  if (emailType.equals("confirmation") && shoppingSettings.getEmailOrderConfirmationEnabled()) {
  }
 else   if (emailType.equals("shipping") && shoppingSettings.getEmailOrderShippingEnabled()) {
  }
 else {
    return;
  }
  notifyUser(order,emailType,shoppingSettings,serviceContext);
  if (emailType.equals("confirmation") && order.isSendOrderEmail()) {
    order.setSendOrderEmail(false);
    shoppingOrderPersistence.update(order);
  }
 else   if (emailType.equals("shipping") && order.isSendShippingEmail()) {
    order.setSendShippingEmail(false);
    shoppingOrderPersistence.update(order);
  }
}
