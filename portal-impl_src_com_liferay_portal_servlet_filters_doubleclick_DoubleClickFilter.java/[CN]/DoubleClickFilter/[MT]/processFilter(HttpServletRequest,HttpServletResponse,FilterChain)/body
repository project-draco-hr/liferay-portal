{
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  HttpSession session=request.getSession(false);
  if (session == null) {
    processFilter(DoubleClickFilter.class,request,response,filterChain);
  }
 else {
    DoubleClickController controller=null;
synchronized (session) {
      controller=(DoubleClickController)session.getAttribute(_CONTROLLER_KEY);
      if (controller == null) {
        controller=new DoubleClickController();
        session.setAttribute(_CONTROLLER_KEY,controller);
      }
    }
    boolean ok=false;
    try {
      controller.control(request,response,filterChain);
      ok=true;
    }
  finally {
      if (_log.isDebugEnabled()) {
        String completeURL=HttpUtil.getCompleteURL(request);
        if (ok) {
          _log.debug("Double click prevention succeded in " + stopWatch.getTime() + " ms for "+ completeURL);
        }
 else {
          _log.debug("Double click prevention failed in " + stopWatch.getTime() + " ms for "+ completeURL);
        }
      }
    }
  }
}
