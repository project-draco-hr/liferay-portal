{
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  HttpSession session=request.getSession(false);
  if (session == null) {
    processFilter(DoubleClickFilter.class,request,response,filterChain);
  }
 else {
    DoubleClickController doubleClickController=null;
synchronized (session) {
      TransientValue<DoubleClickController> transientValue=(TransientValue<DoubleClickController>)session.getAttribute(_CONTROLLER_KEY);
      if (transientValue != null) {
        doubleClickController=transientValue.getValue();
      }
      if (doubleClickController == null) {
        doubleClickController=new DoubleClickController();
        transientValue=new TransientValue<DoubleClickController>(doubleClickController);
        session.setAttribute(_CONTROLLER_KEY,transientValue);
      }
    }
    boolean ok=false;
    try {
      doubleClickController.control(request,response,filterChain);
      ok=true;
    }
  finally {
      if (stopWatch != null) {
        String completeURL=HttpUtil.getCompleteURL(request);
        if (ok) {
          _log.debug("Double click prevention succeeded in " + stopWatch.getTime() + " ms for "+ completeURL);
        }
 else {
          _log.debug("Double click prevention failed in " + stopWatch.getTime() + " ms for "+ completeURL);
        }
      }
    }
  }
}
