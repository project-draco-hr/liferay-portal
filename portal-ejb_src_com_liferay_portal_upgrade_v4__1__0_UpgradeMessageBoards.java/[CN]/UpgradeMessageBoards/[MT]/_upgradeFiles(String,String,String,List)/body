{
  if (files.size() == 0) {
    return;
  }
  String portletId=Company.SYSTEM;
  String groupId=Group.DEFAULT_PARENT_GROUP_ID;
  String repositoryId=Company.SYSTEM;
  String dirName="messageboards/" + threadId + "/"+ newMessageId;
  try {
    DLServiceUtil.deleteDirectory(companyId,portletId,repositoryId,dirName);
  }
 catch (  NoSuchDirectoryException nsde) {
  }
  DLServiceUtil.addDirectory(companyId,repositoryId,dirName);
  String tmpDir=SystemProperties.get(SystemProperties.TMP_DIR);
  for (int i=0; i < files.size(); i++) {
    String fileName=(String)files.get(i);
    File file=new File(tmpDir + "/" + fileName);
    byte[] byteArray=FileUtil.getBytes(file);
    int pos=fileName.indexOf("/");
    pos=fileName.indexOf("/",pos + 1);
    pos=fileName.indexOf("/",pos + 1);
    fileName=fileName.substring(pos + 1,fileName.length());
    try {
      DLServiceUtil.addFile(companyId,portletId,groupId,repositoryId,dirName + "/" + fileName,byteArray);
    }
 catch (    DuplicateFileException dfe) {
    }
    file.delete();
  }
}
