{
  try {
    User user=UserLocalServiceUtil.getUser(userId);
    Date now=new Date();
    long fileVersionId=increment();
    DLFileVersion fileVersion=new DLFileVersionImpl();
    fileVersion.setNew(true);
    fileVersion.setPrimaryKey(fileVersionId);
    fileVersion.setGroupId(groupId);
    fileVersion.setCompanyId(user.getCompanyId());
    fileVersion.setUserId(user.getUserId());
    fileVersion.setUserName(user.getFullName());
    fileVersion.setCreateDate(now);
    fileVersion.setFolderId(folderId);
    fileVersion.setName(fileName);
    fileVersion.setVersion(version);
    fileVersion.setSize(size);
    fileVersion.setStatus(StatusConstants.APPROVED);
    fileVersion.setStatusByUserId(user.getUserId());
    fileVersion.setStatusByUserName(user.getFullName());
    fileVersion.setStatusDate(now);
    DLFileVersionLocalServiceUtil.addDLFileVersion(fileVersion);
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn("Version " + version + " for "+ fileName+ " was not created: "+ e.getMessage());
    }
  }
}
