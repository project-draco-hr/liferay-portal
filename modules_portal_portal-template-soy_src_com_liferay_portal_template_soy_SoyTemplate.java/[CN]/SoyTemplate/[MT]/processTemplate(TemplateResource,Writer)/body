{
  TemplateResourceThreadLocal.setTemplateResource(TemplateConstants.LANG_TYPE_SOY,templateResource);
  try {
    String namespace=GetterUtil.getString(get(TemplateConstants.NAMESPACE));
    if (Validator.isNull(namespace)) {
      throw new TemplateException("No namespace specified.");
    }
    SoyFileSet soyFileSet=getSoyFileSet(templateResource);
    SoyTofu soyTofu=soyFileSet.compileToTofu();
    Renderer renderer=soyTofu.newRenderer(namespace);
    renderer.setData(getSoyMapData());
    renderer.render(writer);
  }
 catch (  PrivilegedActionException pae) {
    throw pae.getException();
  }
 finally {
    TemplateResourceThreadLocal.setTemplateResource(TemplateConstants.LANG_TYPE_SOY,null);
  }
}
