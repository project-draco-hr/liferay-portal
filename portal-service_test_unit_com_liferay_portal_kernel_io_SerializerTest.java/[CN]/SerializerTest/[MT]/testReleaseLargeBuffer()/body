{
  Serializer.bufferQueueThreadLocal.remove();
  Serializer serializer=new Serializer();
  char[] chars=new char[Serializer.THREADLOCAL_BUFFER_SIZE_LIMIT];
  serializer.writeString(new String(chars));
  serializer.toByteBuffer();
  Assert.assertEquals(0,Serializer.bufferQueueThreadLocal.get().count);
  serializer=new Serializer();
  serializer.writeString(new String(chars));
  UnsyncByteArrayOutputStream unsyncByteArrayOutputStream=new UnsyncByteArrayOutputStream();
  serializer.writeTo(unsyncByteArrayOutputStream);
  Assert.assertEquals(0,Serializer.bufferQueueThreadLocal.get().count);
  Assert.assertEquals(chars.length * 2 + 5,unsyncByteArrayOutputStream.size());
}
