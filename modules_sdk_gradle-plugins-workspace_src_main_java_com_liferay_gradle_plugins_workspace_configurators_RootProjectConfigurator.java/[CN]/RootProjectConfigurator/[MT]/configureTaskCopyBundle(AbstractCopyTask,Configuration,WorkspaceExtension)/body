{
  abstractCopyTask.doFirst(new Action<Task>(){
    @Override public void execute(    Task task){
      File file=bundleConfiguration.getSingleFile();
      GradleUtil.setProperty(task,_BUNDLE_FILE_PROPERTY_NAME,file);
    }
  }
);
  abstractCopyTask.from(new Callable<FileCollection>(){
    @Override public FileCollection call() throws Exception {
      Project project=abstractCopyTask.getProject();
      if (!abstractCopyTask.hasProperty(_BUNDLE_FILE_PROPERTY_NAME)) {
        return project.files();
      }
      File file=(File)abstractCopyTask.property(_BUNDLE_FILE_PROPERTY_NAME);
      String fileName=file.getName();
      if (fileName.endsWith(".tar.gz")) {
        return project.tarTree(file);
      }
 else {
        return project.zipTree(file);
      }
    }
  }
,new Closure<Void>(null){
    @SuppressWarnings("unused") public void doCall(    CopySpec copySpec){
      copySpec.eachFile(new StripPathSegmentsAction(1));
    }
  }
);
  abstractCopyTask.from(new Closure<Void>(null){
    @SuppressWarnings("unused") public FileCollection doCall(){
      Project project=abstractCopyTask.getProject();
      Map<String,Object> args=new HashMap<>();
      args.put("dir",workspaceExtension.getConfigsDir());
      args.put("exclude","**/.touch");
      List<String> includes=Arrays.asList("common/",workspaceExtension.getEnvironment() + "/");
      args.put("includes",includes);
      return project.fileTree(args);
    }
  }
,new Closure<Void>(null){
    @SuppressWarnings("unused") public void doCall(    CopySpec copySpec){
      copySpec.eachFile(new StripPathSegmentsAction(1));
    }
  }
);
}
