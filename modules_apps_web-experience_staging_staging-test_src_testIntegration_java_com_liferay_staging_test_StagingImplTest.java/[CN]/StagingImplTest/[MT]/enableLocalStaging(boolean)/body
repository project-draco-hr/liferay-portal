{
  ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext(_group.getGroupId());
  Map<String,Serializable> attributes=serviceContext.getAttributes();
  attributes.putAll(ExportImportConfigurationParameterMapFactory.buildParameterMap());
  if (branching) {
    serviceContext.setSignedIn(true);
  }
  ServiceContextThreadLocal.pushServiceContext(serviceContext);
  enableLocalStaging(branching,serviceContext);
  ServiceContextThreadLocal.popServiceContext();
  if (!branching) {
    return;
  }
  UnicodeProperties typeSettingsProperties=_group.getTypeSettingsProperties();
  Assert.assertTrue(GetterUtil.getBoolean(typeSettingsProperties.getProperty("branchingPrivate")));
  Assert.assertTrue(GetterUtil.getBoolean(typeSettingsProperties.getProperty("branchingPublic")));
  Group stagingGroup=_group.getStagingGroup();
  LayoutSetBranch layoutSetBranch=LayoutSetBranchLocalServiceUtil.fetchLayoutSetBranch(stagingGroup.getGroupId(),false,LayoutSetBranchConstants.MASTER_BRANCH_NAME);
  Assert.assertNotNull(layoutSetBranch);
  layoutSetBranch=LayoutSetBranchLocalServiceUtil.fetchLayoutSetBranch(stagingGroup.getGroupId(),true,LayoutSetBranchConstants.MASTER_BRANCH_NAME);
  Assert.assertNotNull(layoutSetBranch);
}
