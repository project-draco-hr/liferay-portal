{
  List<User> users=getUsers(resourceRequest,resourceResponse);
  if (users.isEmpty()) {
    return StringPool.BLANK;
  }
  String exportProgressId=ParamUtil.getString(resourceRequest,"exportProgressId");
  ProgressTracker progressTracker=new ProgressTracker(exportProgressId);
  progressTracker.start(resourceRequest);
  int percentage=10;
  int total=users.size();
  progressTracker.setPercent(percentage);
  StringBundler sb=new StringBundler(users.size());
  for (int i=0; i < users.size(); i++) {
    User user=users.get(i);
    sb.append(getUserCSV(user));
    percentage=Math.min(10 + (i * 90) / total,99);
    progressTracker.setPercent(percentage);
  }
  progressTracker.finish(resourceRequest);
  return sb.toString();
}
