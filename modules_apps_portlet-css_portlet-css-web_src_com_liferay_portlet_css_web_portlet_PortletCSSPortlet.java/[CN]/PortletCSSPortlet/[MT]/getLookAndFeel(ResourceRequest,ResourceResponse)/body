{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  try {
    Layout layout=themeDisplay.getLayout();
    PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
    String portletId=ParamUtil.getString(resourceRequest,"portletId");
    if (!PortletPermissionUtil.contains(permissionChecker,layout,portletId,ActionKeys.CONFIGURATION)) {
      return;
    }
    PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getStrictLayoutPortletSetup(layout,portletId);
    JSONObject portletSetupJSONObject=PortletSetupUtil.cssToJSONObject(portletSetup);
    JSONObject defaultPortletTitlesJSONObject=JSONFactoryUtil.createJSONObject();
    for (    Locale locale : LanguageUtil.getAvailableLocales(themeDisplay.getSiteGroupId())) {
      String rootPortletId=PortletConstants.getRootPortletId(portletId);
      String languageId=LocaleUtil.toLanguageId(locale);
      defaultPortletTitlesJSONObject.put(languageId,PortalUtil.getPortletTitle(rootPortletId,languageId));
    }
    portletSetupJSONObject.put("defaultPortletTitles",defaultPortletTitlesJSONObject);
    writeJSON(resourceRequest,resourceResponse,portletSetupJSONObject.toString());
  }
 catch (  Exception e) {
    throw new PortletException(e);
  }
}
