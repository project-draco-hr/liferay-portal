{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getConnection();
    StringBundler sb=new StringBundler(11);
    sb.append("select distinct User_.companyId, User_.userId, ");
    sb.append("User_.firstName, User_.middleName, User_.lastName ");
    sb.append("User_ inner join ");
    sb.append(tableName);
    sb.append(" on ");
    sb.append(tableName);
    sb.append(".userId = User_.userId where ");
    sb.append(tableName);
    sb.append(".userName is null or ");
    sb.append(tableName);
    sb.append(".userName = ''");
    ps=con.prepareStatement(sb.toString());
    rs=ps.executeQuery();
    while (rs.next()) {
      long userId=rs.getLong("userId");
      String firstName=rs.getString("firstName");
      String middleName=rs.getString("middleName");
      String lastName=rs.getString("lastName");
      FullNameGenerator fullNameGenerator=FullNameGeneratorFactory.getInstance();
      String fullName=fullNameGenerator.getFullName(firstName,middleName,lastName);
      sb=new StringBundler(6);
      if (tableName.equals("PollsVote")) {
        long companyId=rs.getLong("companyId");
        sb.append("update PollsVote set companyId = ");
        sb.append(companyId);
        sb.append(", userName = '");
        sb.append(fullName);
        sb.append("' where userId = ");
        sb.append(userId);
      }
 else {
        sb.append("update ");
        sb.append(tableName);
        sb.append(" set userName = '");
        sb.append(fullName);
        sb.append("' where userId = ");
        sb.append(userId);
      }
      runSQL(sb.toString());
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
