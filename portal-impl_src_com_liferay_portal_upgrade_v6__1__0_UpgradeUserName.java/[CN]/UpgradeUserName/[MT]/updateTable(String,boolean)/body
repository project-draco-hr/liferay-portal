{
  StringBundler sb=new StringBundler(11);
  sb.append("select distinct User_.companyId, User_.userId, ");
  sb.append("User_.firstName, User_.middleName, User_.lastName ");
  sb.append("from User_ inner join ");
  sb.append(tableName);
  sb.append(" on ");
  sb.append(tableName);
  sb.append(".userId = User_.userId where ");
  sb.append(tableName);
  sb.append(".userName is null or ");
  sb.append(tableName);
  sb.append(".userName = ''");
  try (PreparedStatement ps=connection.prepareStatement(sb.toString());ResultSet rs=ps.executeQuery()){
    while (rs.next()) {
      long companyId=rs.getLong("companyId");
      long userId=rs.getLong("userId");
      String firstName=rs.getString("firstName");
      String middleName=rs.getString("middleName");
      String lastName=rs.getString("lastName");
      FullNameGenerator fullNameGenerator=FullNameGeneratorFactory.getInstance();
      String fullName=fullNameGenerator.getFullName(firstName,middleName,lastName);
      fullName=fullName.replace(StringPool.APOSTROPHE,StringPool.DOUBLE_APOSTROPHE);
      if (setCompanyId) {
        sb=new StringBundler(8);
        sb.append("update ");
        sb.append(tableName);
        sb.append(" set companyId = ");
        sb.append(companyId);
        sb.append(", userName = '");
        sb.append(fullName);
        sb.append("' where userId = ");
        sb.append(userId);
      }
 else {
        sb=new StringBundler(6);
        sb.append("update ");
        sb.append(tableName);
        sb.append(" set userName = '");
        sb.append(fullName);
        sb.append("' where userId = ");
        sb.append(userId);
      }
      runSQL(sb.toString());
    }
  }
 }
