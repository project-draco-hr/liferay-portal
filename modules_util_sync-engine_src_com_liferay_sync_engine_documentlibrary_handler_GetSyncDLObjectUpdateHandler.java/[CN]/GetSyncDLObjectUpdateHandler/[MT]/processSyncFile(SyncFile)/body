{
  SyncFile parentSyncFile=SyncFileService.fetchSyncFile(targetSyncFile.getRepositoryId(),getSyncAccountId(),targetSyncFile.getParentFolderId());
  if (parentSyncFile == null) {
    queueSyncFile(targetSyncFile.getParentFolderId(),targetSyncFile);
    return;
  }
  String filePathName="";
  try {
    filePathName=FileUtil.getFilePathName(parentSyncFile.getFilePathName(),FileUtil.getSanitizedFileName(targetSyncFile.getName(),targetSyncFile.getExtension()));
    SyncFile sourceSyncFile=SyncFileService.fetchSyncFile(targetSyncFile.getRepositoryId(),getSyncAccountId(),targetSyncFile.getTypePK());
    if (isIgnoredFilePath(sourceSyncFile,filePathName) || ((sourceSyncFile != null) && (sourceSyncFile.getModifiedTime() == targetSyncFile.getModifiedTime()))) {
      return;
    }
    targetSyncFile.setFilePathName(filePathName);
    String event=targetSyncFile.getEvent();
    if (event.equals(SyncFile.EVENT_ADD) || event.equals(SyncFile.EVENT_GET) || event.equals(SyncFile.EVENT_RESTORE)) {
      if (sourceSyncFile != null) {
        updateFile(sourceSyncFile,targetSyncFile,filePathName);
        processDependentSyncFiles(sourceSyncFile);
        return;
      }
      addFile(targetSyncFile,filePathName);
    }
 else     if (event.equals(SyncFile.EVENT_DELETE)) {
      if (sourceSyncFile == null) {
        return;
      }
      deleteFile(sourceSyncFile,false);
    }
 else     if (event.equals(SyncFile.EVENT_MOVE)) {
      if (sourceSyncFile == null) {
        addFile(targetSyncFile,filePathName);
        processDependentSyncFiles(targetSyncFile);
        return;
      }
      moveFile(sourceSyncFile,targetSyncFile,filePathName);
    }
 else     if (event.equals(SyncFile.EVENT_TRASH)) {
      if (sourceSyncFile == null) {
        return;
      }
      deleteFile(sourceSyncFile,true);
    }
 else     if (event.equals(SyncFile.EVENT_UPDATE)) {
      if (sourceSyncFile == null) {
        addFile(targetSyncFile,filePathName);
        processDependentSyncFiles(targetSyncFile);
        return;
      }
      updateFile(sourceSyncFile,targetSyncFile,filePathName);
    }
    processDependentSyncFiles(targetSyncFile);
  }
 catch (  Exception e) {
    _logger.error(e.getMessage(),e);
    if (e instanceof FileSystemException) {
      String message=e.getMessage();
      if (message.contains("File name too long")) {
        targetSyncFile.setState(SyncFile.STATE_ERROR);
        targetSyncFile.setUiEvent(SyncFile.UI_EVENT_FILE_NAME_TOO_LONG);
        SyncFileService.update(targetSyncFile);
      }
    }
  }
}
