{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  int nodeCount=_wikiNodeLocalService.getNodesCount(themeDisplay.getScopeGroupId());
  if (nodeCount == 1) {
    SessionErrors.add(actionRequest,RequiredNodeException.class);
    return;
  }
  long nodeId=ParamUtil.getLong(actionRequest,"nodeId");
  WikiNode wikiNode=_wikiNodeService.getNode(nodeId);
  String oldName=wikiNode.getName();
  WikiCacheThreadLocal.setClearCache(false);
  WikiNode trashWikiNode=null;
  if (moveToTrash) {
    trashWikiNode=_wikiNodeService.moveNodeToTrash(nodeId);
  }
 else {
    _wikiNodeService.deleteNode(nodeId);
  }
  WikiCacheUtil.clearCache(nodeId);
  WikiCacheThreadLocal.setClearCache(true);
  WikiPortletInstanceOverriddenConfiguration wikiPortletInstanceOverriddenConfiguration=getWikiPortletInstanceOverriddenConfiguration(actionRequest);
  updateSettings(wikiPortletInstanceOverriddenConfiguration,oldName,StringPool.BLANK);
  if (moveToTrash && (trashWikiNode != null)) {
    TrashUtil.addTrashSessionMessages(actionRequest,trashWikiNode);
    hideDefaultSuccessMessage(actionRequest);
  }
}
