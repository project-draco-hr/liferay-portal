{
  CometRequest cometRequest=_cometSession.getCometRequest();
  List<NotificationEvent> notificationEvents=ChannelHubManagerUtil.getNotificationEvents(cometRequest.getCompanyId(),cometRequest.getUserId(),false);
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  if (_pollerResponseHeaderJSONObject != null) {
    jsonArray.put(_pollerResponseHeaderJSONObject);
  }
  for (  NotificationEvent notificationEvent : notificationEvents) {
    jsonArray.put(notificationEvent.toJSONObject());
  }
  CometResponse cometResponse=_cometSession.getCometResponse();
  cometResponse.writeData(jsonArray.toString());
  ChannelHubManagerUtil.removeTransientNotificationEvents(cometRequest.getCompanyId(),cometRequest.getUserId(),notificationEvents);
  _cometSession.close();
}
