{
  long companyId=_cometSession.getCometRequest().getCompanyId();
  long userId=_cometSession.getCometRequest().getUserId();
  List<NotificationEvent> notificationEvents=ChannelHubManagerUtil.getNotificationEvents(companyId,userId,false);
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  if (_pollerResponseHeader != null) {
    jsonArray.put(_pollerResponseHeader);
  }
  for (  NotificationEvent notificationEvent : notificationEvents) {
    jsonArray.put(notificationEvent.toJSONObject());
  }
  _cometSession.getCometResponse().writeData(jsonArray.toString());
  ChannelHubManagerUtil.removeTransientNotificationEvents(companyId,userId,notificationEvents);
  _cometSession.close();
}
