{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  if (cmd.equals("password")) {
    try {
      updatePassword(req,res);
      return mapping.findForward(ActionConstants.COMMON_REFERER);
    }
 catch (    Exception e) {
      if (e instanceof UserPasswordException) {
        UserPasswordException upe=(UserPasswordException)e;
        SessionErrors.add(req,e.getClass().getName(),upe);
        return mapping.findForward("portal.change_password");
      }
 else       if (e instanceof NoSuchUserException || e instanceof PrincipalException) {
        SessionErrors.add(req,e.getClass().getName());
        return mapping.findForward("portal.error");
      }
 else {
        req.setAttribute(PageContext.EXCEPTION,e);
        return mapping.findForward(ActionConstants.COMMON_ERROR);
      }
    }
  }
 else {
    return mapping.findForward("portal.change_password");
  }
}
