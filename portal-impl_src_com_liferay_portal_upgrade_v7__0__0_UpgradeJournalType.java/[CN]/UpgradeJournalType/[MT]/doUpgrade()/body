{
  if (!hasSelectedTypes()) {
    return;
  }
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getUpgradeOptimizedConnection();
    ps=con.prepareStatement("select companyId from Company");
    rs=ps.executeQuery();
    String[] types=PropsUtil.getArray(PropsKeys.JOURNAL_ARTICLE_TYPES);
    while (rs.next()) {
      long companyId=rs.getLong("companyId");
      long groupId=getCompanyGroupId(companyId);
      long userId=getDefaultUserId(companyId);
      long vocabularyId=increment();
      String defaultLanguageId=UpgradeProcessUtil.getDefaultLanguageId(companyId);
      String vocabularyTitle=localize(groupId,"type",defaultLanguageId);
      AssetVocabularySettingsHelper vocabularySettingsHelper=new AssetVocabularySettingsHelper();
      vocabularySettingsHelper.setMultiValued(false);
      long[] classNameIds=new long[]{PortalUtil.getClassNameId(JournalArticle.class)};
      vocabularySettingsHelper.setClassNameIdsAndClassTypePKs(classNameIds,new long[]{-1},new boolean[]{false});
      addVocabulary(vocabularyId,groupId,companyId,userId,"type",vocabularyTitle,vocabularySettingsHelper.toString());
      Map<String,Long> categoryTypes=new HashMap<String,Long>();
      int i=1;
      for (      String type : types) {
        long categoryId=increment();
        String categoryTitle=localize(groupId,type,defaultLanguageId);
        addCategory(categoryId,groupId,companyId,userId,i++,i++,type,categoryTitle,vocabularyId);
        categoryTypes.put(type,categoryId);
      }
      updateJournalArticles(companyId,categoryTypes);
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
