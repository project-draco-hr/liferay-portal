{
  User user=UserUtil.findByPrimaryKey(userId);
  long groupId=PortalUtil.getPortletGroupId(plid);
  Date now=new Date();
  long banId=CounterLocalServiceUtil.increment(Counter.class.getName());
  MBBan ban=MBBanUtil.fetchByG_B(groupId,banUserId);
  if (ban == null) {
    ban=MBBanUtil.create(banId);
    ban.setGroupId(groupId);
    ban.setCompanyId(user.getCompanyId());
    ban.setUserId(user.getUserId());
    ban.setUserName(user.getFullName());
    ban.setCreateDate(now);
    ban.setBanUserId(banUserId);
  }
  ban.setModifiedDate(now);
  MBBanUtil.update(ban);
  return ban;
}
