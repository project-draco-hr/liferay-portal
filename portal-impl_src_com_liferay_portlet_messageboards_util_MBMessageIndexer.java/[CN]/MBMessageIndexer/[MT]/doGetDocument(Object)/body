{
  MBMessage message=(MBMessage)obj;
  Document document=getBaseModelDocument(PORTLET_ID,message);
  document.addKeyword(Field.CATEGORY_ID,message.getCategoryId());
  document.addText(Field.CONTENT,processContent(message));
  document.addKeyword(Field.ROOT_ENTRY_CLASS_PK,message.getRootMessageId());
  document.addText(Field.TITLE,message.getSubject());
  if (message.isAnonymous()) {
    document.remove(Field.USER_NAME);
  }
  try {
    MBDiscussionLocalServiceUtil.getThreadDiscussion(message.getThreadId());
    document.addKeyword("discussion",true);
  }
 catch (  NoSuchDiscussionException nsde) {
    document.addKeyword("discussion",false);
  }
  document.addKeyword("threadId",message.getThreadId());
  if (message.isDiscussion()) {
    Indexer indexer=IndexerRegistryUtil.getIndexer(message.getClassName());
    if (indexer != null) {
      indexer.addRelatedEntityFields(document,obj);
    }
  }
  if (!message.isInTrash() && message.isInTrashThread()) {
    addTrashFields(document,MBThread.class.getName(),message.getThreadId(),null,null,MBMessageAssetRendererFactory.TYPE);
    String className=MBThread.class.getName();
    long classPK=message.getThreadId();
    MBThread thread=message.getThread();
    if (thread.isInTrashContainer()) {
      MBCategory category=thread.getTrashContainer();
      className=MBCategory.class.getName();
      classPK=category.getCategoryId();
    }
    document.addKeyword(Field.ROOT_ENTRY_CLASS_NAME,className);
    document.addKeyword(Field.ROOT_ENTRY_CLASS_PK,classPK);
    document.addKeyword(Field.STATUS,WorkflowConstants.STATUS_IN_TRASH);
  }
  return document;
}
