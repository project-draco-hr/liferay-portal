{
  MBMessage message=(MBMessage)obj;
  Document document=getBaseModelDocument(CLASS_NAME,message);
  document.addKeyword(Field.CATEGORY_ID,message.getCategoryId());
  document.addText(Field.CONTENT,processContent(message));
  document.addKeyword(Field.ROOT_ENTRY_CLASS_PK,message.getRootMessageId());
  document.addText(Field.TITLE,message.getSubject());
  if (message.isAnonymous()) {
    document.remove(Field.USER_NAME);
  }
  MBDiscussion discussion=MBDiscussionLocalServiceUtil.fetchThreadDiscussion(message.getThreadId());
  if (discussion == null) {
    document.addKeyword("discussion",false);
  }
 else {
    document.addKeyword("discussion",true);
  }
  document.addKeyword("threadId",message.getThreadId());
  if (message.isDiscussion()) {
    Indexer indexer=IndexerRegistryUtil.getIndexer(message.getClassName());
    if (indexer != null) {
      DetachedComment detachedComment=new MBDetachedCommentImpl(message);
      indexer.addRelatedEntryFields(document,detachedComment);
      document.addKeyword(Field.RELATED_ENTRY,true);
    }
  }
  return document;
}
