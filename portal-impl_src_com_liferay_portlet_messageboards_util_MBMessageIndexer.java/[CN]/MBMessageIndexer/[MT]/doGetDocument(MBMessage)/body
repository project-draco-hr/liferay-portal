{
  Document document=getBaseModelDocument(CLASS_NAME,mbMessage);
  document.addKeyword(Field.CATEGORY_ID,mbMessage.getCategoryId());
  document.addText(Field.CONTENT,processContent(mbMessage));
  document.addKeyword(Field.ENTRY_CLASS_PK,mbMessage.getRootMessageId());
  document.addText(Field.TITLE,mbMessage.getSubject());
  if (mbMessage.isAnonymous()) {
    document.remove(Field.USER_NAME);
  }
  MBDiscussion discussion=MBDiscussionLocalServiceUtil.fetchThreadDiscussion(mbMessage.getThreadId());
  if (discussion == null) {
    document.addKeyword("discussion",false);
  }
 else {
    document.addKeyword("discussion",true);
  }
  document.addKeyword("threadId",mbMessage.getThreadId());
  if (mbMessage.isDiscussion()) {
    Indexer indexer=IndexerRegistryUtil.getIndexer(mbMessage.getClassName());
    if ((indexer != null) && (indexer instanceof RelatedEntryIndexer)) {
      RelatedEntryIndexer relatedEntryIndexer=(RelatedEntryIndexer)indexer;
      Comment comment=CommentManagerUtil.fetchComment(mbMessage.getMessageId());
      if (comment != null) {
        relatedEntryIndexer.addRelatedEntryFields(document,comment);
        document.addKeyword(Field.RELATED_ENTRY,true);
      }
    }
  }
  return document;
}
