{
  Project project=getProject();
  final File tempFile=new File(getTemporaryDir(),file.getName());
  copy(file,tempFile.getParentFile());
  CharsetToolkit charsetToolkit=new CharsetToolkit(tempFile);
  final Charset charset=charsetToolkit.getCharset();
  project.ant(new Closure<Void>(null){
    @SuppressWarnings("unused") public void doCall(    AntBuilder antBuilder){
      Map<String,Object> args=new HashMap<>();
      args.put("encoding",charset.name());
      args.put("eol","lf");
      args.put("file",tempFile);
      args.put("fixlast",false);
      args.put("outputencoding",StandardCharsets.UTF_8);
      antBuilder.invokeMethod("fixcrlf",args);
    }
  }
);
  return tempFile;
}
