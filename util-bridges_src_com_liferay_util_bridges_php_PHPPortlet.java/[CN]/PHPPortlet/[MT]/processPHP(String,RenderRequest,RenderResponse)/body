{
  try {
    ServletConfig servletConfig=servletObjectsFactory.getServletConfig(getPortletConfig(),renderRequest);
    initQuercus(servletConfig);
    HttpServletRequest request=servletObjectsFactory.getServletRequest(renderRequest);
    HttpServletResponse response=servletObjectsFactory.getServletResponse(renderRequest,renderResponse);
    PHPServletRequest phpRequest=new PHPServletRequest(request,servletConfig,renderRequest,renderResponse,getPortletConfig(),phpURI);
    StringServletResponse stringResponse=new StringServletResponse(response);
    quercusServlet.service(phpRequest,stringResponse);
    String result=stringResponse.getString();
    if (stringResponse.getContentType().startsWith("text/")) {
      result=rewriteURLs(result,renderResponse.createRenderURL());
    }
    renderResponse.setContentType(stringResponse.getContentType());
    PrintWriter writer=renderResponse.getWriter();
    writer.write(result.toCharArray());
  }
 catch (  Exception e) {
    _log.error("Error processing PHP",e);
  }
}
