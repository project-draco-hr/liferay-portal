{
  try {
    ServletConfig servletConfig=servletObjectsFactory.getServletConfig(getPortletConfig(),renderRequest);
    initQuercus(servletConfig);
    HttpServletRequest request=servletObjectsFactory.getServletRequest(renderRequest);
    HttpServletResponse response=servletObjectsFactory.getServletResponse(renderRequest,renderResponse);
    PHPServletRequest phpRequest=new PHPServletRequest(request,servletConfig,renderRequest,renderResponse,getPortletConfig(),phpURI,addPortletParams);
    BufferCacheServletResponse bufferCacheServletResponse=new BufferCacheServletResponse(response);
    quercusServlet.service(phpRequest,bufferCacheServletResponse);
    String result=bufferCacheServletResponse.getString();
    String contentType=bufferCacheServletResponse.getContentType();
    if (contentType != null) {
      if (contentType.startsWith("text/")) {
        result=rewriteURLs(result,renderResponse.createRenderURL());
      }
      renderResponse.setContentType(contentType);
    }
    PrintWriter writer=renderResponse.getWriter();
    writer.write(result.toCharArray());
  }
 catch (  Exception e) {
    _log.error("Error processing PHP",e);
  }
}
