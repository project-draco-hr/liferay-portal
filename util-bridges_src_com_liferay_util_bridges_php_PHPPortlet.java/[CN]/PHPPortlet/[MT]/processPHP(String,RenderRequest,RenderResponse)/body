{
  try {
    ServletConfig servletConfig=servletObjectsFactory.getServletConfig(getPortletConfig(),renderRequest);
    initQuercus(servletConfig);
    HttpServletRequest httpRequest=servletObjectsFactory.getServletRequest(renderRequest);
    HttpServletResponse httpResponse=servletObjectsFactory.getServletResponse(renderRequest,renderResponse);
    PHPServletRequest phpRequest=new PHPServletRequest(httpRequest,servletConfig,renderRequest,renderResponse,getPortletConfig(),phpURI);
    StringServletResponse stringServletResponse=new StringServletResponse(httpResponse);
    quercusServlet.service(phpRequest,stringServletResponse);
    String result=stringServletResponse.getString();
    if (stringServletResponse.getContentType().startsWith("text/")) {
      result=rewriteURLs(result,renderResponse.createRenderURL());
    }
    renderResponse.setContentType(stringServletResponse.getContentType());
    PrintWriter writer=renderResponse.getWriter();
    writer.write(result.toCharArray());
  }
 catch (  Exception e) {
    _log.error("Error processing PHP",e);
  }
}
