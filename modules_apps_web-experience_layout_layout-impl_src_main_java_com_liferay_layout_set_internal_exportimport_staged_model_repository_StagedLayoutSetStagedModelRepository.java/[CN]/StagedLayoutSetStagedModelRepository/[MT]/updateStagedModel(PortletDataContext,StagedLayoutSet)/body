{
  LayoutSet existingLayoutSet=_layoutSetLocalService.fetchLayoutSet(stagedLayoutSet.getLayoutSetId());
  boolean layoutSetPrototypeSettings=MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.LAYOUT_SET_PROTOTYPE_SETTINGS);
  if (!layoutSetPrototypeSettings || Validator.isNull(stagedLayoutSet.getLayoutSetPrototypeUuid())) {
    existingLayoutSet.setLayoutSetPrototypeUuid(null);
    existingLayoutSet.setLayoutSetPrototypeLinkEnabled(false);
    existingLayoutSet=_layoutSetLocalService.updateLayoutSet(existingLayoutSet);
  }
  boolean layoutSetSettings=MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.LAYOUT_SET_SETTINGS);
  if (layoutSetSettings) {
    existingLayoutSet=_layoutSetLocalService.updateSettings(existingLayoutSet.getGroupId(),existingLayoutSet.isPrivateLayout(),stagedLayoutSet.getSettings());
  }
  return ModelAdapterUtil.adapt(existingLayoutSet,LayoutSet.class,StagedLayoutSet.class);
}
