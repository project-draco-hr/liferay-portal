{
  boolean layoutSetPrototypeSettings=MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.LAYOUT_SET_PROTOTYPE_SETTINGS);
  LayoutSet layoutSet=null;
  if (!layoutSetPrototypeSettings || Validator.isNull(stagedLayoutSet.getLayoutSetPrototypeUuid())) {
    stagedLayoutSet.setLayoutSetPrototypeUuid(null);
    stagedLayoutSet.setLayoutSetPrototypeLinkEnabled(false);
    layoutSet=_layoutSetLocalService.updateLayoutSet(stagedLayoutSet);
  }
  boolean layoutSetSettings=MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.LAYOUT_SET_SETTINGS);
  if (layoutSetSettings) {
    layoutSet=_layoutSetLocalService.updateSettings(portletDataContext.getGroupId(),portletDataContext.isPrivateLayout(),stagedLayoutSet.getSettings());
  }
  return ModelAdapterUtil.adapt(layoutSet,LayoutSet.class,StagedLayoutSet.class);
}
