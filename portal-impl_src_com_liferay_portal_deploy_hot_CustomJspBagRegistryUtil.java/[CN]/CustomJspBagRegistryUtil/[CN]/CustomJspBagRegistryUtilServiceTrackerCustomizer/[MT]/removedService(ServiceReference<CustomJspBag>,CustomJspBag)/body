{
  Registry registry=RegistryUtil.getRegistry();
  registry.ungetService(serviceReference);
  String contextId=GetterUtil.getString(serviceReference.getProperty("context.id"));
  for (  String customJsp : customJspBag.getCustomJsps()) {
    String customJspDir=customJspBag.getCustomJspDir();
    int pos=customJsp.indexOf(customJspDir);
    String portalJsp=customJsp.substring(pos + customJspDir.length());
    if (customJspBag.isCustomJspGlobal()) {
      File portalJspFile=new File(PortalUtil.getPortalWebDir() + portalJsp);
      File portalJspBackupFile=getPortalJspBackupFile(portalJspFile);
      if (portalJspBackupFile.exists()) {
        try {
          FileUtil.copyFile(portalJspBackupFile,portalJspFile);
        }
 catch (        IOException e) {
          return;
        }
        portalJspBackupFile.delete();
      }
 else       if (portalJspFile.exists()) {
        portalJspFile.delete();
      }
    }
 else {
      portalJsp=CustomJspRegistryUtil.getCustomJspFileName(contextId,portalJsp);
      File portalJspFile=new File(PortalUtil.getPortalWebDir() + portalJsp);
      if (portalJspFile.exists()) {
        portalJspFile.delete();
      }
    }
  }
  if (!customJspBag.isCustomJspGlobal()) {
    CustomJspRegistryUtil.unregisterServletContextName(contextId);
  }
  _customJspBagsMap.remove(serviceReference);
}
