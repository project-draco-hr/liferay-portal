{
  long layoutSetPrototypeId=ParamUtil.getLong(actionRequest,"layoutSetPrototypeId");
  Map<Locale,String> nameMap=LocalizationUtil.getLocalizationMap(actionRequest,"name");
  Map<Locale,String> descriptionMap=LocalizationUtil.getLocalizationMap(actionRequest,"description");
  boolean active=ParamUtil.getBoolean(actionRequest,"active");
  boolean layoutsUpdateable=ParamUtil.getBoolean(actionRequest,"layoutsUpdateable");
  ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
  LayoutSetPrototype layoutSetPrototype=null;
  if (layoutSetPrototypeId <= 0) {
    layoutSetPrototype=LayoutSetPrototypeServiceUtil.addLayoutSetPrototype(nameMap,descriptionMap,active,layoutsUpdateable,serviceContext);
    MultiSessionMessages.add(actionRequest,LayoutSetPrototypePortletKeys.SITE_TEMPLATE_SETTINGS + "requestProcessed");
  }
 else {
    layoutSetPrototype=LayoutSetPrototypeServiceUtil.updateLayoutSetPrototype(layoutSetPrototypeId,nameMap,descriptionMap,active,layoutsUpdateable,serviceContext);
  }
  String customJspServletContextName=ParamUtil.getString(actionRequest,"customJspServletContextName");
  UnicodeProperties settingsProperties=layoutSetPrototype.getSettingsProperties();
  settingsProperties.setProperty("customJspServletContextName",customJspServletContextName);
  layoutSetPrototype=LayoutSetPrototypeServiceUtil.updateLayoutSetPrototype(layoutSetPrototype.getLayoutSetPrototypeId(),settingsProperties.toString());
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  ThemeDisplay siteThemeDisplay=(ThemeDisplay)themeDisplay.clone();
  siteThemeDisplay.setScopeGroupId(layoutSetPrototype.getGroupId());
  PortletURL siteAdministrationURL=PortalUtil.getSiteAdministrationURL(actionResponse,siteThemeDisplay,LayoutSetPrototypePortletKeys.SITE_TEMPLATE_SETTINGS);
  actionRequest.setAttribute(WebKeys.REDIRECT,siteAdministrationURL.toString());
  sendRedirect(actionRequest,actionResponse);
}
