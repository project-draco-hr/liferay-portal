{
  Content content1=addContent();
  long contentId2=content1.getContentId() + 1;
  String version2=content1.getVersion().concat("-2");
  int size=(int)content1.getSize();
  Blob data=new OutputBlob(new ByteArrayInputStream(new byte[size]),size);
  Content content2=new Content(contentId2,content1.getCompanyId(),content1.getPortletId(),content1.getGroupId(),content1.getRepositoryId(),content1.getPath(),version2,data,size);
  _persistence.update(content2);
  List<Content> existingContents2=_persistence.findByC_P_R_P(content1.getCompanyId(),content1.getPortletId(),content1.getRepositoryId(),content1.getPath());
  assertTrue(existingContents2.size() == 1);
  Content existingContent2=existingContents2.get(0);
  assertTrue(existingContent2.equals(content2));
  _persistence.remove(existingContent2.getContentId());
  List<Content> existingContents1=_persistence.findByC_P_R_P(content1.getCompanyId(),content1.getPortletId(),content1.getRepositoryId(),content1.getPath());
  assertTrue(existingContents1.size() == 1);
  Content existingContent1=existingContents1.get(0);
  assertTrue(existingContent1.equals(content1));
  _persistence.remove(existingContent1.getContentId());
  existingContents1=_persistence.findByC_P_R_P(content1.getCompanyId(),content1.getPortletId(),content1.getRepositoryId(),content1.getPath());
  assertTrue(existingContents1.size() == 0);
}
