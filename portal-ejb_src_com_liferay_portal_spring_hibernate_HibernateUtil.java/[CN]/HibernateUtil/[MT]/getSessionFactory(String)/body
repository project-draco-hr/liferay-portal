{
  if (sessionFactoryName.equals(SPRING_HIBERNATE_SESSION_FACTORY)) {
    if (_sessionFactory == null) {
      ApplicationContext ctx=SpringUtil.getContext();
      LocalSessionFactoryBean lsfb=(LocalSessionFactoryBean)ctx.getBean(sessionFactoryName);
      _sessionFactory=(SessionFactoryImplementor)lsfb.getObject();
    }
    return _sessionFactory;
  }
 else {
    SessionFactoryImplementor sessionFactory=(SessionFactoryImplementor)_sessionFactories.get(sessionFactoryName);
    if (sessionFactory == null) {
      ApplicationContext ctx=SpringUtil.getContext();
      LocalSessionFactoryBean lsfb=(LocalSessionFactoryBean)ctx.getBean(sessionFactoryName);
      sessionFactory=(SessionFactoryImplementor)lsfb.getObject();
      _sessionFactories.put(sessionFactoryName,sessionFactory);
    }
    return sessionFactory;
  }
}
