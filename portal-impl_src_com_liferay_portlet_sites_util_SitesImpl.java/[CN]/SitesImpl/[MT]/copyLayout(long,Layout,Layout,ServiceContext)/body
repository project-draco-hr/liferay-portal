{
  Map<String,String[]> parameterMap=getLayoutSetPrototypeParameters(serviceContext);
  parameterMap.put(PortletDataHandlerKeys.DELETE_MISSING_LAYOUTS,new String[]{Boolean.FALSE.toString()});
  User user=UserLocalServiceUtil.getUser(userId);
  Map<String,Serializable> settingsMap=ExportImportConfigurationSettingsMapFactory.buildSettingsMap(userId,sourceLayout.getGroupId(),sourceLayout.isPrivateLayout(),new long[]{sourceLayout.getLayoutId()},parameterMap,user.getLocale(),user.getTimeZone());
  ExportImportConfiguration exportImportConfiguration=ExportImportConfigurationLocalServiceUtil.addExportImportConfiguration(userId,sourceLayout.getGroupId(),StringPool.BLANK,StringPool.BLANK,ExportImportConfigurationConstants.TYPE_EXPORT_LAYOUT,settingsMap,WorkflowConstants.STATUS_DRAFT,new ServiceContext());
  File file=LayoutLocalServiceUtil.exportLayoutsAsFile(exportImportConfiguration);
  try {
    LayoutLocalServiceUtil.importLayouts(userId,targetLayout.getGroupId(),targetLayout.isPrivateLayout(),parameterMap,file);
  }
  finally {
    file.delete();
  }
}
