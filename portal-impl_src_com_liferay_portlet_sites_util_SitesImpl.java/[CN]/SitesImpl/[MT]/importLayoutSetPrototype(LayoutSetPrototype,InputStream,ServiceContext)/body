{
  LayoutSet layoutSet=layoutSetPrototype.getLayoutSet();
  Map<String,String[]> parameterMap=getLayoutSetPrototypeParameters(serviceContext);
  setLayoutSetPrototypeLinkEnabledParameter(parameterMap,layoutSet,serviceContext);
  User user=UserLocalServiceUtil.fetchUser(serviceContext.getUserId());
  if (user == null) {
    BackgroundTask backgroundTask=BackgroundTaskLocalServiceUtil.fetchBackgroundTask(BackgroundTaskThreadLocal.getBackgroundTaskId());
    if (backgroundTask != null) {
      user=UserLocalServiceUtil.getUser(backgroundTask.getUserId());
    }
  }
  if (user == null) {
    user=UserLocalServiceUtil.getUser(GetterUtil.getLong(PrincipalThreadLocal.getName()));
  }
  Map<String,Serializable> importLayoutSettingsMap=ExportImportConfigurationSettingsMapFactory.buildImportLayoutSettingsMap(user.getUserId(),layoutSet.getGroupId(),layoutSet.isPrivateLayout(),null,parameterMap,user.getLocale(),user.getTimeZone());
  ExportImportConfiguration exportImportConfiguration=ExportImportConfigurationLocalServiceUtil.addExportImportConfiguration(user.getUserId(),layoutSet.getGroupId(),StringPool.BLANK,StringPool.BLANK,ExportImportConfigurationConstants.TYPE_IMPORT_LAYOUT,importLayoutSettingsMap,WorkflowConstants.STATUS_DRAFT,serviceContext);
  ExportImportServiceUtil.importLayouts(exportImportConfiguration,inputStream);
}
