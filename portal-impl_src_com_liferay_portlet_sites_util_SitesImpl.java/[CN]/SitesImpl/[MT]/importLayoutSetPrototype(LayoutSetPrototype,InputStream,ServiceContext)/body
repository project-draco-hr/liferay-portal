{
  LayoutSet layoutSet=layoutSetPrototype.getLayoutSet();
  Map<String,String[]> parameterMap=getLayoutSetPrototypeParameters(serviceContext);
  setLayoutSetPrototypeLinkEnabledParameter(parameterMap,layoutSet,serviceContext);
  User user=UserLocalServiceUtil.fetchUser(serviceContext.getUserId());
  if (user == null) {
    BackgroundTask backgroundTask=BackgroundTaskLocalServiceUtil.fetchBackgroundTask(BackgroundTaskThreadLocal.getBackgroundTaskId());
    if (backgroundTask != null) {
      user=UserLocalServiceUtil.getUser(backgroundTask.getUserId());
    }
  }
  if (user == null) {
    user=UserLocalServiceUtil.getUser(GetterUtil.getLong(PrincipalThreadLocal.getName()));
  }
  Map<String,Serializable> importSettingsMap=ExportImportConfigurationSettingsMapFactory.buildImportSettingsMap(user.getUserId(),layoutSet.getGroupId(),layoutSet.isPrivateLayout(),null,parameterMap,Constants.IMPORT,user.getLocale(),user.getTimeZone(),StringPool.BLANK);
  ExportImportConfiguration exportImportConfiguration=ExportImportConfigurationLocalServiceUtil.addExportImportConfiguration(user.getUserId(),layoutSet.getGroupId(),StringPool.BLANK,StringPool.BLANK,ExportImportConfigurationConstants.TYPE_IMPORT_LAYOUT,importSettingsMap,WorkflowConstants.STATUS_DRAFT,serviceContext);
  LayoutServiceUtil.importLayouts(exportImportConfiguration,inputStream);
}
