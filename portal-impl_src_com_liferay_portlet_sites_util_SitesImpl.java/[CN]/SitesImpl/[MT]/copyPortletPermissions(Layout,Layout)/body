{
  Group targetGroup=targetLayout.getGroup();
  List<Role> roles=RoleLocalServiceUtil.getGroupRelatedRoles(targetLayout.getGroupId());
  LayoutTypePortlet sourceLayoutTypePortlet=(LayoutTypePortlet)sourceLayout.getLayoutType();
  List<String> sourcePortletIds=sourceLayoutTypePortlet.getPortletIds();
  for (  String sourcePortletId : sourcePortletIds) {
    String resourceName=PortletConstants.getRootPortletId(sourcePortletId);
    String sourceResourcePrimKey=PortletPermissionUtil.getPrimaryKey(sourceLayout.getPlid(),sourcePortletId);
    String targetResourcePrimKey=PortletPermissionUtil.getPrimaryKey(targetLayout.getPlid(),sourcePortletId);
    List<String> actionIds=ResourceActionsUtil.getPortletResourceActions(resourceName);
    for (    Role role : roles) {
      String roleName=role.getName();
      if (roleName.equals(RoleConstants.ADMINISTRATOR) || (!targetGroup.isLayoutSetPrototype() && targetLayout.isPrivateLayout() && roleName.equals(RoleConstants.GUEST))) {
        continue;
      }
      List<String> actions=ResourcePermissionLocalServiceUtil.getAvailableResourcePermissionActionIds(targetLayout.getCompanyId(),resourceName,ResourceConstants.SCOPE_INDIVIDUAL,sourceResourcePrimKey,role.getRoleId(),actionIds);
      ResourcePermissionLocalServiceUtil.setResourcePermissions(targetLayout.getCompanyId(),resourceName,ResourceConstants.SCOPE_INDIVIDUAL,targetResourcePrimKey,role.getRoleId(),actions.toArray(new String[actions.size()]));
    }
  }
}
