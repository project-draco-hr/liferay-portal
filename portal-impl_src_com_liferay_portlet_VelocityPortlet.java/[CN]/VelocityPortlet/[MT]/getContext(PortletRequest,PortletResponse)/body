{
  Context context=new VelocityContext();
  context.put("portletConfig",getPortletConfig());
  context.put("portletContext",getPortletContext());
  context.put("preferences",portletRequest.getPreferences());
  context.put("userInfo",(Map<String,String>)portletRequest.getAttribute(PortletRequest.USER_INFO));
  context.put(REQUEST,portletRequest);
  context.put(RESPONSE,portletResponse);
  context.put("portletRequest",portletRequest);
  context.put("portletResponse",portletResponse);
  if (portletRequest instanceof ActionRequest) {
    context.put("actionRequest",portletRequest);
  }
 else   if (portletRequest instanceof RenderRequest) {
    context.put("renderRequest",portletRequest);
  }
 else {
    context.put("resourceRequest",portletRequest);
  }
  if (portletResponse instanceof ActionResponse) {
    context.put("actionResponse",portletResponse);
  }
 else   if (portletRequest instanceof RenderResponse) {
    context.put("renderResponse",portletResponse);
  }
 else {
    context.put("resourceResponse",portletResponse);
  }
  VelocityVariables.insertHelperUtilities((VelocityContext)context,null);
  return context;
}
