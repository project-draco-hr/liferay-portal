{
  int responseCode=HttpServletResponse.SC_OK;
  String deploymentContext=ParamUtil.getString(uploadPortletRequest,"deploymentContext");
  try {
    String fileName=null;
    if (Validator.isNotNull(deploymentContext)) {
      fileName=DEPLOY_TO_PREFIX + deploymentContext + ".war";
    }
 else {
      fileName=url.substring(url.lastIndexOf(CharPool.SLASH) + 1);
      int pos=fileName.lastIndexOf(CharPool.PERIOD);
      if (pos != -1) {
        deploymentContext=fileName.substring(0,pos);
      }
    }
    Http.Options options=new Http.Options();
    options.setFollowRedirects(false);
    options.setLocation(url);
    options.setPost(false);
    byte[] bytes=HttpUtil.URLtoByteArray(options);
    Http.Response response=options.getResponse();
    responseCode=response.getResponseCode();
    if ((responseCode == HttpServletResponse.SC_OK) && (bytes.length > 0)) {
      String deployDir=PrefsPropsUtil.getString(PropsKeys.AUTO_DEPLOY_DEPLOY_DIR);
      String destination=deployDir + StringPool.SLASH + fileName;
      File destinationFile=new File(destination);
      FileUtil.write(destinationFile,bytes);
      SessionMessages.add(actionRequest,"pluginDownloaded");
    }
 else {
      if (failOnError) {
        SessionErrors.add(actionRequest,UploadException.class.getName());
      }
      responseCode=HttpServletResponse.SC_INTERNAL_SERVER_ERROR;
    }
  }
 catch (  MalformedURLException murle) {
    SessionErrors.add(actionRequest,"invalidUrl",murle);
  }
catch (  IOException ioe) {
    SessionErrors.add(actionRequest,"errorConnectingToUrl",ioe);
  }
  return responseCode;
}
