{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String[] contextNames=StringUtil.split(ParamUtil.getString(actionRequest,"contextNames"));
  boolean active=ParamUtil.getBoolean(actionRequest,"active");
  for (  String contextName : contextNames) {
    ServletContext servletContext=ServletContextPool.get(contextName);
    List<LayoutTemplate> layoutTemplates=(List<LayoutTemplate>)servletContext.getAttribute(WebKeys.PLUGIN_LAYOUT_TEMPLATES);
    if (layoutTemplates != null) {
      for (      LayoutTemplate layoutTemplate : layoutTemplates) {
        PluginSetting pluginSetting=PluginSettingLocalServiceUtil.getPluginSetting(themeDisplay.getCompanyId(),layoutTemplate.getLayoutTemplateId(),Plugin.TYPE_LAYOUT_TEMPLATE);
        PluginSettingServiceUtil.updatePluginSetting(themeDisplay.getCompanyId(),layoutTemplate.getLayoutTemplateId(),Plugin.TYPE_LAYOUT_TEMPLATE,pluginSetting.getRoles(),active);
      }
    }
    List<Portlet> portlets=(List<Portlet>)servletContext.getAttribute(WebKeys.PLUGIN_PORTLETS);
    if (portlets != null) {
      for (      Portlet portlet : portlets) {
        PortletServiceUtil.updatePortlet(themeDisplay.getCompanyId(),portlet.getPortletId(),StringPool.BLANK,active);
      }
    }
    List<Theme> themes=(List<Theme>)servletContext.getAttribute(WebKeys.PLUGIN_THEMES);
    if (themes != null) {
      for (      Theme theme : themes) {
        PluginSetting pluginSetting=PluginSettingLocalServiceUtil.getPluginSetting(themeDisplay.getCompanyId(),theme.getThemeId(),Plugin.TYPE_THEME);
        PluginSettingServiceUtil.updatePluginSetting(themeDisplay.getCompanyId(),theme.getThemeId(),Plugin.TYPE_THEME,pluginSetting.getRoles(),active);
      }
    }
  }
}
