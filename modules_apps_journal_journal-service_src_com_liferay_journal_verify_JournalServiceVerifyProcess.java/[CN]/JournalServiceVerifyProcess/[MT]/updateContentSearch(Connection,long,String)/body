{
  StringBundler sb=new StringBundler(3);
  sb.append("select preferences from PortletPreferences inner join ");
  sb.append("Layout on PortletPreferences.plid = Layout.plid where ");
  sb.append("groupId = ? and portletId = ?");
  try (PreparedStatement ps=con.prepareStatement(sb.toString())){
    ps.setLong(1,groupId);
    ps.setString(2,portletId);
    try (ResultSet rs=ps.executeQuery()){
      while (rs.next()) {
        String xml=rs.getString("preferences");
        PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.fromDefaultXML(xml);
        String articleId=portletPreferences.getValue("articleId",null);
        List<JournalContentSearch> contentSearches=_journalContentSearchLocalService.getArticleContentSearches(groupId,articleId);
        if (contentSearches.isEmpty()) {
          continue;
        }
        JournalContentSearch contentSearch=contentSearches.get(0);
        _journalContentSearchLocalService.updateContentSearch(contentSearch.getGroupId(),contentSearch.isPrivateLayout(),contentSearch.getLayoutId(),contentSearch.getPortletId(),articleId,true);
      }
    }
   }
 }
