{
  if (!JournalServiceConfigurationValues.JOURNAL_ARTICLE_EXPIRE_ALL_VERSIONS) {
    return;
  }
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getUpgradeOptimizedConnection();
    StringBundler sb=new StringBundler(14);
    sb.append("select JournalArticle.* from JournalArticle ");
    sb.append("left join JournalArticle tempJournalArticle on ");
    sb.append("(JournalArticle.status = tempJournalArticle.status) ");
    sb.append("and (JournalArticle.groupId = ");
    sb.append("tempJournalArticle.groupId) and ");
    sb.append("(JournalArticle.articleId = ");
    sb.append("tempJournalArticle.articleId) and ");
    sb.append("(JournalArticle.version < tempJournalArticle.version) ");
    sb.append("where (JournalArticle.classNameId = ");
    sb.append(JournalArticleConstants.CLASSNAME_ID_DEFAULT);
    sb.append(") and (JournalArticle.status =");
    sb.append(WorkflowConstants.STATUS_APPROVED);
    sb.append(") and (JournalArticle.expirationDate is not null) ");
    sb.append("and (tempJournalArticle.version is null)");
    ps=con.prepareStatement(sb.toString());
    rs=ps.executeQuery();
    while (rs.next()) {
      Timestamp expirationDate=rs.getTimestamp("expirationDate");
      long articleId=rs.getLong("articleId");
      long groupId=rs.getLong("groupId");
      int status=rs.getInt("status");
      updateExpirationDate(expirationDate,articleId,groupId,status);
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
