{
  try {
    String serviceName=userId + StringPool.COLON + WebKeys.MAIL_STORE;
    if (_log.isInfoEnabled()) {
      _log.info("Reseting service " + serviceName);
    }
    cleanUp(ses);
    Session session=MailEngine.getSession();
    String imapHost=session.getProperty("mail.imap.host");
    Store store=session.getStore("imap");
    store.addConnectionListener(new ConnectionListener(serviceName));
    store.connect(imapHost,userId,password);
    ses.setAttribute(WebKeys.MAIL_STORE,store);
    return store;
  }
 catch (  Exception e) {
    throw new StoreException(e);
  }
}
