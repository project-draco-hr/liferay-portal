{
  try {
    MailAccount currentAccount=MailAccounts.getCurrentAccount(req);
    Store store=MailCache.getStore(PortalUtil.getUserId(req),currentAccount.getName());
    if (store == null) {
      store=createStore(req,currentAccount);
      if (_log.isDebugEnabled()) {
        _log.debug("New store created " + store);
      }
    }
    currentAccount.setStore(store);
    return store;
  }
 catch (  MailAccountsException mae) {
    throw new NoSuchProviderException(mae.getMessage());
  }
}
