{
  HttpSession ses=req.getSession();
  try {
    MailSessionLock.lock(req);
    Long messageId=(Long)ses.getAttribute(WebKeys.MAIL_MESSAGE_ID);
    if (messageId != null) {
      return messageId.longValue();
    }
 else {
      return -1L;
    }
  }
  finally {
    MailSessionLock.unlock(req);
  }
}
