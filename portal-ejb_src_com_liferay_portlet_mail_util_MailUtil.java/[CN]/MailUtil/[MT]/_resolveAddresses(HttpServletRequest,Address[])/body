{
  Company company=null;
  try {
    company=PortalUtil.getCompany(req);
  }
 catch (  Exception e) {
    return addresses;
  }
  for (int i=0; i < addresses.length; i++) {
    InternetAddress address=(InternetAddress)addresses[i];
    if ((address.getPersonal() == null) && !Validator.isEmailAddress(address.getAddress())) {
      try {
        User user=UserLocalServiceUtil.getUserByEmailAddress(company.getCompanyId(),address.getAddress().trim() + StringPool.AT + company.getMx());
        addresses[i]=new InternetAddress(user.getEmailAddress(),user.getFullName());
      }
 catch (      Exception e) {
        _log.error("Problems found trying to resolve email address " + address);
        throw new RecipientException(e);
      }
    }
  }
  return addresses;
}
