{
  Store store=_getStore(ses);
  SearchTerm fullTerm=null;
  if (Validator.isNotNull(displayTerms.getFrom())) {
    fullTerm=new FromStringTerm(displayTerms.getFrom());
  }
  if (Validator.isNotNull(displayTerms.getTo())) {
    SearchTerm to=new RecipientStringTerm(Message.RecipientType.TO,displayTerms.getTo());
    SearchTerm cc=new RecipientStringTerm(Message.RecipientType.CC,displayTerms.getTo());
    SearchTerm bcc=new RecipientStringTerm(Message.RecipientType.BCC,displayTerms.getTo());
    SearchTerm term=to;
    term=_appendSearchTerm(term,cc,false);
    term=_appendSearchTerm(term,bcc,false);
    fullTerm=_appendSearchTerm(fullTerm,term,displayTerms.isAndOperator());
  }
  if (Validator.isNotNull(displayTerms.getSubject())) {
    SearchTerm term=new SubjectTerm(displayTerms.getSubject());
    fullTerm=_appendSearchTerm(fullTerm,term,displayTerms.isAndOperator());
  }
  if (Validator.isNotNull(displayTerms.getEntireMessage())) {
    String em=displayTerms.getEntireMessage();
    SearchTerm from=new FromStringTerm(em);
    SearchTerm to=new RecipientStringTerm(Message.RecipientType.TO,em);
    SearchTerm cc=new RecipientStringTerm(Message.RecipientType.CC,em);
    SearchTerm bcc=new RecipientStringTerm(Message.RecipientType.BCC,em);
    SearchTerm subject=new SubjectTerm(em);
    SearchTerm body=new BodyTerm(em);
    SearchTerm term=from;
    term=_appendSearchTerm(term,to,false);
    term=_appendSearchTerm(term,cc,false);
    term=_appendSearchTerm(term,bcc,false);
    term=_appendSearchTerm(term,subject,false);
    term=_appendSearchTerm(term,body,false);
    fullTerm=_appendSearchTerm(fullTerm,term,displayTerms.isAndOperator());
  }
  if (displayTerms.hasDate()) {
    SearchTerm startDate=new SentDateTerm(DateTerm.GE,displayTerms.getStartDate());
    SearchTerm endDate=new SentDateTerm(DateTerm.LE,displayTerms.getEndDate());
    SearchTerm term=startDate;
    term=_appendSearchTerm(term,endDate,true);
    fullTerm=_appendSearchTerm(fullTerm,term,displayTerms.isAndOperator());
  }
  if (fullTerm != null) {
    try {
      IMAPFolder folder=(IMAPFolder)store.getFolder(_getResolvedFolderName(displayTerms.getFolderName()));
      folder.open(IMAPFolder.READ_ONLY);
      Message[] messages=folder.search(fullTerm);
      _convertEnvelopes(folder,displayTerms.getFolderName(),messages,results);
    }
 catch (    MessagingException me) {
      throw new FolderException(me);
    }
  }
}
