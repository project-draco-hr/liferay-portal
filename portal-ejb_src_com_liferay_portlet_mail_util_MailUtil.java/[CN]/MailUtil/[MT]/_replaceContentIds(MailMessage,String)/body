{
  List list=mailMessage.getRemoteAttachments();
  String body=mailMessage.getHtmlBody();
  if (_log.isDebugEnabled()) {
    _log.debug("Body before replacing content ids\n" + body);
  }
  for (int i=0; i < list.size(); i++) {
    RemoteMailAttachment remoteMailAttachment=(RemoteMailAttachment)list.get(i);
    if (Validator.isNotNull(remoteMailAttachment.getContentId())) {
      String contentId=remoteMailAttachment.getContentId();
      if (contentId.startsWith(StringPool.LESS_THAN) && contentId.endsWith(StringPool.GREATER_THAN)) {
        contentId="cid:" + contentId.substring(1,contentId.length() - 1);
      }
      String remotePath=url + "fileName=" + remoteMailAttachment.getFilename()+ "&contentPath="+ remoteMailAttachment.getContentPath();
      body=StringUtil.replace(body,contentId,remotePath);
      list.remove(i);
      i--;
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Body after replacing content ids\n" + body);
  }
  mailMessage.setHtmlBody(body);
}
