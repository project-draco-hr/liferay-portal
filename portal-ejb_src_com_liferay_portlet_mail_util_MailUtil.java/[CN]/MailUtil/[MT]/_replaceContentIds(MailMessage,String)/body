{
  List list=mm.getRemoteAttachments();
  String body=mm.getHtmlBody();
  if (_log.isDebugEnabled()) {
    _log.debug("Body before CIDs have been replaced:\n" + body);
  }
  for (int i=0; i < list.size(); i++) {
    RemoteMailAttachment rma=(RemoteMailAttachment)list.get(i);
    if (Validator.isNotNull(rma.getContentID())) {
      String cid=rma.getContentID();
      if (cid.startsWith(StringPool.LESS_THAN) && cid.endsWith(StringPool.GREATER_THAN)) {
        cid="cid:" + cid.substring(1,cid.length() - 1);
      }
      String remotePath=url + "fileName=" + rma.getFilename()+ "&contentPath="+ rma.getContentPath();
      _log.info("Replacing all CIDs '" + cid + "' with "+ remotePath);
      body=StringUtil.replace(body,cid,remotePath);
      list.remove(i);
      i--;
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Body after CIDs have been replaced:\n" + body);
  }
  mm.setHtmlBody(body);
}
