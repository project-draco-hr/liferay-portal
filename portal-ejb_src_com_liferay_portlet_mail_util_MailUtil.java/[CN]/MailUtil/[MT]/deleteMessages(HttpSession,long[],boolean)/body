{
  try {
    MailSessionLock.lock(ses.getId());
    IMAPFolder folder=_getFolder(ses);
    String folderName=_getResolvedFolderName(folder.getName());
    if (permanently || folderName.equals(MAIL_TRASH_NAME)) {
      Message[] messages=folder.getMessagesByUID(messageIds);
      folder.setFlags(messages,new Flags(Flags.Flag.DELETED),true);
      folder.expunge();
    }
 else {
      moveMessages(ses,messageIds,MAIL_TRASH_NAME);
    }
  }
 catch (  MessagingException me) {
    throw new FolderException(me);
  }
 finally {
    MailSessionLock.unlock(ses.getId());
  }
}
