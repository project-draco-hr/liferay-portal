{
  HttpSession ses=req.getSession();
  try {
    MailSessionLock.getInstance().lock(ses.getId());
    long messageId=getMessageId(ses);
    if (messageId != -1L) {
      return getMessage(req,messageId);
    }
 else {
      return null;
    }
  }
  finally {
    MailSessionLock.getInstance().unlock(ses.getId());
  }
}
