{
  try {
    if (!oldFolderName.equals(MAIL_INBOX_NAME) && !oldFolderName.startsWith(MAIL_BOX_STYLE)) {
      oldFolderName=MAIL_BOX_STYLE + oldFolderName;
    }
    if (!newFolderName.equals(MAIL_INBOX_NAME) && !newFolderName.startsWith(MAIL_BOX_STYLE)) {
      newFolderName=MAIL_BOX_STYLE + newFolderName;
    }
    for (int i=0; i < DEFAULT_FOLDERS.length; i++) {
      if (DEFAULT_FOLDERS[i].equals(oldFolderName)) {
        _log.error("Folder " + oldFolderName + " is a system folder and cannot be changed");
        throw new FolderException();
      }
 else       if (DEFAULT_FOLDERS[i].equals(newFolderName)) {
        _log.error("Folder " + newFolderName + " is a system folder and cannot be changed");
        throw new FolderException();
      }
    }
    Store store=_getStore(ses);
    Folder oldFolder=store.getFolder(oldFolderName);
    Folder newFolder=store.getFolder(newFolderName);
    if (!oldFolder.exists()) {
      _log.error("Folder " + oldFolderName + " does not exist");
      throw new FolderException();
    }
 else     if (newFolder.exists()) {
      _log.error("Folder " + newFolderName + " already exists");
      throw new FolderException();
    }
    if (!oldFolder.isOpen()) {
      oldFolder.open(Folder.READ_WRITE);
    }
    oldFolder.renameTo(newFolder);
    Folder curFolder=_getFolder(ses);
    if (curFolder.getName().equals(oldFolderName)) {
      setFolder(ses,newFolderName);
    }
  }
 catch (  MessagingException me) {
    throw new FolderException(me);
  }
}
