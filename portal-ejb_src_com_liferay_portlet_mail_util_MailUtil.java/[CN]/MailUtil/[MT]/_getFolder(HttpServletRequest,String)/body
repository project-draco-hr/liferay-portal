{
  if (Validator.isNull(folderName)) {
    folderName=MAIL_INBOX_NAME;
  }
 else   if (!folderName.equals(MAIL_INBOX_NAME)) {
    if (!folderName.startsWith(MailUtil.MAIL_BOX_STYLE)) {
      folderName=MailUtil.MAIL_BOX_STYLE + folderName;
    }
  }
  Store store=getStore(req);
  FolderPool folderPool=getFolderPool(req);
  Folder folder=folderPool.get(MailCache.getFolderCacheId(folderName,store));
  if (folder == null) {
    folder=store.getFolder(folderName);
    if (!folder.exists()) {
      if (folder.create(Folder.HOLDS_MESSAGES)) {
        if (_log.isDebugEnabled()) {
          _log.debug("Created " + folderName);
        }
      }
 else {
        if (_log.isDebugEnabled()) {
          _log.debug("Failed to create " + folderName);
        }
      }
    }
    folderPool.put(MailCache.getFolderCacheId(folderName,store),folder);
  }
  if (!folder.isOpen()) {
    folder.open(Folder.READ_WRITE);
  }
  return folder;
}
