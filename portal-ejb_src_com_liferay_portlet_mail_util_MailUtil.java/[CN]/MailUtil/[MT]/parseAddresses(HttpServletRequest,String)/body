{
  InternetAddress[] addressesArray=InternetAddress.parse(addresses);
  Company company=null;
  try {
    company=PortalUtil.getCompany(req);
  }
 catch (  Exception e) {
    return addressesArray;
  }
  for (int i=0; i < addressesArray.length; i++) {
    InternetAddress address=addressesArray[i];
    if (address.getPersonal() == null && !Validator.isEmailAddress(address.getAddress())) {
      try {
        User user=UserLocalServiceUtil.getUserByEmailAddress(company.getCompanyId(),address.getAddress().trim() + "@" + company.getMx());
        if (user != null) {
          addressesArray[i]=new InternetAddress(user.getEmailAddress(),user.getFullName());
        }
      }
 catch (      Exception e) {
      }
    }
  }
  return addressesArray;
}
