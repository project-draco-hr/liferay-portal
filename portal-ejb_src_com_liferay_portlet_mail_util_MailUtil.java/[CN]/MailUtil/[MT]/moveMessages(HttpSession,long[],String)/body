{
  IMAPFolder toFolder=null;
  if (!toFolderName.equals(MAIL_INBOX_NAME) && !toFolderName.startsWith(MAIL_BOX_STYLE)) {
    toFolderName=MAIL_BOX_STYLE + toFolderName;
  }
  try {
    MailSessionLock.getInstance().lock(ses.getId());
    IMAPFolder folder=_getFolder(ses);
    if (folder.getName().equals(toFolderName)) {
      return;
    }
    if ((folder.getName().equals(MAIL_DRAFTS_NAME) || toFolderName.equals(MAIL_DRAFTS_NAME)) && (!toFolderName.equals(MAIL_TRASH_NAME))) {
      throw new FolderException();
    }
    Store store=_getStore(ses);
    toFolder=(IMAPFolder)store.getFolder(toFolderName);
    toFolder.open(IMAPFolder.READ_WRITE);
    Message[] messages=folder.getMessagesByUID(messageIds);
    folder.copyMessages(messages,toFolder);
    folder.setFlags(messages,new Flags(Flags.Flag.DELETED),true);
    folder.expunge();
  }
 catch (  MessagingException me) {
    throw new FolderException(me);
  }
 finally {
    try {
      if ((toFolder != null) && toFolder.isOpen()) {
        toFolder.close(true);
      }
    }
 catch (    Exception e) {
    }
    MailSessionLock.getInstance().unlock(ses.getId());
  }
}
