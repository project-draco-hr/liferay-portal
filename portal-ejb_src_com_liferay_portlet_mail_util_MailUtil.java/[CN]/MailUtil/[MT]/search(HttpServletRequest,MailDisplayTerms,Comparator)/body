{
  Set results=new TreeSet(comparator);
  if (Validator.isNotNull(displayTerms.getFolderName())) {
    _search(req,displayTerms,results);
  }
 else {
    List folders=getFolders(req);
    Iterator itr=folders.iterator();
    while (itr.hasNext()) {
      MailFolder mailFolder=(MailFolder)itr.next();
      String resolvedName=_getResolvedFolderName(mailFolder.getName());
      if (resolvedName.equals(MAIL_SPAM_NAME) || resolvedName.equals(MAIL_TRASH_NAME)) {
        continue;
      }
      displayTerms.setFolderName(mailFolder.getName());
      _search(req,displayTerms,results);
    }
  }
  return results;
}
