{
  String contentType=ParamUtil.getString(resourceRequest,"contentType");
  if (Validator.isNotNull(contentType)) {
    resourceResponse.setContentType(contentType);
  }
  if (resourceRequest.getResourceID() != null) {
    super.serveResource(mapping,form,portletConfig,resourceRequest,resourceResponse);
  }
 else {
    PortletPreferences preferences=resourceRequest.getPreferences();
    ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
    long groupId=ParamUtil.getLong(resourceRequest,"groupId");
    if (groupId < 1) {
      groupId=GetterUtil.getLong(preferences.getValue("groupId",StringPool.BLANK));
    }
    String articleId=ParamUtil.getString(resourceRequest,"articleId");
    String ddmTemplateKey=ParamUtil.getString(resourceRequest,"ddmTemplateKey");
    if (Validator.isNull(articleId)) {
      articleId=GetterUtil.getString(preferences.getValue("articleId",StringPool.BLANK));
      ddmTemplateKey=GetterUtil.getString(preferences.getValue("ddmTemplateKey",StringPool.BLANK));
    }
    String viewMode=ParamUtil.getString(resourceRequest,"viewMode");
    String languageId=LanguageUtil.getLanguageId(resourceRequest);
    int page=ParamUtil.getInteger(resourceRequest,"page",1);
    String xmlRequest=PortletRequestUtil.toXML(resourceRequest,resourceResponse);
    JournalArticleDisplay articleDisplay=null;
    if ((groupId > 0) && Validator.isNotNull(articleId)) {
      articleDisplay=JournalContentUtil.getDisplay(groupId,articleId,ddmTemplateKey,viewMode,languageId,themeDisplay,page,xmlRequest);
    }
    if (articleDisplay != null) {
      OutputStream os=resourceResponse.getPortletOutputStream();
      try {
        String content=articleDisplay.getContent();
        byte[] bytes=content.getBytes(StringPool.UTF8);
        os.write(bytes);
      }
  finally {
        os.close();
      }
    }
  }
}
