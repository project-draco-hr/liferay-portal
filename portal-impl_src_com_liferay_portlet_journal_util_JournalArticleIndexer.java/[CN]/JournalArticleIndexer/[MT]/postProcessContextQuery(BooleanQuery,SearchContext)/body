{
  Long classNameId=(Long)searchContext.getAttribute(Field.CLASS_NAME_ID);
  if ((classNameId != null) && (classNameId.longValue() != 0)) {
    contextQuery.addRequiredTerm("classNameId",classNameId.toString());
  }
  addStatus(contextQuery,searchContext);
  addSearchClassTypeIds(contextQuery,searchContext);
  String ddmStructureFieldName=(String)searchContext.getAttribute("ddmStructureFieldName");
  Serializable ddmStructureFieldValue=searchContext.getAttribute("ddmStructureFieldValue");
  if (Validator.isNotNull(ddmStructureFieldName) && Validator.isNotNull(ddmStructureFieldValue)) {
    String[] ddmStructureFieldNameParts=StringUtil.split(ddmStructureFieldName,StringPool.SLASH);
    DDMStructure structure=DDMStructureLocalServiceUtil.getStructure(GetterUtil.getLong(ddmStructureFieldNameParts[1]));
    String fieldName=StringUtil.replaceLast(ddmStructureFieldNameParts[2],StringPool.UNDERLINE.concat(LocaleUtil.toLanguageId(searchContext.getLocale())),StringPool.BLANK);
    try {
      ddmStructureFieldValue=DDMUtil.getIndexedFieldValue(ddmStructureFieldValue,structure.getFieldType(fieldName));
    }
 catch (    StructureFieldException sfe) {
    }
    contextQuery.addRequiredTerm(ddmStructureFieldName,StringPool.QUOTE + ddmStructureFieldValue + StringPool.QUOTE);
  }
  long[] folderIds=searchContext.getFolderIds();
  if ((folderIds != null) && (folderIds.length > 0) && (folderIds[0] != JournalFolderConstants.DEFAULT_PARENT_FOLDER_ID)) {
    BooleanQuery folderIdsQuery=BooleanQueryFactoryUtil.create(searchContext);
    for (    long folderId : folderIds) {
      try {
        JournalFolderServiceUtil.getFolder(folderId);
      }
 catch (      Exception e) {
        continue;
      }
      folderIdsQuery.addTerm(Field.FOLDER_ID,folderId);
    }
    contextQuery.add(folderIdsQuery,BooleanClauseOccur.MUST);
  }
  String articleType=(String)searchContext.getAttribute("articleType");
  if (Validator.isNotNull(articleType)) {
    contextQuery.addRequiredTerm(Field.TYPE,articleType);
  }
  String ddmStructureKey=(String)searchContext.getAttribute("ddmStructureKey");
  if (Validator.isNotNull(ddmStructureKey)) {
    contextQuery.addRequiredTerm("ddmStructureKey",ddmStructureKey);
  }
  String ddmTemplateKey=(String)searchContext.getAttribute("ddmTemplateKey");
  if (Validator.isNotNull(ddmTemplateKey)) {
    contextQuery.addRequiredTerm("ddmTemplateKey",ddmTemplateKey);
  }
  boolean head=GetterUtil.getBoolean(searchContext.getAttribute("head"),Boolean.TRUE);
  boolean relatedClassName=GetterUtil.getBoolean(searchContext.getAttribute("relatedClassName"));
  if (head && !relatedClassName) {
    contextQuery.addRequiredTerm("head",Boolean.TRUE);
  }
}
