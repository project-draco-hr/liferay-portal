{
  try {
    if (_output) {
      if (isPositionInLine()) {
        StringBundler replaceSb=new StringBundler(3);
        replaceSb.append("<script data-outputkey=\"");
        replaceSb.append(_outputKey);
        replaceSb.append("\" ");
        String bodyContentString=getBodyContentAsStringBundler().toString();
        bodyContentString=StringUtil.replace(bodyContentString,"<script",replaceSb.toString());
        JspWriter jspWriter=pageContext.getOut();
        jspWriter.write(bodyContentString);
      }
 else {
        OutputData outputData=_getOutputData(pageContext.getRequest());
        outputData.addData(_outputKey,_webKey,getBodyContentAsStringBundler());
      }
    }
    return EVAL_PAGE;
  }
 catch (  Exception e) {
    throw new JspException(e);
  }
 finally {
    if (!ServerDetector.isResin()) {
      cleanUp();
    }
  }
}
