{
  Document document=SAXReaderUtil.read(xml);
  Element rootElement=document.getRootElement();
  String portletId=rootElement.attributeValue("name");
  String instanceId=rootElement.attributeValue("instance");
  String queryString=rootElement.attributeValue("queryString");
  if (Validator.isNotNull(instanceId)) {
    portletId=PortletConstants.assemblePortletId(portletId,instanceId);
  }
  BufferCacheServletResponse bufferCacheServletResponse=new BufferCacheServletResponse(_response);
  queryString=PortletParameterUtil.addNamespace(portletId,queryString);
  Map<String,String[]> parameterMap=_request.getParameterMap();
  if (!portletId.equals(_request.getParameter("p_p_id"))) {
    parameterMap=MapUtil.filter(parameterMap,new HashMap<String,String[]>(),new PrefixPredicateFilter("p_p_"));
  }
  HttpServletRequest request=DynamicServletRequest.addQueryString(_request,parameterMap,queryString,false);
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Portlet portlet=getPortlet(themeDisplay,portletId);
  PortletContainerUtil.render(request,bufferCacheServletResponse,portlet);
  return bufferCacheServletResponse.getString();
}
