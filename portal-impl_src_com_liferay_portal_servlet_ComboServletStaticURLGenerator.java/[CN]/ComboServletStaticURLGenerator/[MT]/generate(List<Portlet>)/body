{
  List<String> urls=new ArrayList<String>();
  StringBundler sb=new StringBundler();
  long timestamp=_timestamp;
  portlets=ListUtil.sort(portlets,_portletNameComparator);
  for (  Portlet portlet : portlets) {
    for (    PortletResourceAccessor portletResourcesAccessor : _portletResourcesAccessors) {
      List<String> resources=ListUtil.sort(portletResourcesAccessor.get(portlet));
      for (      String resource : resources) {
        if (!_predicateFilter.filter(resource)) {
          continue;
        }
        if (_visitedURLs.contains(resource)) {
          continue;
        }
        if (HttpUtil.hasProtocol(resource)) {
          urls.add(resource);
        }
 else {
          sb.append(StringPool.AMPERSAND);
          String contextPath=portlet.getContextPath();
          if (!portletResourcesAccessor.isPortalResource() && (contextPath != null) && !contextPath.equals(PortalUtil.getPathContext())) {
            sb.append(contextPath);
            sb.append(StringPool.COLON);
          }
          sb.append(HtmlUtil.escape(resource));
          timestamp=Math.max(timestamp,portlet.getTimestamp());
        }
        _visitedURLs.add(resource);
      }
    }
  }
  if (sb.length() > 0) {
    String url=_urlPrefix + sb.toString();
    url=HttpUtil.addParameter(url,"t",timestamp);
    urls.add(url);
  }
  return urls;
}
