{
  long assetEntryId=rs.getLong("assetEntryId");
  AssetEntry assetEntry=AssetEntryLocalServiceUtil.fetchAssetEntry(assetEntryId);
  if (assetEntry == null) {
    return;
  }
  String actionId=rs.getString("actionId");
  if (actionId.equals(ActionKeys.SUBSCRIBE)) {
    String className=assetEntry.getClassName();
    if (className.equals(MBThread.class.getName())) {
      MBThread mbThread=MBThreadLocalServiceUtil.fetchThread(assetEntry.getClassPK());
      if (mbThread == null) {
        return;
      }
      assetEntry=AssetEntryLocalServiceUtil.fetchEntry(MBMessage.class.getName(),mbThread.getRootMessageId());
      if (assetEntry == null) {
        return;
      }
    }
  }
  long classNameId=PortalUtil.getClassNameId(User.class);
  long classPK=rs.getLong("userId");
  String name=SocialActivityCounterConstants.NAME_PARTICIPATION;
  int ownerType=SocialActivityCounterConstants.TYPE_ACTOR;
  int actionDate=rs.getInt("actionDate");
  Date actionDateDate=SocialCounterPeriodUtil.getDate(actionDate - 365);
  int startPeriod=SocialCounterPeriodUtil.getStartPeriod(actionDateDate.getTime());
  int endPeriod=SocialCounterPeriodUtil.getEndPeriod(actionDateDate.getTime());
  if (endPeriod == SocialCounterPeriodUtil.getEndPeriod()) {
    endPeriod=SocialActivityCounterConstants.END_PERIOD_UNDEFINED;
  }
  int type=rs.getInt("type_");
  int value=rs.getInt("value");
  if (type == 1) {
    name=SocialActivityCounterConstants.NAME_CONTRIBUTION;
    ownerType=SocialActivityCounterConstants.TYPE_CREATOR;
    updateActivityCounter(increment(),assetEntry.getGroupId(),assetEntry.getCompanyId(),classNameId,assetEntry.getUserId(),name,ownerType,startPeriod,endPeriod,value);
    classNameId=assetEntry.getClassNameId();
    classPK=assetEntry.getClassPK();
    name=SocialActivityCounterConstants.NAME_POPULARITY;
    ownerType=SocialActivityCounterConstants.TYPE_ASSET;
  }
  long equityLogId=rs.getLong("equityLogId");
  updateActivityCounter(equityLogId,assetEntry.getGroupId(),assetEntry.getCompanyId(),classNameId,classPK,name,ownerType,startPeriod,endPeriod,value);
}
