{
  long assetEntryId=rs.getLong("assetEntryId");
  long[] assetEntry=getAssetEntry(assetEntryId);
  if (assetEntry == null) {
    return;
  }
  String actionId=rs.getString("actionId");
  if (actionId.equals(ActionKeys.SUBSCRIBE)) {
    long classNameId=assetEntry[3];
    String className=PortalUtil.getClassName(classNameId);
    if (className.equals(MBThread.class.getName())) {
      long classPK=assetEntry[4];
      long threadRootMessageId=getThreadRootMessageId(classPK);
      if (threadRootMessageId == -1) {
        return;
      }
      assetEntry=getAssetEntry(MBMessage.class.getName(),threadRootMessageId);
      if (assetEntry == null) {
        return;
      }
    }
  }
  long classNameId=PortalUtil.getClassNameId(User.class);
  long classPK=rs.getLong("userId");
  String name=SocialActivityCounterConstants.NAME_PARTICIPATION;
  int ownerType=SocialActivityCounterConstants.TYPE_ACTOR;
  int actionDate=rs.getInt("actionDate");
  Date actionDateDate=SocialCounterPeriodUtil.getDate(actionDate - 365);
  int startPeriod=SocialCounterPeriodUtil.getStartPeriod(actionDateDate.getTime());
  int endPeriod=SocialCounterPeriodUtil.getEndPeriod(actionDateDate.getTime());
  if (endPeriod == SocialCounterPeriodUtil.getEndPeriod()) {
    endPeriod=SocialActivityCounterConstants.END_PERIOD_UNDEFINED;
  }
  int type=rs.getInt("type_");
  int value=rs.getInt("value");
  long groupId=assetEntry[0];
  long companyId=assetEntry[1];
  if (type == 1) {
    name=SocialActivityCounterConstants.NAME_CONTRIBUTION;
    ownerType=SocialActivityCounterConstants.TYPE_CREATOR;
    long userId=assetEntry[2];
    updateActivityCounter(increment(),groupId,companyId,classNameId,userId,name,ownerType,startPeriod,endPeriod,value);
    classNameId=assetEntry[3];
    classPK=assetEntry[4];
    name=SocialActivityCounterConstants.NAME_POPULARITY;
    ownerType=SocialActivityCounterConstants.TYPE_ASSET;
  }
  long equityLogId=rs.getLong("equityLogId");
  updateActivityCounter(equityLogId,groupId,companyId,classNameId,classPK,name,ownerType,startPeriod,endPeriod,value);
}
