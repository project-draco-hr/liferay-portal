{
  super(req);
  _req=req;
  _portletReq=portletReq;
  _lifecycle=_portletReq.getLifecycle();
  _pathInfo=GetterUtil.getString(pathInfo);
  _queryString=GetterUtil.getString(queryString);
  _requestURI=GetterUtil.getString(requestURI);
  _servletPath=GetterUtil.getString(servletPath);
  _named=named;
  _include=include;
  long userId=PortalUtil.getUserId(req);
  String remoteUser=req.getRemoteUser();
  Portlet portlet=portletReq.getPortlet();
  String userPrincipalStrategy=portlet.getUserPrincipalStrategy();
  if (userPrincipalStrategy.equals(PortletImpl.USER_PRINCIPAL_STRATEGY_SCREEN_NAME)) {
    try {
      User user=PortalUtil.getUser(req);
      _remoteUser=user.getScreenName();
      _remoteUserId=user.getUserId();
      _userPrincipal=new ProtectedPrincipal(_remoteUser);
    }
 catch (    Exception e) {
      _log.error(e);
    }
  }
 else {
    if ((userId > 0) && (remoteUser == null)) {
      _remoteUser=String.valueOf(userId);
      _remoteUserId=userId;
      _userPrincipal=new ProtectedPrincipal(_remoteUser);
    }
 else {
      _remoteUser=remoteUser;
      _remoteUserId=GetterUtil.getLong(remoteUser);
      _userPrincipal=req.getUserPrincipal();
    }
  }
}
