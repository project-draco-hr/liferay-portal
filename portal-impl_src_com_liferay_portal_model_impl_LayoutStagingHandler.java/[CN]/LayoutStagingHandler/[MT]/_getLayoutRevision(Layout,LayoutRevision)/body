{
  if (layoutRevision != null) {
    return layoutRevision;
  }
  ServiceContext serviceContext=ServiceContextThreadLocal.getServiceContext();
  long layoutRevisionId=ParamUtil.getLong(serviceContext,"layoutRevisionId");
  if (layoutRevisionId > 0) {
    return LayoutRevisionLocalServiceUtil.getLayoutRevision(layoutRevisionId);
  }
  long layoutSetBranchId=ParamUtil.getLong(serviceContext,"layoutSetBranchId");
  if (layoutSetBranchId > 0) {
    return LayoutRevisionLocalServiceUtil.getLayoutRevision(layoutSetBranchId,layout.getPlid(),true);
  }
  LayoutSetBranch layoutSetBranch=LayoutSetBranchLocalServiceUtil.getMasterLayoutSetBranch(layout.getGroupId(),layout.isPrivateLayout());
  return LayoutRevisionLocalServiceUtil.getLayoutRevision(layoutSetBranch.getLayoutSetBranchId(),layout.getPlid(),true);
}
