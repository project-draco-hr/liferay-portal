{
  GradleUtil.applyPlugin(project,BasePlugin.class);
  final PoshiRunnerExtension poshiRunnerExtension=GradleUtil.addExtension(project,"poshiRunner",PoshiRunnerExtension.class);
  addConfigurationPoshiRunner(project,poshiRunnerExtension);
  addConfigurationSikuli(project,poshiRunnerExtension);
  final JavaExec evaluatePoshiConsoleTask=addTaskEvaluatePoshiConsole(project);
  addTaskExpandPoshiRunner(project);
  final Test runPoshiTask=addTaskRunPoshi(project);
  final JavaExec validatePoshiTask=addTaskValidatePoshi(project);
  final JavaExec writePoshiPropertiesTask=addTaskWritePoshiProperties(project);
  project.afterEvaluate(new Action<Project>(){
    @Override public void execute(    Project project){
      Properties poshiProperties=null;
      File poshiPropertiesFile=poshiRunnerExtension.getPoshiPropertiesFile();
      if ((poshiPropertiesFile != null) && poshiPropertiesFile.exists()) {
        poshiProperties=GUtil.loadProperties(poshiPropertiesFile);
      }
      configureTaskEvaluatePoshiConsole(evaluatePoshiConsoleTask,poshiProperties,poshiRunnerExtension);
      configureTaskRunPoshi(runPoshiTask,poshiProperties,poshiRunnerExtension);
      configureTaskValidatePoshi(validatePoshiTask,poshiProperties,poshiRunnerExtension);
      configureTaskWritePoshiProperties(writePoshiPropertiesTask,poshiProperties,poshiRunnerExtension);
    }
  }
);
}
