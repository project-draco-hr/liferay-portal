{
  if (inputStream == null) {
    throw new IllegalArgumentException("Input stream cannot be null");
  }
  if (outputStream == null) {
    throw new IllegalArgumentException("Output stream cannot be null");
  }
  if (bufferSize <= 0) {
    bufferSize=BUFFER_SIZE;
  }
  try {
    if (!FORCE_TIO && (inputStream instanceof FileInputStream) && (outputStream instanceof FileOutputStream)) {
      FileInputStream fileInputStream=(FileInputStream)inputStream;
      FileOutputStream fileOutputStream=(FileOutputStream)outputStream;
      FileChannel sourceFileChannel=fileInputStream.getChannel();
      FileChannel targetFileChannel=fileOutputStream.getChannel();
      transferFileChannel(sourceFileChannel,targetFileChannel,length);
    }
 else {
      transferByteArray(inputStream,outputStream,bufferSize,length);
    }
  }
  finally {
    if (cleanUp) {
      cleanUp(inputStream,outputStream);
    }
  }
}
