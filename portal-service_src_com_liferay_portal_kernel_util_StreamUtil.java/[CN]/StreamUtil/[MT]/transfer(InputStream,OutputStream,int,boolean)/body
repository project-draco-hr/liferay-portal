{
  if (inputStream == null) {
    throw new IllegalArgumentException("Input stream cannot be null");
  }
  if (outputStream == null) {
    throw new IllegalArgumentException("Output stream cannot be null");
  }
  if (bufferSize <= 0) {
    bufferSize=BUFFER_SIZE;
  }
  if (!FORCE_TIO && (inputStream instanceof FileInputStream) && (outputStream instanceof FileOutputStream)) {
    FileInputStream fileInputStream=(FileInputStream)inputStream;
    FileChannel sourceChannel=fileInputStream.getChannel();
    FileOutputStream fileOutputStream=(FileOutputStream)outputStream;
    FileChannel targetChannel=fileOutputStream.getChannel();
    long position=0;
    while (position < sourceChannel.size()) {
      position+=sourceChannel.transferTo(position,sourceChannel.size() - position,targetChannel);
    }
    if (cleanUp) {
      cleanUp(fileInputStream,fileOutputStream);
    }
  }
 else {
    try {
      byte[] bytes=new byte[bufferSize];
      int value=-1;
      while ((value=inputStream.read(bytes)) != -1) {
        outputStream.write(bytes,0,value);
      }
    }
  finally {
      if (cleanUp) {
        cleanUp(inputStream,outputStream);
      }
    }
  }
}
