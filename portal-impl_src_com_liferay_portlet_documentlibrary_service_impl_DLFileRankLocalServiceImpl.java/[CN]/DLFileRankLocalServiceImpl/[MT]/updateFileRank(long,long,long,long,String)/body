{
  try {
    dlFileRankPersistence.removeByC_U_F_N(companyId,userId,folderId,name);
  }
 catch (  NoSuchFileRankException nsfre) {
  }
  DLFolder folder=dlFolderPersistence.findByPrimaryKey(folderId);
  long fileRankId=counterLocalService.increment();
  DLFileRank fileRank=dlFileRankPersistence.create(fileRankId);
  fileRank.setGroupId(folder.getGroupId());
  fileRank.setCompanyId(companyId);
  fileRank.setUserId(userId);
  fileRank.setCreateDate(new Date());
  fileRank.setFolderId(folderId);
  fileRank.setName(name);
  dlFileRankPersistence.update(fileRank,false);
  if (dlFileRankPersistence.countByG_U(groupId,userId) > 5) {
    List<DLFileRank> fileRanks=getFileRanks(groupId,userId);
    DLFileRank lastFileRank=fileRanks.get(fileRanks.size() - 1);
    dlFileRankPersistence.remove(lastFileRank);
  }
  return fileRank;
}
