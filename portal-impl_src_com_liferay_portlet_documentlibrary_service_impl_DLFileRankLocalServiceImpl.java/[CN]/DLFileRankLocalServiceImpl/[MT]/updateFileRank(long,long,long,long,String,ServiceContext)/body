{
  if (!PropsValues.DL_FILE_RANK_ENABLED) {
    return null;
  }
  DLFileRank fileRank=dlFileRankPersistence.fetchByC_U_F_N(companyId,userId,folderId,name);
  if (fileRank != null) {
    fileRank.setCreateDate(serviceContext.getCreateDate(null));
    dlFileRankPersistence.update(fileRank,false);
  }
 else {
    fileRank=addFileRank(groupId,companyId,userId,folderId,name,serviceContext);
  }
  if (dlFileRankPersistence.countByG_U(groupId,userId) > 5) {
    List<DLFileRank> fileRanks=getFileRanks(groupId,userId);
    DLFileRank lastFileRank=fileRanks.get(fileRanks.size() - 1);
    long lastFileRankId=lastFileRank.getFileRankId();
    try {
      dlFileRankPersistence.remove(lastFileRank);
    }
 catch (    Exception e) {
      _log.warn("Failed to remove file rank " + lastFileRankId + " because another thread already removed it");
    }
  }
  return fileRank;
}
