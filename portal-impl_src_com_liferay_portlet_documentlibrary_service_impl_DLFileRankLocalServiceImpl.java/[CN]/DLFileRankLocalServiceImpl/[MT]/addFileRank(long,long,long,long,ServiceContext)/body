{
  long fileRankId=counterLocalService.increment();
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  DLFileRank dlFileRank=dlFileRankPersistence.create(fileRankId);
  dlFileRank.setUuid(serviceContext.getUuid());
  dlFileRank.setGroupId(groupId);
  dlFileRank.setCompanyId(companyId);
  dlFileRank.setUserId(user.getUserId());
  dlFileRank.setUserName(user.getFullName());
  dlFileRank.setCreateDate(serviceContext.getCreateDate(now));
  dlFileRank.setModifiedDate(serviceContext.getModifiedDate(now));
  dlFileRank.setFileEntryId(fileEntryId);
  dlFileRank.setActive(true);
  try {
    dlFileRankPersistence.update(dlFileRank);
  }
 catch (  SystemException se) {
    if (_log.isWarnEnabled()) {
      _log.warn("Add failed, fetch {companyId=" + companyId + ", userId="+ userId+ ", fileEntryId="+ fileEntryId+ "}");
    }
    dlFileRank=dlFileRankPersistence.fetchByC_U_F(companyId,userId,fileEntryId,false);
    if (dlFileRank == null) {
      throw se;
    }
  }
  return dlFileRank;
}
