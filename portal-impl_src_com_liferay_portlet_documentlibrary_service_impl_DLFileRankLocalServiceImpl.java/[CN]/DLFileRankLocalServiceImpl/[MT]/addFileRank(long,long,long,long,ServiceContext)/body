{
  long fileRankId=counterLocalService.increment();
  DLFileRank fileRank=dlFileRankPersistence.create(fileRankId);
  fileRank.setGroupId(groupId);
  fileRank.setCompanyId(companyId);
  fileRank.setUserId(userId);
  fileRank.setCreateDate(serviceContext.getCreateDate(null));
  fileRank.setFileEntryId(fileEntryId);
  try {
    dlFileRankPersistence.update(fileRank,false);
  }
 catch (  SystemException se) {
    if (_log.isWarnEnabled()) {
      _log.warn("Add failed, fetch {companyId=" + companyId + ", userId="+ userId+ ", fileEntryId="+ fileEntryId+ "}");
    }
    fileRank=dlFileRankPersistence.fetchByC_U_F(companyId,userId,fileEntryId,false);
    if (fileRank == null) {
      throw se;
    }
  }
  return fileRank;
}
