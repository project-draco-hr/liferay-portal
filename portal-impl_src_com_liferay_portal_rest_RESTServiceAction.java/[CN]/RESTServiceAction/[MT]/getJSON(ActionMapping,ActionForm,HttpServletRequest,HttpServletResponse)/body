{
  String path=GetterUtil.getString(request.getPathInfo());
  String method=GetterUtil.getString(request.getMethod());
  try {
    RestAction restAction=RestActionsManagerUtil.lookup(path,method);
    if (restAction == null) {
      throw new RuntimeException("No REST action associated with path " + path + " and method "+ method);
    }
    Object returnObj=restAction.invoke();
    if (returnObj != null) {
      return getReturnValue(returnObj,restAction.getReturnType());
    }
 else {
      JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
      return jsonObject.toString();
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    if (e instanceof InvocationTargetException) {
      jsonObject.put("exception",e.getCause().toString());
    }
 else {
      jsonObject.put("exception",e.getMessage());
    }
    return jsonObject.toString();
  }
}
