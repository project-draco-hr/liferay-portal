{
  Class<? extends PersistedModel> collectionType=null;
  for (  Object object : collection) {
    Queue<Class<?>> classes=new LinkedList<Class<?>>();
    classes.add(object.getClass());
    Class<?> clazz=null;
    while ((clazz=classes.poll()) != null) {
      if (ArrayUtil.contains(clazz.getInterfaces(),PersistedModel.class)) {
        if (collectionType == null) {
          collectionType=(Class<? extends PersistedModel>)clazz;
        }
 else         if (collectionType != clazz) {
          return null;
        }
        break;
      }
      classes.add(clazz.getSuperclass());
      classes.addAll(Arrays.asList(clazz.getInterfaces()));
    }
  }
  return collectionType;
}
