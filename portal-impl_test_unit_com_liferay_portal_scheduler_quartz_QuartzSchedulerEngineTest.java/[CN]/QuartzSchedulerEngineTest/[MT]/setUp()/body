{
  JSONFactoryUtil jsonFactoryUtil=new JSONFactoryUtil();
  jsonFactoryUtil.setJSONFactory(new JSONFactoryImpl());
  Thread currentThread=Thread.currentThread();
  ClassLoader currentClassLoader=currentThread.getContextClassLoader();
  PortalClassLoaderUtil.setClassLoader(currentClassLoader);
  PortalUUIDUtil portalUUIDUtil=new PortalUUIDUtil();
  portalUUIDUtil.setPortalUUID(new PortalUUIDImpl());
  PropsUtil.setProps(new PropsImpl());
  ClassLoaderPool.register(_TEST_PORTLET_ID,currentClassLoader);
  MessageBusUtil.init(new DefaultMessageBus(),null,null);
  _testDestination=new SynchronousDestination();
  _testDestination.setName(_TEST_DESTINATION_NAME);
  MessageBusUtil.addDestination(_testDestination);
  _quartzSchedulerEngine=new QuartzSchedulerEngine();
  ReflectionTestUtil.setFieldValue(_quartzSchedulerEngine,"_memoryScheduler",new MockScheduler(StorageType.MEMORY));
  ReflectionTestUtil.setFieldValue(_quartzSchedulerEngine,"_persistedScheduler",new MockScheduler(StorageType.PERSISTED));
  _quartzSchedulerEngine.start();
}
