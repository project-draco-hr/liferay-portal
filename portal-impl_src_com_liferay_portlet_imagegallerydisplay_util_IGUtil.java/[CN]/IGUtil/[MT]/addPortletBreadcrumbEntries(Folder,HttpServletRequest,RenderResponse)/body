{
  String strutsAction=ParamUtil.getString(request,"struts_action");
  PortletURL portletURL=renderResponse.createRenderURL();
  if (strutsAction.equals("/image_gallery_display/select_folder")) {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    portletURL.setParameter("struts_action",strutsAction);
    portletURL.setWindowState(LiferayWindowState.POP_UP);
    PortalUtil.addPortletBreadcrumbEntry(request,themeDisplay.translate("home"),portletURL.toString());
  }
 else {
    portletURL.setParameter("struts_action","/image_gallery_display/view");
  }
  List<Long> ancestorFolderIds=folder.getAncestorFolderIds();
  Collections.reverse(ancestorFolderIds);
  String portletId=PortalUtil.getPortletId(request);
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getPortletPreferences(request,portletId);
  long rootFolderId=PrefsParamUtil.getLong(preferences,request,"rootFolderId",DLFolderConstants.DEFAULT_PARENT_FOLDER_ID);
  List<Long> filteredFolderAncestorIds=removeRootFolderAncestors(rootFolderId,ancestorFolderIds);
  for (  Long ancestorFolderId : filteredFolderAncestorIds) {
    portletURL.setParameter("folderId",String.valueOf(ancestorFolderId));
    Folder ancestorFolder=DLAppLocalServiceUtil.getFolder(ancestorFolderId);
    PortalUtil.addPortletBreadcrumbEntry(request,ancestorFolder.getName(),portletURL.toString());
  }
  portletURL.setParameter("folderId",String.valueOf(folder.getFolderId()));
  if (strutsAction.equals("/journal/select_image_gallery")) {
    portletURL.setParameter("groupId",String.valueOf(folder.getGroupId()));
  }
  PortalUtil.addPortletBreadcrumbEntry(request,folder.getName(),portletURL.toString());
}
