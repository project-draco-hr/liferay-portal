{
  try (LoggingTimer loggingTimer=new LoggingTimer()){
    List<Layout> layouts=LayoutLocalServiceUtil.getNullFriendlyURLLayouts();
    for (    Layout layout : layouts) {
      List<LayoutFriendlyURL> layoutFriendlyURLs=LayoutFriendlyURLLocalServiceUtil.getLayoutFriendlyURLs(layout.getPlid());
      for (      LayoutFriendlyURL layoutFriendlyURL : layoutFriendlyURLs) {
        String friendlyURL=StringPool.SLASH + layout.getLayoutId();
        LayoutLocalServiceUtil.updateFriendlyURL(layout.getUserId(),layout.getPlid(),friendlyURL,layoutFriendlyURL.getLanguageId());
      }
    }
    ActionableDynamicQuery actionableDynamicQuery=LayoutFriendlyURLLocalServiceUtil.getActionableDynamicQuery();
    actionableDynamicQuery.setAddCriteriaMethod(new ActionableDynamicQuery.AddCriteriaMethod(){
      @Override public void addCriteria(      DynamicQuery dynamicQuery){
        DynamicQuery layoutDynamicQuery=LayoutLocalServiceUtil.dynamicQuery();
        Projection projection=ProjectionFactoryUtil.property("plid");
        layoutDynamicQuery.setProjection(projection);
        Property plidProperty=PropertyFactoryUtil.forName("plid");
        dynamicQuery.add(plidProperty.notIn(layoutDynamicQuery));
      }
    }
);
    actionableDynamicQuery.setPerformActionMethod(new ActionableDynamicQuery.PerformActionMethod<LayoutFriendlyURL>(){
      @Override public void performAction(      LayoutFriendlyURL layoutFriendlyURL){
        LayoutFriendlyURLLocalServiceUtil.deleteLayoutFriendlyURL(layoutFriendlyURL);
      }
    }
);
    actionableDynamicQuery.performActions();
  }
 }
