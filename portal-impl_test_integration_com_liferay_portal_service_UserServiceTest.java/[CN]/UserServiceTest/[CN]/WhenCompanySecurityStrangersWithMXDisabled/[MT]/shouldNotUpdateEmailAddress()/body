{
  Field field=ReflectionUtil.getDeclaredField(PropsValues.class,"COMPANY_SECURITY_STRANGERS_WITH_MX");
  Object value=field.get(null);
  String name=PrincipalThreadLocal.getName();
  try {
    field.set(null,Boolean.FALSE);
    User user=UserTestUtil.addUser(false);
    PrincipalThreadLocal.setName(user.getUserId());
    String emailAddress="UserServiceTest." + RandomTestUtil.nextLong() + "@liferay.com";
    UserServiceUtil.updateEmailAddress(user.getUserId(),user.getPassword(),emailAddress,emailAddress,new ServiceContext());
  }
  finally {
    field.set(null,value);
    PrincipalThreadLocal.setName(name);
  }
}
