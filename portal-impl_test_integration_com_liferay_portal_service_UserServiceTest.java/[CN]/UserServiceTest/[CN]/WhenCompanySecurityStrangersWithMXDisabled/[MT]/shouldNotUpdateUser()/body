{
  boolean companySecurityStrangersWithMx=PropsValues.COMPANY_SECURITY_STRANGERS_WITH_MX;
  String name=PrincipalThreadLocal.getName();
  User user=UserTestUtil.addUser(false);
  try {
    ReflectionTestUtil.setFieldValue(PropsValues.class,"COMPANY_SECURITY_STRANGERS_WITH_MX",false);
    PrincipalThreadLocal.setName(user.getUserId());
    UserTestUtil.updateUser(user);
  }
  finally {
    ReflectionTestUtil.setFieldValue(PropsValues.class,"COMPANY_SECURITY_STRANGERS_WITH_MX",companySecurityStrangersWithMx);
    PrincipalThreadLocal.setName(name);
    UserLocalServiceUtil.deleteUser(user);
  }
}
