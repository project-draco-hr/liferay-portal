{
  User user=UserTestUtil.addUser(true);
  List<Group> groups=new ArrayList<>();
  Group parentGroup=GroupTestUtil.addGroup();
  Group childGroup=GroupTestUtil.addGroup(parentGroup.getGroupId());
  childGroup.setMembershipRestriction(GroupConstants.MEMBERSHIP_RESTRICTION_TO_PARENT_SITE_MEMBERS);
  GroupLocalServiceUtil.updateGroup(childGroup);
  groups.add(parentGroup);
  groups.add(childGroup);
  GroupLocalServiceUtil.addUserGroups(user.getUserId(),groups);
  user=updateUser(user);
  Assert.assertEquals(groups,user.getGroups());
}
