{
  PortletPreferences portletPreferences=givenThatCompanySendsNewPassword();
  try {
    int initialInboxSize=MailServiceTestUtil.getInboxSize();
    boolean sentPassword=UserServiceUtil.sendPasswordByEmailAddress(_user.getCompanyId(),_user.getEmailAddress());
    Assert.assertTrue(sentPassword);
    Assert.assertEquals(initialInboxSize + 1,MailServiceTestUtil.getInboxSize());
    Assert.assertTrue(MailServiceTestUtil.lastMailMessageContains("email_password_sent_body.tmpl"));
  }
  finally {
    restorePortletPreferences(portletPreferences);
  }
}
