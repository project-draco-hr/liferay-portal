{
  String imageId=getImageId(req);
  if (Validator.isNull(imageId)) {
    if (_log.isWarnEnabled()) {
      _log.warn("Image id should never be null or empty, path is " + req.getPathInfo());
    }
    return;
  }
  Image image=ImageLocalUtil.get(imageId);
  if (image == null) {
    if (_log.isWarnEnabled()) {
      _log.warn("Get a default image for " + imageId);
    }
    image=getDefaultImage(req,imageId);
  }
  if (image == null) {
    if (_log.isWarnEnabled()) {
      _log.warn("No default image exists for " + imageId);
    }
  }
 else {
    if (!image.getType().equals(ImageImpl.TYPE_NOT_AVAILABLE)) {
      res.setContentType("image/" + image.getType());
    }
    try {
      ServletResponseUtil.write(res,image.getTextObj());
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn(e,e);
      }
    }
  }
}
