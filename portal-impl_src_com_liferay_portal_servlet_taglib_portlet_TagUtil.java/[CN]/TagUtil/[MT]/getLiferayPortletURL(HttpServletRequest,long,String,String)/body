{
  PortletRequest portletRequest=(PortletRequest)request.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  if (portletRequest == null) {
    return null;
  }
  LiferayPortletURL portletURL=null;
  if (PropsValues.PORTLET_CONTAINER_IMPL_SUN && _isWARFile(portletRequest)) {
    portletURL=new LiferayPortletURLImpl(request,portletName,portletRequest.getWindowState(),portletRequest.getPortletMode(),_getPlid(request,plid),lifecycle);
  }
 else {
    PortletResponseImpl portletResponse=(PortletResponseImpl)request.getAttribute(JavaConstants.JAVAX_PORTLET_RESPONSE);
    portletURL=portletResponse.createPortletURLImpl(plid,portletName,lifecycle);
  }
  return portletURL;
}
