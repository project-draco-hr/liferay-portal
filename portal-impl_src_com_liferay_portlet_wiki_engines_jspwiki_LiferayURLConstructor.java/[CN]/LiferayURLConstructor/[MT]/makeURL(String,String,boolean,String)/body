{
  String decodedName=HttpUtil.encodeURL(WikiUtil.decodeJSPWikiName(name));
  if (Validator.isNotNull(parameters)) {
    if (context.equals(WikiContext.ATTACH)) {
      parameters=StringPool.QUESTION + parameters;
    }
 else     if (context.equals(WikiContext.NONE)) {
      if (decodedName.indexOf(StringPool.QUESTION) != -1) {
        parameters="&amp;" + parameters;
      }
 else {
        parameters=StringPool.QUESTION + parameters;
      }
    }
 else {
      parameters="&amp;" + parameters;
    }
  }
 else {
    parameters=StringPool.BLANK;
  }
  String path;
  if (context.equals(WikiContext.EDIT)) {
    path="[$BEGIN_PAGE_TITLE_EDIT$]" + decodedName + "[$END_PAGE_TITLE_EDIT$]";
  }
 else   if (context.equals(WikiContext.VIEW)) {
    path="[$BEGIN_PAGE_TITLE$]" + decodedName + "[$END_PAGE_TITLE$]";
  }
 else   if (context.equals(WikiContext.ATTACH)) {
    if (decodedName.indexOf(StringPool.SLASH) == -1) {
      path="[$ATTACHMENT_URL_PREFIX$][$WIKI_PAGE_NAME$]/" + decodedName;
    }
 else {
      path="[$ATTACHMENT_URL_PREFIX$]" + decodedName;
    }
  }
 else {
    path=decodedName;
  }
  return path + parameters;
}
