{
  final Path regularFromFilePath=Paths.get("RegularFromFile");
  Path regularToFilePath=Paths.get("RegularToFile");
  final AtomicMoveNotSupportedException atomicMoveNotSupportedException=new AtomicMoveNotSupportedException(regularFromFilePath.toString(),regularToFilePath.toString(),"Atomic move not supported");
  createFile(regularFromFilePath);
  try (SwappableSecurityManager swappableSecurityManager=new SwappableSecurityManager(){
    @Override public void checkWrite(    String file){
      if (file.equals(regularFromFilePath.toString())) {
        ReflectionUtil.throwException(atomicMoveNotSupportedException);
      }
    }
  }
){
    swappableSecurityManager.install();
    FileHelperUtil.move(regularFromFilePath,regularToFilePath);
  }
   Assert.assertTrue(Files.notExists(regularFromFilePath));
  Assert.assertTrue(Files.exists(regularToFilePath));
  Files.delete(regularToFilePath);
}
