{
  PortletRequest portletRequest=(PortletRequest)req.getAttribute(WebKeys.JAVAX_PORTLET_REQUEST);
  RenderRequest renderRequest=null;
  if ((portletRequest != null) && (portletRequest instanceof RenderRequest)) {
    renderRequest=(RenderRequest)portletRequest;
  }
  PortletResponse portletResponse=(PortletResponse)req.getAttribute(WebKeys.JAVAX_PORTLET_RESPONSE);
  RenderResponse renderResponse=null;
  if ((portletResponse != null) && (portletResponse instanceof RenderResponse)) {
    renderResponse=(RenderResponse)portletResponse;
  }
  String rootPortletId=Portlet.getRootPortletId(portletName);
  String instanceId=Portlet.getInstanceId(portletName);
  StringBuffer renderPortletSB=new StringBuffer();
  RuntimePortletUtil.processPortlet(renderPortletSB,ctx,req,res,renderRequest,renderResponse,rootPortletId,instanceId);
  if (pageContext != null) {
    pageContext.getOut().print(renderPortletSB.toString());
  }
 else {
    res.getOutputStream().print(renderPortletSB.toString());
  }
}
