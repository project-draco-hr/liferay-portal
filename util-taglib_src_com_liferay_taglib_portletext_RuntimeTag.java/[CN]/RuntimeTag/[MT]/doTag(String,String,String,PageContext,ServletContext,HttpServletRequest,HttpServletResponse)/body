{
  PortletRequest portletRequest=(PortletRequest)request.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  RenderRequest renderRequest=null;
  if ((portletRequest != null) && (portletRequest instanceof RenderRequest)) {
    renderRequest=(RenderRequest)portletRequest;
  }
  PortletResponse portletResponse=(PortletResponse)request.getAttribute(JavaConstants.JAVAX_PORTLET_RESPONSE);
  RenderResponse renderResponse=null;
  if ((portletResponse != null) && (portletResponse instanceof RenderResponse)) {
    renderResponse=(RenderResponse)portletResponse;
  }
  String portletId=portletName;
  HttpServletResponse servletResponse=response;
  if (pageContext != null) {
    servletResponse=new PipingServletResponse(response,pageContext.getOut());
  }
  try {
    request.setAttribute(WebKeys.RENDER_PORTLET_RESOURCE,Boolean.TRUE);
    if (Validator.isNotNull(defaultPreferences)) {
      PortletPreferencesFactoryUtil.getPortletSetup(request,portletId,defaultPreferences);
    }
    RuntimePortletUtil.processPortlet(servletContext,request,servletResponse,renderRequest,renderResponse,portletId,queryString,true);
  }
  finally {
    request.removeAttribute(WebKeys.RENDER_PORTLET_RESOURCE);
  }
}
