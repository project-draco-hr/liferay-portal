{
  long groupId=ParamUtil.getLong(request,"groupId");
  String languageId=LanguageUtil.getLanguageId(request);
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Map<String,String> tokens=JournalUtil.getTokens(groupId,themeDisplay);
  Document resultsDoc=DocumentFactory.getInstance().createDocument(StringPool.UTF8);
  Element resultSetEl=resultsDoc.addElement("result-set");
  SAXReader reader=new SAXReader();
  for (  JournalArticle article : articles) {
    Element resultEl=resultSetEl.addElement("result");
    Document articleDoc=reader.read(new StringReader(article.getContentByLocale(languageId)));
    resultEl.content().add(articleDoc.getRootElement().createCopy());
    if (article.isTemplateDriven()) {
      resultEl=resultEl.element("root");
    }
    JournalUtil.addAllReservedEls(resultEl,tokens,article);
  }
  return JournalUtil.formatXML(resultsDoc).getBytes(StringPool.UTF8);
}
