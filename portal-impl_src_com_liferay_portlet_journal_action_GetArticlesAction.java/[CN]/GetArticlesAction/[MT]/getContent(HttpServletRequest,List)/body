{
  long groupId=ParamUtil.getLong(req,"groupId");
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  String languageId=LanguageUtil.getLanguageId(req);
  if (Validator.isNull(languageId)) {
    languageId=themeDisplay.getLanguageId();
  }
  Map tokens=JournalUtil.getTokens(groupId,themeDisplay);
  Document resultsDoc=DocumentFactory.getInstance().createDocument("UTF-8");
  Element resultSetEl=resultsDoc.addElement("result-set");
  SAXReader reader=new SAXReader();
  Iterator itr=articles.iterator();
  while (itr.hasNext()) {
    JournalArticle article=(JournalArticle)itr.next();
    Element resultEl=resultSetEl.addElement("result");
    Document articleDoc=reader.read(new StringReader(article.getContentByLocale(languageId)));
    resultEl.content().add(articleDoc.getRootElement().createCopy());
    if (article.isTemplateDriven()) {
      resultEl=resultEl.element("root");
    }
    JournalUtil.addAllReservedEls(resultEl,tokens,article);
  }
  return JournalUtil.formatXML(resultsDoc).getBytes("UTF-8");
}
