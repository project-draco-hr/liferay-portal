{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  String userId=ParamUtil.getString(req,"userId");
  String rtString="";
  req.getSession().setAttribute(WebKeys.USER_ID,userId);
  req.getSession().setAttribute(WebKeys.USER_PASSWORD,"liferaymailx");
  if ("getFolders".equals(cmd)) {
    List folders=MailUtil.getAllFolders(MailUtil.getStore(req));
    rtString=_getFolders(folders);
  }
 else   if ("getPreview".equals(cmd)) {
    String folderId=ParamUtil.getString(req,"folderId");
    Folder folder=MailUtil.getFolder(req,folderId);
    rtString=_getPreviewHeaders(userId,folder);
  }
 else   if ("getMessage".equals(cmd)) {
    Folder folder=MailUtil.getFolder(req,"Inbox");
    int messageId=ParamUtil.getInteger(req,"messageId");
    rtString=_getMessage(folder,messageId);
  }
  MailUtil.closeStore(req);
  System.out.println("super");
  return rtString;
}
