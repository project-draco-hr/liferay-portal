{
  JSONObject jsonObj=new JSONObject();
  String folderId=ParamUtil.getString(req,"folderId");
  String sortBy=ParamUtil.getString(req,"sortBy");
  boolean asc=ParamUtil.getBoolean(req,"asc");
  SortedSet set;
  MailUtil.setCurrentFolder(req.getSession(),folderId);
  if ("name".equals(sortBy)) {
    set=MailUtil.getEnvelopes(req.getSession(),new RecipientComparator(asc));
  }
 else   if ("subject".equals(sortBy)) {
    set=MailUtil.getEnvelopes(req.getSession(),new SubjectComparator(asc));
  }
 else {
    set=MailUtil.getEnvelopes(req.getSession(),new DateComparator(asc));
  }
  JSONArray meArray=new JSONArray();
  for (Iterator itr=set.iterator(); itr.hasNext(); ) {
    MailEnvelope me=(MailEnvelope)itr.next();
    JSONObject jMe=new JSONObject();
    jMe.put("id",me.getMsgUID());
    jMe.put("email",me.getRecipient());
    jMe.put("subject",me.getSubject());
    jMe.put("date",me.getDate().toString());
    meArray.put(jMe);
  }
  jsonObj.put("headers",meArray);
  return jsonObj.toString();
}
