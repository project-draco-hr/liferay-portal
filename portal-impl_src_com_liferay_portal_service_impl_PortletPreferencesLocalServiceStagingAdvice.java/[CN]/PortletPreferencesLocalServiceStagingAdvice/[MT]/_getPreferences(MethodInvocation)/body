{
  Method method=methodInvocation.getMethod();
  Object args[]=methodInvocation.getArguments();
  long plid=0;
  String portletId=null;
  if (args.length == 1) {
    PortletPreferencesIds portletPreferencesIds=(PortletPreferencesIds)args[0];
    plid=portletPreferencesIds.getPlid();
    portletId=portletPreferencesIds.getPortletId();
  }
 else {
    plid=(Long)args[3];
    portletId=(String)args[4];
  }
  if (portletId.equals(PortletKeys.LIFERAY_PORTAL) || (plid <= 0)) {
    return methodInvocation.proceed();
  }
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  if (!LayoutStagingUtil.isBranchingLayout(layout)) {
    return methodInvocation.proceed();
  }
  LayoutRevision layoutRevision=LayoutStagingUtil.getLayoutRevision(layout);
  plid=layoutRevision.getLayoutRevisionId();
  if (args.length == 1) {
    PortletPreferencesIds portletPreferencesIds=(PortletPreferencesIds)args[0];
    portletPreferencesIds.setPlid(plid);
  }
 else {
    args[3]=plid;
  }
  return method.invoke(methodInvocation.getThis(),args);
}
