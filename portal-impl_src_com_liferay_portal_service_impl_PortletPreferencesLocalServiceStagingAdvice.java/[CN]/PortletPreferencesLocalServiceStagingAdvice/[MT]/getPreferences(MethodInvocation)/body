{
  Method method=methodInvocation.getMethod();
  Object[] arguments=methodInvocation.getArguments();
  long plid=0;
  if (arguments.length == 1) {
    PortletPreferencesIds portletPreferencesIds=(PortletPreferencesIds)arguments[0];
    plid=portletPreferencesIds.getPlid();
  }
 else {
    plid=(Long)arguments[3];
  }
  LayoutRevision layoutRevision=getLayoutRevision(plid);
  if (layoutRevision == null) {
    return methodInvocation.proceed();
  }
  long userId=PrincipalThreadLocal.getUserId();
  User user=UserLocalServiceUtil.fetchUser(userId);
  if ((user == null) || user.isDefaultUser()) {
    plid=layoutRevision.getLayoutRevisionId();
  }
 else {
    plid=StagingUtil.getRecentLayoutRevisionId(user,layoutRevision.getLayoutSetBranchId(),layoutRevision.getPlid());
  }
  if (arguments.length == 1) {
    PortletPreferencesIds portletPreferencesIds=(PortletPreferencesIds)arguments[0];
    arguments[0]=new PortletPreferencesIds(portletPreferencesIds.getCompanyId(),portletPreferencesIds.getOwnerId(),portletPreferencesIds.getOwnerType(),plid,portletPreferencesIds.getPortletId());
  }
 else {
    arguments[3]=plid;
  }
  return method.invoke(methodInvocation.getThis(),arguments);
}
