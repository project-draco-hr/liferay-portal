{
  if (cacheConfiguration == null) {
    return null;
  }
  String portalCacheName=cacheConfiguration.getName();
  if (portalCacheName == null) {
    portalCacheName=PortalCacheConfiguration.DEFAULT_PORTAL_CACHE_NAME;
  }
  Map<CallbackConfiguration,CacheListenerScope> cacheListenerConfigurations=new HashMap<>();
  List<CacheEventListenerFactoryConfiguration> cacheEventListenerConfigurations=cacheConfiguration.getCacheEventListenerConfigurations();
  for (  CacheEventListenerFactoryConfiguration cacheEventListenerFactoryConfiguration : cacheEventListenerConfigurations) {
    String factoryClassName=_parseFactoryClassName(cacheEventListenerFactoryConfiguration.getFullyQualifiedClassPath(),props);
    Properties properties=_parseProperties(cacheEventListenerFactoryConfiguration.getProperties(),cacheEventListenerFactoryConfiguration.getPropertySeparator(),props);
    CacheListenerScope cacheListenerScope=_cacheListenerScopes.get(cacheEventListenerFactoryConfiguration.getListenFor());
    if (factoryClassName.equals(props.get(PropsKeys.EHCACHE_CACHE_EVENT_LISTENER_FACTORY))) {
      if (clusterAware && clusterEnabled) {
        if (clusterLinkReplicationEnabled) {
          cacheListenerConfigurations.put(new CallbackConfiguration(ClusterLinkCallbackFactory.INSTANCE,properties),cacheListenerScope);
        }
 else {
          properties.put(EhcacheConstants.CACHE_EVENT_LISTENER_FACTORY_CLASS_NAME,factoryClassName);
          cacheListenerConfigurations.put(new CallbackConfiguration(EhcacheCallbackFactory.INSTANCE,properties),cacheListenerScope);
        }
      }
    }
 else     if (!usingDefault) {
      properties.put(EhcacheConstants.CACHE_EVENT_LISTENER_FACTORY_CLASS_NAME,factoryClassName);
      cacheListenerConfigurations.put(new CallbackConfiguration(EhcacheCallbackFactory.INSTANCE,properties),cacheListenerScope);
    }
  }
  cacheEventListenerConfigurations.clear();
  CallbackConfiguration bootstrapLoaderConfiguration=null;
  BootstrapCacheLoaderFactoryConfiguration bootstrapCacheLoaderFactoryConfiguration=cacheConfiguration.getBootstrapCacheLoaderFactoryConfiguration();
  if (bootstrapCacheLoaderFactoryConfiguration != null) {
    Properties properties=_parseProperties(bootstrapCacheLoaderFactoryConfiguration.getProperties(),bootstrapCacheLoaderFactoryConfiguration.getPropertySeparator(),props);
    if (clusterAware && clusterEnabled) {
      if (clusterLinkReplicationEnabled) {
        bootstrapLoaderConfiguration=new CallbackConfiguration(ClusterLinkCallbackFactory.INSTANCE,properties);
      }
 else {
        properties.put(EhcacheConstants.BOOTSTRAP_CACHE_LOADER_FACTORY_CLASS_NAME,_parseFactoryClassName(bootstrapCacheLoaderFactoryConfiguration.getFullyQualifiedClassPath(),props));
        bootstrapLoaderConfiguration=new CallbackConfiguration(EhcacheCallbackFactory.INSTANCE,properties);
      }
    }
    cacheConfiguration.addBootstrapCacheLoaderFactory(null);
  }
  return new PortalCacheConfiguration(portalCacheName,cacheListenerConfigurations,bootstrapLoaderConfiguration);
}
