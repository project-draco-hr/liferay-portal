{
  if (configurationURL == null) {
    throw new NullPointerException("Configuration path is null");
  }
  Configuration ehcacheConfiguration=ConfigurationFactory.parseConfiguration(configurationURL);
  List<?> peerProviderConfiguration=ehcacheConfiguration.getCacheManagerPeerProviderFactoryConfiguration();
  if (!peerProviderConfiguration.isEmpty() && (!clusterAware || !PropsValues.CLUSTER_LINK_ENABLED || PropsValues.EHCACHE_CLUSTER_LINK_REPLICATION_ENABLED)) {
    peerProviderConfiguration.clear();
  }
  peerProviderConfiguration=ehcacheConfiguration.getCacheManagerPeerListenerFactoryConfigurations();
  if (!peerProviderConfiguration.isEmpty() && (!clusterAware || !PropsValues.CLUSTER_LINK_ENABLED || PropsValues.EHCACHE_CLUSTER_LINK_REPLICATION_ENABLED)) {
    peerProviderConfiguration.clear();
  }
  Set<CallbackConfiguration> cacheManagerListenerConfigurations=_getCacheManagerListenerConfigurations(ehcacheConfiguration);
  PortalCacheConfiguration defaultPortalCacheConfiguration=_parseCacheConfiguration(ehcacheConfiguration.getDefaultCacheConfiguration(),clusterAware,usingDefault);
  Set<PortalCacheConfiguration> portalCacheConfigurations=new HashSet<PortalCacheConfiguration>();
  Map<String,CacheConfiguration> cacheConfigurations=ehcacheConfiguration.getCacheConfigurations();
  for (  Map.Entry<String,CacheConfiguration> entry : cacheConfigurations.entrySet()) {
    portalCacheConfigurations.add(_parseCacheConfiguration(entry.getValue(),clusterAware,usingDefault));
  }
  PortalCacheManagerConfiguration portalCacheManagerConfiguration=new PortalCacheManagerConfiguration(cacheManagerListenerConfigurations,defaultPortalCacheConfiguration,portalCacheConfigurations);
  return new ObjectValuePair<Configuration,PortalCacheManagerConfiguration>(ehcacheConfiguration,portalCacheManagerConfiguration);
}
