{
  int pos=templateId.indexOf(TemplateConstants.BUNDLE_SEPARATOR);
  if (pos == -1) {
    throw new IllegalArgumentException(String.format("The templateId \"%s\" does not map to a Soy template",templateId));
  }
  String capabilityPrefix=templateId.substring(0,pos);
  Bundle bundle=_bundleProvidersMap.get(capabilityPrefix);
  if (bundle == null) {
    throw new IllegalStateException("There are no bundles providing " + capabilityPrefix);
  }
  String templateName=templateId.substring(pos + TemplateConstants.BUNDLE_SEPARATOR.length());
  return bundle.getResource(templateName);
}
