{
  content=Html.stripHtml(content);
  Document doc=new Document();
  doc.add(LuceneFields.getKeyword(LuceneFields.UID,LuceneFields.getUID(PORTLET_ID,messageId)));
  doc.add(LuceneFields.getKeyword(LuceneFields.COMPANY_ID,companyId));
  doc.add(LuceneFields.getKeyword(LuceneFields.PORTLET_ID,PORTLET_ID));
  doc.add(LuceneFields.getKeyword(LuceneFields.GROUP_ID,groupId));
  doc.add(LuceneFields.getText(LuceneFields.USER_NAME,userName));
  doc.add(LuceneFields.getText(LuceneFields.TITLE,title));
  doc.add(LuceneFields.getText(LuceneFields.CONTENT,content));
  doc.add(LuceneFields.getDate(LuceneFields.MODIFIED));
  doc.add(LuceneFields.getKeyword("categoryId",categoryId));
  doc.add(LuceneFields.getKeyword("threadId",threadId));
  doc.add(LuceneFields.getKeyword("messageId",messageId));
  IndexWriter writer=null;
  try {
    writer=LuceneUtil.getWriter(companyId);
    writer.addDocument(doc);
  }
  finally {
    if (writer != null) {
      LuceneUtil.write(companyId);
    }
  }
}
