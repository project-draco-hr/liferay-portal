{
  try {
    ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
    PortletPreferences prefs=req.getPreferences();
    long nodeId=GetterUtil.getLong(prefs.getValue("node-id",StringPool.BLANK));
    String title=ParamUtil.getString(req,"title",WikiPageImpl.FRONT_PAGE);
    WikiNode node=WikiNodeServiceUtil.getNode(nodeId);
    WikiPage wikiPage=null;
    try {
      wikiPage=WikiPageServiceUtil.getPage(nodeId,title);
    }
 catch (    NoSuchPageException nspe) {
      wikiPage=WikiPageServiceUtil.addPage(nodeId,title,prefs,themeDisplay);
    }
    req.setAttribute(WebKeys.WIKI_NODE,node);
    req.setAttribute(WebKeys.WIKI_PAGE,wikiPage);
    return mapping.findForward("portlet.wiki_display.view");
  }
 catch (  NoSuchNodeException nsne) {
    return mapping.findForward("/portal/portlet_not_setup");
  }
catch (  PrincipalException pe) {
    SessionErrors.add(req,pe.getClass().getName());
    return mapping.findForward("portlet.wiki_display.error");
  }
}
