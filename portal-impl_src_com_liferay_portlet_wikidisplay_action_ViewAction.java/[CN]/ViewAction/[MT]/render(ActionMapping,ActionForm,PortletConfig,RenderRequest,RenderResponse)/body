{
  try {
    PortletPreferences portletPreferences=renderRequest.getPreferences();
    ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
    String nodeName=ParamUtil.getString(renderRequest,"nodeName");
    WikiNode node=null;
    if (Validator.isNotNull(nodeName)) {
      node=WikiNodeServiceUtil.getNode(themeDisplay.getScopeGroupId(),nodeName);
    }
 else {
      long nodeId=GetterUtil.getLong(portletPreferences.getValue("nodeId",StringPool.BLANK));
      node=WikiNodeServiceUtil.getNode(nodeId);
    }
    if (node.getGroupId() != themeDisplay.getScopeGroupId()) {
      throw new NoSuchNodeException("{nodeId=" + node.getNodeId() + "}");
    }
    String title=ParamUtil.getString(renderRequest,"title",portletPreferences.getValue("title",WikiPageConstants.FRONT_PAGE));
    double version=ParamUtil.getDouble(renderRequest,"version");
    WikiPage page=WikiPageServiceUtil.fetchPage(node.getNodeId(),title,version);
    if ((page == null) || page.isInTrash()) {
      page=WikiPageServiceUtil.getPage(node.getNodeId(),WikiPageConstants.FRONT_PAGE);
    }
    renderRequest.setAttribute(WebKeys.WIKI_NODE,node);
    renderRequest.setAttribute(WebKeys.WIKI_PAGE,page);
    return actionMapping.findForward("portlet.wiki_display.view");
  }
 catch (  NoSuchNodeException nsne) {
    return actionMapping.findForward("/portal/portlet_not_setup");
  }
catch (  NoSuchPageException nspe) {
    return actionMapping.findForward("/portal/portlet_not_setup");
  }
catch (  PrincipalException pe) {
    SessionErrors.add(renderRequest,pe.getClass());
    return actionMapping.findForward("portlet.wiki_display.error");
  }
}
