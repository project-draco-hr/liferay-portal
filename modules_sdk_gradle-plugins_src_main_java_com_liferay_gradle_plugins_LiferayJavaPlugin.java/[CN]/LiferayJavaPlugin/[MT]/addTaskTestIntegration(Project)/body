{
  Test test=GradleUtil.addTask(project,TEST_INTEGRATION_TASK_NAME,Test.class);
  test.dependsOn(SETUP_ARQUILLIAN_TASK_NAME);
  test.mustRunAfter(JavaPlugin.TEST_TASK_NAME);
  test.setDescription("Runs the integration tests.");
  test.setGroup("verification");
  ConventionMapping conventionMapping=test.getConventionMapping();
  final SourceSet sourceSet=GradleUtil.getSourceSet(project,TEST_INTEGRATION_SOURCE_SET_NAME);
  conventionMapping.map("classpath",new Callable<FileCollection>(){
    @Override public FileCollection call() throws Exception {
      return sourceSet.getRuntimeClasspath();
    }
  }
);
  conventionMapping.map("testClassesDir",new Callable<File>(){
    @Override public File call() throws Exception {
      SourceSetOutput sourceSetOutput=sourceSet.getOutput();
      return sourceSetOutput.getClassesDir();
    }
  }
);
  conventionMapping.map("testSrcDirs",new Callable<List<File>>(){
    @Override public List<File> call() throws Exception {
      SourceDirectorySet sourceDirectorySet=sourceSet.getJava();
      return new ArrayList<>(sourceDirectorySet.getSrcDirs());
    }
  }
);
  Task checkTask=GradleUtil.getTask(project,"check");
  checkTask.dependsOn(test);
  return test;
}
