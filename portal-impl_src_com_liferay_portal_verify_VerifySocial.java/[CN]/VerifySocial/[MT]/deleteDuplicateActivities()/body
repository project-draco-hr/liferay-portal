{
  StringBundler sb=new StringBundler(14);
  sb.append("select distinct sa1.* from SocialActivity sa1 ");
  sb.append("inner join SocialActivity sa2 on ");
  sb.append("sa1.activityId != sa2.activityId and ");
  sb.append("sa1.groupId = sa2.groupId and ");
  sb.append("sa1.userId = sa2.userId and ");
  sb.append("sa1.classNameId = sa2.classNameId and ");
  sb.append("sa1.classPK = sa2.classPK and ");
  sb.append("sa1.type_ = sa2.type_ and ");
  sb.append("sa1.extraData = sa2.extraData and ");
  sb.append("sa1.receiverUserId = sa2.receiverUserId ");
  sb.append("where sa1.mirrorActivityId = 0 ");
  sb.append("order by sa1.groupId, sa1.userId, sa1.classNameId, ");
  sb.append("sa1.classPK, sa1.type_, sa1.extraData, ");
  sb.append("sa1.receiverUserId, sa1.createDate desc");
  String sql=sb.toString();
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getUpgradeOptimizedConnection();
    ps=con.prepareStatement(sql);
    rs=ps.executeQuery();
    long groupId=0;
    long userId=0;
    long classNameId=0;
    long classPK=0;
    long type=0;
    String extraData=StringPool.BLANK;
    long receiverUserId=0;
    while (rs.next()) {
      long curActivityId=rs.getLong("activityId");
      long curGroupId=rs.getLong("groupId");
      long curUserId=rs.getLong("userId");
      long curClassNameId=rs.getLong("classNameId");
      long curClassPK=rs.getLong("classPK");
      long curType=rs.getLong("type_");
      String curExtraData=rs.getString("extraData");
      long curReceiverUserId=rs.getLong("receiverUserId");
      if ((curGroupId == groupId) && (curUserId == userId) && (curClassNameId == classNameId)&& (curClassPK == classPK)&& (curType == type)&& curExtraData.equals(extraData)&& (curReceiverUserId == receiverUserId)) {
        SocialActivityLocalServiceUtil.deleteActivity(curActivityId);
      }
 else {
        groupId=curGroupId;
        userId=curUserId;
        classNameId=curClassNameId;
        classPK=curClassPK;
        type=curType;
        extraData=curExtraData;
        receiverUserId=curReceiverUserId;
      }
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
