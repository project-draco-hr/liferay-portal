{
  User user=userPersistence.findByPrimaryKey(userId);
  if (user.isDefaultUser()) {
    return;
  }
  Iterator itr=messages.iterator();
  while (itr.hasNext()) {
    MBMessage message=(MBMessage)itr.next();
    MBMessageFlag messageFlag=mbMessageFlagPersistence.fetchByU_M(userId,message.getMessageId());
    if (messageFlag == null) {
      long messageFlagId=counterLocalService.increment();
      messageFlag=mbMessageFlagPersistence.create(messageFlagId);
      messageFlag.setUserId(userId);
      messageFlag.setMessageId(message.getMessageId());
      messageFlag.setFlag(MBMessageFlagImpl.READ_FLAG);
      mbMessageFlagPersistence.update(messageFlag);
    }
  }
}
