{
  if (userId > 0) {
    Iterator itr=messages.iterator();
    while (itr.hasNext()) {
      MBMessage message=(MBMessage)itr.next();
      MBMessageFlag messageFlag=MBMessageFlagUtil.fetchByU_M(userId,message.getMessageId());
      if (messageFlag == null) {
        long messageFlagId=CounterLocalServiceUtil.increment();
        messageFlag=MBMessageFlagUtil.create(messageFlagId);
        messageFlag.setUserId(userId);
        messageFlag.setMessageId(message.getMessageId());
        messageFlag.setFlag(MBMessageFlagImpl.READ_FLAG);
        MBMessageFlagUtil.update(messageFlag);
      }
    }
  }
}
