{
  if (MBMessageFlagLocalServiceUtil.hasAnswerFlag(messageId)) {
    mbMessageFlagPersistence.removeByM_F(messageId,MBMessageFlagConstants.ANSWER_FLAG);
  }
  List<MBMessage> messages=mbMessagePersistence.findByT_P(threadId,messageId);
  for (  MBMessage message : messages) {
    if (MBMessageFlagLocalServiceUtil.hasAnswerFlag(message.getMessageId())) {
      mbMessageFlagPersistence.removeByM_F(message.getMessageId(),MBMessageFlagConstants.ANSWER_FLAG);
    }
    if (mbMessagePersistence.countByT_P(threadId,message.getMessageId()) > 0) {
      deleteAnswerFlags(threadId,message.getMessageId());
    }
  }
}
