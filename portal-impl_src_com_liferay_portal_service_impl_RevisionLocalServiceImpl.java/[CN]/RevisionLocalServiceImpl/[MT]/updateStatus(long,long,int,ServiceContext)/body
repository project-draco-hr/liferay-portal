{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  Revision revision=revisionPersistence.findByPrimaryKey(revisionId);
  revision.setModifiedDate(serviceContext.getModifiedDate(now));
  revision.setStatus(status);
  revision.setStatusByUserId(user.getUserId());
  revision.setStatusByUserName(user.getFullName());
  revision.setStatusDate(serviceContext.getModifiedDate(now));
  if (status == WorkflowConstants.STATUS_APPROVED) {
    revision.setHead(true);
    List<Revision> revisions=revisionPersistence.findByB_P(revision.getBranchId(),revision.getPlid());
    for (    Revision curRevision : revisions) {
      if (curRevision.getRevisionId() != revision.getRevisionId()) {
        curRevision.setHead(false);
        revisionPersistence.update(curRevision,false);
      }
    }
  }
 else {
    revision.setHead(false);
    List<Revision> revisions=revisionPersistence.findByB_P_S(revision.getBranchId(),revision.getPlid(),WorkflowConstants.STATUS_APPROVED);
    for (    Revision curRevision : revisions) {
      if (curRevision.getRevisionId() != revision.getRevisionId()) {
        curRevision.setHead(true);
        revisionPersistence.update(curRevision,false);
        break;
      }
    }
  }
  revisionPersistence.update(revision,false);
  return revision;
}
