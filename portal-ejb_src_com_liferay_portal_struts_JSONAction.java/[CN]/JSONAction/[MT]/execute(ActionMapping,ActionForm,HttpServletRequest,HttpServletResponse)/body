{
  String ajaxId=req.getParameter("ajax_id");
  String callback=ParamUtil.getString(req,"callback");
  String instance=ParamUtil.getString(req,"inst");
  String json=null;
  try {
    json=getJSON(mapping,form,req,res);
    if (Validator.isNotNull(callback)) {
      json=callback + "(" + json+ ");";
    }
 else     if (Validator.isNotNull(instance)) {
      json="var " + instance + "="+ json+ ";";
    }
  }
 catch (  Exception e) {
    res.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR,e.getMessage());
    return null;
  }
  if (Validator.isNotNull(json)) {
    res.setContentType(Constants.TEXT_JAVASCRIPT);
    res.setHeader(HttpHeaders.CACHE_CONTROL,"no-cache");
    if (ajaxId != null) {
      res.setHeader("Ajax-ID",ajaxId);
    }
    PrintWriter pw=res.getWriter();
    pw.write(json);
    pw.close();
  }
  return null;
}
