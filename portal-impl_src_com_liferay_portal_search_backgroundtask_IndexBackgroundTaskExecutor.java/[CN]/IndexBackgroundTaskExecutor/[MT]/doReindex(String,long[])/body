{
  if (LuceneHelperUtil.isLoadIndexFromClusterEnabled()) {
    MessageValuesThreadLocal.setValue(LuceneHelper.SKIP_LOAD_INDEX_FROM_CLUSTER,true);
  }
  Set<String> usedSearchEngineIds=new HashSet<>();
  if (Validator.isNull(className)) {
    for (    long companyId : companyIds) {
      try {
        SearchEngineInitializer searchEngineInitializer=new SearchEngineInitializer(companyId);
        searchEngineInitializer.reindex();
        usedSearchEngineIds.addAll(searchEngineInitializer.getUsedSearchEngineIds());
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
    }
  }
 else {
    Indexer indexer=IndexerRegistryUtil.getIndexer(className);
    if (indexer == null) {
      return;
    }
    Set<String> searchEngineIds=new HashSet<>();
    searchEngineIds.add(indexer.getSearchEngineId());
    for (    String searchEngineId : searchEngineIds) {
      for (      long companyId : companyIds) {
        SearchEngineUtil.deleteEntityDocuments(searchEngineId,companyId,className,true);
      }
    }
    for (    long companyId : companyIds) {
      ShardUtil.pushCompanyService(companyId);
      try {
        indexer.reindex(new String[]{String.valueOf(companyId)});
        usedSearchEngineIds.add(indexer.getSearchEngineId());
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
 finally {
        ShardUtil.popCompanyService();
      }
    }
  }
  if (!LuceneHelperUtil.isLoadIndexFromClusterEnabled()) {
    return;
  }
  Set<BaseAsyncDestination> searchWriterDestinations=new HashSet<>();
  MessageBus messageBus=MessageBusUtil.getMessageBus();
  for (  String usedSearchEngineId : usedSearchEngineIds) {
    String searchWriterDestinationName=SearchEngineUtil.getSearchWriterDestinationName(usedSearchEngineId);
    Destination destination=messageBus.getDestination(searchWriterDestinationName);
    if (destination instanceof BaseAsyncDestination) {
      BaseAsyncDestination baseAsyncDestination=(BaseAsyncDestination)destination;
      searchWriterDestinations.add(baseAsyncDestination);
    }
  }
  submitClusterIndexLoadingSyncJob(searchWriterDestinations,companyIds);
}
