{
  List<LogRecord> logRecords=JDKLoggerTestUtil.configureJDKLogger(SPIClassPathContextListener.class.getName(),Level.FINE);
  File spiEmbeddedLibDir=new File(_CONTEXT_PATH,_EMBEDDED_LIB_DIR_NAME);
  spiEmbeddedLibDir.mkdir();
  File jarFile=new File(spiEmbeddedLibDir,"jarfile.jar");
  jarFile.createNewFile();
  File notJarFile=new File(spiEmbeddedLibDir,"notjarfile.zip");
  notJarFile.createNewFile();
  String invalidSPIProviderClassName="InvalidSPIProvider";
  _mockServletContext.addInitParameter("spiProviderClassName",invalidSPIProviderClassName);
  SPIClassPathContextListener spiClassPathContextListener=new SPIClassPathContextListener();
  spiClassPathContextListener.contextInitialized(new ServletContextEvent(_mockServletContext));
  String spiClassPath=jarFile.getAbsolutePath() + File.pathSeparator + _CONTEXT_PATH+ "/WEB-INF/classes"+ File.pathSeparator+ ClassPathUtil.getGlobalClassPath();
  Assert.assertEquals(spiClassPath,SPIClassPathContextListener.SPI_CLASS_PATH);
  Assert.assertEquals(3,logRecords.size());
  LogRecord logRecord=logRecords.get(0);
  Assert.assertEquals("SPI embedded lib class path " + jarFile.getAbsolutePath() + File.pathSeparator,logRecord.getMessage());
  logRecord=logRecords.get(1);
  Assert.assertEquals("SPI class path " + spiClassPath,logRecord.getMessage());
  logRecord=logRecords.get(2);
  Assert.assertEquals("Unable to create SPI provider with name InvalidSPIProvider",logRecord.getMessage());
  logRecords=JDKLoggerTestUtil.configureJDKLogger(SPIClassPathContextListener.class.getName(),Level.OFF);
  spiClassPathContextListener.contextInitialized(new ServletContextEvent(_mockServletContext));
  Assert.assertEquals(spiClassPath,SPIClassPathContextListener.SPI_CLASS_PATH);
  Assert.assertTrue(logRecords.isEmpty());
}
