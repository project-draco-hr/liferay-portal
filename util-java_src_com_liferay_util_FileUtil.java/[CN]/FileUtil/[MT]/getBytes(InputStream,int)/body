{
  ByteArrayMaker out=null;
  if (bufferSize <= 0) {
    out=new ByteArrayMaker();
  }
 else {
    out=new ByteArrayMaker(bufferSize);
  }
  boolean createBuffered=false;
  try {
    if (!(in instanceof BufferedInputStream)) {
      in=new BufferedInputStream(in);
      createBuffered=true;
    }
    int c=in.read();
    while (c != -1) {
      out.write(c);
      c=in.read();
    }
  }
  finally {
    if (createBuffered) {
      in.close();
    }
  }
  out.close();
  return out.toByteArray();
}
