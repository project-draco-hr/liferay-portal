{
  BundlePortletApp bundlePortletApp=serviceRegistrations.getBundlePortletApp();
  if (bundlePortletApp != null) {
    return bundlePortletApp;
  }
  com.liferay.portal.kernel.model.Portlet portalPortletModel=_portletLocalService.getPortletById(CompanyConstants.SYSTEM,PortletKeys.PORTAL);
  bundlePortletApp=new BundlePortletApp(bundle,portalPortletModel,_httpServiceEndpoint);
  createContext(bundle,bundlePortletApp,serviceRegistrations);
  serviceRegistrations.setBundlePortletApp(bundlePortletApp);
  serviceRegistrations.doConfiguration(classLoader);
  BundleContext bundleContext=bundle.getBundleContext();
  Dictionary<String,Object> properties=new HashMapDictionary<>();
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_SELECT,bundlePortletApp.getServletContextName());
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_LISTENER,Boolean.TRUE.toString());
  serviceRegistrations.addServiceRegistration(bundleContext.registerService(ServletContextListener.class,bundlePortletApp,properties));
  return bundlePortletApp;
}
