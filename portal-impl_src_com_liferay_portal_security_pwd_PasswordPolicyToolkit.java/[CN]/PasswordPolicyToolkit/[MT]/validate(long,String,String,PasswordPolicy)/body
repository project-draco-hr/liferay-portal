{
  if (passwordPolicy.isCheckSyntax()) {
    if (!passwordPolicy.isAllowDictionaryWords() && WordsUtil.isDictionaryWord(password1)) {
      throw new UserPasswordException.MustNotContainDictionaryWords(userId,WordsUtil.getDictionaryList());
    }
    if (password1.length() < passwordPolicy.getMinLength()) {
      throw new UserPasswordException.MustBeLonger(userId,passwordPolicy.getMinLength());
    }
    if ((getUsageCount(password1,_validatorAlphanumericCharsetArray) < passwordPolicy.getMinAlphanumeric()) || (getUsageCount(password1,_validatorLowerCaseCharsetArray) < passwordPolicy.getMinLowerCase()) || (getUsageCount(password1,_validatorNumbersCharsetArray) < passwordPolicy.getMinNumbers())|| (getUsageCount(password1,_validatorSymbolsCharsetArray) < passwordPolicy.getMinSymbols())|| (getUsageCount(password1,_validatorUpperCaseCharsetArray) < passwordPolicy.getMinUpperCase())) {
      throw new UserPasswordException.MustNotBeTrivial(userId);
    }
    String regex=passwordPolicy.getRegex();
    if (Validator.isNotNull(regex) && !password1.matches(regex)) {
      throw new UserPasswordException.MustComplyWithRegex(userId,regex);
    }
  }
  if (!passwordPolicy.isChangeable() && (userId != 0)) {
    throw new UserPasswordException.MustNotBeChanged(userId);
  }
  if (userId == 0) {
    return;
  }
  User user=UserLocalServiceUtil.getUserById(userId);
  Date passwordModfiedDate=user.getPasswordModifiedDate();
  if (passwordModfiedDate != null) {
    Date now=new Date();
    long passwordModificationElapsedTime=now.getTime() - passwordModfiedDate.getTime();
    long minAge=passwordPolicy.getMinAge() * 1000;
    if ((passwordModificationElapsedTime < minAge) && !user.getPasswordReset()) {
      throw new UserPasswordException.MustNotBeChangedYet(userId,new Date(passwordModfiedDate.getTime() + minAge));
    }
  }
  if (PasswordTrackerLocalServiceUtil.isSameAsCurrentPassword(userId,password1)) {
    throw new UserPasswordException.MustNotBeEqualToCurrent(userId);
  }
 else   if (!PasswordTrackerLocalServiceUtil.isValidPassword(userId,password1)) {
    throw new UserPasswordException.MustNotBeRecentlyUsed(userId);
  }
}
