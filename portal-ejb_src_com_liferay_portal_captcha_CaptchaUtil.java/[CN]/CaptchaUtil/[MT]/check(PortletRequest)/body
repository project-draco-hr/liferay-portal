{
  if (GetterUtil.getBoolean(PropsUtil.get(PropsUtil.CAPTCHA_CHALLENGE))) {
    PortletSession ses=req.getPortletSession();
    String captcha=(String)ses.getAttribute(WebKeys.CAPTCHA);
    if (captcha != null) {
      if (!captcha.equals(ParamUtil.getString(req,"captcha"))) {
        throw new CaptchaException();
      }
    }
 else {
      if (_log.isErrorEnabled()) {
        _log.error("Captcha is null");
      }
    }
  }
}
