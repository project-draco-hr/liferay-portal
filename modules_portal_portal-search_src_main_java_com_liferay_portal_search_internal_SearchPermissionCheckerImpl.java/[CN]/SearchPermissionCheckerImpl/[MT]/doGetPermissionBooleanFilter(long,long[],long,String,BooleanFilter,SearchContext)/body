{
  Indexer<?> indexer=_indexerRegistry.getIndexer(className);
  if (!indexer.isPermissionAware()) {
    return booleanFilter;
  }
  PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
  User user=permissionChecker.getUser();
  if ((user == null) || (user.getUserId() != userId)) {
    user=_userLocalService.fetchUser(userId);
    if (user == null) {
      return booleanFilter;
    }
    permissionChecker=PermissionCheckerFactoryUtil.create(user);
  }
  if (permissionChecker.getUserBag() == null) {
    return booleanFilter;
  }
  Set<Group> groups;
  Set<Role> roles=new LinkedHashSet<>();
  Set<UserGroupRole> userGroupRoles=new LinkedHashSet<>();
  Map<Long,List<Role>> groupIdsToRoles=new HashMap<>();
  if (PropsValues.SEARCH_USE_DEEP_SEARCH) {
    groups=new LinkedHashSet<>(_groupLocalService.getUserGroups(userId,true));
    for (    Group group : groups) {
      groupIds=ArrayUtil.append(groupIds,group.getGroupId());
    }
    groupIds=ArrayUtil.unique(groupIds);
  }
 else {
    groups=new LinkedHashSet<>();
  }
  populate(companyId,groupIds,userId,permissionChecker,groups,roles,userGroupRoles,groupIdsToRoles);
  return doGetPermissionFilter_6(companyId,groupIds,userId,permissionChecker,className,booleanFilter,groups,roles,userGroupRoles,groupIdsToRoles);
}
