{
  try {
    String folderName1=req.getParameter("folder_name");
    String folderName2=req.getParameter("folder_name_2");
    Folder folder1=MailUtil.getFolder(req,folderName1);
    Folder folder2=MailUtil.getFolder(req,folderName2);
    List msgs=new ArrayList();
    String[] msgNumbers=req.getParameterValues("msg_numbers");
    if (msgNumbers != null) {
      for (int i=0; i < msgNumbers.length; i++) {
        try {
          int msgId=Integer.parseInt(msgNumbers[i]);
          msgs.add(folder1.getMessage(msgId));
        }
 catch (        NumberFormatException nfe) {
        }
      }
    }
    Message[] messages=(Message[])msgs.toArray(new Message[0]);
    folder1.copyMessages(messages,folder2);
    folder1.setFlags(messages,new Flags(Flags.Flag.DELETED),true);
    folder1.expunge();
    res.sendRedirect(ParamUtil.getString(req,"redirect"));
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    setForward(req,Constants.COMMON_ERROR);
  }
}
