{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Group group=themeDisplay.getScopeGroup();
  String portletId=LayoutAdminPortletKeys.GROUP_PAGES;
  if (group.isLayoutPrototype()) {
    portletId=LayoutAdminPortletKeys.LAYOUT_PROTOTYPE_PAGE;
  }
  PortletURL editPageURL=PortalUtil.getControlPanelPortletURL(request,portletId,PortletRequest.RENDER_PHASE);
  Layout layout=themeDisplay.getLayout();
  editPageURL.setParameter("groupId",String.valueOf(layout.getGroupId()));
  editPageURL.setParameter("selPlid",String.valueOf(layout.getPlid()));
  editPageURL.setParameter("privateLayout",String.valueOf(layout.isPrivateLayout()));
  editPageURL.setParameter("treeId","layoutsTree");
  editPageURL.setParameter("viewLayout",Boolean.TRUE.toString());
  return editPageURL.toString();
}
