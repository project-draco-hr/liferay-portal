{
  UnsyncByteArrayOutputStream unsyncByteArrayOutputStream=new UnsyncByteArrayOutputStream();
  OutputFormat format=OutputFormat.createPrettyPrint();
  format.setIndent("\t");
  format.setLineSeparator("\n");
  XMLWriter writer=new XMLWriter(unsyncByteArrayOutputStream,format);
  writer.write(doc);
  String xml=unsyncByteArrayOutputStream.toString();
  int pos=xml.indexOf("<?");
  String header=xml.substring(pos,xml.indexOf("?>",pos) + 2);
  xml=StringUtil.replace(xml,header,"");
  xml=header + "\n" + docType+ "\n"+ xml;
  return xml;
}
