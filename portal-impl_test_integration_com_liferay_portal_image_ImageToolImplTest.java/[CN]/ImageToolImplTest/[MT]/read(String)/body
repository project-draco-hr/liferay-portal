{
  File file=getFile(fileName);
  BufferedImage expectedImage=ImageIO.read(file);
  Assert.assertNotNull(expectedImage);
  DataBufferByte expectedDataBufferByte=(DataBufferByte)expectedImage.getData().getDataBuffer();
  byte[][] expectedData=expectedDataBufferByte.getBankData();
  String expectedType=FileUtil.getExtension(fileName);
  if (expectedType.equals("jpeg")) {
    expectedType=ImageTool.TYPE_JPEG;
  }
  RandomAccessFile randomAccessFile=new RandomAccessFile(file,"r");
  byte[] bytes=new byte[(int)randomAccessFile.length()];
  randomAccessFile.readFully(bytes);
  ImageBag imageBag=ImageToolUtil.read(bytes);
  RenderedImage resultImage=imageBag.getRenderedImage();
  Assert.assertNotNull(resultImage);
  DataBufferByte resultDataBufferByte=(DataBufferByte)resultImage.getData().getDataBuffer();
  byte[][] resultData=resultDataBufferByte.getBankData();
  String resultType=imageBag.getType();
  Assert.assertTrue(StringUtil.equalsIgnoreCase(expectedType,resultType));
  Assert.assertTrue(Arrays.deepEquals(expectedData,resultData));
}
