{
  File file=getFile(fileName);
  BufferedImage expectedImage=ImageIO.read(file);
  Assert.assertNotNull(expectedImage);
  Raster raster=expectedImage.getData();
  DataBuffer expectedDataBuffer=raster.getDataBuffer();
  String expectedType=FileUtil.getExtension(fileName);
  if (expectedType.equals("jpeg")) {
    expectedType=ImageTool.TYPE_JPEG;
  }
  RandomAccessFile randomAccessFile=new RandomAccessFile(file,"r");
  byte[] bytes=new byte[(int)randomAccessFile.length()];
  randomAccessFile.readFully(bytes);
  ImageBag imageBag=ImageToolUtil.read(bytes);
  RenderedImage resultImage=imageBag.getRenderedImage();
  Assert.assertNotNull(resultImage);
  raster=resultImage.getData();
  DataBuffer resultDataBuffer=raster.getDataBuffer();
  String resultType=imageBag.getType();
  Assert.assertTrue(StringUtil.equalsIgnoreCase(expectedType,resultType));
  if (expectedDataBuffer instanceof DataBufferByte) {
    DataBufferByte expectedDataBufferByte=(DataBufferByte)expectedDataBuffer;
    DataBufferByte resultDataBufferByte=(DataBufferByte)resultDataBuffer;
    Assert.assertTrue(Arrays.deepEquals(expectedDataBufferByte.getBankData(),resultDataBufferByte.getBankData()));
  }
 else   if (expectedDataBuffer instanceof DataBufferInt) {
    DataBufferInt expectedDataBufferInt=(DataBufferInt)expectedDataBuffer;
    DataBufferInt resultDataBufferInt=(DataBufferInt)resultDataBuffer;
    Assert.assertTrue(Arrays.deepEquals(expectedDataBufferInt.getBankData(),resultDataBufferInt.getBankData()));
  }
 else {
    Assert.fail();
  }
}
