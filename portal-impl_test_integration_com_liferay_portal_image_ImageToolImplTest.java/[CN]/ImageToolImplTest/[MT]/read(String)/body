{
  File file=getFile(fileName);
  BufferedImage expectedImage=ImageIO.read(file);
  Assert.assertNotNull(expectedImage);
  DataBuffer expectedDataBuffer=expectedImage.getData().getDataBuffer();
  String expectedType=FileUtil.getExtension(fileName);
  if (expectedType.equals("jpeg")) {
    expectedType=ImageTool.TYPE_JPEG;
  }
  RandomAccessFile randomAccessFile=new RandomAccessFile(file,"r");
  byte[] bytes=new byte[(int)randomAccessFile.length()];
  randomAccessFile.readFully(bytes);
  ImageBag imageBag=ImageToolUtil.read(bytes);
  RenderedImage resultImage=imageBag.getRenderedImage();
  Assert.assertNotNull(resultImage);
  DataBuffer resultDataBuffer=resultImage.getData().getDataBuffer();
  String resultType=imageBag.getType();
  Assert.assertTrue(StringUtil.equalsIgnoreCase(expectedType,resultType));
  if (expectedDataBuffer instanceof DataBufferByte) {
    Assert.assertTrue(Arrays.deepEquals(((DataBufferByte)expectedDataBuffer).getBankData(),((DataBufferByte)resultDataBuffer).getBankData()));
  }
 else   if (expectedDataBuffer instanceof DataBufferInt) {
    Assert.assertTrue(Arrays.deepEquals(((DataBufferInt)expectedDataBuffer).getBankData(),((DataBufferInt)resultDataBuffer).getBankData()));
  }
 else {
    Assert.fail();
  }
}
