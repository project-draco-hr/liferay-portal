{
  if (_textObj == null) {
    getTextObj();
  }
  if ((_type == null) && (_textObj != null)) {
    ByteArrayInputStream bais=null;
    MemoryCacheImageInputStream mcis=null;
    try {
      bais=new ByteArrayInputStream(_textObj);
      mcis=new MemoryCacheImageInputStream(bais);
      Iterator itr=ImageIO.getImageReaders(mcis);
      _type=null;
      while (itr.hasNext()) {
        ImageReader reader=(ImageReader)itr.next();
        if (reader instanceof GIFImageReader) {
          _type="gif";
        }
 else         if (reader instanceof JPEGImageReader) {
          _type="jpeg";
        }
 else         if (reader instanceof PNGImageReader) {
          _type="png";
        }
        reader.dispose();
      }
    }
  finally {
      if (bais != null) {
        try {
          bais.close();
        }
 catch (        IOException ioe) {
          if (_log.isWarnEnabled()) {
            _log.warn(ioe);
          }
        }
      }
      if (mcis != null) {
        try {
          mcis.close();
        }
 catch (        IOException ioe) {
          if (_log.isWarnEnabled()) {
            _log.warn(ioe);
          }
        }
      }
    }
  }
  return _type;
}
