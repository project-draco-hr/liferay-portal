{
  long layoutSetBranchId=MapUtil.getLong(portletDataContext.getParameterMap(),"layoutSetBranchId");
  LayoutSetBranch layoutSetBranch=_layoutSetBranchLocalService.fetchLayoutSetBranch(layoutSetBranchId);
  ThemeExporter themeExporter=ThemeExporter.getInstance();
  if (layoutSetBranch != null) {
    try {
      themeExporter.exportTheme(portletDataContext,layoutSetBranch);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to export theme reference for layout set " + "branch " + layoutSetBranch.getLayoutSetBranchId(),e);
      }
    }
  }
 else {
    try {
      themeExporter.exportTheme(portletDataContext,stagedLayoutSet);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to export theme reference for layout set " + stagedLayoutSet.getLayoutSetId(),e);
      }
    }
  }
}
