{
  String[] protectedAttributeNames=PropsValues.SESSION_PHISHING_PROTECTED_ATTRIBUTES;
  Map<String,Object> protectedAttributes=new HashMap<>();
  for (  String protectedAttributeName : protectedAttributeNames) {
    Object protectedAttributeValue=session.getAttribute(protectedAttributeName);
    if (protectedAttributeValue == null) {
      continue;
    }
    protectedAttributes.put(protectedAttributeName,protectedAttributeValue);
  }
  try {
    session.invalidate();
  }
 catch (  IllegalStateException ise) {
    if (_log.isWarnEnabled()) {
      _log.warn(ise.getMessage());
    }
  }
  session=request.getSession(true);
  for (  String protectedAttributeName : protectedAttributeNames) {
    Object protectedAttributeValue=protectedAttributes.get(protectedAttributeName);
    if (protectedAttributeValue == null) {
      continue;
    }
    session.setAttribute(protectedAttributeName,protectedAttributeValue);
  }
  return session;
}
