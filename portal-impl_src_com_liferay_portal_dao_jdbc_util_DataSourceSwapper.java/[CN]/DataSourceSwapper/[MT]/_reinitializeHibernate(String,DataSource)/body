{
  PortalHibernateConfiguration portalHibernateConfiguration=new PortalHibernateConfiguration();
  portalHibernateConfiguration.setDataSource(dataSource);
  portalHibernateConfiguration.afterPropertiesSet();
  SessionFactoryImplementor sessionFactoryImplementor=(SessionFactoryImplementor)portalHibernateConfiguration.getObject();
  SessionFactoryImpl sessionFactoryImpl=(SessionFactoryImpl)PortalBeanLocatorUtil.locate(name);
  sessionFactoryImpl.setSessionFactoryImplementor(sessionFactoryImplementor);
  AbstractPlatformTransactionManager abstractPlatformTransactionManager=(AbstractPlatformTransactionManager)PortalBeanLocatorUtil.locate("liferayTransactionManager");
  if (abstractPlatformTransactionManager instanceof HibernateTransactionManager) {
    HibernateTransactionManager hibernateTransactionManager=(HibernateTransactionManager)abstractPlatformTransactionManager;
    hibernateTransactionManager.setSessionFactory(sessionFactoryImplementor);
  }
 else   if (_log.isWarnEnabled()) {
    _log.warn("Non-HibernateTransactionManager is detected for " + "Hibernate Persistence infrastructure. Unable to swap to new " + "SessionFactoryImplementor. This may cause subsequence "+ "transaction failure.");
  }
}
