{
  if (_log.isInfoEnabled()) {
    _log.info("Create new counter data source");
  }
  DataSource newDataSource=DataSourceFactoryUtil.initDataSource(properties);
  DataSource oldDataSource=_counterDataSourceWrapper.getWrappedDataSource();
  if (_log.isInfoEnabled()) {
    _log.info("Set new counter data source");
  }
  _counterDataSourceWrapper.setWrappedDataSource(newDataSource);
  if (_log.isInfoEnabled()) {
    _log.info("Destroy old counter data source");
  }
  DataSourceFactoryUtil.destroyDataSource(oldDataSource);
  if (PropsValues.PERSISTENCE_PROVIDER.equalsIgnoreCase("jpa")) {
    if (_log.isInfoEnabled()) {
      _log.info("Reinitialize Hibernate for new counter data source");
    }
    _reinitializeJPA("counterSessionFactory",newDataSource);
  }
 else {
    if (_log.isInfoEnabled()) {
      _log.info("Reinitialize JPA for new counter data source");
    }
    _reinitializeHibernate("counterSessionFactory",newDataSource);
  }
}
