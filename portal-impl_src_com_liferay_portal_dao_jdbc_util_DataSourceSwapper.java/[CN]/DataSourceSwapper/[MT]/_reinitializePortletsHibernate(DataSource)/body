{
  List<PortletSessionFactoryImpl> portletSessionFactoryImpls=SessionFactoryImpl.getPortletSessionFactories();
  for (  PortletSessionFactoryImpl portletSessionFactoryImpl : portletSessionFactoryImpls) {
    ClassLoader classLoader=PortletClassLoaderUtil.getClassLoader();
    ClassLoader contextClassLoader=PACLClassLoaderUtil.getContextClassLoader();
    try {
      ClassLoader sessionFactoryClassLoader=portletSessionFactoryImpl.getSessionFactoryClassLoader();
      PortletClassLoaderUtil.setClassLoader(sessionFactoryClassLoader);
      PACLClassLoaderUtil.setContextClassLoader(sessionFactoryClassLoader);
      PortletHibernateConfiguration portletHibernateConfiguration=new PortletHibernateConfiguration();
      portletHibernateConfiguration.setDataSource(newDataSource);
      portletHibernateConfiguration.afterPropertiesSet();
      SessionFactoryImplementor sessionFactoryImplementor=(SessionFactoryImplementor)portletHibernateConfiguration.getObject();
      portletSessionFactoryImpl.setSessionFactoryImplementor(sessionFactoryImplementor);
    }
  finally {
      PortletClassLoaderUtil.setClassLoader(classLoader);
      PACLClassLoaderUtil.setContextClassLoader(contextClassLoader);
    }
  }
}
