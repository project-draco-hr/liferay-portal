{
  if (_log.isInfoEnabled()) {
    _log.info("Loading themes in " + _fileStorage);
  }
  File[] files=_fileStorage.listFiles();
  if (files == null) {
    if (_log.isWarnEnabled()) {
      _log.warn("There are no directories to process for  " + _fileStorage);
    }
    return;
  }
  for (int i=0; i < files.length; i++) {
    if (_log.isDebugEnabled()) {
      _log.debug("Process directory " + files[i]);
    }
    File liferayLookAndFeelXML=new File(files[i] + "/liferay-look-and-feel.xml");
    if (liferayLookAndFeelXML.exists()) {
      String lastModifiedKey=liferayLookAndFeelXML.toString();
      Long prevLastModified=_lastModifiedMap.get(lastModifiedKey);
      long lastModified=liferayLookAndFeelXML.lastModified();
      if ((prevLastModified == null) || (prevLastModified.longValue() < lastModified)) {
        registerTheme(liferayLookAndFeelXML);
        _lastModifiedMap.put(lastModifiedKey,lastModified);
      }
 else {
        if (_log.isDebugEnabled()) {
          _log.debug("Do not refresh " + liferayLookAndFeelXML + " because it is has not been modified");
        }
      }
    }
 else {
      if (_log.isWarnEnabled()) {
        _log.warn(liferayLookAndFeelXML + " does not exist");
      }
    }
  }
}
