{
  List<Role> oldRoles=roleLocalService.getUserRoles(userId);
  long[] oldRoleIds=new long[oldRoles.size()];
  for (int i=0; i < oldRoles.size(); i++) {
    Role role=oldRoles.get(i);
    if (!ArrayUtil.contains(roleIds,role.getRoleId()) && !RolePermissionUtil.contains(getPermissionChecker(),role.getRoleId(),ActionKeys.ASSIGN_MEMBERS)) {
      roleIds=ArrayUtil.append(roleIds,role.getRoleId());
    }
    oldRoleIds[i]=role.getRoleId();
  }
  for (  long roleId : roleIds) {
    if (!ArrayUtil.contains(oldRoleIds,roleId)) {
      RolePermissionUtil.check(getPermissionChecker(),roleId,ActionKeys.ASSIGN_MEMBERS);
    }
  }
  return roleIds;
}
