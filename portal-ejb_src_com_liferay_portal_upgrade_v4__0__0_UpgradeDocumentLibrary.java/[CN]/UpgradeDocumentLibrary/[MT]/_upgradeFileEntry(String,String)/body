{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=HibernateUtil.getConnection();
    ps=con.prepareStatement(_UPGRADE_FILE_ENTRY);
    ps.setString(1,repositoryId);
    rs=ps.executeQuery();
    while (rs.next()) {
      String companyId=rs.getString("companyId");
      String fileName=rs.getString("fileName");
      String userId=rs.getString("userId");
      if (_dlExists(companyId,repositoryId,fileName)) {
        byte[] byteArray=_dlGetFile(companyId,repositoryId,fileName);
        String subfolderId=_getSubfolderId(folderId,fileName);
        String name=_fixName(_getFileEntryName(fileName));
        String title=name;
        String description=name;
        boolean addCommunityPermissions=true;
        boolean addGuestPermissions=true;
        _log.debug("Migrating file profile " + new DLFileEntryPK(subfolderId,name));
        DLFileEntryLocalServiceUtil.addFileEntry(userId,subfolderId,name,title,description,StringPool.BLANK,byteArray,addCommunityPermissions,addGuestPermissions);
      }
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
