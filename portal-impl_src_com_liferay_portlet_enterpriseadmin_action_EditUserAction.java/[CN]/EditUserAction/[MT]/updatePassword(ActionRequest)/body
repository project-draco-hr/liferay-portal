{
  PortletSession ses=req.getPortletSession();
  String password1=ParamUtil.getString(req,"password1");
  String password2=ParamUtil.getString(req,"password2");
  boolean passwordReset=ParamUtil.getBoolean(req,"passwordReset");
  User user=PortalUtil.getSelectedUser(req);
  UserServiceUtil.updatePassword(user.getUserId(),password1,password2,passwordReset);
  if (user.getUserId() == PortalUtil.getUserId(req)) {
    ses.setAttribute(WebKeys.USER_PASSWORD,password1,PortletSession.APPLICATION_SCOPE);
  }
  return user;
}
