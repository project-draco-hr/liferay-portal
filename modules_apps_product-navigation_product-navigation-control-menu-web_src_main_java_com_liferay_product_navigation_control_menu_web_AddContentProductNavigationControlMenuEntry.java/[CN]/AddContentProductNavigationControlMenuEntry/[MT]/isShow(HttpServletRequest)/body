{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay.isStateMaximized()) {
    return false;
  }
  Layout layout=themeDisplay.getLayout();
  if (!layout.isTypePortlet()) {
    return false;
  }
  LayoutTypePortlet layoutTypePortlet=themeDisplay.getLayoutTypePortlet();
  LayoutTypeController layoutTypeController=layoutTypePortlet.getLayoutTypeController();
  if (layoutTypeController.isFullPageDisplayable()) {
    return false;
  }
  if (!hasAddContentOrApplicationPermission(themeDisplay)) {
    return false;
  }
  if (!(hasCustomizePermission(themeDisplay) || hasUpdateLayoutPermission(themeDisplay))) {
    return false;
  }
  return super.isShow(request);
}
