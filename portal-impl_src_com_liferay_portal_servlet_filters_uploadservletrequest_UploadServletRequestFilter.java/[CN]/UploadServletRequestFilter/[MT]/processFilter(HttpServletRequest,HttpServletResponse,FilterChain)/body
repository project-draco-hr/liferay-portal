{
  String portletId=ParamUtil.getString(request,"p_p_id");
  if (Validator.isNotNull(portletId)) {
    long companyId=PortalUtil.getCompanyId(request);
    Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletId);
    if (portlet != null) {
      ServletContext servletContext=(ServletContext)request.getAttribute(WebKeys.CTX);
      InvokerPortlet invokerPortlet=PortletInstanceFactoryUtil.create(portlet,servletContext);
      LiferayPortletConfig liferayPortletConfig=(LiferayPortletConfig)invokerPortlet.getPortletConfig();
      if (invokerPortlet.isStrutsPortlet() || liferayPortletConfig.isCopyRequestParameters() || !liferayPortletConfig.isWARFile()) {
        request.setAttribute(UploadServletRequestFilter.COPY_MULTIPART_STREAM_TO_FILE,Boolean.FALSE);
      }
    }
  }
  UploadServletRequest uploadServletRequest=PortalUtil.getUploadServletRequest(request);
  try {
    processFilter(UploadServletRequestFilter.class.getName(),uploadServletRequest,response,filterChain);
  }
  finally {
    uploadServletRequest.cleanUp();
  }
}
