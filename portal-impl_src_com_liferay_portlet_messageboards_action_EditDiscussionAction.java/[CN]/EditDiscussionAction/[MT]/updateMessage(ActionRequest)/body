{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long groupId=PortalUtil.getPortletGroupId(actionRequest);
  String className=ParamUtil.getString(actionRequest,"className");
  long classPK=ParamUtil.getLong(actionRequest,"classPK");
  long messageId=ParamUtil.getLong(actionRequest,"messageId");
  long threadId=ParamUtil.getLong(actionRequest,"threadId");
  long parentMessageId=ParamUtil.getLong(actionRequest,"parentMessageId");
  String subject=ParamUtil.getString(actionRequest,"subject");
  String body=ParamUtil.getString(actionRequest,"body");
  MBMessage message=null;
  if (messageId <= 0) {
    message=MBMessageServiceUtil.addDiscussionMessage(groupId,className,classPK,threadId,parentMessageId,subject,body,themeDisplay);
  }
 else {
    message=MBMessageServiceUtil.updateDiscussionMessage(groupId,className,classPK,messageId,subject,body);
  }
  return message;
}
