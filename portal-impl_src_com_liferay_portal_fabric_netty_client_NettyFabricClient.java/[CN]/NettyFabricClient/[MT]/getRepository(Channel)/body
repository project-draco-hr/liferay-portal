{
  Attribute<Repository<Channel>> attribute=channel.attr(_repositoryAttributeKey);
  Repository<Channel> repository=attribute.get();
  if (repository == null) {
    Path repositoryPath=_nettyFabricClientConfig.getRepositoryPath();
    Files.createDirectories(repositoryPath);
    AsyncBroker<Path,FileResponse> asyncBroker=new AsyncBroker<Path,FileResponse>();
    ChannelPipeline channelPipeline=channel.pipeline();
    channelPipeline.addLast(new FileResponseChannelHandler(asyncBroker,getEventExecutorGroup(_channel,_fileServerEventExecutorGroupAttributeKey)));
    repository=new NettyRepository(repositoryPath,asyncBroker,_nettyFabricClientConfig.getRepositoryGetFileTimeout());
    Repository<Channel> previousRepository=attribute.setIfAbsent(repository);
    if (previousRepository != null) {
      repository.dispose(true);
      repository=previousRepository;
    }
  }
  return repository;
}
