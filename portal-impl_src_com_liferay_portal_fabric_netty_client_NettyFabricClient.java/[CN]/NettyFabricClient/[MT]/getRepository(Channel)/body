{
  Attribute<Repository> attribute=channel.attr(_repositoryAttributeKey);
  Repository repository=attribute.get();
  if (repository == null) {
    Path repositoryPath=_nettyFabricClientConfig.getRepositoryPath();
    Files.createDirectories(repositoryPath);
    repository=new NettyRepository(repositoryPath,channel,getEventExecutorGroup(_channel,_fileServerEventExecutorGroupAttributeKey),_nettyFabricClientConfig.getRepositoryGetFileTimeout());
    Repository previousRepository=attribute.setIfAbsent(repository);
    if (previousRepository != null) {
      repository.dispose(true);
      repository=previousRepository;
    }
  }
  return repository;
}
