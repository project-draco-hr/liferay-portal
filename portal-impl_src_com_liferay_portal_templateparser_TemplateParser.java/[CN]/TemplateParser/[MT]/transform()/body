{
  UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
  boolean load=false;
  try {
    if (Validator.isNotNull(_xml)) {
      Document document=SAXReaderUtil.read(_xml);
      Element rootElement=document.getRootElement();
      List<TemplateNode> templateNodes=getTemplateNodes(_themeDisplay,rootElement);
      if (templateNodes != null) {
        for (        TemplateNode templateNode : templateNodes) {
          _template.put(templateNode.getName(),templateNode);
        }
      }
      Element requestElement=rootElement.element("request");
      _template.put("request",insertRequestVariables(requestElement));
      _template.put("xmlRequest",requestElement.asXML());
    }
    if (_contextObjects != null) {
      for (      String key : _contextObjects.keySet()) {
        _template.put(key,_contextObjects.get(key));
      }
    }
    populateTemplateContext(_template,_themeDisplay,_tokens,_languageId,_viewMode);
    load=mergeTemplate(_template,unsyncStringWriter);
  }
 catch (  Exception e) {
    if (e instanceof DocumentException) {
      throw new TransformException("Unable to read XML document",e);
    }
 else     if (e instanceof IOException) {
      throw new TransformException("Error reading template",e);
    }
 else     if (e instanceof TransformException) {
      throw (TransformException)e;
    }
 else {
      throw new TransformException("Unhandled exception",e);
    }
  }
  if (!load) {
    throw new TransformException("Unable to dynamically load transform script");
  }
  return unsyncStringWriter.toString();
}
