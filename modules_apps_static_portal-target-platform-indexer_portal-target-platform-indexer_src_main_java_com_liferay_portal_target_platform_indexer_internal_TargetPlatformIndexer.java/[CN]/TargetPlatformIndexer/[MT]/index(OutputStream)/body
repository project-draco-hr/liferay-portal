{
  Path tempPath=Files.createTempDirectory(null);
  File tempDir=tempPath.toFile();
  _config.put("root.url",tempDir.getPath());
  Set<File> jarFiles=new LinkedHashSet<>();
  try {
    _processSystemBundle(tempDir,jarFiles);
    for (    String dirName : _dirNames) {
      Path path=Paths.get(dirName);
      if (Files.notExists(path)) {
        continue;
      }
      try (DirectoryStream<Path> directoryStream=Files.newDirectoryStream(path,"*.jar")){
        Iterator<Path> iterator=directoryStream.iterator();
        while (iterator.hasNext()) {
          _addBundle(tempPath,iterator.next(),jarFiles);
        }
      }
     }
    for (    File additionalJarFile : _additionalJarFiles) {
      Path tempJarPath=tempPath.resolve(additionalJarFile.getName());
      Files.copy(additionalJarFile.toPath(),tempJarPath,StandardCopyOption.COPY_ATTRIBUTES,StandardCopyOption.REPLACE_EXISTING);
      jarFiles.add(tempJarPath.toFile());
    }
    ResourceIndexer resourceIndexer=new RepoIndex();
    resourceIndexer.index(jarFiles,outputStream,_config);
  }
  finally {
    PathUtil.deltree(tempPath);
  }
}
