{
  String url=_systemBundle.getSymbolicName() + "-" + _systemBundle.getVersion()+ ".jar";
  int index=content.indexOf(url);
  if (index == -1) {
    throw new IllegalStateException("Indexed content:\n" + content + "\nMissing system bundle URL: "+ url);
  }
  int start=content.lastIndexOf(_ATTRIBUTE_PREFIX_OSGI_CONTENT,index);
  if (start == -1) {
    throw new IllegalStateException("Indexed content:\n" + content.substring(0,index) + "\nMissing OSGI content attribute: "+ _ATTRIBUTE_PREFIX_OSGI_CONTENT);
  }
  start+=_ATTRIBUTE_PREFIX_OSGI_CONTENT.length();
  int end=content.lastIndexOf("\"/>",index);
  String prefix=content.substring(0,start);
  String postfix=content.substring(end);
  String newContent=prefix.concat(sha256sum).concat(postfix);
  index=newContent.indexOf(url);
  index+=url.length() + 3;
  start=newContent.indexOf(_ATTRIBUTE_PREFIX_SIZE,index);
  if (start == -1) {
    throw new IllegalStateException("Indexed content:\n" + content + "\nMissing size attribute: "+ _ATTRIBUTE_PREFIX_SIZE);
  }
  start+=_ATTRIBUTE_PREFIX_SIZE.length();
  end=newContent.indexOf("\"/>",index);
  prefix=newContent.substring(0,start);
  postfix=newContent.substring(end);
  newContent=prefix.concat(String.valueOf(size)).concat(postfix);
  newContent=newContent.replace("\r\n","\n");
  return newContent.getBytes("UTF-8");
}
