{
  DataSourceFactoryBean dataSourceFactoryBean=new DataSourceFactoryBean();
  dataSourceFactoryBean.setPropertyPrefix("jdbc." + shardName + ".");
  DataSource dataSource=dataSourceFactoryBean.createInstance();
  Connection targetConnection=dataSource.getConnection();
  Connection sourceConnection=DataAccess.getUpgradeOptimizedConnection();
  try {
    updateUpgradeTable(sourceConnection,targetConnection,ClassNameTable.TABLE_NAME,ClassNameTable.TABLE_COLUMNS,ClassNameTable.TABLE_SQL_CREATE);
    updateUpgradeTable(sourceConnection,targetConnection,ClusterGroupTable.TABLE_NAME,ClusterGroupTable.TABLE_COLUMNS,ClusterGroupTable.TABLE_SQL_CREATE);
    updateUpgradeTable(sourceConnection,targetConnection,CounterTable.TABLE_NAME,CounterTable.TABLE_COLUMNS,CounterTable.TABLE_SQL_CREATE);
    updateUpgradeTable(sourceConnection,targetConnection,CountryTable.TABLE_NAME,CountryTable.TABLE_COLUMNS,CountryTable.TABLE_SQL_CREATE);
    updateUpgradeTable(sourceConnection,targetConnection,PortalPreferencesTable.TABLE_NAME,PortalPreferencesTable.TABLE_COLUMNS,PortalPreferencesTable.TABLE_SQL_CREATE);
    updateUpgradeTable(sourceConnection,targetConnection,RegionTable.TABLE_NAME,RegionTable.TABLE_COLUMNS,RegionTable.TABLE_SQL_CREATE);
    updateUpgradeTable(sourceConnection,targetConnection,ReleaseTable.TABLE_NAME,ReleaseTable.TABLE_COLUMNS,ReleaseTable.TABLE_SQL_CREATE);
    updateUpgradeTable(sourceConnection,targetConnection,ResourceActionTable.TABLE_NAME,ResourceActionTable.TABLE_COLUMNS,ResourceActionTable.TABLE_SQL_CREATE);
    updateUpgradeTable(sourceConnection,targetConnection,VirtualHostTable.TABLE_NAME,VirtualHostTable.TABLE_COLUMNS,VirtualHostTable.TABLE_SQL_CREATE);
  }
 catch (  Exception e) {
    _log.error("Unexpected errors while moving the control tables",e);
  }
 finally {
    DataAccess.cleanUp(sourceConnection);
    DataAccess.cleanUp(targetConnection);
  }
}
