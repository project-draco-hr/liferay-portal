{
  String lastModifiedCacheKey=null;
  if (cache) {
    lastModifiedCacheKey=ServletContextUtil.class.getName();
    lastModifiedCacheKey=lastModifiedCacheKey.concat(StringPool.PERIOD).concat(path);
    Long lastModified=(Long)servletContext.getAttribute(lastModifiedCacheKey);
    if (lastModified != null) {
      return lastModified.longValue();
    }
  }
  String curPath=null;
  long lastModified=0;
  Queue<String> pathQueue=new LinkedList<String>();
  pathQueue.offer(path);
  while ((curPath=pathQueue.poll()) != null) {
    if (curPath.charAt(curPath.length() - 1) == CharPool.SLASH) {
      Set<String> pathSet=servletContext.getResourcePaths(curPath);
      if (pathSet != null) {
        pathQueue.addAll(pathSet);
      }
    }
 else {
      try {
        URL url=servletContext.getResource(curPath);
        if (url == null) {
          _log.error("Resource URL for " + curPath + " is null");
        }
 else {
          URLConnection urlConnection=url.openConnection();
          if (urlConnection.getLastModified() > lastModified) {
            lastModified=urlConnection.getLastModified();
          }
        }
      }
 catch (      IOException ioe) {
        _log.error(ioe,ioe);
      }
    }
  }
  if (cache) {
    servletContext.setAttribute(lastModifiedCacheKey,new Long(lastModified));
  }
  return lastModified;
}
