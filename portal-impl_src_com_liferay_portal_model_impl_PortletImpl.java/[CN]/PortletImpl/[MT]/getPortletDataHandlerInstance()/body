{
  PortletBag portletBag=PortletBagPool.get(getRootPortletId());
  if (portletBag == null) {
    _log.error("No portlet bag for " + toString());
    throw new IllegalStateException("No portlet bag for " + toString());
  }
  List<PortletDataHandler> portletDataHandlerInstances=portletBag.getPortletDataHandlerInstances();
  if (portletDataHandlerInstances.isEmpty()) {
    PortletDataHandler portletDataHandlerInstance=new DefaultConfigurationPortletDataHandler();
    portletDataHandlerInstances.add(portletDataHandlerInstance);
    setPortletDataHandlerClass(DefaultConfigurationPortletDataHandler.class.getName());
  }
  return portletDataHandlerInstances.get(0);
}
