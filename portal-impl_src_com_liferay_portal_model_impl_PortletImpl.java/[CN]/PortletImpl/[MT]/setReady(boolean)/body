{
  _readyMap.put(getRootPortletId(),ready);
  Registry registry=RegistryUtil.getRegistry();
synchronized (_serviceRegistrarMap) {
    if (ready) {
      ServiceRegistrar<Portlet> portletServiceRegistrar=registry.getServiceRegistrar(Portlet.class);
      Map<String,Object> properties=new HashMap<>();
      properties.put("javax.portlet.name",getPortletName());
      portletServiceRegistrar.registerService(Portlet.class,this,properties);
      _serviceRegistrarMap.put(getRootPortletId(),portletServiceRegistrar);
    }
 else {
      ServiceRegistrar<Portlet> portletServiceRegistrar=_serviceRegistrarMap.remove(getRootPortletId());
      portletServiceRegistrar.destroy();
    }
  }
}
