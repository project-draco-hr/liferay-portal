{
  Boolean currentStatus=_readyMap.putIfAbsent(getRootPortletId(),ready);
  if (ready && (currentStatus != null) && currentStatus.equals(Boolean.TRUE)) {
    return;
  }
  if (!ready && (currentStatus != null) && currentStatus.equals(Boolean.FALSE)) {
    return;
  }
  Registry registry=RegistryUtil.getRegistry();
synchronized (this) {
    if (ready) {
      ServiceRegistrar<Portlet> serviceRegistrar=registry.getServiceRegistrar(Portlet.class);
      Map<String,Object> properties=new HashMap<>();
      properties.put("javax.portlet.name",getPortletName());
      serviceRegistrar.registerService(Portlet.class,this,properties);
      _serviceRegistrars.put(getRootPortletId(),serviceRegistrar);
    }
 else {
      ServiceRegistrar<Portlet> serviceRegistrar=_serviceRegistrars.remove(getRootPortletId());
      serviceRegistrar.destroy();
    }
  }
}
