{
  _readyMap.put(getRootPortletId(),ready);
  Registry registry=RegistryUtil.getRegistry();
  if (ready) {
    ServiceRegistrar<Portlet> serviceRegistrar=registry.getServiceRegistrar(Portlet.class);
    ServiceRegistrar<Portlet> previousServiceRegistrar=_serviceRegistrars.putIfAbsent(getRootPortletId(),serviceRegistrar);
    if (previousServiceRegistrar != null) {
      serviceRegistrar=previousServiceRegistrar;
    }
    Map<String,Object> properties=new HashMap<>();
    properties.put("javax.portlet.name",getPortletName());
    serviceRegistrar.registerService(Portlet.class,this,properties);
  }
 else {
    ServiceRegistrar<Portlet> serviceRegistrar=_serviceRegistrars.remove(getRootPortletId());
    if (serviceRegistrar != null) {
      serviceRegistrar.destroy();
    }
  }
}
