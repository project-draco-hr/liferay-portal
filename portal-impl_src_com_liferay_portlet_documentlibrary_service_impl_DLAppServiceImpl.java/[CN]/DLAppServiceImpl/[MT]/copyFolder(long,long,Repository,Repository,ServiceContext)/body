{
  Folder newFolder=null;
  try {
    Folder folder=fromRepository.getFolder(folderId);
    newFolder=toRepository.addFolder(getUserId(),parentFolderId,folder.getName(),folder.getDescription(),serviceContext);
    dlAppHelperLocalService.addFolder(getUserId(),newFolder,serviceContext);
    copyFolderDependencies(folder,newFolder,fromRepository,toRepository,serviceContext);
    return newFolder;
  }
 catch (  PortalException pe) {
    if (newFolder != null) {
      toRepository.deleteFolder(newFolder.getFolderId());
    }
    throw pe;
  }
}
