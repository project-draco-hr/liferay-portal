{
  List<FileVersion> fileVersions=fileEntry.getFileVersions(WorkflowConstants.STATUS_ANY);
  FileVersion latestFileVersion=fileVersions.get(fileVersions.size() - 1);
  FileEntry destinationFileEntry=toRepository.addFileEntry(newFolderId,fileEntry.getTitle(),latestFileVersion.getMimeType(),latestFileVersion.getTitle(),latestFileVersion.getDescription(),StringPool.BLANK,latestFileVersion.getContentStream(false),latestFileVersion.getSize(),serviceContext);
  for (int i=fileVersions.size() - 2; i >= 0; i--) {
    FileVersion fileVersion=fileVersions.get(i);
    FileVersion previousFileVersion=fileVersions.get(i + 1);
    try {
      destinationFileEntry=toRepository.updateFileEntry(destinationFileEntry.getFileEntryId(),fileEntry.getTitle(),destinationFileEntry.getMimeType(),destinationFileEntry.getTitle(),destinationFileEntry.getDescription(),StringPool.BLANK,isMajorVersion(previousFileVersion,fileVersion),fileVersion.getContentStream(false),fileVersion.getSize(),serviceContext);
    }
 catch (    PortalException pe) {
      toRepository.deleteFileEntry(destinationFileEntry.getFileEntryId());
      throw pe;
    }
  }
  dlAppHelperLocalService.addFileEntry(getUserId(),destinationFileEntry,destinationFileEntry.getFileVersion(),serviceContext);
  return destinationFileEntry;
}
