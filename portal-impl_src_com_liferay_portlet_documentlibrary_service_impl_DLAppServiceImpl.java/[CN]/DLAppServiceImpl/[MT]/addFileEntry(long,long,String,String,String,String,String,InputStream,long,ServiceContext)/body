{
  if (is == null) {
    is=new UnsyncByteArrayInputStream(new byte[0]);
    size=0;
  }
  if (Validator.isNull(mimeType) || mimeType.equals(ContentTypes.APPLICATION_OCTET_STREAM)) {
    String extension=DLAppUtil.getExtension(title,sourceFileName);
    if (size == 0) {
      mimeType=MimeTypesUtil.getExtensionContentType(extension);
    }
 else {
      File file=null;
      try {
        file=FileUtil.createTempFile(is);
        return addFileEntry(repositoryId,folderId,sourceFileName,mimeType,title,description,changeLog,file,serviceContext);
      }
 catch (      IOException ioe) {
        throw new SystemException("Unable to write temporary file",ioe);
      }
 finally {
        FileUtil.delete(file);
      }
    }
  }
  Repository repository=getRepository(repositoryId);
  FileEntry fileEntry=repository.addFileEntry(getUserId(),folderId,sourceFileName,mimeType,title,description,changeLog,is,size,serviceContext);
  return fileEntry;
}
