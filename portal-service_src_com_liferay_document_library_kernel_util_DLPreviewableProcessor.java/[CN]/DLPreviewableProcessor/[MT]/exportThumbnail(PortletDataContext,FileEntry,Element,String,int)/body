{
  if (!isThumbnailEnabled(index)) {
    return;
  }
  FileVersion fileVersion=fileEntry.getFileVersion();
  if (!hasThumbnail(fileVersion,index)) {
    if (_log.isWarnEnabled()) {
      _log.warn("No thumbnail found for file entry " + fileEntry.getFileEntryId());
    }
    return;
  }
  InputStream is=null;
  try {
    is=doGetThumbnailAsStream(fileVersion,index);
    String binPath=getBinPath(portletDataContext,fileEntry,index);
    fileEntryElement.addAttribute(binPathName,binPath);
    exportBinary(portletDataContext,fileEntryElement,fileVersion,is,binPath,binPathName);
  }
  finally {
    StreamUtil.cleanUp(is);
  }
}
