{
  DocumentBuilderFactory documentBuilderFactory=DocumentBuilderFactory.newInstance();
  if (!PropsValues.XML_SECURITY_ENABLED) {
    return documentBuilderFactory;
  }
  try {
    documentBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING,true);
  }
 catch (  Exception e) {
    _log.error("Unable to initialize safe DocumentBuilderFactory! Your " + "system may be vulnerable to XML Bomb attacks!",e);
  }
  try {
    documentBuilderFactory.setFeature(_FEATURES_DISALLOW_DOCTYPE_DECL,true);
  }
 catch (  Exception e) {
    _log.error("Unable to initialize safe DocumentBuilderFactory! Your " + "system may be vulnerable to XML Bomb attacks!",e);
  }
  try {
    documentBuilderFactory.setFeature(_FEATURES_EXTERNAL_GENERAL_ENTITIES,false);
    documentBuilderFactory.setFeature(_FEATURES_EXTERNAL_PARAMETER_ENTITIES,false);
  }
 catch (  Exception e) {
    _log.error("Unable to initialize safe DocumentBuilderFactory! Your " + "system may be vulnerable to XXE attacks!",e);
  }
  return documentBuilderFactory;
}
