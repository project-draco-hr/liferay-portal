{
  MBDiscussion discussion=_mbDiscussionLocalService.getThreadDiscussion(message.getThreadId());
  long classNameId=_classNameLocalService.getClassNameId(className);
  long classPK=discussion.getClassPK();
  if (discussion.getClassNameId() != classNameId) {
    return;
  }
  List<SocialActivity> socialActivities=_socialActivityLocalService.getActivities(0,className,classPK,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  for (  SocialActivity socialActivity : socialActivities) {
    if (Validator.isNull(socialActivity.getExtraData())) {
      continue;
    }
    JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject(socialActivity.getExtraData());
    long extraDataMessageId=extraDataJSONObject.getLong("messageId");
    if (message.getMessageId() == extraDataMessageId) {
      _socialActivityLocalService.deleteActivity(socialActivity.getActivityId());
    }
  }
}
