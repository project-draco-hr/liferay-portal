{
  if (!PACLPolicyManager.isActive() || !PortalSecurityManagerThreadLocal.isEnabled()) {
    try {
      return proceed(methodInvocation);
    }
 catch (    Throwable throwable) {
      throw throwable;
    }
  }
  Object thisObject=methodInvocation.getThis();
  Method method=methodInvocation.getMethod();
  Object[] arguments=methodInvocation.getArguments();
  boolean debug=false;
  if (_log.isDebugEnabled()) {
    Class<?> clazz=thisObject.getClass();
    String className=clazz.getName();
    if (className.equals(PortalServiceImpl.class.getName()) || className.equals(_ENTRY_LOCAL_SERVICE_IMPL_CLASS_NAME) || className.equals(_STATUS_LOCAL_SERVICE_IMPL_CLASS_NAME)) {
      debug=true;
      _log.debug("Intercepting " + className + "#"+ method.getName());
    }
  }
  if (method.getDeclaringClass() == Object.class) {
    String methodName=method.getName();
    if (methodName.equals("equals")) {
      if (thisObject == arguments[0]) {
        return true;
      }
 else {
        return false;
      }
    }
 else     if (methodName.equals("toString")) {
      return proceed(methodInvocation);
    }
  }
  PACLPolicy paclPolicy=PACLClassUtil.getPACLPolicy(false,debug);
  if (debug) {
    if (paclPolicy != null) {
      _log.debug("Retrieved PACL policy for " + paclPolicy.getServletContextName());
    }
  }
  if (paclPolicy == null) {
    return proceed(methodInvocation);
  }
  if (!paclPolicy.hasPortalService(thisObject,method,arguments)) {
    throw new SecurityException("Attempted to invoke " + method);
  }
  boolean checkSQL=PortalSecurityManagerThreadLocal.isCheckSQL();
  try {
    Class<?> clazz=thisObject.getClass();
    if (paclPolicy.getClassLoader() != PACLClassLoaderUtil.getClassLoader(clazz)) {
      PortalSecurityManagerThreadLocal.setCheckSQL(false);
    }
    return proceed(methodInvocation);
  }
  finally {
    PortalSecurityManagerThreadLocal.setCheckSQL(checkSQL);
  }
}
