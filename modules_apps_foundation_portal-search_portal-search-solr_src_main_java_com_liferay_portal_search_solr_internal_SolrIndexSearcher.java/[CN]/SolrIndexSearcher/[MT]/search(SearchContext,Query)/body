{
  StopWatch stopWatch=new StopWatch();
  stopWatch.start();
  try {
    int total=(int)searchCount(searchContext,query);
    int start=searchContext.getStart();
    int end=searchContext.getEnd();
    if ((start == QueryUtil.ALL_POS) && (end == QueryUtil.ALL_POS)) {
      start=0;
      end=total;
    }
    int[] startAndEnd=SearchPaginationUtil.calculateStartAndEnd(start,end,total);
    start=startAndEnd[0];
    end=startAndEnd[1];
    Hits hits=doSearchHits(searchContext,query,start,end);
    hits.setStart(stopWatch.getStartTime());
    return hits;
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(e,e);
    }
    if (!_logExceptionsOnly) {
      throw new SearchException(e.getMessage(),e);
    }
    return new HitsImpl();
  }
 finally {
    if (_log.isInfoEnabled()) {
      stopWatch.stop();
      _log.info("Searching " + query.toString() + " took "+ stopWatch.getTime()+ " ms");
    }
  }
}
