{
  HttpSession ses=req.getSession();
  if (ses.getAttribute("j_username") != null && ses.getAttribute("j_password") != null) {
    return mapping.findForward("/portal/touch_protected.jsp");
  }
  String cmd=ParamUtil.getString(req,Constants.CMD);
  if (cmd.equals("already-registered")) {
    try {
      _login(req,res);
      return mapping.findForward("/portal/touch_protected.jsp");
    }
 catch (    Exception e) {
      if (e != null && e instanceof AuthException || e instanceof CookieNotSupportedException || e instanceof NoSuchUserException || e instanceof UserEmailAddressException || e instanceof UserIdException || e instanceof UserPasswordException) {
        SessionErrors.add(req,e.getClass().getName());
        return mapping.findForward("portal.login");
      }
 else {
        req.setAttribute(PageContext.EXCEPTION,e);
        return mapping.findForward(Constants.COMMON_ERROR);
      }
    }
  }
 else   if (cmd.equals("forgot-password")) {
    try {
      _sendPassword(req);
      return mapping.findForward("portal.login");
    }
 catch (    Exception e) {
      if (e != null && e instanceof NoSuchUserException || e instanceof SendPasswordException || e instanceof UserEmailAddressException) {
        SessionErrors.add(req,e.getClass().getName());
        return mapping.findForward("portal.login");
      }
 else {
        req.setAttribute(PageContext.EXCEPTION,e);
        return mapping.findForward(Constants.COMMON_ERROR);
      }
    }
  }
 else {
    return mapping.findForward("portal.login");
  }
}
