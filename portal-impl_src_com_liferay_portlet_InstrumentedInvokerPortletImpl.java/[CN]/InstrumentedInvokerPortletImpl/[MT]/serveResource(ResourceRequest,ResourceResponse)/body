{
  final boolean activateMonitoring=isMonitorResourceActive();
  PortletRequestDataSample portletRequestSample=null;
  if (activateMonitoring) {
    portletRequestSample=new PortletRequestDataSample(PortletRequestType.EVENT,(LiferayPortletRequest)resourceRequest,(LiferayPortletResponse)resourceResponse);
    portletRequestSample.prepare();
  }
  try {
    _delegate.serveResource(resourceRequest,resourceResponse);
    if (activateMonitoring) {
      portletRequestSample.capture(RequestStatus.SUCCESS);
    }
  }
 catch (  Exception e) {
    _processException(activateMonitoring,portletRequestSample,e);
  }
 finally {
    if (portletRequestSample != null) {
      Message message=new Message();
      message.setPayload(portletRequestSample);
      _messageSender.send(message);
      ThreadLocalDataSampleCache.add(portletRequestSample);
    }
  }
}
