{
  User user=userPersistence.findByPrimaryKey(userId);
  long fileEntryTypeId=counterLocalService.increment();
  long dynamicStructureId=updateDynamicStructure(userId,fileEntryTypeId,groupId,name,description,serviceContext);
  if (dynamicStructureId > 0) {
    ddmStructureIds=ArrayUtil.append(ddmStructureIds,dynamicStructureId);
  }
  Date now=new Date();
  validate(fileEntryTypeId,groupId,name,ddmStructureIds);
  DLFileEntryType dlFileEntryType=dlFileEntryTypePersistence.create(fileEntryTypeId);
  dlFileEntryType.setUuid(serviceContext.getUuid());
  dlFileEntryType.setGroupId(groupId);
  dlFileEntryType.setCompanyId(user.getCompanyId());
  dlFileEntryType.setUserId(user.getUserId());
  dlFileEntryType.setUserName(user.getFullName());
  dlFileEntryType.setCreateDate(serviceContext.getCreateDate(now));
  dlFileEntryType.setModifiedDate(serviceContext.getModifiedDate(now));
  dlFileEntryType.setName(name);
  dlFileEntryType.setDescription(description);
  dlFileEntryTypePersistence.update(dlFileEntryType,false);
  dlFileEntryTypePersistence.addDDMStructures(fileEntryTypeId,ddmStructureIds);
  if (serviceContext.isAddGroupPermissions() || serviceContext.isAddGuestPermissions()) {
    addFileEntryTypeResources(dlFileEntryType,serviceContext.isAddGroupPermissions(),serviceContext.isAddGuestPermissions());
  }
 else {
    addFileEntryTypeResources(dlFileEntryType,serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions());
  }
  return dlFileEntryType;
}
