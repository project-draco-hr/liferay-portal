{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  verify(ddmStructureIds);
  long fileEntryTypeId=counterLocalService.increment();
  DLFileEntryType fileEntryType=dlFileEntryTypePersistence.create(fileEntryTypeId);
  fileEntryType.setGroupId(groupId);
  fileEntryType.setCompanyId(user.getCompanyId());
  fileEntryType.setUserId(user.getUserId());
  fileEntryType.setUserName(user.getFullName());
  fileEntryType.setCreateDate(serviceContext.getCreateDate(now));
  fileEntryType.setModifiedDate(serviceContext.getModifiedDate(now));
  fileEntryType.setName(name);
  fileEntryType.setDescription(description);
  dlFileEntryTypePersistence.update(fileEntryType,false);
  dlFileEntryTypePersistence.addDDMStructures(fileEntryTypeId,ddmStructureIds);
  if (serviceContext.getAddGroupPermissions() || serviceContext.getAddGuestPermissions()) {
    addFileEntryTypeResources(fileEntryType,serviceContext.getAddGroupPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addFileEntryTypeResources(fileEntryType,serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions());
  }
  return fileEntryType;
}
