{
  PortletContext portletContext=getPortletContext();
  String servletContextName=portletContext.getPortletContextName();
  String resourcePath=servletContextName.concat(TemplateConstants.SERVLET_SEPARATOR).concat(path);
  boolean resourceExists=false;
  try {
    resourceExists=TemplateResourceLoaderUtil.hasTemplateResource(TemplateConstants.LANG_TYPE_FTL,resourcePath);
  }
 catch (  TemplateException te) {
    throw new IOException(te);
  }
  if (!resourceExists) {
    _log.error(path + " is not a valid include");
  }
 else {
    try {
      TemplateResource templateResource=TemplateResourceLoaderUtil.getTemplateResource(TemplateConstants.LANG_TYPE_FTL,resourcePath);
      TemplateManager templateManager=TemplateManagerUtil.getTemplateManager(TemplateConstants.LANG_TYPE_FTL);
      Template template=TemplateManagerUtil.getTemplate(TemplateConstants.LANG_TYPE_FTL,templateResource,false);
      templateManager.addTaglibApplication(template,"Application",getServletContext());
      templateManager.addTaglibFactory(template,"PortletJspTagLibs",getServletContext());
      templateManager.addTaglibRequest(template,"Request",PortalUtil.getHttpServletRequest(portletRequest),PortalUtil.getHttpServletResponse(portletResponse));
      template.put("portletContext",getPortletContext());
      template.put("userInfo",portletRequest.getAttribute(PortletRequest.USER_INFO));
      Writer writer=null;
      if (portletResponse instanceof MimeResponse) {
        MimeResponse mimeResponse=(MimeResponse)portletResponse;
        writer=UnsyncPrintWriterPool.borrow(mimeResponse.getWriter());
      }
 else {
        writer=new UnsyncStringWriter();
      }
      template.processTemplate(writer);
    }
 catch (    Exception e) {
      throw new PortletException(e);
    }
  }
  if (clearRequestParameters) {
    if (lifecycle.equals(PortletRequest.RENDER_PHASE)) {
      portletResponse.setProperty("clear-request-parameters","true");
    }
  }
}
