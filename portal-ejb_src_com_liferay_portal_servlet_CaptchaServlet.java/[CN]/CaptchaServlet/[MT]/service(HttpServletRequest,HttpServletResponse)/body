{
  if (!PortalInstances.matches()) {
    return;
  }
  HttpSession ses=req.getSession();
  ImageCaptcha captcha=(ImageCaptcha)ses.getAttribute(WebKeys.CAPTCHA);
  if (captcha == null) {
    captcha=_engine.getImageCaptchaFactory().getImageCaptcha();
    ses.setAttribute(WebKeys.CAPTCHA,captcha);
  }
  ServletOutputStream out=res.getOutputStream();
  ImageIO.write(captcha.getImageChallenge(),"jpeg",res.getOutputStream());
  out.flush();
}
