{
  List<Long> categoryIds=null;
  Session session=null;
  try {
    session=openSession();
    SQLQuery q=session.createSQLQuery("SELECT categoryId FROM AssetCategory WHERE groupId = ? AND parentCategoryId = ? ORDER BY categoryId ASC");
    q.addScalar("categoryId",Type.LONG);
    QueryPos qPos=QueryPos.getInstance(q);
    qPos.add(groupId);
    qPos.add(parentCategoryId);
    categoryIds=q.list();
  }
 catch (  Exception e) {
    throw processException(e);
  }
 finally {
    closeSession(session);
  }
  long rightCategoryId=leftCategoryId + 1;
  for (  long categoryId : categoryIds) {
    rightCategoryId=rebuildTree(groupId,categoryId,rightCategoryId);
  }
  if (parentCategoryId > 0) {
    updateTree.update(parentCategoryId,leftCategoryId,rightCategoryId);
  }
  return rightCategoryId + 1;
}
