{
  MBMailingList mailingList=MBMailingListLocalServiceUtil.getCategoryMailingList(groupId,categoryId);
  if (!mailingList.isActive()) {
    return;
  }
  subject=getMailingListSubject(subject,mailId);
  String fromAddress=mailingList.getOutEmailAddress();
  InternetAddress[] bulkAddresses=new InternetAddress[]{new InternetAddress(mailingList.getEmailAddress())};
  SMTPAccount account=null;
  if (mailingList.isOutCustom()) {
    String protocol=Account.PROTOCOL_SMTP;
    if (mailingList.isOutUseSSL()) {
      protocol=Account.PROTOCOL_SMTPS;
    }
    account=(SMTPAccount)Account.getInstance(protocol,mailingList.getOutServerPort());
    account.setHost(mailingList.getOutServerName());
    account.setUser(mailingList.getOutUserName());
    account.setPassword(mailingList.getOutPassword());
  }
  sendMail(fromAddress,null,bulkAddresses,subject,body,replyToAddress,mailId,inReplyTo,htmlFormat,account);
}
