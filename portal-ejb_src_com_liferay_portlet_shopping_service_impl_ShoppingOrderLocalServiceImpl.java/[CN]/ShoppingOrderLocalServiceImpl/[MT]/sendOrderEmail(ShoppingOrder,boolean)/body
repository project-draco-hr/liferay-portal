{
  ShoppingConfig shoppingConfig=AdminConfigServiceUtil.getShoppingConfig(order.getCompanyId());
  EmailConfig orderEmail=shoppingConfig.getOrderEmail();
  if (override || (order.isSendOrderEmail() && orderEmail.isSend())) {
    List orderItems=ShoppingOrderItemServiceUtil.getOrderItems(order.getOrderId());
    Set supplierUserIds=ShoppingUtil.getSupplierUserIds(orderItems);
    Iterator itr=supplierUserIds.iterator();
    while (itr.hasNext()) {
      String supplierUserId=(String)itr.next();
      _sendEmail(order,orderItems,supplierUserId,shoppingConfig,orderEmail);
    }
    _sendEmail(order,orderItems,null,shoppingConfig,orderEmail);
    order.setModifiedDate(new Date());
    order.setSendOrderEmail(false);
    ShoppingOrderUtil.update(order);
  }
}
