{
  ClusterExecutorImpl clusterExecutorImpl1=getClusterExecutorImpl();
  MockClusterEventListener mockClusterEventListener=new MockClusterEventListener();
  clusterExecutorImpl1.addClusterEventListener(mockClusterEventListener);
  ClusterExecutorImpl clusterExecutorImpl2=getClusterExecutorImpl();
  try {
    ClusterNode clusterNode2=clusterExecutorImpl2.getLocalClusterNode();
    ClusterEvent clusterEvent=mockClusterEventListener.waitJoinMessage();
    assertClusterEvent(clusterEvent,ClusterEventType.JOIN,clusterNode2);
    updateView(clusterExecutorImpl1);
    updateView(clusterExecutorImpl2);
    clusterEvent=mockClusterEventListener.waitDepartMessage();
    assertClusterEvent(clusterEvent,ClusterEventType.DEPART,clusterNode2);
    updateView(clusterExecutorImpl1,clusterExecutorImpl2);
    clusterEvent=mockClusterEventListener.waitJoinMessage();
    assertClusterEvent(clusterEvent,ClusterEventType.JOIN,clusterNode2);
  }
  finally {
    clusterExecutorImpl1.destroy();
    clusterExecutorImpl2.destroy();
  }
}
