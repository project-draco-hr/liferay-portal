{
  ClusterExecutorImpl clusterExecutorImpl1=getClusterExecutorImpl();
  MockClusterEventListener mockClusterEventListener=new MockClusterEventListener();
  clusterExecutorImpl1.addClusterEventListener(mockClusterEventListener);
  ClusterExecutorImpl clusterExecutorImpl2=getClusterExecutorImpl();
  assertClusterEvent(mockClusterEventListener.waitJoinMessage(),ClusterEventType.JOIN,clusterExecutorImpl2.getLocalClusterNode());
  String timestamp=null;
  try {
    timestamp=String.valueOf(System.currentTimeMillis());
    MethodHandler methodHandler=new MethodHandler(testMethod1MethodKey,timestamp);
    ClusterRequest clusterRequest=ClusterRequest.createMulticastRequest(methodHandler);
    clusterRequest.setFireAndForget(false);
    FutureClusterResponses futureClusterResponses=clusterExecutorImpl1.execute(clusterRequest);
    List<String> clusterNodeIds=new ArrayList<>();
    for (    ClusterNode clusterNode : clusterExecutorImpl1.getClusterNodes()) {
      clusterNodeIds.add(clusterNode.getClusterNodeId());
    }
    assertFutureClusterResponsesWithoutException(futureClusterResponses.get(),clusterRequest.getUuid(),timestamp,clusterNodeIds);
    timestamp=String.valueOf(System.currentTimeMillis());
    methodHandler=new MethodHandler(testMethod1MethodKey,timestamp);
    clusterRequest=ClusterRequest.createMulticastRequest(methodHandler);
    clusterRequest.setFireAndForget(true);
    futureClusterResponses=clusterExecutorImpl1.execute(clusterRequest);
    futureClusterResponses.get(1000,TimeUnit.MILLISECONDS);
    Assert.fail();
  }
 catch (  TimeoutException te) {
    Assert.assertEquals(TestBean.TIMESTAMP,timestamp);
  }
 finally {
    clusterExecutorImpl1.destroy();
    clusterExecutorImpl2.destroy();
  }
}
