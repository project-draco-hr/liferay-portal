{
  ClusterExecutorImpl clusterExecutorImpl1=null;
  ClusterExecutorImpl clusterExecutorImpl2=null;
  try {
    clusterExecutorImpl1=getClusterExecutorImpl(false,false);
    MockClusterEventListener mockClusterEventListener=new MockClusterEventListener();
    clusterExecutorImpl1.addClusterEventListener(mockClusterEventListener);
    clusterExecutorImpl2=getClusterExecutorImpl(false,false);
    ClusterNode clusterNode2=clusterExecutorImpl2.getLocalClusterNode();
    ClusterEvent clusterEvent=mockClusterEventListener.waitJoinMessage();
    assertClusterEvent(clusterEvent,ClusterEventType.JOIN,clusterNode2);
    updateView(clusterExecutorImpl1);
    clusterEvent=mockClusterEventListener.waitDepartMessage();
    assertClusterEvent(clusterEvent,ClusterEventType.DEPART,clusterNode2);
    Assert.assertEquals(-1,clusterNode2.getPort());
    clusterExecutorImpl2.portalPortConfigured(80);
    Assert.assertEquals(80,clusterNode2.getPort());
    clusterEvent=mockClusterEventListener.waitJoinMessage();
    assertClusterEvent(clusterEvent,ClusterEventType.JOIN,clusterNode2);
  }
  finally {
    if (clusterExecutorImpl1 != null) {
      clusterExecutorImpl1.destroy();
    }
    if (clusterExecutorImpl2 != null) {
      clusterExecutorImpl2.destroy();
    }
  }
}
