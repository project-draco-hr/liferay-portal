{
  ClusterExecutorImpl clusterExecutorImpl=getClusterExecutorImpl();
  TestClusterChannel.clearAllMessages();
  List<Serializable> multicastMessages=TestClusterChannel.getMulticastMessages();
  List<ObjectValuePair<Serializable,Address>> unicastMessages=TestClusterChannel.getUnicastMessages();
  Assert.assertTrue(multicastMessages.isEmpty());
  Assert.assertTrue(unicastMessages.isEmpty());
  ClusterRequest clusterRequest=ClusterRequest.createMulticastRequest(StringPool.BLANK);
  FutureClusterResponses futureClusterResponses=clusterExecutorImpl.execute(clusterRequest);
  Assert.assertEquals(1,multicastMessages.size());
  Assert.assertTrue(multicastMessages.contains(clusterRequest));
  Assert.assertTrue(unicastMessages.isEmpty());
  ClusterNodeResponses clusterNodeResponses=futureClusterResponses.get();
  Assert.assertEquals(1,clusterNodeResponses.size());
  TestClusterChannel.clearAllMessages();
  Assert.assertTrue(multicastMessages.isEmpty());
  Assert.assertTrue(unicastMessages.isEmpty());
  clusterRequest=ClusterRequest.createMulticastRequest(StringPool.BLANK,true);
  futureClusterResponses=clusterExecutorImpl.execute(clusterRequest);
  Assert.assertEquals(1,multicastMessages.size());
  Assert.assertTrue(multicastMessages.contains(clusterRequest));
  Assert.assertTrue(unicastMessages.isEmpty());
  clusterNodeResponses=futureClusterResponses.get();
  Assert.assertEquals(0,clusterNodeResponses.size());
  TestClusterChannel.clearAllMessages();
  Assert.assertTrue(multicastMessages.isEmpty());
  Assert.assertTrue(unicastMessages.isEmpty());
  ClusterNode localClusterNode=clusterExecutorImpl.getLocalClusterNode();
  clusterRequest=ClusterRequest.createUnicastRequest(clusterRequest,localClusterNode.getClusterNodeId());
  futureClusterResponses=clusterExecutorImpl.execute(clusterRequest);
  Assert.assertTrue(multicastMessages.isEmpty());
  Assert.assertTrue(unicastMessages.isEmpty());
  clusterNodeResponses=futureClusterResponses.get();
  Assert.assertEquals(1,clusterNodeResponses.size());
  TestClusterChannel.clearAllMessages();
  Assert.assertTrue(multicastMessages.isEmpty());
  Assert.assertTrue(unicastMessages.isEmpty());
  ClusterExecutorImpl newClusterExecutorImpl=getClusterExecutorImpl();
  Assert.assertEquals(1,multicastMessages.size());
  Assert.assertTrue(unicastMessages.isEmpty());
  Serializable serializable=multicastMessages.get(0);
  clusterExecutorImpl.handleReceivedClusterRequest((ClusterRequest)serializable);
  TestClusterChannel.clearAllMessages();
  ClusterNode newClusterNode=newClusterExecutorImpl.getLocalClusterNode();
  clusterRequest=ClusterRequest.createUnicastRequest(StringPool.BLANK,newClusterNode.getClusterNodeId());
  clusterExecutorImpl.execute(clusterRequest);
  Assert.assertTrue(multicastMessages.isEmpty());
  Assert.assertEquals(1,unicastMessages.size());
  ObjectValuePair<Serializable,Address> receivedMessage=unicastMessages.get(0);
  Assert.assertEquals(clusterRequest,receivedMessage.getKey());
}
