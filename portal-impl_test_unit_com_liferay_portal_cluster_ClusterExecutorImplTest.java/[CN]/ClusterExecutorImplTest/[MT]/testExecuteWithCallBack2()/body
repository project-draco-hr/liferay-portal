{
  ClusterExecutorImpl clusterExecutorImpl=null;
  try {
    clusterExecutorImpl=getClusterExecutorImpl(false,false);
    String timestamp=String.valueOf(System.currentTimeMillis());
    MethodHandler methodHandler=new MethodHandler(testMethod1MethodKey,timestamp);
    Address address=clusterExecutorImpl.getLocalClusterNodeAddress();
    ClusterRequest clusterRequest=ClusterRequest.createUnicastRequest(methodHandler,address);
    MockClusterResponseCallback mockClusterResponseCallback=new MockClusterResponseCallback();
    clusterExecutorImpl.execute(clusterRequest,mockClusterResponseCallback,1000,TimeUnit.MILLISECONDS);
    ClusterNodeResponses clusterNodeResponses=mockClusterResponseCallback.waitMessage();
    assertFutureClusterResponsesWithoutException(clusterNodeResponses,clusterRequest.getUuid(),timestamp,address);
    clusterRequest=ClusterRequest.createUnicastRequest(null,new AddressImpl(new MockAddress()));
    clusterExecutorImpl.execute(clusterRequest,mockClusterResponseCallback,1000,TimeUnit.MILLISECONDS);
    TimeoutException timeoutException=mockClusterResponseCallback.waitTimeoutException();
    Assert.assertNotNull(timeoutException);
    clusterExecutorImpl.execute(clusterRequest,mockClusterResponseCallback);
    Field field=ReflectionUtil.getDeclaredField(ClusterExecutorImpl.class,"_executorService");
    ExecutorService executorService=(ExecutorService)field.get(clusterExecutorImpl);
    executorService.shutdownNow();
    InterruptedException interruptedException=mockClusterResponseCallback.waitInterruptedException();
    Assert.assertNotNull(interruptedException);
  }
  finally {
    if (clusterExecutorImpl != null) {
      clusterExecutorImpl.destroy();
    }
  }
}
