{
  int imageHeight=image.getHeight();
  int imageWidth=image.getWidth();
  int[] pixels=new int[imageWidth * imageHeight];
  Toolkit toolkit=Toolkit.getDefaultToolkit();
  Image tmpImage=toolkit.createImage(image.getSource());
  PixelGrabber grabber=new PixelGrabber(tmpImage,0,0,imageWidth,imageHeight,pixels,0,imageWidth);
  try {
    if (!grabber.grabPixels()) {
      throw new InterruptedException();
    }
  }
 catch (  InterruptedException ie) {
    ie.printStackTrace();
  }
  for (int y=0; y < imageHeight; y++) {
    for (int x=0; x < imageWidth; x++) {
      if (pixels[(y * imageWidth) + x] == oldColorRGB) {
        pixels[(y * imageWidth) + x]=newColorRGB;
      }
    }
  }
  tmpImage=toolkit.createImage(new MemoryImageSource(imageWidth,imageHeight,pixels,0,imageWidth));
  BufferedImage newImage=new BufferedImage(imageWidth,imageHeight,BufferedImage.TYPE_INT_ARGB);
  Graphics2D g2d=newImage.createGraphics();
  g2d.drawImage(tmpImage,0,0,imageWidth,imageHeight,null);
  g2d.dispose();
  newImage.flush();
  return newImage;
}
