{
  long[] filteredUserIds=userIds;
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  Role role=RoleLocalServiceUtil.getRole(roleId);
  for (int i=0; i < userIds.length; i++) {
    User user=UserLocalServiceUtil.getUser(userIds[i]);
    if (MembershipPolicyUtil.isMembershipProtected(permissionChecker,group,role,user)) {
      filteredUserIds=ArrayUtil.remove(filteredUserIds,userIds[i]);
    }
  }
  return filteredUserIds;
}
