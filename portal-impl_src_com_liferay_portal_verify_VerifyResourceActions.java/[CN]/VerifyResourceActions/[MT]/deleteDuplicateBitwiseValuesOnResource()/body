{
  StringBundler sb=new StringBundler(5);
  sb.append("select ra1.resourceActionId, ra1.name, ra1.actionId, ");
  sb.append("ra1.bitwiseValue from ResourceAction ra1 inner join ");
  sb.append("ResourceAction ra2 on (ra1.name = ra2.name) and ");
  sb.append("(ra1.bitwiseValue = ra2.bitwiseValue) and (ra1.actionId ");
  sb.append("!= ra2.actionId)");
  try (LoggingTimer loggingTimer=new LoggingTimer();PreparedStatement ps=connection.prepareStatement(sb.toString());ResultSet rs=ps.executeQuery()){
    Map<String,Set<Long>> nameBitwiseValuesPairs=new HashMap<>();
    while (rs.next()) {
      String name=rs.getString("name");
      Set<Long> bitwiseValues=nameBitwiseValuesPairs.get(name);
      if (bitwiseValues == null) {
        bitwiseValues=new HashSet<>();
        nameBitwiseValuesPairs.put(name,bitwiseValues);
      }
      if (bitwiseValues.add(rs.getLong("bitwiseValue"))) {
        continue;
      }
      if (_log.isInfoEnabled()) {
        StringBundler sb=new StringBundler(7);
        sb.append("Deleting resource action ");
        sb.append(rs.getString("actionId"));
        sb.append(" from resource ");
        sb.append(name);
        sb.append(" because its bitwise value is the ");
        sb.append("same as another resource action on ");
        sb.append("the same resource");
        _log.info(sb.toString());
      }
      ResourceActionLocalServiceUtil.deleteResourceAction(rs.getLong("resourceActionId"));
    }
  }
 }
