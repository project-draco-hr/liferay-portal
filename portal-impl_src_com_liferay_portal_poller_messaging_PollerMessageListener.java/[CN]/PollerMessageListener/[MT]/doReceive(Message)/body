{
  PollerResponse pollerResponse=null;
  try {
    PollerRequest pollerRequest=(PollerRequest)message.getPayload();
    String portletId=pollerRequest.getPortletId();
    PollerProcessor pollerProcessor=PollerProcessorUtil.getPollerProcessor(portletId);
    if (pollerRequest.isReceiveRequest()) {
      pollerResponse=new PollerResponse(portletId,pollerRequest.getChunkId());
      try {
        pollerProcessor.receive(pollerRequest,pollerResponse);
      }
 catch (      PollerException pe) {
        _log.error("Unable to receive poller request " + pollerRequest,pe);
        pollerResponse.setParameter("pollerException",pe.getMessage());
      }
    }
 else {
      try {
        pollerProcessor.send(pollerRequest);
      }
 catch (      PollerException pe) {
        _log.error("Unable to send poller request " + pollerRequest,pe);
      }
    }
  }
  finally {
    String responseDestinationName=message.getResponseDestinationName();
    if (Validator.isNotNull(responseDestinationName)) {
      Message responseMessage=MessageBusUtil.createResponseMessage(message);
      responseMessage.setPayload(pollerResponse);
      MessageBusUtil.sendMessage(responseDestinationName,responseMessage);
    }
  }
}
