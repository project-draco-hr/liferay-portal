{
  setUpPermissionThreadLocal();
  setUpPrincipalThreadLocal();
  _group=GroupTestUtil.addGroup();
  setUpParentFolder();
  setUpResourcePermission();
  List<DLFileEntryType> dlFileEntryTypes=DLFileEntryTypeLocalServiceUtil.getFileEntryTypes(PortalUtil.getCurrentAndAncestorSiteGroupIds(_group.getGroupId()));
  for (  DLFileEntryType dlFileEntryType : dlFileEntryTypes) {
    String fileEntryTypeKey=dlFileEntryType.getFileEntryTypeKey();
    if (fileEntryTypeKey.equals(DLFileEntryTypeConstants.FILE_ENTRY_TYPE_KEY_CONTRACT)) {
      _contractDLFileEntryTypeId=dlFileEntryType.getFileEntryTypeId();
    }
  }
  ExpandoTable expandoTable=ExpandoTableLocalServiceUtil.addDefaultTable(PortalUtil.getDefaultCompanyId(),DLFileEntry.class.getName());
  ExpandoColumnLocalServiceUtil.addColumn(expandoTable.getTableId(),_EXPANDO_ATTRIBUTE_NAME,ExpandoColumnConstants.STRING,StringPool.BLANK);
  _serviceContext=getServiceContext();
  FileEntry fileEntry=DLAppServiceUtil.addFileEntry(_group.getGroupId(),_parentFolder.getFolderId(),_SOURCE_FILE_NAME,ContentTypes.APPLICATION_OCTET_STREAM,_TITLE,StringPool.BLANK,StringPool.BLANK,_DATA_VERSION_1,_serviceContext);
  _fileVersion=DLFileVersionLocalServiceUtil.getFileVersion(fileEntry.getFileEntryId(),DLFileEntryConstants.VERSION_DEFAULT);
}
