{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  PortletPreferences prefs=PortletPreferencesFactoryUtil.getPortletSetup(req,PortletKeys.MESSAGE_BOARDS,false,true);
  String plid=ParamUtil.getString(req,"p_l_id");
  long companyId=ParamUtil.getLong(req,"companyId");
  long groupId=ParamUtil.getLong(req,"groupId");
  long categoryId=ParamUtil.getLong(req,"categoryId");
  long threadId=ParamUtil.getLong(req,"threadId");
  String type=ParamUtil.getString(req,"type",RSSUtil.DEFAULT_TYPE);
  double version=ParamUtil.getDouble(req,"version",RSSUtil.DEFAULT_VERSION);
  String entryURL=themeDisplay.getURLPortal() + themeDisplay.getPathMain() + "/message_boards/find_message?p_l_id="+ plid;
  String rss=StringPool.BLANK;
  if (companyId > 0) {
    String feedURL=StringPool.BLANK;
    rss=MBMessageServiceUtil.getCompanyMessagesRSS(companyId,SearchContainer.DEFAULT_DELTA,type,version,feedURL,entryURL,prefs);
  }
 else   if (groupId > 0) {
    String feedURL=themeDisplay.getURLPortal() + themeDisplay.getPathMain() + "/message_boards/find_recent_posts?p_l_id="+ plid;
    rss=MBMessageServiceUtil.getGroupMessagesRSS(groupId,SearchContainer.DEFAULT_DELTA,type,version,feedURL,entryURL,prefs);
  }
 else   if (categoryId > 0) {
    String feedURL=themeDisplay.getURLPortal() + themeDisplay.getPathMain() + "/message_boards/find_category?p_l_id="+ plid+ "&categoryId="+ categoryId;
    try {
      rss=MBMessageServiceUtil.getCategoryMessagesRSS(categoryId,SearchContainer.DEFAULT_DELTA,type,version,feedURL,entryURL,prefs);
    }
 catch (    NoSuchCategoryException nsce) {
      if (_log.isWarnEnabled()) {
        _log.warn(nsce);
      }
    }
  }
 else   if (threadId > 0) {
    String feedURL=themeDisplay.getURLPortal() + themeDisplay.getPathMain() + "/message_boards/find_thread?p_l_id="+ plid+ "&threadId="+ threadId;
    rss=MBMessageServiceUtil.getThreadMessagesRSS(threadId,SearchContainer.DEFAULT_DELTA,type,version,feedURL,entryURL,prefs);
  }
  return rss.getBytes();
}
