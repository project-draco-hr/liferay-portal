{
  if (inputStream == null) {
    throw new IOException("S3 object input stream is null");
  }
  File tempFile=new File(tempFileName);
  if (tempFile.exists() && (tempFile.lastModified() >= lastModified)) {
    return tempFile;
  }
  try {
    File parentFile=tempFile.getParentFile();
    parentFile.mkdirs();
    FileOutputStream outputStream=new FileOutputStream(tempFile);
    StreamUtil.transfer(inputStream,outputStream);
  }
  finally {
    StreamUtil.cleanUp(inputStream);
  }
  return tempFile;
}
