{
  _accessCounter++;
  if (_accessCounter >= PropsValues.DL_STORE_S3_TEMPDIR_CLEAN_ACCESS_COUNT_LIMIT) {
    _accessCounter=0;
    String tmpDirPath=SystemProperties.get(SystemProperties.TMP_DIR) + "/liferay/s3";
    File tmpDir=new File(tmpDirPath);
    long daysToKeep=(_DAY_IN_MILLIS * PropsValues.DL_STORE_S3_TEMPDIR_CLEAN_KEEP_LAST_DAYS_COUNT);
    long lastDateToKeep=(System.currentTimeMillis() - daysToKeep);
    File[] yearDirs=tmpDir.listFiles();
    for (    File yearDir : yearDirs) {
      File[] monthDirs=yearDir.listFiles();
      if (monthDirs.length == 0) {
        yearDir.delete();
      }
      for (      File monthDir : monthDirs) {
        File[] dayDirs=monthDir.listFiles();
        File[] dirsToDelete=monthDir.listFiles(new S3TempDirectoryFilter(lastDateToKeep));
        if ((dayDirs.length == 0) || (dayDirs.length == dirsToDelete.length)) {
          FileUtil.deltree(monthDir);
        }
 else {
          for (          File directory : dirsToDelete) {
            FileUtil.deltree(directory);
          }
        }
      }
    }
  }
}
