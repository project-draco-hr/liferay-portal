{
  List<Portlet> portlets=_portletLocalService.getPortlets(companyId);
  List<Tuple> rankedPortlets=new ArrayList<>();
  for (  Portlet portlet : portlets) {
    if (!portlet.isActive()) {
      continue;
    }
    PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
    if ((portletDataHandler == null) || !portletDataHandler.isDataSiteLevel() || (excludeDataAlwaysStaged && portletDataHandler.isDataAlwaysStaged())) {
      continue;
    }
    rankedPortlets.add(new Tuple(portletDataHandler.getRank(),portlet));
  }
  Collections.sort(rankedPortlets,new Comparator<Tuple>(){
    @Override public int compare(    Tuple tuple1,    Tuple tuple2){
      int rank1=(int)tuple1.getObject(0);
      int rank2=(int)tuple2.getObject(0);
      return rank1 - rank2;
    }
  }
);
  List<Portlet> dataSiteLevelPortlets=new ArrayList<>();
  for (  Tuple tuple : rankedPortlets) {
    dataSiteLevelPortlets.add((Portlet)tuple.getObject(1));
  }
  return dataSiteLevelPortlets;
}
