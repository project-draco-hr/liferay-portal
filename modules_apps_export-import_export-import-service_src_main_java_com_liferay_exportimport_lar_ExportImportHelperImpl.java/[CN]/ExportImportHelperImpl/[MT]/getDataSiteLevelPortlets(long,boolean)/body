{
  List<Portlet> portlets=_portletLocalService.getPortlets(companyId);
  Iterator<Portlet> itr=portlets.iterator();
  while (itr.hasNext()) {
    Portlet portlet=itr.next();
    if (!portlet.isActive()) {
      itr.remove();
      continue;
    }
    PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
    if ((portletDataHandler == null) || !portletDataHandler.isDataSiteLevel() || (excludeDataAlwaysStaged && portletDataHandler.isDataAlwaysStaged())) {
      itr.remove();
    }
  }
  return portlets;
}
