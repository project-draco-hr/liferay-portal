{
  long groupId=0;
  long repositoryId=0;
  long folderId=atomRequestContext.getLongParameter("folderId");
  if (folderId != 0) {
    DLFolder dlFolder=DLFolderServiceUtil.getFolder(folderId);
    groupId=dlFolder.getGroupId();
    repositoryId=dlFolder.getRepositoryId();
  }
 else {
    groupId=atomRequestContext.getLongParameter("groupId");
    repositoryId=atomRequestContext.getLongParameter("repositoryId");
  }
  String title=atomRequestContext.getHeader("Title");
  String description=atomRequestContext.getHeader("Summary");
  ByteArrayOutputStream byteArrayOutputStream=new ByteArrayOutputStream();
  StreamUtil.transfer(inputStream,byteArrayOutputStream);
  byte[] content=byteArrayOutputStream.toByteArray();
  ByteArrayInputStream contentInputStream=new ByteArrayInputStream(content);
  ServiceContext serviceContext=new ServiceContext();
  DLFileEntry dlFileEntry=DLFileEntryServiceUtil.addFileEntry(groupId,repositoryId,folderId,mimeType,title,description,null,contentInputStream,content.length,serviceContext);
  return dlFileEntry;
}
