{
  String type=ParamUtil.getString(actionRequest,MDRPortletConstants.TYPE);
  ActionHandler actionHandler=ActionHandlerManagerUtil.getActionHandler(type);
  if (actionHandler == null) {
    SessionErrors.add(actionRequest,MDRPortletConstants.ERROR_INVALID_TYPE);
    return;
  }
  UnicodeProperties typeSettingsProperties=getTypeSettingsProperties(actionRequest,actionHandler);
  if (typeSettingsProperties != null) {
    long ruleGroupInstanceId=ParamUtil.getLong(actionRequest,MDRPortletConstants.MDR_RULE_GROUP_INSTANCE_ID);
    Map<Locale,String> nameMap=LocalizationUtil.getLocalizationMap(actionRequest,MDRPortletConstants.NAME);
    Map<Locale,String> descriptionMap=LocalizationUtil.getLocalizationMap(actionRequest,MDRPortletConstants.DESCRIPTION);
    MDRRuleGroupInstance ruleGroupInstance=MDRRuleGroupInstanceLocalServiceUtil.getMDRRuleGroupInstance(ruleGroupInstanceId);
    ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
    if (add) {
      MDRActionServiceUtil.addMDRAction(ruleGroupInstance.getRuleGroupInstanceId(),nameMap,descriptionMap,type,typeSettingsProperties,serviceContext);
    }
 else {
      long actionId=ParamUtil.getLong(actionRequest,MDRPortletConstants.MDR_ACTION_ID);
      MDRActionServiceUtil.updateAction(actionId,nameMap,descriptionMap,type,typeSettingsProperties,serviceContext);
    }
  }
}
