{
  if (portletDataContext.isPerformDirectBinaryImport()) {
    return;
  }
  FileVersion fileVersion=fileEntry.getFileVersion();
  if (!hasPreview(fileVersion,previewType)) {
    if (_log.isWarnEnabled()) {
      _log.warn("No preview found for file entry " + fileEntry.getFileEntryId());
    }
    return;
  }
  String binPathSegment=null;
  if (fileIndex < 0) {
    binPathSegment=previewType;
  }
 else {
    binPathSegment=Integer.toString(fileIndex + 1);
  }
  String binPath=getBinPath(portletDataContext,fileEntry,binPathSegment);
  StringBundler sb=new StringBundler(4);
  sb.append("bin-path-preview-");
  sb.append(binPathSegment);
  sb.append("-");
  sb.append(binPathSuffix);
  String binPathName=sb.toString();
  fileEntryElement.addAttribute(binPathName,binPath);
  InputStream is=null;
  try {
    if (fileIndex < 0) {
      is=doGetPreviewAsStream(fileVersion,previewType);
    }
 else {
      is=doGetPreviewAsStream(fileVersion,fileIndex + 1,previewType);
    }
    exportBinary(portletDataContext,fileEntryElement,fileVersion,is,binPath,binPathName);
  }
  finally {
    StreamUtil.cleanUp(is);
  }
}
