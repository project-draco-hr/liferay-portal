{
  if (!isThumbnailEnabled(index)) {
    return;
  }
  if (!portletDataContext.isPerformDirectBinaryImport()) {
    importThumbnailFromLAR(portletDataContext,importedFileEntry,fileEntryElement,binPathName,index);
  }
 else {
    FileVersion fileVersion=fileEntry.getFileVersion();
    if (!hasThumbnail(fileVersion,index)) {
      return;
    }
    InputStream is=null;
    try {
      is=doGetThumbnailAsStream(fileVersion,index);
      FileVersion importedFileVersion=importedFileEntry.getFileVersion();
      String thumbnailFilePath=getThumbnailFilePath(importedFileVersion,getThumbnailType(importedFileVersion),index);
      addFileToStore(portletDataContext.getCompanyId(),THUMBNAIL_PATH,thumbnailFilePath,is);
    }
  finally {
      StreamUtil.cleanUp(is);
    }
  }
}
