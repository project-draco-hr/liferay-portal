{
  if (!isThumbnailEnabled(index) || hasThumbnail(fileVersion,index)) {
    return;
  }
  String type=getThumbnailType(fileVersion);
  String maxHeightPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_MAX_HEIGHT;
  String maxWidthPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_MAX_WIDTH;
  if (index == THUMBNAIL_INDEX_CUSTOM_1) {
    maxHeightPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_CUSTOM_1_MAX_HEIGHT;
    maxWidthPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_CUSTOM_1_MAX_WIDTH;
  }
 else   if (index == THUMBNAIL_INDEX_CUSTOM_2) {
    maxHeightPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_CUSTOM_2_MAX_HEIGHT;
    maxWidthPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_CUSTOM_2_MAX_WIDTH;
  }
  RenderedImage thumbnailRenderedImage=ImageToolUtil.scale(renderedImage,PrefsPropsUtil.getInteger(maxHeightPropsKey),PrefsPropsUtil.getInteger(maxWidthPropsKey));
  byte[] bytes=ImageToolUtil.getBytes(thumbnailRenderedImage,type);
  File file=FileUtil.createTempFile(bytes);
  try {
    addFileToStore(fileVersion.getCompanyId(),THUMBNAIL_PATH,getThumbnailFilePath(fileVersion,type,index),file);
  }
  finally {
    FileUtil.delete(file);
  }
}
