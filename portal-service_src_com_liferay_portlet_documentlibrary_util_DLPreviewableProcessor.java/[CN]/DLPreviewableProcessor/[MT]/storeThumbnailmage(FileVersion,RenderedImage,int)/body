{
  if ((thumbnailIndex > 0) && !isCustomThumbnailsEnabled(thumbnailIndex)) {
    return;
  }
  String type=getThumbnailType(fileVersion);
  String maxHeightPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_MAX_HEIGHT;
  if (thumbnailIndex == THUMBNAIL_INDEX_CUSTOM_1) {
    maxHeightPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_CUSTOM_1_MAX_HEIGHT;
  }
 else   if (thumbnailIndex == THUMBNAIL_INDEX_CUSTOM_2) {
    maxHeightPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_CUSTOM_2_MAX_HEIGHT;
  }
  String maxWidthPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_MAX_WIDTH;
  if (thumbnailIndex == THUMBNAIL_INDEX_CUSTOM_1) {
    maxWidthPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_CUSTOM_1_MAX_WIDTH;
  }
 else   if (thumbnailIndex == THUMBNAIL_INDEX_CUSTOM_2) {
    maxWidthPropsKey=PropsKeys.DL_FILE_ENTRY_THUMBNAIL_CUSTOM_2_MAX_WIDTH;
  }
  RenderedImage thumbnailRenderedImage=ImageProcessorUtil.scale(renderedImage,PrefsPropsUtil.getInteger(maxHeightPropsKey),PrefsPropsUtil.getInteger(maxWidthPropsKey));
  byte[] bytes=ImageProcessorUtil.getBytes(thumbnailRenderedImage,MimeTypesUtil.getContentType("A." + type));
  File file=FileUtil.createTempFile(bytes);
  try {
    addFileToStore(fileVersion.getCompanyId(),THUMBNAIL_PATH,getThumbnailFilePath(fileVersion,type,thumbnailIndex),file);
  }
  finally {
    FileUtil.delete(file);
  }
}
