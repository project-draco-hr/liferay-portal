{
  if (request == null) {
    return null;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay != null) {
    return themeDisplay.getPathThemeCss();
  }
  long companyId=PortalUtil.getCompanyId(request);
  String themeId=ParamUtil.getString(request,"themeId");
  Matcher portalThemeResourceMatcher=_portalThemeResourcePath.matcher(cssRealPath);
  Matcher pluginThemeResourceMatcher=_pluginThemeResourcePath.matcher(cssRealPath);
  if (portalThemeResourceMatcher.find()) {
    String themePathId=portalThemeResourceMatcher.group(1);
    themeId=PortalUtil.getJsSafePortletId(themePathId);
  }
 else   if (pluginThemeResourceMatcher.find()) {
    String themePathId=pluginThemeResourceMatcher.group(1);
    themePathId=themePathId.concat(PortletConstants.WAR_SEPARATOR).concat(themePathId).concat("theme");
    themeId=PortalUtil.getJsSafePortletId(themePathId);
  }
  if (Validator.isNull(themeId)) {
    return null;
  }
  try {
    Theme theme=ThemeLocalServiceUtil.getTheme(companyId,themeId,false);
    String themeStaticResourcePath=theme.getStaticResourcePath();
    return themeStaticResourcePath.concat(theme.getCssPath());
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  return null;
}
