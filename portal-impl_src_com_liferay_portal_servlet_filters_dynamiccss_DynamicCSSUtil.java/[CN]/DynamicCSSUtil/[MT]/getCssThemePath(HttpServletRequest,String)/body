{
  if (request == null) {
    return null;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay != null) {
    return themeDisplay.getPathThemeCss();
  }
  long companyId=PortalUtil.getCompanyId(request);
  String themeId=ParamUtil.getString(request,"themeId");
  Matcher portalThemeMatcher=_portalThemePattern.matcher(cssRealPath);
  if (portalThemeMatcher.find()) {
    String themePathId=portalThemeMatcher.group(1);
    themeId=PortalUtil.getJsSafePortletId(themePathId);
  }
 else {
    Matcher pluginThemeMatcher=_pluginThemePattern.matcher(cssRealPath);
    if (pluginThemeMatcher.find()) {
      String themePathId=pluginThemeMatcher.group(1);
      StringBundler sb=new StringBundler(4);
      sb.append(themePathId);
      sb.append(PortletConstants.WAR_SEPARATOR);
      sb.append(themePathId);
      sb.append("theme");
      themePathId=sb.toString();
      themeId=PortalUtil.getJsSafePortletId(themePathId);
    }
  }
  if (Validator.isNull(themeId)) {
    return null;
  }
  try {
    Theme theme=ThemeLocalServiceUtil.getTheme(companyId,themeId,false);
    String themeStaticResourcePath=theme.getStaticResourcePath();
    return themeStaticResourcePath.concat(theme.getCssPath());
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  return null;
}
