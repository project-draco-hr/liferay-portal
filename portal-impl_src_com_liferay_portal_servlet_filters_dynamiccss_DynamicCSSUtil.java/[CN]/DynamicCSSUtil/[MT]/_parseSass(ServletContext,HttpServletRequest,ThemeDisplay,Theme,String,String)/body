{
  Map<String,Object> inputObjects=new HashMap<String,Object>();
  String portalWebDir=PortalUtil.getPortalWebDir();
  String commonSassPath=portalWebDir.concat(_SASS_COMMON_DIR);
  String cssThemePath=_getCssThemePath(servletContext,request,themeDisplay,theme);
  if (ServerDetector.isWebLogic()) {
    if (new File(commonSassPath).exists() == false) {
      int index=cssThemePath.indexOf("autodeploy");
      if (index == -1) {
        if (_log.isWarnEnabled()) {
          _log.warn("DynamicCSS compilation may not work.");
        }
      }
 else {
        index+=11;
        commonSassPath=cssThemePath.substring(0,index);
        commonSassPath+="ROOT/".concat(_SASS_COMMON_DIR);
      }
    }
  }
  inputObjects.put("commonSassPath",commonSassPath);
  inputObjects.put("content",content);
  inputObjects.put("cssRealPath",resourcePath);
  inputObjects.put("cssThemePath",cssThemePath);
  File sassTempDir=_getSassTempDir(servletContext);
  inputObjects.put("sassCachePath",sassTempDir.getCanonicalPath());
  UnsyncByteArrayOutputStream unsyncByteArrayOutputStream=new UnsyncByteArrayOutputStream();
  UnsyncPrintWriter unsyncPrintWriter=UnsyncPrintWriterPool.borrow(unsyncByteArrayOutputStream);
  inputObjects.put("out",unsyncPrintWriter);
  _rubyExecutor.eval(null,inputObjects,null,_rubyScript);
  unsyncPrintWriter.flush();
  return unsyncByteArrayOutputStream.toString();
}
