{
  String portalWebDir=PortalUtil.getPortalWebDir();
  String commonSassPath=portalWebDir.concat(_SASS_COMMON_DIR);
  String cssThemePath=_getCssThemePath(servletContext,request,themeDisplay,theme);
  if (ServerDetector.isWebLogic() && !FileUtil.exists(commonSassPath)) {
    int pos=cssThemePath.indexOf("autodeploy/");
    if (pos == -1) {
      if (_log.isWarnEnabled()) {
        _log.warn("Dynamic CSS compilation may not work");
      }
    }
 else {
      commonSassPath=cssThemePath.substring(0,pos + 11) + "ROOT/" + _SASS_COMMON_DIR;
    }
  }
  if (_jniSassCompiler != null) {
    content=_jniSassCompiler.compileString(content,commonSassPath + File.pathSeparator + cssThemePath,"");
  }
 else {
    File sassTempDir=_getSassTempDir(servletContext);
    Object[] arguments=new Object[]{content,commonSassPath,resourcePath,cssThemePath,sassTempDir.getCanonicalPath(),_log.isDebugEnabled()};
    try {
      content=_scriptingContainer.callMethod(_scriptObject,"process",arguments,String.class);
    }
 catch (    Exception e) {
      if (e instanceof RaiseException) {
        RaiseException raiseException=(RaiseException)e;
        RubyException rubyException=raiseException.getException();
        _log.error(rubyException.message.toJava(String.class));
        IRubyObject iRubyObject=rubyException.getBacktrace();
        RubyArray rubyArray=(RubyArray)iRubyObject.toJava(RubyArray.class);
        for (int i=0; i < rubyArray.size(); i++) {
          Object object=rubyArray.get(i);
          _log.error(object);
        }
      }
 else {
        _log.error(e,e);
      }
    }
  }
  return content;
}
