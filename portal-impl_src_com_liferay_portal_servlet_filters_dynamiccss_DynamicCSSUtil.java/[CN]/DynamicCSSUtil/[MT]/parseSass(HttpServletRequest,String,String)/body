{
  if (!DynamicCSSFilter.ENABLED) {
    return content;
  }
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  if (request == null) {
    return content;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Theme theme=null;
  if (themeDisplay == null) {
    theme=_getTheme(request,cssRealPath);
    if (theme == null) {
      return content;
    }
  }
  String parsedContent=null;
  File cssRealFile=new File(cssRealPath);
  File cacheCssRealFile=SassToCssBuilder.getCacheFile(cssRealPath);
  if (cacheCssRealFile.exists() && (cacheCssRealFile.lastModified() == cssRealFile.lastModified())) {
    parsedContent=FileUtil.read(cacheCssRealFile);
    if (_log.isDebugEnabled()) {
      _log.debug("Loading SASS cache from " + cacheCssRealFile + " takes "+ stopWatch.getTime()+ " ms");
    }
  }
 else {
    content=StringUtil.replace(content,new String[]{"@model_hints_constants_text_display_height@","@model_hints_constants_text_display_width@","@model_hints_constants_textarea_display_height@","@model_hints_constants_textarea_display_width@"},new String[]{ModelHintsConstants.TEXT_DISPLAY_HEIGHT,ModelHintsConstants.TEXT_DISPLAY_WIDTH,ModelHintsConstants.TEXTAREA_DISPLAY_HEIGHT,ModelHintsConstants.TEXTAREA_DISPLAY_WIDTH});
    parsedContent=_parseSass(request,themeDisplay,theme,cssRealPath,content);
    if (_log.isDebugEnabled()) {
      _log.debug("Parsing SASS for " + cssRealPath + " takes "+ stopWatch.getTime()+ " ms");
    }
  }
  if (Validator.isNull(parsedContent)) {
    return content;
  }
  parsedContent=StringUtil.replace(parsedContent,"@theme_image_path@",_getThemeImagesPath(request,themeDisplay,theme));
  return parsedContent;
}
