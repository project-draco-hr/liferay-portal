{
  ThreadDumper threadDumper=new ThreadDumper();
  ScheduledFuture<?> scheduledFuture=_scheduledExecutorService.schedule(threadDumper,PropsValues.THREAD_DUMP_SPEED_THRESHOLD,TimeUnit.SECONDS);
  try {
    processFilter(ThreadDumpFilter.class,request,response,filterChain);
  }
  finally {
    scheduledFuture.cancel(true);
  }
  if (!threadDumper.isExecuted()) {
    Runtime runtime=Runtime.getRuntime();
    long freeMemory=runtime.freeMemory();
    long maxMemory=runtime.maxMemory();
    long usedMemory=maxMemory - freeMemory;
    double usedMemoryPercent=(usedMemory / (double)maxMemory) * 100;
    if (usedMemoryPercent > PropsValues.THREAD_DUMP_MEMORY_THRESHOLD) {
      threadDumper.run();
    }
  }
}
