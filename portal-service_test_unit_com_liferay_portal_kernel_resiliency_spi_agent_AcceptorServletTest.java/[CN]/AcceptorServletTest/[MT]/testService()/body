{
  final AtomicBoolean failOnForward=new AtomicBoolean();
  final AtomicReference<String> forwardPathReference=new AtomicReference<String>();
  final IOException ioException=new IOException("Unable to forward");
  MockServletContext mockServletContext=new MockServletContext(){
    @Override public RequestDispatcher getRequestDispatcher(    final String path){
      return new RequestDispatcher(){
        @Override public void forward(        ServletRequest servletRequest,        ServletResponse servletResponse) throws IOException {
          forwardPathReference.set(path);
          if (failOnForward.get()) {
            throw ioException;
          }
        }
        @Override public void include(        ServletRequest servletRequest,        ServletResponse servletResponse){
        }
      }
;
    }
  }
;
  mockServletContext.setContextPath("/");
  AcceptorServlet acceptorServlet=new AcceptorServlet();
  acceptorServlet.init(new MockServletConfig(mockServletContext));
  MockHttpServletRequest mockHttpServletRequest=new MockHttpServletRequest();
  mockHttpServletRequest.setServerPort(1234);
  MockHttpServletResponse mockHttpServletResponse=new MockHttpServletResponse();
  acceptorServlet.service(mockHttpServletRequest,mockHttpServletResponse);
  Assert.assertEquals("/c/portal/resiliency",forwardPathReference.get());
  Assert.assertSame(mockHttpServletRequest,_recordSPIAgent._originalRequest1);
  Assert.assertSame(mockHttpServletRequest,_recordSPIAgent._originalRequest2);
  Assert.assertSame(mockHttpServletResponse,_recordSPIAgent._originalResponse);
  Assert.assertNull(_recordSPIAgent._exception);
  Assert.assertTrue(_mockHttpSession.isInvalid());
  failOnForward.set(true);
  acceptorServlet.service(mockHttpServletRequest,mockHttpServletResponse);
  Assert.assertEquals("/c/portal/resiliency",forwardPathReference.get());
  Assert.assertSame(mockHttpServletRequest,_recordSPIAgent._originalRequest1);
  Assert.assertSame(mockHttpServletRequest,_recordSPIAgent._originalRequest2);
  Assert.assertSame(mockHttpServletResponse,_recordSPIAgent._originalResponse);
  Assert.assertSame(ioException,_recordSPIAgent._exception);
  Assert.assertTrue(_mockHttpSession.isInvalid());
}
