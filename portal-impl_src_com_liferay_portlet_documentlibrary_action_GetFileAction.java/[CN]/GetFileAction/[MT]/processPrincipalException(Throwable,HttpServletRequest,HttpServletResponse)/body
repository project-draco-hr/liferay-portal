{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  User user=permissionChecker.getUser();
  if ((user != null) && !user.isDefaultUser()) {
    PortalUtil.sendError(HttpServletResponse.SC_UNAUTHORIZED,(Exception)t,request,response);
    return;
  }
  String redirect=PortalUtil.getPathMain() + "/portal/login";
  String currentURL=PortalUtil.getCurrentURL(request);
  redirect=HttpUtil.addParameter(redirect,"redirect",currentURL);
  response.sendRedirect(redirect);
}
