{
  List supportedPluginTypes=Arrays.asList(getSupportedTypes());
  if (_log.isDebugEnabled()) {
    _log.debug("Plugins " + xml);
  }
  PluginRepository plugins=new PluginRepository();
  if (xml == null) {
    return plugins;
  }
  SAXReader reader=SAXReaderFactory.getInstance();
  Document doc=reader.read(new XMLSafeReader(xml));
  Element root=doc.getRootElement();
  Iterator itr=root.elements().iterator();
  while (itr.hasNext()) {
    Element pluginEl=(Element)itr.next();
    String name=pluginEl.elementText("name");
    if (_log.isDebugEnabled()) {
      _log.debug("Reading plugin definition " + name);
    }
    Plugin plugin=new PluginImpl(GetterUtil.getString(pluginEl.elementText("module-id")));
    List liferayVersions=_readList(pluginEl.element("liferay-versions"),"liferay-version");
    String type=GetterUtil.getString(pluginEl.elementText("type"));
    if (!_isCurrentVersionSupported(liferayVersions) || !supportedPluginTypes.contains(type)) {
      continue;
    }
    plugin.setName(_readText(name));
    plugin.setAuthor(_readText(pluginEl.elementText("author")));
    plugin.setType(type);
    plugin.setLicenses(_readLicenseList(pluginEl.element("licenses"),"license"));
    plugin.setLiferayVersions(liferayVersions);
    plugin.setTags(_readList(pluginEl.element("tags"),"tag"));
    plugin.setShortDescription(_readText(pluginEl.elementText("short-description")));
    plugin.setLongDescription(_readHtml(pluginEl.elementText("long-description")));
    plugin.setScreenshotURLs(_readList(pluginEl.element("screenshots"),"screenshot-url"));
    plugin.setPageURL(_readText(pluginEl.elementText("page-url")));
    plugin.setRepositoryURL(repositoryURL);
    plugin.setRecommendedWARName(_readText(pluginEl.elementText("recommended-war-name")));
    plugins.addPlugin(plugin);
    indexPlugin(plugin);
  }
  return plugins;
}
