{
  SortedMap plugins=new TreeMap();
  String[] repositoryURLs=null;
  if (Validator.isNull(repositoryURL)) {
    repositoryURLs=getRepositoryURLs();
  }
 else {
    repositoryURLs=new String[]{repositoryURL};
  }
  for (int i=0; i < repositoryURLs.length; i++) {
    try {
      PluginRepository repository=getRepository(repositoryURLs[i]);
      Collection repoPlugins=repository.search(type,tags);
      Iterator itr=repoPlugins.iterator();
      while (itr.hasNext()) {
        Plugin plugin=(Plugin)itr.next();
        Plugin previous=(Plugin)plugins.get(plugin);
        if ((previous != null) && plugin.isLaterVersionThan(previous)) {
          plugins.remove(previous);
        }
        plugins.put(plugin,plugin);
      }
    }
 catch (    PluginException pe) {
      _log.error("Unable to load repository " + repositoryURL,pe);
    }
  }
  return new ArrayList(plugins.keySet());
}
