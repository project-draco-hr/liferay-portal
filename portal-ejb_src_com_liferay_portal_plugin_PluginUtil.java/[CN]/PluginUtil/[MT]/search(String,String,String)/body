{
  SortedMap plugins=new TreeMap();
  String[] repositoryURLs;
  if (Validator.isNull(repositoryURL)) {
    repositoryURLs=getRepositoryURLs();
  }
 else {
    repositoryURLs=new String[]{repositoryURL};
  }
  for (int i=0; i < repositoryURLs.length; i++) {
    String repositoryURL2=repositoryURLs[i];
    try {
      PluginRepository repository=getRepository(repositoryURL2);
      Collection repoPlugins=repository.search(type,tags);
      for (Iterator iterator=repoPlugins.iterator(); iterator.hasNext(); ) {
        Plugin plugin=(Plugin)iterator.next();
        Plugin previous=(Plugin)plugins.get(plugin);
        if ((previous != null) && plugin.isLaterVersionThan(previous)) {
          plugins.remove(previous);
        }
        plugins.put(plugin,plugin);
      }
    }
 catch (    PluginException e) {
      _log.info("Error loading repository " + repositoryURL,e);
    }
  }
  return new ArrayList(plugins.keySet());
}
