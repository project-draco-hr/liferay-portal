{
  List visiblePlugins=new ArrayList(plugins.size());
  for (int i=0; i < plugins.size(); i++) {
    Plugin plugin=(Plugin)plugins.get(i);
    PluginSetting pluginSetting=PluginSettingLocalServiceUtil.getPluginSetting(user.getCompanyId(),plugin.getPluginId(),plugin.getPluginType());
    if (pluginSetting.isActive() && pluginSetting.hasPermission(user.getUserId())) {
      visiblePlugins.add(plugin);
    }
  }
  return visiblePlugins;
}
