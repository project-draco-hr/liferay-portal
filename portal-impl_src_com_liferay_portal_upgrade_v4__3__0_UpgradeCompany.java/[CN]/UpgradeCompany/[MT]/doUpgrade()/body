{
  ValueMapper companyIdMapper=ValueMapperFactory.getValueMapper();
  AvailableMappersUtil.setCompanyIdMapper(companyIdMapper);
  String[] webIds=WebIdUtil.getWebIds();
  long[] companyIds=new long[webIds.length];
  for (int i=0; i < webIds.length; i++) {
    String webId=webIds[i];
    long companyId=upgradeWebId(webId);
    companyIds[i]=companyId;
    companyIdMapper.mapValue(webId,new Long(companyId));
  }
  for (int i=0; i < companyIds.length; i++) {
    long companyId=companyIds[i];
    LuceneUtil.checkLuceneDir(companyId);
    DLLocalServiceUtil.checkRoot(companyId);
  }
  UpgradeTable upgradeTable=new DefaultUpgradeTableImpl(CompanyImpl.TABLE_NAME,CompanyImpl.TABLE_COLUMNS);
  upgradeTable.setCreateSQL(CompanyImpl.TABLE_SQL_CREATE);
  upgradeTable.updateTable();
  runSQL("update PortletPreferences set ownerId = '0', ownerType = " + PortletKeys.PREFS_OWNER_TYPE_COMPANY + " where ownerId = 'COMPANY.LIFERAY_PORTAL'");
}
