{
  ValueMapper companyIdMapper=ValueMapperFactory.getValueMapper();
  AvailableMappersUtil.setCompanyIdMapper(companyIdMapper);
  String[] webIds=WebIdUtil.getWebIds();
  for (int i=0; i < webIds.length; i++) {
    String webId=webIds[i];
    long companyId=upgradeWebId(webId);
    companyIdMapper.mapValue(webId,new Long(companyId));
    LuceneUtil.checkLuceneDir(companyId);
    DLLocalServiceUtil.checkRootNode(companyId);
  }
  for (int i=0; i < _TABLES.length; i++) {
    String sql="alter_column_type " + _TABLES[i] + " companyId LONG";
    if (_log.isDebugEnabled()) {
      _log.debug(sql);
    }
    runSQL(sql);
  }
  runSQL("update PortletPreferences set ownerId = '0', ownerType = " + PortletKeys.PREFS_OWNER_TYPE_COMPANY + " where ownerId = 'COMPANY.LIFERAY_PORTAL'");
  runSQL("alter_column_type Account_ accountId LONG");
}
