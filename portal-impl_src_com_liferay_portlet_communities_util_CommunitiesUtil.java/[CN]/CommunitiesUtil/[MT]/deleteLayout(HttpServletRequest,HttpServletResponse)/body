{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long plid=ParamUtil.getLong(req,"plid");
  long groupId=ParamUtil.getLong(req,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(req,"privateLayout");
  long layoutId=ParamUtil.getLong(req,"layoutId");
  Layout layout=null;
  if (plid <= 0) {
    layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,layoutId);
  }
 else {
    layout=LayoutLocalServiceUtil.getLayout(plid);
    groupId=layout.getGroupId();
    privateLayout=layout.isPrivateLayout();
    layoutId=layout.getLayoutId();
  }
  Group group=layout.getGroup();
  if (group.isStagingGroup() && !GroupPermissionUtil.contains(permissionChecker,groupId,ActionKeys.MANAGE_STAGING) && !GroupPermissionUtil.contains(permissionChecker,groupId,ActionKeys.PUBLISH_STAGING)) {
    throw new PrincipalException();
  }
  if (LayoutPermissionUtil.contains(permissionChecker,groupId,privateLayout,layoutId,ActionKeys.DELETE)) {
    String[] eventClasses=StringUtil.split(PropsUtil.get(PropsUtil.LAYOUT_CONFIGURATION_ACTION_DELETE,new Filter(layout.getType())));
    EventsProcessor.process(PropsUtil.LAYOUT_CONFIGURATION_ACTION_DELETE,eventClasses,req,res);
  }
  LayoutServiceUtil.deleteLayout(groupId,privateLayout,layoutId);
}
