{
  Transactional annotation=null;
  Queue<Class<?>> candidateQueue=new LinkedList<Class<?>>();
  if (annotatedElement instanceof Method) {
    Method method=(Method)annotatedElement;
    candidateQueue.offer(method.getDeclaringClass());
    annotation=_deepSearchMethods(method,candidateQueue);
  }
 else {
    candidateQueue.offer((Class<?>)annotatedElement);
    annotation=_deepSearchTypes(candidateQueue);
  }
  if (annotation == null || !annotation.enabled()) {
    return null;
  }
  RuleBasedTransactionAttribute ruleBasedTransactionAttribute=new RuleBasedTransactionAttribute();
  int isolationLevel=annotation.isolation().value();
  if (isolationLevel == TransactionDefinition.ISOLATION_COUNTER) {
    ruleBasedTransactionAttribute.setIsolationLevel(PropsValues.TRANSACTION_ISOLATION_COUNTER);
  }
 else   if (isolationLevel == TransactionDefinition.ISOLATION_PORTAL) {
    ruleBasedTransactionAttribute.setIsolationLevel(PropsValues.TRANSACTION_ISOLATION_PORTAL);
  }
 else {
    ruleBasedTransactionAttribute.setIsolationLevel(isolationLevel);
  }
  ruleBasedTransactionAttribute.setPropagationBehavior(annotation.propagation().value());
  ruleBasedTransactionAttribute.setReadOnly(annotation.readOnly());
  ruleBasedTransactionAttribute.setTimeout(annotation.timeout());
  List<RollbackRuleAttribute> rollBackAttributes=new ArrayList<RollbackRuleAttribute>();
  Class<?>[] rollbackFor=annotation.rollbackFor();
  for (int i=0; i < rollbackFor.length; i++) {
    RollbackRuleAttribute rollbackRuleAttribute=new RollbackRuleAttribute(rollbackFor[i]);
    rollBackAttributes.add(rollbackRuleAttribute);
  }
  String[] rollbackForClassName=annotation.rollbackForClassName();
  for (int i=0; i < rollbackForClassName.length; i++) {
    RollbackRuleAttribute rollbackRuleAttribute=new RollbackRuleAttribute(rollbackForClassName[i]);
    rollBackAttributes.add(rollbackRuleAttribute);
  }
  Class<?>[] noRollbackFor=annotation.noRollbackFor();
  for (int i=0; i < noRollbackFor.length; ++i) {
    NoRollbackRuleAttribute noRollbackRuleAttribute=new NoRollbackRuleAttribute(noRollbackFor[i]);
    rollBackAttributes.add(noRollbackRuleAttribute);
  }
  String[] noRollbackForClassName=annotation.noRollbackForClassName();
  for (int i=0; i < noRollbackForClassName.length; ++i) {
    NoRollbackRuleAttribute noRollbackRuleAttribute=new NoRollbackRuleAttribute(noRollbackForClassName[i]);
    rollBackAttributes.add(noRollbackRuleAttribute);
  }
  ruleBasedTransactionAttribute.getRollbackRules().addAll(rollBackAttributes);
  return ruleBasedTransactionAttribute;
}
