{
  User user=userPersistence.findByPrimaryKey(userId);
  ddmFormValuesValidator.validate(ddmFormValues);
  validateName(nameMap);
  long dataProviderInstanceId=counterLocalService.increment();
  DDMDataProviderInstance ddmDataProviderInstance=ddmDataProviderInstancePersistence.create(dataProviderInstanceId);
  ddmDataProviderInstance.setUuid(serviceContext.getUuid());
  ddmDataProviderInstance.setGroupId(groupId);
  ddmDataProviderInstance.setCompanyId(user.getCompanyId());
  ddmDataProviderInstance.setUserId(user.getUserId());
  ddmDataProviderInstance.setUserName(user.getFullName());
  ddmDataProviderInstance.setDefinition(definition);
  ddmDataProviderInstance.setDescriptionMap(descriptionMap);
  ddmDataProviderInstance.setNameMap(nameMap);
  ddmDataProviderInstance.setType(type);
  ddmDataProviderInstancePersistence.update(ddmDataProviderInstance);
  return ddmDataProviderInstance;
}
