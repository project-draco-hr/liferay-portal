{
  HttpSession session=_mockHttpServletRequest.getSession();
  session.setAttribute(Globals.LOCALE_KEY,sessionLocale);
  if (userLocale != null) {
    User user=UserTestUtil.addUser(null,userLocale,RandomTestUtil.randomString(),RandomTestUtil.randomString(),new long[]{_group.getGroupId()});
    _mockHttpServletRequest.setAttribute(WebKeys.USER,user);
  }
  if (cookieLocale != null) {
    LanguageUtil.updateCookie(_mockHttpServletRequest,_mockHttpServletResponse,cookieLocale);
    _mockHttpServletRequest.setCookies(_mockHttpServletResponse.getCookies());
  }
  return _i18nFilter.prependI18nLanguageId(_mockHttpServletRequest,localePrependFriendlyURLStyle);
}
