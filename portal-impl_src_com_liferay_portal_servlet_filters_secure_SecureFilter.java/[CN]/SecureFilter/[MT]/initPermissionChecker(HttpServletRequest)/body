{
  if (_usePermissionChecker) {
    User user=(User)request.getSession().getAttribute(WebKeys.USER);
    PrincipalThreadLocal.setName(user.getUserId());
    PrincipalThreadLocal.setPassword(PortalUtil.getUserPassword(request));
    PermissionChecker permissionChecker=PermissionCheckerFactoryUtil.create(user);
    PermissionThreadLocal.setPermissionChecker(permissionChecker);
  }
}
