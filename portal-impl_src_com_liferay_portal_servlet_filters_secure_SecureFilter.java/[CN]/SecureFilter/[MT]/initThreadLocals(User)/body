{
  CompanyThreadLocal.setCompanyId(user.getCompanyId());
  long userId=user.getUserId();
  PrincipalThreadLocal.setName(userId);
  if (!_usePermissionChecker) {
    return;
  }
  PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
  if ((permissionChecker != null) && (permissionChecker.getUserId() == userId)) {
    return;
  }
  permissionChecker=PermissionCheckerFactoryUtil.create(user);
  PermissionThreadLocal.setPermissionChecker(permissionChecker);
}
