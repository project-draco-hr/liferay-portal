{
  HttpSession session=request.getSession();
  User user=(User)session.getAttribute(WebKeys.USER);
  CompanyThreadLocal.setCompanyId(user.getCompanyId());
  PrincipalThreadLocal.setName(user.getUserId());
  PrincipalThreadLocal.setPassword(PortalUtil.getUserPassword(request));
  if (!_usePermissionChecker) {
    return;
  }
  PermissionChecker permissionChecker=PermissionCheckerFactoryUtil.create(user);
  PermissionThreadLocal.setPermissionChecker(permissionChecker);
}
