{
  long userId=0;
  String authHeader=req.getHeader(HttpHeaders.AUTHORIZATION);
  if (Validator.isNull(authHeader)) {
    return userId;
  }
  String[] authorizationArray=authHeader.split("\\s+");
  String authorization=authorizationArray[0];
  String credentials=new String(Base64.decode(authorizationArray[1]));
  if (!authorization.equalsIgnoreCase(HttpServletRequest.BASIC_AUTH)) {
    return userId;
  }
  long companyId=PortalInstances.getCompanyId(req);
  Company company=CompanyLocalServiceUtil.getCompanyById(companyId);
  String authType=company.getAuthType();
  String[] loginAndPassword=StringUtil.split(credentials,StringPool.COLON);
  String login=loginAndPassword[0].trim();
  String password=loginAndPassword[1].trim();
  if (login.endsWith("@uid")) {
    int index=login.indexOf("@uid");
    login=login.substring(0,index);
    authType=CompanyImpl.AUTH_TYPE_ID;
  }
 else   if (login.endsWith("@sn")) {
    int index=login.indexOf("@sn");
    login=login.substring(0,index);
    authType=CompanyImpl.AUTH_TYPE_SN;
  }
  userId=UserLocalServiceUtil.authenticateForBasic(companyId,authType,login,password);
  return userId;
}
