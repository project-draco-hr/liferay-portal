{
  long userId=0;
  String authorization=req.getHeader(HttpHeaders.AUTHORIZATION);
  if (Validator.isNull(authorization)) {
    return userId;
  }
  String[] authorizationArray=authorization.split("\\s+");
  String authType=authorizationArray[0];
  String credentials=new String(Base64.decode(authorizationArray[1]));
  if (!authType.equalsIgnoreCase(HttpServletRequest.BASIC_AUTH)) {
    return userId;
  }
  long companyId=PortalInstances.getCompanyId(req);
  Company company=CompanyLocalServiceUtil.getCompanyById(companyId);
  String[] loginAndPassword=StringUtil.split(credentials,StringPool.COLON);
  String login=loginAndPassword[0].trim();
  String password=loginAndPassword[1].trim();
  userId=UserLocalServiceUtil.authenticateForBasic(companyId,company.getAuthType(),login,password);
  return userId;
}
