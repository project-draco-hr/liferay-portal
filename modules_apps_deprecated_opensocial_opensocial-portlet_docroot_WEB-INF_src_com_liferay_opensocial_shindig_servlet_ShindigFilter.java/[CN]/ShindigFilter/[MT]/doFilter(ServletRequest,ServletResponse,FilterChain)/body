{
  HttpServletRequest request=(HttpServletRequest)servletRequest;
  if (injector == null) {
    HttpSession session=request.getSession();
    _init(session.getServletContext());
  }
  PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
  if (permissionChecker == null) {
    setPermissionChecker(servletRequest);
  }
  ShindigUtil.setScheme(servletRequest.getScheme());
  String serverName=servletRequest.getServerName();
  String host=serverName.concat(StringPool.COLON).concat(String.valueOf(servletRequest.getServerPort()));
  ShindigUtil.setHost(host);
  HttpServletRequestThreadLocal.setHttpServletRequest(request);
  try {
    filterChain.doFilter(servletRequest,servletResponse);
  }
  finally {
    HttpServletRequestThreadLocal.setHttpServletRequest(null);
  }
}
