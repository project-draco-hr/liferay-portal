{
  ServletRequestWrapper previousRequestWrapper=null;
  ServletRequest currentRequest=request;
  while (currentRequest != null) {
    if (!(currentRequest instanceof ServletRequestWrapper)) {
      break;
    }
    String currentRequestClassName=currentRequest.getClass().getName();
    if (_injectStopperClassNames.contains(currentRequestClassName)) {
      break;
    }
    previousRequestWrapper=(ServletRequestWrapper)currentRequest;
    ServletRequestWrapper servletRequestWrapper=(ServletRequestWrapper)currentRequest;
    currentRequest=servletRequestWrapper.getRequest();
  }
  ServletRequestWrapper servletRequestWrapper=null;
  if (currentRequest instanceof HttpServletRequest) {
    servletRequestWrapper=new ThreadLocalFacadeHttpServletRequestWrapper(previousRequestWrapper,(HttpServletRequest)currentRequest);
  }
 else {
    servletRequestWrapper=new ThreadLocalFacadeServletRequestWrapper(previousRequestWrapper,currentRequest);
  }
  if (previousRequestWrapper != null) {
    previousRequestWrapper.setRequest(servletRequestWrapper);
  }
 else {
    request=(T)servletRequestWrapper;
  }
  Closeable closeable=(Closeable)servletRequestWrapper;
  return new ObjectValuePair<T,Closeable>(request,closeable);
}
