{
  try {
    DLFileEntry dlFileEntry=_dlFileVersion.getFileEntry();
    _dlFileEntryMetadata=_dlFileEntryMetadataLocalService.createDLFileEntryMetadata(CounterLocalServiceUtil.increment());
    long ddmStructureId=_ddmStructure.getStructureId();
    Fields fields=new Fields();
    fields.put(new Field(ddmStructureId,GoogleDocsConstants.DDM_FIELD_NAME_DESCRIPTION,""));
    fields.put(new Field(ddmStructureId,GoogleDocsConstants.DDM_FIELD_NAME_EMBEDDABLE_URL,""));
    fields.put(new Field(ddmStructureId,GoogleDocsConstants.DDM_FIELD_NAME_ICON_URL,""));
    fields.put(new Field(ddmStructureId,GoogleDocsConstants.DDM_FIELD_NAME_ID,""));
    fields.put(new Field(ddmStructureId,GoogleDocsConstants.DDM_FIELD_NAME_NAME,""));
    fields.put(new Field(ddmStructureId,GoogleDocsConstants.DDM_FIELD_NAME_URL,""));
    ServiceContext serviceContext=new ServiceContext();
    serviceContext.setScopeGroupId(_dlFileVersion.getGroupId());
    serviceContext.setUserId(_dlFileVersion.getUserId());
    DDMFormValues ddmFormValues=toDDMFormValues(fields);
    long ddmStorageId=_storageEngine.create(_dlFileVersion.getCompanyId(),ddmStructureId,ddmFormValues,serviceContext);
    _dlFileEntryMetadata.setDDMStorageId(ddmStorageId);
    _dlFileEntryMetadata.setDDMStructureId(ddmStructureId);
    _dlFileEntryMetadata.setFileEntryId(dlFileEntry.getFileEntryId());
    _dlFileEntryMetadata.setFileVersionId(_dlFileVersion.getFileVersionId());
    _dlFileEntryMetadata=_dlFileEntryMetadataLocalService.addDLFileEntryMetadata(_dlFileEntryMetadata);
  }
 catch (  PortalException pe) {
    throw new SystemException("Unable to add DDM fields for file version " + _dlFileVersion.getFileVersionId(),pe);
  }
}
