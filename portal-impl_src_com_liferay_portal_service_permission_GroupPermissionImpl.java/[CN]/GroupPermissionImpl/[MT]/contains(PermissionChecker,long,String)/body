{
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  if (group.isStagingGroup()) {
    group=group.getLiveGroup();
  }
  if (group.isOrganization()) {
    long organizationId=group.getOrganizationId();
    return OrganizationPermissionUtil.contains(permissionChecker,organizationId,actionId);
  }
 else   if (group.isUser()) {
    long userId=group.getClassPK();
    List<Organization> organizations=OrganizationLocalServiceUtil.getUserOrganizations(userId);
    for (    Organization organization : organizations) {
      if (OrganizationPermissionUtil.contains(permissionChecker,organization.getOrganizationId(),ActionKeys.MANAGE_USERS)) {
        return true;
      }
    }
  }
  if (ActionKeys.ADD_LAYOUT.equals(actionId)) {
    LayoutSet layoutSet=LayoutSetLocalServiceUtil.getLayoutSet(groupId,false);
    if (layoutSet.isLayoutSetPrototypeLinkEnabled()) {
      LayoutSetPrototype layoutSetPrototype=LayoutSetPrototypeLocalServiceUtil.getLayoutSetPrototypeByUuid(layoutSet.getLayoutSetPrototypeUuid());
      String allowLayoutAdditions=layoutSetPrototype.getSettingsProperty("allowLayoutAdditions");
      if (allowLayoutAdditions != null && !GetterUtil.getBoolean(allowLayoutAdditions)) {
        return false;
      }
    }
    return permissionChecker.hasPermission(groupId,Group.class.getName(),groupId,ActionKeys.MANAGE_LAYOUTS);
  }
 else {
    return permissionChecker.hasPermission(groupId,Group.class.getName(),groupId,actionId);
  }
}
