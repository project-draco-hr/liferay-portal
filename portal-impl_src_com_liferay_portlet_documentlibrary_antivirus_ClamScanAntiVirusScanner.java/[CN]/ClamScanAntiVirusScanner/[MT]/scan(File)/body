{
  Runtime runtime=Runtime.getRuntime();
  String filePath=file.getAbsolutePath();
  String[] parameters=new String[]{"clamscan","--stdout","--no-summary",filePath};
  Process process=null;
  try {
    process=runtime.exec(parameters);
    InputStream inputStream=process.getInputStream();
    String scanResult=StringUtil.read(inputStream);
    process.waitFor();
    int exitValue=process.exitValue();
    if (exitValue != 0) {
      throw new SystemException("Unable to scan file due to inability to " + "execute antivirus process");
    }
    if (scanResult.contains("FOUND")) {
      throw new AntiVirusScannerException("Virus detected in " + filePath);
    }
  }
 catch (  IOException ie) {
    throw new SystemException("Unable to scan file",ie);
  }
catch (  InterruptedException ie) {
    throw new SystemException("Unable to scan file",ie);
  }
 finally {
    if (process != null) {
      process.destroy();
    }
  }
}
