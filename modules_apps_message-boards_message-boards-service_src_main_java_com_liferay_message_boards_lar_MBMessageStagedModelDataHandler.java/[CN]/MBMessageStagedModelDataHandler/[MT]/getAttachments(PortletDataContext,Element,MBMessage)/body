{
  boolean hasAttachmentsFileEntries=GetterUtil.getBoolean(messageElement.attributeValue("hasAttachmentsFileEntries"));
  if (!hasAttachmentsFileEntries) {
    return Collections.emptyList();
  }
  List<ObjectValuePair<String,InputStream>> inputStreamOVPs=new ArrayList<>();
  List<Element> attachmentElements=portletDataContext.getReferenceDataElements(messageElement,DLFileEntry.class,PortletDataContext.REFERENCE_TYPE_WEAK);
  for (  Element attachmentElement : attachmentElements) {
    String path=attachmentElement.attributeValue("path");
    FileEntry fileEntry=(FileEntry)portletDataContext.getZipEntryAsObject(path);
    InputStream inputStream=null;
    String binPath=attachmentElement.attributeValue("bin-path");
    if (Validator.isNull(binPath) && portletDataContext.isPerformDirectBinaryImport()) {
      try {
        inputStream=FileEntryUtil.getContentStream(fileEntry);
      }
 catch (      Exception e) {
      }
    }
 else {
      inputStream=portletDataContext.getZipEntryAsInputStream(binPath);
    }
    if (inputStream == null) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to import attachment for file entry " + fileEntry.getFileEntryId());
      }
      continue;
    }
    ObjectValuePair<String,InputStream> inputStreamOVP=new ObjectValuePair<>(fileEntry.getTitle(),inputStream);
    inputStreamOVPs.add(inputStreamOVP);
  }
  if (inputStreamOVPs.isEmpty()) {
    _log.error("Could not find attachments for message " + message.getMessageId());
  }
  return inputStreamOVPs;
}
