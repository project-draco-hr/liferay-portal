{
  long userId=portletDataContext.getUserId(message.getUserUuid());
  MBMessage existingMessage=fetchStagedModelByUuidAndGroupId(message.getUuid(),portletDataContext.getScopeGroupId());
  if (existingMessage == null) {
    return;
  }
  if (existingMessage.isInTrash()) {
    TrashHandler trashHandler=existingMessage.getTrashHandler();
    if (trashHandler.isRestorable(existingMessage.getMessageId())) {
      trashHandler.restoreTrashEntry(userId,existingMessage.getMessageId());
    }
  }
  if (existingMessage.isInTrashContainer()) {
    MBThread existingThread=existingMessage.getThread();
    TrashHandler trashHandler=existingThread.getTrashHandler();
    if (trashHandler.isRestorable(existingThread.getThreadId())) {
      trashHandler.restoreTrashEntry(userId,existingThread.getThreadId());
    }
  }
}
