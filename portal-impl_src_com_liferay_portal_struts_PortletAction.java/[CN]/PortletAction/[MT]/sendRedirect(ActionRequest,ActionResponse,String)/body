{
  if (SessionErrors.isEmpty(actionRequest)) {
    ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
    LayoutTypePortlet layoutTypePortlet=themeDisplay.getLayoutTypePortlet();
    boolean hasPortletId=false;
    String portletId=(String)actionRequest.getAttribute(WebKeys.PORTLET_ID);
    try {
      hasPortletId=layoutTypePortlet.hasPortletId(portletId);
    }
 catch (    Exception e) {
    }
    Portlet portlet=PortletLocalServiceUtil.getPortletById(portletId);
    if (hasPortletId || portlet.isAddDefaultResource()) {
      addSuccessMessage(actionRequest,actionResponse);
    }
  }
  if (Validator.isNull(redirect)) {
    redirect=(String)actionRequest.getAttribute(WebKeys.REDIRECT);
  }
  if (Validator.isNull(redirect)) {
    redirect=ParamUtil.getString(actionRequest,"redirect");
  }
  if (Validator.isNotNull(redirect)) {
    HttpServletRequest request=PortalUtil.getHttpServletRequest(actionRequest);
    if ((BrowserSnifferUtil.isIe(request)) && (BrowserSnifferUtil.getMajorVersion(request) == 6.0) && (redirect.contains(StringPool.POUND))) {
      String redirectToken="&#";
      if (!redirect.contains(StringPool.QUESTION)) {
        redirectToken=StringPool.QUESTION + redirectToken;
      }
      redirect=StringUtil.replace(redirect,StringPool.POUND,redirectToken);
    }
    redirect=PortalUtil.escapeRedirect(redirect);
    if (Validator.isNotNull(redirect)) {
      actionResponse.sendRedirect(redirect);
    }
  }
}
