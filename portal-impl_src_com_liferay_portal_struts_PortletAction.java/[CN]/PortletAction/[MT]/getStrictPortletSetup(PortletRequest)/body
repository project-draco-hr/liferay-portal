{
  String portletResource=ParamUtil.getString(portletRequest,"portletResource");
  if (Validator.isNull(portletResource)) {
    return null;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.getStrictPortletSetup(themeDisplay.getLayout(),portletResource);
  if (portletPreferences instanceof StrictPortletPreferencesImpl) {
    throw new PrincipalException();
  }
  return portletPreferences;
}
