{
  URLConnection urlConnection=url.openConnection();
  String fileName=url.getFile();
  if (urlConnection instanceof JarURLConnection) {
    JarURLConnection jarURLConnection=(JarURLConnection)urlConnection;
    URL jarFileURL=jarURLConnection.getJarFileURL();
    fileName=jarFileURL.getFile();
  }
 else   if ("wsjar".equals(url.getProtocol())) {
    fileName=url.getFile();
    String protocol="file:/";
    int index=fileName.indexOf(protocol);
    if (index > -1) {
      fileName=fileName.substring(protocol.length());
    }
    index=fileName.indexOf('!');
    if (index > -1) {
      fileName=fileName.substring(0,index);
    }
    fileName=decodePath(fileName);
  }
 else   if ("zip".equals(url.getProtocol())) {
    fileName=url.getFile();
    int index=fileName.indexOf('!');
    if (index > 0) {
      fileName=fileName.substring(0,index);
    }
  }
 else   if ("vfs".equals(url.getProtocol())) {
    fileName=url.getFile();
    int index=fileName.indexOf(".jar");
    if (index > 0) {
      fileName=fileName.substring(0,index + 4);
    }
  }
  return new JarFile(fileName);
}
