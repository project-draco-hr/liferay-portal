{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getConnection();
    StringBuilder sb=new StringBuilder();
    sb.append("SELECT * FROM Permission_ p, Resource_ r, ");
    sb.append("ResourceCode rc WHERE (");
    for (int i=0; i < actionIds.length; i++) {
      String actionId=actionIds[i];
      sb.append("actionId = '");
      sb.append(actionId);
      sb.append("'");
      if (i < (actionIds.length - 1)) {
        sb.append(" OR ");
      }
    }
    sb.append(") AND p.resourceId = r.resourceId AND ");
    sb.append("r.codeId = rc.codeId AND rc.name = ? and rc.scope = 4");
    ps=con.prepareStatement(sb.toString());
    ps.setString(1,portletName);
    rs=ps.executeQuery();
    while (rs.next()) {
      long permissionId=rs.getLong("p.permissionId");
      String primKey=rs.getString("r.primKey");
      String actionId=rs.getString("p.actionId");
      long companyId=rs.getLong("rc.companyId");
      int scope=rs.getInt("rc.scope");
      long plid=GetterUtil.getLong(primKey.substring(0,primKey.indexOf("_LAYOUT_")));
      Layout layout=LayoutLocalServiceUtil.getLayout(plid);
      String resourcePrimKey=String.valueOf(layout.getGroupId());
      Resource resource=ResourceLocalServiceUtil.addResource(companyId,modelName,scope,resourcePrimKey);
      int portletPermissionCount=getPortletPermissionsCount(actionId,resource.getResourceId(),modelName);
      if (portletPermissionCount == 0) {
        Permission permission=PermissionLocalServiceUtil.getPermission(permissionId);
        permission.setResourceId(resource.getResourceId());
        PermissionLocalServiceUtil.updatePermission(permission);
      }
 else {
        PermissionLocalServiceUtil.deletePermission(permissionId);
      }
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
