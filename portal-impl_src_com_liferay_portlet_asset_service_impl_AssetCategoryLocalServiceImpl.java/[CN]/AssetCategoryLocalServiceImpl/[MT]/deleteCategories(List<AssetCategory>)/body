{
  List<Long> rebuildTreeGroupIds=new ArrayList<>();
  for (  AssetCategory category : categories) {
    if (!rebuildTreeGroupIds.contains(category.getGroupId()) && (getChildCategoriesCount(category.getCategoryId()) > 0)) {
      final long groupId=category.getGroupId();
      TransactionCommitCallbackUtil.registerCallback(new Callable<Void>(){
        @Override public Void call() throws Exception {
          assetCategoryLocalService.rebuildTree(groupId,true);
          return null;
        }
      }
);
      rebuildTreeGroupIds.add(groupId);
    }
    assetCategoryLocalService.deleteCategory(category,true);
  }
}
