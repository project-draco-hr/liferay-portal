{
  User user=userPersistence.findByPrimaryKey(userId);
  DDLRecord record=ddlRecordPersistence.findByPrimaryKey(recordId);
  record.setModifiedDate(serviceContext.getModifiedDate(null));
  ddlRecordPersistence.update(record);
  DDLRecordVersion recordVersion=record.getLatestRecordVersion();
  DDLRecordSet recordSet=record.getRecordSet();
  long ddmStorageId=StorageEngineUtil.create(recordSet.getCompanyId(),recordSet.getDDMStructureId(),fields,serviceContext);
  String version=getNextVersion(recordVersion.getVersion(),true,serviceContext.getWorkflowAction());
  recordVersion=addRecordVersion(user,record,ddmStorageId,version,displayIndex,WorkflowConstants.STATUS_DRAFT);
  WorkflowHandlerRegistryUtil.startWorkflowInstance(user.getCompanyId(),record.getGroupId(),userId,DDLRecord.class.getName(),recordVersion.getRecordVersionId(),recordVersion,serviceContext);
  return record;
}
