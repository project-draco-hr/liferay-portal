{
  DDMForm ddmForm=new DDMForm();
  ddmForm.addAvailableLocale(LocaleUtil.US);
  ddmForm.addDDMFormField(DDMFormTestUtil.createTextDDMFormField("link",false,false,false));
  ddmForm.addDDMFormField(DDMFormTestUtil.createTextDDMFormField("name",false,false,false));
  ddmForm.setDefaultLocale(LocaleUtil.US);
  _ddmStructure=DDMStructureTestUtil.addStructure(JournalArticle.class.getName(),ddmForm);
  String xsl="$name.getData()";
  _ddmTemplate=DDMTemplateTestUtil.addTemplate(_ddmStructure.getStructureId(),PortalUtil.getClassNameId(JournalArticle.class),TemplateConstants.LANG_TYPE_VM,xsl);
  String xml=DDMStructureTestUtil.getSampleStructuredContent("Joe Bloggs");
  _article=JournalTestUtil.addArticleWithXMLContent(xml,_ddmStructure.getStructureKey(),_ddmTemplate.getTemplateKey());
  Map<String,String> tokens=getTokens();
  String content=JournalUtil.transform(null,tokens,Constants.VIEW,"en_US",UnsecureSAXReaderUtil.read(xml),null,xsl,TemplateConstants.LANG_TYPE_VM);
  Assert.assertEquals("Joe Bloggs",content);
  Document document=UnsecureSAXReaderUtil.read(xml);
  Element element=(Element)document.selectSingleNode("//dynamic-content");
  element.setText("[@" + _article.getArticleId() + ";name@]");
  content=JournalUtil.transform(null,tokens,Constants.VIEW,"en_US",document,null,xsl,TemplateConstants.LANG_TYPE_VM);
  Assert.assertEquals("Joe Bloggs",content);
}
