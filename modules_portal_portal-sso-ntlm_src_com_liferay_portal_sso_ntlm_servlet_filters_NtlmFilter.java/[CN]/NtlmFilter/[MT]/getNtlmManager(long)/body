{
  String domain=PrefsPropsUtil.getString(companyId,PropsKeys.NTLM_DOMAIN,_ntlmConfiguration.domain());
  String domainController=PrefsPropsUtil.getString(companyId,PropsKeys.NTLM_DOMAIN_CONTROLLER,_ntlmConfiguration.domainController());
  String domainControllerName=PrefsPropsUtil.getString(companyId,PropsKeys.NTLM_DOMAIN_CONTROLLER_NAME,_ntlmConfiguration.domainControllerName());
  String serviceAccount=PrefsPropsUtil.getString(companyId,PropsKeys.NTLM_SERVICE_ACCOUNT,_ntlmConfiguration.serviceAccount());
  String servicePassword=PrefsPropsUtil.getString(companyId,PropsKeys.NTLM_SERVICE_PASSWORD,_ntlmConfiguration.servicePassword());
  NtlmManager ntlmManager=_ntlmManagers.get(companyId);
  if (ntlmManager == null) {
    ntlmManager=new NtlmManager(domain,domainController,domainControllerName,serviceAccount,servicePassword);
    _ntlmManagers.put(companyId,ntlmManager);
  }
 else {
    if (!Validator.equals(ntlmManager.getDomain(),domain) || !Validator.equals(ntlmManager.getDomainController(),domainController) || !Validator.equals(ntlmManager.getDomainControllerName(),domainControllerName)|| !Validator.equals(ntlmManager.getServiceAccount(),serviceAccount)|| !Validator.equals(ntlmManager.getServicePassword(),servicePassword)) {
      ntlmManager.setConfiguration(domain,domainController,domainControllerName,serviceAccount,servicePassword);
    }
  }
  return ntlmManager;
}
