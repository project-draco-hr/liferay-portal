{
  NtlmConfiguration ntlmConfiguration=_settingsFactory.getSettings(NtlmConfiguration.class,new CompanyServiceSettingsLocator(companyId,NtlmConstants.SERVICE_NAME));
  String domain=ntlmConfiguration.domain();
  String domainController=ntlmConfiguration.domainController();
  String domainControllerName=ntlmConfiguration.domainControllerName();
  String serviceAccount=ntlmConfiguration.serviceAccount();
  String servicePassword=ntlmConfiguration.servicePassword();
  NtlmManager ntlmManager=_ntlmManagers.get(companyId);
  if (ntlmManager == null) {
    ntlmManager=new NtlmManager(_netlogonConnectionManager,domain,domainController,domainControllerName,serviceAccount,servicePassword);
    _ntlmManagers.put(companyId,ntlmManager);
  }
 else {
    if (!Validator.equals(ntlmManager.getDomain(),domain) || !Validator.equals(ntlmManager.getDomainController(),domainController) || !Validator.equals(ntlmManager.getDomainControllerName(),domainControllerName)|| !Validator.equals(ntlmManager.getServiceAccount(),serviceAccount)|| !Validator.equals(ntlmManager.getServicePassword(),servicePassword)) {
      ntlmManager.setConfiguration(domain,domainController,domainControllerName,serviceAccount,servicePassword);
    }
  }
  return ntlmManager;
}
