{
  Map<Long,String[]> roleIdsToActionIds=new HashMap<>();
  List<Element> roleElements=permissionsElement.elements("role");
  for (  Element roleElement : roleElements) {
    Role role=checkRole(layoutCache,companyId,groupId,userId,roleElement);
    if (role == null) {
      continue;
    }
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    if (!group.isLayoutPrototype() && !group.isLayoutSetPrototype() && layout.isPrivateLayout()) {
      String roleName=role.getName();
      if (roleName.equals(RoleConstants.GUEST)) {
        continue;
      }
    }
    List<String> actions=getActions(roleElement);
    roleIdsToActionIds.put(role.getRoleId(),actions.toArray(new String[actions.size()]));
  }
  if (roleIdsToActionIds.isEmpty()) {
    return;
  }
  ResourcePermissionLocalServiceUtil.setResourcePermissions(companyId,resourceName,ResourceConstants.SCOPE_INDIVIDUAL,resourcePrimKey,roleIdsToActionIds);
}
