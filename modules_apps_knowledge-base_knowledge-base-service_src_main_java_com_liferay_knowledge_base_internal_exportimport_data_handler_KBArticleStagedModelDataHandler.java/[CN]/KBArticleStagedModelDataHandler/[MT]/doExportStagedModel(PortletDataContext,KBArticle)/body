{
  if (kbArticle.getParentResourcePrimKey() != KBFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    long kbArticleClassNameId=_portal.getClassNameId(KBArticleConstants.getClassName());
    if (kbArticle.getParentResourceClassNameId() == kbArticleClassNameId) {
      KBArticle parentKBArticle=_kbArticleLocalService.getLatestKBArticle(kbArticle.getParentResourcePrimKey(),WorkflowConstants.STATUS_APPROVED);
      StagedModelDataHandlerUtil.exportReferenceStagedModel(portletDataContext,kbArticle,parentKBArticle,PortletDataContext.REFERENCE_TYPE_PARENT);
    }
 else {
      KBFolder parentKBFolder=_kbFolderLocalService.getKBFolder(kbArticle.getParentResourcePrimKey());
      StagedModelDataHandlerUtil.exportReferenceStagedModel(portletDataContext,kbArticle,parentKBFolder,PortletDataContext.REFERENCE_TYPE_PARENT);
    }
  }
  Element kbArticleElement=portletDataContext.getExportDataElement(kbArticle);
  exportKBArticleAttachments(portletDataContext,kbArticleElement,kbArticle);
  String content=_exportImportContentProcessorController.replaceExportContentReferences(portletDataContext,kbArticle,kbArticle.getContent(),true,true);
  kbArticle.setContent(content);
  portletDataContext.addClassedModel(kbArticleElement,ExportImportPathUtil.getModelPath(kbArticle),kbArticle);
}
