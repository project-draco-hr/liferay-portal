{
  long ruleGroupId=ParamUtil.getLong(actionRequest,MDRPortletConstants.MDR_RULE_GROUP_ID);
  Map<Locale,String> nameMap=LocalizationUtil.getLocalizationMap(actionRequest,MDRPortletConstants.NAME);
  Map<Locale,String> descriptionMap=LocalizationUtil.getLocalizationMap(actionRequest,MDRPortletConstants.DESCRIPTION);
  String type=ParamUtil.getString(actionRequest,MDRPortletConstants.TYPE);
  RuleHandler ruleHandler=RuleGroupProcessorUtil.getRuleHandler(type);
  if (ruleHandler == null) {
    throw new UnknownRuleHandlerException(type);
  }
  UnicodeProperties typeSettings=getTypeSettings(actionRequest,ruleHandler);
  ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
  if (add) {
    MDRRuleServiceUtil.addRule(ruleGroupId,nameMap,descriptionMap,type,typeSettings,serviceContext);
  }
 else {
    long ruleId=ParamUtil.getLong(actionRequest,MDRPortletConstants.MDR_RULE_ID);
    MDRRuleServiceUtil.updateRule(ruleId,nameMap,descriptionMap,type,typeSettings,serviceContext);
  }
}
