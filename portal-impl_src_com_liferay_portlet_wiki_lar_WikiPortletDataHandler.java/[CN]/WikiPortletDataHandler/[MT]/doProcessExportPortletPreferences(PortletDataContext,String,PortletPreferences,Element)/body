{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(portletId);
  String hiddenNodeNames=portletPreferences.getValue("hiddenNodes",null);
  rootElement.addAttribute("hidden-node-names",hiddenNodeNames);
  for (  String hiddenNodeName : StringUtil.split(hiddenNodeNames)) {
    WikiNode wikiNode=WikiNodeLocalServiceUtil.getNode(portletDataContext.getScopeGroupId(),hiddenNodeName);
    portletDataContext.addReferenceElement(portlet,rootElement,wikiNode,WikiNode.class,PortletDataContext.REFERENCE_TYPE_DEPENDENCY,!portletDataContext.getBooleanParameter(NAMESPACE,"wiki-pages"));
  }
  String visibleNodeNames=portletPreferences.getValue("visibleNodes",null);
  rootElement.addAttribute("visible-node-names",visibleNodeNames);
  for (  String visibleNodeName : StringUtil.split(visibleNodeNames)) {
    WikiNode wikiNode=WikiNodeLocalServiceUtil.getNode(portletDataContext.getScopeGroupId(),visibleNodeName);
    portletDataContext.addReferenceElement(portlet,rootElement,wikiNode,WikiNode.class,PortletDataContext.REFERENCE_TYPE_DEPENDENCY,!portletDataContext.getBooleanParameter(NAMESPACE,"wiki-pages"));
  }
  return portletPreferences;
}
