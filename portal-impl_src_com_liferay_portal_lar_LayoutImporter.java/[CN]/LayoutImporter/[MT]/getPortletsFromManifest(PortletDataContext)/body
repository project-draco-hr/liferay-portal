{
  String xml=portletDataContext.getZipEntryAsString("/manifest.xml");
  if (xml == null) {
    throw new LARFileException("manifest.xml not found in the LAR");
  }
  Element rootElement=null;
  Element headerElement=null;
  try {
    Document document=SAXReaderUtil.read(xml);
    rootElement=document.getRootElement();
    headerElement=rootElement.element("header");
    portletDataContext.setImportDataRootElement(rootElement);
  }
 catch (  Exception e) {
    throw new LARFileException(e);
  }
  long companyId=GetterUtil.getLong(headerElement.attributeValue("company-id"));
  List<Portlet> dataPortlets=new ArrayList<Portlet>();
  List<Portlet> setupPortlets=new ArrayList<Portlet>();
  Element portletsElement=rootElement.element("portlets");
  List<Element> portletElements=portletsElement.elements("portlet");
  for (  Element portletElement : portletElements) {
    String portletId=portletElement.attributeValue("portlet-id");
    boolean data=GetterUtil.getBoolean(portletElement.attributeValue("portlet-data"));
    boolean setup=GetterUtil.getBoolean(portletElement.attributeValue("portlet-setup"));
    try {
      Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletId);
      PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
      if (setup && !setupPortlets.contains(portlet) && (portletDataHandler != null)) {
        setupPortlets.add(portlet);
      }
      if (data && !dataPortlets.contains(portlet) && (portletDataHandler != null)) {
        dataPortlets.add(portlet);
      }
    }
 catch (    SystemException se) {
    }
  }
  return new Tuple(setupPortlets,dataPortlets);
}
