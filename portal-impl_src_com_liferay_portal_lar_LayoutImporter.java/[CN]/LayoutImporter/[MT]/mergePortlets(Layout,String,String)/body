{
  try {
    UnicodeProperties previousProps=layout.getTypeSettingsProperties();
    LayoutTypePortlet previousLayoutType=(LayoutTypePortlet)layout.getLayoutType();
    List<String> previousColumns=previousLayoutType.getLayoutTemplate().getColumns();
    UnicodeProperties newProps=new UnicodeProperties(true);
    newProps.load(newTypeSettings);
    String layoutTemplateId=newProps.getProperty(LayoutTypePortletImpl.LAYOUT_TEMPLATE_ID);
    LayoutTemplate newLayoutTemplate=LayoutTemplateLocalServiceUtil.getLayoutTemplate(layoutTemplateId,false,null);
    String[] lostPortletIds=new String[0];
    for (    String columnId : newLayoutTemplate.getColumns()) {
      String columnValue=newProps.getProperty(columnId);
      String[] portletIds=StringUtil.split(columnValue);
      if (!previousColumns.contains(columnId)) {
        lostPortletIds=ArrayUtil.append(lostPortletIds,portletIds);
      }
 else {
        String[] previousPortletIds=StringUtil.split(previousProps.getProperty(columnId));
        portletIds=appendPortletIds(previousPortletIds,portletIds,portletsMergeMode);
        previousProps.setProperty(columnId,StringUtil.merge(portletIds));
      }
    }
    String columnId=previousColumns.get(0);
    String[] portletIds=StringUtil.split(previousProps.getProperty(columnId));
    appendPortletIds(portletIds,lostPortletIds,portletsMergeMode);
    previousProps.setProperty(columnId,StringUtil.merge(portletIds));
    layout.setTypeSettings(previousProps.toString());
  }
 catch (  IOException e) {
    layout.setTypeSettings(newTypeSettings);
  }
}
