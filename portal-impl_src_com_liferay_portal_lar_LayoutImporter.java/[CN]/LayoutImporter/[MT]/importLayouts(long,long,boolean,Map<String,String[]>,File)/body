{
  PortletDataContext portletDataContext=null;
  try {
    ExportImportThreadLocal.setLayoutImportInProcess(true);
    portletDataContext=getPortletDataContext(userId,groupId,privateLayout,parameterMap,file);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_LAYOUT_IMPORT_STARTED,PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext));
    doImportLayouts(portletDataContext,userId);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_LAYOUT_IMPORT_SUCCEEDED,PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext),userId);
  }
 catch (  Throwable t) {
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_LAYOUT_IMPORT_FAILED,PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext),t);
    throw t;
  }
 finally {
    ExportImportThreadLocal.setLayoutImportInProcess(false);
    CacheUtil.clearCache();
    JournalContentUtil.clearCache();
    PermissionCacheUtil.clearCache();
  }
}
