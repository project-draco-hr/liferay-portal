{
  try {
    ExportImportThreadLocal.setLayoutValidationInProcess(true);
    LayoutSet layoutSet=LayoutSetLocalServiceUtil.getLayoutSet(groupId,privateLayout);
    ZipReader zipReader=ZipReaderFactoryUtil.getZipReader(file);
    PortletDataContext portletDataContext=PortletDataContextFactoryUtil.createImportPortletDataContext(layoutSet.getCompanyId(),groupId,parameterMap,null,zipReader);
    validateFile(portletDataContext);
    MissingReferences missingReferences=ExportImportHelperUtil.validateMissingReferences(userId,groupId,parameterMap,file);
    Map<String,MissingReference> dependencyMissingReferences=missingReferences.getDependencyMissingReferences();
    if (!dependencyMissingReferences.isEmpty()) {
      throw new MissingReferenceException(missingReferences);
    }
    return missingReferences;
  }
  finally {
    ExportImportThreadLocal.setLayoutValidationInProcess(false);
  }
}
