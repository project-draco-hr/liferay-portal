{
  try {
    filterChain.doFilter(servletRequest,servletResponse);
  }
  finally {
    PortletRequest portletRequest=(PortletRequest)servletRequest.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
    if (portletRequest == null) {
      return;
    }
    RestrictPortletServletRequest restrictPortletServletRequest=new RestrictPortletServletRequest(PortalUtil.getHttpServletRequest(portletRequest));
    Enumeration<String> enumeration=servletRequest.getAttributeNames();
    while (enumeration.hasMoreElements()) {
      String name=enumeration.nextElement();
      if (!RestrictPortletServletRequest.isSharedRequestAttribute(name)) {
        continue;
      }
      restrictPortletServletRequest.setAttribute(name,servletRequest.getAttribute(name));
    }
    restrictPortletServletRequest.mergeSharedAttributes();
  }
}
