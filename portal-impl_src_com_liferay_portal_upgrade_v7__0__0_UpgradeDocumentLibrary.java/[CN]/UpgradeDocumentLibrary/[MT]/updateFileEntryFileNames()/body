{
  try (LoggingTimer loggingTimer=new LoggingTimer()){
    runSQL("alter table DLFileEntry add fileName VARCHAR(255) null");
    try (PreparedStatement ps1=connection.prepareStatement("select fileEntryId, groupId, folderId, extension, title," + " version from DLFileEntry");PreparedStatement ps2=AutoBatchPreparedStatementUtil.concurrentAutoBatch(connection,"update DLFileEntry set fileName = ? where " + "fileEntryId = ?");PreparedStatement ps3=AutoBatchPreparedStatementUtil.concurrentAutoBatch(connection,"update DLFileEntry set title = ? where fileEntryId " + "= ?");PreparedStatement ps4=AutoBatchPreparedStatementUtil.concurrentAutoBatch(connection,"update DLFileVersion set title = ? where " + "fileEntryId = " + "? and version = ?");ResultSet rs=ps1.executeQuery()){
      while (rs.next()) {
        long fileEntryId=rs.getLong("fileEntryId");
        long groupId=rs.getLong("groupId");
        long folderId=rs.getLong("folderId");
        String extension=GetterUtil.getString(rs.getString("extension"));
        String title=GetterUtil.getString(rs.getString("title"));
        String version=rs.getString("version");
        String uniqueFileName=DLUtil.getSanitizedFileName(title,extension);
        String titleExtension=StringPool.BLANK;
        String titleWithoutExtension=title;
        if (title.endsWith(StringPool.PERIOD + extension)) {
          titleExtension=extension;
          titleWithoutExtension=FileUtil.stripExtension(title);
        }
        String uniqueTitle=StringPool.BLANK;
        for (int i=1; ; i++) {
          if (!hasFileEntry(groupId,folderId,uniqueFileName)) {
            break;
          }
          uniqueTitle=titleWithoutExtension + StringPool.UNDERLINE + String.valueOf(i);
          if (Validator.isNotNull(titleExtension)) {
            uniqueTitle+=StringPool.PERIOD.concat(titleExtension);
          }
          uniqueFileName=DLUtil.getSanitizedFileName(uniqueTitle,extension);
        }
        ps2.setString(1,uniqueFileName);
        ps2.setLong(2,fileEntryId);
        ps2.addBatch();
        if (Validator.isNotNull(uniqueTitle)) {
          ps3.setString(1,uniqueTitle);
          ps3.setLong(2,fileEntryId);
          ps3.addBatch();
          ps4.setString(1,uniqueTitle);
          ps4.setLong(2,fileEntryId);
          ps4.setString(3,version);
          ps4.addBatch();
        }
      }
      ps2.executeBatch();
      ps3.executeBatch();
      ps4.executeBatch();
    }
   }
 }
