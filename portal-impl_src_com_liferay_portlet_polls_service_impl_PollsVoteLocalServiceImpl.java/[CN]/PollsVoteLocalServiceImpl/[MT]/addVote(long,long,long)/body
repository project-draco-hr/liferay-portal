{
  Date now=new Date();
  PollsChoice choice=PollsChoiceUtil.findByPrimaryKey(choiceId);
  if (choice.getQuestionId() != questionId) {
    throw new NoSuchQuestionException();
  }
  PollsQuestion question=PollsQuestionUtil.findByPrimaryKey(questionId);
  if (question.isExpired()) {
    throw new QuestionExpiredException();
  }
  question.setLastVoteDate(now);
  PollsQuestionUtil.update(question);
  PollsVote vote=PollsVoteUtil.fetchByQ_U(questionId,userId);
  if (vote != null) {
    throw new DuplicateVoteException();
  }
 else {
    long voteId=CounterLocalServiceUtil.increment();
    vote=PollsVoteUtil.create(voteId);
    vote.setUserId(userId);
    vote.setQuestionId(questionId);
    vote.setChoiceId(choiceId);
    vote.setVoteDate(now);
    PollsVoteUtil.update(vote);
  }
  return vote;
}
