{
  Date now=new Date();
  PollsQuestion question=PollsQuestionUtil.findByPrimaryKey(questionId);
  question.setLastVoteDate(now);
  PollsQuestionUtil.update(question);
  PollsVotePK votePK=new PollsVotePK(questionId,userId);
  PollsVote vote=null;
  try {
    vote=PollsVoteUtil.findByPrimaryKey(votePK);
    throw new DuplicateVoteException();
  }
 catch (  NoSuchVoteException nsve) {
    vote=PollsVoteUtil.create(votePK);
    PollsChoicePK choicePK=new PollsChoicePK(questionId,choiceId);
    PollsChoiceUtil.findByPrimaryKey(choicePK);
    vote.setChoiceId(choiceId);
    vote.setVoteDate(now);
    PollsVoteUtil.update(vote);
  }
  return vote;
}
