{
  User user=getUser();
  DLFileEntryPermission.check(getPermissionChecker(),folderId,name,ActionKeys.UPDATE);
  DLFileEntryPK pk=new DLFileEntryPK(folderId,name);
  boolean alreadyHasLock=LockServiceUtil.hasLock(DLFileEntry.class.getName(),pk,user.getUserId());
  if (!alreadyHasLock) {
    LockServiceUtil.lock(DLFileEntry.class.getName(),pk,user.getCompanyId(),user.getUserId(),DLFileEntryImpl.LOCK_EXPIRATION_TIME);
  }
  DLFileEntry fileEntry=DLFileEntryLocalServiceUtil.updateFileEntry(getUserId(),folderId,newFolderId,name,sourceFileName,title,description,tagsEntries,extraSettings,byteArray);
  if (!alreadyHasLock) {
    LockServiceUtil.unlock(DLFileEntry.class.getName(),pk);
  }
  return fileEntry;
}
