{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  Theme theme=themeDisplay.getTheme();
  ColorScheme colorScheme=themeDisplay.getColorScheme();
  String themeId=ParamUtil.getString(req,"themeId");
  String colorSchemeId=ParamUtil.getString(req,"colorSchemeId");
  if ((theme == null) || (colorScheme == null) || (!theme.getThemeId().equals(themeId))|| (!colorScheme.getColorSchemeId().equals(colorSchemeId))) {
    boolean wapTheme=BrowserSnifferUtil.is_wap(req);
    theme=ThemeLocalServiceUtil.getTheme(themeDisplay.getCompanyId(),themeId,wapTheme);
    colorScheme=ThemeLocalServiceUtil.getColorScheme(themeDisplay.getCompanyId(),themeId,colorSchemeId,wapTheme);
    themeDisplay.setLookAndFeel(theme,colorScheme);
    req.setAttribute(WebKeys.THEME,theme);
    req.setAttribute(WebKeys.COLOR_SCHEME,colorScheme);
  }
  res.addHeader(HttpHeaders.CACHE_CONTROL,"max-age=0");
  res.setDateHeader(HttpHeaders.LAST_MODIFIED,System.currentTimeMillis());
  return mapping.findForward("modified.jsp");
}
