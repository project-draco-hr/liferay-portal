{
  long fileEntryId=ParamUtil.getLong(request,"fileEntryId");
  FileEntry fileEntry=null;
  if (fileEntryId > 0) {
    fileEntry=DLAppServiceUtil.getFileEntry(fileEntryId);
  }
  request.setAttribute(WebKeys.DOCUMENT_LIBRARY_FILE_ENTRY,fileEntry);
  String version=ParamUtil.getString(request,"version");
  if (fileEntry == null) {
    return;
  }
  FileVersion fileVersion=null;
  if (Validator.isNotNull(version)) {
    fileVersion=fileEntry.getFileVersion(version);
    request.setAttribute(WebKeys.DOCUMENT_LIBRARY_FILE_VERSION,fileVersion);
  }
 else {
    fileVersion=fileEntry.getFileVersion();
  }
  if (RawMetadataProcessorUtil.isSupported(fileVersion)) {
    RawMetadataProcessorUtil.generateMetadata(fileVersion);
  }
  String cmd=ParamUtil.getString(request,Constants.CMD);
  if (fileEntry.isInTrash() && !cmd.equals(Constants.MOVE_FROM_TRASH)) {
    throw new NoSuchFileEntryException("{fileEntryId=" + fileEntryId + "}");
  }
}
