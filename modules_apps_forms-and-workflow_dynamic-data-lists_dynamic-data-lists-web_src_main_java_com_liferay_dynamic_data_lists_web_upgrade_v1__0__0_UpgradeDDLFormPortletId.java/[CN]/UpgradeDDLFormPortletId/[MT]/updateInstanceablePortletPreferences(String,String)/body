{
  DynamicQuery dynamicQuery=_portletPreferencesLocalService.dynamicQuery();
  Junction disjunction=RestrictionsFactoryUtil.disjunction();
  Property portletIdProperty=PropertyFactoryUtil.forName("portletId");
  disjunction.add(portletIdProperty.eq(oldRootPortletId));
  disjunction.add(portletIdProperty.like(oldRootPortletId + "_INSTANCE_%"));
  disjunction.add(portletIdProperty.like(oldRootPortletId + "_USER_%_INSTANCE_%"));
  dynamicQuery.add(disjunction);
  List<PortletPreferences> portletPreferences=_portletPreferencesLocalService.dynamicQuery(dynamicQuery);
  for (  PortletPreferences portletPreference : portletPreferences) {
    String newPortletId=StringUtil.replace(portletPreference.getPortletId(),oldRootPortletId,newRootPortletId);
    String newPreferences=StringUtil.replace(portletPreference.getPreferences(),"</portlet-preferences>","<preference><name>formView</name><value>true</value>" + "</preference></portlet-preferences>");
    portletPreference.setPortletId(newPortletId);
    portletPreference.setPreferences(newPreferences);
    _portletPreferencesLocalService.updatePortletPreferences(portletPreference);
  }
}
