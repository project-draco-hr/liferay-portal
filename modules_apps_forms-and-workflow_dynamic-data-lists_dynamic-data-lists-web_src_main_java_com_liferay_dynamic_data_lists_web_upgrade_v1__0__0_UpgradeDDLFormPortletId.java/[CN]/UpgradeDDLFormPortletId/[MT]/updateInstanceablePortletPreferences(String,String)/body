{
  ActionableDynamicQuery actionableDynamicQuery=_portletPreferencesLocalService.getActionableDynamicQuery();
  actionableDynamicQuery.setAddCriteriaMethod(new ActionableDynamicQuery.AddCriteriaMethod(){
    @Override public void addCriteria(    DynamicQuery dynamicQuery){
      Junction junction=RestrictionsFactoryUtil.disjunction();
      Property portletIdProperty=PropertyFactoryUtil.forName("portletId");
      junction.add(portletIdProperty.eq(oldRootPortletId));
      junction.add(portletIdProperty.like(oldRootPortletId + "_INSTANCE_%"));
      junction.add(portletIdProperty.like(oldRootPortletId + "_USER_%_INSTANCE_%"));
      dynamicQuery.add(junction);
    }
  }
);
  actionableDynamicQuery.setParallel(true);
  actionableDynamicQuery.setPerformActionMethod(new ActionableDynamicQuery.PerformActionMethod<PortletPreferences>(){
    @Override public void performAction(    PortletPreferences portletPreference) throws PortalException {
      updatePortletPreferences(portletPreference,oldRootPortletId,newRootPortletId);
    }
  }
);
  actionableDynamicQuery.performActions();
}
