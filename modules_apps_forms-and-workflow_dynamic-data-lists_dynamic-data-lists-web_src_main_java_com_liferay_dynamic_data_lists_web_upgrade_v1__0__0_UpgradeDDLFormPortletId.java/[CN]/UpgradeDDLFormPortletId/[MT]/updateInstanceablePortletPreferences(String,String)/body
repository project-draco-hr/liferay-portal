{
  DynamicQuery portletPreferencesQuery=_portletPreferencesLocalService.dynamicQuery();
  Property portletIdProperty=PropertyFactoryUtil.forName("portletId");
  Junction junction=RestrictionsFactoryUtil.disjunction();
  junction.add(portletIdProperty.eq(oldRootPortletId));
  junction.add(portletIdProperty.like(oldRootPortletId + "_INSTANCE_%"));
  junction.add(portletIdProperty.like(oldRootPortletId + "_USER_%_INSTANCE_%"));
  portletPreferencesQuery=portletPreferencesQuery.add(junction);
  List<PortletPreferences> portletPreferences=_portletPreferencesLocalService.dynamicQuery(portletPreferencesQuery);
  for (  PortletPreferences portletPreference : portletPreferences) {
    String newPortletId=StringUtil.replace(portletPreference.getPortletId(),oldRootPortletId,newRootPortletId);
    String newPreferences=StringUtil.replace(portletPreference.getPreferences(),"</portlet-preferences>","<preference><name>formView</name><value>true</value>" + "</preference></portlet-preferences>");
    portletPreference.setPortletId(newPortletId);
    portletPreference.setPreferences(newPreferences);
    _portletPreferencesLocalService.updatePortletPreferences(portletPreference);
  }
}
