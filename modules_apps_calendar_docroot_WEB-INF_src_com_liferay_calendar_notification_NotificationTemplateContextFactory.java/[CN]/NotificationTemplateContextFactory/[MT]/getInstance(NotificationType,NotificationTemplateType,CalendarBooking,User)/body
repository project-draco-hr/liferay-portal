{
  CalendarBooking parentCalendarBooking=calendarBooking.getParentCalendarBooking();
  Calendar calendar=parentCalendarBooking.getCalendar();
  NotificationTemplateContext notificationTemplateContext=new NotificationTemplateContext();
  CalendarNotificationTemplate calendarNotificationTemplate=CalendarNotificationTemplateLocalServiceUtil.fetchCalendarNotificationTemplate(calendar.getCalendarId(),notificationType,notificationTemplateType);
  notificationTemplateContext.setCalendarNotificationTemplate(calendarNotificationTemplate);
  notificationTemplateContext.setCompanyId(calendarBooking.getCompanyId());
  notificationTemplateContext.setGroupId(calendarBooking.getGroupId());
  notificationTemplateContext.setCalendarId(calendar.getCalendarId());
  notificationTemplateContext.setNotificationTemplateType(notificationTemplateType);
  notificationTemplateContext.setNotificationType(notificationType);
  Map<String,Serializable> attributes=new HashMap<>();
  TimeZone userTimezone=user.getTimeZone();
  Format dateFormatDateTime=FastDateFormatFactoryUtil.getDateTime(user.getLocale(),CalendarUtil.getCalendarBookingDisplayTimeZone(calendarBooking,userTimezone));
  String userTimezoneDisplayName=userTimezone.getDisplayName(false,TimeZone.SHORT,user.getLocale());
  String endTime=dateFormatDateTime.format(calendarBooking.getEndTime()) + StringPool.SPACE + userTimezoneDisplayName;
  attributes.put("endTime",endTime);
  attributes.put("location",calendarBooking.getLocation());
  Group group=GroupLocalServiceUtil.getGroup(user.getCompanyId(),GroupConstants.GUEST);
  String portalURL=_getPortalURL(group.getCompanyId(),group.getGroupId());
  attributes.put("portalURL",portalURL);
  PortletConfig portletConfig=getPortletConfig();
  ResourceBundle resourceBundle=portletConfig.getResourceBundle(user.getLocale());
  attributes.put("portletName",LanguageUtil.get(resourceBundle,"javax.portlet.title.".concat(PortletKeys.CALENDAR)));
  String startTime=dateFormatDateTime.format(calendarBooking.getStartTime()) + StringPool.SPACE + userTimezoneDisplayName;
  attributes.put("startTime",startTime);
  attributes.put("title",calendarBooking.getTitle(user.getLocale()));
  String calendarBookingURL=_getCalendarBookingURL(user,calendarBooking.getCalendarBookingId());
  attributes.put("url",calendarBookingURL);
  notificationTemplateContext.setAttributes(attributes);
  return notificationTemplateContext;
}
