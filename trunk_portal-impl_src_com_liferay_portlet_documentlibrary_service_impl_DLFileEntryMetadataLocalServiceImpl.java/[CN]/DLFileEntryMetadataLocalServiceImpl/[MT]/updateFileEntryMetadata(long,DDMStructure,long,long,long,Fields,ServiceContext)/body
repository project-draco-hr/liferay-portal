{
  try {
    DLFileEntryMetadata fileEntryMetadata=dlFileEntryMetadataPersistence.findByD_F(ddmStructure.getStructureId(),fileVersionId);
    StorageEngineUtil.update(fileEntryMetadata.getClassPK(),fields,serviceContext);
  }
 catch (  NoSuchFileEntryMetadataException nsdmse) {
    long fileEntryMetadataId=counterLocalService.increment();
    DLFileEntryMetadata fileEntryMetadata=dlFileEntryMetadataPersistence.create(fileEntryMetadataId);
    fileEntryMetadata.setClassNameId(ddmStructure.getClassNameId());
    long classPK=StorageEngineUtil.create(companyId,ddmStructure.getStructureId(),fields,serviceContext);
    fileEntryMetadata.setClassPK(classPK);
    fileEntryMetadata.setDDMStructureId(ddmStructure.getStructureId());
    fileEntryMetadata.setFileEntryTypeId(fileEntryTypeId);
    fileEntryMetadata.setFileEntryId(fileEntryId);
    fileEntryMetadata.setFileVersionId(fileVersionId);
    dlFileEntryMetadataPersistence.update(fileEntryMetadata,false);
    long classNameId=PortalUtil.getClassNameId(DLFileEntryMetadata.class);
    ddmStructureLinkLocalService.addStructureLink(classNameId,fileEntryMetadata.getFileEntryMetadataId(),ddmStructure.getStructureId(),serviceContext);
  }
}
