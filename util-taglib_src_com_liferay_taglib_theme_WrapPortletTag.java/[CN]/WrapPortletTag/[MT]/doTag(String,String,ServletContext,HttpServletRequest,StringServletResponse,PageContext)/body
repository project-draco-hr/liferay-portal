{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Theme theme=themeDisplay.getTheme();
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  RequestDispatcher requestDispatcher=servletContext.getRequestDispatcher(portletPage);
  requestDispatcher.include(request,stringResponse);
  portletDisplay.setContent(stringResponse.getString());
  stringResponse.recycle();
  String content=ThemeUtil.includeVM(servletContext,request,pageContext,wrapPage,theme,false);
  StringBuilder sb=new StringBuilder(content.length() + _CONTENT_WRAPPER_LENGTH);
  sb.append(_CONTENT_WRAPPER_PRE);
  sb.append(content);
  sb.append(_CONTENT_WRAPPER_POST);
  return sb.toString();
}
