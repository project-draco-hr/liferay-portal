{
  try {
    String messageId=ParamUtil.getString(req,"messageId");
    String fileName=ParamUtil.getString(req,"attachment");
    MBMessage message=MBMessageServiceUtil.getMessage(messageId);
    InputStream is=DLLocalServiceUtil.getFileAsStream(message.getCompanyId(),Company.SYSTEM,message.getAttachmentsDir() + "/" + fileName);
    HttpServletResponse httpRes=((ActionResponseImpl)res).getHttpServletResponse();
    ServletResponseUtil.sendFile(httpRes,fileName,is);
  }
 catch (  Exception e) {
    _log.error(e);
  }
}
