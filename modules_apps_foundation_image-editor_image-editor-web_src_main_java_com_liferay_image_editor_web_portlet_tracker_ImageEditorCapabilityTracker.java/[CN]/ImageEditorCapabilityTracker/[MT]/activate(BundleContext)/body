{
  String filter="(com.liferay.image.editor.capability.type=*)";
  _capabilityPropertiesMap=new HashMap<>();
  _serviceTrackerMap=ServiceTrackerMapFactory.openMultiValueMap(bundleContext,ImageEditorCapability.class,filter,new ServiceReferenceMapper<String,ImageEditorCapability>(){
    @Override public void map(    ServiceReference<ImageEditorCapability> serviceReference,    Emitter<String> emitter){
      String[] propertyKeys=serviceReference.getPropertyKeys();
      Map<String,Object> properties=new HashMap<>();
      for (      String propertyKey : propertyKeys) {
        properties.put(propertyKey,serviceReference.getProperty(propertyKey));
      }
      String capabilityName=GetterUtil.getString(serviceReference.getProperty("com.liferay.image.editor.capability.name"));
      _capabilityPropertiesMap.put(capabilityName,properties);
      String capabilityType=GetterUtil.getString(serviceReference.getProperty("com.liferay.image.editor.capability.type"));
      emitter.emit(capabilityType);
    }
  }
);
}
