{
  if (!_isWARFile()) {
    super.invokeAction(actionRequest,actionResponse);
    return;
  }
  try {
    ActionRequestImpl actionRequestImpl=(ActionRequestImpl)actionRequest;
    ActionResponseImpl actionResponseImpl=(ActionResponseImpl)actionResponse;
    HttpServletRequest request=actionRequestImpl.getOriginalHttpServletRequest();
    HttpServletResponse response=actionResponseImpl.getHttpServletResponse();
    _initUser(request,_portletModel);
    WindowState currentWindowState=actionRequestImpl.getWindowState();
    PortletMode currentPortletMode=actionRequestImpl.getPortletMode();
    if (_remotePortlet) {
      WindowRequestReader requestReader=new WSRPWindowRequestReader();
      ChannelState newChannelState=requestReader.readNewWindowState(request);
      if (newChannelState != null) {
        currentWindowState=PortletAppEngineUtils.getWindowState(newChannelState);
      }
      ChannelMode newChannelMode=requestReader.readNewPortletWindowMode(request);
      if (newChannelMode != null) {
        currentPortletMode=PortletAppEngineUtils.getPortletMode(newChannelMode);
      }
    }
    long plid=_getPlid(actionRequest);
    ExecuteActionRequest executeActionRequest=ContainerRequestFactory.createExecuteActionRequest(request,_portletModel,currentWindowState,currentPortletMode,plid,isFacesPortlet(),_remotePortlet);
    _populateContainerRequest(request,response,executeActionRequest,actionRequest);
    if (!_portletModel.getPublishingEvents().isEmpty()) {
      executeActionRequest.setPortletNamespaces(_getPortletNamespaces(executeActionRequest));
      executeActionRequest.setPortletWindowIDs(_getPortletWindowIDs(executeActionRequest,plid));
    }
    ExecuteActionResponse executeActionResponse=ContainerResponseFactory.createExecuteActionResponse(response);
    ChannelURLType urlType=executeActionRequest.getWindowRequestReader().readURLType(request);
    _container.executeAction(executeActionRequest,executeActionResponse,urlType);
    URL redirectURL=executeActionResponse.getRedirectURL();
    if (redirectURL != null) {
      actionResponseImpl.setRedirectLocation(redirectURL.toString());
    }
 else {
      ChannelState newWindowState=executeActionResponse.getNewWindowState();
      if (newWindowState != null) {
        actionResponseImpl.setWindowState(PortletAppEngineUtils.getWindowState(newWindowState));
      }
 else {
        actionResponseImpl.setWindowState(currentWindowState);
      }
      ChannelMode newPortletMode=executeActionResponse.getNewChannelMode();
      if (newPortletMode != null) {
        actionResponseImpl.setPortletMode(PortletAppEngineUtils.getPortletMode(newPortletMode));
      }
 else {
        actionResponseImpl.setPortletMode(currentPortletMode);
      }
    }
  }
 catch (  Exception e) {
    throw new PortletException(e);
  }
 finally {
    _setPortletAttributes(actionRequest,actionResponse);
  }
}
