{
  Map<PortletID,List<String>> portletNamespaces=new HashMap<PortletID,List<String>>();
  try {
    List<EntityID> portletEntityIDs=portletWindowContext.getPortletWindows(PortletType.LOCAL,DistributionType.ALL_PORTLETS_ON_PAGE);
    if (portletEntityIDs == null) {
      return portletNamespaces;
    }
    for (    EntityID portletEntityID : portletEntityIDs) {
      List<String> namespaces=portletNamespaces.get(portletEntityID.getPortletID());
      if (namespaces == null) {
        namespaces=new ArrayList<String>();
        portletNamespaces.put(portletEntityID.getPortletID(),namespaces);
      }
      String namespace=PortalUtil.getPortletNamespace(portletEntityID.getPortletWindowName());
      namespaces.add(namespace);
    }
  }
 catch (  PortletWindowContextException pwce) {
    if (_log.isWarnEnabled()) {
      _log.warn(pwce,pwce);
    }
  }
  return portletNamespaces;
}
