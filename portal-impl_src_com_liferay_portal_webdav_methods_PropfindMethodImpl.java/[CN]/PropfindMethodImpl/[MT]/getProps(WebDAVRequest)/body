{
  try {
    Set<Tuple> props=new HashSet<Tuple>();
    HttpServletRequest request=webDavRequest.getHttpServletRequest();
    InputStream is=request.getInputStream();
    if (is == null) {
      return generateProps(props);
    }
    Document doc=SAXReaderUtil.read(is);
    if (_log.isDebugEnabled()) {
      _log.debug("Request XML: \n" + doc.formattedString(StringPool.FOUR_SPACES));
    }
    Element root=doc.getRootElement();
    if (root.element("allprop") != null) {
      return generateProps(props);
    }
    Element prop=root.element("prop");
    Iterator<Element> itr=prop.elements().iterator();
    while (itr.hasNext()) {
      Element el=itr.next();
      String prefix=el.getNamespacePrefix();
      String uri=el.getNamespaceURI();
      Namespace namespace=null;
      if (uri.equals(WebDAVUtil.DAV_URI.getURI())) {
        namespace=WebDAVUtil.DAV_URI;
      }
 else       if (Validator.isNull(prefix)) {
        namespace=SAXReaderUtil.createNamespace(uri);
      }
 else {
        namespace=SAXReaderUtil.createNamespace(prefix,uri);
      }
      props.add(new Tuple(el.getName(),namespace));
    }
    return props;
  }
 catch (  Exception e) {
    throw new InvalidRequestException(e);
  }
}
