{
  Principal principal=null;
  try {
    principal=sc.getCallerPrincipal();
  }
 catch (  Exception e) {
    throw new PrincipalException(e);
  }
  if (principal == null) {
    throw new PrincipalException();
  }
  String name=principal.getName();
  PrincipalFinder principalFinder=null;
  try {
    principalFinder=(PrincipalFinder)InstancePool.get(PropsUtil.get(PropsUtil.PRINCIPAL_FINDER));
    name=principalFinder.toLiferay(name);
  }
 catch (  Exception e) {
  }
  if (Validator.isNull(name)) {
    throw new PrincipalException("Principal cannot be null");
  }
 else {
    for (int i=0; i < ANONYMOUS_NAMES.length; i++) {
      if (name.equalsIgnoreCase(ANONYMOUS_NAMES[i])) {
        throw new PrincipalException("Principal cannot be " + ANONYMOUS_NAMES[i]);
      }
    }
  }
  return name;
}
