{
  Long questionId=(Long)questionPKs.get(new Long(vote.getQuestionId()));
  boolean newParentQuestion=false;
  if (questionId == null) {
    questionId=new Long(vote.getQuestionId());
  }
 else {
    newParentQuestion=true;
  }
  Long choiceId=(Long)choicePKs.get(new Long(vote.getChoiceId()));
  boolean newParentChoice=false;
  if (choiceId == null) {
    choiceId=new Long(vote.getChoiceId());
  }
 else {
    newParentChoice=true;
  }
  try {
    PollsQuestionUtil.findByPrimaryKey(questionId.longValue());
    PollsChoiceUtil.findByPrimaryKey(choiceId.longValue());
    if ((PollsChoiceUtil.fetchByPrimaryKey(vote.getPrimaryKey()) == null) || newParentChoice || newParentQuestion) {
      PollsVoteLocalServiceUtil.addVote(vote.getPrimaryKey(),questionId.longValue(),choiceId.longValue());
    }
 else {
      vote.setQuestionId(questionId.longValue());
      vote.setQuestionId(choiceId.longValue());
      PollsVoteUtil.update(vote,true);
    }
  }
 catch (  NoSuchQuestionException nsqe) {
    _log.error("Could not find the question for vote " + vote.getVoteId());
  }
catch (  NoSuchChoiceException nsve) {
    _log.error("Could not find the choice for vote " + vote.getVoteId());
  }
}
