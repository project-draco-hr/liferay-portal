{
  _channelPipeline=_embeddedChannel.pipeline();
  _repositoryPath=Paths.get("repository");
  FileHelperUtil.delete(_repositoryPath);
  FileServerTestUtil.registerForCleanUp(Files.createDirectory(_repositoryPath));
  AsyncBroker<Path,FileResponse> asyncBroker=new AsyncBroker<Path,FileResponse>();
  _channelPipeline.addLast(new FileResponseChannelHandler(asyncBroker,_embeddedChannel.eventLoop()));
  _nettyRepository=new NettyRepository(_repositoryPath,asyncBroker,Long.MAX_VALUE);
  _asyncBroker=_nettyRepository.asyncBroker;
}
