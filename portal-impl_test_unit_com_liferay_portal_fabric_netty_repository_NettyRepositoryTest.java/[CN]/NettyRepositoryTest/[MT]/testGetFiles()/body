{
  Map<Path,Path> pathMap=new HashMap<Path,Path>();
  Path remoteFilePath1=Paths.get("remoteFile1");
  Path remoteFilePath2=Paths.get("remoteFile2");
  Path localFilePath=FileServerTestUtil.registerForCleanUp(Paths.get("localFile1"));
  pathMap.put(remoteFilePath1,localFilePath);
  pathMap.put(remoteFilePath2,Paths.get("localFile2"));
  NoticeableFuture<Map<Path,Path>> noticeableFuture=_nettyRepository.getFiles(_embeddedChannel,pathMap,true);
  Path tempFilePath=FileServerTestUtil.createFileWithData(Paths.get("tempFile"));
  FileResponse fileResponse1=new FileResponse(remoteFilePath1,Files.size(tempFilePath),-1,false);
  fileResponse1.setLocalFile(tempFilePath);
  Assert.assertTrue(_asyncBroker.takeWithResult(remoteFilePath1,fileResponse1));
  CaptureHandler captureHandler=JDKLoggerTestUtil.configureJDKLogger(NettyRepository.class.getName(),Level.WARNING);
  try {
    Assert.assertTrue(_asyncBroker.takeWithResult(remoteFilePath2,new FileResponse(remoteFilePath2,FileResponse.FILE_NOT_FOUND,-1,false)));
    List<LogRecord> logRecords=captureHandler.getLogRecords();
    Assert.assertEquals(1,logRecords.size());
    LogRecord logRecord=logRecords.get(0);
    Assert.assertEquals("Remote file remoteFile2 is not found",logRecord.getMessage());
  }
  finally {
    captureHandler.close();
  }
  Map<Path,Path> resultPathMap=noticeableFuture.get();
  Assert.assertEquals(1,resultPathMap.size());
  Assert.assertEquals(localFilePath,resultPathMap.get(remoteFilePath1));
}
