{
  if (!WorkflowThreadLocal.isEnabled()) {
    return;
  }
  WorkflowHandler workflowHandler=WorkflowHandlerRegistryUtil.getWorkflowHandler(className);
  WorkflowDefinitionLink workflowDefinitionLink=workflowHandler.getWorkflowDefinitionLink(companyId,groupId,classPK);
  String workflowDefinitionName=workflowDefinitionLink.getWorkflowDefinitionName();
  int workflowDefinitionVersion=workflowDefinitionLink.getWorkflowDefinitionVersion();
  if (workflowContext != null) {
    workflowContext=new HashMap<String,Serializable>(workflowContext);
  }
 else {
    workflowContext=new HashMap<String,Serializable>();
  }
  workflowContext.put(WorkflowConstants.CONTEXT_COMPANY_ID,String.valueOf(companyId));
  workflowContext.put(WorkflowConstants.CONTEXT_GROUP_ID,String.valueOf(groupId));
  workflowContext.put(WorkflowConstants.CONTEXT_ENTRY_CLASS_NAME,className);
  workflowContext.put(WorkflowConstants.CONTEXT_ENTRY_CLASS_PK,String.valueOf(classPK));
  workflowContext.put(WorkflowConstants.CONTEXT_ENTRY_TYPE,workflowHandler.getType(LocaleUtil.getDefault()));
  if (userId == 0) {
    userId=UserLocalServiceUtil.getDefaultUserId(companyId);
  }
  WorkflowInstance workflowInstance=WorkflowInstanceManagerUtil.startWorkflowInstance(companyId,groupId,userId,workflowDefinitionName,workflowDefinitionVersion,null,workflowContext);
  addWorkflowInstanceLink(userId,companyId,groupId,className,classPK,workflowInstance.getWorkflowInstanceId());
}
