{
  Attribute<AtomicLong> attribute=channel.attr(_idGeneratorKey);
  AtomicLong attachmentIdGenerator=attribute.get();
  if (attachmentIdGenerator == null) {
    attachmentIdGenerator=new AtomicLong();
    AtomicLong previousAttachmentIdGenerator=attribute.setIfAbsent(attachmentIdGenerator);
    if (previousAttachmentIdGenerator != null) {
      attachmentIdGenerator=previousAttachmentIdGenerator;
    }
  }
  return attachmentIdGenerator.getAndIncrement();
}
