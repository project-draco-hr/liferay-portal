{
  ConcurrentMap<Key,Value> concurrentMap=new ConcurrentTypeReferenceHashMap(new ConcurrentHashMap<KeyReference,ValueReference>(){
    @Override public ValueReference get(    Object key){
      KeyReference keyReference=(KeyReference)key;
      ValueReference valueReference=super.get(keyReference);
      if (_testKey.equals(keyReference._key)) {
        put(new KeyReference(_testKey),new ValueReference(_testValue2));
      }
      return valueReference;
    }
  }
);
  Assert.assertNull(concurrentMap.put(_testKey,_testValue));
  _assertEventQueue(Event.MAP_KEY,Event.MAP_VALUE);
  Assert.assertFalse(concurrentMap.replace(_testKey,_testValue,_testValue2));
  _assertEventQueue(Event.MAP_KEY_FOR_QUERY,Event.MAP_VALUE,Event.UNMAP_VALUE_FOR_QUERY,Event.UNMAP_VALUE);
}
