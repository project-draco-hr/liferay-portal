{
  Release release=null;
  try {
    release=ReleaseLocalServiceUtil.getRelease(ReleaseConstants.DEFAULT_SERVLET_CONTEXT_NAME,ReleaseInfo.getParentBuildNumber());
  }
 catch (  PortalException pe) {
    release=ReleaseLocalServiceUtil.addRelease(ReleaseConstants.DEFAULT_SERVLET_CONTEXT_NAME,ReleaseInfo.getParentBuildNumber());
  }
  _checkReleaseState();
  if (PropsValues.DATABASE_INDEXES_UPDATE_ON_STARTUP) {
    StartupHelperUtil.setDropIndexes(true);
    StartupHelperUtil.updateIndexes();
  }
 else   if (StartupHelperUtil.isUpgraded()) {
    StartupHelperUtil.updateIndexes();
  }
  if (PropsValues.VERIFY_DATABASE_TRANSACTIONS_DISABLED) {
    _disableTransactions();
  }
  try {
    StartupHelperUtil.verifyProcess(release.isVerified());
  }
 catch (  Exception e) {
    _updateReleaseState(ReleaseConstants.STATE_VERIFY_FAILURE);
    throw e;
  }
 finally {
    if (PropsValues.VERIFY_DATABASE_TRANSACTIONS_DISABLED) {
      _enableTransactions();
    }
  }
  if (PropsValues.DATABASE_INDEXES_UPDATE_ON_STARTUP || StartupHelperUtil.isUpgraded()) {
    StartupHelperUtil.updateIndexes(false);
  }
  boolean verified=StartupHelperUtil.isVerified();
  if (release.isVerified()) {
    verified=true;
  }
  ReleaseLocalServiceUtil.updateRelease(release.getReleaseId(),ReleaseInfo.getParentBuildNumber(),ReleaseInfo.getBuildDate(),verified);
  CacheRegistryUtil.setActive(true);
}
