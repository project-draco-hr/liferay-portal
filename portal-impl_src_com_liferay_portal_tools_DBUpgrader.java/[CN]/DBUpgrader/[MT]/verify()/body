{
  Release release=null;
  try {
    release=ReleaseLocalServiceUtil.getRelease(ReleaseConstants.DEFAULT_SERVLET_CONTEXT_NAME,ReleaseInfo.getBuildNumber());
  }
 catch (  PortalException pe) {
    release=ReleaseLocalServiceUtil.addRelease(ReleaseConstants.DEFAULT_SERVLET_CONTEXT_NAME,ReleaseInfo.getBuildNumber());
  }
  _checkReleaseState();
  try {
    StartupHelperUtil.verifyProcess(release.isVerified());
  }
 catch (  Exception e) {
    _updateReleaseState(ReleaseConstants.STATE_VERIFY_FAILURE);
    throw e;
  }
  if (StartupHelperUtil.isUpgraded()) {
    StartupHelperUtil.updateIndexes();
  }
  boolean verified=StartupHelperUtil.isVerified();
  if (release.isVerified()) {
    verified=true;
  }
  ReleaseLocalServiceUtil.updateRelease(release.getReleaseId(),ReleaseInfo.getBuildNumber(),ReleaseInfo.getBuildDate(),verified);
  CacheRegistryUtil.setActive(true);
}
