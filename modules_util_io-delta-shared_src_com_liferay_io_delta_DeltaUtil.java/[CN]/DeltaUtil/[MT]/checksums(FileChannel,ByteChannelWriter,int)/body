{
  RollingChecksum rollingChecksum=new RollingChecksum(originalFileChannel,blockLength);
  checksumsByteChannelWriter.resizeBuffer(BUFFER_FACTOR * 20);
  ByteBuffer byteBuffer=checksumsByteChannelWriter.getBuffer();
  int blocksCount=(int)Math.ceil(originalFileChannel.size() / (double)blockLength);
  checksumsByteChannelWriter.ensureSpace(9);
  byteBuffer.put(PROTOCOL_VERSION);
  byteBuffer.putInt(blockLength);
  byteBuffer.putInt(blocksCount);
  for (; rollingChecksum.hasNext(); rollingChecksum.nextBlock()) {
    checksumsByteChannelWriter.ensureSpace(20);
    byteBuffer.putInt(rollingChecksum.weakChecksum());
    byteBuffer.put(rollingChecksum.strongChecksum());
  }
}
