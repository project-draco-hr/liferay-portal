{
  PortletPreferences portletPreferences=renderRequest.getPreferences();
  String src=getSrc(renderRequest,renderResponse);
  boolean auth=GetterUtil.getBoolean(portletPreferences.getValue("auth",StringPool.BLANK));
  if (!auth) {
    return src;
  }
  String authType=portletPreferences.getValue("authType",StringPool.BLANK);
  if (authType.equals("basic")) {
    String userName=getUserName(renderRequest,renderResponse);
    String password=getPassword(renderRequest,renderResponse);
    int pos=src.indexOf("://");
    String protocol=src.substring(0,pos + 3);
    String url=src.substring(pos + 3);
    src=protocol + userName + ":"+ password+ "@"+ url;
  }
 else {
    ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(com.liferay.portal.kernel.util.WebKeys.THEME_DISPLAY);
    String portletId=PortalUtil.getPortletId(renderRequest);
    src="/proxy.jsp?p_l_id=" + themeDisplay.getPlid() + "&p_p_id="+ portletId;
  }
  return src;
}
