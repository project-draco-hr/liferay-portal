{
  Set<DDMStructure> ddmStructuresSet=new TreeSet<DDMStructure>();
  long recordSetId=GetterUtil.getLong(searchContext.getAttribute("recordSetId"));
  if (recordSetId > 0) {
    DDLRecordSet recordSet=DDLRecordSetLocalServiceUtil.getRecordSet(recordSetId);
    ddmStructuresSet.add(recordSet.getDDMStructure());
  }
 else {
    long[] groupIds=searchContext.getGroupIds();
    if (ArrayUtil.isNotEmpty(groupIds)) {
      List<DDMStructure> ddmStructures=DDMStructureLocalServiceUtil.getStructures(groupIds);
      ddmStructuresSet.addAll(ddmStructures);
    }
  }
  BooleanQuery ddmStructureQuery=BooleanQueryFactoryUtil.create(searchContext);
  for (  DDMStructure ddmStructure : ddmStructuresSet) {
    addSearchDDMStruture(searchQuery,searchContext,ddmStructure);
  }
  if (ddmStructureQuery.hasClauses()) {
    searchQuery.add(ddmStructureQuery,BooleanClauseOccur.MUST);
  }
  addSearchTerm(searchQuery,searchContext,Field.USER_NAME,false);
}
