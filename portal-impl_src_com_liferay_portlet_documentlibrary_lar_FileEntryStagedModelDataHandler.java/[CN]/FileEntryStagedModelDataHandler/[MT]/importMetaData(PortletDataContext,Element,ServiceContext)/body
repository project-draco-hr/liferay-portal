{
  List<Element> referenceDataElements=portletDataContext.getReferenceDataElements(fileEntryElement,DLFileEntryType.class);
  if (referenceDataElements.isEmpty()) {
    return;
  }
  Element fileEntryTypeElement=referenceDataElements.get(0);
  String fileEntryTypePath=fileEntryTypeElement.attributeValue("path");
  DLFileEntryType dlFileEntryType=(DLFileEntryType)portletDataContext.getZipEntryAsObject(fileEntryTypePath);
  DLFileEntryType existingDLFileEntryType=DLFileEntryTypeLocalServiceUtil.fetchDLFileEntryTypeByUuidAndGroupId(dlFileEntryType.getUuid(),portletDataContext.getScopeGroupId());
  if (existingDLFileEntryType == null) {
    existingDLFileEntryType=DLFileEntryTypeLocalServiceUtil.fetchDLFileEntryTypeByUuidAndGroupId(dlFileEntryType.getUuid(),portletDataContext.getCompanyGroupId());
  }
  if (existingDLFileEntryType == null) {
    StagedModelDataHandlerUtil.importStagedModel(portletDataContext,dlFileEntryType);
    Map<Long,Long> dlFileEntryTypeIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(DLFileEntryType.class);
    long dlFileEntryTypeId=MapUtil.getLong(dlFileEntryTypeIds,dlFileEntryType.getFileEntryTypeId(),dlFileEntryType.getFileEntryTypeId());
    existingDLFileEntryType=DLFileEntryTypeLocalServiceUtil.fetchDLFileEntryType(dlFileEntryTypeId);
  }
  if (existingDLFileEntryType == null) {
    serviceContext.setAttribute("fileEntryTypeId",-1);
    return;
  }
  serviceContext.setAttribute("fileEntryTypeId",existingDLFileEntryType.getFileEntryTypeId());
  List<DDMStructure> ddmStructures=existingDLFileEntryType.getDDMStructures();
  for (  DDMStructure ddmStructure : ddmStructures) {
    Element structureFieldsElement=(Element)fileEntryElement.selectSingleNode("structure-fields[@structureUuid='".concat(ddmStructure.getUuid()).concat("']"));
    if (structureFieldsElement == null) {
      continue;
    }
    String path=structureFieldsElement.attributeValue("path");
    Fields fields=(Fields)portletDataContext.getZipEntryAsObject(path);
    serviceContext.setAttribute(Fields.class.getName() + ddmStructure.getStructureId(),fields);
  }
}
