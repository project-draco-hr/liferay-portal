{
  LiferayFileEntry liferayFileEntry=(LiferayFileEntry)fileEntry;
  DLFileEntry dlFileEntry=liferayFileEntry.getDLFileEntry();
  Element fileEntryTypeElement=portletDataContext.getReferenceDataElement(fileEntryElement,DLFileEntryType.class,dlFileEntry.getFileEntryTypeId());
  if (fileEntryTypeElement == null) {
    return;
  }
  String fileEntryTypePath=fileEntryTypeElement.attributeValue("path");
  DLFileEntryType dlFileEntryType=(DLFileEntryType)portletDataContext.getZipEntryAsObject(fileEntryTypePath);
  StagedModelDataHandlerUtil.importReferenceStagedModel(portletDataContext,dlFileEntryType);
  Map<Long,Long> dlFileEntryTypeIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(DLFileEntryType.class);
  long dlFileEntryTypeId=MapUtil.getLong(dlFileEntryTypeIds,dlFileEntryType.getFileEntryTypeId(),dlFileEntryType.getFileEntryTypeId());
  DLFileEntryType existingDLFileEntryType=DLFileEntryTypeLocalServiceUtil.fetchDLFileEntryType(dlFileEntryTypeId);
  if (existingDLFileEntryType == null) {
    serviceContext.setAttribute("fileEntryTypeId",-1);
    return;
  }
  serviceContext.setAttribute("fileEntryTypeId",existingDLFileEntryType.getFileEntryTypeId());
  List<DDMStructure> ddmStructures=existingDLFileEntryType.getDDMStructures();
  for (  DDMStructure ddmStructure : ddmStructures) {
    Element structureFieldsElement=(Element)fileEntryElement.selectSingleNode("structure-fields[@structureUuid='".concat(ddmStructure.getUuid()).concat("']"));
    if (structureFieldsElement == null) {
      continue;
    }
    String path=structureFieldsElement.attributeValue("path");
    Fields fields=(Fields)portletDataContext.getZipEntryAsObject(path);
    serviceContext.setAttribute(Fields.class.getName() + ddmStructure.getStructureId(),fields);
  }
}
