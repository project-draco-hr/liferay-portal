{
  long companyId=role.getCompanyId();
  long roleId=role.getRoleId();
  int scope=ParamUtil.getInteger(actionRequest,"scope" + selResource + actionId);
  if (scope == ResourceConstants.SCOPE_COMPANY) {
    ResourcePermissionServiceUtil.addResourcePermission(groupId,companyId,selResource,scope,String.valueOf(role.getCompanyId()),roleId,actionId);
  }
 else   if (scope == ResourceConstants.SCOPE_GROUP) {
    if ((role.getType() == RoleConstants.TYPE_COMMUNITY) || (role.getType() == RoleConstants.TYPE_ORGANIZATION)) {
      ResourcePermissionServiceUtil.addResourcePermission(groupId,companyId,selResource,ResourceConstants.SCOPE_GROUP_TEMPLATE,String.valueOf(GroupConstants.DEFAULT_PARENT_GROUP_ID),roleId,actionId);
    }
 else {
      String[] groupIds=StringUtil.split(ParamUtil.getString(actionRequest,"groupIds" + selResource + actionId));
      if (groupIds.length == 0) {
        SessionErrors.add(actionRequest,"missingGroupIdsForAction");
        return;
      }
      groupIds=ArrayUtil.distinct(groupIds);
      ResourcePermissionServiceUtil.removeResourcePermissions(groupId,companyId,selResource,ResourceConstants.SCOPE_GROUP,roleId,actionId);
      for (      String curGroupId : groupIds) {
        ResourcePermissionServiceUtil.addResourcePermission(groupId,companyId,selResource,ResourceConstants.SCOPE_GROUP,curGroupId,roleId,actionId);
      }
    }
  }
 else {
    ResourcePermissionServiceUtil.removeResourcePermissions(groupId,companyId,selResource,ResourceConstants.SCOPE_COMPANY,roleId,actionId);
    ResourcePermissionServiceUtil.removeResourcePermissions(groupId,companyId,selResource,ResourceConstants.SCOPE_GROUP_TEMPLATE,roleId,actionId);
    ResourcePermissionServiceUtil.removeResourcePermissions(groupId,companyId,selResource,ResourceConstants.SCOPE_GROUP,roleId,actionId);
  }
}
