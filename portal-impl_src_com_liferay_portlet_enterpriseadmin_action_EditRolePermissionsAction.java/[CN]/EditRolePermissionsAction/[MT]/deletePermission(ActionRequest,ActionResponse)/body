{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long roleId=ParamUtil.getLong(actionRequest,"roleId");
  long permissionId=ParamUtil.getLong(actionRequest,"permissionId");
  long resourceId=ParamUtil.getLong(actionRequest,"resourceId");
  String actionId=ParamUtil.getString(actionRequest,"actionId");
  Role role=RoleLocalServiceUtil.getRole(roleId);
  if (role.getName().equals(RoleConstants.ADMINISTRATOR) || role.getName().equals(RoleConstants.OWNER) || role.getName().equals(RoleConstants.COMMUNITY_ADMINISTRATOR)|| role.getName().equals(RoleConstants.COMMUNITY_OWNER)|| role.getName().equals(RoleConstants.ORGANIZATION_ADMINISTRATOR)|| role.getName().equals(RoleConstants.ORGANIZATION_OWNER)) {
    throw new RolePermissionsException(role.getName());
  }
  if (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 6) {
    ResourcePermissionServiceUtil.unsetResourcePermission(roleId,themeDisplay.getScopeGroupId(),resourceId,actionId);
  }
 else {
    PermissionServiceUtil.unsetRolePermission(roleId,themeDisplay.getScopeGroupId(),permissionId);
  }
  SessionMessages.add(actionRequest,"permissionDeleted");
  String redirect=ParamUtil.getString(actionRequest,"redirect");
  actionResponse.sendRedirect(redirect);
}
