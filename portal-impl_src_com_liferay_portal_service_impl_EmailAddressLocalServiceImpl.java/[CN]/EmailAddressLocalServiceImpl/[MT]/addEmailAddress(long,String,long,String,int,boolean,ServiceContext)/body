{
  User user=userPersistence.findByPrimaryKey(userId);
  long classNameId=classNameLocalService.getClassNameId(className);
  Date now=new Date();
  validate(0,user.getCompanyId(),classNameId,classPK,address,typeId,primary);
  long emailAddressId=counterLocalService.increment();
  EmailAddress emailAddress=emailAddressPersistence.create(emailAddressId);
  emailAddress.setUuid(serviceContext.getUuid());
  emailAddress.setCompanyId(user.getCompanyId());
  emailAddress.setUserId(user.getUserId());
  emailAddress.setUserName(user.getFullName());
  emailAddress.setCreateDate(serviceContext.getCreateDate(now));
  emailAddress.setModifiedDate(serviceContext.getModifiedDate(now));
  emailAddress.setClassNameId(classNameId);
  emailAddress.setClassPK(classPK);
  emailAddress.setAddress(address);
  emailAddress.setTypeId(typeId);
  emailAddress.setPrimary(primary);
  emailAddressPersistence.update(emailAddress);
  return emailAddress;
}
