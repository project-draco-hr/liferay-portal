{
  ServletContext ctx=(ServletContext)req.getAttribute(WebKeys.CTX);
  String ajaxId=req.getParameter("ajax_id");
  long companyId=PortalUtil.getCompanyId(req);
  User user=PortalUtil.getUser(req);
  Layout layout=(Layout)req.getAttribute(WebKeys.LAYOUT);
  String portletId=ParamUtil.getString(req,"p_p_id");
  Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletId);
  String queryString=null;
  String columnId=ParamUtil.getString(req,"p_p_col_id");
  int columnPos=ParamUtil.getInteger(req,"p_p_col_pos");
  int columnCount=ParamUtil.getInteger(req,"p_p_col_count");
  boolean staticPortlet=ParamUtil.getBoolean(req,"p_p_static");
  boolean staticStartPortlet=ParamUtil.getBoolean(req,"p_p_static_start");
  if (staticPortlet) {
    portlet=(Portlet)portlet.clone();
    portlet.setStatic(true);
    portlet.setStaticStart(staticStartPortlet);
  }
  if (ajaxId != null) {
    res.setHeader("Ajax-ID",ajaxId);
  }
  WindowState windowState=WindowStateFactory.getWindowState(ParamUtil.getString(req,"p_p_state"));
  PortalUtil.updateWindowState(portletId,user,layout,windowState,req);
  PortalUtil.renderPortlet(null,ctx,req,res,portlet,queryString,columnId,new Integer(columnPos),new Integer(columnCount));
  return null;
}
