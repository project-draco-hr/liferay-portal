{
  List<FrameworkFactory> frameworkFactories=ServiceLoader.load(FrameworkFactory.class);
  if (frameworkFactories.isEmpty()) {
    return;
  }
  FrameworkFactory frameworkFactory=frameworkFactories.get(0);
  Map<String,String> properties=buildProperties();
  _framework=frameworkFactory.newFramework(properties);
  _framework.init();
  BundleContext bundleContext=_framework.getBundleContext();
  BundleListener bundleListener=new BundleListener();
  bundleContext.addBundleListener(bundleListener);
  FrameworkListener frameworkListener=new FrameworkListener();
  bundleContext.addFrameworkListener(frameworkListener);
  ServiceListener serviceListener=new ServiceListener(bundleContext);
  bundleContext.addServiceListener(serviceListener,_PORTAL_SERVICE_FILTER);
  registerApplicationContext((ApplicationContext)applicationContext);
}
