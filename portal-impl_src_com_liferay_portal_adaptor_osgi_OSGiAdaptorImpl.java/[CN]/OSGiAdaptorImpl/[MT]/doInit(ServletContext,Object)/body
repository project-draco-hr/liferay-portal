{
  List<FrameworkFactory> frameworkFactories=ServiceLoader.load(FrameworkFactory.class);
  if (frameworkFactories.isEmpty()) {
    return;
  }
  FrameworkFactory frameworkFactory=frameworkFactories.get(0);
  Map<String,String> properties=buildProperties();
  _framework=frameworkFactory.newFramework(properties);
  _framework.init();
  BundleContext bundleContext=_framework.getBundleContext();
  bundleContext.addServiceListener(new ServiceListener(bundleContext),_PORTAL_SERVICE_FILTER);
  registerApplicationContext((ApplicationContext)applicationContext);
}
