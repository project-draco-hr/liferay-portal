{
  String findByAndCategoryIdsSQL=CustomSQLUtil.get(FIND_BY_AND_CATEGORY_IDS);
  sb.append(" AND (");
  for (int i=0; i < categoryIds.length; i++) {
    sb.append("NOT ");
    String sql=null;
    if (PropsValues.ASSET_CATEGORIES_SEARCH_HIERARCHICAL) {
      List<Long> treeCategoryIds=getSubcategoryIds(categoryIds[i]);
      if (treeCategoryIds.size() > 1) {
        sql=StringUtil.replace(findByAndCategoryIdsSQL,"[$CATEGORY_ID$]",StringUtil.merge(treeCategoryIds));
      }
    }
    if (sql == null) {
      sql=StringUtil.replace(findByAndCategoryIdsSQL," IN ([$CATEGORY_ID$])"," = " + categoryIds[i]);
    }
    sb.append(sql);
    if ((i + 1) < categoryIds.length) {
      sb.append(" OR ");
    }
  }
  sb.append(StringPool.CLOSE_PARENTHESIS);
}
