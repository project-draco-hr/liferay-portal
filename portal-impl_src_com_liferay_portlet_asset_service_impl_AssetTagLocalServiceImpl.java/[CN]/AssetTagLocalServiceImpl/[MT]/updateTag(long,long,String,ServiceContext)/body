{
  AssetTag tag=assetTagPersistence.findByPrimaryKey(tagId);
  String oldName=tag.getName();
  tag.setModifiedDate(new Date());
  name=name.trim();
  name=StringUtil.toLowerCase(name);
  if (!name.equals(tag.getName()) && hasTag(tag.getGroupId(),name)) {
    throw new DuplicateTagException("A tag with the name " + name + " already exists");
  }
  if (!tag.getName().equals(name)) {
    try {
      AssetTag existingAssetTag=getTag(tag.getGroupId(),name);
      if (existingAssetTag.getTagId() != tagId) {
        throw new DuplicateTagException("A tag with the name " + name + " already exists");
      }
    }
 catch (    NoSuchTagException nste) {
    }
  }
  validate(name);
  tag.setName(name);
  assetTagPersistence.update(tag);
  if (!oldName.equals(name)) {
    List<AssetEntry> entries=assetTagPersistence.getAssetEntries(tag.getTagId());
    assetEntryLocalService.reindex(entries);
  }
  return tag;
}
