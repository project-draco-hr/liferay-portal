{
  StringBuilder sb=new StringBuilder();
  boolean checkKey1=key.contains(KEY1);
  boolean checkKey2=key.contains(KEY2);
  boolean checkKey3=key.contains(KEY3);
  boolean usesKey1=true;
  boolean usesKey2=true;
  boolean usesKey3=true;
  String password=StringPool.BLANK;
  do {
    for (int i=0; i < length; i++) {
      sb.append(key.charAt((int)(Math.random() * key.length())));
    }
    password=sb.toString();
    if (checkKey1) {
      usesKey1=Validator.isNotNull(StringUtil.extractDigits(password));
    }
    if (checkKey2) {
      usesKey2=!password.equals(password.toLowerCase());
    }
    if (checkKey3) {
      usesKey3=!password.equals(password.toUpperCase());
    }
    sb.setLength(0);
  }
 while (useAllKeys && (!usesKey1 || !usesKey2 || !usesKey3));
  return password;
}
