{
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < length; i++) {
    sb.append(key.charAt((int)(Math.random() * key.length())));
  }
  String password=sb.toString();
  if (!useAllKeys) {
    return password;
  }
  boolean invalidPassword=false;
  if (key.contains(KEY1)) {
    if (Validator.isNull(StringUtil.extractDigits(password))) {
      invalidPassword=true;
    }
  }
  if (key.contains(KEY2)) {
    if (password.equals(password.toLowerCase())) {
      invalidPassword=true;
    }
  }
  if (key.contains(KEY3)) {
    if (password.equals(password.toUpperCase())) {
      invalidPassword=true;
    }
  }
  if (invalidPassword) {
    return _getPassword(key,length,useAllKeys);
  }
  return password;
}
