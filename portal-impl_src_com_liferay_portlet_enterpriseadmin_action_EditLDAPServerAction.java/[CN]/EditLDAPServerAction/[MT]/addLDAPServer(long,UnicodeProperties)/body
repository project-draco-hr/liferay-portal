{
  long ldapServerId=CounterLocalServiceUtil.increment();
  String postfix=PortalLDAPUtil.getPropertyPostfix(ldapServerId);
  String[] keys=properties.keySet().toArray(new String[0]);
  for (  String key : keys) {
    if (ArrayUtil.contains(_LDAP_SERVER_PREF_KEYS,key)) {
      String value=properties.remove(key);
      properties.setProperty(key + postfix,value);
    }
  }
  PortletPreferences preferences=PrefsPropsUtil.getPreferences(companyId);
  String ldapServerIds=preferences.getValue("ldap.server.ids",StringPool.BLANK);
  ldapServerIds=StringUtil.add(ldapServerIds,String.valueOf(ldapServerId));
  properties.setProperty("ldap.server.ids",ldapServerIds);
  return properties;
}
