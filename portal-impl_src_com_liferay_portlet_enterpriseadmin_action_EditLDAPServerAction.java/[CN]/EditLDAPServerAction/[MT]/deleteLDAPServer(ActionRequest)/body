{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long ldapServerId=ParamUtil.getLong(actionRequest,"ldapServerId");
  String postfix=PortalLDAPUtil.getPropertyPostfix(ldapServerId);
  String[] keys=new String[_LDAP_SERVER_PREF_KEYS.length];
  for (int i=0; i < _LDAP_SERVER_PREF_KEYS.length; i++) {
    keys[i]=_LDAP_SERVER_PREF_KEYS[i] + postfix;
  }
  CompanyServiceUtil.removePreferences(themeDisplay.getCompanyId(),keys);
  PortletPreferences preferences=PrefsPropsUtil.getPreferences(themeDisplay.getCompanyId());
  UnicodeProperties properties=new UnicodeProperties();
  String ldapServerIds=preferences.getValue("ldap.server.ids",StringPool.BLANK);
  ldapServerIds=StringUtil.remove(ldapServerIds,String.valueOf(ldapServerId));
  properties.put("ldap.server.ids",ldapServerIds);
  CompanyServiceUtil.updatePreferences(themeDisplay.getCompanyId(),properties);
}
