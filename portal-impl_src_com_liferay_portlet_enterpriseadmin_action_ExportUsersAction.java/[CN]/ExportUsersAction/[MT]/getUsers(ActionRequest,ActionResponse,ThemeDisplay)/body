{
  PortletURL portletURL=((ActionResponseImpl)actionResponse).createRenderURL(PortletKeys.ENTERPRISE_ADMIN_USERS);
  UserSearch userSearch=new UserSearch(actionRequest,portletURL);
  UserSearchTerms searchTerms=(UserSearchTerms)userSearch.getSearchTerms();
  if (!searchTerms.isAdvancedSearch() && !searchTerms.hasActive()) {
    searchTerms.setActive(Boolean.TRUE);
  }
  LinkedHashMap<String,Object> params=new LinkedHashMap<String,Object>();
  long organizationId=searchTerms.getOrganizationId();
  if (organizationId > 0) {
    params.put("usersOrgs",new Long(organizationId));
  }
  long roleId=searchTerms.getRoleId();
  if (roleId > 0) {
    params.put("usersRoles",new Long(roleId));
  }
  long userGroupId=searchTerms.getUserGroupId();
  if (userGroupId > 0) {
    params.put("usersUserGroups",new Long(userGroupId));
  }
  if (searchTerms.isAdvancedSearch()) {
    return UserLocalServiceUtil.search(themeDisplay.getCompanyId(),searchTerms.getFirstName(),searchTerms.getMiddleName(),searchTerms.getLastName(),searchTerms.getScreenName(),searchTerms.getEmailAddress(),searchTerms.getActive(),params,searchTerms.isAndOperator(),userSearch.getStart(),userSearch.getEnd(),(OrderByComparator)null);
  }
 else {
    return UserLocalServiceUtil.search(themeDisplay.getCompanyId(),searchTerms.getKeywords(),searchTerms.getActive(),params,userSearch.getStart(),userSearch.getEnd(),(OrderByComparator)null);
  }
}
