{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  RequestBackedPortletURLFactory requestBackedPortletURLFactory=RequestBackedPortletURLFactoryUtil.create(portletRequest);
  Map<String,String[]> parameters=portletRequest.getParameterMap();
  String itemSelectedEventName=getValue(parameters,PARAMETER_ITEM_SELECTED_EVENT_NAME);
  List<ItemSelectorViewRenderer> itemSelectorViewRenderers=new ArrayList<>();
  List<ItemSelectorCriterion> itemSelectorCriteria=getItemSelectorCriteria(parameters);
  ItemSelectorCriterion[] itemSelectorCriteriaArray=itemSelectorCriteria.toArray(new ItemSelectorCriterion[itemSelectorCriteria.size()]);
  for (int i=0; i < itemSelectorCriteria.size(); i++) {
    ItemSelectorCriterion itemSelectorCriterion=itemSelectorCriteria.get(i);
    Class<? extends ItemSelectorCriterion> itemSelectorCriterionClass=itemSelectorCriterion.getClass();
    ItemSelectorCriterionHandler<ItemSelectorCriterion> itemSelectorCriterionHandler=_itemSelectionCriterionHandlers.get(itemSelectorCriterionClass.getName());
    List<ItemSelectorView<ItemSelectorCriterion>> itemSelectorViews=itemSelectorCriterionHandler.getItemSelectorViews(itemSelectorCriterion);
    for (    ItemSelectorView<ItemSelectorCriterion> itemSelectorView : itemSelectorViews) {
      if (!itemSelectorView.isVisible(themeDisplay)) {
        continue;
      }
      PortletURL portletURL=getItemSelectorURL(requestBackedPortletURLFactory,itemSelectedEventName,itemSelectorCriteriaArray);
      String title=itemSelectorView.getTitle(portletRequest.getLocale());
      portletURL.setParameter(PARAMETER_SELECTED_TAB,title);
      itemSelectorViewRenderers.add(new ItemSelectorViewRendererImpl(itemSelectorView,itemSelectorCriterion,portletURL,itemSelectedEventName,isSearch(portletRequest)));
    }
  }
  return new ItemSelectorRenderingImpl(itemSelectedEventName,getValue(parameters,PARAMETER_SELECTED_TAB),itemSelectorViewRenderers);
}
