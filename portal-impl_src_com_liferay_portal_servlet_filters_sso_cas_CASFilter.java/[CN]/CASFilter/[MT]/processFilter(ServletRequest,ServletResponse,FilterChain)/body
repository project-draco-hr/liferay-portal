{
  try {
    HttpServletRequest httpReq=(HttpServletRequest)req;
    long companyId=PortalUtil.getCompanyId(httpReq);
    if (PrefsPropsUtil.getBoolean(companyId,PropsKeys.CAS_AUTH_ENABLED,PropsValues.CAS_AUTH_ENABLED)) {
      String pathInfo=httpReq.getPathInfo();
      if (pathInfo.indexOf("/portal/logout") != -1) {
        HttpServletResponse httpRes=(HttpServletResponse)res;
        HttpSession httpSes=httpReq.getSession();
        httpSes.invalidate();
        String logoutUrl=PrefsPropsUtil.getString(companyId,PropsKeys.CAS_LOGOUT_URL);
        httpRes.sendRedirect(logoutUrl);
      }
 else {
        Filter casFilter=getCASFilter(companyId);
        casFilter.doFilter(req,res,chain);
      }
    }
 else {
      processFilter(CASFilter.class,req,res,chain);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
