{
  try {
    long companyId=PortalUtil.getCompanyId(request);
    if (PrefsPropsUtil.getBoolean(companyId,PropsKeys.CAS_AUTH_ENABLED,PropsValues.CAS_AUTH_ENABLED)) {
      String pathInfo=request.getPathInfo();
      if (pathInfo.indexOf("/portal/logout") != -1) {
        HttpSession session=request.getSession();
        session.invalidate();
        String logoutUrl=PrefsPropsUtil.getString(companyId,PropsKeys.CAS_LOGOUT_URL,PropsValues.CAS_LOGOUT_URL);
        response.sendRedirect(logoutUrl);
      }
 else {
        Filter casFilter=getCASFilter(companyId);
        casFilter.doFilter(request,response,filterChain);
      }
    }
 else {
      processFilter(CASFilter.class,request,response,filterChain);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
