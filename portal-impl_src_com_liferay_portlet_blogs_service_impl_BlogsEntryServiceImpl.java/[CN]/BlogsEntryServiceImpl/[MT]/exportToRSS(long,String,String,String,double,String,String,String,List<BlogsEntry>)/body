{
  ThemeDisplay themeDisplay=ThemeDisplayFactory.setup(companyId);
  SyndFeed syndFeed=new SyndFeedImpl();
  syndFeed.setFeedType(type + "_" + version);
  syndFeed.setTitle(name);
  syndFeed.setLink(feedURL);
  syndFeed.setDescription(description);
  List<SyndEntry> entries=new ArrayList<SyndEntry>();
  syndFeed.setEntries(entries);
  for (  BlogsEntry entry : blogsEntries) {
    String author=PortalUtil.getUserName(entry.getUserId(),entry.getUserName());
    String link=entryURL;
    if (link.endsWith("/blogs/rss")) {
      link=link.substring(0,link.length() - 3) + entry.getUrlTitle();
    }
 else {
      if (!link.endsWith("?")) {
        link+="&";
      }
      link+="entryId=" + entry.getEntryId();
    }
    String value=null;
    if (displayStyle.equals(RSSUtil.DISPLAY_STYLE_ABSTRACT)) {
      value=StringUtil.shorten(HtmlUtil.extractText(entry.getContent()),_RSS_ABSTRACT_LENGTH,StringPool.BLANK);
    }
 else     if (displayStyle.equals(RSSUtil.DISPLAY_STYLE_TITLE)) {
      value=StringPool.BLANK;
    }
 else {
      value=StringUtil.replace(entry.getContent(),new String[]{"src=\"/","href=\"/"},new String[]{"src=\"" + themeDisplay.getURLPortal() + "/","href=\"" + themeDisplay.getURLPortal() + "/"});
    }
    SyndEntry syndEntry=new SyndEntryImpl();
    syndEntry.setAuthor(author);
    syndEntry.setTitle(entry.getTitle());
    syndEntry.setLink(link);
    syndEntry.setPublishedDate(entry.getCreateDate());
    SyndContent syndContent=new SyndContentImpl();
    syndContent.setType("html");
    syndContent.setValue(value);
    syndEntry.setDescription(syndContent);
    entries.add(syndEntry);
  }
  try {
    return RSSUtil.export(syndFeed);
  }
 catch (  FeedException fe) {
    throw new SystemException(fe);
  }
catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
