{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String portletResourceNamespace=ParamUtil.getString(portletRequest,"portletResourceNamespace");
  long classNameId=ParamUtil.getLong(portletRequest,"classNameId");
  long classPK=ParamUtil.getLong(portletRequest,"classPK");
  String structureAvailableFields=ParamUtil.getString(portletRequest,"structureAvailableFields");
  PortletURLImpl portletURL=new PortletURLImpl(portletRequest,themeDisplay.getPpid(),themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  portletURL.setParameter("mvcPath","/edit_template.jsp");
  portletURL.setParameter("redirect",redirect,false);
  portletURL.setParameter("portletResourceNamespace",portletResourceNamespace,false);
  portletURL.setParameter("templateId",String.valueOf(template.getTemplateId()),false);
  portletURL.setParameter("groupId",String.valueOf(template.getGroupId()),false);
  portletURL.setParameter("classNameId",String.valueOf(classNameId),false);
  portletURL.setParameter("classPK",String.valueOf(classPK),false);
  portletURL.setParameter("type",template.getType(),false);
  portletURL.setParameter("structureAvailableFields",structureAvailableFields,false);
  portletURL.setWindowState(portletRequest.getWindowState());
  return portletURL.toString();
}
