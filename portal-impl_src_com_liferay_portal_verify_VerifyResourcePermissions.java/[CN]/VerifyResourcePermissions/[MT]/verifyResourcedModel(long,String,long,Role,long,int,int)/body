{
  if (_log.isInfoEnabled() && ((cur % 100) == 0)) {
    _log.info("Processed " + cur + " of "+ total+ " resource permissions "+ "for company = "+ companyId+ " and model "+ modelName);
  }
  ResourcePermission resourcePermission=null;
  try {
    resourcePermission=ResourcePermissionLocalServiceUtil.getResourcePermission(companyId,modelName,ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(primKey),role.getRoleId());
  }
 catch (  NoSuchResourcePermissionException nsrpe) {
    if (_log.isDebugEnabled()) {
      _log.debug("No resource found for {" + companyId + ", "+ modelName+ ", "+ ResourceConstants.SCOPE_INDIVIDUAL+ ", "+ primKey+ ", "+ role.getRoleId()+ "}");
    }
    ResourceLocalServiceUtil.addResources(companyId,0,ownerId,modelName,String.valueOf(primKey),false,false,false);
  }
  if (resourcePermission == null) {
    try {
      resourcePermission=ResourcePermissionLocalServiceUtil.getResourcePermission(companyId,modelName,ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(primKey),role.getRoleId());
    }
 catch (    NoSuchResourcePermissionException nsrpe) {
      return;
    }
  }
  if (modelName.equals(User.class.getName())) {
    User user=UserLocalServiceUtil.fetchUserById(ownerId);
    if (user != null) {
      Contact contact=ContactLocalServiceUtil.fetchContact(user.getContactId());
      if (contact != null) {
        ownerId=contact.getUserId();
      }
    }
  }
  if (ownerId != resourcePermission.getOwnerId()) {
    resourcePermission.setOwnerId(ownerId);
    ResourcePermissionLocalServiceUtil.updateResourcePermission(resourcePermission);
  }
}
