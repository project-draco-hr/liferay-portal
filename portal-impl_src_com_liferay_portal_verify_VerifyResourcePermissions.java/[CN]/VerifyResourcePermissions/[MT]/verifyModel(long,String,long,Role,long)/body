{
  ResourcePermission resourcePermission=null;
  try {
    resourcePermission=ResourcePermissionLocalServiceUtil.getResourcePermission(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(primKey),role.getRoleId());
  }
 catch (  NoSuchResourcePermissionException nsrpe) {
    if (_log.isDebugEnabled()) {
      _log.debug("No resource found for {" + companyId + ", "+ name+ ", "+ ResourceConstants.SCOPE_INDIVIDUAL+ ", "+ primKey+ ", "+ role.getRoleId()+ "}");
    }
    ResourceLocalServiceUtil.addResources(companyId,0,ownerId,name,String.valueOf(primKey),false,false,false);
  }
  if (resourcePermission == null) {
    try {
      resourcePermission=ResourcePermissionLocalServiceUtil.getResourcePermission(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(primKey),role.getRoleId());
    }
 catch (    NoSuchResourcePermissionException nsrpe) {
      return;
    }
  }
  if (name.equals(User.class.getName())) {
    User user=UserLocalServiceUtil.getUserById(ownerId);
    Contact contact=ContactLocalServiceUtil.getContact(user.getContactId());
    ownerId=contact.getUserId();
  }
  if (ownerId != resourcePermission.getOwnerId()) {
    resourcePermission.setOwnerId(ownerId);
    ResourcePermissionLocalServiceUtil.updateResourcePermission(resourcePermission);
  }
  if (_log.isInfoEnabled() && ((resourcePermission.getResourcePermissionId() % 100) == 0)) {
    _log.info("Processed 100 resource permissions for " + name);
  }
}
