{
  if (_closed) {
    throw new IOException();
  }
  if (_bufferedOutput instanceof ByteArrayMaker) {
    byte[] compressedBytes=getCompressedBytes();
    _response.setContentLength(compressedBytes.length);
    _response.addHeader(_CONTENT_ENCODING,_GZIP);
    _output.write(compressedBytes);
    _output.flush();
    _output.close();
    _closed=true;
  }
 else   if (_bufferedOutput instanceof GZIPOutputStream) {
    GZIPOutputStream gzipOutput=(GZIPOutputStream)_bufferedOutput;
    gzipOutput.finish();
    _output.flush();
    _output.close();
    _closed=true;
  }
}
