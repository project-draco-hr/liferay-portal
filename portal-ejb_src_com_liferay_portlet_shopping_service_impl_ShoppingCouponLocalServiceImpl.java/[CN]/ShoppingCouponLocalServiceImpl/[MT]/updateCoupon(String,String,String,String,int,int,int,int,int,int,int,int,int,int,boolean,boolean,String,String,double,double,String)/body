{
  User user=UserUtil.findByPrimaryKey(userId);
  couponId=couponId.trim().toUpperCase();
  ShoppingCoupon coupon=ShoppingCouponUtil.findByPrimaryKey(couponId);
  Date startDate=PortalUtil.getDate(startDateMonth,startDateDay,startDateYear,startDateHour,startDateMinute,user.getTimeZone(),new CouponStartDateException());
  Date endDate=null;
  if (!neverExpire) {
    endDate=PortalUtil.getDate(endDateMonth,endDateDay,endDateYear,endDateHour,endDateMinute,user.getTimeZone(),new CouponEndDateException());
  }
  if ((endDate != null) && (startDate.after(endDate))) {
    throw new CouponDateException();
  }
  validate(coupon.getCompanyId(),coupon.getGroupId(),name,description,limitCategories,limitSkus);
  coupon.setModifiedDate(new Date());
  coupon.setName(name);
  coupon.setDescription(description);
  coupon.setStartDate(startDate);
  coupon.setEndDate(endDate);
  coupon.setActive(active);
  coupon.setLimitCategories(limitCategories);
  coupon.setLimitSkus(limitSkus);
  coupon.setMinOrder(minOrder);
  coupon.setDiscount(discount);
  coupon.setDiscountType(discountType);
  ShoppingCouponUtil.update(coupon);
  return coupon;
}
