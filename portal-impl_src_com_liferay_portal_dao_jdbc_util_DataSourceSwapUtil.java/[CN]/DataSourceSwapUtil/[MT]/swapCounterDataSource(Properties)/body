{
  DataSource newDataSource=DataSourceFactoryUtil.initDataSource(properties);
  if (_log.isInfoEnabled()) {
    _log.info("Create new Counter DataSource : " + newDataSource);
  }
  DataSource oldDataSource=_counterDataSourceWrapper.getWrappedDataSource();
  _counterDataSourceWrapper.setWrappedDataSource(newDataSource);
  if (_log.isInfoEnabled()) {
    _log.info("New Counter DataSource installed.");
  }
  DataSourceFactoryUtil.destroyDataSource(oldDataSource);
  if (_log.isInfoEnabled()) {
    _log.info("Destroyed old Counter DataSource.");
  }
  if (_isJPA) {
    rebuildJPAEntityManagerFactory("counterSessionFactory",newDataSource);
  }
 else {
    rebuildHibernateSessionFactory("counterSessionFactory",newDataSource);
  }
}
