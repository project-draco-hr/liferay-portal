{
  DataSource newDataSource=DataSourceFactoryUtil.initDataSource(properties);
  if (_log.isInfoEnabled()) {
    _log.info("Create new Portal DataSource : " + newDataSource);
  }
  DataSource oldDataSource=_portalDataSourceWrapper.getWrappedDataSource();
  _portalDataSourceWrapper.setWrappedDataSource(newDataSource);
  if (_log.isInfoEnabled()) {
    _log.info("New Portal DataSource installed.");
  }
  DataSourceFactoryUtil.destroyDataSource(oldDataSource);
  if (_log.isInfoEnabled()) {
    _log.info("Destroyed old Portal DataSource.");
  }
  if (_isJPA) {
    rebuildJPAEntityManagerFactory("liferaySessionFactory",newDataSource);
  }
 else {
    rebuildHibernateSessionFactory("liferaySessionFactory",newDataSource);
  }
}
