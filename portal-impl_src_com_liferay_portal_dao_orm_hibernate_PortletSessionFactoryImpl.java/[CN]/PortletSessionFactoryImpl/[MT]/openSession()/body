{
  SessionFactoryImplementor sessionFactoryImplementor=getSessionFactoryImplementor();
  org.hibernate.Session session=null;
  if (PropsValues.SPRING_HIBERNATE_SESSION_DELEGATED) {
    Connection connection=CurrentConnectionUtil.getConnection(_dataSource);
    if (connection == null) {
      session=sessionFactoryImplementor.getCurrentSession();
    }
 else {
      session=sessionFactoryImplementor.openSession(connection);
    }
  }
 else {
    session=sessionFactoryImplementor.openSession();
  }
  if (_log.isDebugEnabled()) {
    org.hibernate.impl.SessionImpl sessionImpl=(org.hibernate.impl.SessionImpl)session;
    _log.debug("Session is using connection release mode " + sessionImpl.getConnectionReleaseMode());
  }
  return wrapSession(session);
}
