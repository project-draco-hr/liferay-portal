{
  AccessControlUtil.initAccessControlContext(request,response);
  AuthVerifierResult.State verificationState=AccessControlUtil.verifyRequest();
  AccessControlContext accessControlContext=AccessControlUtil.getAccessControlContext();
  AuthVerifierResult verificationResult=accessControlContext.getVerificationResult();
  if (_log.isDebugEnabled()) {
    _log.debug("Verification result: " + verificationResult);
  }
switch (verificationState) {
case INVALID_CREDENTIALS:
{
      if (_log.isDebugEnabled()) {
        _log.debug("Result state doesn't allow us to continue.");
      }
      return;
    }
case NOT_APPLICABLE:
case SUCCESS:
{
    long userId=verificationResult.getUserId();
    AccessControlUtil.initContextUser(userId);
    HttpServletRequest protectedServletRequest=new ProtectedServletRequest(request,String.valueOf(userId));
    accessControlContext.setRequest(protectedServletRequest);
    processFilter(getClass(),protectedServletRequest,response,filterChain);
    return;
  }
default :
{
  _log.error("Unimplemented state, returning.");
  return;
}
}
}
