{
  LayoutSet layoutSet=layoutSetPersistence.findByG_P(groupId,privateLayout);
  if (Validator.isNull(themeId)) {
    themeId=ThemeFactoryUtil.getDefaultRegularThemeId(layoutSet.getCompanyId());
  }
  if (Validator.isNull(colorSchemeId)) {
    colorSchemeId=ColorSchemeFactoryUtil.getDefaultRegularColorSchemeId();
  }
  LayoutSetBranch layoutSetBranch=_getLayoutSetBranch(layoutSet);
  if (layoutSetBranch == null) {
    layoutSet.setColorSchemeId(colorSchemeId);
    layoutSet.setCss(css);
    layoutSet.setModifiedDate(new Date());
    layoutSet.setThemeId(themeId);
    layoutSetPersistence.update(layoutSet);
    if (PrefsPropsUtil.getBoolean(PropsKeys.THEME_SYNC_ON_GROUP,PropsValues.THEME_SYNC_ON_GROUP)) {
      LayoutSet otherLayoutSet=layoutSetPersistence.findByG_P(layoutSet.getGroupId(),layoutSet.isPrivateLayout());
      otherLayoutSet.setThemeId(themeId);
      otherLayoutSet.setColorSchemeId(colorSchemeId);
      layoutSetPersistence.update(otherLayoutSet);
    }
    return layoutSet;
  }
  layoutSetBranch.setColorSchemeId(colorSchemeId);
  layoutSetBranch.setCss(css);
  layoutSetBranch.setModifiedDate(new Date());
  layoutSetBranch.setThemeId(themeId);
  layoutSetBranchPersistence.update(layoutSetBranch);
  return layoutSet;
}
