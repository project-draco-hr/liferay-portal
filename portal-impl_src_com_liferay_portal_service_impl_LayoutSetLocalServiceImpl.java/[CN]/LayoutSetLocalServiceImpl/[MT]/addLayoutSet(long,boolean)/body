{
  Group group=groupPersistence.findByPrimaryKey(groupId);
  Date now=new Date();
  long layoutSetId=counterLocalService.increment();
  LayoutSet layoutSet=layoutSetPersistence.create(layoutSetId);
  layoutSet.setGroupId(groupId);
  layoutSet.setCompanyId(group.getCompanyId());
  layoutSet.setCreateDate(now);
  layoutSet.setModifiedDate(now);
  layoutSet.setPrivateLayout(privateLayout);
  if (group.isStagingGroup()) {
    LayoutSet liveLayoutSet=null;
    Group liveGroup=group.getLiveGroup();
    if (privateLayout) {
      liveLayoutSet=liveGroup.getPrivateLayoutSet();
    }
 else {
      liveLayoutSet=liveGroup.getPublicLayoutSet();
    }
    layoutSet.setLogo(liveLayoutSet.getLogo());
    layoutSet.setLogoId(liveLayoutSet.getLogoId());
    if (liveLayoutSet.isLogo()) {
      Image logoImage=imageLocalService.getImage(liveLayoutSet.getLogoId());
      long logoId=counterLocalService.increment();
      imageLocalService.updateImage(logoId,logoImage.getTextObj(),logoImage.getType(),logoImage.getHeight(),logoImage.getWidth(),logoImage.getSize());
      layoutSet.setLogoId(logoId);
    }
    layoutSet.setThemeId(liveLayoutSet.getThemeId());
    layoutSet.setColorSchemeId(liveLayoutSet.getColorSchemeId());
    layoutSet.setWapThemeId(liveLayoutSet.getWapThemeId());
    layoutSet.setWapColorSchemeId(liveLayoutSet.getWapColorSchemeId());
    layoutSet.setCss(liveLayoutSet.getCss());
    layoutSet.setSettings(liveLayoutSet.getSettings());
  }
 else {
    layoutSet.setThemeId(ThemeImpl.getDefaultRegularThemeId(group.getCompanyId()));
    layoutSet.setColorSchemeId(ColorSchemeImpl.getDefaultRegularColorSchemeId());
    layoutSet.setWapThemeId(ThemeImpl.getDefaultWapThemeId(group.getCompanyId()));
    layoutSet.setWapColorSchemeId(ColorSchemeImpl.getDefaultWapColorSchemeId());
    layoutSet.setCss(StringPool.BLANK);
    layoutSet.setSettings(StringPool.BLANK);
  }
  layoutSetPersistence.update(layoutSet);
  return layoutSet;
}
