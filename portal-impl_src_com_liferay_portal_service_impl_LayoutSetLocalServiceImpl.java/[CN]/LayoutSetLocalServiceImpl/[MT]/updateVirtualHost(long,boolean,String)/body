{
  virtualHost=virtualHost.trim().toLowerCase();
  if (Validator.isNotNull(virtualHost) && !Validator.isDomain(virtualHost)) {
    throw new LayoutSetVirtualHostException("{exception=DomainNameException}");
  }
  LayoutSet layoutSet=layoutSetPersistence.findByG_P(groupId,privateLayout);
  if (Validator.isNotNull(virtualHost)) {
    try {
      LayoutSet layoutSetVirtualHost=getLayoutSetByVirtualHost(virtualHost);
      String[] vhParts=StringUtil.split(virtualHost,StringPool.PERIOD);
      String[] lsvhParts=StringUtil.split(layoutSetVirtualHost.getVirtualHost(),StringPool.PERIOD);
      if (!layoutSet.equals(layoutSetVirtualHost) && lsvhParts[0].equals(vhParts[0])) {
        throw new LayoutSetVirtualHostException("{exception=AlreadyInUseException,subject=" + virtualHost + "}");
      }
    }
 catch (    NoSuchLayoutSetException nslse) {
    }
    try {
      Company company=companyLocalService.getCompanyByVirtualHost(virtualHost);
      if (company.getCompanyId() != layoutSet.getCompanyId()) {
        throw new LayoutSetVirtualHostException("{exception=AlreadyInUseException,subject=" + virtualHost + "}");
      }
 else {
        if (company.isAllowWildcard()) {
          throw new LayoutSetVirtualHostException("{exception=LayoutSetSubDomainException,subject=" + virtualHost + "}");
        }
      }
    }
 catch (    NoSuchCompanyException nsce) {
    }
  }
  layoutSet.setVirtualHost(virtualHost);
  layoutSetPersistence.update(layoutSet,false);
  return layoutSet;
}
