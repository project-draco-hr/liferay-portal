{
  validate(groupId,privateLayout,virtualHostname);
  virtualHostname=virtualHostname.trim().toLowerCase();
  if (virtualHostname.startsWith(Http.HTTP_WITH_SLASH) || virtualHostname.startsWith(Http.HTTPS_WITH_SLASH)) {
    throw new LayoutSetVirtualHostException();
  }
  LayoutSet layoutSet=layoutSetPersistence.findByG_P(groupId,privateLayout);
  if (Validator.isNotNull(virtualHostname)) {
    try {
      VirtualHost virtualHost=virtualHostPersistence.findByHostname(virtualHostname);
      if ((virtualHost.getCompanyId() != layoutSet.getCompanyId()) || (virtualHost.getLayoutSetId() != layoutSet.getLayoutSetId())) {
        throw new LayoutSetVirtualHostException();
      }
    }
 catch (    NoSuchVirtualHostException nsvhe) {
      virtualHostLocalService.updateVirtualHost(layoutSet.getCompanyId(),layoutSet.getLayoutSetId(),virtualHostname);
    }
  }
 else {
    try {
      virtualHostPersistence.removeByC_L(layoutSet.getCompanyId(),layoutSet.getLayoutSetId());
    }
 catch (    NoSuchVirtualHostException nsvhe) {
    }
  }
  return layoutSet;
}
