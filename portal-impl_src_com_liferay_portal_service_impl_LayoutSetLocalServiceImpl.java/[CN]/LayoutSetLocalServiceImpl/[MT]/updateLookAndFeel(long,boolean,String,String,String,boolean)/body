{
  LayoutSet layoutSet=layoutSetPersistence.findByG_P(groupId,privateLayout);
  Date now=new Date();
  layoutSet.setModifiedDate(now);
  if (Validator.isNull(themeId)) {
    themeId=ThemeImpl.getDefaultRegularThemeId(layoutSet.getCompanyId());
  }
  if (Validator.isNull(colorSchemeId)) {
    colorSchemeId=ColorSchemeImpl.getDefaultRegularColorSchemeId();
  }
  if (wapTheme) {
    layoutSet.setWapThemeId(themeId);
    layoutSet.setWapColorSchemeId(colorSchemeId);
  }
 else {
    layoutSet.setThemeId(themeId);
    layoutSet.setColorSchemeId(colorSchemeId);
    layoutSet.setCss(css);
  }
  layoutSetPersistence.update(layoutSet,false);
  if (PrefsPropsUtil.getBoolean(PropsKeys.THEME_SYNC_ON_GROUP,PropsValues.THEME_SYNC_ON_GROUP)) {
    LayoutSet otherLayoutSet=layoutSetPersistence.findByG_P(layoutSet.getGroupId(),layoutSet.isPrivateLayout());
    if (wapTheme) {
      otherLayoutSet.setWapThemeId(themeId);
      otherLayoutSet.setWapColorSchemeId(colorSchemeId);
    }
 else {
      otherLayoutSet.setThemeId(themeId);
      otherLayoutSet.setColorSchemeId(colorSchemeId);
    }
    layoutSetPersistence.update(otherLayoutSet,false);
  }
  return layoutSet;
}
