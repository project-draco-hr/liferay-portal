{
  PortletURLImpl portletURLImpl=(PortletURLImpl)portletURL;
  String portletId=portletURLImpl.getPortlet().getPortletId();
  String prefix=portletId;
  int pos=portletId.indexOf(PortletImpl.WAR_SEPARATOR);
  if (pos != -1) {
    prefix=portletId.substring(0,pos);
  }
  String appUrl=GetterUtil.get(portletURLImpl.getParameter("appURL"),"");
  portletURLImpl.addParameterIncludedInPath("p_p_id");
  return StringPool.SLASH + _MAPPING + StringPool.SLASH+ prefix+ StringPool.SLASH+ appUrl;
}
