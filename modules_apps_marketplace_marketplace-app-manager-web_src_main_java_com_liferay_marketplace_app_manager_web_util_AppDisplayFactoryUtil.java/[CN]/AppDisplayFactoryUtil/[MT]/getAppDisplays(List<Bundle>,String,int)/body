{
  Map<String,AppDisplay> appDisplaysMap=new HashMap<>();
  for (  Bundle bundle : bundles) {
    Dictionary<String,String> headers=bundle.getHeaders();
    if (Validator.isNotNull(category)) {
      String curCategory=headers.get(BundleConstants.LIFERAY_RELENG_CATEGORY);
      if (!category.equals(curCategory)) {
        continue;
      }
    }
    if ((state > 0) && (state != bundle.getState())) {
      continue;
    }
    String appName=headers.get(BundleConstants.LIFERAY_RELENG_APP_NAME);
    if (appName == null) {
      appName=AppDisplay.APP_NAME_UNCATEGORIZED;
    }
    AppDisplay appDisplay=appDisplaysMap.get(appName);
    if (appDisplay == null) {
      appDisplay=new AppDisplay(appName);
      appDisplaysMap.put(appName,appDisplay);
    }
    appDisplay.addBundle(bundle);
  }
  return ListUtil.fromMapValues(appDisplaysMap);
}
