{
  testPortlet=new ActionRequestTestPortlet();
  setUpPortlet(testPortlet,new HashMapDictionary<String,Object>(),TEST_PORTLET_ID);
  HttpServletRequest httpServletRequest=PortletContainerTestUtil.getHttpServletRequest(group,layout);
  Response response=PortletContainerTestUtil.getPortalAuthentication(httpServletRequest,layout,TEST_PORTLET_ID);
  testPortlet.reset();
  PortletURL portletURL=new PortletURLImpl(httpServletRequest,TEST_PORTLET_ID,layout.getPlid(),PortletRequest.ACTION_PHASE);
  String url=portletURL.toString();
  url=HttpUtil.removeParameter(url,"p_auth");
  Map<String,List<String>> headers=new HashMap<>();
  headers.put("Cookie",response.getCookies());
  headers.put("X-CSRF-Token",Collections.singletonList(response.getBody()));
  response=PortletContainerTestUtil.request(url,headers);
  Assert.assertEquals(200,response.getCode());
  Assert.assertTrue(testPortlet.isCalledAction());
}
