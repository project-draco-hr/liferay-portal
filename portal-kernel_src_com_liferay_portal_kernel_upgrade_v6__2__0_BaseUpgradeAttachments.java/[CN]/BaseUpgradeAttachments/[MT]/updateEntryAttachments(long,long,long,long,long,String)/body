{
  String[] attachments=getAttachments(companyId,containerModelId,resourcePrimKey);
  if (ArrayUtil.isEmpty(attachments)) {
    return;
  }
  Timestamp createDate=new Timestamp(System.currentTimeMillis());
  long repositoryId=getRepositoryId(groupId,companyId,userId,userName,createDate,PortalUtil.getClassNameId(_LIFERAY_REPOSITORY_CLASS_NAME),getPortletId());
  if (repositoryId < 0) {
    return;
  }
  long containerModelFolderId=getContainerModelFolderId(groupId,companyId,resourcePrimKey,containerModelId,userId,userName,createDate);
  if (containerModelFolderId < 0) {
    return;
  }
  for (  String attachment : attachments) {
    String name=String.valueOf(increment("com.liferay.portlet.documentlibrary.model.DLFileEntry"));
    String title=FileUtil.getShortFileName(attachment);
    String extension=FileUtil.getExtension(title);
    String mimeType=MimeTypesUtil.getExtensionContentType(extension);
    try {
      long size=DLStoreUtil.getFileSize(companyId,CompanyConstants.SYSTEM,attachment);
      long fileEntryId=addDLFileEntry(groupId,companyId,userId,getClassName(),resourcePrimKey,userName,createDate,repositoryId,containerModelFolderId,name,extension,mimeType,title,size);
      if (fileEntryId < 0) {
        continue;
      }
      addDLFileVersion(increment(),groupId,companyId,userId,userName,createDate,repositoryId,containerModelFolderId,fileEntryId,extension,mimeType,title,size);
      byte[] bytes=DLStoreUtil.getFileAsBytes(companyId,CompanyConstants.SYSTEM,attachment);
      DLStoreUtil.addFile(companyId,containerModelFolderId,name,false,bytes);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to add attachment " + attachment,e);
      }
    }
    try {
      DLStoreUtil.deleteFile(companyId,CompanyConstants.SYSTEM,attachment);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to delete attachment " + attachment,e);
      }
    }
  }
}
