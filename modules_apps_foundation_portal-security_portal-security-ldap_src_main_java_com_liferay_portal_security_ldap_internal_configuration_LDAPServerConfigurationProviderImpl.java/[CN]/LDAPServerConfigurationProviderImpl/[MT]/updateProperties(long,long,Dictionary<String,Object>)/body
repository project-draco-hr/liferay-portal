{
  if (properties == null) {
    properties=new HashMapDictionary<>();
  }
  properties.put(LDAPConstants.COMPANY_ID,companyId);
  properties.put(LDAPConstants.LDAP_SERVER_ID,ldapServerId);
  Map<Long,ObjectValuePair<Configuration,LDAPServerConfiguration>> objectValuePairs=_configurations.get(companyId);
  if (objectValuePairs == null) {
    objectValuePairs=new HashMap<>();
    _configurations.put(companyId,objectValuePairs);
  }
  try {
    ObjectValuePair<Configuration,LDAPServerConfiguration> objectValuePair=objectValuePairs.get(ldapServerId);
    Configuration configuration=null;
    if (objectValuePair == null) {
      configuration=configurationAdmin.createFactoryConfiguration(getMetatypeId(),StringPool.QUESTION);
    }
 else {
      configuration=objectValuePair.getKey();
    }
    configuration.update(properties);
  }
 catch (  IOException ioe) {
    throw new SystemException("Unable to update configuration",ioe);
  }
}
