{
  User user=UserUtil.findByPrimaryKey(userId);
  MBCategory category=MBCategoryUtil.findByPrimaryKey(categoryId);
  Date now=new Date();
  validate(name);
  String topicId=Long.toString(CounterServiceUtil.increment(MBTopic.class.getName()));
  MBTopic topic=MBTopicUtil.create(topicId);
  topic.setCompanyId(user.getCompanyId());
  topic.setUserId(user.getUserId());
  topic.setUserName(user.getFullName());
  topic.setCreateDate(now);
  topic.setModifiedDate(now);
  topic.setCategoryId(categoryId);
  topic.setName(name);
  topic.setDescription(description);
  MBTopicUtil.update(topic);
  addTopicResources(category,topic,addCommunityPermissions,addGuestPermissions);
  return topic;
}
