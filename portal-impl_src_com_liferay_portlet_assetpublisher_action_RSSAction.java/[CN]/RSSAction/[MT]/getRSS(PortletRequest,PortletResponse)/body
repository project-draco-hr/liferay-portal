{
  PortletPreferences preferences=portletRequest.getPreferences();
  String selectionStyle=preferences.getValue("selectionStyle","dynamic");
  if (!selectionStyle.equals("dynamic")) {
    return new byte[0];
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long[] groupIds=AssetPublisherUtil.getGroupIds(preferences,themeDisplay.getScopeGroupId(),themeDisplay.getLayout());
  boolean anyAssetType=GetterUtil.getBoolean(preferences.getValue("anyAssetType",Boolean.TRUE.toString()));
  String assetLinkBehavior=preferences.getValue("assetLinkBehavior","showFullContent");
  String orderByColumn1=GetterUtil.getString(preferences.getValue("orderByColumn1","modifiedDate"));
  String orderByColumn2=GetterUtil.getString(preferences.getValue("orderByColumn2","title"));
  String orderByType1=GetterUtil.getString(preferences.getValue("orderByType1","DESC"));
  String orderByType2=GetterUtil.getString(preferences.getValue("orderByType2","ASC"));
  boolean excludeZeroViewCount=GetterUtil.getBoolean(preferences.getValue("excludeZeroViewCount","0"));
  boolean enablePermissions=GetterUtil.getBoolean(preferences.getValue("enablePermissions",null));
  long[] classTypeIds=GetterUtil.getLongValues(preferences.getValues("classTypeIds",null));
  boolean showOnlyLayoutAssets=GetterUtil.getBoolean(preferences.getValue("showOnlyLayoutAssets",null));
  int rssDelta=GetterUtil.getInteger(preferences.getValue("rssDelta","20"));
  String rssDisplayStyle=preferences.getValue("rssDisplayStyle",RSSUtil.DISPLAY_STYLE_ABSTRACT);
  String rssFormat=preferences.getValue("rssFormat","atom10");
  String rssName=preferences.getValue("rssName",null);
  String rssFormatType=RSSUtil.getFormatType(rssFormat);
  double rssFormatVersion=RSSUtil.getFormatVersion(rssFormat);
  AssetEntryQuery assetEntryQuery=AssetPublisherUtil.getAssetEntryQuery(preferences,new long[]{themeDisplay.getScopeGroupId()});
  if (!anyAssetType) {
    long[] availableClassNameIds=AssetRendererFactoryRegistryUtil.getClassNameIds();
    long[] classNameIds=AssetPublisherUtil.getClassNameIds(preferences,availableClassNameIds);
    assetEntryQuery.setClassNameIds(classNameIds);
  }
  assetEntryQuery.setClassTypeIds(classTypeIds);
  assetEntryQuery.setEnablePermissions(enablePermissions);
  assetEntryQuery.setEnd(rssDelta);
  assetEntryQuery.setExcludeZeroViewCount(excludeZeroViewCount);
  assetEntryQuery.setGroupIds(groupIds);
  if (showOnlyLayoutAssets) {
    assetEntryQuery.setLayout(themeDisplay.getLayout());
  }
  assetEntryQuery.setOrderByCol1(orderByColumn1);
  assetEntryQuery.setOrderByCol2(orderByColumn2);
  assetEntryQuery.setOrderByType1(orderByType1);
  assetEntryQuery.setOrderByType2(orderByType2);
  assetEntryQuery.setStart(0);
  List<AssetEntry> assetEntries=AssetEntryServiceUtil.getEntries(assetEntryQuery);
  String rss=exportToRSS(portletRequest,portletResponse,rssName,null,rssFormatType,rssFormatVersion,rssDisplayStyle,assetLinkBehavior,assetEntries);
  return rss.getBytes(StringPool.UTF8);
}
