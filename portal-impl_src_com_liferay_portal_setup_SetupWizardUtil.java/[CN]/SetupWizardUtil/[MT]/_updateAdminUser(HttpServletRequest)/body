{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  User user=null;
  try {
    user=UserLocalServiceUtil.getUserByEmailAddress(PortalUtil.getDefaultCompanyId(),PropsValues.ADMIN_EMAIL_FROM_ADDRESS);
  }
 catch (  NoSuchUserException nsue) {
    user=UserLocalServiceUtil.getUserByEmailAddress(PortalUtil.getDefaultCompanyId(),"test@liferay.com");
    user=UserLocalServiceUtil.updateEmailAddress(user.getUserId(),StringPool.BLANK,PropsValues.ADMIN_EMAIL_FROM_ADDRESS,PropsValues.ADMIN_EMAIL_FROM_ADDRESS);
  }
  String greeting=LanguageUtil.format(themeDisplay.getLocale(),"welcome-x"," " + PropsValues.ADMIN_EMAIL_FROM_NAME,false);
  Contact contact=user.getContact();
  Calendar birthdayCal=CalendarFactoryUtil.getCalendar();
  birthdayCal.setTime(contact.getBirthday());
  int birthdayMonth=birthdayCal.get(Calendar.MONTH);
  int birthdayDay=birthdayCal.get(Calendar.DAY_OF_MONTH);
  int birthdayYear=birthdayCal.get(Calendar.YEAR);
  user=UserLocalServiceUtil.updateUser(user.getUserId(),StringPool.BLANK,StringPool.BLANK,StringPool.BLANK,false,user.getReminderQueryQuestion(),user.getReminderQueryAnswer(),user.getScreenName(),user.getEmailAddress(),user.getFacebookId(),user.getOpenId(),themeDisplay.getLanguageId(),user.getTimeZoneId(),greeting,user.getComments(),PropsValues.DEFAULT_ADMIN_FIRST_NAME,user.getMiddleName(),PropsValues.DEFAULT_ADMIN_LAST_NAME,contact.getPrefixId(),contact.getSuffixId(),contact.isMale(),birthdayMonth,birthdayDay,birthdayYear,contact.getSmsSn(),contact.getAimSn(),contact.getFacebookSn(),contact.getIcqSn(),contact.getJabberSn(),contact.getMsnSn(),contact.getMySpaceSn(),contact.getSkypeSn(),contact.getTwitterSn(),contact.getYmSn(),contact.getJobTitle(),null,null,null,null,null,new ServiceContext());
  user=UserLocalServiceUtil.updatePasswordReset(user.getUserId(),true);
  HttpSession session=request.getSession();
  session.setAttribute(WebKeys.SETUP_WIZARD_PASSWORD_UPDATED,true);
  session.setAttribute(WebKeys.USER_ID,user.getUserId());
}
