{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Company company=CompanyLocalServiceUtil.getCompanyById(themeDisplay.getCompanyId());
  String emailAddress=ParamUtil.getString(request,"adminEmailAddress",PropsValues.DEFAULT_ADMIN_EMAIL_ADDRESS_PREFIX + StringPool.AT + company.getMx());
  PropsValues.ADMIN_EMAIL_FROM_ADDRESS=emailAddress;
  unicodeProperties.put(PropsKeys.ADMIN_EMAIL_FROM_ADDRESS,emailAddress);
  String firstName=ParamUtil.getString(request,"adminFirstName",PropsValues.DEFAULT_ADMIN_FIRST_NAME);
  String lastName=ParamUtil.getString(request,"adminLastName",PropsValues.DEFAULT_ADMIN_LAST_NAME);
  User user=SetupWizardSampleDataUtil.updateAdminUser(company,themeDisplay.getLocale(),themeDisplay.getLanguageId(),emailAddress,firstName,lastName,true);
  PropsValues.ADMIN_EMAIL_FROM_NAME=user.getFullName();
  unicodeProperties.put(PropsKeys.ADMIN_EMAIL_FROM_NAME,user.getFullName());
  HttpSession session=request.getSession();
  session.setAttribute(WebKeys.EMAIL_ADDRESS,emailAddress);
  session.setAttribute(WebKeys.SETUP_WIZARD_PASSWORD_UPDATED,true);
  session.setAttribute(WebKeys.USER,user);
  session.setAttribute(WebKeys.USER_ID,user.getUserId());
  EventsProcessorUtil.process(PropsKeys.LOGIN_EVENTS_POST,PropsValues.LOGIN_EVENTS_POST,request,response);
}
