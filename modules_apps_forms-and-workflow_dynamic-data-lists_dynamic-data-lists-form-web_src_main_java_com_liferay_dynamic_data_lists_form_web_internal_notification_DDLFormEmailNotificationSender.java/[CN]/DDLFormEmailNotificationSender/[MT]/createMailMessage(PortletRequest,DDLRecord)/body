{
  DDLRecordSet recordSet=record.getRecordSet();
  String emailFromAddress=getEmailFromAddress(recordSet);
  String emailFromName=getEmailFromName(recordSet);
  InternetAddress fromInternetAddress=new InternetAddress(emailFromAddress,emailFromName);
  String subject=getEmailSubject(recordSet);
  String body=getEmailBody(portletRequest,recordSet,record);
  MailMessage mailMessage=new MailMessage(fromInternetAddress,subject,body,true);
  String emailToAddress=getEmailToAddress(recordSet);
  InternetAddress[] toAddresses=InternetAddress.parse(emailToAddress);
  mailMessage.setTo(toAddresses);
  return mailMessage;
}
