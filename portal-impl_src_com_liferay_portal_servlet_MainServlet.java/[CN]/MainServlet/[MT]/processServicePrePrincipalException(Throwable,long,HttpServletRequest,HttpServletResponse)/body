{
  if (userId > 0) {
    sendError(HttpServletResponse.SC_UNAUTHORIZED,t,request,response);
    return;
  }
  String redirect=request.getContextPath() + Portal.PATH_MAIN + "/portal/login";
  String currentURL=PortalUtil.getCurrentURL(request);
  redirect=HttpUtil.addParameter(redirect,"redirect",currentURL);
  long plid=ParamUtil.getLong(request,"p_l_id");
  if (plid > 0) {
    try {
      Layout layout=LayoutLocalServiceUtil.getLayout(plid);
      if (layout.getGroup().isStagingGroup()) {
        Group group=GroupLocalServiceUtil.getGroup(layout.getCompanyId(),GroupConstants.GUEST);
        plid=group.getDefaultPublicPlid();
      }
 else       if (layout.isPrivateLayout()) {
        plid=LayoutLocalServiceUtil.getDefaultPlid(layout.getGroupId(),false);
      }
      redirect=HttpUtil.addParameter(redirect,"p_l_id",plid);
    }
 catch (    Exception e) {
    }
  }
  response.sendRedirect(redirect);
}
