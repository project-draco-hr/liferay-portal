{
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize");
  }
  super.init();
  if (_log.isDebugEnabled()) {
    _log.debug("Process startup events");
  }
  try {
    StartupAction startupAction=new StartupAction();
    startupAction.run(null);
  }
 catch (  Exception e) {
    _log.error(e,e);
    System.out.println("Stopping the server due to unexpected startup errors");
    System.exit(0);
  }
  String contextPath=PortalUtil.getPathContext();
  ServletContext servletContext=getServletContext();
  VelocityContextPool.put(contextPath,servletContext);
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize plugin package");
  }
  PluginPackage pluginPackage=null;
  try {
    pluginPackage=PluginPackageHotDeployListener.readPluginPackage(servletContext);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize portlets");
  }
  List<Portlet> portlets=null;
  try {
    String[] xmls=new String[]{HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/" + Portal.PORTLET_XML_FILE_NAME_CUSTOM)),HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/portlet-ext.xml")),HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-portlet.xml")),HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-portlet-ext.xml")),HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/web.xml"))};
    PortletLocalServiceUtil.initEAR(servletContext,xmls,pluginPackage);
    portlets=PortletLocalServiceUtil.getPortlets();
    for (int i=0; i < portlets.size(); i++) {
      Portlet portlet=portlets.get(i);
      if (i == 0) {
        initPortletApp(portlet,servletContext);
      }
      PortletInstanceFactoryUtil.create(portlet,servletContext);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize layout templates");
  }
  try {
    String[] xmls=new String[]{HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-layout-templates.xml")),HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-layout-templates-ext.xml"))};
    LayoutTemplateLocalServiceUtil.init(servletContext,xmls,pluginPackage);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize look and feel");
  }
  try {
    String[] xmls=new String[]{HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-look-and-feel.xml")),HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-look-and-feel-ext.xml"))};
    ThemeLocalServiceUtil.init(servletContext,null,true,xmls,pluginPackage);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Indexer");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      String indexerClass=portlet.getIndexerClass();
      if (!portlet.isActive() || Validator.isNull(indexerClass)) {
        continue;
      }
      Indexer indexer=(Indexer)InstancePool.get(indexerClass);
      for (      String modelClassName : indexer.getClassNames()) {
        IndexerRegistryUtil.register(modelClassName,indexer);
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Scheduler");
  }
  try {
    if (PropsValues.SCHEDULER_ENABLED) {
      for (      String className : PropsValues.SCHEDULER_CLASSES) {
        Scheduler scheduler=(Scheduler)InstancePool.get(className);
        scheduler.schedule();
      }
      Iterator<Portlet> itr=portlets.iterator();
      while (itr.hasNext()) {
        Portlet portlet=itr.next();
        String className=portlet.getSchedulerClass();
        if (!portlet.isActive() || Validator.isNull(className)) {
          continue;
        }
        Scheduler scheduler=(Scheduler)InstancePool.get(className);
        scheduler.schedule();
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Poller processor");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      PollerProcessor pollerProcessor=portlet.getPollerProcessorInstance();
      if (!portlet.isActive() || (pollerProcessor == null)) {
        continue;
      }
      PollerProcessorUtil.addPollerProcessor(portlet.getPortletId(),pollerProcessor);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("POP message listener");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      MessageListener popMessageListener=portlet.getPopMessageListenerInstance();
      if (!portlet.isActive() || (popMessageListener == null)) {
        continue;
      }
      POPServerUtil.addListener(popMessageListener);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Social activity interpreter");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      SocialActivityInterpreter socialActivityInterpreter=portlet.getSocialActivityInterpreterInstance();
      if (!portlet.isActive() || (socialActivityInterpreter == null)) {
        continue;
      }
      socialActivityInterpreter=new SocialActivityInterpreterImpl(portlet.getPortletId(),socialActivityInterpreter);
      SocialActivityInterpreterLocalServiceUtil.addActivityInterpreter(socialActivityInterpreter);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Social request interpreter");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      SocialRequestInterpreter socialRequestInterpreter=portlet.getSocialRequestInterpreterInstance();
      if (!portlet.isActive() || (socialRequestInterpreter == null)) {
        continue;
      }
      socialRequestInterpreter=new SocialRequestInterpreterImpl(portlet.getPortletId(),socialRequestInterpreter);
      SocialRequestInterpreterLocalServiceUtil.addRequestInterpreter(socialRequestInterpreter);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("WebDAV storage");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      WebDAVStorage webDAVStorage=portlet.getWebDAVStorageInstance();
      if (!portlet.isActive() || (webDAVStorage == null)) {
        continue;
      }
      webDAVStorage.setToken(portlet.getWebDAVStorageToken());
      WebDAVUtil.addStorage(webDAVStorage);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Asset renderer factory");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      List<AssetRendererFactory> assetRendererFactories=portlet.getAssetRendererFactoryInstances();
      if (assetRendererFactories == null) {
        continue;
      }
      AssetRendererFactoryRegistryUtil.register(assetRendererFactories);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Workflow handler");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      List<WorkflowHandler> workflowHandlers=portlet.getWorkflowHandlerInstances();
      if (workflowHandlers == null) {
        continue;
      }
      WorkflowHandlerRegistryUtil.register(workflowHandlers);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Check web settings");
  }
  try {
    String xml=HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/web.xml"));
    checkWebSettings(xml);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  try {
    ExtRegistry.registerPortal(servletContext);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Process global startup events");
  }
  try {
    EventsProcessorUtil.process(PropsKeys.GLOBAL_STARTUP_EVENTS,PropsValues.GLOBAL_STARTUP_EVENTS);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize resource actions");
  }
  try {
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      List<String> portletActions=ResourceActionsUtil.getPortletResourceActions(portlet.getPortletId());
      ResourceActionLocalServiceUtil.checkResourceActions(portlet.getPortletId(),portletActions);
      List<String> modelNames=ResourceActionsUtil.getPortletModelResources(portlet.getPortletId());
      for (      String modelName : modelNames) {
        List<String> modelActions=ResourceActionsUtil.getModelResourceActions(modelName);
        ResourceActionLocalServiceUtil.checkResourceActions(modelName,modelActions);
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize resource codes");
  }
  try {
    long[] companyIds=PortalInstances.getCompanyIds();
    Iterator<Portlet> itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      List<String> modelNames=ResourceActionsUtil.getPortletModelResources(portlet.getPortletId());
      for (      long companyId : companyIds) {
        ResourceCodeLocalServiceUtil.checkResourceCodes(companyId,portlet.getPortletId());
        for (        String modelName : modelNames) {
          ResourceCodeLocalServiceUtil.checkResourceCodes(companyId,modelName);
        }
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  String[] webIds=PortalInstances.getWebIds();
  for (int i=0; i < webIds.length; i++) {
    PortalInstances.initCompany(servletContext,webIds[i]);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize message resources");
  }
  MultiMessageResources messageResources=(MultiMessageResources)servletContext.getAttribute(Globals.MESSAGES_KEY);
  LanguageResources.init(messageResources);
  PortalInitableUtil.flushInitables();
  HotDeployUtil.flushPrematureEvents();
}
