{
  ServletContext servletContext=getServletContext();
  try {
    String[] webIds=PortalInstances.getWebIds();
    for (    String webId : webIds) {
      PortalInstances.initCompany(servletContext,webId);
    }
  }
  finally {
    CompanyThreadLocal.setCompanyId(PortalInstances.getDefaultCompanyId());
    ShardDataSourceTargetSource shardDataSourceTargetSource=(ShardDataSourceTargetSource)InfrastructureUtil.getShardDataSourceTargetSource();
    if (shardDataSourceTargetSource != null) {
      shardDataSourceTargetSource.resetDataSource();
    }
  }
}
