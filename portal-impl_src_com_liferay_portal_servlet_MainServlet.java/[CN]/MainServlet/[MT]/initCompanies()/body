{
  ServletContext servletContext=getServletContext();
  try {
    String[] webIds=PortalInstances.getWebIds();
    for (int i=0; i < webIds.length; i++) {
      PortalInstances.initCompany(servletContext,webIds[i]);
    }
  }
  finally {
    CompanyThreadLocal.setCompanyId(PortalInstances.getDefaultCompanyId());
    ShardDataSourceTargetSource shardDataSourceTargetSource=(ShardDataSourceTargetSource)InfrastructureUtil.getShardDataSourceTargetSource();
    if (shardDataSourceTargetSource != null) {
      shardDataSourceTargetSource.resetDataSource();
    }
  }
}
