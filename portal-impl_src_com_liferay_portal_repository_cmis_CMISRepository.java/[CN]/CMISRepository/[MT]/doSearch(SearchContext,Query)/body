{
  long startTime=System.currentTimeMillis();
  Session session=getSession();
  String queryString=CMISQueryBuilder.buildQuery(searchContext,query);
  ItemIterable<QueryResult> queryResults=session.query(queryString,false);
  long total=queryResults.getTotalNumItems();
  int start=searchContext.getStart();
  int end=searchContext.getEnd();
  if ((start == QueryUtil.ALL_POS) && (end == QueryUtil.ALL_POS)) {
    start=0;
    end=(int)total;
  }
  int subsetTotal=end - start;
  com.liferay.portal.kernel.search.Document[] documents=new DocumentImpl[subsetTotal];
  String[] snippets=new String[subsetTotal];
  float[] scores=new float[subsetTotal];
  QueryConfig queryConfig=query.getQueryConfig();
  int index=0;
  queryResults=queryResults.skipTo(start);
  Iterator<QueryResult> itr=queryResults.iterator();
  for (int i=start; i < end; i++) {
    QueryResult queryResult=itr.next();
    com.liferay.portal.kernel.search.Document document=new DocumentImpl();
    String objectId=queryResult.getPropertyValueByQueryName(PropertyIds.OBJECT_ID);
    FileEntry fileEntry=toFileEntry(objectId);
    document.addKeyword(Field.ENTRY_CLASS_NAME,fileEntry.getModelClassName());
    document.addKeyword(Field.ENTRY_CLASS_PK,fileEntry.getFileEntryId());
    document.addKeyword(Field.TITLE,fileEntry.getTitle());
    documents[index]=document;
    if (queryConfig.isScoreEnabled()) {
      Object scoreObj=queryResult.getPropertyValueByQueryName("HITS");
      if (scoreObj instanceof BigDecimal) {
        BigDecimal bigDecimalScore=(BigDecimal)scoreObj;
        scores[index]=bigDecimalScore.floatValue();
      }
 else {
        scores[index]=(Float)scoreObj;
      }
    }
 else {
      scores[index]=1;
    }
    snippets[index]=StringPool.BLANK;
    index++;
  }
  float searchTime=(float)(System.currentTimeMillis() - startTime) / Time.SECOND;
  Hits hits=new HitsImpl();
  hits.setDocs(documents);
  hits.setLength((int)total);
  hits.setQuery(query);
  hits.setQueryTerms(new String[0]);
  hits.setScores(scores);
  hits.setSearchTime(searchTime);
  hits.setSnippets(snippets);
  hits.setStart(startTime);
  return hits;
}
