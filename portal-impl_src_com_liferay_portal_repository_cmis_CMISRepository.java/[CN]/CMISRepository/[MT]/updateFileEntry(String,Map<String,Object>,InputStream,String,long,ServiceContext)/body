{
  try {
    Session session=getSession();
    Document document=(Document)session.getObject(objectId);
    AllowableActions allowableActions=document.getAllowableActions();
    Set<Action> allowableActionsSet=allowableActions.getAllowableActions();
    ContentStream contentStream=null;
    if (is != null) {
      String contentType=(String)serviceContext.getAttribute("contentType");
      is=new Base64.InputStream(is,Base64.ENCODE);
      contentStream=new ContentStreamImpl(sourceFileName,BigInteger.valueOf(size),contentType,is);
    }
    checkUpdatable(allowableActionsSet,properties,contentStream);
    if (properties != null) {
      document=(Document)document.updateProperties(properties);
    }
    if (contentStream != null) {
      document.setContentStream(contentStream,true,false);
    }
    return toFileEntry(document);
  }
 catch (  PortalException pe) {
    throw pe;
  }
catch (  SystemException se) {
    throw se;
  }
catch (  Exception e) {
    processException(e);
    throw new RepositoryException(e);
  }
}
