{
  try {
    Session session=getSession();
    String versionSeriesId=toFileEntryId(fileEntryId);
    Document document=(Document)session.getObject(versionSeriesId);
    Document oldVersion=null;
    List<Document> documentVersions=document.getAllVersions();
    for (    Document currentVersion : documentVersions) {
      String currentVersionLabel=currentVersion.getVersionLabel();
      if (Validator.isNull(currentVersionLabel)) {
        currentVersionLabel=DLFileEntryConstants.VERSION_DEFAULT;
      }
      if (currentVersionLabel.equals(version)) {
        oldVersion=currentVersion;
        break;
      }
    }
    String mimeType=oldVersion.getContentStreamMimeType();
    String changeLog="Reverted to " + version;
    String title=oldVersion.getName();
    ContentStream contentStream=oldVersion.getContentStream();
    updateFileEntry(fileEntryId,contentStream.getFileName(),mimeType,title,StringPool.BLANK,changeLog,true,contentStream.getStream(),contentStream.getLength(),serviceContext);
  }
 catch (  PortalException pe) {
    throw pe;
  }
catch (  SystemException se) {
    throw se;
  }
catch (  Exception e) {
    processException(e);
    throw new RepositoryException(e);
  }
}
