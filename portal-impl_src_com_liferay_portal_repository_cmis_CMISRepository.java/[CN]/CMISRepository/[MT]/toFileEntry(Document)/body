{
  Object[] ids=null;
  if (isDocumentRetrievableByVersionSeriesId()) {
    ids=getRepositoryEntryIds(document.getVersionSeriesId());
  }
 else {
    ids=getRepositoryEntryIds(document.getId());
  }
  long fileEntryId=(Long)ids[0];
  String uuid=(String)ids[1];
  FileEntry fileEntry=new CMISFileEntry(this,uuid,fileEntryId,document);
  try {
    AssetEntry assetEntry=AssetEntryLocalServiceUtil.fetchEntry(DLFileEntryConstants.getClassName(),fileEntryId);
    if (assetEntry == null) {
      FileVersion fileVersion=fileEntry.getFileVersion();
      String name=PrincipalThreadLocal.getName();
      long userId=GetterUtil.getLong(name);
      dlAppHelperLocalService.addFileEntry(userId,fileEntry,fileVersion,new ServiceContext());
    }
  }
 catch (  Exception e) {
    _log.error("Error attempting to update asset info",e);
  }
  return fileEntry;
}
