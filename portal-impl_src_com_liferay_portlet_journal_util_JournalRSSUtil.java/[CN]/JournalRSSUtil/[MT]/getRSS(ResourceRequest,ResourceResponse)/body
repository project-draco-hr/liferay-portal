{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  JournalFeed feed=null;
  long id=ParamUtil.getLong(resourceRequest,"id");
  long groupId=ParamUtil.getLong(resourceRequest,"groupId");
  String feedId=ParamUtil.getString(resourceRequest,"feedId");
  if (id > 0) {
    feed=JournalFeedLocalServiceUtil.getFeed(id);
  }
 else {
    feed=JournalFeedLocalServiceUtil.getFeed(groupId,feedId);
  }
  String languageId=LanguageUtil.getLanguageId(resourceRequest);
  long plid=PortalUtil.getPlidFromFriendlyURL(themeDisplay.getCompanyId(),feed.getTargetLayoutFriendlyUrl());
  Layout layout=null;
  if (plid > 0) {
    layout=LayoutLocalServiceUtil.fetchLayout(plid);
  }
  if (layout == null) {
    layout=themeDisplay.getLayout();
  }
  String rss=exportToRSS(resourceRequest,resourceResponse,feed,languageId,layout,themeDisplay);
  return rss.getBytes(StringPool.UTF8);
}
