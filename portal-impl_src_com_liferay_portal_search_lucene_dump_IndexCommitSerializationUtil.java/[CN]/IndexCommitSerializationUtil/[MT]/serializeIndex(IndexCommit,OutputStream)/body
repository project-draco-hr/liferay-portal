{
  if (PropsValues.INDEX_DUMP_GZIP_ENABLE) {
    outputStream=new GZIPOutputStream(outputStream);
  }
  ObjectOutputStream objectOputStream=new ObjectOutputStream(outputStream);
  IndexCommitMetaInfo indexCommitMetaInfo=new IndexCommitMetaInfo(indexCommit);
  if (_log.isDebugEnabled()) {
    _log.debug("Serializing IndexCommitMetaInfo : " + indexCommitMetaInfo);
  }
  objectOputStream.writeObject(indexCommitMetaInfo);
  List<FileInfo> fileInfoList=indexCommitMetaInfo.getFileInfoList();
  Directory directory=indexCommit.getDirectory();
  for (  FileInfo fileInfo : fileInfoList) {
    if (_log.isDebugEnabled()) {
      _log.debug("Serializing segment file name : " + fileInfo.getFileName() + ", size : "+ fileInfo.getFileSize());
    }
    serializeSegmentFile(directory.openInput(fileInfo.getFileName()),fileInfo.getFileSize(),objectOputStream);
  }
  objectOputStream.flush();
  if (PropsValues.INDEX_DUMP_GZIP_ENABLE) {
    ((GZIPOutputStream)outputStream).finish();
  }
}
