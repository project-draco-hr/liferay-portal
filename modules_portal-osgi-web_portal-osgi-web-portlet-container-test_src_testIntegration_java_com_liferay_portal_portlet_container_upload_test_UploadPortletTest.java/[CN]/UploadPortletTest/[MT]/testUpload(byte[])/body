{
  LiferayServletRequest liferayServletRequest=PortletContainerTestUtil.getMultipartRequest(TestUploadPortlet.PARAMETER_NAME,bytes);
  setUp(liferayServletRequest,layout);
  ServletRequest servletRequest=liferayServletRequest.getRequest();
  MockMultipartHttpServletRequest mockServletRequest=(MockMultipartHttpServletRequest)servletRequest;
  PortletURL portletURL=PortletURLFactoryUtil.create(mockServletRequest,TestUploadPortlet.PORTLET_NAME,layout.getPlid(),PortletRequest.ACTION_PHASE);
  portletURL.setParameter(ActionRequest.ACTION_NAME,TestUploadPortlet.MVC_COMMAND_NAME);
  portletURL.setParameter("randomId",RandomTestUtil.randomString());
  String url=portletURL.toString();
  mockServletRequest.addParameter("Cookie",new String[]{"test"});
  return PortletContainerTestUtil.postMultipart(url,mockServletRequest,TestUploadPortlet.PARAMETER_NAME);
}
