{
  long[] remoteMessageIds=_imapAccessor.getMessageUIDs(folderId,pageNumber,messagesPerPage);
  List<Long> missingRemoteMessageIdsList=new ArrayList<>();
  for (int i=0; i < remoteMessageIds.length; i++) {
    long remoteMessageId=remoteMessageIds[i];
    try {
      MessageLocalServiceUtil.getMessage(folderId,remoteMessageId);
    }
 catch (    NoSuchMessageException nsme) {
      missingRemoteMessageIdsList.add(remoteMessageId);
    }
  }
  if (!missingRemoteMessageIdsList.isEmpty()) {
    long[] missingRemoteMessageIds=ArrayUtil.toArray(missingRemoteMessageIdsList.toArray(new Long[missingRemoteMessageIdsList.size()]));
    _imapAccessor.storeEnvelopes(folderId,missingRemoteMessageIds);
  }
}
