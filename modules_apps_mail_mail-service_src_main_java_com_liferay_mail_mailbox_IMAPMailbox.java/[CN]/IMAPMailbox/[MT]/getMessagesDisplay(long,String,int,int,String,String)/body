{
  if (orderByField.equals(MailConstants.ORDER_BY_ADDRESS)) {
    orderByField="sender";
    if (account.getSentFolderId() == folderId) {
      orderByField="to";
    }
  }
 else   if (!orderByField.equals(MailConstants.ORDER_BY_SENT_DATE) && !orderByField.equals(MailConstants.ORDER_BY_SIZE) && !orderByField.equals(MailConstants.ORDER_BY_SUBJECT)) {
    orderByField=MailConstants.ORDER_BY_SENT_DATE;
  }
  List<Message> messages=new ArrayList<>(messagesPerPage);
  int messageCount=MessageLocalServiceUtil.populateMessages(messages,folderId,keywords,pageNumber,messagesPerPage,orderByField,orderByType);
  if (Validator.isNull(keywords) && (account.getDraftFolderId() != folderId)) {
    Folder folder=FolderLocalServiceUtil.getFolder(folderId);
    messageCount=folder.getRemoteMessageCount();
  }
  return new MessagesDisplay(messages,pageNumber,messagesPerPage,messageCount);
}
