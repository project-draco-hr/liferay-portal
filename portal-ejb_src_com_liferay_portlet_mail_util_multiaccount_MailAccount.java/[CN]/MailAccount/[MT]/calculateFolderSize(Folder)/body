{
  long size=0;
  if ((folder.getType() & Folder.HOLDS_MESSAGES) != 0) {
    folder.open(Folder.READ_ONLY);
    try {
      Message[] folderMsgs=folder.getMessages();
      for (int i=0; i < folderMsgs.length; i++) {
        int msgSize=folderMsgs[i].getSize();
        if (msgSize != -1) {
          size+=msgSize;
        }
 else {
          if (_log.isWarnEnabled()) {
            _log.warn("Could not determine the size of message " + folderMsgs[i].getSubject());
          }
        }
      }
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Error calculating the size of the folder " + folder.getName(),e);
      }
    }
 finally {
      folder.close(false);
    }
  }
  if ((folder.getType() & Folder.HOLDS_FOLDERS) != 0) {
    Folder[] folderChildren=folder.list();
    for (int i=0; i < folderChildren.length; i++) {
      size+=calculateFolderSize(folderChildren[i]);
    }
  }
  return size;
}
