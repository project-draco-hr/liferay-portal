{
  User user=UserUtil.findByPrimaryKey(userId);
  Date now=new Date();
  validate(0,user.getCompanyId(),name);
  long passwordPolicyId=CounterLocalServiceUtil.increment();
  PasswordPolicy passwordPolicy=PasswordPolicyUtil.create(passwordPolicyId);
  passwordPolicy.setUserId(userId);
  passwordPolicy.setCompanyId(user.getCompanyId());
  passwordPolicy.setUserName(user.getFullName());
  passwordPolicy.setCreateDate(now);
  passwordPolicy.setModifiedDate(now);
  passwordPolicy.setDefaultPolicy(defaultPolicy);
  passwordPolicy.setName(name);
  passwordPolicy.setDescription(description);
  passwordPolicy.setChangeable(changeable);
  passwordPolicy.setChangeRequired(changeRequired);
  passwordPolicy.setMinAge(minAge);
  passwordPolicy.setCheckSyntax(checkSyntax);
  passwordPolicy.setAllowDictionaryWords(allowDictionaryWords);
  passwordPolicy.setMinLength(minLength);
  passwordPolicy.setHistory(history);
  passwordPolicy.setHistoryCount(historyCount);
  passwordPolicy.setExpireable(expireable);
  passwordPolicy.setMaxAge(maxAge);
  passwordPolicy.setWarningTime(warningTime);
  passwordPolicy.setGraceLimit(graceLimit);
  passwordPolicy.setLockout(lockout);
  passwordPolicy.setMaxFailure(maxFailure);
  passwordPolicy.setLockoutDuration(lockoutDuration);
  passwordPolicy.setRequireUnlock(lockoutDuration == 0);
  passwordPolicy.setResetFailureCount(resetFailureCount);
  PasswordPolicyUtil.update(passwordPolicy);
  if (!user.isDefaultUser()) {
    ResourceLocalServiceUtil.addResources(user.getCompanyId(),0,userId,PasswordPolicy.class.getName(),passwordPolicy.getPasswordPolicyId(),false,false,false);
  }
  return passwordPolicy;
}
