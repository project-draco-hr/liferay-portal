{
  try {
    SearchContainerTag<R> searchContainerTag=(SearchContainerTag<R>)findAncestorWithClass(this,SearchContainerTag.class);
    SearchContainer<R> searchContainer=searchContainerTag.getSearchContainer();
    int total=searchContainer.getTotal();
    if (_deprecatedTotal == 0) {
      _deprecatedTotal=total;
    }
    String totalVar=searchContainer.getTotalVar();
    if (!_deprecatedTotalVar.equals(SearchContainer.DEFAULT_DEPRECATED_TOTAL_VAR) && totalVar.equals(SearchContainer.DEFAULT_TOTAL_VAR)) {
      pageContext.removeAttribute(totalVar);
      searchContainer.setTotalVar(_deprecatedTotalVar);
    }
 else {
      pageContext.removeAttribute(_deprecatedTotalVar);
      _deprecatedTotalVar=totalVar;
    }
    if (_results == null) {
      _results=searchContainer.getResults();
      if (_results.isEmpty()) {
        _results=(List<R>)pageContext.getAttribute(_resultsVar);
      }
      _deprecatedTotal=(Integer)pageContext.getAttribute(_deprecatedTotalVar);
    }
    if (_results != null) {
      if (_deprecatedTotal < _results.size()) {
        _deprecatedTotal=_results.size();
      }
    }
    searchContainer.setResults(_results);
    if (total == 0) {
      searchContainer.setTotal(_deprecatedTotal);
    }
    searchContainerTag.setHasResults(true);
    pageContext.setAttribute(_resultsVar,_results);
    return EVAL_PAGE;
  }
 catch (  Exception e) {
    throw new JspException(e);
  }
 finally {
    if (!ServerDetector.isResin()) {
      _deprecatedTotal=0;
      _deprecatedTotalVar=SearchContainer.DEFAULT_DEPRECATED_TOTAL_VAR;
      _results=null;
      _resultsVar=SearchContainer.DEFAULT_RESULTS_VAR;
    }
  }
}
