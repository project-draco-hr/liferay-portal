{
  ClassLoader classLoader=getClass().getClassLoader();
  InputStream is=classLoader.getResourceAsStream("com/liferay/portal/tools/sql/dependencies/" + path);
  if (is == null) {
    is=classLoader.getResourceAsStream(path);
  }
  String template=StringUtil.read(is);
  is.close();
  if (path.endsWith(".vm")) {
    try {
      template=evaluateVM(template);
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
  StringMaker sm=new StringMaker();
  BufferedReader br=new BufferedReader(new StringReader(template));
  String line=null;
  while ((line=br.readLine()) != null) {
    if (!line.startsWith("##")) {
      sm.append(line);
      if (line.endsWith(";")) {
        String sql=sm.toString();
        sm=new StringMaker();
        try {
          runSQL(sql);
        }
 catch (        IOException ioe) {
          if (failOnError) {
            throw ioe;
          }
 else           if (_log.isWarnEnabled()) {
            _log.warn(ioe.getMessage());
          }
        }
catch (        SQLException sqle) {
          if (failOnError) {
            throw sqle;
          }
 else           if (_log.isWarnEnabled()) {
            _log.warn(sqle.getMessage());
          }
        }
      }
    }
  }
  br.close();
}
