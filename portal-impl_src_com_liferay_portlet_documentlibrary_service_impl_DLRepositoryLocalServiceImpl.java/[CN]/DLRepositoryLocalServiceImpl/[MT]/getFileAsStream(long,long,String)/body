{
  DLFileEntry fileEntry=dlFileEntryPersistence.findByPrimaryKey(fileEntryId);
  if (PropsValues.DL_FILE_ENTRY_READ_COUNT_ENABLED) {
    fileEntry.setReadCount(fileEntry.getReadCount() + 1);
    dlFileEntryPersistence.update(fileEntry,false);
  }
  dlAppHelperLocalService.getFileAsStream(userId,fileEntry);
  long companyId=fileEntry.getCompanyId();
  long repositoryId=fileEntry.getRepositoryId();
  String name=fileEntry.getName();
  if (Validator.isNull(version)) {
    version=fileEntry.getVersion();
  }
  return dlLocalService.getFileAsStream(companyId,repositoryId,name,version);
}
