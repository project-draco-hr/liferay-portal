{
  if (parentFolderId == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    return parentFolderId;
  }
  if (dlFolder.getFolderId() == parentFolderId) {
    return dlFolder.getParentFolderId();
  }
 else {
    DLFolder parentDLFolder=dlFolderPersistence.fetchByPrimaryKey(parentFolderId);
    if ((parentDLFolder == null) || (dlFolder.getGroupId() != parentDLFolder.getGroupId())) {
      return dlFolder.getParentFolderId();
    }
    List<Long> subfolderIds=new ArrayList<Long>();
    getSubfolderIds(subfolderIds,dlFolder.getGroupId(),dlFolder.getFolderId());
    if (subfolderIds.contains(parentFolderId)) {
      return dlFolder.getParentFolderId();
    }
    return parentFolderId;
  }
}
