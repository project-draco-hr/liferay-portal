{
  long fileVersionId=counterLocalService.increment();
  DLFileVersion fileVersion=dlFileVersionPersistence.create(fileVersionId);
  long versionUserId=fileEntry.getVersionUserId();
  if (versionUserId <= 0) {
    versionUserId=fileEntry.getUserId();
  }
  String versionUserName=GetterUtil.getString(fileEntry.getVersionUserName(),fileEntry.getUserName());
  fileVersion.setCompanyId(fileEntry.getCompanyId());
  fileVersion.setUserId(versionUserId);
  fileVersion.setUserName(versionUserName);
  fileVersion.setCreateDate(modifiedDate);
  fileVersion.setFileEntryId(fileEntry.getFileEntryId());
  fileVersion.setExtension(extension);
  fileVersion.setTitle(title);
  fileVersion.setDescription(description);
  fileVersion.setChangeLog(changeLog);
  fileVersion.setExtraSettings(extraSettings);
  fileVersion.setVersion(version);
  fileVersion.setSize(size);
  fileVersion.setStatus(status);
  fileVersion.setStatusByUserId(user.getUserId());
  fileVersion.setStatusByUserName(user.getFullName());
  fileVersion.setStatusDate(fileEntry.getModifiedDate());
  fileVersion.setExpandoBridgeAttributes(serviceContext);
  dlFileVersionPersistence.update(fileVersion,false);
  return fileVersion;
}
