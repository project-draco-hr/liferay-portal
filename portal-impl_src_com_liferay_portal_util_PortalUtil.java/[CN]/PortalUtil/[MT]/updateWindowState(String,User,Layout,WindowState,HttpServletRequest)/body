{
  LayoutTypePortlet layoutType=(LayoutTypePortlet)layout.getLayoutType();
  if ((windowState == null) || (Validator.isNull(windowState.toString()))) {
    if (layoutType.hasStateMaxPortletId(portletId)) {
      return WindowState.MAXIMIZED;
    }
 else     if (layoutType.hasStateMinPortletId(portletId)) {
      return WindowState.MINIMIZED;
    }
 else {
      return WindowState.NORMAL;
    }
  }
 else {
    boolean updateLayout=false;
    if ((windowState.equals(WindowState.MAXIMIZED)) || (windowState.equals(LiferayWindowState.EXCLUSIVE)) || (windowState.equals(LiferayWindowState.POP_UP))) {
      if (layoutType.hasStateMax()) {
        String curMaxPortletId=StringUtil.split(layoutType.getStateMax())[0];
        InvokerPortlet.clearResponse(req.getSession(),layout.getPlid(),curMaxPortletId,LanguageUtil.getLanguageId(req));
        if ((windowState.equals(LiferayWindowState.EXCLUSIVE)) || (windowState.equals(LiferayWindowState.POP_UP))) {
          String stateMaxPrevious=layoutType.getStateMaxPrevious();
          if (stateMaxPrevious == null) {
            layoutType.setStateMaxPrevious(curMaxPortletId);
            updateLayout=true;
          }
        }
      }
 else {
        if ((windowState.equals(LiferayWindowState.EXCLUSIVE)) || (windowState.equals(LiferayWindowState.POP_UP))) {
          String stateMaxPrevious=layoutType.getStateMaxPrevious();
          if (stateMaxPrevious == null) {
            layoutType.setStateMaxPrevious(StringPool.BLANK);
            updateLayout=true;
          }
        }
      }
      if (!layoutType.hasStateMaxPortletId(portletId)) {
        layoutType.addStateMaxPortletId(portletId);
        updateLayout=true;
      }
    }
 else     if (windowState.equals(WindowState.MINIMIZED) && !layoutType.hasStateMinPortletId(portletId)) {
      layoutType.addStateMinPortletId(portletId);
      updateLayout=true;
    }
 else     if (windowState.equals(WindowState.NORMAL) && !layoutType.hasStateNormalPortletId(portletId)) {
      layoutType.removeStatesPortletId(portletId);
      updateLayout=true;
    }
    if (updateLayout) {
      LayoutClone layoutClone=LayoutCloneFactory.getInstance();
      if (layoutClone != null) {
        layoutClone.update(req,layout.getPlid(),layout.getTypeSettings());
      }
    }
    return windowState;
  }
}
