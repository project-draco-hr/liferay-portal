{
  if (req instanceof ActionRequestImpl) {
    ActionRequestImpl reqImpl=(ActionRequestImpl)req;
    return reqImpl.getHttpServletRequest();
  }
 else   if (req instanceof RenderRequestImpl) {
    RenderRequestImpl reqImpl=(RenderRequestImpl)req;
    return reqImpl.getHttpServletRequest();
  }
 else   if (req instanceof PortletRequestWrapper) {
    PortletRequestWrapper reqWrapper=(PortletRequestWrapper)req;
    return getHttpServletRequest(reqWrapper.getPortletRequest());
  }
 else {
    throw new RuntimeException("Unable to get the HTTP servlet request from " + req.getClass().getName());
  }
}
