{
  ServletContext ctx=req.getSession().getServletContext();
  String mainPath=PortalUtil.PATH_MAIN;
  String redirect=mainPath + "/portal/status";
  boolean showStatus=GetterUtil.getBoolean(PropsUtil.get(PropsUtil.LAYOUT_SHOW_HTTP_STATUS));
  String resource=GetterUtil.getString(PropsUtil.get(PropsUtil.LAYOUT_FRIENDLY_URL_PAGE_NOT_FOUND));
  if (e instanceof NoSuchLayoutException && Validator.isNotNull(resource)) {
    res.setStatus(status);
    redirect=resource;
    RequestDispatcher rd=ctx.getRequestDispatcher(redirect);
    if (rd != null) {
      rd.forward(req,res);
    }
  }
 else   if (showStatus) {
    res.setStatus(status);
    SessionErrors.add(req,e.getClass().getName(),e);
    RequestDispatcher rd=ctx.getRequestDispatcher(redirect);
    if (rd != null) {
      rd.forward(req,res);
    }
  }
 else {
    if (e != null) {
      res.sendError(status,e.getMessage());
    }
 else {
      res.sendError(status);
    }
  }
}
