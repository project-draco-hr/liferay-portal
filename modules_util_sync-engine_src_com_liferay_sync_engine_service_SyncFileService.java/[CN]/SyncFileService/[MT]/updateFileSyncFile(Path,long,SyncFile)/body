{
  if (OSDetector.isWindows()) {
    FileUtil.writeFileKey(filePath,String.valueOf(syncFile.getSyncFileId()));
  }
  Path deltaFilePath=null;
  String name=_getName(filePath,syncFile);
  String sourceChecksum=syncFile.getChecksum();
  String sourceFileName=syncFile.getName();
  String sourceVersion=syncFile.getVersion();
  String targetChecksum=FileUtil.getChecksum(filePath);
  if (!sourceChecksum.equals(targetChecksum) && !IODeltaUtil.isIgnoredFilePatchingExtension(syncFile)) {
    deltaFilePath=Files.createTempFile(String.valueOf(filePath.getFileName()),".tmp");
    deltaFilePath=IODeltaUtil.delta(filePath,IODeltaUtil.getChecksumsFilePath(syncFile),deltaFilePath);
    IODeltaUtil.checksums(syncFile);
  }
  syncFile.setChecksum(targetChecksum);
  syncFile.setFilePathName(filePath.toString());
  syncFile.setName(name);
  update(syncFile);
  if ((syncFile.getState() != SyncFile.STATE_ERROR) && (syncFile.getState() != SyncFile.STATE_UNSYNCED)) {
    FileEventUtil.updateFile(filePath,syncAccountId,syncFile,deltaFilePath,name,sourceChecksum,sourceFileName,sourceVersion,targetChecksum);
  }
  return syncFile;
}
