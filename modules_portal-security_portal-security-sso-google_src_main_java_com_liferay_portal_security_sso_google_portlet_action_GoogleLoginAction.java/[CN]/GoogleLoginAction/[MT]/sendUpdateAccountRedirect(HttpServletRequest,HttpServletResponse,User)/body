{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PortletURL portletURL=PortletURLFactoryUtil.create(request,PortletKeys.LOGIN,themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  portletURL.setParameter("saveLastPath",Boolean.FALSE.toString());
  portletURL.setParameter("struts_action","/login/update_account");
  PortletURL redirectURL=PortletURLFactoryUtil.create(request,PortletKeys.FAST_LOGIN,themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  redirectURL.setParameter("struts_action","/login/login_redirect");
  redirectURL.setParameter("emailAddress",user.getEmailAddress());
  redirectURL.setParameter("anonymousUser",Boolean.FALSE.toString());
  redirectURL.setPortletMode(PortletMode.VIEW);
  redirectURL.setWindowState(LiferayWindowState.POP_UP);
  portletURL.setParameter("redirect",redirectURL.toString());
  portletURL.setParameter("userId",String.valueOf(user.getUserId()));
  portletURL.setParameter("emailAddress",user.getEmailAddress());
  portletURL.setParameter("firstName",user.getFirstName());
  portletURL.setParameter("lastName",user.getLastName());
  portletURL.setPortletMode(PortletMode.VIEW);
  portletURL.setWindowState(LiferayWindowState.POP_UP);
  response.sendRedirect(portletURL.toString());
}
