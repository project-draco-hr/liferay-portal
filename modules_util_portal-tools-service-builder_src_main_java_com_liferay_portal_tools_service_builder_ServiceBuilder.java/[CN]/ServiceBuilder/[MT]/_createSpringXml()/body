{
  if (_packagePath.equals("com.liferay.counter")) {
    return;
  }
  Map<String,Object> context=_getContext();
  context.put("entities",_ejbList);
  String content=_processTemplate(_tplSpringXml,context);
  File xmlFile=new File(_springFileName);
  StringBundler sb=new StringBundler(11);
  sb.append("<?xml version=\"1.0\"?>\n\n");
  sb.append("<beans\n");
  sb.append("\tdefault-destroy-method=\"destroy\"\n");
  sb.append("\tdefault-init-method=\"afterPropertiesSet\"\n");
  sb.append(_getSpringNamespacesDeclarations());
  sb.append("\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"");
  sb.append("\n");
  sb.append("\txsi:schemaLocation=\"");
  sb.append(_getSpringSchemaLocations());
  sb.append("\">\n");
  sb.append("</beans>");
  String xml=sb.toString();
  if (!xmlFile.exists()) {
    _write(xmlFile,xml);
  }
  String oldContent=_read(xmlFile);
  if (Validator.isNotNull(_pluginName) && oldContent.contains("DOCTYPE beans PUBLIC")) {
    oldContent=xml;
  }
  String newContent=_fixSpringXml(oldContent);
  int x=oldContent.indexOf("<beans");
  int y=oldContent.lastIndexOf("</beans>");
  int firstSession=newContent.indexOf("<bean class=\"" + _packagePath + ".service.",x);
  int lastSession=newContent.lastIndexOf("<bean class=\"" + _packagePath + ".service.",y);
  if (firstSession == -1) {
    firstSession=newContent.indexOf("<bean class=\"" + _apiPackagePath + ".service.",x);
    lastSession=newContent.lastIndexOf("<bean class=\"" + _apiPackagePath + ".service.",y);
  }
  if ((firstSession == -1) || (firstSession > y)) {
    x=newContent.indexOf("</beans>");
    newContent=newContent.substring(0,x) + content + newContent.substring(x);
  }
 else {
    firstSession=newContent.lastIndexOf("<bean",firstSession) - 1;
    int tempLastSession=newContent.indexOf("<bean class=\"",lastSession + 1);
    if (tempLastSession == -1) {
      tempLastSession=newContent.indexOf("</beans>",lastSession);
    }
    lastSession=tempLastSession;
    newContent=newContent.substring(0,firstSession) + content + newContent.substring(lastSession);
  }
  ToolsUtil.writeFileRaw(xmlFile,_formatXml(newContent),_modifiedFileNames);
}
