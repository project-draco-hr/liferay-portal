{
  Properties properties=PropsUtil.getProperties(_propertyPrefix,true);
  String jndiName=properties.getProperty("jndi.name");
  if (Validator.isNotNull(jndiName)) {
    try {
      return JNDIUtil.lookup(new InitialContext(),jndiName);
    }
 catch (    Exception e) {
      _log.error("Unable to lookup " + jndiName,e);
    }
  }
  DataSource dataSource=new ComboPooledDataSource();
  Enumeration<String> enu=(Enumeration<String>)properties.propertyNames();
  while (enu.hasMoreElements()) {
    String key=enu.nextElement();
    String value=properties.getProperty(key);
    if (key.equalsIgnoreCase("driverClassName")) {
      key="driverClass";
    }
 else     if (key.equalsIgnoreCase("url")) {
      key="jdbcUrl";
    }
 else     if (key.equalsIgnoreCase("username")) {
      key="user";
    }
    BeanUtils.setProperty(dataSource,key,value);
  }
  if (_log.isDebugEnabled()) {
    SortedProperties sortedProperties=new SortedProperties(properties);
    _log.debug("Properties for prefix " + _propertyPrefix);
    sortedProperties.list(System.out);
  }
  if (Validator.isNotNull(jndiName)) {
    JNDIUtil.bind(new InitialContext(),jndiName,dataSource);
  }
  return dataSource;
}
