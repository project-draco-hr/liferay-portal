{
  Modifications modifications=getModifications(user,userMappings,_reservedUserFieldNames);
  if (user.isPasswordModified() && Validator.isNotNull(user.getPasswordUnencrypted())) {
    String newPassword=user.getPasswordUnencrypted();
    String passwordKey=userMappings.getProperty(UserConverterKeys.PASSWORD);
    if (passwordKey.equals("unicodePwd")) {
      String newQuotedPassword=StringPool.QUOTE.concat(newPassword).concat(StringPool.QUOTE);
      byte[] newUnicodePassword=newQuotedPassword.getBytes("UTF-16LE");
      addModificationItem(new BasicAttribute(passwordKey,newUnicodePassword),modifications);
    }
 else {
      addModificationItem(passwordKey,newPassword,modifications);
    }
  }
  String portraitKey=userMappings.getProperty(UserConverterKeys.PORTRAIT);
  if (Validator.isNotNull(portraitKey)) {
    addModificationItem(new BasicAttribute(portraitKey,getUserPortrait(user)),modifications);
  }
  populateCustomAttributeModifications(user,user.getExpandoBridge(),userExpandoAttributes,userExpandoMappings,modifications);
  return modifications;
}
