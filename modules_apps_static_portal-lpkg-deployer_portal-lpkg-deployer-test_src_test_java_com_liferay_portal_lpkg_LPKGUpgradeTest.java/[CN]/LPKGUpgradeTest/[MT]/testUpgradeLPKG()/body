{
  String liferayHome=System.getProperty("liferay.home");
  Assert.assertNotNull("Missing system property \"liferay.home\"",liferayHome);
  try (DirectoryStream<Path> directoryStream=Files.newDirectoryStream(Paths.get(liferayHome,"/osgi/marketplace"))){
    for (    Path lpkgPath : directoryStream) {
      try (FileSystem fileSystem=FileSystems.newFileSystem(lpkgPath,null)){
        Path path=fileSystem.getPath("liferay-marketplace.properties");
        String propertiesString=new String(Files.readAllBytes(path),StandardCharsets.UTF_8);
        Properties properties=new Properties();
        properties.load(new UnsyncStringReader(propertiesString));
        String versionString=properties.getProperty("version");
        Version version=new Version(versionString);
        version=new Version(version.getMajor(),version.getMinor(),version.getMicro() + 1);
        propertiesString=StringUtil.replace(propertiesString,"version=".concat(versionString),"version=".concat(version.toString()));
        Files.write(path,Arrays.asList(propertiesString),StandardCharsets.UTF_8,StandardOpenOption.TRUNCATE_EXISTING,StandardOpenOption.WRITE);
      }
     }
  }
 }
