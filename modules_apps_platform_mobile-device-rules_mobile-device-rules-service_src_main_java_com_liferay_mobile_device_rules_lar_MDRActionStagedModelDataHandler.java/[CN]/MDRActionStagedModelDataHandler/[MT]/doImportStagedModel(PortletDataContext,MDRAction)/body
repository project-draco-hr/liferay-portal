{
  Map<Long,Long> ruleGroupInstanceIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(MDRRuleGroupInstance.class);
  long ruleGroupInstanceId=MapUtil.getLong(ruleGroupInstanceIds,action.getRuleGroupInstanceId(),action.getRuleGroupInstanceId());
  ServiceContext serviceContext=portletDataContext.createServiceContext(action);
  serviceContext.setUserId(portletDataContext.getUserId(action.getUserUuid()));
  Element element=portletDataContext.getImportDataStagedModelElement(action);
  validateLayout(element,action);
  MDRAction importedAction=null;
  if (portletDataContext.isDataStrategyMirror()) {
    MDRAction existingAction=fetchStagedModelByUuidAndGroupId(action.getUuid(),portletDataContext.getScopeGroupId());
    if (existingAction == null) {
      serviceContext.setUuid(action.getUuid());
      importedAction=_mdrActionLocalService.addAction(ruleGroupInstanceId,action.getNameMap(),action.getDescriptionMap(),action.getType(),action.getTypeSettingsProperties(),serviceContext);
    }
 else {
      importedAction=_mdrActionLocalService.updateAction(existingAction.getActionId(),action.getNameMap(),action.getDescriptionMap(),action.getType(),action.getTypeSettingsProperties(),serviceContext);
    }
  }
 else {
    importedAction=_mdrActionLocalService.addAction(ruleGroupInstanceId,action.getNameMap(),action.getDescriptionMap(),action.getType(),action.getTypeSettingsProperties(),serviceContext);
  }
  portletDataContext.importClassedModel(action,importedAction);
}
