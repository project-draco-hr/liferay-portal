{
  List<String> badIsbns=new ArrayList<String>();
  String amazonAccessKeyId=portletPreferences.getValue("amazon.access.key.id",StringPool.BLANK);
  String amazonAssociateTag=portletPreferences.getValue("amazon.associate.tag",StringPool.BLANK);
  String amazonSecretAccessKey=portletPreferences.getValue("amazon.secret.access.key",StringPool.BLANK);
  String[] isbns=portletPreferences.getValues("isbns",StringPool.EMPTY_ARRAY);
  for (  String isbn : isbns) {
    AmazonRankings amazonRankings=AmazonRankingsUtil.getAmazonRankings(amazonAccessKeyId,amazonAssociateTag,amazonSecretAccessKey,isbn);
    if (amazonRankings == null) {
      badIsbns.add(isbn);
      if (_log.isInfoEnabled()) {
        _log.info("Invalid ISBN " + isbn);
      }
    }
  }
  if (!badIsbns.isEmpty()) {
    throw new ValidatorException("Unable to retrieve ISBNs",badIsbns);
  }
}
