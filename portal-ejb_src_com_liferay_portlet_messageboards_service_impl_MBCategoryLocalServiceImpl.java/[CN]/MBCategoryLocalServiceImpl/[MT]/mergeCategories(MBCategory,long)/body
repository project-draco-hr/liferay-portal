{
  Iterator itr=MBCategoryUtil.findByG_P(fromCategory.getGroupId(),fromCategory.getCategoryId()).iterator();
  while (itr.hasNext()) {
    MBCategory category=(MBCategory)itr.next();
    mergeCategories(category,toCategoryId);
  }
  Iterator itr1=MBThreadUtil.findByCategoryId(fromCategory.getCategoryId()).iterator();
  while (itr1.hasNext()) {
    MBThread thread=(MBThread)itr1.next();
    thread.setCategoryId(toCategoryId);
    MBThreadUtil.update(thread);
    Iterator itr2=MBMessageUtil.findByThreadId(thread.getThreadId()).iterator();
    while (itr2.hasNext()) {
      MBMessage message=(MBMessage)itr2.next();
      message.setCategoryId(toCategoryId);
      MBMessageUtil.update(message);
      try {
        if (!fromCategory.isDiscussion()) {
          Indexer.updateMessage(message.getCompanyId(),fromCategory.getGroupId(),message.getUserName(),toCategoryId,message.getThreadId(),message.getMessageId(),message.getSubject(),message.getBody());
        }
      }
 catch (      IOException ioe) {
        _log.error("Indexing " + message.getMessageId(),ioe);
      }
    }
  }
  MBCategoryUtil.remove(fromCategory.getCategoryId());
}
