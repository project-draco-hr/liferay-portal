{
  User user=UserUtil.findByPrimaryKey(userId);
  String groupId=PortalUtil.getPortletGroupId(plid);
  Date now=new Date();
  validate(name);
  String categoryId=Long.toString(CounterServiceUtil.increment(MBCategory.class.getName()));
  MBCategory category=MBCategoryUtil.create(categoryId);
  category.setGroupId(groupId);
  category.setCompanyId(user.getCompanyId());
  category.setUserId(user.getUserId());
  category.setUserName(user.getFullName());
  category.setCreateDate(now);
  category.setModifiedDate(now);
  category.setParentCategoryId(parentCategoryId);
  category.setName(name);
  category.setDescription(description);
  MBCategoryUtil.update(category);
  addCategoryResources(category,addCommunityPermissions,addGuestPermissions);
  return category;
}
