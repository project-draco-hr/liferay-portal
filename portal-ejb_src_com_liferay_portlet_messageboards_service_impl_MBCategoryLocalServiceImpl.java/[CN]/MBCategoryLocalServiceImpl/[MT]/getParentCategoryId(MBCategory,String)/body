{
  if (parentCategoryId.equals(MBCategoryImpl.DEFAULT_PARENT_CATEGORY_ID)) {
    return parentCategoryId;
  }
  if (category.getCategoryId().equals(parentCategoryId)) {
    return category.getParentCategoryId();
  }
 else {
    MBCategory parentCategory=MBCategoryUtil.fetchByPrimaryKey(parentCategoryId);
    if ((parentCategory == null) || (category.getGroupId() != parentCategory.getGroupId())) {
      return category.getParentCategoryId();
    }
    List subcategoryIds=new ArrayList();
    getSubcategoryIds(subcategoryIds,category.getGroupId(),category.getCategoryId());
    if (subcategoryIds.contains(parentCategoryId)) {
      return category.getParentCategoryId();
    }
    return parentCategoryId;
  }
}
