{
  String protocol=url.getProtocol();
  if (PortalRunMode.isTestMode() && (protocol.equals(Http.HTTP) || protocol.equals(Http.HTTPS))) {
    try {
      InetAddress.getAllByName("mirrors");
      String urlString=url.toExternalForm();
      String newURLString=StringUtil.replace(urlString,"://","://mirrors/");
      url=new URL(newURLString);
      if (_log.isDebugEnabled()) {
        _log.debug("Swapping URL from " + urlString + " to "+ newURLString);
      }
    }
 catch (    UnknownHostException uhe) {
      if (_log.isDebugEnabled()) {
        _log.debug("Unable to resolve \"mirrors\"");
      }
    }
  }
  Path path=Paths.get(libPath,name);
  if (_log.isInfoEnabled()) {
    _log.info("Downloading " + url + " to "+ path);
  }
  try (InputStream inputStream=url.openStream()){
    Files.copy(inputStream,path,StandardCopyOption.REPLACE_EXISTING);
  }
   if (_log.isInfoEnabled()) {
    _log.info("Downloaded " + url + " to "+ path);
  }
  URI uri=path.toUri();
  if (_log.isInfoEnabled()) {
    _log.info("Installing " + path + " to "+ urlClassLoader);
  }
  _addURLMethod.invoke(urlClassLoader,uri.toURL());
  if (_log.isInfoEnabled()) {
    _log.info("Installed " + path + " to "+ urlClassLoader);
  }
}
