{
  _transactionInterceptor=(TransactionInterceptor)PortalBeanLocatorUtil.locate("transactionAdvice");
  _originalTransactionExecutor=ReflectionTestUtil.getFieldValue(_transactionInterceptor,"transactionExecutor");
  _transactionInterceptor.setTransactionExecutor(new SynchronizedTransactionExecutor(_originalTransactionExecutor));
  _originalPortalPreferencesLocalService=PortalPreferencesLocalServiceUtil.getService();
  InvocationHandler invocationHandler=new SynchronousInvocationHandler(_originalPortalPreferencesLocalService);
  ReflectionTestUtil.setFieldValue(PortalPreferencesLocalServiceUtil.class,"_service",ProxyUtil.newProxyInstance(PortalPreferencesLocalService.class.getClassLoader(),new Class<?>[]{PortalPreferencesLocalService.class},invocationHandler));
  _testThread.set(true);
}
