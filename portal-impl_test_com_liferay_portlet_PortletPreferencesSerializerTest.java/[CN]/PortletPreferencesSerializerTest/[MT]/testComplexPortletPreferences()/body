{
  PortletPreferencesImpl portletPreferences=new PortletPreferencesImpl();
  portletPreferences.setValue("","");
  portletPreferences.setValues("name1",new String[0]);
  portletPreferences.setValues("name2",new String[]{"","value1"});
  Preference preference=new Preference("name3",new String[]{"value2","value3"},true);
  portletPreferences.getPreferences().put("name3",preference);
  String actualXML=PortletPreferencesSerializer.toXML(portletPreferences);
  portletPreferences=deserialize(actualXML);
  Map<String,Preference> preferenceMap=portletPreferences.getPreferences();
  assertEquals(4,preferenceMap.size());
  preference=preferenceMap.get("");
  assertNotNull(preference);
  assertEquals("",preference.getName());
  String[] values=preference.getValues();
  assertEquals(1,values.length);
  assertEquals("",values[0]);
  assertFalse(preference.isReadOnly());
  preference=preferenceMap.get("name1");
  assertNotNull(preference);
  assertEquals("name1",preference.getName());
  values=preference.getValues();
  assertEquals(0,values.length);
  assertFalse(preference.isReadOnly());
  preference=preferenceMap.get("name2");
  assertNotNull(preference);
  assertEquals("name2",preference.getName());
  values=preference.getValues();
  assertEquals(2,values.length);
  assertEquals("",values[0]);
  assertEquals("value1",values[1]);
  assertFalse(preference.isReadOnly());
  preference=preferenceMap.get("name3");
  assertNotNull(preference);
  assertEquals("name3",preference.getName());
  values=preference.getValues();
  assertEquals(2,values.length);
  assertEquals("value2",values[0]);
  assertEquals("value3",values[1]);
  assertTrue(preference.isReadOnly());
}
