{
  try {
    HttpServletRequest httpReq=(HttpServletRequest)req;
    HttpServletResponse httpRes=(HttpServletResponse)res;
    long companyId=PortalUtil.getCompanyId(httpReq);
    boolean enabled=PrefsPropsUtil.getBoolean(companyId,PropsUtil.OPEN_SSO_AUTH_ENABLED,PropsValues.OPEN_SSO_AUTH_ENABLED);
    String loginUrl=PrefsPropsUtil.getString(companyId,PropsUtil.OPEN_SSO_LOGIN_URL,PropsValues.OPEN_SSO_LOGIN_URL);
    String logoutUrl=PrefsPropsUtil.getString(companyId,PropsUtil.OPEN_SSO_LOGOUT_URL,PropsValues.OPEN_SSO_LOGOUT_URL);
    String serviceUrl=PrefsPropsUtil.getString(companyId,PropsUtil.OPEN_SSO_SERVICE_URL,PropsValues.OPEN_SSO_SERVICE_URL);
    String cookieName=PrefsPropsUtil.getString(companyId,PropsUtil.OPEN_SSO_SUBJECT_COOKIE_NAME,PropsValues.OPEN_SSO_SUBJECT_COOKIE_NAME);
    if (!enabled || Validator.isNull(loginUrl) || Validator.isNull(logoutUrl)|| Validator.isNull(serviceUrl)|| Validator.isNull(cookieName)) {
      doFilter(OpenSSOFilter.class,req,res,chain);
      return;
    }
    String requestURI=GetterUtil.getString(httpReq.getRequestURI());
    if (requestURI.endsWith("/portal/logout")) {
      HttpSession httpSes=httpReq.getSession();
      httpSes.invalidate();
      httpRes.sendRedirect(logoutUrl);
    }
 else {
      if (isAuthenticated(httpReq,cookieName)) {
        doFilter(OpenSSOFilter.class,req,res,chain);
      }
 else {
        httpRes.sendRedirect(loginUrl);
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
