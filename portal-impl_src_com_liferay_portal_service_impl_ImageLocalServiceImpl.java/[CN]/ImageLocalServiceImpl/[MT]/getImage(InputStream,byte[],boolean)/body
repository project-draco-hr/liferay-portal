{
  try {
    if (is != null) {
      bytes=FileUtil.getBytes(is,-1,closeStream);
    }
    if (bytes == null) {
      return null;
    }
    ImageBag imageBag=ImageProcessorUtil.read(bytes);
    RenderedImage renderedImage=imageBag.getRenderedImage();
    String type=imageBag.getType();
    if (renderedImage == null) {
      throw new ImageTypeException();
    }
    int height=renderedImage.getHeight();
    int width=renderedImage.getWidth();
    int size=bytes.length;
    Image image=new ImageImpl();
    image.setTextObj(bytes);
    image.setType(type);
    image.setHeight(height);
    image.setWidth(width);
    image.setSize(size);
    return image;
  }
 catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
