{
  try {
    if (is != null) {
      bytes=_fileUtil.getBytes(is);
    }
    ImageBag imageBag=ImageProcessorUtil.read(bytes);
    RenderedImage renderedImage=imageBag.getRenderedImage();
    String type=imageBag.getType();
    if (renderedImage == null) {
      throw new IOException("Unable to retreive rendered image from input stream " + "with type " + type);
    }
    int height=renderedImage.getHeight();
    int width=renderedImage.getWidth();
    int size=bytes.length;
    Image image=new ImageImpl();
    image.setTextObj(bytes);
    image.setType(type);
    image.setHeight(height);
    image.setWidth(width);
    image.setSize(size);
    return image;
  }
  finally {
    if (is != null) {
      try {
        is.close();
      }
 catch (      IOException ioe) {
        if (_log.isWarnEnabled()) {
          _log.warn(ioe);
        }
      }
    }
  }
}
