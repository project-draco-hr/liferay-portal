{
  Image image=imagePersistence.fetchByPrimaryKey(imageId);
  if (image == null) {
    image=imagePersistence.create(imageId);
  }
  image.setModifiedDate(new Date());
  image.setType(type);
  image.setHeight(height);
  image.setWidth(width);
  image.setSize(size);
  Hook hook=HookFactory.getInstance();
  hook.updateImage(image,type,bytes);
  imagePersistence.update(image,false);
  ImageServletTokenUtil.resetToken(imageId);
  return image;
}
