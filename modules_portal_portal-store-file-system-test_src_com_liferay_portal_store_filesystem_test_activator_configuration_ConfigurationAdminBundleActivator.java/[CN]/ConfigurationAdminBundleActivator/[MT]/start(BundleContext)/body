{
  ServiceReference<ConfigurationAdmin> serviceReference=bundleContext.getServiceReference(ConfigurationAdmin.class);
  try {
    _advancedFileSystemConfiguration=_getConfiguration(bundleContext,serviceReference,_ADVANCED_FILE_SYSTEM_CONFIGURATION_PID);
    Dictionary<String,Object> properties=new Hashtable<>();
    properties.put("rootDir",_ADVANCED_ROOT_DIR);
    _advancedFileSystemConfiguration.update(properties);
    _waitForService(bundleContext,_advancedFileSystemConfiguration,"com.liferay.portal.store.filesystem.AdvancedFileSystemStore");
    _fileSystemConfiguration=_getConfiguration(bundleContext,serviceReference,_FILE_SYSTEM_CONFIGURATION_PID);
    properties=new Hashtable<>();
    properties.put("rootDir",_ROOT_DIR);
    _fileSystemConfiguration.update(properties);
    _waitForService(bundleContext,_fileSystemConfiguration,"com.liferay.portal.store.filesystem.FileSystemStore");
  }
  finally {
    bundleContext.ungetService(serviceReference);
  }
}
