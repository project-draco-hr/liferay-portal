{
  if (luceneConfiguration.indexDumpCompressionEnabled()) {
    outputStream=new GZIPOutputStream(outputStream);
  }
  ObjectOutputStream objectOputStream=new ObjectOutputStream(outputStream);
  IndexCommitMetaInfo indexCommitMetaInfo=new IndexCommitMetaInfo(indexCommit);
  if (_log.isDebugEnabled()) {
    _log.debug("Serializing " + indexCommitMetaInfo);
  }
  objectOputStream.writeObject(indexCommitMetaInfo);
  List<Segment> segments=indexCommitMetaInfo.getSegments();
  Directory directory=indexCommit.getDirectory();
  for (  Segment segment : segments) {
    if (_log.isDebugEnabled()) {
      _log.debug("Serializing segment " + segment);
    }
    _serializeSegment(directory.openInput(segment.getFileName()),segment.getFileSize(),objectOputStream);
  }
  objectOputStream.flush();
  if (luceneConfiguration.indexDumpCompressionEnabled()) {
    GZIPOutputStream gZipOutputStream=(GZIPOutputStream)outputStream;
    gZipOutputStream.finish();
  }
}
