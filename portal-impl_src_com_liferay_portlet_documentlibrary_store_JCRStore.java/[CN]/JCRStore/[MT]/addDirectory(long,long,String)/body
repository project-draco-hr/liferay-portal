{
  Session session=null;
  try {
    session=JCRFactoryUtil.createSession();
    Node rootNode=getRootNode(session,companyId);
    Node repositoryNode=getFolderNode(rootNode,repositoryId);
    if (repositoryNode.hasNode(dirName)) {
      throw new DuplicateDirectoryException(dirName);
    }
 else {
      String[] dirNameArray=StringUtil.split(dirName,'/');
      Node dirNode=repositoryNode;
      for (int i=0; i < dirNameArray.length; i++) {
        if (Validator.isNotNull(dirNameArray[i])) {
          if (dirNode.hasNode(dirNameArray[i])) {
            dirNode=dirNode.getNode(dirNameArray[i]);
          }
 else {
            dirNode=dirNode.addNode(dirNameArray[i],JCRConstants.NT_FOLDER);
          }
        }
      }
      session.save();
    }
  }
 catch (  RepositoryException re) {
    throw new SystemException(re);
  }
 finally {
    JCRFactoryUtil.closeSession(session);
  }
}
