{
  MirageTemplate mirageTemplate=(MirageTemplate)mirageJournalTemplate;
  JournalTemplate template=mirageTemplate.getTemplate();
  long groupId=template.getGroupId();
  String templateId=template.getTemplateId();
  String structureId=template.getStructureId();
  String name=template.getName();
  String description=template.getDescription();
  String xsl=template.getXsl();
  boolean formatXsl=mirageTemplate.isFormatXsl();
  String langType=template.getLangType();
  boolean cacheable=template.isCacheable();
  boolean smallImage=template.getSmallImage();
  String smallImageURL=template.getSmallImageURL();
  File smallFile=mirageTemplate.getSmallFile();
  try {
    templateId=templateId.trim().toUpperCase();
    try {
      if (formatXsl) {
        if (langType.equals(JournalTemplateImpl.LANG_TYPE_VM)) {
          xsl=JournalUtil.formatVM(xsl);
        }
 else {
          xsl=JournalUtil.formatXML(xsl);
        }
      }
    }
 catch (    DocumentException de) {
      throw new TemplateXslException();
    }
catch (    IOException ioe) {
      throw new TemplateXslException();
    }
    byte[] smallBytes=null;
    try {
      smallBytes=FileUtil.getBytes(smallFile);
    }
 catch (    IOException ioe) {
    }
    validate(name,description,xsl,smallImage,smallImageURL,smallFile,smallBytes);
    template=JournalTemplateUtil.findByG_T(groupId,templateId);
    template.setModifiedDate(new Date());
    if (Validator.isNull(template.getStructureId()) && Validator.isNotNull(structureId)) {
      template.setStructureId(structureId);
    }
    template.setName(name);
    template.setDescription(description);
    template.setXsl(xsl);
    template.setLangType(langType);
    template.setCacheable(cacheable);
    template.setSmallImage(smallImage);
    template.setSmallImageURL(smallImageURL);
    JournalTemplateUtil.update(template,false);
    saveImages(smallImage,template.getSmallImageId(),smallFile,smallBytes);
    mirageTemplate.setTemplate(template);
  }
 catch (  PortalException pe) {
    throw new CMSException(pe.getMessage(),pe);
  }
catch (  SystemException se) {
    throw new CMSException(se.getMessage(),se);
  }
}
