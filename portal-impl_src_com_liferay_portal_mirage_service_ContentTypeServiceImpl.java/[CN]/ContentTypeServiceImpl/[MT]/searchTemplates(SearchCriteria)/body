{
  try {
    List<JournalTemplate> journalTemplates=null;
    SmartFields smartFields=new SmartFields(searchCriteria.getSearchFieldValues());
    String query=smartFields.getString(MirageTemplateCriteria.QUERY);
    long companyId=smartFields.getLong(MirageTemplateCriteria.COMPANY_ID);
    long groupId=smartFields.getLong(MirageTemplateCriteria.GROUP_ID);
    String structureId=smartFields.getString(MirageTemplateCriteria.STRUCTURE_ID);
    String structureIdComparator=smartFields.getString(MirageTemplateCriteria.STRUCTURE_ID_COMPARATOR);
    int start=smartFields.getInteger(MirageTemplateCriteria.RANGE_START);
    int end=smartFields.getInteger(MirageTemplateCriteria.RANGE_END);
    OrderByComparator obc=(OrderByComparator)searchCriteria.getOrderByComparator();
    if (query.equals(MirageTemplateCriteria.FIND_BY_KEYWORDS)) {
      String keywords=smartFields.getString(MirageTemplateCriteria.KEYWORDS);
      journalTemplates=JournalTemplateFinderUtil.findByKeywords(companyId,groupId,keywords,structureId,structureIdComparator,start,end,obc);
    }
 else     if (query.equals(MirageTemplateCriteria.FIND_BY_C_G_T_S_N_D)) {
      String templateId=smartFields.getString(MirageTemplateCriteria.TEMPLATE_ID);
      String name=smartFields.getString(MirageTemplateCriteria.NAME);
      String description=smartFields.getString(MirageTemplateCriteria.DESCRIPTION);
      boolean andOperator=searchCriteria.isMatchAnyOneField();
      journalTemplates=JournalTemplateFinderUtil.findByC_G_T_S_N_D(companyId,groupId,templateId,structureId,structureIdComparator,name,description,andOperator,start,end,obc);
    }
    return getTemplatesFromJournalTemplates(journalTemplates);
  }
 catch (  SystemException se) {
    throw new TemplateNotFoundException(se.getMessage(),se.getMessage(),se);
  }
}
