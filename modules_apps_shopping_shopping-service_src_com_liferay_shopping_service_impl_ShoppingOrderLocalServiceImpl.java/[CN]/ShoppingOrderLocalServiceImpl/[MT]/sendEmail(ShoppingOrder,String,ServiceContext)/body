{
  ShoppingGroupServiceSettings shoppingGroupServiceSettings=getShoppingGroupServiceSettings(order.getGroupId());
  if (emailType.equals("confirmation") && shoppingGroupServiceSettings.isEmailOrderConfirmationEnabled()) {
  }
 else   if (emailType.equals("shipping") && shoppingGroupServiceSettings.isEmailOrderShippingEnabled()) {
  }
 else {
    return;
  }
  notifyUser(order,emailType,shoppingGroupServiceSettings,serviceContext);
  if (emailType.equals("confirmation") && order.isSendOrderEmail()) {
    order.setSendOrderEmail(false);
    shoppingOrderPersistence.update(order);
  }
 else   if (emailType.equals("shipping") && order.isSendShippingEmail()) {
    order.setSendShippingEmail(false);
    shoppingOrderPersistence.update(order);
  }
}
