{
  final CharPipe charPipe=new CharPipe(_PIPE_BUFFER_SIZE);
  Thread thread=new Thread(){
    @Override public void run(){
      Writer sampleSQLWriter=null;
      Map<String,Object> context=null;
      try {
        sampleSQLWriter=new UnsyncTeeWriter(createUnsyncBufferedWriter(charPipe.getWriter()),createFileWriter(new File(_outputDir,"sample.sql")));
        context=getContext();
        FreeMarkerUtil.process(_script,context,sampleSQLWriter);
      }
 catch (      Throwable t) {
        _freeMarkerThrowable=t;
      }
 finally {
        for (        String csvFileName : _csvFileNames) {
          Writer csvWriter=(Writer)context.get(csvFileName + "CSVWriter");
          try {
            csvWriter.close();
          }
 catch (          IOException ioe) {
            ioe.printStackTrace();
          }
        }
        if (sampleSQLWriter != null) {
          try {
            sampleSQLWriter.close();
          }
 catch (          IOException ioe) {
            ioe.printStackTrace();
          }
        }
        charPipe.close();
      }
    }
  }
;
  thread.start();
  return charPipe.getReader();
}
