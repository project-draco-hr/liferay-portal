{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  verify(ddmStructureIds);
  long documentTypeId=counterLocalService.increment();
  DLDocumentType documentType=dlDocumentTypePersistence.create(documentTypeId);
  documentType.setGroupId(groupId);
  documentType.setCompanyId(user.getCompanyId());
  documentType.setUserId(user.getUserId());
  documentType.setUserName(user.getFullName());
  documentType.setCreateDate(serviceContext.getCreateDate(now));
  documentType.setModifiedDate(serviceContext.getModifiedDate(now));
  documentType.setName(name);
  documentType.setDescription(description);
  dlDocumentTypePersistence.update(documentType,false);
  dlDocumentTypePersistence.addDDMStructures(documentTypeId,ddmStructureIds);
  if (serviceContext.getAddGroupPermissions() || serviceContext.getAddGuestPermissions()) {
    addDocumentTypeResources(documentType,serviceContext.getAddGroupPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addDocumentTypeResources(documentType,serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions());
  }
  return documentType;
}
