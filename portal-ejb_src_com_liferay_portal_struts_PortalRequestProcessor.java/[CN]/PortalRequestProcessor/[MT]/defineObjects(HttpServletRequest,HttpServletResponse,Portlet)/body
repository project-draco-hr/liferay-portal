{
  String portletId=portlet.getPortletId();
  ServletContext ctx=(ServletContext)req.getAttribute(WebKeys.CTX);
  CachePortlet cachePortlet=PortletInstanceFactory.create(portlet,ctx);
  String[] portletPreferencesIds=PortletPreferencesFactory.getPortletPreferencesIds(req,portletId);
  PortletPreferences portletPreferences=PortletPreferencesLocalServiceUtil.getPreferences(portlet.getCompanyId(),portletPreferencesIds[0],portletPreferencesIds[1],portletPreferencesIds[2]);
  PortletConfig portletConfig=PortletConfigFactory.create(portlet,ctx);
  PortletContext portletCtx=portletConfig.getPortletContext();
  RenderRequestImpl renderRequestImpl=RenderRequestFactory.create(req,portlet,cachePortlet,portletCtx,WindowState.MAXIMIZED,PortletMode.VIEW,portletPreferences);
  RenderResponseImpl renderResponseImpl=RenderResponseFactory.create(renderRequestImpl,res,portletId,portlet.getCompanyId());
  renderRequestImpl.defineObjects(portletConfig,renderResponseImpl);
  req.setAttribute(WebKeys.PORTLET_STRUTS_EXECUTE,Boolean.TRUE);
}
