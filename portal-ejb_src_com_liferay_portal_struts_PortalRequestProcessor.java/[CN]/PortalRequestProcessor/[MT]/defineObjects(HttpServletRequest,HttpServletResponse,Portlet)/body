{
  String portletId=portlet.getPortletId();
  ServletContext ctx=(ServletContext)req.getAttribute(WebKeys.CTX);
  CachePortlet cachePortlet=PortletInstanceFactory.create(portlet,ctx);
  PortletPreferencesPK prefsPK=PortletPreferencesFactory.getPortletPreferencesPK(req,portletId);
  PortletPreferences prefs=PortletPreferencesLocalServiceUtil.getPreferences(portlet.getCompanyId(),prefsPK);
  PortletConfig portletConfig=PortletConfigFactory.create(portlet,ctx);
  PortletContext portletCtx=portletConfig.getPortletContext();
  RenderRequestImpl renderRequestImpl=RenderRequestFactory.create(req,portlet,cachePortlet,portletCtx,WindowState.MAXIMIZED,PortletMode.VIEW,prefs);
  RenderResponseImpl renderResponseImpl=RenderResponseFactory.create(renderRequestImpl,res,portletId,portlet.getCompanyId());
  renderRequestImpl.defineObjects(portletConfig,renderResponseImpl);
  req.setAttribute(WebKeys.PORTLET_STRUTS_EXECUTE,Boolean.TRUE);
}
