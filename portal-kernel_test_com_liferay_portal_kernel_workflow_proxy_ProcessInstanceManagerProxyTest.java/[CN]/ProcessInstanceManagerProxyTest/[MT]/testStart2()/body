{
  final long testProcessInstanceId=101;
  final int testProcessInstanceVersion=2;
  final String testDefinitionName="testDefinitionName";
  final Map<String,Object> contextInfo=new HashMap<String,Object>();
  final long testUserId=101;
  final String testKey="testKey";
  final String testValue="testValue";
  final String testActivityName="testActivityName";
  contextInfo.put(testKey,testValue);
  MessageListener startListener=new MessageListener(){
    public void receive(    Message message){
      ProcessInstanceRequest request=(ProcessInstanceRequest)message.getPayload();
      assertEquals(ProcessInstanceRequestType.START,request.getType());
      assertEquals(testDefinitionName,request.getWorkflowDefinitionName());
      Map<String,Object> context=request.getContextInfo();
      assertNotNull(context);
      assertEquals(testValue,context.get(testKey));
      assertEquals(testUserId,request.getUserId());
      assertEquals(testActivityName,request.getActivityName());
      String responseDestination=message.getResponseDestination();
      if (responseDestination != null) {
        ProcessInstanceInfo instance=new ProcessInstanceInfo(testProcessInstanceId,testProcessInstanceVersion);
        message.setPayload(new WorkflowResultContainer<ProcessInstanceInfo>(instance));
        messageBus.sendMessage(responseDestination,message);
      }
    }
  }
;
  messageBus.registerMessageListener(DestinationNames.WORKFLOW_INSTANCE,startListener);
  ProcessInstanceInfo instance=_proxy.startProcessInstance(testDefinitionName,contextInfo,testUserId,testActivityName);
  assertNotNull(instance);
}
