{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  ConfigurationHelper configurationHelper=new ConfigurationHelper(_bundleContext,_configurationAdmin,_extendedMetaTypeService,themeDisplay.getLanguageId());
  String factoryPid=ParamUtil.getString(resourceRequest,"factoryPid");
  String pid=ParamUtil.getString(resourceRequest,"pid",factoryPid);
  ConfigurationModel configurationModel=configurationHelper.getConfigurationModel(pid);
  if ((configurationModel == null) && Validator.isNotNull(factoryPid)) {
    configurationModel=configurationHelper.getConfigurationModel(factoryPid);
  }
  ExtendedAttributeDefinition[] attributeDefinitions=configurationModel.getAttributeDefinitions(ConfigurationModel.ALL);
  Properties properties=new Properties();
  for (  AttributeDefinition attributeDefinition : attributeDefinitions) {
    Configuration configuration=configurationModel.getConfiguration();
    String[] values=AttributeDefinitionUtil.getProperty(attributeDefinition,configuration);
    String value=null;
    if (values.length == 1) {
      value=values[0];
    }
 else     if (values.length > 1) {
      value=StringUtil.merge(values,"\n");
    }
    properties.setProperty(attributeDefinition.getID(),value);
  }
  return properties;
}
