{
  if (!_reloadDependants) {
    return servlet;
  }
  try {
    Method method=ReflectionUtil.getDeclaredMethod(servlet.getClass(),"getDependants");
    Collection<String> dependants=null;
    String jasperVersion=JasperVersionDetector.getJasperVersion();
    if (jasperVersion.contains("7.0")) {
      Map<String,?> dependantsMap=(Map<String,?>)method.invoke(servlet);
      if (dependantsMap != null) {
        dependants=dependantsMap.keySet();
      }
    }
 else {
      dependants=(List<String>)method.invoke(servlet);
    }
    if (dependants == null) {
      return servlet;
    }
    boolean reloadServlet=false;
    for (    String dependant : dependants) {
      long lastModified=getFileLastModified(dependant,servlet);
      Long previousLastModified=_dependantTimestamps.get(dependant);
      if (previousLastModified == null) {
        _dependantTimestamps.put(dependant,lastModified);
        previousLastModified=lastModified;
      }
      if ((lastModified == 0) || (lastModified != previousLastModified.longValue())) {
        reloadServlet=true;
        _dependantTimestamps.put(dependant,lastModified);
        if (_log.isDebugEnabled()) {
          _log.debug("Reload dependant " + dependant);
        }
      }
    }
    if (reloadServlet) {
      _servletInfos.remove(path);
      updateFileLastModified(path,servlet);
      servlet=null;
    }
  }
 catch (  NoSuchMethodException nsme) {
    if (_log.isWarnEnabled()) {
      _log.warn("Reloading of dependant JSP is disabled because your " + "Servlet container is not a variant of Jasper");
    }
    _reloadDependants=false;
  }
catch (  Exception e) {
    _log.error(e,e);
  }
  return servlet;
}
