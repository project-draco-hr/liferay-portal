{
  try {
    if (emailAddresses != null) {
      String home=PropsUtil.get(PropsKeys.MAIL_HOOK_CYRUS_HOME);
      File file=new File(home + "/" + userId+ ".procmail.forward");
      if ((filters.size() > 0) || (emailAddresses.size() > 0) || leaveCopy) {
        StringBundler sb=new StringBundler(5 * filters.size() + 2 * emailAddresses.size() + 4);
        for (int i=0; i < filters.size(); i++) {
          Filter filter=filters.get(i);
          sb.append(":0\n* ^(From|Cc|To).*");
          sb.append(filter.getEmailAddress());
          sb.append("\n| $DELIVER -e -a $USER -m user.$USER.");
          sb.append(filter.getFolder());
          sb.append("\n\n");
        }
        if (leaveCopy) {
          sb.append(":0 c\n");
          sb.append("| $DELIVER -e -a $USER -m user.$USER\n\n");
        }
        if (emailAddresses.size() > 0) {
          sb.append(":0\n");
          sb.append("!");
          for (          String emailAddress : emailAddresses) {
            sb.append(" ");
            sb.append(emailAddress);
          }
        }
        String content=sb.toString();
        while (content.endsWith("\n")) {
          content=content.substring(0,content.length() - 1);
        }
        FileUtil.write(file,content);
      }
 else {
        file.delete();
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
