{
  for (  long companyId : PortalInstances.getCompanyIds()) {
    String backupName=null;
    if (initialize) {
      backupName="temp-init-search-" + companyId + "-"+ System.currentTimeMillis();
    }
 else {
      backupName="temp-search-" + companyId + "-"+ System.currentTimeMillis();
    }
    String backupFileName=null;
    try {
      backupFileName=SearchEngineUtil.backup(companyId,SearchEngineUtil.SYSTEM_ENGINE_ID,backupName);
      if (initialize) {
        Runtime runtime=Runtime.getRuntime();
        runtime.addShutdownHook(new DeleteFileShutdownHook(backupFileName));
      }
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
 finally {
      if (initialize) {
        _initializedIndexNames.put(companyId,backupFileName);
      }
 else {
        _indexNames.put(companyId,backupFileName);
      }
    }
  }
}
