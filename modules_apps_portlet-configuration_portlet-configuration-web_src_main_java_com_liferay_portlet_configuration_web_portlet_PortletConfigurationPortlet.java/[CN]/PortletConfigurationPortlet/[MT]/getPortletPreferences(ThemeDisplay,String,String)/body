{
  Layout layout=themeDisplay.getLayout();
  if (!layout.isSupportsEmbeddedPortlets()) {
    return null;
  }
  LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
  if (!layoutTypePortlet.isPortletEmbedded(portletId)) {
    return null;
  }
  PortletPreferencesIds portletPreferencesIds=PortletPreferencesFactoryUtil.getPortletPreferencesIds(themeDisplay.getCompanyId(),themeDisplay.getSiteGroupId(),PortletKeys.PREFS_PLID_SHARED,portletId,settingsScope);
  return _portletPreferencesLocalService.getPreferences(portletPreferencesIds);
}
