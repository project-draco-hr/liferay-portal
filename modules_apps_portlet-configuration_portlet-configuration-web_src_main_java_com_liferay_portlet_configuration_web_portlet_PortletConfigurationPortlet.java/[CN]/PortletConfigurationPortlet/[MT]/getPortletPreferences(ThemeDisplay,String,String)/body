{
  Layout layout=themeDisplay.getLayout();
  if (!layout.isSupportsEmbeddedPortlets()) {
    return null;
  }
  LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
  if (!layoutTypePortlet.isPortletEmbedded(portletId)) {
    return null;
  }
  PortletPreferencesIds portletPreferencesIds=new PortletPreferencesIds(themeDisplay.getCompanyId(),layout.getGroupId(),PortletKeys.PREFS_OWNER_TYPE_LAYOUT,PortletKeys.PREFS_PLID_SHARED,portletId);
  return _portletPreferencesLocalService.getPreferences(portletPreferencesIds);
}
