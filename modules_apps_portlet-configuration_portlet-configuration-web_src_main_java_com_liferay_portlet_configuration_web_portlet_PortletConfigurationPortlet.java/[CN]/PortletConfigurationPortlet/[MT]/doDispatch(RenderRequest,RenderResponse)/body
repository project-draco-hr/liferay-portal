{
  try {
    String mvcPath=renderRequest.getParameter("mvcPath");
    if (mvcPath.equals("/edit_permissions.jsp")) {
      checkEditPermissionsJSP(renderRequest);
      super.doDispatch(renderRequest,renderResponse);
      return;
    }
    Portlet portlet=ActionUtil.getPortlet(renderRequest);
    if (mvcPath.endsWith("edit_configuration.jsp")) {
      ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
      String settingsScope=renderRequest.getParameter("settingsScope");
      PortletPreferences portletPreferences=getPortletPreferences(themeDisplay,portlet.getPortletId(),settingsScope);
      renderRequest=ActionUtil.getWrappedRenderRequest(renderRequest,portletPreferences);
      renderEditConfiguration(renderRequest,portlet);
    }
 else {
      PortletPreferences portletPreferences=ActionUtil.getLayoutPortletSetup(renderRequest,portlet);
      renderRequest=ActionUtil.getWrappedRenderRequest(renderRequest,portletPreferences);
      if (mvcPath.endsWith("edit_public_render_parameters.jsp")) {
        renderEditPublicParameters(renderRequest,portlet);
      }
    }
    renderResponse.setTitle(ActionUtil.getTitle(portlet,renderRequest));
    super.doDispatch(renderRequest,renderResponse);
  }
 catch (  Exception e) {
    _log.error(e.getMessage());
    SessionErrors.add(renderRequest,e.getClass());
    include("/error.jsp",renderRequest,renderResponse);
  }
}
