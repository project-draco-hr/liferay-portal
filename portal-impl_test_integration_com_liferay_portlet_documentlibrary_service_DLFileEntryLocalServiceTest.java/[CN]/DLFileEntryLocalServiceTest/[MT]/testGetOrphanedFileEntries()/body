{
  DLFolder dlFolder=DLTestUtil.addDLFolder(_group.getGroupId());
  byte[] bytes=RandomTestUtil.randomBytes();
  InputStream is=new ByteArrayInputStream(bytes);
  ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext(dlFolder.getGroupId());
  FileEntry fileEntry=DLAppLocalServiceUtil.addFileEntry(TestPropsValues.getUserId(),dlFolder.getRepositoryId(),dlFolder.getFolderId(),RandomTestUtil.randomString(),ContentTypes.TEXT_PLAIN,RandomTestUtil.randomString(),StringPool.BLANK,StringPool.BLANK,is,bytes.length,serviceContext);
  boolean indexReadOnly=SearchEngineUtil.isIndexReadOnly();
  DLFileEntry dlFileEntry=null;
  try {
    SearchEngineUtil.setIndexReadOnly(true);
    dlFileEntry=DLFileEntryLocalServiceUtil.getFileEntry(fileEntry.getFileEntryId());
    dlFileEntry.setGroupId(10000l);
    DLFileEntryLocalServiceUtil.updateDLFileEntry(dlFileEntry);
    List<DLFileEntry> dlFileEntries=DLFileEntryLocalServiceUtil.getOrphanedFileEntries();
    Assert.assertEquals(1,dlFileEntries.size());
    Assert.assertEquals(dlFileEntry,dlFileEntries.get(0));
  }
  finally {
    if (dlFileEntry != null) {
      DLFileEntryLocalServiceUtil.deleteDLFileEntry(dlFileEntry.getFileEntryId());
    }
    SearchEngineUtil.setIndexReadOnly(indexReadOnly);
  }
}
