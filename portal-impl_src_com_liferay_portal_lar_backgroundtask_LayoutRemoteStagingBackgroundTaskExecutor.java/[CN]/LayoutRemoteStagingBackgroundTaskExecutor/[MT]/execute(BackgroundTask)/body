{
  ExportImportConfiguration exportImportConfiguration=getExportImportConfiguration(backgroundTask);
  clearBackgroundTaskStatus(backgroundTask);
  MissingReferences missingReferences=null;
  try {
    ExportImportThreadLocal.setLayoutStagingInProcess(true);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(EVENT_PUBLICATION_LAYOUT_REMOTE_STARTED,PROCESS_FLAG_LAYOUT_STAGING_IN_PROCESS,exportImportConfiguration);
    missingReferences=TransactionHandlerUtil.invoke(transactionAttribute,new LayoutRemoteStagingCallable(backgroundTask.getBackgroundTaskId(),exportImportConfiguration));
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(EVENT_PUBLICATION_LAYOUT_REMOTE_SUCCEEDED,PROCESS_FLAG_LAYOUT_STAGING_IN_PROCESS,exportImportConfiguration);
  }
 catch (  Throwable t) {
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(EVENT_PUBLICATION_LAYOUT_REMOTE_FAILED,PROCESS_FLAG_LAYOUT_STAGING_IN_PROCESS,exportImportConfiguration);
    if (_log.isDebugEnabled()) {
      _log.debug(t,t);
    }
 else     if (_log.isWarnEnabled()) {
      _log.warn("Unable to publish layout: " + t.getMessage());
    }
    throw new SystemException(t);
  }
 finally {
    ExportImportThreadLocal.setLayoutStagingInProcess(false);
  }
  return processMissingReferences(backgroundTask.getBackgroundTaskId(),missingReferences);
}
