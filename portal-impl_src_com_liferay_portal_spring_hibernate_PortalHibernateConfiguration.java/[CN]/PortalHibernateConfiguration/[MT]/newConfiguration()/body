{
  Configuration configuration=new Configuration();
  Properties properties=PropsUtil.getProperties();
  Properties hibernateProperties=getHibernateProperties();
  for (  Map.Entry<Object,Object> entry : hibernateProperties.entrySet()) {
    String key=(String)entry.getKey();
    String value=(String)entry.getValue();
    properties.setProperty(key,value);
  }
  if (Validator.isNull(PropsValues.HIBERNATE_DIALECT)) {
    Dialect dialect=DialectDetector.getDialect(getDataSource());
    DBFactoryUtil.setDB(dialect,getDataSource());
    Class<?> clazz=dialect.getClass();
    properties.setProperty("hibernate.dialect",clazz.getName());
  }
  properties.setProperty("hibernate.cache.use_query_cache","false");
  properties.setProperty("hibernate.cache.use_second_level_cache","false");
  properties.remove("hibernate.cache.region.factory_class");
  configuration.setProperties(properties);
  try {
    String[] resources=getConfigurationResources();
    for (    String resource : resources) {
      try {
        readResource(configuration,resource);
      }
 catch (      Exception e2) {
        if (_log.isWarnEnabled()) {
          _log.warn(e2,e2);
        }
      }
    }
    if (_mvccEnabled) {
      EventListeners eventListeners=configuration.getEventListeners();
      eventListeners.setAutoFlushEventListeners(new AutoFlushEventListener[]{NestableAutoFlushEventListener.INSTANCE});
      eventListeners.setPostUpdateEventListeners(new PostUpdateEventListener[]{MVCCSynchronizerPostUpdateEventListener.INSTANCE});
    }
  }
 catch (  Exception e1) {
    _log.error(e1,e1);
  }
  return configuration;
}
