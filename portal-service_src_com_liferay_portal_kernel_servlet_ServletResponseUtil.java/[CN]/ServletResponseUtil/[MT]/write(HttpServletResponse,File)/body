{
  if (response instanceof BufferCacheServletResponse) {
    BufferCacheServletResponse bufferCacheServletResponse=(BufferCacheServletResponse)response;
    ByteBuffer byteBuffer=ByteBuffer.wrap(FileUtil.getBytes(file));
    bufferCacheServletResponse.setByteBuffer(byteBuffer);
  }
 else {
    FileInputStream fileInputStream=new FileInputStream(file);
    try (FileChannel fileChannel=fileInputStream.getChannel()){
      long contentLength=fileChannel.size();
      setContentLength(response,contentLength);
      response.flushBuffer();
      fileChannel.transferTo(0,contentLength,Channels.newChannel(response.getOutputStream()));
    }
   }
}
