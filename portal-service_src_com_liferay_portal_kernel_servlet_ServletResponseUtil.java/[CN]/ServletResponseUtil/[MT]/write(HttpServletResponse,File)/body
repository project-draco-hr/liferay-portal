{
  if (response instanceof BufferCacheServletResponse) {
    BufferCacheServletResponse bufferCacheServletResponse=(BufferCacheServletResponse)response;
    ByteBuffer byteBuffer=ByteBuffer.wrap(FileUtil.getBytes(file));
    bufferCacheServletResponse.setByteBuffer(byteBuffer);
  }
 else {
    FileInputStream fileInputStream=new FileInputStream(file);
    try (FileChannel fileChannel=fileInputStream.getChannel()){
      long contentLength=fileChannel.size();
      response.setHeader(HttpHeaders.CONTENT_LENGTH,String.valueOf(contentLength));
      response.flushBuffer();
      fileChannel.transferTo(0,contentLength,Channels.newChannel(response.getOutputStream()));
    }
   }
}
