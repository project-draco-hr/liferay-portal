{
  Range fullRange=new Range(0,fullLength - 1,fullLength);
  OutputStream outputStream=null;
  try {
    outputStream=response.getOutputStream();
    Range firstRange=null;
    if (!ranges.isEmpty()) {
      firstRange=ranges.get(0);
    }
    if ((firstRange == null) || firstRange.equals(fullRange)) {
      if (_log.isDebugEnabled()) {
        _log.debug("Writing full range");
      }
      response.setContentType(contentType);
      setHeaders(request,response,fileName,contentType,fullRange);
      copyRange(inputStream,outputStream,fullRange.getStart(),fullRange.getLength());
    }
 else     if (ranges.size() >= 1) {
      if (_log.isDebugEnabled()) {
        _log.debug("Attempting to write single or multiple range");
      }
      if (ranges.size() > 1) {
        if (_log.isWarnEnabled()) {
          _log.warn("Multiple range is not supported");
        }
      }
      Range range=ranges.get(0);
      response.setContentType(contentType);
      setHeaders(request,response,fileName,contentType,range);
      response.setStatus(HttpServletResponse.SC_PARTIAL_CONTENT);
      copyRange(inputStream,outputStream,range.getStart(),range.getLength());
    }
  }
  finally {
    try {
      inputStream.close();
    }
 catch (    IOException e) {
    }
  }
}
