{
  Range full=new Range(0,fullLength - 1,fullLength);
  OutputStream output=null;
  try {
    output=response.getOutputStream();
    if (ranges.isEmpty() || ranges.get(0) == full) {
      if (_log.isDebugEnabled()) {
        _log.debug("Writing full range");
      }
      response.setContentType(contentType);
      setHeaders(request,response,fileName,contentType,full);
      copyRange(input,output,full.getStart(),full.getLength());
    }
 else     if (ranges.size() >= 1) {
      if (_log.isDebugEnabled()) {
        _log.debug("Attempting to write single or multiple range");
      }
      if (ranges.size() > 1) {
        if (_log.isWarnEnabled()) {
          _log.warn("Multiple range is not supported. Sending as a " + "single range");
        }
      }
      Range range=ranges.get(0);
      response.setContentType(contentType);
      setHeaders(request,response,fileName,contentType,range);
      response.setStatus(HttpServletResponse.SC_PARTIAL_CONTENT);
      copyRange(input,output,range.getStart(),range.getLength());
    }
  }
  finally {
    try {
      input.close();
    }
 catch (    IOException e) {
    }
  }
}
