{
  OutputStream outputStream=null;
  try {
    if (response.isCommitted()) {
      return;
    }
    if (contentLength > 0) {
      response.setContentLength((int)contentLength);
    }
    response.flushBuffer();
    StreamUtil.transfer(inputStream,response.getOutputStream(),false);
  }
  finally {
    StreamUtil.cleanUp(inputStream,outputStream);
  }
}
