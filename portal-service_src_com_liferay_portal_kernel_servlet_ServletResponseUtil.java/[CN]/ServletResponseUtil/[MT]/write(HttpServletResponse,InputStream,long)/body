{
  OutputStream outputStream=null;
  try {
    if (response.isCommitted()) {
      return;
    }
    if (contentLength > 0) {
      response.setHeader(HttpHeaders.CONTENT_LENGTH,String.valueOf(contentLength));
    }
    response.flushBuffer();
    StreamUtil.transfer(inputStream,response.getOutputStream(),false);
  }
  finally {
    StreamUtil.cleanUp(inputStream,outputStream);
  }
}
