{
  try {
    if (!response.isCommitted()) {
      if (contentLength == 0) {
        contentLength=bytes.length;
      }
      response.setContentLength(contentLength);
      try {
        response.flushBuffer();
      }
 catch (      NullPointerException npe) {
        if (!ServerDetector.isGlassfish()) {
          throw npe;
        }
        if (_log.isDebugEnabled()) {
          _log.debug("Ignoring NullPointerException because of " + "GLASSFISH-17150");
        }
      }
      if (response instanceof ByteBufferServletResponse) {
        ByteBufferServletResponse byteBufferResponse=(ByteBufferServletResponse)response;
        byteBufferResponse.setByteBuffer(ByteBuffer.wrap(bytes,offset,contentLength));
      }
 else {
        ServletOutputStream servletOutputStream=response.getOutputStream();
        if ((contentLength == 0) && ServerDetector.isJetty()) {
        }
 else {
          servletOutputStream.write(bytes,offset,contentLength);
        }
      }
    }
  }
 catch (  IOException ioe) {
    if ((ioe instanceof SocketException) || isClientAbortException(ioe)) {
      if (_log.isWarnEnabled()) {
        _log.warn(ioe);
      }
    }
 else {
      throw ioe;
    }
  }
}
