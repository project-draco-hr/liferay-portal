{
  List<Range> ranges=new ArrayList<Range>();
  String range=request.getHeader(HttpHeaders.RANGE);
  if (Validator.isNotNull(range)) {
    if (!range.matches(_RANGE_REGEX)) {
      throw new IOException("Range header does not match regex");
    }
    if (ranges.isEmpty()) {
      for (      String part : range.substring(6).split(",")) {
        int index=part.indexOf("-");
        long start=getLongFromSubstring(part,0,index);
        long end=getLongFromSubstring(part,index + 1,part.length());
        if (start == -1) {
          start=length - end;
          end=length - 1;
        }
 else         if (end == -1 || end > length - 1) {
          end=length - 1;
        }
        if (start > end) {
          throw new IOException("Range start " + start + " is greater than end "+ end);
        }
        ranges.add(new Range(start,end,length));
      }
    }
  }
  return ranges;
}
