{
  String template=readFile(sqlDir + "/" + fileName+ ".sql");
  if (fileName.equals("portal") || fileName.equals("update-5.0.1-5.1.0")) {
    StringBundler sb=new StringBundler();
    try (UnsyncBufferedReader unsyncBufferedReader=new UnsyncBufferedReader(new UnsyncStringReader(template))){
      String line=null;
      while ((line=unsyncBufferedReader.readLine()) != null) {
        if (line.startsWith("@include ")) {
          int pos=line.indexOf(" ");
          String includeFileName=line.substring(pos + 1);
          File includeFile=new File(sqlDir + "/" + includeFileName);
          if (!includeFile.exists()) {
            continue;
          }
          String include=FileUtil.read(includeFile);
          if (includeFileName.endsWith(".vm")) {
            try {
              include=evaluateVM(includeFileName,include);
            }
 catch (            Exception e) {
              _log.error(e,e);
            }
          }
          include=convertTimestamp(include);
          include=replaceTemplate(include,getTemplate());
          sb.append(include);
          sb.append("\n\n");
        }
 else {
          sb.append(line);
          sb.append("\n");
        }
      }
    }
     template=sb.toString();
  }
  if (fileName.equals("indexes")) {
    template=applyMaxStringIndexLengthLimitation(_columnLengthPattern.matcher(template));
    if (getDBType() == DBType.SYBASE) {
      template=removeBooleanIndexes(sqlDir,template);
    }
  }
  return template;
}
