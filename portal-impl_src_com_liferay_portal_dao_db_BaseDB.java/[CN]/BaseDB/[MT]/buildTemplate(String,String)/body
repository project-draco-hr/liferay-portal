{
  String templateKey=sqlDir.concat(fileName);
  String template=_templatesMap.get(templateKey);
  if (template != null) {
    return template;
  }
  template=readFile(sqlDir + "/" + fileName+ ".sql");
  if (fileName.equals("portal") || fileName.equals("portal-minimal") || fileName.equals("update-5.0.1-5.1.0")) {
    UnsyncBufferedReader unsyncBufferedReader=new UnsyncBufferedReader(new UnsyncStringReader(template));
    StringBundler sb=new StringBundler();
    String line=null;
    while ((line=unsyncBufferedReader.readLine()) != null) {
      if (line.startsWith("@include ")) {
        int pos=line.indexOf(" ");
        String includeFileName=line.substring(pos + 1);
        File includeFile=new File(sqlDir + "/" + includeFileName);
        if (!includeFile.exists()) {
          continue;
        }
        String include=FileUtil.read(includeFile);
        if (includeFileName.endsWith(".vm")) {
          try {
            include=evaluateVM(include);
          }
 catch (          Exception e) {
            _log.error(e,e);
          }
        }
        include=convertTimestamp(include);
        include=replaceTemplate(include,getTemplate());
        sb.append(include);
        sb.append("\n\n");
      }
 else {
        sb.append(line);
        sb.append("\n");
      }
    }
    unsyncBufferedReader.close();
    template=sb.toString();
  }
  if (fileName.equals("indexes") && (this instanceof SybaseDB)) {
    template=removeBooleanIndexes(sqlDir,template);
  }
  _templatesMap.put(templateKey,template);
  return template;
}
