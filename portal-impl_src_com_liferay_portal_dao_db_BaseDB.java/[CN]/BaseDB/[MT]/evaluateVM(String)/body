{
  Map<String,Object> variables=new HashMap<>();
  variables.put("counter",new SimpleCounter());
  variables.put("portalUUIDUtil",PortalUUIDUtil.class);
  ClassLoader classLoader=ClassLoaderUtil.getContextClassLoader();
  try {
    ClassLoaderUtil.setContextClassLoader(ClassLoaderUtil.getPortalClassLoader());
    template=VelocityUtil.evaluate(template,variables);
  }
  finally {
    ClassLoaderUtil.setContextClassLoader(classLoader);
  }
  StringBundler sb=new StringBundler();
  try (UnsyncBufferedReader unsyncBufferedReader=new UnsyncBufferedReader(new UnsyncStringReader(template))){
    String line=null;
    while ((line=unsyncBufferedReader.readLine()) != null) {
      line=line.trim();
      sb.append(line);
      sb.append("\n");
    }
  }
   template=sb.toString();
  template=StringUtil.replace(template,"\n\n\n","\n\n");
  return template;
}
