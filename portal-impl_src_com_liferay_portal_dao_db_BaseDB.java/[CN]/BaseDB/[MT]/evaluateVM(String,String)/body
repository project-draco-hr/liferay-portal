{
  if (Validator.isNull(templateContent)) {
    return StringPool.BLANK;
  }
  ClassLoader classLoader=ClassLoaderUtil.getContextClassLoader();
  UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
  try {
    ClassLoaderUtil.setContextClassLoader(ClassLoaderUtil.getPortalClassLoader());
    StringTemplateResource stringTemplateResource=new StringTemplateResource(templateId,templateContent);
    Template template=TemplateManagerUtil.getTemplate(TemplateConstants.LANG_TYPE_VM,stringTemplateResource,false);
    template.put("counter",new SimpleCounter());
    template.put("portalUUIDUtil",PortalUUIDUtil.class);
    template.processTemplate(unsyncStringWriter);
  }
  finally {
    ClassLoaderUtil.setContextClassLoader(classLoader);
  }
  StringBundler sb=new StringBundler();
  try (UnsyncBufferedReader unsyncBufferedReader=new UnsyncBufferedReader(new UnsyncStringReader(unsyncStringWriter.toString()))){
    String line=null;
    while ((line=unsyncBufferedReader.readLine()) != null) {
      line=line.trim();
      sb.append(line);
      sb.append("\n");
    }
  }
   templateContent=sb.toString();
  templateContent=StringUtil.replace(templateContent,"\n\n\n","\n\n");
  return templateContent;
}
