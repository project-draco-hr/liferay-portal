{
  List<StagedModel> dependentStagedModels=dependentStagedModelsMap.get(MBCategory.class.getSimpleName());
  MBCategory category=(MBCategory)dependentStagedModels.get(0);
  List<ObjectValuePair<String,InputStream>> objectValuePairs=MBTestUtil.getInputStreamOVPs("attachment.txt",getClass(),StringPool.BLANK);
  MBMessage message=MBTestUtil.addMessageWithWorkflowAndAttachments(group.getGroupId(),category.getCategoryId(),true,objectValuePairs);
  List<FileEntry> attachmentsFileEntries=message.getAttachmentsFileEntries();
  FileEntry fileEntry=attachmentsFileEntries.get(0);
  Folder folder=fileEntry.getFolder();
  while (folder != null) {
    addDependentStagedModel(dependentStagedModelsMap,DLFolder.class,folder);
    folder=folder.getParentFolder();
  }
  addDependentStagedModel(dependentStagedModelsMap,DLFileEntry.class,attachmentsFileEntries.get(0));
  Repository repository=RepositoryUtil.fetchByPrimaryKey(fileEntry.getRepositoryId());
  addDependentStagedModel(dependentStagedModelsMap,Repository.class,repository);
  return message;
}
