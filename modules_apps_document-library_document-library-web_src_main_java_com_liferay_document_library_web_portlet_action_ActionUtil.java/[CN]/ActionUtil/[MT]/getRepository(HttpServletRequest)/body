{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  long repositoryId=ParamUtil.getLong(request,"repositoryId");
  Repository repository=null;
  if (repositoryId > 0) {
    repository=RepositoryServiceUtil.getRepository(repositoryId);
  }
 else {
    DLPermission.check(themeDisplay.getPermissionChecker(),themeDisplay.getScopeGroupId(),ActionKeys.VIEW);
  }
  request.setAttribute(WebKeys.DOCUMENT_LIBRARY_REPOSITORY,repository);
  return repository;
}
