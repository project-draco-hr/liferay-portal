{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long plid=ParamUtil.getLong(request,"plid");
  long groupId=ParamUtil.getLong(request,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(request,"privateLayout");
  long layoutId=ParamUtil.getLong(request,"layoutId");
  long parentLayoutId=ParamUtil.getLong(request,"parentLayoutId");
  Layout layout=null;
  if (plid > 0) {
    layout=LayoutLocalServiceUtil.getLayout(plid);
  }
 else   if (layoutId > 0) {
    layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,layoutId);
  }
 else   if (parentLayoutId > 0) {
    layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,parentLayoutId);
  }
  if ((layout != null) && !LayoutPermissionUtil.contains(permissionChecker,layout,ActionKeys.UPDATE)) {
    return null;
  }
  String cmd=ParamUtil.getString(request,Constants.CMD);
  JSONObject jsonObj=JSONFactoryUtil.createJSONObject();
  if (cmd.equals("add")) {
    String[] array=addPage(themeDisplay,request,response);
    jsonObj.put("layoutId",array[0]);
    jsonObj.put("url",array[1]);
  }
 else   if (cmd.equals("delete")) {
    SitesUtil.deleteLayout(request,response);
  }
 else   if (cmd.equals("display_order")) {
    updateDisplayOrder(request);
  }
 else   if (cmd.equals("name")) {
    updateName(request);
  }
 else   if (cmd.equals("parent_layout_id")) {
    updateParentLayoutId(request);
  }
 else   if (cmd.equals("priority")) {
    updatePriority(request);
  }
  return jsonObj.toString();
}
