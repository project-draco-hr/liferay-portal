{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String cmd=ParamUtil.getString(request,Constants.CMD);
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  try {
    if (cmd.equals("add")) {
      String[] array=addPage(themeDisplay,request,response);
      jsonObject.put("deletable",Boolean.valueOf(array[2]));
      jsonObject.put("layoutId",array[0]);
      jsonObject.put("sortable",Boolean.valueOf(array[3]));
      jsonObject.put("updateable",Boolean.valueOf(array[4]));
      jsonObject.put("url",array[1]);
    }
 else     if (cmd.equals("delete")) {
      SitesUtil.deleteLayout(request,response);
    }
 else     if (cmd.equals("display_order")) {
      updateDisplayOrder(request);
    }
 else     if (cmd.equals("name")) {
      updateName(request);
    }
 else     if (cmd.equals("parent_layout_id")) {
      updateParentLayoutId(request);
    }
 else     if (cmd.equals("priority")) {
      updatePriority(request);
    }
    jsonObject.put("status",HttpServletResponse.SC_OK);
  }
 catch (  LayoutTypeException lte) {
    jsonObject.put("message",getLayoutTypeExceptionMessage(themeDisplay,lte,cmd));
    long plid=ParamUtil.getLong(request,"plid");
    if ((lte.getType() == LayoutTypeException.FIRST_LAYOUT) && (plid > 0)) {
      Layout layout=LayoutLocalServiceUtil.getLayout(plid);
      jsonObject.put("groupId",layout.getGroupId());
      jsonObject.put("layoutId",layout.getLayoutId());
      jsonObject.put("originalParentLayoutId",layout.getParentLayoutId());
      jsonObject.put("originalParentPlid",layout.getParentPlid());
      jsonObject.put("originalPriority",layout.getPriority());
      jsonObject.put("plid",plid);
      jsonObject.put("status",HttpServletResponse.SC_BAD_REQUEST);
    }
  }
  return jsonObject.toString();
}
