{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String portletTitle=PortletConfigurationUtil.getPortletTitle(preferences,themeDisplay.getLanguageId());
  if (Validator.isNull(portletTitle)) {
    ServletContext servletContext=(ServletContext)request.getAttribute(WebKeys.CTX);
    PortletConfig portletConfig=PortletConfigFactoryUtil.create(PortletLocalServiceUtil.getPortletById(portletId),servletContext);
    ResourceBundle resourceBundle=portletConfig.getResourceBundle(themeDisplay.getLocale());
    portletTitle=resourceBundle.getString(JavaConstants.JAVAX_PORTLET_TITLE);
  }
  return portletTitle;
}
