{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long recordId=ParamUtil.getLong(actionRequest,"recordId");
  long recordSetId=ParamUtil.getLong(actionRequest,"recordSetId");
  DDLRecordSet recordSet=DDLRecordSetLocalServiceUtil.getRecordSet(recordSetId);
  DDMStructure ddmStructure=recordSet.getDDMStructure();
  Set<String> fieldNames=ddmStructure.getFieldNames();
  Fields fields=new Fields();
  for (  String name : fieldNames) {
    Field field=new Field();
    field.setName(name);
    String value=ParamUtil.getString(actionRequest,name);
    field.setValue(value);
    fields.put(field);
  }
  ServiceContext serviceContext=ServiceContextFactory.getInstance(DDLRecord.class.getName(),actionRequest);
  DDLRecord record=null;
  if (recordId <= 0) {
    record=DDLRecordLocalServiceUtil.addRecord(themeDisplay.getUserId(),themeDisplay.getScopeGroupId(),recordSetId,fields,DDLConstants.DISPLAY_INDEX_DEFAULT,serviceContext);
  }
 else {
    record=DDLRecordLocalServiceUtil.updateRecord(recordId,fields,DDLConstants.DISPLAY_INDEX_DEFAULT,false,serviceContext);
  }
  return record;
}
