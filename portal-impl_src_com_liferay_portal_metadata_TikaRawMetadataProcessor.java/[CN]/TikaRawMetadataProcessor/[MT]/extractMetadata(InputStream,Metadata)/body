{
  if (metadata == null) {
    metadata=new Metadata();
  }
  ParseContext parserContext=new ParseContext();
  parserContext.set(Parser.class,_parser);
  ContentHandler contentHandler=new WriteOutContentHandler(new DummyWriter());
  try {
    _parser.parse(inputStream,contentHandler,metadata,parserContext);
  }
 catch (  Exception e) {
    Throwable rootCause=ExceptionUtils.getRootCause(e);
    if ((rootCause instanceof CryptographyException) || (rootCause instanceof EncryptedDocumentException)) {
      if (_log.isWarnEnabled()) {
        _log.warn("Cannot extract metadata from encrypted file!");
      }
    }
 else {
      _log.error(e,e);
    }
    throw new IOException(e.getMessage());
  }
  metadata.remove(XMPDM.ABS_PEAK_AUDIO_FILE_PATH.getName());
  metadata.remove(XMPDM.RELATIVE_PEAK_AUDIO_FILE_PATH.getName());
  return metadata;
}
