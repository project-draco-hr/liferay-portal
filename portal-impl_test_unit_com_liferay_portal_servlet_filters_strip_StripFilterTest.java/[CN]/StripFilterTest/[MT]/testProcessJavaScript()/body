{
  StripFilter stripFilter=new StripFilter();
  _mockCacheGenerationUtil();
  CharBuffer charBuffer=CharBuffer.wrap("script>abc");
  StringWriter stringWriter=new StringWriter();
  stripFilter.processJavaScript(charBuffer,stringWriter,"script".toCharArray());
  Assert.assertEquals("script>",stringWriter.toString());
  Assert.assertEquals(7,charBuffer.position());
  charBuffer=CharBuffer.wrap("script></script>");
  stringWriter=new StringWriter();
  stripFilter.processJavaScript(charBuffer,stringWriter,"script".toCharArray());
  Assert.assertEquals("script></script>",stringWriter.toString());
  Assert.assertEquals(16,charBuffer.position());
  charBuffer=CharBuffer.wrap("script> \t\r\n</script>");
  stringWriter=new StringWriter();
  stripFilter.processJavaScript(charBuffer,stringWriter,"script".toCharArray());
  Assert.assertEquals("script></script>",stringWriter.toString());
  Assert.assertEquals(20,charBuffer.position());
  String code="function(){ var abcd; var efgh; }";
  String minifiedCode=MinifierUtil.minifyJavaScript(code);
  charBuffer=CharBuffer.wrap("script>" + code + "</script>");
  stringWriter=new StringWriter();
  stripFilter.processJavaScript(charBuffer,stringWriter,"script".toCharArray());
  Assert.assertEquals("script>/*<![CDATA[*/" + minifiedCode + "/*]]>*/</script>",stringWriter.toString());
  Assert.assertEquals(code.length() + 16,charBuffer.position());
  charBuffer=CharBuffer.wrap("script>" + code + "</script> \t\r\n");
  stringWriter=new StringWriter();
  stripFilter.processJavaScript(charBuffer,stringWriter,"script".toCharArray());
  Assert.assertEquals("script>/*<![CDATA[*/" + minifiedCode + "/*]]>*/</script> ",stringWriter.toString());
  Assert.assertEquals(code.length() + 20,charBuffer.position());
  verifyStatic(Mockito.times(5));
}
