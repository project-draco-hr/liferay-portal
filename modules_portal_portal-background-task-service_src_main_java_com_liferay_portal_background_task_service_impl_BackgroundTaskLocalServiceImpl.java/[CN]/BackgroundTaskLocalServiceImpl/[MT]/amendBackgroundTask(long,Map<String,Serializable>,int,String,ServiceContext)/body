{
  BackgroundTask backgroundTask=backgroundTaskPersistence.fetchByPrimaryKey(backgroundTaskId);
  if (backgroundTask == null) {
    return null;
  }
  if (taskContextMap != null) {
    _backgroundTaskThreadLocalManager.serializeThreadLocals(taskContextMap);
    backgroundTask.setTaskContextMap(taskContextMap);
  }
  if ((status == BackgroundTaskConstants.STATUS_FAILED) || (status == BackgroundTaskConstants.STATUS_SUCCESSFUL)) {
    backgroundTask.setCompleted(true);
    backgroundTask.setCompletionDate(new Date());
  }
  backgroundTask.setStatus(status);
  if (Validator.isNotNull(statusMessage)) {
    backgroundTask.setStatusMessage(statusMessage);
  }
  backgroundTaskPersistence.update(backgroundTask);
  return backgroundTask;
}
