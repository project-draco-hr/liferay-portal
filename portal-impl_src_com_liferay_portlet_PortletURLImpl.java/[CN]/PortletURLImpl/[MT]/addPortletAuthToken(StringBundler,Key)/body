{
  if (!PropsValues.PORTLET_ADD_DEFAULT_RESOURCE_CHECK_ENABLED) {
    return;
  }
  HttpServletRequest request=PortalUtil.getOriginalServletRequest(_request);
  String ppauth=ParamUtil.getString(request,"p_p_auth");
  if (Validator.isNotNull(ppauth)) {
    sb.append("p_p_auth");
    sb.append(StringPool.EQUAL);
    sb.append(processValue(key,ppauth));
    sb.append(StringPool.AMPERSAND);
    return;
  }
  Portlet portlet=(Portlet)request.getAttribute(WebKeys.RENDER_PORTLET);
  if (portlet == null) {
    return;
  }
  if (portlet.getPortletId().equals(_portletId) && ((_windowState == null) || _windowState.equals(WindowState.NORMAL))) {
    return;
  }
  sb.append("p_p_auth");
  sb.append(StringPool.EQUAL);
  sb.append(processValue(key,AuthTokenUtil.getToken(request,_plid,_portletId)));
  sb.append(StringPool.AMPERSAND);
}
