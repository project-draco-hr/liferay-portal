{
  if (!PropsValues.PORTLET_ADD_DEFAULT_RESOURCE_CHECK_ENABLED) {
    return;
  }
  if (!_portlet.isAddDefaultResource()) {
    return;
  }
  String strutsAction=getParameter("struts_action");
  if (AuthTokenWhitelistUtil.isPortletInvocationWhitelisted(_portlet.getCompanyId(),_portletId,strutsAction)) {
    return;
  }
  try {
    LayoutTypePortlet targetLayoutTypePortlet=(LayoutTypePortlet)getLayout().getLayoutType();
    if (targetLayoutTypePortlet.hasPortletId(_portletId)) {
      return;
    }
  }
 catch (  Exception e) {
    if (_log.isDebugEnabled()) {
      _log.debug(e.getMessage(),e);
    }
  }
  Portlet portlet=(Portlet)_request.getAttribute(WebKeys.RENDER_PORTLET);
  if (portlet != null) {
    String portletId=portlet.getPortletId();
    if (portletId.equals(PortletKeys.CONTROL_PANEL_MENU)) {
      return;
    }
  }
  sb.append("p_p_auth");
  sb.append(StringPool.EQUAL);
  sb.append(processValue(key,AuthTokenUtil.getToken(_request,_plid,_portletId)));
  sb.append(StringPool.AMPERSAND);
}
