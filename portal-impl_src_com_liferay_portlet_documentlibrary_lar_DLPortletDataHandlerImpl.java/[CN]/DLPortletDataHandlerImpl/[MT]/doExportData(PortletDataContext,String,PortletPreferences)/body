{
  context.addPermissions("com.liferay.portlet.documentlibrary",context.getScopeGroupId());
  Document document=SAXReaderUtil.createDocument();
  Element rootElement=document.addElement("documentlibrary-data");
  rootElement.addAttribute("group-id",String.valueOf(context.getScopeGroupId()));
  long rootFolderId=GetterUtil.getLong(preferences.getValue("rootFolderId",null));
  if (rootFolderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    rootElement.addAttribute("root-folder-id",String.valueOf(rootFolderId));
  }
  Element foldersElement=rootElement.addElement("folders");
  Element fileEntriesElement=rootElement.addElement("file-entries");
  Element fileShortcutsElement=rootElement.addElement("file-shortcuts");
  Element fileRanksElement=rootElement.addElement("file-ranks");
  List<DLFolder> folders=DLFolderUtil.findByGroupId(context.getScopeGroupId());
  for (  DLFolder folder : folders) {
    exportFolder(context,foldersElement,fileEntriesElement,fileShortcutsElement,fileRanksElement,folder);
  }
  List<DLFileEntry> fileEntries=DLFileEntryUtil.findByG_F(context.getScopeGroupId(),DLFolderConstants.DEFAULT_PARENT_FOLDER_ID);
  for (  DLFileEntry fileEntry : fileEntries) {
    exportFileEntry(context,foldersElement,fileEntriesElement,fileRanksElement,fileEntry,true);
  }
  return document.formattedString();
}
