{
  portletDataContext.addPermissions("com.liferay.portlet.documentlibrary",portletDataContext.getScopeGroupId());
  Document document=SAXReaderUtil.createDocument();
  Element rootElement=document.addElement("documentlibrary-data");
  rootElement.addAttribute("group-id",String.valueOf(portletDataContext.getScopeGroupId()));
  long rootFolderId=GetterUtil.getLong(portletPreferences.getValue("rootFolderId",null));
  if (rootFolderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    rootElement.addAttribute("root-folder-id",String.valueOf(rootFolderId));
  }
  Element repositoryElement=rootElement.addElement("repositories");
  Element fileEntryTypesElement=rootElement.addElement("file-entry-types");
  Element foldersElement=rootElement.addElement("folders");
  Element fileEntriesElement=rootElement.addElement("file-entries");
  Element fileShortcutsElement=rootElement.addElement("file-shortcuts");
  Element fileRanksElement=rootElement.addElement("file-ranks");
  List<DLFileEntryType> dlFileEntryTypes=DLFileEntryTypeServiceUtil.getFileEntryTypes(new long[]{portletDataContext.getScopeGroupId()});
  for (  DLFileEntryType dlFileEntryType : dlFileEntryTypes) {
    if (!isFileEntryTypeExportable(portletDataContext.getCompanyId(),dlFileEntryType)) {
      continue;
    }
    exportFileEntryType(portletDataContext,fileEntryTypesElement,dlFileEntryType);
  }
  List<Folder> folders=FolderUtil.findByRepositoryId(portletDataContext.getScopeGroupId());
  for (  Folder folder : folders) {
    if (!folder.isMountPoint()) {
      exportFolder(portletDataContext,fileEntryTypesElement,foldersElement,fileEntriesElement,fileShortcutsElement,fileRanksElement,folder,false);
    }
 else {
      if (portletDataContext.getBooleanParameter(_NAMESPACE,"repositories")) {
        Repository repository=RepositoryUtil.findByPrimaryKey(folder.getRepositoryId());
        exportRepository(portletDataContext,repositoryElement,repository);
      }
    }
  }
  List<FileEntry> fileEntries=FileEntryUtil.findByR_F(portletDataContext.getScopeGroupId(),DLFolderConstants.DEFAULT_PARENT_FOLDER_ID);
  for (  FileEntry fileEntry : fileEntries) {
    exportFileEntry(portletDataContext,fileEntryTypesElement,foldersElement,fileEntriesElement,fileRanksElement,fileEntry,true);
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"shortcuts")) {
    List<DLFileShortcut> fileShortcuts=DLFileShortcutUtil.findByG_F(portletDataContext.getScopeGroupId(),DLFolderConstants.DEFAULT_PARENT_FOLDER_ID);
    for (    DLFileShortcut fileShortcut : fileShortcuts) {
      exportFileShortcut(portletDataContext,fileEntryTypesElement,foldersElement,fileShortcutsElement,fileShortcut);
    }
  }
  return document.formattedString();
}
