{
  long userId=portletDataContext.getUserId(fileShortcut.getUserUuid());
  Map<Long,Long> folderPKs=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(DLFolder.class);
  long folderId=MapUtil.getLong(folderPKs,fileShortcut.getFolderId(),fileShortcut.getFolderId());
  long groupId=portletDataContext.getScopeGroupId();
  if (folderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    DLFolder folder=DLFolderUtil.findByPrimaryKey(folderId);
    groupId=folder.getGroupId();
  }
  long toFileEntryId=fileShortcut.getToFileEntryId();
  DLFileEntry fileEntry=DLAppLocalServiceUtil.getFileEntry(toFileEntryId);
  long[] assetCategoryIds=null;
  String[] assetTagNames=null;
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"categories")) {
    assetCategoryIds=portletDataContext.getAssetCategoryIds(DLFileEntry.class,fileEntry.getFileEntryId());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"tags")) {
    assetTagNames=portletDataContext.getAssetTagNames(DLFileEntry.class,fileEntry.getFileEntryId());
  }
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddCommunityPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  serviceContext.setAssetCategoryIds(assetCategoryIds);
  serviceContext.setAssetTagNames(assetTagNames);
  serviceContext.setCreateDate(fileShortcut.getCreateDate());
  serviceContext.setModifiedDate(fileShortcut.getModifiedDate());
  serviceContext.setScopeGroupId(portletDataContext.getScopeGroupId());
  DLFileShortcut importedFileShortcut=null;
  if (portletDataContext.isDataStrategyMirror()) {
    DLFileShortcut existingFileShortcut=DLFileShortcutUtil.fetchByUUID_G(fileShortcut.getUuid(),portletDataContext.getScopeGroupId());
    if (existingFileShortcut == null) {
      serviceContext.setUuid(fileShortcut.getUuid());
      importedFileShortcut=DLAppLocalServiceUtil.addFileShortcut(userId,groupId,folderId,toFileEntryId,serviceContext);
    }
 else {
      importedFileShortcut=DLAppLocalServiceUtil.updateFileShortcut(userId,existingFileShortcut.getFileShortcutId(),folderId,toFileEntryId,serviceContext);
    }
  }
 else {
    importedFileShortcut=DLAppLocalServiceUtil.addFileShortcut(userId,groupId,folderId,toFileEntryId,serviceContext);
  }
  portletDataContext.importPermissions(DLFileShortcut.class,fileShortcut.getPrimaryKey(),importedFileShortcut.getPrimaryKey());
}
