{
  long userId=context.getUserId(fileShortcut.getUserUuid());
  long folderId=MapUtil.getLong(folderPKs,fileShortcut.getFolderId(),fileShortcut.getFolderId());
  long toFolderId=MapUtil.getLong(folderPKs,fileShortcut.getToFolderId(),fileShortcut.getToFolderId());
  String toName=MapUtil.getString(fileEntryNames,fileShortcut.getToName(),fileShortcut.getToName());
  try {
    DLFolder folder=DLFolderUtil.findByPrimaryKey(folderId);
    DLFolderUtil.findByPrimaryKey(toFolderId);
    long groupId=folder.getGroupId();
    DLFileEntry fileEntry=DLFileEntryLocalServiceUtil.getFileEntry(groupId,toFolderId,toName);
    long[] assetCategoryIds=null;
    String[] assetTagNames=null;
    if (context.getBooleanParameter(_NAMESPACE,"categories")) {
      assetCategoryIds=context.getAssetCategoryIds(DLFileEntry.class,fileEntry.getFileEntryId());
    }
    if (context.getBooleanParameter(_NAMESPACE,"tags")) {
      assetTagNames=context.getAssetTagNames(DLFileEntry.class,fileEntry.getFileEntryId());
    }
    ServiceContext serviceContext=new ServiceContext();
    serviceContext.setAddCommunityPermissions(true);
    serviceContext.setAddGuestPermissions(true);
    serviceContext.setAssetCategoryIds(assetCategoryIds);
    serviceContext.setAssetTagNames(assetTagNames);
    serviceContext.setScopeGroupId(context.getGroupId());
    if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
      try {
        DLFileShortcut existingFileShortcut=DLFileShortcutUtil.findByUUID_G(fileShortcut.getUuid(),context.getGroupId());
        DLFileShortcutLocalServiceUtil.updateFileShortcut(userId,existingFileShortcut.getFileShortcutId(),folderId,toFolderId,toName,serviceContext);
      }
 catch (      NoSuchFileShortcutException nsfse) {
        DLFileShortcutLocalServiceUtil.addFileShortcut(fileShortcut.getUuid(),userId,groupId,folderId,toFolderId,toName,serviceContext);
      }
    }
 else {
      DLFileShortcutLocalServiceUtil.addFileShortcut(null,userId,groupId,folderId,toFolderId,toName,serviceContext);
    }
  }
 catch (  NoSuchFolderException nsfe) {
    _log.error("Could not find the folder for shortcut " + fileShortcut.getFileShortcutId());
  }
}
