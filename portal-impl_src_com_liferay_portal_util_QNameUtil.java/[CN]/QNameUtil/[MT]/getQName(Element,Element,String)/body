{
  if ((qNameEl == null) && (nameEl == null)) {
    _log.error("both qname and name elements are null");
    return null;
  }
  if (qNameEl == null) {
    return new QName(defaultNamespace,nameEl.getTextTrim());
  }
  String localPart=qNameEl.getTextTrim();
  int pos=localPart.indexOf(StringPool.COLON);
  if (pos == -1) {
    if (_log.isDebugEnabled()) {
      _log.debug("qname " + localPart + " does not have a prefix");
    }
    return new QName(localPart);
  }
  String prefix=localPart.substring(0,pos);
  Namespace namespace=qNameEl.getNamespaceForPrefix(prefix);
  if (namespace == null) {
    if (_log.isWarnEnabled()) {
      _log.warn("qname " + localPart + " does not have a valid namespace");
    }
    return null;
  }
  String uri=namespace.getURI();
  localPart=localPart.substring(prefix.length() + 1);
  return new QName(uri,localPart,prefix);
}
