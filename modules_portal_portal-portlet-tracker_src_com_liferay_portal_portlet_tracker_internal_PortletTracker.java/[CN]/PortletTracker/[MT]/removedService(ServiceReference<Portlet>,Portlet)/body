{
  String portletName=(String)serviceReference.getProperty("javax.portlet.name");
  if (Validator.isNull(portletName)) {
    return;
  }
  if (_log.isInfoEnabled()) {
    _log.info("Removing: " + serviceReference);
  }
  String portletId=JS.getSafeName(portletName);
  com.liferay.portal.model.Portlet portletModel=_portletLocalService.getPortletById(portletId);
  _portletInstanceFactory.destroy(portletModel);
  List<Company> companies;
  try {
    companies=_companyLocalService.getCompanies();
  }
 catch (  SystemException se) {
    throw new RuntimeException(se);
  }
  for (  Company company : companies) {
    PortletCategory portletCategory=(PortletCategory)WebAppPool.get(company.getCompanyId(),WebKeys.PORTLET_CATEGORY);
    portletCategory.separate(portletId);
  }
  PortletBag portletBag=PortletBagPool.remove(portletId);
  if (portletBag != null) {
    portletBag.destroy();
  }
}
