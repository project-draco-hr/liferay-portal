{
  Map<String,Set<String>> portletModes=new HashMap<String,Set<String>>();
  Set<String> defaultModes=new HashSet<String>();
  defaultModes.add(StringUtil.toLowerCase(PortletMode.VIEW.toString()));
  portletModes.put(ContentTypes.TEXT_HTML,defaultModes);
  List<String> portletModeStrings=StringPlus.asList(serviceReference.getProperty("javax.portlet.portletModes"));
  for (  String portletModeString : portletModeStrings) {
    String[] parts=StringUtil.split(portletModeString,CharPool.SEMICOLON);
    if (parts.length != 2) {
      continue;
    }
    String mimeType=parts[0];
    Set<String> mimeTypePortletModes=new HashSet<String>();
    String[] modes=StringUtil.split(parts[1]);
    mimeTypePortletModes.add(StringUtil.toLowerCase(PortletMode.VIEW.toString()));
    for (    String mode : modes) {
      mimeTypePortletModes.add(StringUtil.toLowerCase(mode.trim()));
    }
    portletModes.put(mimeType,mimeTypePortletModes);
  }
  portletModel.setPortletModes(portletModes);
}
