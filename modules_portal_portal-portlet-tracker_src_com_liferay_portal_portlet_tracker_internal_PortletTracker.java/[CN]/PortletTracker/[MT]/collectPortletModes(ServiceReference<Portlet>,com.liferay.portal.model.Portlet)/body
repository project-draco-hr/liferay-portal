{
  Map<String,Set<String>> portletModes=new HashMap<String,Set<String>>();
  portletModes.put(ContentTypes.TEXT_HTML,SetUtil.fromArray(new String[]{toLowerCase(PortletMode.VIEW)}));
  List<String> portletModesStrings=StringPlus.asList(serviceReference.getProperty("javax.portlet.portlet-mode"));
  for (  String portletModesString : portletModesStrings) {
    String[] portletModesStringParts=StringUtil.split(portletModesString,CharPool.SEMICOLON);
    if (portletModesStringParts.length != 2) {
      continue;
    }
    String mimeType=portletModesStringParts[0];
    Set<String> mimeTypePortletModes=new HashSet<String>();
    mimeTypePortletModes.add(toLowerCase(PortletMode.VIEW));
    mimeTypePortletModes.addAll(toLowerCaseSet(portletModesStringParts[1]));
    portletModes.put(mimeType,mimeTypePortletModes);
  }
  portletModel.setPortletModes(portletModes);
}
