{
  portletModel.setReady(false);
  clearServiceRegistrations(serviceReference.getBundle());
  BundleContext bundleContext=_componentContext.getBundleContext();
  bundleContext.ungetService(serviceReference);
  _portletInstanceFactory.destroy(portletModel);
  List<Company> companies=_companyLocalService.getCompanies();
  for (  Company company : companies) {
    PortletCategory portletCategory=(PortletCategory)WebAppPool.get(company.getCompanyId(),WebKeys.PORTLET_CATEGORY);
    portletCategory.separate(portletModel.getRootPortletId());
  }
  PortletBag portletBag=PortletBagPool.remove(portletModel.getRootPortletId());
  if (portletBag != null) {
    portletBag.destroy();
  }
}
