{
  BundleContext bundleContext=_componentContext.getBundleContext();
  Portlet portlet=bundleContext.getService(serviceReference);
  String portletName=(String)serviceReference.getProperty("javax.portlet.name");
  if (Validator.isNull(portletName)) {
    Class<?> clazz=portlet.getClass();
    portletName=clazz.getName();
  }
  try {
    String portletId=JS.getSafeName(portletName);
    if (portletId.length() > _PORTLET_ID_MAX_LENGTH) {
      throw new IllegalArgumentException("Portlet id " + portletId + " has more than "+ _PORTLET_ID_MAX_LENGTH+ " characters");
    }
    com.liferay.portal.model.Portlet portletModel=_portletLocalService.getPortletById(portletId);
    if (portletModel != null) {
      throw new IllegalArgumentException("Portlet id " + portletId + " is already in use.");
    }
    if (_log.isInfoEnabled()) {
      _log.info("Adding " + serviceReference);
    }
    return addingPortlet(serviceReference,portlet,portletName,portletId);
  }
 catch (  Throwable t) {
    _log.error(t,t);
  }
  return null;
}
