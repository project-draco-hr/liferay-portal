{
  for (  Entry<String,ServletDefinition> servletEntry : fragmentServlets.entrySet()) {
    String servletName=servletEntry.getKey();
    if (!assembledServlets.containsKey(servletName)) {
      fragmentServlets.put(servletName,servletEntry.getValue());
    }
 else {
      ServletDefinition webXMLServletDefinition=webXMLServlets.get(servletName);
      ServletDefinition fragmentServletDefinition=servletEntry.getValue();
      Map<String,String> webXMLServletParams=null;
      if (webXMLServletDefinition != null) {
        webXMLServletParams=webXMLServletDefinition.getInitParameters();
      }
      Map<String,String> fragmentServletParams=fragmentServletDefinition.getInitParameters();
      ServletDefinition assembledServletDefinition=assembledServlets.get(servletName);
      Map<String,String> assembledInitParams=assembledServletDefinition.getInitParameters();
      for (      Entry<String,String> initParamEntry : fragmentServletParams.entrySet()) {
        String initParamName=initParamEntry.getKey();
        String initParamValue=initParamEntry.getValue();
        String assembledInitParamValue=assembledInitParams.get(initParamName);
        String webXMLInitParamValue=null;
        if (webXMLServletParams != null) {
          webXMLInitParamValue=webXMLServletParams.get(initParamName);
        }
        if (Validator.isNull(assembledInitParamValue)) {
          if ((webXMLInitParamValue == null) && !Validator.equals(assembledInitParamValue,initParamValue)) {
            throw new Exception("Conflicts for " + initParamName + " in servlet "+ servletName);
          }
 else {
            assembledInitParams.put(initParamName,initParamValue);
          }
        }
      }
      List<String> assembledServletURLPatterns=assembledServletDefinition.getURLPatterns();
      List<String> fragmentServletURLPatterns=fragmentServletDefinition.getURLPatterns();
      for (      String urlPattern : fragmentServletURLPatterns) {
        if (!assembledServletURLPatterns.contains(urlPattern)) {
          assembledServletURLPatterns.add(urlPattern);
        }
      }
      if (Validator.isNull(assembledServletDefinition.getJspFile())) {
        assembledServletDefinition.setJSPFile(fragmentServletDefinition.getJspFile());
      }
    }
  }
}
