{
  Configuration configuration=_configurations.get(companyId);
  Configuration defaultConfiguration=_configurations.get(0L);
  if (defaultConfiguration == null) {
    throw new IllegalArgumentException("No default configuration for " + getMetatype().getName());
  }
  try {
    if (configuration == null) {
      configuration=configurationAdmin.createFactoryConfiguration(defaultConfiguration.getFactoryPid(),defaultConfiguration.getBundleLocation());
    }
    properties.put(LDAPConstants.COMPANY_ID,companyId);
    configuration.update(properties);
  }
 catch (  IOException ioe) {
    throw new SystemException("Unable to update configuration",ioe);
  }
}
