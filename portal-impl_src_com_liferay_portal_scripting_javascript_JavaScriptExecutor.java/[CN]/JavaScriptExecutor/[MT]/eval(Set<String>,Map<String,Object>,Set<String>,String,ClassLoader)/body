{
  Script compiledScript=getCompiledScript(script,classLoaders);
  try {
    Context context=Context.enter();
    Scriptable scriptable=context.initStandardObjects();
    if (ArrayUtil.isNotEmpty(classLoaders)) {
      ClassLoader aggregateClassLoader=AggregateClassLoader.getAggregateClassLoader(ClassLoaderUtil.getPortalClassLoader(),classLoaders);
      context.setApplicationClassLoader(aggregateClassLoader);
    }
    for (    Map.Entry<String,Object> entry : inputObjects.entrySet()) {
      String key=entry.getKey();
      Object value=entry.getValue();
      ScriptableObject.putProperty(scriptable,key,Context.javaToJS(value,scriptable));
    }
    if (allowedClasses != null) {
      context.setClassShutter(new JavaScriptClassVisibilityChecker(allowedClasses));
    }
    compiledScript.exec(context,scriptable);
    if (outputNames == null) {
      return null;
    }
    Map<String,Object> outputObjects=new HashMap<String,Object>();
    for (    String outputName : outputNames) {
      Object property=ScriptableObject.getProperty(scriptable,outputName);
      if (property instanceof Wrapper) {
        property=((Wrapper)property).unwrap();
      }
      outputObjects.put(outputName,property);
    }
    return outputObjects;
  }
 catch (  Exception e) {
    throw new ScriptingException(e.getMessage() + "\n\n",e);
  }
 finally {
    Context.exit();
  }
}
