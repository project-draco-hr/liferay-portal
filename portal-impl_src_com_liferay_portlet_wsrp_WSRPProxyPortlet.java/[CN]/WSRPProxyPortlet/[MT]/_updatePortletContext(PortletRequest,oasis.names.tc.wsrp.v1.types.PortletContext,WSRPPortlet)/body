{
  if (portletContext != null && portlet != null) {
    String newPortletHandle=portletContext.getPortletHandle();
    PortletKey portletKey=portlet.getPortletKey();
    if (newPortletHandle != null && !newPortletHandle.equals(portletKey.getPortletHandle())) {
      String producerID=portletKey.getProducerId();
      PortletKey newPortletKey=new PortletKeyImpl(newPortletHandle,producerID);
      portlet=_createPortlet(newPortletKey,portlet.getParent());
      _consumerEnv.getPortletRegistry().addPortlet(portlet);
      PortletPreferences preferences=request.getPreferences();
      try {
        preferences.setValue("portlet-handle",newPortletHandle);
        preferences.setValue("parent-handle",portlet.getParent());
        preferences.store();
      }
 catch (      Exception e) {
        WSRPXHelper.throwX(0,e);
      }
    }
    portlet.setPortletContext(portletContext);
  }
}
