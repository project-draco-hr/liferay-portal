{
  List<Document> docs=new ArrayList<Document>();
  List<Float> scores=new ArrayList<Float>();
  int start=searchContext.getStart();
  int end=searchContext.getEnd();
  String paginationType=GetterUtil.getString(searchContext.getAttribute("paginationType"),"more");
  boolean hasMore=false;
  Document[] documents=hits.getDocs();
  int excludeDocsSize=0;
  for (int i=0; i < documents.length; i++) {
    try {
      Document document=documents[i];
      String entryClassName=document.get(Field.ENTRY_CLASS_NAME);
      long entryClassPK=GetterUtil.getLong(document.get(Field.ENTRY_CLASS_PK));
      Indexer indexer=IndexerRegistryUtil.getIndexer(entryClassName);
      if ((indexer.isFilterSearch() && indexer.hasPermission(permissionChecker,entryClassName,entryClassPK,ActionKeys.VIEW)) || !indexer.isFilterSearch() || !indexer.isPermissionAware()) {
        docs.add(document);
        scores.add(hits.score(i));
      }
 else {
        excludeDocsSize++;
      }
    }
 catch (    Exception e) {
      excludeDocsSize++;
    }
    if (paginationType.equals("more") && (end > 0) && (end < documents.length)&& (docs.size() >= end)) {
      hasMore=true;
      break;
    }
  }
  int length=docs.size();
  if (hasMore) {
    length=documents.length - excludeDocsSize;
  }
  hits.setLength(length);
  if ((start != QueryUtil.ALL_POS) && (end != QueryUtil.ALL_POS)) {
    if (end > length) {
      end=length;
    }
    docs=docs.subList(start,end);
  }
  hits.setDocs(docs.toArray(new Document[docs.size()]));
  hits.setScores(scores.toArray(new Float[docs.size()]));
  hits.setSearchTime((float)(System.currentTimeMillis() - hits.getStart()) / Time.SECOND);
  return hits;
}
