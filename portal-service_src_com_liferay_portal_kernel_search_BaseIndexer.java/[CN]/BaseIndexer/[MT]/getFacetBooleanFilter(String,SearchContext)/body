{
  BooleanFilter facetBooleanFilter=new BooleanFilter();
  facetBooleanFilter.addTerm(Field.ENTRY_CLASS_NAME,className);
  if (searchContext.getUserId() > 0) {
    SearchPermissionChecker searchPermissionChecker=SearchEngineUtil.getSearchPermissionChecker();
    long[] groupIds=searchContext.getGroupIds();
    long groupId=GetterUtil.getLong(searchContext.getAttribute("groupId"));
    if (groupId > 0) {
      groupIds=new long[]{groupId};
    }
    BooleanQuery permissionBooleanQuery=(BooleanQuery)searchPermissionChecker.getPermissionQuery(searchContext.getCompanyId(),groupIds,searchContext.getUserId(),className,null,searchContext);
    if ((permissionBooleanQuery != null) && permissionBooleanQuery.hasClauses()) {
      QueryFilter queryFilter=new QueryFilter(permissionBooleanQuery);
      facetBooleanFilter.add(queryFilter,BooleanClauseOccur.MUST);
    }
  }
  return facetBooleanFilter;
}
