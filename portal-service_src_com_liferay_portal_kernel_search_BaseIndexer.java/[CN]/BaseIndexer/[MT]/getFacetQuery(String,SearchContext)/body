{
  BooleanQuery facetQuery=BooleanQueryFactoryUtil.create();
  facetQuery.addExactTerm(Field.ENTRY_CLASS_NAME,className);
  facetQuery.addExactTerm(Field.PORTLET_ID,getPortletId(searchContext));
  if (searchContext.getUserId() > 0) {
    SearchPermissionChecker searchPermissionChecker=SearchEngineUtil.getSearchPermissionChecker();
    facetQuery=(BooleanQuery)searchPermissionChecker.getPermissionQuery(searchContext.getCompanyId(),searchContext.getGroupIds(),searchContext.getUserId(),className,facetQuery);
  }
  addSearchCategoryIds(facetQuery,searchContext);
  addSearchFolderIds(facetQuery,searchContext);
  addSearchNodeIds(facetQuery,searchContext);
  return facetQuery;
}
