{
  try {
    searchContext.setSearchEngineId(getSearchEngineId());
    String[] classNames=new String[]{getClassName(searchContext)};
    if (searchContext.isIncludeAttachments()) {
      classNames=ArrayUtil.append(classNames,DLFileEntry.class.getName());
    }
    if (searchContext.isIncludeDiscussions()) {
      classNames=ArrayUtil.append(classNames,MBMessage.class.getName());
      searchContext.setAttribute("discussion",true);
    }
    if (searchContext.isIncludeDiscussions() || searchContext.isIncludeAttachments()) {
      searchContext.setAttribute("relatedEntryClassName",getClassName(searchContext));
    }
    searchContext.setEntryClassNames(classNames);
    BooleanQuery contextQuery=BooleanQueryFactoryUtil.create(searchContext);
    addSearchAssetCategoryIds(contextQuery,searchContext);
    addSearchAssetTagNames(contextQuery,searchContext);
    addSearchEntryClassNames(contextQuery,searchContext);
    addSearchGroupId(contextQuery,searchContext);
    addSearchUserId(contextQuery,searchContext);
    BooleanQuery fullQuery=createFullQuery(contextQuery,searchContext);
    fullQuery.setQueryConfig(searchContext.getQueryConfig());
    return fullQuery;
  }
 catch (  SearchException se) {
    throw se;
  }
catch (  Exception e) {
    throw new SearchException(e);
  }
}
