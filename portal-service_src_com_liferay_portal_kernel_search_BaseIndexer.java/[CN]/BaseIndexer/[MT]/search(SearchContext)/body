{
  try {
    String className=getClassName(searchContext);
    BooleanQuery contextQuery=BooleanQueryFactoryUtil.create();
    addSearchAssetCategoryIds(contextQuery,searchContext);
    addSearchAssetTagNames(contextQuery,searchContext);
    addSearchGroupId(contextQuery,searchContext);
    addSearchStagingGroup(contextQuery,searchContext);
    addSearchOwnerUserId(contextQuery,searchContext);
    addSearchCategoryIds(contextQuery,searchContext);
    addSearchNodeIds(contextQuery,searchContext);
    addSearchFolderIds(contextQuery,searchContext);
    addSearchPortletIds(contextQuery,searchContext);
    BooleanQuery fullQuery=createFullQuery(contextQuery,searchContext);
    fullQuery.setQueryConfig(searchContext.getQueryConfig());
    PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
    int start=searchContext.getStart();
    int end=searchContext.getEnd();
    if (isFilterSearch() && (permissionChecker != null)) {
      start=0;
      end=end + INDEX_FILTER_SEARCH_LIMIT;
    }
    Hits hits=SearchEngineUtil.search(searchContext.getCompanyId(),searchContext.getGroupIds(),searchContext.getUserId(),className,fullQuery,searchContext.getSorts(),start,end);
    if (isFilterSearch() && (permissionChecker != null)) {
      hits=filterSearch(hits,permissionChecker,searchContext);
    }
    return hits;
  }
 catch (  SearchException se) {
    throw se;
  }
catch (  Exception e) {
    throw new SearchException(e);
  }
}
