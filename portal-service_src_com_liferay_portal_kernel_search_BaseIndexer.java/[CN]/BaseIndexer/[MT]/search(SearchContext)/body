{
  try {
    Hits hits=null;
    QueryConfig queryConfig=searchContext.getQueryConfig();
    if (ArrayUtil.isEmpty(queryConfig.getSelectedFieldNames())) {
      addDefaultSelectedFieldNames(searchContext);
    }
    addFacetSelectedFieldNames(searchContext,queryConfig);
    if (ArrayUtil.isEmpty(queryConfig.getHighlightFieldNames())) {
      addDefaultHighlightFieldNames(queryConfig);
    }
    PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
    if ((permissionChecker != null) && isUseSearchResultPermissionFilter(searchContext)) {
      SearchResultPermissionFilter searchResultPermissionFilter=new DefaultSearchResultPermissionFilter(this,permissionChecker);
      hits=searchResultPermissionFilter.search(searchContext);
    }
 else {
      hits=doSearch(searchContext);
    }
    processHits(searchContext,hits);
    return hits;
  }
 catch (  SearchException se) {
    throw se;
  }
catch (  Exception e) {
    throw new SearchException(e);
  }
}
