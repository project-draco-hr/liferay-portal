{
  try {
    PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
    boolean permissionChecking=isPermissionChecking(searchContext,permissionChecker);
    int end=searchContext.getEnd();
    int start=searchContext.getStart();
    if (permissionChecking) {
      searchContext.setEnd(end + INDEX_FILTER_SEARCH_LIMIT);
      searchContext.setStart(0);
      QueryConfig queryConfig=searchContext.getQueryConfig();
      String[] selectedFieldNames=queryConfig.getSelectedFieldNames();
      if (selectedFieldNames != null) {
        Set<String> selectedFieldNameSet=SetUtil.fromArray(selectedFieldNames);
        selectedFieldNameSet.addAll(_PERMISSION_SELECTED_FIELD_NAMES);
        selectedFieldNames=selectedFieldNameSet.toArray(new String[selectedFieldNameSet.size()]);
        queryConfig.setSelectedFieldNames(selectedFieldNames);
      }
    }
    Hits hits=doSearch(searchContext);
    searchContext.setEnd(end);
    searchContext.setStart(start);
    if (permissionChecking) {
      hits=filterSearch(hits,permissionChecker,searchContext);
    }
    processHits(searchContext,hits);
    return hits;
  }
 catch (  SearchException se) {
    throw se;
  }
catch (  Exception e) {
    throw new SearchException(e);
  }
}
