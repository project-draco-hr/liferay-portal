{
  BaseRepositoryImpl baseRepositoryImpl=null;
  Repository repository=null;
  try {
    repository=getRepository(repositoryId);
    String repositoryImplClassName=PortalUtil.getClassName(classNameId);
    baseRepositoryImpl=(BaseRepositoryImpl)InstanceFactory.newInstance(repositoryImplClassName);
  }
 catch (  Exception e) {
    throw new RepositoryException("There is no valid repository class with class name id " + classNameId,e);
  }
  baseRepositoryImpl.setCompanyId(repository.getCompanyId());
  baseRepositoryImpl.setCompanyLocalService(companyLocalService);
  baseRepositoryImpl.setCounterLocalService(counterLocalService);
  baseRepositoryImpl.setDLAppHelperLocalService(dlAppHelperLocalService);
  baseRepositoryImpl.setGroupId(repository.getGroupId());
  baseRepositoryImpl.setRepositoryId(repositoryId);
  baseRepositoryImpl.setTypeSettingsProperties(repository.getTypeSettingsProperties());
  baseRepositoryImpl.setUserLocalService(userLocalService);
  baseRepositoryImpl.initRepository();
  return baseRepositoryImpl;
}
