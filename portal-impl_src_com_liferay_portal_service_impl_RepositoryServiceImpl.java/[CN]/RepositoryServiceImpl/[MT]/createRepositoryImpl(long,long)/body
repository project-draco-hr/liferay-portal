{
  BaseRepository baseRepository=null;
  Repository repository=null;
  try {
    repository=getRepository(repositoryId);
    String repositoryImplClassName=PortalUtil.getClassName(classNameId);
    baseRepository=RepositoryFactoryUtil.getInstance(repositoryImplClassName);
  }
 catch (  Exception e) {
    throw new RepositoryException("There is no valid repository class with class name id " + classNameId,e);
  }
  if (baseRepository instanceof CMISRepositoryWrapper) {
    CMISRepositoryWrapper cmisRepositoryWrapper=(CMISRepositoryWrapper)baseRepository;
    CMISRepository cmisRepository=new CMISRepository(cmisRepositoryWrapper);
    cmisRepositoryWrapper.setCmisRepository(cmisRepository);
    setupRepository(repositoryId,repository,cmisRepository);
  }
  setupRepository(repositoryId,repository,baseRepository);
  baseRepository.initRepository();
  return baseRepository;
}
