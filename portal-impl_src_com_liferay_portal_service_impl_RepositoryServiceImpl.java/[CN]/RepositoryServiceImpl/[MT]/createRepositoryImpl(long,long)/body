{
  BaseRepository baseRepository=null;
  Repository repository=null;
  try {
    repository=getRepository(repositoryId);
    String repositoryImplClassName=PortalUtil.getClassName(classNameId);
    baseRepository=RepositoryFactoryUtil.getInstance(repositoryImplClassName);
  }
 catch (  Exception e) {
    throw new RepositoryException("There is no valid repository class with class name id " + classNameId,e);
  }
  baseRepository.setCompanyId(repository.getCompanyId());
  baseRepository.setCompanyLocalService(companyLocalService);
  baseRepository.setCounterLocalService(counterLocalService);
  baseRepository.setDLAppHelperLocalService(dlAppHelperLocalService);
  baseRepository.setGroupId(repository.getGroupId());
  baseRepository.setRepositoryId(repositoryId);
  baseRepository.setTypeSettingsProperties(repository.getTypeSettingsProperties());
  baseRepository.setUserLocalService(userLocalService);
  baseRepository.initRepository();
  return baseRepository;
}
