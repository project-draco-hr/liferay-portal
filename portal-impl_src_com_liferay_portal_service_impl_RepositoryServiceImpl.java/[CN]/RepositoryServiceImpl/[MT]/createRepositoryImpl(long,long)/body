{
  try {
    Repository repository=getRepository(repositoryId);
    String repositoryImplClassName=PortalUtil.getClassName(classNameId);
    BaseRepositoryImpl baseRepositoryImpl=(BaseRepositoryImpl)InstanceFactory.newInstance(repositoryImplClassName);
    baseRepositoryImpl.setCounterLocalService(counterLocalService);
    baseRepositoryImpl.setDLAppHelperLocalService(dlAppHelperLocalService);
    baseRepositoryImpl.setRepositoryId(repositoryId);
    baseRepositoryImpl.setTypeSettingsProperties(repository.getTypeSettingsProperties());
    baseRepositoryImpl.initRepository();
    return baseRepositoryImpl;
  }
 catch (  Exception e) {
    throw new RepositoryException("There is no valid repository class with class name id " + classNameId,e);
  }
}
