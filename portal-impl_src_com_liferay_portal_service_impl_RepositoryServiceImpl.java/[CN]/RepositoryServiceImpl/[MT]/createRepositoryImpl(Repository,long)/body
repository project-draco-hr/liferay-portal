{
  BaseRepository baseRepository=null;
  try {
    String repositoryImplClassName=PortalUtil.getClassName(classNameId);
    baseRepository=RepositoryFactoryUtil.getInstance(repositoryImplClassName);
  }
 catch (  Exception e) {
    throw new RepositoryException("There is no valid repository class with class name id " + classNameId,e);
  }
  CMISRepositoryHandler cmisRepositoryHandler=null;
  if (baseRepository instanceof CMISRepositoryHandler) {
    cmisRepositoryHandler=(CMISRepositoryHandler)baseRepository;
  }
 else   if (baseRepository instanceof BaseRepositoryProxyBean) {
    BaseRepositoryProxyBean baseRepositoryProxyBean=(BaseRepositoryProxyBean)baseRepository;
    ClassLoaderBeanHandler classLoaderBeanHandler=(ClassLoaderBeanHandler)Proxy.getInvocationHandler(baseRepositoryProxyBean.getProxyBean());
    Object bean=classLoaderBeanHandler.getBean();
    if (bean instanceof CMISRepositoryHandler) {
      cmisRepositoryHandler=(CMISRepositoryHandler)bean;
    }
  }
  if (cmisRepositoryHandler != null) {
    CMISRepository cmisRepository=new CMISRepository(cmisRepositoryHandler);
    cmisRepositoryHandler.setCmisRepository(cmisRepository);
    setupRepository(repository.getRepositoryId(),repository,cmisRepository);
  }
  setupRepository(repository.getRepositoryId(),repository,baseRepository);
  baseRepository.initRepository();
  return baseRepository;
}
