{
  Group group=GroupTestUtil.addGroup();
  group=GroupTestUtil.updateDisplaySettings(group.getGroupId(),groupAvailableLocales,groupDefaultLocale);
  Locale enLocale=Locale.US;
  Locale esLocale=new Locale("es","ES");
  Locale deLocale=new Locale("de","DE");
  Map<Locale,String> nameMap=new HashMap<Locale,String>();
  nameMap.put(enLocale,"Home");
  nameMap.put(esLocale,"Casa");
  nameMap.put(deLocale,"Zuhause");
  Map<Locale,String> friendlyURLMap=new HashMap<Locale,String>();
  friendlyURLMap.put(enLocale,"/home");
  friendlyURLMap.put(esLocale,"/casa");
  friendlyURLMap.put(deLocale,"/zuhause");
  Layout layout=LayoutTestUtil.addLayout(group.getGroupId(),false,nameMap,friendlyURLMap);
  String completeURL=generateURL(i18nPath,group.getFriendlyURL(),layout.getFriendlyURL());
  ThemeDisplay themeDisplay=initThemeDisplay(group);
  String alternateURL=PortalUtil.getCanonicalURL(completeURL,themeDisplay,layout,true);
  String expectedURL=generateURL(StringPool.BLANK,group.getFriendlyURL(),expectedFriendlyURL);
  Assert.assertEquals(expectedURL,alternateURL);
}
