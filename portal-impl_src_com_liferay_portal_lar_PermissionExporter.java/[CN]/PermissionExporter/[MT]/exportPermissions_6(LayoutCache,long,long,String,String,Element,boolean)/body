{
  List<Role> roles=layoutCache.getGroupRoles_5(groupId,resourceName);
  List<String> actionIds=null;
  if (portletActions) {
    actionIds=ResourceActionsUtil.getPortletResourceActions(resourceName);
  }
 else {
    actionIds=ResourceActionsUtil.getModelResourceActions(resourceName);
  }
  if (actionIds.isEmpty()) {
    return;
  }
  Map<Long,Role> roleIdsToRoles=new HashMap<Long,Role>();
  for (  Role role : roles) {
    String name=role.getName();
    if (name.equals(RoleConstants.ADMINISTRATOR)) {
      continue;
    }
    roleIdsToRoles.put(role.getRoleId(),role);
  }
  Set<Long> roleIdsSet=roleIdsToRoles.keySet();
  long[] roleIds=ArrayUtil.toArray(roleIdsSet.toArray(new Long[roleIdsSet.size()]));
  Map<Long,Set<String>> roleIdsToActionIds=ResourcePermissionLocalServiceUtil.getAvailableResourcePermissionActionIds(companyId,resourceName,ResourceConstants.SCOPE_INDIVIDUAL,resourcePrimKey,roleIds,actionIds);
  for (  Role role : roleIdsToRoles.values()) {
    Set<String> availableActionIds=roleIdsToActionIds.get(role.getRoleId());
    if ((availableActionIds == null) || availableActionIds.isEmpty()) {
      continue;
    }
    Element roleElement=permissionsElement.addElement("role");
    roleElement.addAttribute("name",role.getName());
    roleElement.addAttribute("description",role.getDescription());
    roleElement.addAttribute("type",String.valueOf(role.getType()));
    for (    String action : availableActionIds) {
      Element actionKeyElement=roleElement.addElement("action-key");
      actionKeyElement.addText(action);
    }
  }
}
