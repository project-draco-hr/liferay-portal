{
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  Element userPermissionsElement=SAXReaderUtil.createElement("user-permissions");
  List<User> users=layoutCache.getGroupUsers(groupId);
  for (  User user : users) {
    String uuid=user.getUuid();
    Element userActionsElement=SAXReaderUtil.createElement("user-actions");
    List<Permission> permissions=PermissionLocalServiceUtil.getUserPermissions(user.getUserId(),companyId,resourceName,ResourceConstants.SCOPE_INDIVIDUAL,resourcePrimKey);
    List<String> actions=ResourceActionsUtil.getActions(permissions);
    for (    String action : actions) {
      Element actionKeyElement=userActionsElement.addElement("action-key");
      actionKeyElement.addText(action);
    }
    if (!userActionsElement.elements().isEmpty()) {
      userActionsElement.addAttribute("uuid",uuid);
      userPermissionsElement.add(userActionsElement);
    }
  }
  if (!userPermissionsElement.elements().isEmpty()) {
    parentElement.add(userPermissionsElement);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Export user permissions for {" + resourceName + ", "+ resourcePrimKey+ "} with "+ users.size()+ " users takes "+ stopWatch.getTime()+ " ms");
  }
}
