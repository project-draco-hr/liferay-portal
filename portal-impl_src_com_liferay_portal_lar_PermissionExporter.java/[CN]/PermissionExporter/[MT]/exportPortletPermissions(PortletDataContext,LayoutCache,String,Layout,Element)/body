{
  long companyId=portletDataContext.getCompanyId();
  long groupId=portletDataContext.getGroupId();
  String resourceName=PortletConstants.getRootPortletId(portletId);
  String resourcePrimKey=PortletPermissionUtil.getPrimaryKey(layout.getPlid(),portletId);
  Element permissionsElement=portletElement.addElement("permissions");
  if (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 5) {
    exportPermissions_5(layoutCache,companyId,groupId,resourceName,resourcePrimKey,permissionsElement,true);
  }
 else   if (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 6) {
    exportPermissions_6(layoutCache,companyId,groupId,resourceName,resourcePrimKey,permissionsElement,true);
  }
 else {
    boolean exportUserPermissions=MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.USER_PERMISSIONS);
    exportPermissions_1to4(layoutCache,companyId,groupId,resourceName,resourcePrimKey,permissionsElement,exportUserPermissions);
    Element rolesElement=portletElement.addElement("roles");
    exportPortletRoles(layoutCache,companyId,groupId,portletId,rolesElement);
  }
}
