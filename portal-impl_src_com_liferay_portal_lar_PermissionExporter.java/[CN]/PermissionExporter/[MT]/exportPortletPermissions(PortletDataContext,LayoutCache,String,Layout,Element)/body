{
  long companyId=context.getCompanyId();
  long groupId=context.getGroupId();
  String resourceName=PortletConstants.getRootPortletId(portletId);
  String resourcePrimKey=PortletPermissionUtil.getPrimaryKey(layout.getPlid(),portletId);
  Element permissionsEl=portletEl.addElement("permissions");
  if (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 5) {
    exportPermissions_5(layoutCache,companyId,groupId,resourceName,resourcePrimKey,permissionsEl,true);
  }
 else   if (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 6) {
    exportPermissions_6(layoutCache,companyId,groupId,resourceName,resourcePrimKey,permissionsEl,true);
  }
 else {
    boolean exportUserPermissions=MapUtil.getBoolean(context.getParameterMap(),PortletDataHandlerKeys.USER_PERMISSIONS);
    exportPermissions_1to4(layoutCache,companyId,groupId,resourceName,resourcePrimKey,permissionsEl,exportUserPermissions);
    Element rolesEl=portletEl.addElement("roles");
    exportPortletRoles(layoutCache,companyId,groupId,portletId,rolesEl);
  }
}
