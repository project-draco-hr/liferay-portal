{
  try {
    HttpServletRequest req=(HttpServletRequest)pageContext.getRequest();
    ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
    PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
    Layout layout=themeDisplay.getLayout();
    if (Validator.isNull(_redirect)) {
      RenderRequest renderRequest=(RenderRequest)req.getAttribute(WebKeys.JAVAX_PORTLET_REQUEST);
      RenderResponse renderResponse=(RenderResponse)req.getAttribute(WebKeys.JAVAX_PORTLET_RESPONSE);
      _redirect=PortletURLUtil.getCurrent(renderRequest,renderResponse).toString();
    }
    PortletURL portletURL=new PortletURLImpl(req,PortletKeys.PORTLET_CONFIGURATION,layout.getPlid(),false);
    portletURL.setWindowState(WindowState.MAXIMIZED);
    portletURL.setParameter("struts_action","/portlet_configuration/edit_permissions");
    portletURL.setParameter("redirect",_redirect);
    portletURL.setParameter("portletResource",portletDisplay.getId());
    portletURL.setParameter("modelResource",_modelResource);
    portletURL.setParameter("modelResourceDescription",_modelResourceDescription);
    portletURL.setParameter("resourcePrimKey",_resourcePrimKey);
    String portletURLToString=portletURL.toString();
    if (Validator.isNotNull(_var)) {
      pageContext.setAttribute(_var,portletURLToString);
    }
 else {
      pageContext.getOut().print(portletURLToString);
    }
  }
 catch (  Exception e) {
    throw new JspException(e);
  }
  return EVAL_PAGE;
}
