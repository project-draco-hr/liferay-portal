{
  if ((len <= 0) || (off < 0)) {
    return -1;
  }
  int initLen=len;
  while ((_avaiableBytes > 0) && (len > 0)) {
    buf[off++]=_unitBuffer[_unitBufferIndex++];
    _avaiableBytes--;
    len--;
  }
  int blen=len - len % 3;
  while (blen > 0) {
    int result=decodeUnit(buf,off);
    if (result > 0) {
      off+=result;
      len-=result;
    }
    if (result < 3) {
      if (initLen == len) {
        return -1;
      }
      return initLen - len;
    }
    blen-=3;
  }
  while (len > 0) {
    int c=read();
    if (c == -1) {
      break;
    }
    buf[off++]=(byte)c;
    len--;
  }
  if (initLen == len) {
    return -1;
  }
  return initLen - len;
}
