{
  super.doUpgrade();
  if (_log.isInfoEnabled()) {
    _log.info("Adding column companyId to table ShoppingOrderItem");
  }
  runSQL("alter table ShoppingOrderItem add companyId LONG");
  StringBundler sb=new StringBundler(7);
  sb.append("update ShoppingOrderItem set companyId = ");
  sb.append("(select  max(ShoppingItem.companyId) ");
  sb.append("from ShoppingItem ");
  sb.append("where SUBSTR(ShoppingOrderItem.itemId, 0, INSTR('|', ");
  sb.append("ShoppingOrderItem.itemId)) = ");
  sb.append("CAST_TEXT(ShoppingItem.itemId))");
  sb.append("where ShoppingOrderItem.itemId like '%|%' ");
  runSQL(sb.toString());
  sb=new StringBundler(6);
  sb.append("update ShoppingOrderItem set companyId = ");
  sb.append("(select max(ShoppingItem.companyId) ");
  sb.append("from ShoppingItem ");
  sb.append("where ShoppingOrderItem.itemId = ");
  sb.append("CAST_TEXT(ShoppingItem.itemId)) ");
  sb.append("where ShoppingOrderItem.itemId not like '%|%' ");
  runSQL(sb.toString());
}
