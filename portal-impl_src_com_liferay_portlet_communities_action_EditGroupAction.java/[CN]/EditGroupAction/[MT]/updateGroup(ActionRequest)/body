{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long userId=PortalUtil.getUserId(actionRequest);
  long groupId=ParamUtil.getLong(actionRequest,"groupId");
  String name=ParamUtil.getString(actionRequest,"name");
  String description=ParamUtil.getString(actionRequest,"description");
  int type=ParamUtil.getInteger(actionRequest,"type");
  String friendlyURL=ParamUtil.getString(actionRequest,"friendlyURL");
  boolean active=ParamUtil.getBoolean(actionRequest,"active");
  long publicLayoutSetPrototypeId=ParamUtil.getLong(actionRequest,"publicLayoutSetPrototypeId");
  long privateLayoutSetPrototypeId=ParamUtil.getLong(actionRequest,"privateLayoutSetPrototypeId");
  ServiceContext serviceContext=ServiceContextFactory.getInstance(Group.class.getName(),actionRequest);
  Group group=null;
  if (groupId <= 0) {
    group=GroupServiceUtil.addGroup(name,description,type,friendlyURL,active,serviceContext);
    LiveUsers.joinGroup(themeDisplay.getCompanyId(),group.getGroupId(),userId);
  }
 else {
    group=GroupServiceUtil.updateGroup(groupId,name,description,type,friendlyURL,active,serviceContext);
  }
  CommunitiesUtil.applyLayoutSetPrototypes(group,publicLayoutSetPrototypeId,privateLayoutSetPrototypeId);
}
