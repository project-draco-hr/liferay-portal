{
  ResourceBlock resourceBlock=resourceBlockLocalService.getResourceBlock(className,primKey);
  Map<Long,Set<String>> roleIdsToActionIds=new HashMap<Long,Set<String>>();
  for (  long roleId : roleIds) {
    Set<String> availableActionIds=roleIdsToActionIds.get(roleId);
    if (availableActionIds != null) {
      continue;
    }
    List<String> resourceBlockActions=resourceBlockLocalService.getPermissions(resourceBlock,roleId);
    if (resourceBlockActions.isEmpty()) {
      continue;
    }
    availableActionIds=new HashSet<String>();
    roleIdsToActionIds.put(roleId,availableActionIds);
    for (    String actionId : actionIds) {
      if (resourceBlockActions.contains(actionId)) {
        availableActionIds.add(actionId);
      }
    }
  }
  return roleIdsToActionIds;
}
