{
  HttpSession session=request.getSession();
  ServletContext servletContext=session.getServletContext();
  try {
    VelocityTaglib velocityTaglib=new VelocityTaglibImpl(servletContext,request,new PipingServletResponse(response,response.getWriter()),null);
    return velocityTaglib;
  }
 catch (  IOException ioe) {
    throw new IllegalStateException(ioe);
  }
}
