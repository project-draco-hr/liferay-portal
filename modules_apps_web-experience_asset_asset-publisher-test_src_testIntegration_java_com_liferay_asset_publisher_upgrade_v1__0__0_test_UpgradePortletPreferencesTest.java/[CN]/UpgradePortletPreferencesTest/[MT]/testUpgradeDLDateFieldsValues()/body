{
  DDMStructure ddmStructure=addDDMStructure(DLFileEntryMetadata.class.getName());
  ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext();
  DLFileEntryType dlFileEntryType=DLFileEntryTypeLocalServiceUtil.addFileEntryType(TestPropsValues.getUserId(),_group.getGroupId(),"New File Entry Type",StringPool.BLANK,new long[]{ddmStructure.getStructureId()},serviceContext);
  Map<String,String> portletPreferencesMap=new HashMap<>();
  portletPreferencesMap.put("subtypeFieldsFilterEnabled",Boolean.TRUE.toString());
  portletPreferencesMap.put("subtypeFieldsFilterEnabledDLFileEntryAssetRendererFactory",Boolean.TRUE.toString());
  portletPreferencesMap.put("anyClassTypeDLFileEntryAssetRendererFactory",String.valueOf(dlFileEntryType.getFileEntryTypeId()));
  Date now=new Date();
  String dateString=_oldDateFormat.format(now);
  portletPreferencesMap.put("ddmStructureFieldName","Birthday");
  portletPreferencesMap.put("ddmStructureFieldValue",dateString);
  String portletId=getPortletId();
  PortletPreferences portletPreferences=updatePortletPreferences(portletId,portletPreferencesMap);
  String ddmStructureFieldValue=portletPreferences.getValue("ddmStructureFieldValue",StringPool.BLANK);
  Assert.assertEquals(dateString,ddmStructureFieldValue);
  _upgradePortletPreferences.upgrade();
  portletPreferences=getPortletPreferences(portletId);
  ddmStructureFieldValue=portletPreferences.getValue("ddmStructureFieldValue",StringPool.BLANK);
  dateString=_newDateFormat.format(now);
  Assert.assertEquals(dateString,ddmStructureFieldValue);
}
