{
  DDMStructure ddmStructure=addDDMStructure(JournalArticle.class.getName());
  Map<String,String> portletPreferencesMap=new HashMap<>();
  portletPreferencesMap.put("subtypeFieldsFilterEnabled",Boolean.TRUE.toString());
  portletPreferencesMap.put("subtypeFieldsFilterEnabledJournalArticleAssetRendererFactory",Boolean.TRUE.toString());
  portletPreferencesMap.put("anyClassTypeJournalArticleAssetRendererFactory",String.valueOf(ddmStructure.getStructureId()));
  portletPreferencesMap.put("ddmStructureFieldName","Birthday");
  Date now=new Date();
  String dateString=_oldDateFormat.format(now);
  portletPreferencesMap.put("ddmStructureFieldValue",dateString);
  String portletId=getPortletId();
  PortletPreferences portletPreferences=updatePortletPreferences(portletId,portletPreferencesMap);
  String fieldValue=portletPreferences.getValue("ddmStructureFieldValue",StringPool.BLANK);
  Assert.assertEquals(dateString,fieldValue);
  _upgradePortletPreferences.upgrade();
  portletPreferences=getPortletPreferences(portletId);
  fieldValue=portletPreferences.getValue("ddmStructureFieldValue",StringPool.BLANK);
  dateString=_newDateFormat.format(now);
  Assert.assertEquals(dateString,fieldValue);
}
