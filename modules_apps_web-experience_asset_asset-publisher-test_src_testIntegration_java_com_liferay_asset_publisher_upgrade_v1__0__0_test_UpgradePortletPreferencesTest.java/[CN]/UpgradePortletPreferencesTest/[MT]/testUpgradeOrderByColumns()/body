{
  DDMStructure ddmStructure=addDDMStructure(JournalArticle.class.getName());
  DDMFormField ddmFormField=ddmStructure.getDDMFormField("Text");
  Map<String,String> portletPreferencesMap=new HashMap<>();
  portletPreferencesMap.put("subtypeFieldsFilterEnabled",Boolean.TRUE.toString());
  StringBundler orderByColumn=new StringBundler(5);
  orderByColumn.append("ddm");
  orderByColumn.append(StringPool.DOUBLE_UNDERLINE);
  orderByColumn.append(ddmStructure.getStructureId());
  orderByColumn.append(StringPool.DOUBLE_UNDERLINE);
  orderByColumn.append(ddmFormField.getName());
  portletPreferencesMap.put("orderByColumn1",orderByColumn.toString());
  portletPreferencesMap.put("orderByColumn2",orderByColumn.toString());
  String portletId=getPortletId();
  updatePortletPreferences(portletId,portletPreferencesMap);
  _upgradePortletPreferences.upgrade();
  PortletPreferences portletPreferences=getPortletPreferences(portletId);
  String orderByColumn1=portletPreferences.getValue("orderByColumn1",StringPool.BLANK);
  String orderByColumn2=portletPreferences.getValue("orderByColumn2",StringPool.BLANK);
  String expectedOrderByColumn=getExpectedOrderByColumnValue(ddmStructure,ddmFormField);
  Assert.assertEquals(expectedOrderByColumn,orderByColumn1);
  Assert.assertEquals(expectedOrderByColumn,orderByColumn2);
}
