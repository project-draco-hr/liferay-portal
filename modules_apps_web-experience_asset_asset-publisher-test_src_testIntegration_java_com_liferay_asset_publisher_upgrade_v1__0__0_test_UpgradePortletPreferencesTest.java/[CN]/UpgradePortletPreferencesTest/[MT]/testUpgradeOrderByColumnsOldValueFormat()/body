{
  DDMStructure ddmStructure=addDDMStructure(JournalArticle.class.getName());
  DDMFormField ddmFormField=ddmStructure.getDDMFormField("Text");
  Map<String,String> portletPreferencesMap=new HashMap<>();
  portletPreferencesMap.put("subtypeFieldsFilterEnabled",Boolean.TRUE.toString());
  StringBundler orderByColumn1OldValue=new StringBundler(5);
  orderByColumn1OldValue.append("ddm");
  orderByColumn1OldValue.append(StringPool.FORWARD_SLASH);
  orderByColumn1OldValue.append(ddmStructure.getStructureId());
  orderByColumn1OldValue.append(StringPool.FORWARD_SLASH);
  orderByColumn1OldValue.append(ddmFormField.getName());
  StringBundler orderByColumn2OldValue=new StringBundler(7);
  orderByColumn2OldValue.append("ddm");
  orderByColumn2OldValue.append(StringPool.FORWARD_SLASH);
  orderByColumn2OldValue.append(ddmFormField.getIndexType());
  orderByColumn2OldValue.append(StringPool.FORWARD_SLASH);
  orderByColumn2OldValue.append(ddmStructure.getStructureId());
  orderByColumn2OldValue.append(StringPool.FORWARD_SLASH);
  orderByColumn2OldValue.append(ddmFormField.getName());
  portletPreferencesMap.put("orderByColumn1",orderByColumn1OldValue.toString());
  portletPreferencesMap.put("orderByColumn2",orderByColumn2OldValue.toString());
  String portletId=getPortletId();
  updatePortletPreferences(portletId,portletPreferencesMap);
  _upgradePortletPreferences.upgrade();
  PortletPreferences portletPreferences=getPortletPreferences(portletId);
  String orderByColumn1=portletPreferences.getValue("orderByColumn1",StringPool.BLANK);
  String orderByColumn2=portletPreferences.getValue("orderByColumn2",StringPool.BLANK);
  String expectedOrderByColumn=getExpectedOrderByColumnValue(ddmStructure,ddmFormField);
  Assert.assertEquals(expectedOrderByColumn,orderByColumn1);
  Assert.assertEquals(expectedOrderByColumn,orderByColumn2);
}
