{
  User user=null;
  String authType=PrefsPropsUtil.getString(companyId,PropsKeys.COMPANY_SECURITY_AUTH_TYPE,PropsValues.COMPANY_SECURITY_AUTH_TYPE);
  if (authType.equals(CompanyConstants.AUTH_TYPE_SN) && !ldapUser.isAutoScreenName()) {
    user=UserLocalServiceUtil.fetchUserByScreenName(companyId,ldapUser.getScreenName());
  }
 else {
    user=UserLocalServiceUtil.fetchUserByEmailAddress(companyId,ldapUser.getEmailAddress());
  }
  return user;
}
