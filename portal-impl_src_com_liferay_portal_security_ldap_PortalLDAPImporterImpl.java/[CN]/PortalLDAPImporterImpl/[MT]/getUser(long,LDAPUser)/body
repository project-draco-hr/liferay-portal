{
  User user=null;
  try {
    String authType=PrefsPropsUtil.getString(companyId,PropsKeys.COMPANY_SECURITY_AUTH_TYPE,PropsValues.COMPANY_SECURITY_AUTH_TYPE);
    if (authType.equals(CompanyConstants.AUTH_TYPE_SN) && !ldapUser.isAutoScreenName()) {
      user=UserLocalServiceUtil.getUserByScreenName(companyId,ldapUser.getScreenName());
    }
 else {
      user=UserLocalServiceUtil.getUserByEmailAddress(companyId,ldapUser.getEmailAddress());
    }
  }
 catch (  NoSuchUserException nsue) {
  }
  return user;
}
