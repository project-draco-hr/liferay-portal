{
  User user=null;
  try {
    if (_log.isDebugEnabled()) {
      _log.debug("Adding user to portal " + ldapUserHolder.getEmailAddress());
    }
    Calendar birthdayCal=CalendarFactoryUtil.getCalendar();
    birthdayCal.setTime(ldapUserHolder.getBirthday());
    int birthdayMonth=birthdayCal.get(Calendar.MONTH);
    int birthdayDay=birthdayCal.get(Calendar.DAY_OF_MONTH);
    int birthdayYear=birthdayCal.get(Calendar.YEAR);
    user=UserLocalServiceUtil.addUser(ldapUserHolder.getCreatorUserId(),companyId,ldapUserHolder.isAutoPassword(),password,password,ldapUserHolder.isAutoScreenName(),ldapUserHolder.getScreenName(),ldapUserHolder.getEmailAddress(),ldapUserHolder.getOpenId(),ldapUserHolder.getLocale(),ldapUserHolder.getFirstName(),ldapUserHolder.getMiddleName(),ldapUserHolder.getLastName(),ldapUserHolder.getPrefixId(),ldapUserHolder.getSuffixId(),ldapUserHolder.getMale(),birthdayMonth,birthdayDay,birthdayYear,ldapUserHolder.getJobTitle(),ldapUserHolder.getGroupIds(),ldapUserHolder.getOrganizationIds(),ldapUserHolder.getRoleIds(),ldapUserHolder.getUserGroupIds(),ldapUserHolder.isSendEmail(),ldapUserHolder.getServiceContext());
  }
 catch (  Exception e) {
    _log.error("Problem adding user with screen name " + ldapUserHolder.getScreenName() + " and email address "+ ldapUserHolder.getEmailAddress(),e);
  }
  return user;
}
