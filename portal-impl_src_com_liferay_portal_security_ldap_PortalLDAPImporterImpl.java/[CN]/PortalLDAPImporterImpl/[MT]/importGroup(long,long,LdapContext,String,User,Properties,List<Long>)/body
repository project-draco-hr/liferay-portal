{
  Map<String,Long> userGroupIds=null;
  String userGroupIdKey=null;
  Long userGroupId=null;
  if (PropsValues.LDAP_IMPORT_GROUP_CACHE_SIZE > 0) {
    userGroupIds=_userGroupIds.get();
    StringBundler sb=new StringBundler(5);
    sb.append(ldapServerId);
    sb.append(StringPool.UNDERLINE);
    sb.append(companyId);
    sb.append(StringPool.UNDERLINE);
    sb.append(fullGroupDN);
    userGroupIdKey=sb.toString();
    userGroupId=userGroupIds.get(userGroupIdKey);
  }
  if (userGroupId != null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Skipping reimport of full group DN " + fullGroupDN);
    }
  }
 else {
    if (_log.isDebugEnabled()) {
      _log.debug("Importing full froup DN " + fullGroupDN);
    }
    Attributes groupAttributes=null;
    try {
      groupAttributes=PortalLDAPUtil.getGroupAttributes(ldapServerId,companyId,ldapContext,fullGroupDN);
    }
 catch (    NameNotFoundException nnfe) {
      _log.error("LDAP group not found with full group DN " + fullGroupDN,nnfe);
    }
    UserGroup userGroup=importUserGroup(companyId,groupAttributes,groupMappings);
    userGroupId=userGroup.getUserGroupId();
    if (PropsValues.LDAP_IMPORT_GROUP_CACHE_SIZE > 0) {
      userGroupIds.put(userGroupIdKey,userGroupId);
    }
  }
  if (userGroupId != null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Adding " + user.getUserId() + " to group "+ userGroupId);
    }
    newUserGroupIds.add(userGroupId);
  }
  return newUserGroupIds;
}
