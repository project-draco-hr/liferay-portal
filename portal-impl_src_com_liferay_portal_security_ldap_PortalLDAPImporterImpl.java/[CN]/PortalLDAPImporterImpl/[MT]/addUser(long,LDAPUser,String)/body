{
  if (_log.isDebugEnabled()) {
    _log.debug("Adding user " + ldapUser.getEmailAddress());
  }
  Calendar birthdayCal=CalendarFactoryUtil.getCalendar();
  birthdayCal.setTime(ldapUser.getBirthday());
  int birthdayMonth=birthdayCal.get(Calendar.MONTH);
  int birthdayDay=birthdayCal.get(Calendar.DAY_OF_MONTH);
  int birthdayYear=birthdayCal.get(Calendar.YEAR);
  boolean autoGenerated=ldapUser.isAutoPassword();
  if (!PropsValues.LDAP_IMPORT_USER_PASSWORD_ENABLED) {
    if (_log.isDebugEnabled()) {
      _log.debug("LDAP user's password is not imported. Set password to " + "default vaule.");
    }
    autoGenerated=PropsValues.LDAP_IMPORT_USER_PASSWORD_AUTOGENERATED;
    if (!autoGenerated) {
      String defaultPassword=PropsValues.LDAP_IMPORT_USER_PASSWORD_DEFAULT;
      if (defaultPassword.equalsIgnoreCase(_PASSWORD_SCREENNAME)) {
        defaultPassword=ldapUser.getScreenName();
      }
      password=defaultPassword;
    }
  }
  return UserLocalServiceUtil.addUser(ldapUser.getCreatorUserId(),companyId,autoGenerated,password,password,ldapUser.isAutoScreenName(),ldapUser.getScreenName(),ldapUser.getEmailAddress(),ldapUser.getFacebookId(),ldapUser.getOpenId(),ldapUser.getLocale(),ldapUser.getFirstName(),ldapUser.getMiddleName(),ldapUser.getLastName(),ldapUser.getPrefixId(),ldapUser.getSuffixId(),ldapUser.isMale(),birthdayMonth,birthdayDay,birthdayYear,ldapUser.getJobTitle(),ldapUser.getGroupIds(),ldapUser.getOrganizationIds(),ldapUser.getRoleIds(),ldapUser.getUserGroupIds(),ldapUser.isSendEmail(),ldapUser.getServiceContext());
}
