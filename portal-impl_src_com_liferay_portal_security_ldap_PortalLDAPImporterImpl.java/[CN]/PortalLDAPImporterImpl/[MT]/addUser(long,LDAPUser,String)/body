{
  if (_log.isDebugEnabled()) {
    _log.debug("Adding user " + ldapUser.getEmailAddress());
  }
  boolean autoPassword=ldapUser.isAutoPassword();
  if (!PropsValues.LDAP_IMPORT_USER_PASSWORD_ENABLED) {
    autoPassword=PropsValues.LDAP_IMPORT_USER_PASSWORD_AUTOGENERATED;
    if (!autoPassword) {
      String defaultPassword=PropsValues.LDAP_IMPORT_USER_PASSWORD_DEFAULT;
      if (defaultPassword.equalsIgnoreCase(_USER_PASSWORD_SCREEN_NAME)) {
        defaultPassword=ldapUser.getScreenName();
      }
      password=defaultPassword;
    }
  }
  Calendar birthdayCal=CalendarFactoryUtil.getCalendar();
  birthdayCal.setTime(ldapUser.getBirthday());
  int birthdayMonth=birthdayCal.get(Calendar.MONTH);
  int birthdayDay=birthdayCal.get(Calendar.DAY_OF_MONTH);
  int birthdayYear=birthdayCal.get(Calendar.YEAR);
  return UserLocalServiceUtil.addUserBypassWorkflow(ldapUser.getCreatorUserId(),companyId,autoPassword,password,password,ldapUser.isAutoScreenName(),ldapUser.getScreenName(),ldapUser.getEmailAddress(),ldapUser.getFacebookId(),ldapUser.getOpenId(),ldapUser.getLocale(),ldapUser.getFirstName(),ldapUser.getMiddleName(),ldapUser.getLastName(),ldapUser.getPrefixId(),ldapUser.getSuffixId(),ldapUser.isMale(),birthdayMonth,birthdayDay,birthdayYear,ldapUser.getJobTitle(),ldapUser.getGroupIds(),ldapUser.getOrganizationIds(),ldapUser.getRoleIds(),ldapUser.getUserGroupIds(),ldapUser.isSendEmail(),ldapUser.getServiceContext());
}
