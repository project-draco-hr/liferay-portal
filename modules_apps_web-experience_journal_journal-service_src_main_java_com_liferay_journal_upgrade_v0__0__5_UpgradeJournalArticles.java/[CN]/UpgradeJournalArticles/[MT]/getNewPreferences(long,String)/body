{
  PortletPreferences oldPortletPreferences=PortletPreferencesFactoryUtil.fromDefaultXML(preferences);
  String ddmStructureKey=oldPortletPreferences.getValue("ddmStructureKey",StringPool.BLANK);
  long groupId=GetterUtil.getLong(oldPortletPreferences.getValue("groupId",StringPool.BLANK));
  String orderByCol=oldPortletPreferences.getValue("orderByCol",StringPool.BLANK);
  String orderByType=oldPortletPreferences.getValue("orderByType",StringPool.BLANK);
  int pageDelta=GetterUtil.getInteger(oldPortletPreferences.getValue("pageDelta",StringPool.BLANK));
  String pageUrl=oldPortletPreferences.getValue("pageUrl",StringPool.BLANK);
  String type=oldPortletPreferences.getValue("type",StringPool.BLANK);
  PortletPreferences newPortletPreferences=new PortletPreferencesImpl();
  newPortletPreferences.setValue("anyAssetType",String.valueOf(PortalUtil.getClassNameId(JournalArticle.class.getName())));
  Layout layout=_layoutLocalService.getLayout(plid);
  long structureId=getStructureId(layout.getCompanyId(),layout.getGroupId(),ddmStructureKey);
  if (structureId > 0) {
    newPortletPreferences.setValue("anyClassTypeJournalArticleAssetRendererFactory",String.valueOf(structureId));
  }
  String assetLinkBehavior="showFullContent";
  if (pageUrl.equals("viewInContext")) {
    assetLinkBehavior="viewInPortlet";
  }
  newPortletPreferences.setValue("assetLinkBehavior",assetLinkBehavior);
  if (structureId > 0) {
    newPortletPreferences.setValue("classTypeIds",String.valueOf(structureId));
  }
  newPortletPreferences.setValue("delta",String.valueOf(pageDelta));
  newPortletPreferences.setValue("displayStyle","table");
  newPortletPreferences.setValue("metadataFields","publish-date,author");
  newPortletPreferences.setValue("orderByColumn1",orderByCol);
  newPortletPreferences.setValue("orderByType1",orderByType);
  newPortletPreferences.setValue("paginationType","none");
  long categoryId=getCategoryId(layout.getCompanyId(),type);
  if (categoryId > 0) {
    newPortletPreferences.setValue("queryAndOperator0",Boolean.TRUE.toString());
    newPortletPreferences.setValue("queryContains0",Boolean.TRUE.toString());
    newPortletPreferences.setValue("queryName0","assetCategories");
    newPortletPreferences.setValue("queryValues0",String.valueOf(categoryId));
  }
  newPortletPreferences.setValue("showAddContentButton",Boolean.FALSE.toString());
  String groupName=String.valueOf(groupId);
  if (groupId == layout.getGroupId()) {
    groupName="default";
  }
  newPortletPreferences.setValue("scopeIds","Group_" + groupName);
  return PortletPreferencesFactoryUtil.toXML(newPortletPreferences);
}
