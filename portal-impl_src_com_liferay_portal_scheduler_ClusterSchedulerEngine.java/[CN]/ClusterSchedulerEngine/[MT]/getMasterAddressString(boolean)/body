{
  String owner=null;
  while (true) {
    try {
      Lock lock=null;
      if (owner == null) {
        lock=LockLocalServiceUtil.lock(_LOCK_CLASS_NAME,_LOCK_CLASS_NAME,_localClusterNodeAddress);
      }
 else {
        lock=LockLocalServiceUtil.lock(_LOCK_CLASS_NAME,_LOCK_CLASS_NAME,owner,_localClusterNodeAddress);
      }
      owner=lock.getOwner();
      Address address=AddressSerializerUtil.deserialize(owner);
      if (ClusterExecutorUtil.isClusterNodeAlive(address)) {
        break;
      }
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Could not acquire memory scheduler cluster lock",e);
      }
    }
    if (_log.isInfoEnabled()) {
      _log.info("Could not acquire scheduler cluster lock, retrying");
      if (Validator.isNotNull(owner)) {
        _log.info("Lock currently held by " + owner);
      }
    }
  }
  boolean master=_localClusterNodeAddress.equals(owner);
  if (master == _master) {
    return owner;
  }
  if (master) {
    slaveToMaster();
  }
 else {
    masterToSlave(owner,asynchronous);
  }
  return owner;
}
