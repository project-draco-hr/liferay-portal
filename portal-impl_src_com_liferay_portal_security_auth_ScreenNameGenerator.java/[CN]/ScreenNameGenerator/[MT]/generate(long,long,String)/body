{
  String screenName=StringUtil.extractFirst(emailAddress,StringPool.AT).toLowerCase();
  screenName=StringUtil.replace(screenName,new String[]{StringPool.SLASH,StringPool.UNDERLINE},new String[]{StringPool.PERIOD,StringPool.PERIOD});
  if (screenName.equals(ScreenNameValidator.CYRUS) || screenName.equals(ScreenNameValidator.POSTFIX)) {
    screenName+=StringPool.PERIOD + userId;
  }
  try {
    UserLocalServiceUtil.getUserByScreenName(companyId,screenName);
  }
 catch (  NoSuchUserException nsue) {
    String friendlyURL=StringPool.SLASH + screenName;
    try {
      GroupLocalServiceUtil.getFriendlyURLGroup(companyId,friendlyURL);
    }
 catch (    NoSuchGroupException nsge) {
      return screenName;
    }
  }
  for (int i=1; ; i++) {
    String tempScreenName=screenName + StringPool.PERIOD + i;
    try {
      UserLocalServiceUtil.getUserByScreenName(companyId,tempScreenName);
    }
 catch (    NoSuchUserException nsue) {
      String friendlyURL=StringPool.SLASH + tempScreenName;
      try {
        GroupLocalServiceUtil.getFriendlyURLGroup(companyId,friendlyURL);
      }
 catch (      NoSuchGroupException nsge) {
        screenName=tempScreenName;
        break;
      }
    }
  }
  return screenName;
}
