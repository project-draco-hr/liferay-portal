{
  wikiPageTitleValidator.validate(newTitle);
  if (StringUtil.equalsIgnoreCase(title,newTitle)) {
    throw new DuplicatePageException(newTitle);
  }
  if (isUsedTitle(nodeId,newTitle)) {
    WikiPage page=getPage(nodeId,newTitle);
    if (((page.getVersion() == WikiPageConstants.VERSION_DEFAULT) && (page.getContent().length() < 200)) || !strict) {
      deletePage(nodeId,newTitle);
    }
 else {
      throw new DuplicatePageException(newTitle);
    }
  }
  WikiPage page=getPage(nodeId,title);
  String summary=page.getSummary();
  if (Validator.isNotNull(page.getRedirectTitle())) {
    page.setRedirectTitle(StringPool.BLANK);
    summary=StringPool.BLANK;
  }
  serviceContext.setCommand(Constants.RENAME);
  WikiPageRenameProcessor wikiPageRenameProcessor=_serviceTrackerMap.getService(page.getFormat());
  String content=page.getContent();
  if (wikiPageRenameProcessor != null) {
    List<WikiPage> versionPages=wikiPagePersistence.findByN_T_H(nodeId,title,false);
    for (    WikiPage curPage : versionPages) {
      curPage.setTitle(newTitle);
      curPage.setContent(wikiPageRenameProcessor.translate(curPage.getContent(),title,newTitle));
      wikiPagePersistence.update(curPage);
    }
    content=wikiPageRenameProcessor.translate(content,title,newTitle);
  }
  updatePage(userId,page,0,newTitle,content,summary,page.getMinorEdit(),page.getFormat(),page.getParentTitle(),page.getRedirectTitle(),serviceContext);
}
