{
  PollerRequest pollerRequest=(PollerRequest)message.getPayload();
  String portletId=pollerRequest.getPortletId();
  PollerProcessor pollerProcessor=PollerProcessorUtil.getPollerProcessor(portletId);
  if (pollerRequest.isReceiveRequest()) {
    PollerResponse pollerResponse=null;
    try {
      pollerResponse=pollerProcessor.receive(pollerRequest);
    }
 catch (    PollerException pe) {
      _log.error("Unable to receive poller request " + pollerRequest,pe);
      pollerResponse=pollerRequest.createPollerResponse();
      pollerResponse.setParameter("pollerException",pe.getMessage());
    }
 finally {
      if (pollerResponse == null) {
        pollerResponse=pollerRequest.createPollerResponse();
      }
      pollerResponse.close(message,pollerRequest.getPollerHeader(),pollerRequest.getPortletId(),pollerRequest.getChunkId());
    }
  }
 else {
    try {
      pollerProcessor.send(pollerRequest);
    }
 catch (    PollerException pe) {
      _log.error("Unable to send poller request " + pollerRequest,pe);
    }
  }
}
