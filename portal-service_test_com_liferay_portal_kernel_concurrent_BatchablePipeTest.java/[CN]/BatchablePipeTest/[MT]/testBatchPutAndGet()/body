{
  BatchablePipe<String,Integer> batchablePipe=new BatchablePipe<String,Integer>();
  IntegerIncreasableEntry entry1=new IntegerIncreasableEntry("1st",1);
  assertTrue(batchablePipe.put(entry1));
  assertTrue(batchablePipe.put(entry1));
  assertEquals(entry1,batchablePipe.take());
  assertEquals(entry1,batchablePipe.take());
  IntegerIncreasableEntry entry2=new IntegerIncreasableEntry("2nd",1);
  IntegerIncreasableEntry entry3=new IntegerIncreasableEntry("2nd",2);
  assertTrue(batchablePipe.put(entry2));
  assertFalse(batchablePipe.put(entry3));
  IncreasableEntry<String,Integer> resultEntry=batchablePipe.take();
  assertNotNull(resultEntry);
  assertEquals("2nd",resultEntry.getKey());
  assertEquals(3,(int)resultEntry.getValue());
  assertNull(batchablePipe.take());
  IntegerIncreasableEntry entry4=new IntegerIncreasableEntry("3rd",1);
  IntegerIncreasableEntry entry5=new IntegerIncreasableEntry("4th",1);
  IntegerIncreasableEntry entry6=new IntegerIncreasableEntry("4th",2);
  IntegerIncreasableEntry entry7=new IntegerIncreasableEntry("3rd",2);
  IntegerIncreasableEntry entry8=new IntegerIncreasableEntry("5th",1);
  assertTrue(batchablePipe.put(entry4));
  assertTrue(batchablePipe.put(entry5));
  assertFalse(batchablePipe.put(entry6));
  assertFalse(batchablePipe.put(entry7));
  assertTrue(batchablePipe.put(entry8));
  resultEntry=batchablePipe.take();
  assertNotNull(resultEntry);
  assertEquals("3rd",resultEntry.getKey());
  assertEquals(3,(int)resultEntry.getValue());
  resultEntry=batchablePipe.take();
  assertNotNull(resultEntry);
  assertEquals("4th",resultEntry.getKey());
  assertEquals(3,(int)resultEntry.getValue());
  resultEntry=batchablePipe.take();
  assertNotNull(resultEntry);
  assertEquals("5th",resultEntry.getKey());
  assertEquals(1,(int)resultEntry.getValue());
  assertNull(batchablePipe.take());
}
