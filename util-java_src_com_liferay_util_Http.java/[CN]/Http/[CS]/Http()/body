{
  if (Validator.isNotNull(NON_PROXY_HOSTS)) {
    String nonProxyHostsRegEx=NON_PROXY_HOSTS;
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\.","\\\\.");
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\*",".*?");
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\|",")|(");
    nonProxyHostsRegEx="(" + nonProxyHostsRegEx + ")";
    _nonProxyHostsPattern=Pattern.compile(nonProxyHostsRegEx);
  }
  MultiThreadedHttpConnectionManager connectionManager=new MultiThreadedHttpConnectionManager();
  HttpConnectionParams params=connectionManager.getParams();
  params.setParameter("maxConnectionsPerHost",new Integer(MAX_CONNECTIONS_PER_HOST));
  params.setParameter("maxTotalConnections",new Integer(MAX_TOTAL_CONNECTIONS));
  params.setConnectionTimeout(TIMEOUT);
  params.setSoTimeout(TIMEOUT);
  _client.setHttpConnectionManager(connectionManager);
  _proxyClient.setHttpConnectionManager(connectionManager);
  if (hasProxyConfig() && Validator.isNotNull(PROXY_USERNAME)) {
    if (PROXY_AUTH_TYPE.equals("username-password")) {
      _proxyCredentials=new UsernamePasswordCredentials(PROXY_USERNAME,PROXY_PASSWORD);
    }
 else     if (PROXY_AUTH_TYPE.equals("ntlm")) {
      _proxyCredentials=new NTCredentials(PROXY_USERNAME,PROXY_PASSWORD,PROXY_NTLM_HOST,PROXY_NTLM_DOMAIN);
      List authPrefs=new ArrayList();
      authPrefs.add(AuthPolicy.NTLM);
      authPrefs.add(AuthPolicy.BASIC);
      authPrefs.add(AuthPolicy.DIGEST);
      _proxyClient.getParams().setParameter(AuthPolicy.AUTH_SCHEME_PRIORITY,authPrefs);
    }
  }
}
