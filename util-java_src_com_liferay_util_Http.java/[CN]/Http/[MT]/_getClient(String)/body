{
  if (_log.isDebugEnabled()) {
    _log.debug("Location is " + location);
  }
  URI uri=new URI(location);
  if (Validator.isNull(PROXY_HOST) || (PROXY_PORT <= 0) || Validator.isNull(_nonProxyHostsPattern)|| uri.getHost().matches(_nonProxyHostsPattern)) {
    _hostConfig.setHost(uri);
    _client.setHostConfiguration(_hostConfig);
    _client.setParams(_clientParams);
    _client.setState(_state);
  }
 else   if (Validator.isNotNull(PROXY_HOST) && (PROXY_PORT > 0)) {
    _proxyHostConfig.setHost(uri);
    _client.setHostConfiguration(_proxyHostConfig);
    _client.setParams(_proxyClientParams);
    _client.setState(_proxyState);
  }
  return _client;
}
