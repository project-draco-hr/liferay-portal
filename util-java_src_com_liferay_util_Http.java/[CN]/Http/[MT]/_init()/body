{
  if (Validator.isNotNull(NON_PROXY_HOSTS)) {
    NON_PROXY_HOSTS_PATTERN=NON_PROXY_HOSTS.replaceAll("\\.","\\\\.");
    NON_PROXY_HOSTS_PATTERN=NON_PROXY_HOSTS.replaceAll("\\*",".*?");
    NON_PROXY_HOSTS_PATTERN=NON_PROXY_HOSTS.replaceAll("\\|",")|(");
    NON_PROXY_HOSTS_PATTERN="(" + NON_PROXY_HOSTS_PATTERN + ")";
  }
  MultiThreadedHttpConnectionManager connectionManager=new MultiThreadedHttpConnectionManager();
  HttpConnectionParams params=connectionManager.getParams();
  params.setParameter("maxConnectionsPerHost",new Integer(MAX_CONNECTIONS_PER_HOST));
  params.setParameter("maxTotalConnections",new Integer(MAX_TOTAL_CONNECTIONS));
  params.setConnectionTimeout(TIMEOUT);
  params.setSoTimeout(TIMEOUT);
  if (Validator.isNotNull(PROXY_USERNAME)) {
    Credentials credentials=null;
    if (PROXY_AUTH_TYPE.equals("username-password")) {
      credentials=new UsernamePasswordCredentials(PROXY_USERNAME,PROXY_PASSWORD);
    }
 else     if (PROXY_AUTH_TYPE.equals("ntlm")) {
      credentials=new NTCredentials(PROXY_USERNAME,PROXY_PASSWORD,PROXY_NTLM_HOST,PROXY_NTLM_DOMAIN);
      List authPrefs=new ArrayList();
      authPrefs.add(AuthPolicy.NTLM);
      authPrefs.add(AuthPolicy.BASIC);
      authPrefs.add(AuthPolicy.DIGEST);
      _proxyClientParams.setParameter(AuthPolicy.AUTH_SCHEME_PRIORITY,authPrefs);
    }
    _proxyHostConfig.setProxy(PROXY_HOST,PROXY_PORT);
    _proxyState.setProxyCredentials(new AuthScope(PROXY_HOST,PROXY_PORT,null),credentials);
  }
}
