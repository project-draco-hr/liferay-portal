{
  if (_log.isDebugEnabled()) {
    _log.debug("Location is " + location);
  }
  URI uri=new URI(location);
  if (Validator.isNull(NON_PROXY_HOSTS_PATTERN) || uri.getHost().matches(NON_PROXY_HOSTS_PATTERN)) {
    _hostConfig.setHost(uri);
    _client.setHostConfiguration(_hostConfig);
    _client.setParams(_clientParams);
    _client.setState(_state);
  }
 else   if (Validator.isNotNull(PROXY_HOST) && PROXY_PORT > 0) {
    _proxyHostConfig.setHost(uri);
    _client.setHostConfiguration(_proxyHostConfig);
    _client.setParams(_proxyClientParams);
    _client.setState(_proxyState);
  }
  return _client;
}
