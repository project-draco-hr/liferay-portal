{
  URL url=bundle.getEntry("liferay-marketplace.properties");
  if (url == null) {
    return null;
  }
  List<Bundle> bundles=new ArrayList<>();
  Enumeration<URL> jarEnumeration=bundle.findEntries("/","*.jar",false);
  Enumeration<URL> warEnumeration=bundle.findEntries("/","*.war",false);
  try {
    bundles.addAll(installArtifacts(jarEnumeration,new JarArtifactInstaller(_bundleContext)));
    bundles.addAll(installArtifacts(warEnumeration,new WarArtifactInstaller(_bundleContext)));
    for (    Bundle installedBundle : bundles) {
      installedBundle.start();
    }
    registerAppInMarketplace(url);
  }
 catch (  Exception e) {
    bundles.add(bundle);
    _log.error("Uninstalling bundles " + bundles + " due to: "+ e.getMessage(),e);
    uninstallBundles(bundles);
    return null;
  }
  _installedLpkgFiles.put(bundle.getBundleId(),bundles);
  return bundle;
}
