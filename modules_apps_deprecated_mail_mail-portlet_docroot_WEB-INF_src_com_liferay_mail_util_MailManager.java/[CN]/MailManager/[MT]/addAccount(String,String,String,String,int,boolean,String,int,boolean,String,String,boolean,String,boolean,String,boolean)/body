{
  try {
    Mailbox mailbox=MailboxFactoryUtil.getMailbox(_user.getUserId(),protocol);
    Account account=mailbox.addAccount(address,personalName,protocol,incomingHostName,incomingPort,incomingSecure,outgoingHostName,outgoingPort,outgoingSecure,login,password,savePassword,signature,useSignature,folderPrefix,defaultSender);
    if (!savePassword) {
      _passwordRetriever.setPassword(account.getAccountId(),password);
    }
    mailbox=MailboxFactoryUtil.getMailbox(_user.getUserId(),account.getAccountId(),_passwordRetriever.getPassword(account.getAccountId()));
    mailbox.updateFolders();
    synchronizeAccount(account.getAccountId());
    return createJSONResult("success","account-has-been-created");
  }
 catch (  MailException me) {
    if (me.getType() == MailException.ACCOUNT_ALREADY_EXISTS) {
      return createJSONResult("failure","an-account-with-the-same-address-already-exists");
    }
    _log.error(me,me);
    return createJSONResult("failure","unable-to-add-account");
  }
}
