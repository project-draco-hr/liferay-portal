{
  if (!MapUtil.getBoolean(_parameterMap,PortletDataHandlerKeys.PERMISSIONS)) {
    return;
  }
  List<KeyValuePair> permissions=_permissionsMap.get(getPrimaryKeyString(resourceName,resourcePK));
  if (permissions == null) {
    return;
  }
  Map<Long,String[]> roleIdsToActionIds=new HashMap<>();
  for (  KeyValuePair permission : permissions) {
    String roleName=permission.getKey();
    Role role=null;
    Team team=null;
    if (roleName.startsWith(PermissionExporter.ROLE_TEAM_PREFIX)) {
      roleName=roleName.substring(PermissionExporter.ROLE_TEAM_PREFIX.length());
      try {
        team=TeamLocalServiceUtil.getTeam(_groupId,roleName);
      }
 catch (      NoSuchTeamException nste) {
        if (_log.isWarnEnabled()) {
          _log.warn("Team " + roleName + " does not exist");
        }
        continue;
      }
    }
    try {
      if (team != null) {
        role=RoleLocalServiceUtil.getTeamRole(_companyId,team.getTeamId());
      }
 else {
        role=RoleLocalServiceUtil.getRole(_companyId,roleName);
      }
    }
 catch (    NoSuchRoleException nsre) {
      if (_log.isWarnEnabled()) {
        _log.warn("Role " + roleName + " does not exist");
      }
      continue;
    }
    String[] actionIds=StringUtil.split(permission.getValue());
    roleIdsToActionIds.put(role.getRoleId(),actionIds);
  }
  if (roleIdsToActionIds.isEmpty()) {
    return;
  }
  if (ResourceBlockLocalServiceUtil.isSupported(resourceName)) {
    ResourceBlockLocalServiceUtil.setIndividualScopePermissions(_companyId,_groupId,resourceName,newResourcePK,roleIdsToActionIds);
  }
 else {
    ResourcePermissionLocalServiceUtil.setResourcePermissions(_companyId,resourceName,ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(newResourcePK),roleIdsToActionIds);
  }
}
