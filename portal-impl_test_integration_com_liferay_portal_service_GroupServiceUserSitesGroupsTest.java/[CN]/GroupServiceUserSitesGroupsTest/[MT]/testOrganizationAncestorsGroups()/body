{
  _user=UserTestUtil.addUser();
  Organization parentOrganization=OrganizationTestUtil.addOrganization(true);
  Group parentOrganizationGroup=parentOrganization.getGroup();
  _organizations.addFirst(parentOrganization);
  Organization organization=OrganizationTestUtil.addOrganization(parentOrganization.getOrganizationId(),RandomTestUtil.randomString(),false);
  _organizations.addFirst(organization);
  UserLocalServiceUtil.addOrganizationUsers(organization.getOrganizationId(),new long[]{_user.getUserId()});
  try {
    List<Group> groups=GroupServiceUtil.getUserSitesGroups(_user.getUserId(),null,QueryUtil.ALL_POS);
    Group organizationGroup=organization.getGroup();
    Assert.assertFalse(groups + " contains " + parentOrganizationGroup,groups.contains(parentOrganizationGroup));
    Assert.assertFalse(groups + " contains " + organizationGroup,groups.contains(organizationGroup));
    LayoutTestUtil.addLayout(parentOrganizationGroup);
    groups=GroupServiceUtil.getUserSitesGroups(_user.getUserId(),null,QueryUtil.ALL_POS);
    Assert.assertTrue(groups + " does not contain " + parentOrganizationGroup,groups.contains(parentOrganizationGroup));
    Assert.assertFalse(groups + " contains " + organizationGroup,groups.contains(organizationGroup));
  }
  finally {
    UserLocalServiceUtil.unsetOrganizationUsers(organization.getOrganizationId(),new long[]{_user.getUserId()});
  }
}
