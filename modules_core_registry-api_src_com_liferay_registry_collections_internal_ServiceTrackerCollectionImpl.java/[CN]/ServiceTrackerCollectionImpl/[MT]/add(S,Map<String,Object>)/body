{
  if (service == null) {
    throw new IllegalArgumentException("Service is null");
  }
  properties=new HashMap<String,Object>(properties);
  properties.putAll(_properties);
  if ((_filter != null) && !_filter.matches(properties)) {
    throw new IllegalArgumentException("Filter does not match properties " + properties);
  }
  Registry registry=RegistryUtil.getRegistry();
  ServiceRegistration<S> serviceRegistration=registry.registerService(_clazz,service,properties);
  _serviceRegistrations.put(service,serviceRegistration);
  return true;
}
