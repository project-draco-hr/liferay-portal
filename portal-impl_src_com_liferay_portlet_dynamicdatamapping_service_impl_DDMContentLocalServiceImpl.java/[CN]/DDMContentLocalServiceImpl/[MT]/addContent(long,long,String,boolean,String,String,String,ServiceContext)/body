{
  User user=userPersistence.findByPrimaryKey(serviceContext.getUserId());
  contentKey=contentKey.trim().toUpperCase();
  if (autoContentKey) {
    contentKey=String.valueOf(counterLocalService.increment());
  }
  try {
    xml=DDMXMLUtil.formatXML(xml);
  }
 catch (  Exception e) {
    throw new ContentXmlException();
  }
  Date now=new Date();
  validate(groupId,name,xml,contentKey,autoContentKey);
  long contentId=counterLocalService.increment();
  DDMContent content=ddmContentPersistence.create(contentId);
  content.setUuid(serviceContext.getUuid());
  content.setGroupId(serviceContext.getScopeGroupId());
  content.setCompanyId(user.getCompanyId());
  content.setUserId(user.getUserId());
  content.setUserName(user.getFullName());
  content.setCreateDate(serviceContext.getCreateDate(now));
  content.setModifiedDate(serviceContext.getModifiedDate(now));
  content.setContentKey(contentKey);
  content.setName(name);
  content.setDescription(description);
  content.setXml(xml);
  ddmContentPersistence.update(content,false);
  return content;
}
