{
  User user=userPersistence.findByPrimaryKey(userId);
  try {
    data=DDMXMLUtil.formatXML(data);
  }
 catch (  Exception e) {
    throw new ContentDataException(e);
  }
  Date now=new Date();
  validate(name,data);
  long contentId=counterLocalService.increment();
  DDMContent content=ddmContentPersistence.create(contentId);
  content.setUuid(serviceContext.getUuid());
  content.setGroupId(serviceContext.getScopeGroupId());
  content.setCompanyId(user.getCompanyId());
  content.setUserId(user.getUserId());
  content.setUserName(user.getFullName());
  content.setCreateDate(serviceContext.getCreateDate(now));
  content.setModifiedDate(serviceContext.getModifiedDate(now));
  content.setName(name);
  content.setDescription(description);
  content.setData(data);
  ddmContentPersistence.update(content);
  return content;
}
