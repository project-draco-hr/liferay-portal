{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  try {
    long primaryKey=ParamUtil.getLong(request,getPrimaryKeyParameterName());
    long groupId=ParamUtil.getLong(request,"groupId",themeDisplay.getScopeGroupId());
    if (primaryKey > 0) {
      try {
        long overrideGroupId=getGroupId(primaryKey);
        if (overrideGroupId > 0) {
          groupId=overrideGroupId;
        }
      }
 catch (      Exception e) {
        if (_log.isDebugEnabled()) {
          _log.debug(e,e);
        }
      }
    }
    PortletLayoutFinder portletLayoutFinder=getPortletLayoutFinder();
    PortletLayoutFinder.Result result=portletLayoutFinder.find(themeDisplay,groupId);
    long plid=result.getPlid();
    Layout layout=setTargetLayout(request,groupId,plid);
    LayoutPermissionUtil.check(themeDisplay.getPermissionChecker(),layout,true,ActionKeys.VIEW);
    String portletId=result.getPortletId();
    PortletURL portletURL=PortletURLFactoryUtil.create(request,portletId,layout,PortletRequest.RENDER_PHASE);
    addRequiredParameters(request,portletId,portletURL);
    boolean inheritRedirect=ParamUtil.getBoolean(request,"inheritRedirect");
    String redirect=null;
    if (inheritRedirect) {
      String noSuchEntryRedirect=ParamUtil.getString(request,"noSuchEntryRedirect");
      redirect=HttpUtil.getParameter(noSuchEntryRedirect,"redirect",false);
      redirect=HttpUtil.decodeURL(redirect);
    }
 else {
      redirect=ParamUtil.getString(request,"redirect");
    }
    if (Validator.isNotNull(redirect)) {
      portletURL.setParameter("redirect",redirect);
    }
    setPrimaryKeyParameter(portletURL,primaryKey);
    portletURL.setPortletMode(PortletMode.VIEW);
    portletURL.setWindowState(WindowState.NORMAL);
    portletURL=processPortletURL(request,portletURL);
    response.sendRedirect(portletURL.toString());
  }
 catch (  Exception e) {
    String noSuchEntryRedirect=ParamUtil.getString(request,"noSuchEntryRedirect");
    noSuchEntryRedirect=PortalUtil.escapeRedirect(noSuchEntryRedirect);
    if (Validator.isNotNull(noSuchEntryRedirect) && (e instanceof NoSuchLayoutException || e instanceof PrincipalException)) {
      response.sendRedirect(noSuchEntryRedirect);
    }
 else {
      PortalUtil.sendError(e,request,response);
    }
  }
}
