{
  long userId=context.getUserId(page.getUserUuid());
  long nodeId=MapUtil.getLong(nodePKs,page.getNodeId(),page.getNodeId());
  String[] tagsEntries=null;
  if (context.getBooleanParameter(_NAMESPACE,"tags")) {
    tagsEntries=context.getTagsEntries(WikiPage.class,page.getPrimaryKeyObj());
  }
  WikiPage existingPage=null;
  try {
    WikiNodeUtil.findByPrimaryKey(nodeId);
    if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
      try {
        existingPage=WikiPageFinderUtil.findByUuid_G(page.getUuid(),context.getGroupId());
        existingPage=WikiPageLocalServiceUtil.updatePage(userId,nodeId,existingPage.getTitle(),page.getContent(),page.getFormat(),page.getRedirectTo(),tagsEntries);
      }
 catch (      NoSuchPageException nspe) {
        existingPage=WikiPageLocalServiceUtil.addPage(page.getUuid(),userId,nodeId,page.getTitle(),page.getVersion(),page.getContent(),page.getFormat(),page.getHead(),page.getRedirectTo(),tagsEntries);
      }
    }
 else {
      existingPage=WikiPageLocalServiceUtil.addPage(null,userId,nodeId,page.getTitle(),page.getVersion(),page.getContent(),page.getFormat(),page.getHead(),page.getRedirectTo(),tagsEntries);
    }
    if (context.getBooleanParameter(_NAMESPACE,"comments")) {
      context.importComments(WikiPage.class,new Long(page.getResourcePrimKey()),new Long(existingPage.getResourcePrimKey()),context.getGroupId());
    }
    if (context.getBooleanParameter(_NAMESPACE,"ratings")) {
      context.importRatingsEntries(WikiPage.class,new Long(page.getResourcePrimKey()),new Long(existingPage.getResourcePrimKey()));
    }
  }
 catch (  NoSuchNodeException nsne) {
    _log.error("Could not find the node for page " + page.getPageId());
  }
}
