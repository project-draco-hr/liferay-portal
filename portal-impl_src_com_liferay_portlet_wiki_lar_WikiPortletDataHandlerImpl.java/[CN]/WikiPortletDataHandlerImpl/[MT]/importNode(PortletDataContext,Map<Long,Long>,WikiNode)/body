{
  long userId=context.getUserId(node.getUserUuid());
  long plid=context.getPlid();
  boolean addCommunityPermissions=true;
  boolean addGuestPermissions=true;
  WikiNode existingNode=null;
  if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
    existingNode=WikiNodeUtil.fetchByUUID_G(node.getUuid(),context.getGroupId());
    String nodeName=PropsUtil.get(PropsKeys.WIKI_INITIAL_NODE_NAME);
    if (existingNode == null && node.getName().equals(nodeName)) {
      try {
        WikiNodeUtil.removeByG_N(context.getGroupId(),node.getName());
      }
 catch (      NoSuchNodeException nsne) {
      }
    }
    if (existingNode == null) {
      existingNode=WikiNodeLocalServiceUtil.addNode(node.getUuid(),userId,plid,node.getName(),node.getDescription(),addCommunityPermissions,addGuestPermissions);
    }
 else {
      existingNode=WikiNodeLocalServiceUtil.updateNode(existingNode.getNodeId(),node.getName(),node.getDescription());
    }
  }
 else {
    String nodeName=PropsUtil.get(PropsKeys.WIKI_INITIAL_NODE_NAME);
    if (node.getName().equals(nodeName)) {
      try {
        WikiNodeUtil.removeByG_N(context.getGroupId(),node.getName());
      }
 catch (      NoSuchNodeException nsne) {
      }
    }
    existingNode=WikiNodeLocalServiceUtil.addNode(userId,plid,node.getName(),node.getDescription(),addCommunityPermissions,addGuestPermissions);
  }
  nodePKs.put(node.getNodeId(),existingNode.getNodeId());
}
