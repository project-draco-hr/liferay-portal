{
  if (Validator.isNotNull(_type)) {
    return _type;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  long companyId=themeDisplay.getCompanyId();
  PortletPreferences companyPortletPreferences=PrefsPropsUtil.getPreferences(companyId);
  Group group=themeDisplay.getSiteGroup();
  if (group.isStagingGroup()) {
    group=group.getLiveGroup();
  }
  UnicodeProperties groupTypeSettings=new UnicodeProperties();
  if (group != null) {
    groupTypeSettings=group.getTypeSettingsProperties();
  }
  RatingsType defaultRatingsType=PortletRatingsDefinitionUtil.getDefaultRatingsType(_className);
  if (defaultRatingsType != null) {
    String propertyKey=RatingsDataTransformerUtil.getPropertyKey(_className);
    String companyRatingsType=PrefsParamUtil.getString(companyPortletPreferences,request,propertyKey,defaultRatingsType.getValue());
    String type=PropertiesParamUtil.getString(groupTypeSettings,request,propertyKey,companyRatingsType);
    if (Validator.isNotNull(type)) {
      return type;
    }
  }
  return _DEFAULT_TYPE;
}
