{
  if (Validator.isNotNull(_type)) {
    return _type;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  long companyId=themeDisplay.getCompanyId();
  PortletPreferences companyPortletPreferences=PrefsPropsUtil.getPreferences(companyId);
  Group group=themeDisplay.getSiteGroup();
  if (group.isStagingGroup()) {
    group=group.getLiveGroup();
  }
  UnicodeProperties groupTypeSettings=new UnicodeProperties();
  if (group != null) {
    groupTypeSettings=group.getTypeSettingsProperties();
  }
  Portlet portlet=(Portlet)request.getAttribute(WebKeys.RENDER_PORTLET);
  if (portlet != null) {
    RatingsType defaultRatingsType=PortletRatingsDefinitionUtil.getDefaultRatingsType(portlet.getPortletId(),_className);
    if (defaultRatingsType != null) {
      String propertyKey=RatingsDataTransformerUtil.getPropertyKey(_className);
      String companyRatingsType=PrefsParamUtil.getString(companyPortletPreferences,request,propertyKey,defaultRatingsType.getValue());
      _type=PropertiesParamUtil.getString(groupTypeSettings,request,propertyKey,companyRatingsType);
    }
  }
  if (Validator.isNotNull(_type)) {
    return _type;
  }
  return _DEFAULT_TYPE;
}
