{
  if (Validator.isNull(_type)) {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    long companyId=themeDisplay.getCompanyId();
    PortletPreferences companyPortletPreferences=PrefsPropsUtil.getPreferences(companyId);
    Group group=themeDisplay.getSiteGroup();
    if (group.isStagingGroup()) {
      group=group.getLiveGroup();
    }
    UnicodeProperties groupTypeSettings=new UnicodeProperties();
    if (group != null) {
      groupTypeSettings=group.getTypeSettingsProperties();
    }
    Portlet portlet=(Portlet)request.getAttribute(WebKeys.RENDER_PORTLET);
    if (portlet != null) {
      String propertyName=_className + StringPool.UNDERLINE + "RatingsType";
      String defaultType=RatingsDataTransformerHelperUtil.getDefaultType(portlet.getPortletId(),_className);
      if (Validator.isNotNull(defaultType)) {
        String companyRatingsType=PrefsParamUtil.getString(companyPortletPreferences,request,propertyName,defaultType);
        _type=PropertiesParamUtil.getString(groupTypeSettings,request,propertyName,companyRatingsType);
      }
    }
    if (Validator.isNull(_type)) {
      _type=_DEFAULT_TYPE;
    }
  }
  return _type;
}
