{
  String uid=null;
  if (_pattern == _PATTERN_FRIENDLY) {
    uid=req.getServletPath() + req.getPathInfo();
  }
 else   if (_pattern == _PATTERN_LAYOUT) {
    uid=ParamUtil.getString(req,"p_l_id");
  }
 else   if (_pattern == _PATTERN_RESOURCE) {
    uid=req.getServletPath() + req.getPathInfo() + StringPool.QUESTION+ req.getQueryString();
  }
  String languageId=LanguageUtil.getLanguageId(req);
  boolean isIe=BrowserSniffer.is_ie(req);
  String key=uid + StringPool.POUND + languageId+ isIe;
  return key.trim().toUpperCase();
}
