{
  HttpServletRequest request=(HttpServletRequest)renderRequest.getAttribute(PortletServlet.PORTLET_SERVLET_REQUEST);
  HttpServletResponse response=(HttpServletResponse)renderRequest.getAttribute(PortletServlet.PORTLET_SERVLET_RESPONSE);
  String portletName=getPortletConfig().getPortletName();
  String friendlyURL=(String)request.getAttribute("FRIENDLY_URL");
  int pos=friendlyURL.indexOf(_MAPPING);
  String contextPath=friendlyURL.substring(0,pos + _MAPPING.length()).concat(StringPool.SLASH).concat(portletName);
  pos=friendlyURL.indexOf(portletName);
  String pathInfo=friendlyURL.substring(pos + portletName.length());
  Map<String,String[]> params=new HashMap<String,String[]>(request.getParameterMap());
  params.remove(_APP_URL);
  String queryString=HttpUtil.parameterMapToString(params,false);
  String appUrl=ParamUtil.getString(renderRequest,_APP_URL,StringPool.SLASH);
  if (_connector.equals(CONNECTOR_IFRAME)) {
    request.setAttribute(_APP_URL,renderRequest.getContextPath() + appUrl);
    String iframeExtraHeight=GetterUtil.getString(getPortletConfig().getInitParameter("wai.connector.iframe.height.extra"),"40");
    renderRequest.setAttribute("wai.connector.iframe.height.extra",iframeExtraHeight);
    forward(request,response,_JSP_IFRAME);
  }
 else   if (_connector.equals(CONNECTOR_INCLUDE)) {
    HttpServletRequest waiRequest=new WAIHttpServletRequest(request,contextPath,pathInfo,queryString,params);
    RequestDispatcher requestDispatcher=request.getRequestDispatcher(appUrl);
    try {
      requestDispatcher.forward(waiRequest,response);
    }
 catch (    ServletException se) {
      throw new PortletException(se);
    }
  }
}
