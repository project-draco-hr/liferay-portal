{
  StringBundler sb=new StringBundler(3);
  sb.append(PortletKeys.ASSET_PUBLISHER);
  sb.append(PortletConstants.INSTANCE_SEPARATOR);
  sb.append(StringPool.PERCENT);
  List<com.liferay.portal.model.PortletPreferences> preferencesList=PortletPreferencesLocalServiceUtil.getPortletPreferencesByLikePortletId(sb.toString());
  for (  com.liferay.portal.model.PortletPreferences curPreferences : preferencesList) {
    Layout layout=LayoutLocalServiceUtil.getLayout(curPreferences.getPlid());
    PortletPreferences preferences=PortletPreferencesFactoryUtil.fromXML(layout.getCompanyId(),curPreferences.getOwnerId(),curPreferences.getOwnerType(),curPreferences.getPlid(),curPreferences.getPortletId(),curPreferences.getPreferences());
    if (!getEmailAssetEntryAddedEnabled(preferences)) {
      continue;
    }
    List<AssetEntry> assetEntries=AssetPublisherUtil.getAssetEntries(preferences,layout,layout.getGroupId(),false);
    if (assetEntries.isEmpty()) {
      continue;
    }
    long[] lastNotifiedAssetEntryIds=GetterUtil.getLongValues(preferences.getValues("last-notified-asset-entry-ids",null));
    List<AssetEntry> newAssetEntries=new ArrayList<AssetEntry>();
    for (int i=0; i < assetEntries.size(); i++) {
      AssetEntry assetEntry=assetEntries.get(i);
      long assetEntryId=assetEntry.getEntryId();
      if (!ArrayUtil.contains(lastNotifiedAssetEntryIds,assetEntryId)) {
        newAssetEntries.add(assetEntry);
      }
    }
    notifySubscribers(curPreferences.getPlid(),curPreferences.getPortletId(),newAssetEntries,preferences);
    try {
      preferences.setValues("last-notified-asset-entry-ids",StringUtil.split(ListUtil.toString(assetEntries,AssetEntry.ENTRY_ID_ACCESSOR)));
      preferences.store();
    }
 catch (    Exception e) {
    }
  }
}
