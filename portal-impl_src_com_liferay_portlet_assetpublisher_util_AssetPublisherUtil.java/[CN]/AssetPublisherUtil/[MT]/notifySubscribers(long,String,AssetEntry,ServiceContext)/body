{
  com.liferay.portal.model.PortletPreferences portletPreferences=PortletPreferencesLocalServiceUtil.getPortletPreferences(PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,plid,portletId);
  PortletPreferences preferences=PortletPreferencesFactoryUtil.fromDefaultXML(portletPreferences.getPreferences());
  if (!getEmailAssetEntryAddedEnabled(preferences)) {
    return;
  }
  String fromName=getEmailFromName(preferences,assetEntry.getCompanyId());
  String fromAddress=getEmailFromAddress(preferences,assetEntry.getCompanyId());
  Map<Locale,String> localizedSubjectMap=getEmailAssetEntryAddedSubjectMap(preferences);
  Map<Locale,String> localizedBodyMap=getEmailAssetEntryAddedBodyMap(preferences);
  String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getDefault());
  SubscriptionSender subscriptionSender=new SubscriptionSender();
  subscriptionSender.setCompanyId(assetEntry.getCompanyId());
  String portletSetupTitle=preferences.getValue("portletSetupTitle_" + defaultLanguageId,StringPool.BLANK);
  subscriptionSender.setContextAttributes("[$PORTLET_TITLE$]",portletSetupTitle,"[$ASSET_ENTRIES$]",assetEntry.getTitle(Locale.getDefault()));
  subscriptionSender.setContextUserPrefix("ASSET_PUBLISHER");
  subscriptionSender.setFrom(fromAddress,fromName);
  subscriptionSender.setHtmlFormat(true);
  subscriptionSender.setLocalizedBodyMap(localizedBodyMap);
  subscriptionSender.setLocalizedSubjectMap(localizedSubjectMap);
  subscriptionSender.setMailId("asset_entry",assetEntry.getEntryId());
  subscriptionSender.setPortletId(PortletKeys.ASSET_PUBLISHER);
  subscriptionSender.setReplyToAddress(fromAddress);
  subscriptionSender.setScopeGroupId(assetEntry.getGroupId());
  subscriptionSender.setServiceContext(serviceContext);
  subscriptionSender.setUserId(assetEntry.getUserId());
  subscriptionSender.addPersistedSubscribers(com.liferay.portal.model.PortletPreferences.class.getName(),portletPreferences.getPortletPreferencesId());
  subscriptionSender.flushNotificationsAsync();
}
