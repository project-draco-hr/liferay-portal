{
  List<Permission> permissions=permissionPersistence.findByResourceId(resourceId);
  permissions=ListUtil.copy(permissions);
  Set<String> actionIdsSet=new HashSet<String>();
  for (  Permission permission : permissions) {
    actionIdsSet.add(permission.getActionId());
  }
  for (  String actionId : actionIds) {
    if (actionIdsSet.contains(actionId)) {
      continue;
    }
    long permissionId=counterLocalService.increment(Permission.class.getName());
    Permission permission=permissionPersistence.create(permissionId);
    permission.setCompanyId(companyId);
    permission.setActionId(actionId);
    permission.setResourceId(resourceId);
    try {
      permissionPersistence.update(permission,false);
    }
 catch (    SystemException se) {
      if (_log.isWarnEnabled()) {
        _log.warn("Add failed, fetch {actionId=" + actionId + ", resourceId="+ resourceId+ "}");
      }
      permission=permissionPersistence.fetchByA_R(actionId,resourceId,false);
      if (permission == null) {
        throw se;
      }
    }
    permissions.add(permission);
  }
  return permissions;
}
