{
  boolean flushEnabled=PermissionThreadLocal.isFlushEnabled();
  PermissionThreadLocal.setIndexEnabled(false);
  try {
    for (    Map.Entry<Long,String[]> entry : roleIdsToActionIds.entrySet()) {
      long roleId=entry.getKey();
      String[] actionIds=entry.getValue();
      List<Permission> permissions=permissionFinder.findByR_R(roleId,resourceId);
      rolePersistence.removePermissions(roleId,permissions);
      permissions=getPermissions(companyId,actionIds,resourceId);
      rolePersistence.addPermissions(roleId,permissions);
    }
  }
  finally {
    PermissionThreadLocal.setIndexEnabled(flushEnabled);
    PermissionCacheUtil.clearCache();
    SearchEngineUtil.updatePermissionFields(resourceId);
  }
}
