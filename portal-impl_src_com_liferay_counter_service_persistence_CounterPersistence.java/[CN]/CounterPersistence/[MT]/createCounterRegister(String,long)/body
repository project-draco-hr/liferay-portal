{
  long rangeMin=0;
  long rangeMax=0;
  Session session=null;
  try {
    session=new SessionImpl(_hibernateSessionFactory.openSession(_connection));
    Counter counter=(Counter)session.get(Counter.class,name,LockMode.UPGRADE);
    if (counter == null) {
      rangeMin=_DEFAULT_CURRENT_ID;
      counter=new Counter();
      counter.setName(name);
    }
 else {
      rangeMin=counter.getCurrentId();
    }
    if (size >= _DEFAULT_CURRENT_ID) {
      rangeMin=size;
    }
    rangeMax=rangeMin + _COUNTER_INCREMENT;
    counter.setCurrentId(rangeMax);
    session.save(counter);
    session.flush();
  }
  finally {
    session.close();
  }
  CounterRegister register=new CounterRegister(name,rangeMin,rangeMax,_COUNTER_INCREMENT);
  return register;
}
