{
  CounterRegister register=getCounterRegister(oldName);
synchronized (register) {
    if (_registerLookup.containsKey(newName)) {
      throw new SystemException("Cannot rename " + oldName + " to "+ newName);
    }
    Session session=null;
    try {
      session=new SessionImpl(_sessionFactory.openSession(_connection));
      Counter counter=(Counter)session.load(Counter.class,oldName);
      long currentId=counter.getCurrentId();
      session.delete(counter);
      counter=new Counter();
      counter.setName(newName);
      counter.setCurrentId(currentId);
      session.save(counter);
      session.flush();
    }
 catch (    ObjectNotFoundException onfe) {
    }
catch (    Exception e) {
      throw processException(e);
    }
 finally {
      session.close();
    }
    register.setName(newName);
    _registerLookup.put(newName,register);
    _registerLookup.remove(oldName);
  }
}
