{
  CounterHolder holder=register.getCounterHolder();
  long newValue=holder.addAndGet(size);
  if (newValue > holder.getRangeMax()) {
    CompeteLatch latch=register.getCompeteLatch();
    if (latch.compete()) {
      Connection con=null;
      PreparedStatement psQuery=null;
      PreparedStatement psUpdate=null;
      ResultSet rs=null;
      try {
        holder=register.getCounterHolder();
        newValue=holder.addAndGet(size);
        if (newValue > holder.getRangeMax()) {
          con=getConnection();
          psQuery=con.prepareStatement(_SQL_SELECT_ID_BY_NAME);
          psQuery.setString(1,register.getName());
          rs=psQuery.executeQuery();
          rs.next();
          long currentId=0;
          currentId=rs.getLong(1);
          newValue=currentId + 1;
          long rangeMax=currentId + register.getRangeSize();
          psUpdate=con.prepareStatement(_SQL_UPDATE_ID_BY_NAME);
          psUpdate.setLong(1,rangeMax);
          psUpdate.setString(2,register.getName());
          psUpdate.executeUpdate();
          register.setCounterHoler(new CounterHolder(newValue,rangeMax));
        }
      }
 catch (      Exception e) {
        throw processException(e);
      }
 finally {
        DataAccess.cleanUp(psUpdate);
        DataAccess.cleanUp(con,psQuery,rs);
        latch.done();
      }
    }
 else {
      latch.await();
      newValue=competeIncrement(register,size);
    }
  }
  return newValue;
}
