{
  String name=field.getName();
  if (!field.isLocalized()) {
    String[] values=field.getValues();
    List<String> valuesList=new ArrayList<String>(values.length);
    for (    String value : values) {
      if (Validator.isNull(value)) {
        continue;
      }
      valuesList.add(value.trim());
    }
    if (valuesList.isEmpty()) {
      return;
    }
    values=valuesList.toArray(new String[valuesList.size()]);
    doAddField(xContentBuilder,field,name,values);
    if (field.isSortable()) {
      String sortFieldName=DocumentImpl.getSortableFieldName(name);
      doAddField(xContentBuilder,field,sortFieldName,values);
    }
  }
 else {
    Map<Locale,String> localizedValues=field.getLocalizedValues();
    for (    Map.Entry<Locale,String> entry : localizedValues.entrySet()) {
      String value=entry.getValue();
      if (Validator.isNull(value)) {
        continue;
      }
      Locale locale=entry.getKey();
      String languageId=LocaleUtil.toLanguageId(locale);
      String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getDefault());
      value=value.trim();
      if (languageId.equals(defaultLanguageId)) {
        doAddField(xContentBuilder,field,name,value);
      }
      String localizedName=DocumentImpl.getLocalizedName(languageId,name);
      doAddField(xContentBuilder,field,localizedName,value);
      if (field.isSortable()) {
        String sortableFieldName=DocumentImpl.getSortableFieldName(localizedName);
        doAddField(xContentBuilder,field,sortableFieldName,value);
      }
    }
  }
}
