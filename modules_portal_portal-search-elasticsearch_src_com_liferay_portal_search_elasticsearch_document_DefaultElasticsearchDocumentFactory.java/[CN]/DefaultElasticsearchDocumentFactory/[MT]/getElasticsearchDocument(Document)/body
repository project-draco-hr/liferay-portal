{
  XContentBuilder xContentBuilder=XContentFactory.jsonBuilder();
  xContentBuilder.startObject();
  Map<String,Field> fields=document.getFields();
  for (  Field field : fields.values()) {
    String name=field.getName();
    if (!field.isLocalized()) {
      String[] values=field.getValues();
      List<String> valuesList=new ArrayList<String>(values.length);
      for (      String value : values) {
        if (Validator.isNull(value)) {
          continue;
        }
        valuesList.add(value.trim());
      }
      if (valuesList.isEmpty()) {
        continue;
      }
      xContentBuilder.field(name,field.getValues());
    }
 else {
      Map<Locale,String> localizedValues=field.getLocalizedValues();
      for (      Map.Entry<Locale,String> entry : localizedValues.entrySet()) {
        String value=entry.getValue();
        if (Validator.isNull(value)) {
          continue;
        }
        Locale locale=entry.getKey();
        String languageId=LocaleUtil.toLanguageId(locale);
        String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getDefault());
        if (languageId.equals(defaultLanguageId)) {
          xContentBuilder.field(name,value.trim());
        }
        String localizedName=DocumentImpl.getLocalizedName(languageId,name);
        xContentBuilder.field(localizedName,value.trim());
      }
    }
  }
  xContentBuilder.endObject();
  return xContentBuilder.string();
}
