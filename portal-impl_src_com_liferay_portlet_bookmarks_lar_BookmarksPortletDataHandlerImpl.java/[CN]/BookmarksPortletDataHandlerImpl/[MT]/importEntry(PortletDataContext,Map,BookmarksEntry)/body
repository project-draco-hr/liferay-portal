{
  Long folderId=(Long)folderPKs.get(new Long(entry.getFolderId()));
  boolean newParentFolder=false;
  if (folderId == null) {
    folderId=new Long(entry.getFolderId());
  }
 else {
    newParentFolder=true;
  }
  String[] tagsEntries=context.getTagsEntries(BookmarksEntry.class,entry.getPrimaryKeyObj());
  try {
    if (folderId.longValue() != BookmarksFolderImpl.DEFAULT_PARENT_FOLDER_ID) {
      BookmarksFolderUtil.findByPrimaryKey(folderId.longValue());
    }
    if ((BookmarksEntryUtil.fetchByPrimaryKey(entry.getPrimaryKey()) == null) || newParentFolder) {
      boolean addCommunityPermissions=true;
      boolean addGuestPermissions=true;
      BookmarksEntryLocalServiceUtil.addEntry(entry.getUserId(),folderId.longValue(),entry.getName(),entry.getUrl(),entry.getComments(),tagsEntries,addCommunityPermissions,addGuestPermissions);
    }
 else {
      entry.setFolderId(folderId.longValue());
      TagsAssetLocalServiceUtil.updateAsset(entry.getUserId(),entry.getFolder().getGroupId(),BookmarksEntry.class.getName(),entry.getPrimaryKey(),tagsEntries);
      BookmarksEntryUtil.update(entry,true);
    }
  }
 catch (  NoSuchFolderException nsfe) {
    _log.error("Could not find the parent folder for entry " + entry.getEntryId());
  }
}
