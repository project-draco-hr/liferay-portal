{
  BookmarksFolder existingFolder=BookmarksFolderUtil.fetchByPrimaryKey(folder.getPrimaryKey());
  if ((existingFolder == null) || (existingFolder.getGroupId() != context.getGroupId())) {
    Long newParentFolderId=(Long)folderPKs.get(new Long(folder.getParentFolderId()));
    if (newParentFolderId == null) {
      _log.error("Could not find the parent folder for " + folder.getFolderId());
      newParentFolderId=new Long(folder.getParentFolderId());
    }
    long plid=context.getPlid();
    boolean addCommunityPermissions=true;
    boolean addGuestPermissions=true;
    BookmarksFolder newFolder=BookmarksFolderLocalServiceUtil.addFolder(folder.getUserId(),plid,newParentFolderId.longValue(),folder.getName(),folder.getDescription(),addCommunityPermissions,addGuestPermissions);
    folderPKs.put(folder.getPrimaryKeyObj(),newFolder.getPrimaryKeyObj());
  }
 else {
    BookmarksFolderUtil.update(folder,true);
    folderPKs.put(folder.getPrimaryKeyObj(),folder.getPrimaryKeyObj());
  }
}
