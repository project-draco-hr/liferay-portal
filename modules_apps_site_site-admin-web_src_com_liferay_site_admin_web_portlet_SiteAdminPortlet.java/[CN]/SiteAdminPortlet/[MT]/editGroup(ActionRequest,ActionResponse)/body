{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Callable<Group> groupCallable=new GroupCallable(actionRequest);
  Group group=TransactionInvokerUtil.invoke(_transactionAttribute,groupCallable);
  String redirect=ParamUtil.getString(actionRequest,"redirect");
  long liveGroupId=ParamUtil.getLong(actionRequest,"liveGroupId");
  if (liveGroupId <= 0) {
    PortletURL siteAdministrationURL=PortalUtil.getControlPanelPortletURL(actionRequest,group,SiteAdminPortletKeys.SITE_SETTINGS,0,PortletRequest.RENDER_PHASE);
    String controlPanelURL=HttpUtil.setParameter(themeDisplay.getURLControlPanel(),"p_p_id",SiteAdminPortletKeys.SITE_ADMIN);
    controlPanelURL=HttpUtil.setParameter(controlPanelURL,"controlPanelCategory",themeDisplay.getControlPanelCategory());
    siteAdministrationURL.setParameter("redirect",controlPanelURL);
    redirect=siteAdministrationURL.toString();
    hideDefaultSuccessMessage(actionRequest);
    MultiSessionMessages.add(actionRequest,SiteAdminPortletKeys.SITE_SETTINGS + "requestProcessed");
  }
 else {
    long newRefererPlid=getRefererPlid(group,themeDisplay.getScopeGroupId(),redirect);
    redirect=HttpUtil.setParameter(redirect,"doAsGroupId",group.getGroupId());
    redirect=HttpUtil.setParameter(redirect,"refererPlid",newRefererPlid);
  }
  actionRequest.setAttribute(WebKeys.REDIRECT,redirect);
  sendRedirect(actionRequest,actionResponse);
}
