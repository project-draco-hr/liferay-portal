{
  Date now=new Date();
  long ddmStructureVersionId=counterLocalService.increment();
  long ddmStructureId=ddmStructure.getPrimaryKey();
  DDMStructureVersion ddmStructureVersion=ddmStructureVersionPersistence.create(ddmStructureVersionId);
  ddmStructureVersion.setGroupId(ddmStructure.getGroupId());
  ddmStructureVersion.setCompanyId(ddmStructure.getCompanyId());
  ddmStructureVersion.setUserId(ddmStructure.getUserId());
  ddmStructureVersion.setUserName(ddmStructure.getUserName());
  ddmStructureVersion.setCreateDate(serviceContext.getCreateDate(now));
  ddmStructureVersion.setDdmStructureId(ddmStructureId);
  ddmStructureVersion.setName(ddmStructure.getName());
  ddmStructureVersion.setDefinition(ddmStructure.getDefinition());
  ddmStructureVersion.setDescription(ddmStructure.getDescription());
  ddmStructureVersion.setStorageType(ddmStructure.getStorageType());
  ddmStructureVersion.setType(ddmStructure.getType());
  String version=_VERSION_DEFAULT;
  DDMStructureVersion latestVersion=getLatestVersion(ddmStructureId);
  if (latestVersion != null) {
    version=nextVersion(latestVersion.getVersion(),majorVersion);
  }
  ddmStructureVersion.setVersion(version);
  ddmStructureVersionPersistence.update(ddmStructureVersion);
  ddmStructure.setVersion(version);
  return ddmStructureVersion;
}
