{
  if (!socialActivitySettingLocalService.isEnabled(activity.getGroupId(),activity.getClassNameId())) {
    return;
  }
  if (!socialActivitySettingLocalService.isEnabled(activity.getGroupId(),activity.getClassNameId(),activity.getClassPK())) {
    return;
  }
  User user=userPersistence.findByPrimaryKey(activity.getUserId());
  SocialActivityDefinition activityDefinition=socialActivitySettingLocalService.getActivityDefinition(activity.getGroupId(),activity.getClassName(),activity.getType());
  if ((activityDefinition == null) || !activityDefinition.isEnabled()) {
    return;
  }
  SocialActivityProcessor activityProcessor=activityDefinition.getActivityProcessor();
  if (activityProcessor != null) {
    activityProcessor.processActivity(activity);
  }
  AssetEntry assetEntry=activity.getAssetEntry();
  User assetEntryUser=userPersistence.findByPrimaryKey(assetEntry.getUserId());
  for (  SocialActivityCounterDefinition activityCounterDefinition : activityDefinition.getActivityCounterDefinitions()) {
    if (addActivityCounter(user,assetEntryUser,activityCounterDefinition) && checkActivityLimit(user,activity,activityCounterDefinition)) {
      incrementActivityCounter(activity.getGroupId(),user,activity.getAssetEntry(),activityCounterDefinition);
    }
  }
  for (  SocialAchievement achievement : activityDefinition.getAchievements()) {
    achievement.processActivity(activity);
  }
  if (!user.isDefaultUser() && user.isActive()) {
    incrementActivityCounter(activity.getGroupId(),PortalUtil.getClassNameId(User.class.getName()),activity.getUserId(),SocialActivityCounterConstants.NAME_USER_ACTIVITIES,SocialActivityCounterConstants.TYPE_ACTOR,1,SocialActivityCounterConstants.PERIOD_LENGTH_SYSTEM);
  }
  if (!assetEntryUser.isDefaultUser() && assetEntryUser.isActive()) {
    incrementActivityCounter(activity.getGroupId(),activity.getClassNameId(),activity.getClassPK(),SocialActivityCounterConstants.NAME_ASSET_ACTIVITIES,SocialActivityCounterConstants.TYPE_ASSET,1,SocialActivityCounterConstants.PERIOD_LENGTH_SYSTEM);
  }
}
