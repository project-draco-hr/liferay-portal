{
  if (!socialActivitySettingLocalService.isEnabled(activity.getGroupId(),activity.getClassNameId())) {
    return;
  }
  if (!socialActivitySettingLocalService.isEnabled(activity.getGroupId(),activity.getClassNameId(),activity.getClassPK())) {
    return;
  }
  User user=userPersistence.findByPrimaryKey(activity.getUserId());
  SocialActivityDefinition activityDefinition=socialActivitySettingLocalService.getActivityDefinition(activity.getGroupId(),activity.getClassName(),activity.getType());
  if ((activityDefinition == null) || !activityDefinition.isCountersEnabled()) {
    return;
  }
  SocialActivityProcessor activityProcessor=activityDefinition.getActivityProcessor();
  if (activityProcessor != null) {
    activityProcessor.processActivity(activity);
  }
  AssetEntry assetEntry=activity.getAssetEntry();
  User assetEntryUser=userPersistence.findByPrimaryKey(assetEntry.getUserId());
  List<SocialActivityCounter> activityCounters=new ArrayList<SocialActivityCounter>();
  for (  SocialActivityCounterDefinition activityCounterDefinition : activityDefinition.getActivityCounterDefinitions()) {
    if (addActivityCounter(user,assetEntryUser,activityCounterDefinition)) {
      SocialActivityCounter activityCounter=getActivityCounter(activity.getGroupId(),user,activity,activityCounterDefinition);
      activityCounters.add(activityCounter);
    }
  }
  SocialActivityCounter assetActivitiesCounter=null;
  SocialActivityCounter userActivitiesCounter=null;
  if (!user.isDefaultUser() && user.isActive()) {
    userActivitiesCounter=getUserActivitiesCounter(activity);
  }
  if (!assetEntryUser.isDefaultUser() && assetEntryUser.isActive()) {
    assetActivitiesCounter=getAssetActivitiesCounter(activity);
  }
  for (  SocialActivityCounter activityCounter : activityCounters) {
    SocialActivityCounterDefinition activityCounterDefinition=activityDefinition.getActivityCounterDefinition(activityCounter.getName());
    if (checkActivityLimit(user,activity,activityCounterDefinition)) {
      incrementActivityCounter(activityCounter,activityCounterDefinition);
    }
  }
  if (assetActivitiesCounter != null) {
    incrementActivityCounter(assetActivitiesCounter,_assetActivitiesActivityCounterDefinition);
  }
  if (userActivitiesCounter != null) {
    incrementActivityCounter(userActivitiesCounter,_userActivitiesActivityCounterDefinition);
  }
  for (  SocialAchievement achievement : activityDefinition.getAchievements()) {
    achievement.processActivity(activity);
  }
}
