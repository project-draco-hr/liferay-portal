{
  SocialActivityCounter activityCounter=null;
  if (previousActivityCounterId != 0) {
    activityCounter=socialActivityCounterPersistence.findByPrimaryKey(previousActivityCounterId);
    if (periodLength == SocialActivityCounterConstants.PERIOD_LENGTH_SYSTEM) {
      activityCounter.setEndPeriod(SocialCounterPeriodUtil.getStartPeriod() - 1);
    }
 else {
      activityCounter.setEndPeriod(activityCounter.getStartPeriod() + periodLength - 1);
    }
    socialActivityCounterPersistence.update(activityCounter,false);
  }
  activityCounter=socialActivityCounterPersistence.fetchByG_C_C_N_O_E(groupId,classNameId,classPK,name,ownerType,endPeriod,false);
  if (activityCounter != null) {
    return activityCounter;
  }
  Group group=groupPersistence.findByPrimaryKey(groupId);
  long activityCounterId=counterLocalService.increment();
  activityCounter=socialActivityCounterPersistence.create(activityCounterId);
  activityCounter.setGroupId(groupId);
  activityCounter.setCompanyId(group.getCompanyId());
  activityCounter.setClassNameId(classNameId);
  activityCounter.setClassPK(classPK);
  activityCounter.setName(name);
  activityCounter.setOwnerType(ownerType);
  activityCounter.setCurrentValue(currentValue);
  activityCounter.setTotalValue(totalValue);
  activityCounter.setStartPeriod(startPeriod);
  activityCounter.setEndPeriod(endPeriod);
  socialActivityCounterPersistence.update(activityCounter,false);
  return activityCounter;
}
