{
  if (assetEntry == null) {
    return;
  }
  SocialActivityCounter latestPopularityActivityCounter=fetchLatestActivityCounter(assetEntry.getGroupId(),assetEntry.getClassNameId(),assetEntry.getClassPK(),SocialActivityCounterConstants.NAME_POPULARITY,SocialActivityCounterConstants.TYPE_ASSET);
  if ((latestPopularityActivityCounter == null) || (enable && latestPopularityActivityCounter.isActive()) || (!enable && !latestPopularityActivityCounter.isActive())) {
    return;
  }
  int factor=-1;
  if (enable) {
    factor=1;
  }
  SocialActivityCounter latestContributionActivityCounter=fetchLatestActivityCounter(assetEntry.getGroupId(),PortalUtil.getClassNameId(User.class.getName()),assetEntry.getUserId(),SocialActivityCounterConstants.NAME_CONTRIBUTION,SocialActivityCounterConstants.TYPE_CREATOR);
  if (latestContributionActivityCounter == null) {
    return;
  }
  int startPeriod=SocialCounterPeriodUtil.getStartPeriod();
  if (latestContributionActivityCounter.getStartPeriod() != startPeriod) {
    latestContributionActivityCounter=addActivityCounter(latestContributionActivityCounter.getGroupId(),latestContributionActivityCounter.getClassNameId(),latestContributionActivityCounter.getClassPK(),latestContributionActivityCounter.getName(),latestContributionActivityCounter.getOwnerType(),0,latestContributionActivityCounter.getTotalValue(),SocialCounterPeriodUtil.getStartPeriod(),SocialActivityCounterConstants.END_PERIOD_UNDEFINED,latestContributionActivityCounter.getActivityCounterId(),SocialActivityCounterConstants.PERIOD_LENGTH_SYSTEM);
  }
  if (latestPopularityActivityCounter.getStartPeriod() == startPeriod) {
    latestContributionActivityCounter.setCurrentValue(latestContributionActivityCounter.getCurrentValue() + (latestPopularityActivityCounter.getCurrentValue() * factor));
  }
  latestContributionActivityCounter.setTotalValue(latestContributionActivityCounter.getTotalValue() + (latestPopularityActivityCounter.getTotalValue() * factor));
  socialActivityCounterPersistence.update(latestContributionActivityCounter,false);
}
