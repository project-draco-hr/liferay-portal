{
  String lockKey=getLockKey(groupId,classNameId,classPK,name,ownerType);
  LockProtectedAction<SocialActivityCounter> lockProtectedAction=new LockProtectedAction<SocialActivityCounter>(SocialActivityCounter.class,lockKey,PropsValues.SOCIAL_ACTIVITY_COUNTER_LOCK_TIMEOUT,PropsValues.SOCIAL_ACTIVITY_COUNTER_LOCK_RETRY_DELAY){
    @Override protected SocialActivityCounter performProtectedAction() throws PortalException, SystemException {
      DB db=DBFactoryUtil.getDB();
      String dbType=db.getType();
      if (dbType.equals(DB.TYPE_HYPERSONIC)) {
        return addActivityCounter(groupId,classNameId,classPK,name,ownerType,totalValue,previousActivityCounterId,periodLength);
      }
 else {
        return socialActivityCounterLocalService.addActivityCounter(groupId,classNameId,classPK,name,ownerType,totalValue,previousActivityCounterId,periodLength);
      }
    }
  }
;
  lockProtectedAction.performAction();
  return lockProtectedAction.getReturnValue();
}
