{
  String payPalEmailAddress=HttpUtil.encodeURL(preferences.getPayPalEmailAddress());
  NumberFormat doubleFormat=NumberFormat.getNumberInstance(LocaleUtil.ENGLISH);
  doubleFormat.setMaximumFractionDigits(2);
  doubleFormat.setMinimumFractionDigits(2);
  String amount=doubleFormat.format(total);
  returnURL=HttpUtil.encodeURL(returnURL);
  notifyURL=HttpUtil.encodeURL(notifyURL);
  String firstName=HttpUtil.encodeURL(order.getBillingFirstName());
  String lastName=HttpUtil.encodeURL(order.getBillingLastName());
  String address1=HttpUtil.encodeURL(order.getBillingStreet());
  String city=HttpUtil.encodeURL(order.getBillingCity());
  String state=HttpUtil.encodeURL(order.getBillingState());
  String zip=HttpUtil.encodeURL(order.getBillingZip());
  String currencyCode=preferences.getCurrencyId();
  StringBundler sb=new StringBundler(45);
  sb.append("https://www.paypal.com/cgi-bin/webscr?");
  sb.append("cmd=_xclick&");
  sb.append("business=").append(payPalEmailAddress).append("&");
  sb.append("item_name=").append(order.getNumber()).append("&");
  sb.append("item_number=").append(order.getNumber()).append("&");
  sb.append("invoice=").append(order.getNumber()).append("&");
  sb.append("amount=").append(amount).append("&");
  sb.append("return=").append(returnURL).append("&");
  sb.append("notify_url=").append(notifyURL).append("&");
  sb.append("first_name=").append(firstName).append("&");
  sb.append("last_name=").append(lastName).append("&");
  sb.append("address1=").append(address1).append("&");
  sb.append("city=").append(city).append("&");
  sb.append("state=").append(state).append("&");
  sb.append("zip=").append(zip).append("&");
  sb.append("no_note=1&");
  sb.append("currency_code=").append(currencyCode).append("");
  return sb.toString();
}
