{
  Checker checker=new Checker();
  ClassLoader classLoader=CheckStyleUtil.class.getClassLoader();
  checker.setModuleClassLoader(classLoader);
  FilterSet filterSet=SuppressionsLoader.loadSuppressions(new InputSource(classLoader.getResourceAsStream("checkstyle-suppressions.xml")));
  checker.addFilter(filterSet);
  Configuration configuration=ConfigurationLoader.loadConfiguration(new InputSource(classLoader.getResourceAsStream("checkstyle.xml")),new PropertiesExpander(System.getProperties()),false);
  checker.configure(configuration);
  AuditListener listener=new SourceFormatterLogger(new UnsyncByteArrayOutputStream(),true,baseDirAbsolutePath);
  checker.addListener(listener);
  return checker;
}
