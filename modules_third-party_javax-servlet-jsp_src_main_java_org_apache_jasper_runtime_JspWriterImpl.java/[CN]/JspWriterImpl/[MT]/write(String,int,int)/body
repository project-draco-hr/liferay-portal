{
  ensureOpen();
  if (bufferSize == 0) {
    initOut();
    out.write(s,off,len);
    return;
  }
  int b=off, t=off + len;
  while (b < t) {
    int d=min(getRemaining(),t - b);
    s.getChars(b,b + d,buf.buf,buf.pos);
    b+=d;
    buf.pos+=d;
    if (getRemaining() == 0)     if (autoFlush)     flushBuffer();
 else     bufferOverflow();
  }
}
