{
  HttpServletRequest request=PortalUtil.getHttpServletRequest(portletRequest);
  template.prepare(request);
  template.put("fullTemplatesPath",servletContextName.concat(TemplateConstants.SERVLET_SEPARATOR));
  ServletConfig servletConfig=(ServletConfig)portletRequest.getAttribute(PortletServlet.PORTLET_SERVLET_CONFIG);
  PortletServlet portletServlet=new PortletServlet();
  portletServlet.init(servletConfig);
  ServletContextHashModel servletContextHashModel=new ServletContextHashModel(portletServlet,ObjectWrapper.DEFAULT_WRAPPER);
  template.put("Application",servletContextHashModel);
  ServletContext servletContext=ServletContextPool.get(servletContextName);
  TemplateHashModel taglibsFactory=FreeMarkerTaglibFactoryUtil.createTaglibFactory(servletContext);
  template.put("PortletJspTagLibs",taglibsFactory);
  HttpServletRequestWrapper httpServletRequestWrapper=new HttpServletRequestWrapper(PortalUtil.getHttpServletRequest(portletRequest));
  HttpServletResponseWrapper httpServletResponseWrapper=new HttpServletResponseWrapper(PortalUtil.getHttpServletResponse(portletResponse));
  HttpRequestHashModel httpRequestHashModel=new HttpRequestHashModel(httpServletRequestWrapper,httpServletResponseWrapper,ObjectWrapper.DEFAULT_WRAPPER);
  template.put("Request",httpRequestHashModel);
}
