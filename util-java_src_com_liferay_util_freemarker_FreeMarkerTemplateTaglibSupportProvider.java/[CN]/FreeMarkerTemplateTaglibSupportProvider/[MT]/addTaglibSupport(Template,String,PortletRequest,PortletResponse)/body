{
  HttpServletRequest request=PortalUtil.getHttpServletRequest(portletRequest);
  template.prepare(request);
  template.put("fullTemplatesPath",servletContextName.concat(TemplateConstants.SERVLET_SEPARATOR));
  ServletContext servletContext=ServletContextPool.get(servletContextName);
  GenericServlet genericServlet=new JSPSupportServlet(servletContext);
  ServletContextHashModel servletContextHashModel=new ServletContextHashModel(genericServlet,ObjectWrapper.DEFAULT_WRAPPER);
  template.put("Application",servletContextHashModel);
  TemplateHashModel taglibsFactory=FreeMarkerTaglibFactoryUtil.createTaglibFactory(servletContext);
  template.put("PortletJspTagLibs",taglibsFactory);
  HttpServletRequestWrapper httpServletRequestWrapper=new HttpServletRequestWrapper(PortalUtil.getHttpServletRequest(portletRequest));
  HttpServletResponseWrapper httpServletResponseWrapper=new HttpServletResponseWrapper(PortalUtil.getHttpServletResponse(portletResponse));
  HttpRequestHashModel httpRequestHashModel=new HttpRequestHashModel(httpServletRequestWrapper,httpServletResponseWrapper,ObjectWrapper.DEFAULT_WRAPPER);
  template.put("Request",httpRequestHashModel);
}
