{
  if (message.getBoolean(MessagingProxy.LOCAL_MESSAGE)) {
    destination.send(message);
    return;
  }
  message.setDestinationName(getName());
  MessageRoutingBag messageRoutingBag=(MessageRoutingBag)message.get(MessageRoutingBag.MESSAGE_ROUTING_BAG);
  if (messageRoutingBag == null) {
    messageRoutingBag=new MessageRoutingBag(message,true);
    message.put(MessageRoutingBag.MESSAGE_ROUTING_BAG,messageRoutingBag);
  }
  sendMessageRoutingBag(messageRoutingBag);
  try {
    Message responseMessage=messageRoutingBag.getMessage();
    responseMessage.copyTo(message);
    messageRoutingBag.setMessage(message);
  }
 catch (  ClassNotFoundException cnfe) {
    throw new RuntimeException(cnfe);
  }
  Set<MessageListener> messageListeners=destination.getMessageListeners();
  for (  MessageListener messageListener : messageListeners) {
    try {
      messageListener.receive(message);
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
  }
}
