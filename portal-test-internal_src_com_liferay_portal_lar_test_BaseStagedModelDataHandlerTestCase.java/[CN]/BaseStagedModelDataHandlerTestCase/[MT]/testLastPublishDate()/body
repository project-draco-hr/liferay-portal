{
  if (!supportLastPublishDateUpdate()) {
    return;
  }
  Map<String,List<StagedModel>> dependentStagedModelsMap=new HashMap<>();
  StagedModel stagedModel=addStagedModel(stagingGroup,dependentStagedModelsMap);
  Assert.assertNull(stagedModel.getLastPublishDate());
  initExport();
  Map<String,String[]> parameterMap=portletDataContext.getParameterMap();
  parameterMap.put(PortletDataHandlerKeys.UPDATE_LAST_PUBLISH_DATE,new String[]{Boolean.TRUE.toString()});
  try {
    ExportImportThreadLocal.setPortletStagingInProcess(true);
    StagedModelDataHandlerUtil.exportStagedModel(portletDataContext,stagedModel);
  }
  finally {
    ExportImportThreadLocal.setPortletStagingInProcess(false);
  }
  Assert.assertEquals(portletDataContext.getEndDate(),stagedModel.getLastPublishDate());
  Date originalLastPublishDate=stagedModel.getLastPublishDate();
  parameterMap.put(PortletDataHandlerKeys.UPDATE_LAST_PUBLISH_DATE,new String[]{Boolean.TRUE.toString()});
  try {
    ExportImportThreadLocal.setPortletStagingInProcess(true);
    StagedModelDataHandlerUtil.exportStagedModel(portletDataContext,stagedModel);
  }
  finally {
    ExportImportThreadLocal.setPortletStagingInProcess(false);
  }
  Assert.assertEquals(originalLastPublishDate,stagedModel.getLastPublishDate());
}
