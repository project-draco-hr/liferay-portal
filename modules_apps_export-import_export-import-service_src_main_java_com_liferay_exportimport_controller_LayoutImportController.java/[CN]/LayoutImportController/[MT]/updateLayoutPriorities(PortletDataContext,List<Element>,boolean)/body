{
  Map<Long,Layout> layouts=(Map<Long,Layout>)portletDataContext.getNewPrimaryKeysMap(Layout.class + ".layout");
  Map<Long,Integer> layoutPriorities=new HashMap<>();
  int maxPriority=Integer.MIN_VALUE;
  for (  Element layoutElement : layoutElements) {
    String action=layoutElement.attributeValue(Constants.ACTION);
    if (action.equals(Constants.SKIP)) {
      return;
    }
    if (action.equals(Constants.ADD)) {
      long layoutId=GetterUtil.getLong(layoutElement.attributeValue("layout-id"));
      Layout layout=layouts.get(layoutId);
      if (layout == null) {
        continue;
      }
      int layoutPriority=GetterUtil.getInteger(layoutElement.attributeValue("layout-priority"));
      layoutPriorities.put(layout.getPlid(),layoutPriority);
      if (maxPriority < layoutPriority) {
        maxPriority=layoutPriority;
      }
    }
  }
  List<Layout> layoutSetLayouts=_layoutLocalService.getLayouts(portletDataContext.getGroupId(),privateLayout);
  for (  Layout layout : layoutSetLayouts) {
    if (layoutPriorities.containsKey(layout.getPlid())) {
      layout.setPriority(layoutPriorities.get(layout.getPlid()));
    }
 else {
      layout.setPriority(++maxPriority);
    }
    _layoutLocalService.updateLayout(layout);
  }
}
