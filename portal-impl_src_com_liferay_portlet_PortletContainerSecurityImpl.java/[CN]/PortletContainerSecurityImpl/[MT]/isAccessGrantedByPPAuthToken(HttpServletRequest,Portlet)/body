{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String portletId=portlet.getPortletId();
  if (!portlet.isAddDefaultResource()) {
    return false;
  }
  if (!PropsValues.PORTLET_ADD_DEFAULT_RESOURCE_CHECK_ENABLED) {
    return true;
  }
  if (_whitelist.contains(portletId)) {
    return true;
  }
  String namespace=PortalUtil.getPortletNamespace(portletId);
  String strutsAction=ParamUtil.getString(request,namespace + "struts_action");
  if (Validator.isNull(strutsAction)) {
    strutsAction=ParamUtil.getString(request,"struts_action");
  }
  if (_whitelistActions.contains(strutsAction)) {
    return true;
  }
  String requestPortletAuthenticationToken=ParamUtil.getString(request,"p_p_auth");
  if (Validator.isNull(requestPortletAuthenticationToken)) {
    HttpServletRequest originalRequest=PortalUtil.getOriginalServletRequest(request);
    requestPortletAuthenticationToken=ParamUtil.getString(originalRequest,"p_p_auth");
  }
  if (Validator.isNotNull(requestPortletAuthenticationToken)) {
    String actualPortletAuthenticationToken=AuthTokenUtil.getToken(request,themeDisplay.getPlid(),portletId);
    if (requestPortletAuthenticationToken.equals(actualPortletAuthenticationToken)) {
      return true;
    }
  }
  return false;
}
