{
  _servletContext=servletContext;
  _request=request;
  _response=response;
  _themeDisplay=(ThemeDisplay)_request.getAttribute(WebKeys.THEME_DISPLAY);
  _portletsMap=new TreeMap<Portlet,Object[]>(new PortletRenderWeightComparator());
  _parallelRenderEnable=PropsValues.LAYOUT_PARALLEL_RENDER_ENABLE;
  if (_parallelRenderEnable) {
    if (PropsValues.SESSION_DISABLED) {
      if (_log.isWarnEnabled()) {
        _log.warn("Parallel rendering should be disabled if sessions " + "are disabled");
      }
    }
  }
  if (_parallelRenderEnable) {
    Boolean portletParallelRender=(Boolean)request.getAttribute(WebKeys.PORTLET_PARALLEL_RENDER);
    if ((portletParallelRender != null) && (portletParallelRender.booleanValue() == false)) {
      _parallelRenderEnable=false;
    }
  }
 else {
    request.removeAttribute(WebKeys.PORTLET_PARALLEL_RENDER);
  }
}
