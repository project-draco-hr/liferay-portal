{
  SimpleChain requestSimpleChain=new SimpleChain();
  Handler logHandler=new LogHandler();
  if (PortletPropsValues.SOAP_DEBUG) {
    requestSimpleChain.addHandler(logHandler);
  }
  if (Validator.isNotNull(userToken)) {
    Handler wsDoAllSenderHandler=new WSDoAllSender();
    wsDoAllSenderHandler.setOption(WSHandlerConstants.ACTION,"UsernameToken");
    wsDoAllSenderHandler.setOption(WSHandlerConstants.MUST_UNDERSTAND,"false");
    wsDoAllSenderHandler.setOption(UsernameToken.PASSWORD_TYPE,WSConstants.PW_NONE);
    wsDoAllSenderHandler.setOption(WSHandlerConstants.PW_CALLBACK_CLASS,PasswordCallback.class.getName());
    wsDoAllSenderHandler.setOption(WSHandlerConstants.USER,userToken);
    requestSimpleChain.addHandler(wsDoAllSenderHandler);
  }
  SimpleChain responseSimpleChain=new SimpleChain();
  if (PortletPropsValues.SOAP_DEBUG) {
    responseSimpleChain.addHandler(logHandler);
  }
  SimpleProvider simpleProvider=new SimpleProvider();
  HTTPSender httpSender=new WSRPHTTPSender(forwardCookies,forwardHeaders);
  simpleProvider.deployTransport(HTTPTransport.DEFAULT_TRANSPORT_NAME,new SimpleTargetedChain(requestSimpleChain,httpSender,responseSimpleChain));
  return simpleProvider;
}
