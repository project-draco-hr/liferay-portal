{
  long groupId=layout.getGroupId();
  try {
    LayoutTypePortlet importedLayoutType=(LayoutTypePortlet)importedLayout.getLayoutType();
    List<String> importedPortletIds=importedLayoutType.getPortletIds();
    layout.setGroupId(importedLayout.getGroupId());
    LayoutTypePortlet layoutType=(LayoutTypePortlet)layout.getLayoutType();
    List<String> sourcePortletIds=layoutType.getPortletIds();
    for (    String portletId : sourcePortletIds) {
      boolean importPortletSetup=false;
      try {
        boolean[] importControls=ExportImportHelperUtil.getImportPortletControls(portletDataContext.getCompanyId(),portletId,portletDataContext.getParameterMap(),null);
        importPortletSetup=importControls[2];
      }
 catch (      Exception e) {
      }
      if (!importPortletSetup && !importedPortletIds.contains(portletId)) {
        removePortletFromLayoutType(portletId,layoutType);
      }
    }
    importedPortletIds.removeAll(layoutType.getPortletIds());
    if (!importedPortletIds.isEmpty()) {
      PortletLocalServiceUtil.deletePortlets(importedLayout.getCompanyId(),importedPortletIds.toArray(new String[importedPortletIds.size()]),importedLayout.getPlid());
    }
    importedLayout.setTypeSettingsProperties(layoutType.getTypeSettingsProperties());
  }
  finally {
    layout.setGroupId(groupId);
  }
}
