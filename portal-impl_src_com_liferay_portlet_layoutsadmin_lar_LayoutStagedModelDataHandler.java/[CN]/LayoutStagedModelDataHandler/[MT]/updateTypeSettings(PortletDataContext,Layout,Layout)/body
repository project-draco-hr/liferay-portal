{
  long groupId=layout.getGroupId();
  try {
    LayoutTypePortlet importedLayoutType=(LayoutTypePortlet)importedLayout.getLayoutType();
    List<String> importedPortletIds=importedLayoutType.getPortletIds();
    layout.setGroupId(importedLayout.getGroupId());
    LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
    List<String> sourcePortletIds=layoutTypePortlet.getPortletIds();
    for (    String portletId : sourcePortletIds) {
      boolean importPortletSetup=false;
      try {
        boolean[] importPortletControls=ExportImportHelperUtil.getImportPortletControls(portletDataContext.getCompanyId(),portletId,portletDataContext.getParameterMap(),null);
        importPortletSetup=importPortletControls[2];
      }
 catch (      Exception e) {
      }
      if (!importPortletSetup && !importedPortletIds.contains(portletId)) {
        removePortletFromLayoutTypePortlet(portletId,layoutTypePortlet);
      }
    }
    importedPortletIds.removeAll(layoutTypePortlet.getPortletIds());
    if (!importedPortletIds.isEmpty()) {
      PortletLocalServiceUtil.deletePortlets(importedLayout.getCompanyId(),importedPortletIds.toArray(new String[importedPortletIds.size()]),importedLayout.getPlid());
    }
    importedLayout.setTypeSettingsProperties(layoutTypePortlet.getTypeSettingsProperties());
  }
  finally {
    layout.setGroupId(groupId);
  }
}
