{
  DefaultHttpClient httpClient=new DefaultHttpClient();
  try {
    String serverURL=LICENSE_SERVER_URL;
    if (!serverURL.endsWith(StringPool.SLASH)) {
      serverURL+=StringPool.SLASH;
    }
    serverURL+="osb-portlet/license";
    URI uri=new URI(serverURL);
    HttpPost httpPost=new HttpPost(uri);
    if (Validator.isNotNull(_PROXY_URL)) {
      if (_log.isInfoEnabled()) {
        _log.info("Using proxy " + _PROXY_URL + StringPool.COLON+ _PROXY_PORT);
      }
      HttpHost proxyHost=new HttpHost(_PROXY_URL,_PROXY_PORT);
      HttpParams httpParams=httpClient.getParams();
      httpParams.setParameter(ConnRoutePNames.DEFAULT_PROXY,proxyHost);
      if (Validator.isNotNull(_PROXY_USER_NAME)) {
        CredentialsProvider credentialsProvider=httpClient.getCredentialsProvider();
        credentialsProvider.setCredentials(new AuthScope(_PROXY_URL,_PROXY_PORT),new UsernamePasswordCredentials(_PROXY_USER_NAME,_PROXY_PASSWORD));
      }
    }
    ByteArrayEntity requestEntity=new ByteArrayEntity(_encryptRequest(serverURL,request));
    requestEntity.setContentType("application/json");
    httpPost.setEntity(requestEntity);
    HttpResponse httpResponse=httpClient.execute(httpPost);
    HttpEntity responseEntity=httpResponse.getEntity();
    String response=_decryptResponse(serverURL,responseEntity.getContent());
    if (_log.isDebugEnabled()) {
      _log.debug("Server response: " + response);
    }
    if (Validator.isNull(response)) {
      throw new Exception("Server response is null");
    }
    return response;
  }
  finally {
    ClientConnectionManager connectionManager=httpClient.getConnectionManager();
    connectionManager.shutdown();
  }
}
