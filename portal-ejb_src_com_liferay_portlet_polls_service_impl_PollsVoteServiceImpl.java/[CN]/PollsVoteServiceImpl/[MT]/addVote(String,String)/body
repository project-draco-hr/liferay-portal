{
  long userId=0;
  try {
    userId=getUserId();
  }
 catch (  PrincipalException pe) {
    userId=CounterLocalServiceUtil.increment(PollsQuestion.class.getName() + ".anonymous");
  }
  PollsQuestion question=PollsQuestionUtil.findByPrimaryKey(questionId);
  if (question.isExpired()) {
    throw new QuestionExpiredException();
  }
  PollsQuestionPermission.check(getPermissionChecker(),question,ActionKeys.ADD_VOTE);
  return PollsVoteLocalServiceUtil.addVote(userId,questionId,choiceId);
}
