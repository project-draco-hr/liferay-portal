{
  super(((Portlet)request.getAttribute(WebKeys.SPI_AGENT_PORTLET)).getContextName());
  Cookie[] cookies=request.getCookies();
  if (cookies != null) {
    cookiesBytes=new byte[cookies.length][];
    for (int i=0; i < cookies.length; i++) {
      cookiesBytes[i]=CookieUtil.serialize(cookies[i]);
    }
  }
  distributedRequestAttributes=extractDistributedRequestAttributes(request,Direction.REQUEST);
  headerMap=extractRequestHeaders(request);
  parameterMap=new HashMap<>(request.getParameterMap());
  remoteAddr=request.getRemoteAddr();
  remoteHost=request.getRemoteHost();
  remotePort=request.getRemotePort();
  remoteUser=request.getRemoteUser();
  serverName=request.getServerName();
  serverPort=request.getServerPort();
  String contentType=request.getContentType();
  if ((contentType != null) && contentType.startsWith(ContentTypes.MULTIPART)) {
    HttpServletRequest currentRequest=request;
    UploadServletRequest uploadServletRequest=null;
    while (currentRequest instanceof HttpServletRequestWrapper) {
      if (currentRequest instanceof UploadServletRequest) {
        uploadServletRequest=(UploadServletRequest)currentRequest;
        break;
      }
      HttpServletRequestWrapper httpServletRequestWrapper=(HttpServletRequestWrapper)currentRequest;
      currentRequest=(HttpServletRequest)httpServletRequestWrapper.getRequest();
    }
    if (uploadServletRequest == null) {
      this.contentType=contentType;
      requestBodyFile=FileUtil.createTempFile();
      StreamUtil.transfer(StreamUtil.uncloseable(currentRequest.getInputStream()),new FileOutputStream(requestBodyFile));
      uploadServletRequest=new UploadServletRequestImpl(new AgentHttpServletRequestWrapper(currentRequest));
    }
    Map<String,FileItem[]> multipartParameterMap=uploadServletRequest.getMultipartParameterMap();
    Map<String,List<String>> regularParameterMap=uploadServletRequest.getRegularParameterMap();
    if (!multipartParameterMap.isEmpty()) {
      this.multipartParameterMap=multipartParameterMap;
    }
    if (!regularParameterMap.isEmpty()) {
      this.regularParameterMap=regularParameterMap;
    }
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if ((themeDisplay != null) && themeDisplay.isAjax()) {
    parameterMap=new HashMap<>(parameterMap);
    parameterMap.put("portalResiliencyPortletShowFooter",new String[]{StringPool.FALSE});
  }
  originalSessionAttributes=extractSessionAttributes(request);
  captureThreadLocals();
}
