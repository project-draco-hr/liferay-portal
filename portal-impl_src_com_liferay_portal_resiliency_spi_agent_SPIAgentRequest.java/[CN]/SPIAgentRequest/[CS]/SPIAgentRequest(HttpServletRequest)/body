{
  cookies=request.getCookies();
  distributedRequestAttributes=extractDistributedRequestAttributes(request,Direction.REQUEST);
  headerMap=extractRequestHeaders(request);
  parameterMap=request.getParameterMap();
  serverName=request.getServerName();
  serverPort=request.getServerPort();
  String contentType=request.getContentType();
  if ((contentType != null) && contentType.startsWith(ContentTypes.MULTIPART)) {
    UploadServletRequest uploadServletRequest=null;
    while (request instanceof HttpServletRequestWrapper) {
      if (request instanceof UploadServletRequest) {
        uploadServletRequest=(UploadServletRequest)request;
        break;
      }
      HttpServletRequestWrapper httpServletRequestWrapper=(HttpServletRequestWrapper)request;
      request=(HttpServletRequest)httpServletRequestWrapper.getRequest();
    }
    if (uploadServletRequest == null) {
      this.contentType=contentType;
      requestBodyFile=FileUtil.createTempFile();
      FileOutputStream fileOutputStream=new FileOutputStream(requestBodyFile);
      try {
        StreamUtil.transfer(request.getInputStream(),fileOutputStream,false);
      }
  finally {
        fileOutputStream.close();
      }
    }
 else {
      Map<String,FileItem[]> multipartParameterMap=uploadServletRequest.getMultipartParameterMap();
      Map<String,List<String>> regularParameterMap=uploadServletRequest.getRegularParameterMap();
      if (!multipartParameterMap.isEmpty()) {
        this.multipartParameterMap=multipartParameterMap;
      }
      if (!regularParameterMap.isEmpty()) {
        this.regularParameterMap=regularParameterMap;
      }
    }
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if ((themeDisplay != null) && themeDisplay.isAjax()) {
    parameterMap=new HashMap<String,String[]>(parameterMap);
    parameterMap.put("portalResiliencyPortletShowFooter",new String[]{StringPool.FALSE});
  }
  HttpSession session=request.getSession();
  originalSessionAttributes=extractSessionAttributes(session);
  captureThreadLocals();
}
