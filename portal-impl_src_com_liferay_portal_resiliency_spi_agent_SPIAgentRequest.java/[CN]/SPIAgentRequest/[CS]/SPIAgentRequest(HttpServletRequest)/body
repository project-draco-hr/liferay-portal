{
  cookies=request.getCookies();
  distributedRequestAttributes=extractDistributedRequestAttributes(request,Direction.REQUEST);
  headerMap=extractRequestHeaders(request);
  parameterMap=request.getParameterMap();
  serverName=request.getServerName();
  serverPort=request.getServerPort();
  String contentType=request.getHeader(HttpHeaders.CONTENT_TYPE);
  if ((contentType != null) && contentType.startsWith(ContentTypes.MULTIPART_FORM_DATA)) {
    UploadServletRequest uploadServletRequest=PortalUtil.getUploadServletRequest(request);
    Map<String,FileItem[]> multipartParameterMap=uploadServletRequest.getMultipartParameterMap();
    Map<String,List<String>> regularParameterMap=uploadServletRequest.getRegularParameterMap();
    if (!multipartParameterMap.isEmpty()) {
      this.multipartParameterMap=multipartParameterMap;
    }
    if (!regularParameterMap.isEmpty()) {
      this.regularParameterMap=regularParameterMap;
    }
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if ((themeDisplay != null) && themeDisplay.isAjax()) {
    parameterMap=new HashMap<String,String[]>(parameterMap);
    parameterMap.put("portalResiliencyPortletShowFooter",new String[]{StringPool.FALSE});
  }
  HttpSession session=request.getSession();
  originalSessionAttributes=extractSessionAttributes(session);
  captureThreadLocals();
}
