{
  HttpServletRequest request=(HttpServletRequest)servletRequest;
  String uri=getURI(request);
  HttpServletResponse response=(HttpServletResponse)servletResponse;
  String requestURL=getURL(request);
  if (requestURL.length() > _invokerFilterURIMaxLength) {
    response.sendError(HttpServletResponse.SC_REQUEST_URI_TOO_LONG);
    if (_log.isWarnEnabled()) {
      StringBundler sb=new StringBundler(7);
      sb.append("Rejected ");
      sb.append(StringUtil.shorten(uri,_invokerFilterURIMaxLength));
      sb.append(" because it has more than ");
      sb.append(_invokerFilterURIMaxLength);
      sb.append(" characters");
      _log.warn(sb.toString());
    }
    return;
  }
  request=handleNonSerializableRequest(request);
  response=HttpOnlyCookieServletResponse.getHttpOnlyCookieServletResponse(response);
  response=secureResponseHeaders(request,response);
  request.setAttribute(WebKeys.INVOKER_FILTER_URI,uri);
  try {
    InvokerFilterChain invokerFilterChain=getInvokerFilterChain(request,uri,filterChain);
    Thread currentThread=Thread.currentThread();
    ClassLoader contextClassLoader=currentThread.getContextClassLoader();
    invokerFilterChain.setContextClassLoader(contextClassLoader);
    invokerFilterChain.doFilter(request,response);
  }
  finally {
    request.removeAttribute(WebKeys.INVOKER_FILTER_URI);
  }
}
