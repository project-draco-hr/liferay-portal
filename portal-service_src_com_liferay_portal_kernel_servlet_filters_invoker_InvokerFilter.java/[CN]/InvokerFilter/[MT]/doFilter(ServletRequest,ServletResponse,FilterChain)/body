{
  HttpServletRequest request=(HttpServletRequest)servletRequest;
  String uri=getURI(request);
  HttpServletResponse response=(HttpServletResponse)servletResponse;
  String requestURL=getURL(request);
  if (requestURL.length() > _invokerFilterURILengthHardLimit) {
    response.sendError(HttpServletResponse.SC_REQUEST_URI_TOO_LONG);
    if (_log.isWarnEnabled()) {
      StringBundler sb=new StringBundler(7);
      sb.append("Request uri=\"");
      sb.append(StringUtil.shorten(uri,_invokerFilterURILengthHardLimit));
      sb.append("\",len=");
      sb.append(uri.length());
      sb.append(" was rejected, because it was longer than ");
      sb.append(_invokerFilterURILengthHardLimit);
      sb.append(" characters.");
      _log.warn(sb.toString());
    }
    return;
  }
  request=handleNonSerializableRequest(request);
  if (ServletVersionDetector.is3_0()) {
    response=HttpOnlyCookieServletResponse.getHttpOnlyCookieServletResponse(response);
  }
  response=secureResponseHeaders(request,response);
  request.setAttribute(WebKeys.INVOKER_FILTER_URI,uri);
  try {
    InvokerFilterChain invokerFilterChain=getInvokerFilterChain(request,uri,filterChain);
    Thread currentThread=Thread.currentThread();
    ClassLoader contextClassLoader=currentThread.getContextClassLoader();
    invokerFilterChain.setContextClassLoader(contextClassLoader);
    invokerFilterChain.doFilter(request,response);
  }
  finally {
    request.removeAttribute(WebKeys.INVOKER_FILTER_URI);
  }
}
