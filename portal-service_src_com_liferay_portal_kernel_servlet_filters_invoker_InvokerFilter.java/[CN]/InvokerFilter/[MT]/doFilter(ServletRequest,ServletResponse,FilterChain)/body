{
  HttpServletRequest request=(HttpServletRequest)servletRequest;
  String uri=getURI(request);
  request=handleNonSerializableRequest(request);
  HttpServletResponse response=(HttpServletResponse)servletResponse;
  if (ServletVersionDetector.is3_0()) {
    response=new HttpOnlyCookieServletResponse(response);
  }
  response=secureResponseHeaders(request,response);
  request.setAttribute(WebKeys.INVOKER_FILTER_URI,uri);
  try {
    InvokerFilterChain invokerFilterChain=getInvokerFilterChain(request,uri,filterChain);
    Thread currentThread=Thread.currentThread();
    ClassLoader contextClassLoader=currentThread.getContextClassLoader();
    invokerFilterChain.setContextClassLoader(contextClassLoader);
    invokerFilterChain.doFilter(request,response);
  }
  finally {
    request.removeAttribute(WebKeys.INVOKER_FILTER_URI);
  }
}
