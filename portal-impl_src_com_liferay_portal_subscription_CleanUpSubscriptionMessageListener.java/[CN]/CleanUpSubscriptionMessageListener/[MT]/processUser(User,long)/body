{
  List<Group> groups=user.getMySiteGroups(true,QueryUtil.ALL_POS);
  long[] groupIds=getGroupIds(groups);
  List<Subscription> subscriptions=SubscriptionLocalServiceUtil.getUserSubscriptions(user.getUserId(),QueryUtil.ALL_POS,QueryUtil.ALL_POS,null);
  for (  Subscription subscription : subscriptions) {
    try {
      processSubscription(subscription,groupId,groupIds);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        StringBundler sb=new StringBundler(9);
        sb.append("Subscription was not removed for {className=");
        sb.append(subscription.getClassName());
        sb.append(", classPK=");
        sb.append(subscription.getClassPK());
        sb.append(", userId=");
        sb.append(subscription.getUserId());
        sb.append(", groupId=");
        sb.append(groupId);
        sb.append("}");
        _log.warn(sb.toString());
      }
    }
  }
}
