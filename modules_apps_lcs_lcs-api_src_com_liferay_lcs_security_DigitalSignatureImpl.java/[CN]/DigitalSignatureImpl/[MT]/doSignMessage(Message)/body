{
  if (!(message instanceof CommandMessage)) {
    return;
  }
  CommandMessage commandMessage=(CommandMessage)message;
  Signature signature=Signature.getInstance(_signingAlgorithm,_algorithmProvider);
  KeyStore.ProtectionParameter protectionParameter=new KeyStore.PasswordProtection(_keyStorePassword.toCharArray());
  KeyStore keyStore=getKeyStore();
  KeyStore.PrivateKeyEntry privateKeyEntry=(KeyStore.PrivateKeyEntry)keyStore.getEntry(_keyAlias,protectionParameter);
  signature.initSign(privateKeyEntry.getPrivateKey());
  signature.update(getBytes(commandMessage));
  Map<String,Object> values=commandMessage.getValues();
  values.put(Message.KEY_SIGNATURE,DatatypeConverter.printBase64Binary(signature.sign()));
}
