{
  if (_log.isDebugEnabled()) {
    _log.debug("Begin initializing company with web id " + webId);
  }
  long companyId=0;
  try {
    Company company=CompanyLocalServiceUtil.checkCompany(webId);
    companyId=company.getCompanyId();
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  CompanyThreadLocal.setCompanyId(companyId);
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize display");
  }
  try {
    String xml=HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-display.xml"));
    PortletCategory portletCategory=(PortletCategory)WebAppPool.get(String.valueOf(companyId),WebKeys.PORTLET_CATEGORY);
    if (portletCategory == null) {
      portletCategory=new PortletCategory();
    }
    PortletCategory newPortletCategory=PortletLocalServiceUtil.getEARDisplay(xml);
    portletCategory.merge(newPortletCategory);
    WebAppPool.put(String.valueOf(companyId),WebKeys.PORTLET_CATEGORY,portletCategory);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Check journal content search");
  }
  if (GetterUtil.getBoolean(PropsUtil.get(PropsKeys.JOURNAL_SYNC_CONTENT_SEARCH_ON_STARTUP))) {
    try {
      JournalContentSearchLocalServiceUtil.checkContentSearches(companyId);
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
  try {
    if (PortalLDAPUtil.isImportOnStartup(companyId)) {
      PortalLDAPUtil.importFromLDAP(companyId);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Message resources");
  }
  MultiMessageResources messageResources=(MultiMessageResources)servletContext.getAttribute(Globals.MESSAGES_KEY);
  messageResources.setServletContext(servletContext);
  WebAppPool.put(String.valueOf(companyId),Globals.MESSAGES_KEY,messageResources);
  WebAppPool.put(String.valueOf(companyId),WebKeys.LANGUAGE_RESOURCES,new LanguageResources(messageResources));
  if (_log.isDebugEnabled()) {
    _log.debug("Process application startup events");
  }
  try {
    EventsProcessor.process(PropsKeys.APPLICATION_STARTUP_EVENTS,PropsValues.APPLICATION_STARTUP_EVENTS,new String[]{String.valueOf(companyId)});
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("End initializing company with web id " + webId + " and company id "+ companyId);
  }
  addCompanyId(companyId);
  return companyId;
}
