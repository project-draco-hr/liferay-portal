{
  String[] credentials=null;
  try {
    long companyId=PortalUtil.getCompanyId(request);
    if (!PrefsPropsUtil.getBoolean(companyId,PropsKeys.OPEN_SSO_AUTH_ENABLED,PropsValues.OPEN_SSO_AUTH_ENABLED)) {
      return credentials;
    }
    String serviceUrl=PrefsPropsUtil.getString(companyId,PropsKeys.OPEN_SSO_SERVICE_URL);
    if (!OpenSSOUtil.isAuthenticated(request,serviceUrl)) {
      return credentials;
    }
    String screenNameAttr=PrefsPropsUtil.getString(companyId,PropsKeys.OPEN_SSO_SCREEN_NAME_ATTR,PropsValues.OPEN_SSO_SCREEN_NAME_ATTR);
    String emailAddressAttr=PrefsPropsUtil.getString(companyId,PropsKeys.OPEN_SSO_EMAIL_ADDRESS_ATTR,PropsValues.OPEN_SSO_EMAIL_ADDRESS_ATTR);
    String firstNameAttr=PrefsPropsUtil.getString(companyId,PropsKeys.OPEN_SSO_FIRST_NAME_ATTR,PropsValues.OPEN_SSO_FIRST_NAME_ATTR);
    String lastNameAttr=PrefsPropsUtil.getString(companyId,PropsKeys.OPEN_SSO_LAST_NAME_ATTR,PropsValues.OPEN_SSO_LAST_NAME_ATTR);
    Map<String,String> nameValues=OpenSSOUtil.getAttributes(request,serviceUrl);
    String screenName=nameValues.get(screenNameAttr);
    String emailAddress=nameValues.get(emailAddressAttr);
    String firstName=nameValues.get(firstNameAttr);
    if (emailAddress == null || emailAddress.equals(StringPool.BLANK)) {
      throw new AutoLoginException("Email address cannot be null or empty");
    }
    String lastName=nameValues.get(lastNameAttr);
    User user=null;
    try {
      user=UserLocalServiceUtil.getUserByScreenName(companyId,screenName);
    }
 catch (    NoSuchUserException nsue) {
      ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
      Locale locale=LocaleUtil.getDefault();
      if (themeDisplay != null) {
        locale=themeDisplay.getLocale();
      }
      user=addUser(companyId,firstName,lastName,emailAddress,screenName,locale);
    }
    credentials=new String[3];
    credentials[0]=String.valueOf(user.getUserId());
    credentials[1]=user.getPassword();
    credentials[2]=Boolean.TRUE.toString();
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  return credentials;
}
