{
  List<AppDisplay> appDisplays=new ArrayList<>();
  Set<Bundle> removeBundles=new HashSet<>();
  List<App> apps=null;
  if (Validator.isNotNull(category)) {
    apps=_appLocalService.getApps(category);
  }
 else {
    apps=_appLocalService.getApps(QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  }
  for (  App app : apps) {
    AppDisplay appDisplay=createMarketplaceAppDisplay(bundlesMap,app);
    appDisplays.add(appDisplay);
    removeBundles.addAll(appDisplay.getBundles());
  }
  for (  Bundle bundle : removeBundles) {
    bundlesMap.removeBundle(bundle);
  }
  return appDisplays;
}
