{
  Registry registry=RegistryUtil.getRegistry();
  _serviceReferences.remove(serviceReference);
  ServiceReference<S> peek=_serviceReferences.peek();
  if (peek != null) {
    try {
      _service=registry.getService(peek);
    }
 catch (    IllegalStateException ise) {
      _service=null;
      _serviceReferences.clear();
    }
  }
 else {
    _service=null;
  }
}
