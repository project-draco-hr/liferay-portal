{
  if (expectedLogs != null) {
    try {
      for (      LoggingEvent loggingEvent : captureAppender.getLoggingEvents()) {
        String renderedMessage=loggingEvent.getRenderedMessage();
        if (!isExpected(expectedLogs,renderedMessage)) {
          Assert.fail(renderedMessage);
        }
      }
    }
  finally {
      captureAppender.close();
    }
  }
  _thread=null;
  try {
    for (    Map.Entry<Thread,Error> entry : _concurrentFailures.entrySet()) {
      Thread thread=entry.getKey();
      Error error=entry.getValue();
      Assert.fail("Thread " + thread + " caught concurrent failure: "+ error);
      throw error;
    }
  }
  finally {
    _concurrentFailures.clear();
  }
}
