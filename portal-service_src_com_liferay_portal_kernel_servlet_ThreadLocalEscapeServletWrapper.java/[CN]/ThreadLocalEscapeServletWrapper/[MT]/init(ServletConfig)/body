{
  String className=servletConfig.getInitParameter("class-name");
  if (className == null) {
    throw new IllegalArgumentException("class-name init parameter is missing.");
  }
  try {
    Class<?> servletClass=Thread.currentThread().getContextClassLoader().loadClass(className);
    if (!Servlet.class.isAssignableFrom(servletClass)) {
      throw new ServletException(className + " is not a sub class of javax.servlet.Servlet");
    }
    _servlet=(Servlet)servletClass.newInstance();
  }
 catch (  ClassNotFoundException cnfe) {
    throw new ServletException("Unable to load decorating servlet class",cnfe);
  }
catch (  Exception e) {
    throw new ServletException("Fail to create an instance for " + className,e);
  }
  InitThread initThread=new InitThread(servletConfig);
  initThread.start();
  try {
    initThread.join();
  }
 catch (  InterruptedException ie) {
    throw new ServletException("Interrupted in initialization",ie);
  }
  Throwable t=initThread.getInitializeThrowable();
  if (t != null) {
    if (t instanceof ServletException) {
      throw (ServletException)t;
    }
 else {
      throw new ServletException("Error occured during initialization",t);
    }
  }
}
