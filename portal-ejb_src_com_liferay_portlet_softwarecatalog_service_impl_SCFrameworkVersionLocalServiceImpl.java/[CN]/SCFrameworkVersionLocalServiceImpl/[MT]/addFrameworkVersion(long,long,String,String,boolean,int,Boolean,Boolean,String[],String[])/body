{
  User user=UserUtil.findByPrimaryKey(userId);
  long groupId=PortalUtil.getPortletGroupId(plid);
  Date now=new Date();
  validate(name);
  long frameworkVersionId=CounterLocalServiceUtil.increment();
  SCFrameworkVersion frameworkVersion=SCFrameworkVersionUtil.create(frameworkVersionId);
  frameworkVersion.setGroupId(groupId);
  frameworkVersion.setCompanyId(user.getCompanyId());
  frameworkVersion.setUserId(user.getUserId());
  frameworkVersion.setUserName(user.getFullName());
  frameworkVersion.setCreateDate(now);
  frameworkVersion.setModifiedDate(now);
  frameworkVersion.setName(name);
  frameworkVersion.setUrl(url);
  frameworkVersion.setActive(active);
  frameworkVersion.setPriority(priority);
  SCFrameworkVersionUtil.update(frameworkVersion);
  if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
    addFrameworkVersionResources(frameworkVersion,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
  }
 else {
    addFrameworkVersionResources(frameworkVersion,communityPermissions,guestPermissions);
  }
  return frameworkVersion;
}
