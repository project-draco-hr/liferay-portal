{
  VirtualHost virtualHost=virtualHostPersistence.fetchByC_L(companyId,layoutSetId);
  if (virtualHost == null) {
    long virtualHostId=counterLocalService.increment();
    virtualHost=virtualHostPersistence.create(virtualHostId);
    virtualHost.setCompanyId(companyId);
    virtualHost.setLayoutSetId(layoutSetId);
  }
  virtualHost.setHostname(hostname);
  virtualHostPersistence.update(virtualHost);
  Company company=companyPersistence.fetchByPrimaryKey(companyId);
  if (company != null) {
    companyPersistence.clearCache(company);
  }
  LayoutSet layoutSet=layoutSetPersistence.fetchByPrimaryKey(layoutSetId);
  if ((layoutSet == null) && Validator.isNotNull(PropsValues.VIRTUAL_HOSTS_DEFAULT_SITE_NAME)) {
    Group group=groupPersistence.fetchByC_N(companyId,PropsValues.VIRTUAL_HOSTS_DEFAULT_SITE_NAME);
    if (group != null) {
      layoutSet=layoutSetPersistence.fetchByG_P(group.getGroupId(),false);
    }
  }
  if (layoutSet != null) {
    layoutSetPersistence.clearCache(layoutSet);
  }
  return virtualHost;
}
