{
  String parentFolderPath=sharepointRequest.getRootPath();
  long groupId=getGroupId(parentFolderPath);
  DLFolder folder=null;
  DLFileEntry entry=null;
  try {
    long parentFolderId=getLastFolderId(groupId,parentFolderPath,DLFolderImpl.DEFAULT_PARENT_FOLDER_ID);
    folder=DLFolderServiceUtil.getFolder(parentFolderId);
  }
 catch (  Exception e1) {
    if (e1 instanceof NoSuchFolderException) {
      try {
        entry=getFileEntry(sharepointRequest);
      }
 catch (      Exception e2) {
      }
    }
  }
  Tree movedDocsTree=new Tree();
  Tree movedDirsTree=new Tree();
  String newPath=sharepointRequest.getParameterValue("newUrl");
  String newParentFolderPath=getParentFolderPath(newPath);
  long newGroupId=getGroupId(newParentFolderPath);
  long newParentFolderId=getLastFolderId(newGroupId,newParentFolderPath,DLFolderImpl.DEFAULT_PARENT_FOLDER_ID);
  String newName=getResourceName(newPath);
  if (entry != null) {
    long folderId=entry.getFolderId();
    String name=entry.getName();
    String description=entry.getDescription();
    String[] tagsEntries=TagsEntryLocalServiceUtil.getEntryNames(DLFileEntry.class.getName(),entry.getFileEntryId());
    String extraSettings=entry.getExtraSettings();
    InputStream is=DLFileEntryLocalServiceUtil.getFileAsStream(sharepointRequest.getCompanyId(),sharepointRequest.getUserId(),entry.getFolderId(),entry.getName());
    byte[] bytes=FileUtil.getBytes(is);
    entry=DLFileEntryServiceUtil.updateFileEntry(folderId,newParentFolderId,name,newName,newName,description,tagsEntries,extraSettings,bytes);
    Tree documentTree=getFileEntryTree(entry,newParentFolderPath);
    movedDocsTree.addChild(documentTree);
  }
 else   if (folder != null) {
    long folderId=folder.getFolderId();
    String description=folder.getDescription();
    folder=DLFolderServiceUtil.updateFolder(folderId,newParentFolderId,newName,description);
    Tree folderTree=getFolderTree(folder,newParentFolderPath);
    movedDirsTree.addChild(folderTree);
  }
  return new Tree[]{movedDocsTree,movedDirsTree};
}
