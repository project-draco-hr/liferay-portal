{
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  if (!cmd.equals(Constants.UPDATE)) {
    return;
  }
  long rootFolderId=ParamUtil.getLong(actionRequest,"rootFolderId");
  boolean showBreadcrumbs=ParamUtil.getBoolean(actionRequest,"showBreadcrumbs");
  boolean showFoldersSearch=ParamUtil.getBoolean(actionRequest,"showFoldersSearch");
  boolean showSubfolders=ParamUtil.getBoolean(actionRequest,"showSubfolders");
  int foldersPerPage=ParamUtil.getInteger(actionRequest,"foldersPerPage");
  String folderColumns=ParamUtil.getString(actionRequest,"folderColumns");
  boolean showFileEntriesSearch=ParamUtil.getBoolean(actionRequest,"showFileEntriesSearch");
  int fileEntriesPerPage=ParamUtil.getInteger(actionRequest,"fileEntriesPerPage");
  String fileEntryColumns=ParamUtil.getString(actionRequest,"fileEntryColumns");
  boolean enableCommentRatings=ParamUtil.getBoolean(actionRequest,"enableCommentRatings");
  int commentsPageDelta=ParamUtil.getInteger(actionRequest,"commentsPageDelta");
  String portletResource=ParamUtil.getString(actionRequest,"portletResource");
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getPortletSetup(actionRequest,portletResource);
  if (rootFolderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    try {
      DLFolderLocalServiceUtil.getFolder(rootFolderId);
    }
 catch (    NoSuchFolderException e) {
      SessionErrors.add(actionRequest,"rootFolderIdInvalid");
    }
  }
  preferences.setValue("rootFolderId",String.valueOf(rootFolderId));
  preferences.setValue("showBreadcrumbs",String.valueOf(showBreadcrumbs));
  preferences.setValue("showFoldersSearch",String.valueOf(showFoldersSearch));
  preferences.setValue("showSubfolders",String.valueOf(showSubfolders));
  preferences.setValue("foldersPerPage",String.valueOf(foldersPerPage));
  preferences.setValue("folderColumns",folderColumns);
  preferences.setValue("showFileEntriesSearch",String.valueOf(showFileEntriesSearch));
  preferences.setValue("fileEntriesPerPage",String.valueOf(fileEntriesPerPage));
  preferences.setValue("fileEntryColumns",fileEntryColumns);
  preferences.setValue("enable-comment-ratings",String.valueOf(enableCommentRatings));
  preferences.setValue("comments-page-delta",String.valueOf(commentsPageDelta));
  if (SessionErrors.isEmpty(actionRequest)) {
    preferences.store();
    SessionMessages.add(actionRequest,portletConfig.getPortletName() + ".doConfigure");
  }
}
