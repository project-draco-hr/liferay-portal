{
  PortletRequest portletReq=(PortletRequest)req.getAttribute(JAVAX_PORTLET_REQUEST);
  PortletResponse portletRes=(PortletResponse)req.getAttribute(JAVAX_PORTLET_RESPONSE);
  Portlet portlet=(Portlet)req.getAttribute(JAVAX_PORTLET_PORTLET);
  LiferayPortletSession portletSes=(LiferayPortletSession)portletReq.getPortletSession();
  portletReq.setAttribute(PORTLET_SERVLET_CONFIG,getServletConfig());
  portletReq.setAttribute(PORTLET_SERVLET_REQUEST,req);
  portletReq.setAttribute(PORTLET_SERVLET_RESPONSE,res);
  HttpSession ses=req.getSession();
  PortletSessionTracker.add(ses);
  portletSes.setHttpSession(ses);
  try {
    if (portletReq instanceof ActionRequest) {
      ActionRequest actionReq=(ActionRequest)portletReq;
      ActionResponse actionRes=(ActionResponse)portletRes;
      portlet.processAction(actionReq,actionRes);
    }
 else {
      RenderRequest renderReq=(RenderRequest)portletReq;
      RenderResponse renderRes=(RenderResponse)portletRes;
      portlet.render(renderReq,renderRes);
    }
  }
 catch (  PortletException pe) {
    _log.error(pe,pe);
    throw new ServletException(pe);
  }
}
