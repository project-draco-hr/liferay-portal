{
  Dictionary<String,Object> properties=componentContext.getProperties();
  AuditConfiguration auditConfiguration=Configurable.createConfigurable(AuditConfiguration.class,properties);
  _bundleContext=componentContext.getBundleContext();
  DestinationConfiguration destinationConfiguration=new DestinationConfiguration(DestinationConfiguration.DESTINATION_TYPE_PARALLEL,DestinationNames.AUDIT);
  Destination destination=_destinationFactory.createDestination(destinationConfiguration);
  destinationConfiguration.setMaximumQueueSize(auditConfiguration.auditMessageMaxQueueSize());
  RejectedExecutionHandler rejectedExecutionHandler=new CallerRunsPolicy(){
    @Override public void rejectedExecution(    Runnable runnable,    ThreadPoolExecutor threadPoolExecutor){
      if (_log.isWarnEnabled()) {
        StringBundler sb=new StringBundler(4);
        sb.append("The audit router's task queue is at its ");
        sb.append("maximum capacity. The current thread will ");
        sb.append("handle the request.");
        _log.warn(sb.toString());
      }
      super.rejectedExecution(runnable,threadPoolExecutor);
    }
  }
;
  destinationConfiguration.setRejectedExecutionHandler(rejectedExecutionHandler);
  Dictionary<String,Object> destinationDictionary=new HashMapDictionary<>();
  destinationDictionary.put("destination.name",destination.getName());
  _destinationServiceRegistration=_bundleContext.registerService(Destination.class,destination,destinationDictionary);
  destination.register(_proxyMessageListener);
}
