{
  if (name == null) {
    throw new IllegalArgumentException();
  }
  if (name.equals(RenderRequest.USER_INFO)) {
    if (getRemoteUser() != null) {
      LinkedHashMap<String,String> userInfo=new LinkedHashMap<String,String>();
      try {
        User user=PortalUtil.getUser(_req);
        UserAttributes userAttributes=new UserAttributes(user);
        userInfo.put(UserAttributes.LIFERAY_COMPANY_ID,userAttributes.getValue(UserAttributes.LIFERAY_COMPANY_ID));
        userInfo.put(UserAttributes.LIFERAY_USER_ID,userAttributes.getValue(UserAttributes.LIFERAY_USER_ID));
        for (        String attrName : _portlet.getUserAttributes()) {
          String attrValue=userAttributes.getValue(attrName);
          if (attrValue != null) {
            userInfo.put(attrName,attrValue);
          }
        }
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
      Map<String,String> unmodifiableUserInfo=Collections.unmodifiableMap((Map<String,String>)userInfo.clone());
      Map<String,CustomUserAttributes> cuaInstances=new HashMap<String,CustomUserAttributes>();
      for (      Map.Entry<String,String> entry : _portlet.getCustomUserAttributes().entrySet()) {
        String attrName=entry.getKey();
        String attrCustomClass=entry.getValue();
        CustomUserAttributes cua=cuaInstances.get(attrCustomClass);
        if (cua == null) {
          PortletApp portletApp=_portlet.getPortletApp();
          if (portletApp.isWARFile()) {
            PortletBag portletBag=PortletBagPool.get(_portlet.getRootPortletId());
            cua=(CustomUserAttributes)portletBag.getCustomUserAttributes().get(attrCustomClass);
            cua=(CustomUserAttributes)cua.clone();
          }
 else {
            try {
              cua=(CustomUserAttributes)Class.forName(attrCustomClass).newInstance();
            }
 catch (            Exception e) {
              e.printStackTrace();
            }
          }
          cuaInstances.put(attrCustomClass,cua);
        }
        if (cua != null) {
          String attrValue=cua.getValue(attrName,unmodifiableUserInfo);
          if (attrValue != null) {
            userInfo.put(attrName,attrValue);
          }
        }
      }
      return userInfo;
    }
  }
  return _req.getAttribute(name);
}
