{
  boolean exportPortletData=MapUtil.getBoolean(parameterMap,PortletDataHandlerKeys.PORTLET_DATA);
  boolean exportPortletDataAll=MapUtil.getBoolean(parameterMap,PortletDataHandlerKeys.PORTLET_DATA_ALL);
  if (_log.isDebugEnabled()) {
    _log.debug("Export portlet data " + exportPortletData);
    _log.debug("Export all portlet data " + exportPortletDataAll);
  }
  if (!exportPortletData) {
    return false;
  }
  Portlet portlet=_portletLocalService.getPortletById(companyId,portletId);
  if ((portlet == null) || portlet.isUndeployedPortlet()) {
    return false;
  }
  PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
  if (portletDataHandler == null) {
    return false;
  }
  if (exportPortletDataAll || !portletDataHandler.isDataSiteLevel()) {
    return true;
  }
  return MapUtil.getBoolean(parameterMap,PortletDataHandlerKeys.PORTLET_DATA + StringPool.UNDERLINE + portlet.getRootPortletId());
}
