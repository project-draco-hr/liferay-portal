{
  AssetVocabulary assetVocabulary=null;
  try {
    if (portletDataContext.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR) || portletDataContext.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR_OVERWRITE)) {
      AssetVocabulary existingAssetVocabulary=AssetVocabularyUtil.fetchByUUID_G(vocabularyUuid,portletDataContext.getGroupId());
      if (existingAssetVocabulary == null) {
        Map<Locale,String> titleMap=new HashMap<Locale,String>();
        titleMap.put(LocaleUtil.getDefault(),vocabularyName);
        serviceContext.setUuid(vocabularyUuid);
        assetVocabulary=AssetVocabularyLocalServiceUtil.addVocabulary(portletDataContext.getUserId(userUuid),StringPool.BLANK,titleMap,null,StringPool.BLANK,serviceContext);
      }
 else {
        assetVocabulary=AssetVocabularyLocalServiceUtil.updateVocabulary(existingAssetVocabulary.getVocabularyId(),existingAssetVocabulary.getTitle(),existingAssetVocabulary.getTitleMap(),existingAssetVocabulary.getDescriptionMap(),existingAssetVocabulary.getSettings(),serviceContext);
      }
    }
 else {
      Map<Locale,String> titleMap=new HashMap<Locale,String>();
      titleMap.put(LocaleUtil.getDefault(),vocabularyName);
      assetVocabulary=AssetVocabularyLocalServiceUtil.addVocabulary(portletDataContext.getUserId(userUuid),StringPool.BLANK,titleMap,null,StringPool.BLANK,serviceContext);
    }
  }
 catch (  DuplicateVocabularyException dve) {
    assetVocabulary=AssetVocabularyLocalServiceUtil.getGroupVocabulary(portletDataContext.getGroupId(),vocabularyName);
  }
  return assetVocabulary;
}
