{
  UploadPortletRequest uploadRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  long userId=PortalUtil.getUserId(actionRequest);
  String name=ParamUtil.getString(actionRequest,"name");
  File file=uploadRequest.getFile("file");
  byte[] bytes=FileUtil.getBytes(file);
  ResourceRetriever resourceRetriever=new ByteArrayResourceRetriever(bytes);
  int version=0;
  Map attributes=new HashMap<String,Object>();
  WorkflowDefinition workflowDefinition=new DefaultWorkflowDefinition(resourceRetriever,name,version,attributes);
  boolean autoIncrementVersionNumber=true;
  Map parameters=new HashMap<String,Object>();
  WorkflowDefinitionManagerUtil.deployWorkflowDefinition(workflowDefinition,userId,autoIncrementVersionNumber,parameters);
  actionRequest.setAttribute(WebKeys.WORKFLOW_DEFINITION,workflowDefinition);
}
