{
  UploadPortletRequest uploadRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String name=ParamUtil.getString(actionRequest,"name");
  File file=uploadRequest.getFile("file");
  if (!file.exists()) {
    throw new WorkflowDefinitionFileException();
  }
  WorkflowDefinition workflowDefinition=WorkflowDefinitionManagerUtil.deployWorkflowDefinition(themeDisplay.getCompanyId(),themeDisplay.getUserId(),name,new FileInputStream(file));
  actionRequest.setAttribute(WebKeys.WORKFLOW_DEFINITION,workflowDefinition);
}
