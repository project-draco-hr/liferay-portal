{
  if (LuceneUtil.INDEX_READ_ONLY) {
    return;
  }
  if (_log.isInfoEnabled()) {
    _log.info("Reindexing Lucene started");
  }
  if (ServerDetector.isOrion()) {
    try {
      Thread.sleep(Time.SECOND * 10);
    }
 catch (    InterruptedException ie) {
    }
  }
  StopWatch stopWatch1=null;
  if (_log.isInfoEnabled()) {
    stopWatch1=new StopWatch();
    stopWatch1.start();
  }
  LuceneUtil.delete(_companyId);
  try {
    IndexWriter writer=LuceneUtil.getWriter(_companyId,true);
    LuceneUtil.write(writer);
  }
 catch (  IOException ioe) {
    _log.error(ioe.getMessage());
  }
  String[] indexIds=new String[]{String.valueOf(_companyId)};
  try {
    List portlets=PortletLocalServiceUtil.getPortlets(_companyId);
    Collections.sort(portlets,new PortletLuceneComparator());
    Iterator itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=(Portlet)itr.next();
      String className=portlet.getIndexerClass();
      if (portlet.isActive() && className != null) {
        StopWatch stopWatch2=null;
        if (_log.isInfoEnabled()) {
          stopWatch2=new StopWatch();
          stopWatch2.start();
        }
        if (_log.isInfoEnabled()) {
          _log.info("Reindexing with " + className + " started");
        }
        Indexer indexer=(Indexer)InstancePool.get(className);
        indexer.reIndex(indexIds);
        if (_log.isInfoEnabled()) {
          _log.info("Reindexing with " + className + " completed in "+ (stopWatch2.getTime() / Time.SECOND)+ " seconds");
        }
      }
    }
    if (_log.isInfoEnabled()) {
      _log.info("Reindexing Lucene completed in " + (stopWatch1.getTime() / Time.SECOND) + " seconds");
    }
  }
 catch (  Exception e) {
    _log.error(e);
    if (_log.isInfoEnabled()) {
      _log.info("Reindexing Lucene failed");
    }
  }
  _finished=true;
}
