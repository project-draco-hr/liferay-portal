{
  String companyId=array[0];
  String userId=array[1];
  String threadId=array[2];
  String fromName=array[3];
  String fromAddress=array[4];
  String subject=array[5];
  String body=array[6];
  List subscriptions=SubscriptionLocalServiceUtil.getSubscriptions(companyId,MBThread.class.getName(),threadId);
  for (int i=0; i < subscriptions.size(); i++) {
    Subscription subscription=(Subscription)subscriptions.get(i);
    if (subscription.getUserId().equals(userId)) {
      return;
    }
    User user=UserLocalServiceUtil.getUserById(subscription.getUserId());
    try {
      InternetAddress from=new InternetAddress(fromAddress,fromName);
      InternetAddress to=new InternetAddress(user.getEmailAddress(),user.getFullName());
      String curSubject=StringUtil.replace(subject,new String[]{"[$TO_ADDRESS$]","[$TO_NAME$]"},new String[]{user.getFullName(),user.getEmailAddress()});
      String curBody=StringUtil.replace(body,new String[]{"[$TO_ADDRESS$]","[$TO_NAME$]"},new String[]{user.getFullName(),user.getEmailAddress()});
      MailMessage message=new MailMessage(from,to,curSubject,curBody,true);
      MailServiceUtil.sendEmail(message);
    }
 catch (    Exception e) {
      _log.error(e);
    }
  }
}
