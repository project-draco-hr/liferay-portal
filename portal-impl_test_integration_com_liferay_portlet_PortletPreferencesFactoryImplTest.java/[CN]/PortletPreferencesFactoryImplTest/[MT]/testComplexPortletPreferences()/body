{
  PortletPreferencesImpl portletPreferencesImpl=new PortletPreferencesImpl();
  portletPreferencesImpl.setValue("","");
  portletPreferencesImpl.setValues("name1",new String[0]);
  portletPreferencesImpl.setValues("name2",new String[]{"","value1"});
  Preference preference=new Preference("name3",new String[]{"value2","value3"},true);
  Map<String,Preference> preferencesMap=portletPreferencesImpl.getPreferences();
  preferencesMap.put("name3",preference);
  String actualXML=PortletPreferencesFactoryUtil.toXML(portletPreferencesImpl);
  portletPreferencesImpl=deserialize(actualXML);
  preferencesMap=portletPreferencesImpl.getPreferences();
  Assert.assertEquals(4,preferencesMap.size());
  preference=preferencesMap.get("");
  Assert.assertNotNull(preference);
  Assert.assertEquals("",preference.getName());
  String[] values=preference.getValues();
  Assert.assertEquals(1,values.length);
  Assert.assertEquals("",values[0]);
  Assert.assertFalse(preference.isReadOnly());
  preference=preferencesMap.get("name1");
  Assert.assertNotNull(preference);
  Assert.assertEquals("name1",preference.getName());
  values=preference.getValues();
  Assert.assertEquals(0,values.length);
  Assert.assertFalse(preference.isReadOnly());
  preference=preferencesMap.get("name2");
  Assert.assertNotNull(preference);
  Assert.assertEquals("name2",preference.getName());
  values=preference.getValues();
  Assert.assertEquals(2,values.length);
  Assert.assertEquals("",values[0]);
  Assert.assertEquals("value1",values[1]);
  Assert.assertFalse(preference.isReadOnly());
  preference=preferencesMap.get("name3");
  Assert.assertNotNull(preference);
  Assert.assertEquals("name3",preference.getName());
  values=preference.getValues();
  Assert.assertEquals(2,values.length);
  Assert.assertEquals("value2",values[0]);
  Assert.assertEquals("value3",values[1]);
  Assert.assertTrue(preference.isReadOnly());
}
