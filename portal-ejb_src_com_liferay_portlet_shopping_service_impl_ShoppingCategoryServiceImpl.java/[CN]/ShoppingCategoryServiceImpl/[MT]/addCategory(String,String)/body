{
  parentCategoryId=_getParentCategoryId(parentCategoryId);
  _validate(name);
  if (!hasAdmin()) {
    throw new PrincipalException();
  }
  User user=getUser();
  String categoryId=Long.toString(CounterServiceUtil.increment(ShoppingCategory.class.getName()));
  ShoppingCategory category=ShoppingCategoryUtil.create(categoryId);
  Date now=new Date();
  category.setCompanyId(user.getCompanyId());
  category.setCreateDate(now);
  category.setModifiedDate(now);
  category.setParentCategoryId(parentCategoryId);
  category.setName(name);
  ShoppingCategoryUtil.update(category);
  return category;
}
