{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(group.getCompanyId(),getPortletId());
  if (portlet == null) {
    return;
  }
  if (scopeType.equals("layout") && !portlet.isScopeable()) {
    Assert.assertTrue("This test does not apply",true);
    return;
  }
  TemplateHandler templateHandler=portlet.getTemplateHandlerInstance();
  if (templateHandler == null) {
    Assert.assertTrue("This test does not apply",true);
    return;
  }
  String className=templateHandler.getClassName();
  DDMTemplate ddmTemplate=DDMTemplateTestUtil.addTemplate(displayStyleGroupId,PortalUtil.getClassNameId(className),0);
  Map<String,String[]> preferenceMap=new HashMap<String,String[]>();
  String displayStyle=PortletDisplayTemplate.DISPLAY_STYLE_PREFIX + ddmTemplate.getUuid();
  preferenceMap.put("displayStyle",new String[]{displayStyle});
  preferenceMap.put("displayStyleGroupId",new String[]{String.valueOf(ddmTemplate.getGroupId())});
  preferenceMap.put("lfrScopeType",new String[]{scopeType});
  if (scopeType.equals("layout")) {
    preferenceMap.put("lfrScopeLayoutUuid",new String[]{this.layout.getUuid()});
  }
  PortletPreferences portletPreferences=getImportedPortletPreferences(preferenceMap);
  String importedDisplayStyle=portletPreferences.getValue("displayStyle",StringPool.BLANK);
  Assert.assertEquals(displayStyle,importedDisplayStyle);
  long importedDisplayStyleGroupId=GetterUtil.getLong(portletPreferences.getValue("displayStyleGroupId",null));
  long expectedDisplayStyleGroupId=importedGroup.getGroupId();
  if (scopeType.equals("company")) {
    Group companyGroup=GroupLocalServiceUtil.getCompanyGroup(importedGroup.getCompanyId());
    expectedDisplayStyleGroupId=companyGroup.getGroupId();
  }
  Assert.assertEquals(expectedDisplayStyleGroupId,importedDisplayStyleGroupId);
}
