{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PortletURLImpl openSearchResourceURL=new PortletURLImpl(request,SearchPortletKeys.SEARCH,themeDisplay.getPlid(),PortletRequest.RESOURCE_PHASE);
  openSearchResourceURL.setParameter(Constants.CMD,"getOpenSearchXML");
  long groupId=ParamUtil.getLong(request,"groupId");
  PortletURLImpl openSearchDescriptionXMLURL=new PortletURLImpl(request,SearchPortletKeys.SEARCH,themeDisplay.getPlid(),PortletRequest.RESOURCE_PHASE);
  openSearchDescriptionXMLURL.setParameter("mvcPath","/open_search_description.jsp");
  openSearchDescriptionXMLURL.setParameter("groupId",String.valueOf(groupId));
  OpenSearch search=new PortalOpenSearchImpl(openSearchResourceURL.toString(),openSearchDescriptionXMLURL.toString());
  String xml=search.search(request,openSearchResourceURL.toString() + StringPool.QUESTION + request.getQueryString());
  return xml.getBytes();
}
