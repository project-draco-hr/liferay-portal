{
  HttpSession ses=req.getSession();
  String to=req.getParameter("msg_to");
  String cc=req.getParameter("msg_cc");
  String bcc=req.getParameter("msg_bcc");
  String subject=req.getParameter("msg_sub");
  String body=req.getParameter("msg_body");
  String returnReceipt=req.getParameter("msg_return_receipt_1");
  String htmlFormat=req.getParameter("html_cb_1");
  com.liferay.portlet.mail.model.Message msg=(com.liferay.portlet.mail.model.Message)ses.getAttribute(WebKeys.MAIL_MESSAGE_MODEL);
  if ((to != null) && (!to.equals("null"))) {
    msg.setTo(to);
  }
  if ((cc != null) && (!cc.equals("null"))) {
    msg.setCc(cc);
  }
  if ((bcc != null) && (!bcc.equals("null"))) {
    msg.setBcc(bcc);
  }
  if ((subject != null) && (!subject.equals("null"))) {
    msg.setSubject(subject);
  }
  if ((body != null) && (!body.equals("null"))) {
    msg.setBody(body);
  }
  if ((Validator.isNotNull(returnReceipt)) && (returnReceipt.equals("on"))) {
    msg.setReturnReceipt(true);
  }
 else {
    msg.setReturnReceipt(false);
  }
  if ((Validator.isNotNull(htmlFormat)) && (htmlFormat.equals("on"))) {
    msg.setHTMLFormat(true);
  }
 else {
    msg.setReturnReceipt(false);
    msg.setHTMLFormat(false);
  }
}
