{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String cmd=ParamUtil.getString(resourceRequest,Constants.CMD);
  if (!cmd.equals("getFieldValue")) {
    return;
  }
  ServiceContext serviceContext=ServiceContextFactory.getInstance(resourceRequest);
  long structureId=ParamUtil.getLong(resourceRequest,"structureId");
  Fields fields=(Fields)serviceContext.getAttribute(Fields.class.getName() + structureId);
  if (fields == null) {
    String fieldsNamespace=ParamUtil.getString(resourceRequest,"fieldsNamespace");
    fields=DDMUtil.getFields(structureId,fieldsNamespace,serviceContext);
  }
  String fieldName=ParamUtil.getString(resourceRequest,"name");
  Field field=fields.get(fieldName);
  Serializable fieldValue=field.getValue(themeDisplay.getLocale());
  DDMStructure ddmStructure=field.getDDMStructure();
  String type=ddmStructure.getFieldType(fieldName);
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  Serializable displayValue=DDMUtil.getDisplayFieldValue(fieldValue,type,themeDisplay.getLocale());
  jsonObject.put("displayValue",String.valueOf(displayValue));
  if (fieldValue instanceof Boolean) {
    jsonObject.put("value",(Boolean)fieldValue);
  }
 else   if (fieldValue instanceof Date) {
    DateFormat dateFormat=DateFormatFactoryUtil.getSimpleDateFormat("yyyyMMddHHmmss");
    jsonObject.put("value",dateFormat.format(fieldValue));
  }
 else {
    jsonObject.put("value",(String)fieldValue);
  }
  resourceResponse.setContentType(ContentTypes.APPLICATION_JSON);
  PortletResponseUtil.write(resourceResponse,jsonObject.toString());
}
