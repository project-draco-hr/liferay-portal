{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long userId=themeDisplay.getUserId();
  long groupId=themeDisplay.getSiteGroupId();
  int[] queryRulesIndexes=StringUtil.split(ParamUtil.getString(actionRequest,"queryLogicIndexes"),0);
  int i=0;
  List<AssetQueryRule> assetQueryRules=new ArrayList<AssetQueryRule>();
  for (  int queryRulesIndex : queryRulesIndexes) {
    AssetQueryRule assetQueryRule=getQueryRule(actionRequest,queryRulesIndex);
    validateQueryRule(userId,groupId,assetQueryRules,assetQueryRule);
    assetQueryRules.add(assetQueryRule);
    setPreference(actionRequest,"queryContains" + i,String.valueOf(assetQueryRule.isContains()));
    setPreference(actionRequest,"queryAndOperator" + i,String.valueOf(assetQueryRule.isAndOperator()));
    setPreference(actionRequest,"queryName" + i,assetQueryRule.getName());
    setPreference(actionRequest,"queryValues" + i,assetQueryRule.getValues());
    i++;
  }
  String[] values=preferences.getValues("queryValues" + i,new String[0]);
  while (values.length > 0) {
    setPreference(actionRequest,"queryContains" + i,StringPool.BLANK);
    setPreference(actionRequest,"queryAndOperator" + i,StringPool.BLANK);
    setPreference(actionRequest,"queryName" + i,StringPool.BLANK);
    setPreference(actionRequest,"queryValues" + i,new String[0]);
    i++;
    values=preferences.getValues("queryValues" + i,new String[0]);
  }
}
