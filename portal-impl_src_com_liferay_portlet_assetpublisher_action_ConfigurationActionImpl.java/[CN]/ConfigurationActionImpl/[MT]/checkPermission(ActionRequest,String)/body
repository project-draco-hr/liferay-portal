{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  long groupId=AssetPublisherUtil.getGroupIdFromScopeId(scopeId,themeDisplay.getScopeGroupId(),layout.isPrivateLayout());
  if (scopeId.startsWith(AssetPublisherUtil.SCOPE_ID_PARENT_GROUP_PREFIX)) {
    Group scopeGroup=themeDisplay.getScopeGroup();
    if (!scopeGroup.hasAncestor(groupId)) {
      throw new PrincipalException();
    }
    if (!SitesUtil.isContentSharingWithChildrenEnabled(scopeGroup)) {
      GroupPermissionUtil.check(themeDisplay.getPermissionChecker(),groupId,ActionKeys.UPDATE);
    }
  }
 else   if (groupId != themeDisplay.getCompanyGroupId()) {
    GroupPermissionUtil.check(themeDisplay.getPermissionChecker(),groupId,ActionKeys.UPDATE);
  }
}
