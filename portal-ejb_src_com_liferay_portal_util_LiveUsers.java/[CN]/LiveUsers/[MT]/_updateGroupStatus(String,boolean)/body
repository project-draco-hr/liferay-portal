{
  String companyId=CompanyThreadLocal.getCompanyId();
  Map liveUsers=_getLiveUsers();
  LinkedHashMap groupParams=new LinkedHashMap();
  groupParams.put("usersGroups",userId);
  List communities=GroupLocalServiceUtil.search(companyId,null,null,groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  for (int i=0; i < communities.size(); i++) {
    Group community=(Group)communities.get(i);
    Set groupUsers=_getGroupUsers(liveUsers,community.getGroupId());
    if (signedIn) {
      groupUsers.add(userId);
    }
 else {
      groupUsers.remove(userId);
    }
  }
  return liveUsers;
}
