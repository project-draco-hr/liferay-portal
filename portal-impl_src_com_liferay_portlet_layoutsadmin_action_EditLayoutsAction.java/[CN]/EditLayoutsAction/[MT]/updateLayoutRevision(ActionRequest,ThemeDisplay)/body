{
  long layoutRevisionId=ParamUtil.getLong(actionRequest,"layoutRevisionId");
  LayoutRevision layoutRevision=LayoutRevisionLocalServiceUtil.getLayoutRevision(layoutRevisionId);
  ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
  LayoutRevision enableLayoutRevision=LayoutRevisionLocalServiceUtil.updateLayoutRevision(serviceContext.getUserId(),layoutRevisionId,layoutRevision.getLayoutBranchId(),layoutRevision.getName(),layoutRevision.getTitle(),layoutRevision.getDescription(),layoutRevision.getKeywords(),layoutRevision.getRobots(),layoutRevision.getTypeSettings(),layoutRevision.getIconImage(),layoutRevision.getIconImageId(),layoutRevision.getThemeId(),layoutRevision.getColorSchemeId(),layoutRevision.getWapThemeId(),layoutRevision.getWapColorSchemeId(),layoutRevision.getCss(),serviceContext);
  if (layoutRevision.getStatus() == WorkflowConstants.STATUS_INCOMPLETE) {
    LayoutRevision lastLayoutRevision=LayoutRevisionLocalServiceUtil.fetchLastLayoutRevision(enableLayoutRevision.getPlid(),true);
    if (lastLayoutRevision != null) {
      LayoutRevision newLayoutRevision=LayoutRevisionLocalServiceUtil.addLayoutRevision(serviceContext.getUserId(),layoutRevision.getLayoutSetBranchId(),layoutRevision.getLayoutBranchId(),enableLayoutRevision.getLayoutRevisionId(),false,layoutRevision.getPlid(),lastLayoutRevision.getLayoutRevisionId(),lastLayoutRevision.getPrivateLayout(),lastLayoutRevision.getName(),lastLayoutRevision.getTitle(),lastLayoutRevision.getDescription(),lastLayoutRevision.getKeywords(),lastLayoutRevision.getRobots(),lastLayoutRevision.getTypeSettings(),lastLayoutRevision.isIconImage(),lastLayoutRevision.getIconImageId(),lastLayoutRevision.getThemeId(),lastLayoutRevision.getColorSchemeId(),lastLayoutRevision.getWapThemeId(),lastLayoutRevision.getWapColorSchemeId(),lastLayoutRevision.getCss(),serviceContext);
      StagingUtil.setRecentLayoutRevisionId(themeDisplay.getUser(),newLayoutRevision.getLayoutSetBranchId(),newLayoutRevision.getPlid(),newLayoutRevision.getLayoutRevisionId());
    }
  }
}
