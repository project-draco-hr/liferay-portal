{
  if (Validator.isNull(redirect) || Validator.isNull(oldLayoutFriendlyURL)) {
    return redirect;
  }
  if (layout != null) {
    String oldPath=oldLayoutFriendlyURL;
    if (layout.isTypeLinkToLayout() || layout.isTypeURL()) {
      try {
        layout=LayoutLocalServiceUtil.fetchFirstLayout(layout.getGroupId(),layout.getPrivateLayout(),LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
      }
 catch (      Exception e) {
        if (_log.isDebugEnabled()) {
          _log.debug("First layout can not be found");
        }
      }
    }
    String newPath=layout.getFriendlyURL(themeDisplay.getLocale());
    return PortalUtil.updateRedirect(redirect,oldPath,newPath);
  }
 else   if (group != null) {
    String oldPath=group.getFriendlyURL() + oldLayoutFriendlyURL;
    String newPath=group.getFriendlyURL();
    return PortalUtil.updateRedirect(redirect,oldPath,newPath);
  }
  return redirect;
}
