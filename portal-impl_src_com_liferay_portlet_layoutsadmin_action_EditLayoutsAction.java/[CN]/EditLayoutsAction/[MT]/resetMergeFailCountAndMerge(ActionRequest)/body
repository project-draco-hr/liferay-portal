{
  long targetPlid=ParamUtil.getLong(actionRequest,"selPlid");
  long layoutPrototypeId=ParamUtil.getLong(actionRequest,"layoutPrototypeId");
  LayoutPrototype layoutPrototype=LayoutPrototypeLocalServiceUtil.getLayoutPrototype(layoutPrototypeId);
  SitesUtil.setMergeFailCount(layoutPrototype,0);
  Layout targetLayout=LayoutLocalServiceUtil.getLayout(targetPlid);
  SitesUtil.resetPrototype(targetLayout);
  SitesUtil.mergeLayoutPrototypeLayout(targetLayout.getGroup(),targetLayout);
  layoutPrototype=LayoutPrototypeServiceUtil.getLayoutPrototype(layoutPrototypeId);
  int mergeFailCountAfterMerge=SitesUtil.getMergeFailCount(layoutPrototype);
  if (mergeFailCountAfterMerge > 0) {
    SessionErrors.add(actionRequest,"resetMergeFailCountAndMerge");
  }
}
