{
  long groupId=ParamUtil.getLong(actionRequest,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(actionRequest,"privateLayout");
  long layoutId=ParamUtil.getLong(actionRequest,"layoutId");
  Layout layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,layoutId);
  LayoutSet layoutSet=layout.getLayoutSet();
  boolean themeChanged=!oldThemeId.equals(themeId);
  for (  String key : themeSettings.keySet()) {
    ThemeSetting themeSetting=themeSettings.get(key);
    String value=null;
    if (themeChanged) {
      value=themeSetting.getValue();
    }
 else {
      String property=device + "ThemeSettingsProperties--" + key+ StringPool.DOUBLE_DASH;
      value=ParamUtil.getString(actionRequest,property);
    }
    if (!value.equals(layoutSet.getThemeSetting(key,device))) {
      typeSettingsProperties.setProperty(ThemeSettingImpl.namespaceProperty(device,key),value);
    }
  }
}
