{
  Theme theme=ThemeLocalServiceUtil.getTheme(companyId,themeId,wapTheme);
  if (!theme.hasColorSchemes()) {
    colorSchemeId=StringPool.BLANK;
  }
  if (Validator.isNull(colorSchemeId)) {
    ColorScheme colorScheme=ThemeLocalServiceUtil.getColorScheme(companyId,themeId,colorSchemeId,wapTheme);
    colorSchemeId=colorScheme.getColorSchemeId();
  }
  deleteThemeSettings(typeSettingsProperties,device);
  Map<String,ThemeSetting> configurableSettings=theme.getConfigurableSettings();
  if (configurableSettings.isEmpty()) {
    return colorSchemeId;
  }
  for (  String key : configurableSettings.keySet()) {
    ThemeSetting themeSetting=configurableSettings.get(key);
    String type=GetterUtil.getString(themeSetting.getType(),"text");
    String property=device + "ThemeSettingsProperties--" + key+ StringPool.DOUBLE_DASH;
    String value=ParamUtil.getString(actionRequest,property);
    if (type.equals("checkbox")) {
      value=String.valueOf(GetterUtil.getBoolean(value));
    }
    if (!value.equals(themeSetting.getValue())) {
      typeSettingsProperties.setProperty(ThemeSettingImpl.namespaceProperty(device,key),value);
    }
  }
  return colorSchemeId;
}
