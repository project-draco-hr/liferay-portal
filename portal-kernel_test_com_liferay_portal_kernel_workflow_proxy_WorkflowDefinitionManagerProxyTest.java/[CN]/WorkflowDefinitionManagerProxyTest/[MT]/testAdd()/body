{
  final String testName="testName";
  final String testContent="testContent";
  WorkflowDefinitionInfo definitionInfo=new WorkflowDefinitionInfo(testName);
  definitionInfo.setResourceRetriever(new StringResourceRetriever(testContent));
  MessageListener addListener=new MessageListener(){
    public void receive(    Message message){
      WorkflowDefinitionRequest request=(WorkflowDefinitionRequest)message.getPayload();
      assertEquals(WorkflowDefinitionRequestType.ADD,request.getType());
      WorkflowDefinitionInfo definitionInfo=request.getWorkflowDefinitionInfo();
      assertNotNull(definitionInfo);
      assertEquals(testName,definitionInfo.getWorkflowDefinitionName());
      ResourceRetriever retriever=definitionInfo.getResourceRetriever();
      BufferedReader br=new BufferedReader(new InputStreamReader(retriever.getInputStream()));
      try {
        assertEquals(testContent,br.readLine());
      }
 catch (      Exception ex) {
        fail(ex.getMessage());
      }
    }
  }
;
  messageBus.registerMessageListener(DestinationNames.WORKFLOW_DEFINITION,addListener);
  _proxy.addWorkflowDefinition(definitionInfo);
}
