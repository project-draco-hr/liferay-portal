{
  if (_groups != null) {
    return _groups;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PortletRequest portletRequest=(PortletRequest)request.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  User user=themeDisplay.getUser();
  String keywords=ParamUtil.getString(request,"keywords");
  RequestBackedPortletURLFactory requestBackedPortletURLFactory=RequestBackedPortletURLFactoryUtil.create(request);
  PortletURL viewGroupSelectorURL=requestBackedPortletURLFactory.createRenderURL(ItemSelectorPortletKeys.ITEM_SELECTOR);
  SearchContainer searchContainer=new GroupSearch(portletRequest,viewGroupSelectorURL);
  if (Validator.isNotNull(keywords)) {
    LinkedHashMap<String,Object> groupParams=new LinkedHashMap<>();
    groupParams.put("site",Boolean.TRUE);
    groupParams.put("usersGroups",Long.valueOf(user.getUserId()));
    return GroupLocalServiceUtil.search(themeDisplay.getCompanyId(),getClassNameIds(),keywords,groupParams,searchContainer.getStart(),searchContainer.getEnd(),null);
  }
  try {
    List<Group> groups=user.getMySiteGroups(null,QueryUtil.ALL_POS);
    return ListUtil.subList(groups,searchContainer.getStart(),searchContainer.getEnd());
  }
 catch (  Exception e) {
    return new ArrayList<>();
  }
}
