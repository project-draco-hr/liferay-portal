{
  MessageBus messageBus=getMessageBus();
  for (  DestinationEventListener destinationEventListener : _globalDestinationEventListeners) {
    messageBus.addDestinationEventListener(destinationEventListener);
  }
  for (  Destination destination : _destinations) {
    messageBus.addDestination(destination);
  }
  for (  Map.Entry<String,List<DestinationEventListener>> destinationSpecificEventListeners : _destinationSpecificEventListeners.entrySet()) {
    String destinationName=destinationSpecificEventListeners.getKey();
    for (    DestinationEventListener destinationEventListener : destinationSpecificEventListeners.getValue()) {
      messageBus.addDestinationEventListener(destinationName,destinationEventListener);
    }
  }
  for (  Destination destination : _replacementDestinations) {
    messageBus.replace(destination);
  }
  ClassLoader contextClassLoader=Thread.currentThread().getContextClassLoader();
  try {
    ClassLoader operatingClassLoader=getOperatingClassloader();
    Thread.currentThread().setContextClassLoader(operatingClassLoader);
    for (    Map.Entry<String,List<MessageListener>> listeners : _messageListeners.entrySet()) {
      String destination=listeners.getKey();
      for (      MessageListener listener : listeners.getValue()) {
        messageBus.registerMessageListener(destination,listener);
      }
    }
  }
  finally {
    Thread.currentThread().setContextClassLoader(contextClassLoader);
  }
}
