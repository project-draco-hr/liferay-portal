{
  if (SPIUtil.isSPI() && _portalMessagingConfigurator) {
    return;
  }
  Registry registry=RegistryUtil.getRegistry();
  _messageListenerServiceRegistrar=registry.getServiceRegistrar(MessageListener.class);
  Thread currentThread=Thread.currentThread();
  ClassLoader contextClassLoader=currentThread.getContextClassLoader();
  try {
    ClassLoader operatingClassLoader=getOperatingClassloader();
    currentThread.setContextClassLoader(operatingClassLoader);
    for (    Map.Entry<String,List<MessageListener>> messageListeners : _messageListeners.entrySet()) {
      String destinationName=messageListeners.getKey();
      ServiceDependencyManager serviceDependencyManager=new ServiceDependencyManager();
      serviceDependencyManager.addServiceDependencyListener(new DestinationServiceDependencyListener(destinationName,messageListeners.getValue()));
      Filter filter=registry.getFilter("(&(destination.name=" + destinationName + ")(objectClass="+ Destination.class.getName()+ "))");
      serviceDependencyManager.registerDependencies(filter);
    }
  }
  finally {
    currentThread.setContextClassLoader(contextClassLoader);
  }
}
