{
  Connection con=null;
  try {
    con=HibernateUtil.getConnection();
    DatabaseMetaData metaData=con.getMetaData();
    String dbName=metaData.getDatabaseProductName();
    int dbMajorVersion=metaData.getDatabaseMajorVersion();
    if (_log.isInfoEnabled()) {
      _log.info("Determining dialect for " + dbName + " "+ dbMajorVersion);
    }
    _dialect=DialectFactory.determineDialect(dbName,dbMajorVersion);
    if (_log.isInfoEnabled()) {
      _log.info("Using dialect " + _dialect.getClass().getName());
    }
  }
 catch (  Exception e) {
    _log.error(StackTraceUtil.getStackTrace(e));
  }
 finally {
    DataAccess.cleanUp(con);
  }
  if (_dialect == null) {
    throw new DynamicDialectException("No dialect found");
  }
  Properties dynamicDefaultProps=getDefaultProperties();
  Properties dialectDefaultProps=_dialect.getDefaultProperties();
  dynamicDefaultProps.clear();
  Enumeration enu=dialectDefaultProps.propertyNames();
  while (enu.hasMoreElements()) {
    String key=(String)enu.nextElement();
    String value=dialectDefaultProps.getProperty(key);
    dynamicDefaultProps.setProperty(key,value);
  }
}
