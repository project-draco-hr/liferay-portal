{
  if ((_instrumentation == null) || _dynamicallyInstrumented) {
    return;
  }
  if (includes == null) {
    includes=_includes;
  }
  if (excludes == null) {
    excludes=_excludes;
  }
  String agentLine=System.getProperty("junit.cobertura.agent");
  int index=agentLine.indexOf('=');
  if (index != -1) {
    StringBuilder sb=new StringBuilder();
    sb.append(agentLine,0,index + 1);
    for (    String include : includes) {
      sb.append(include);
      sb.append(',');
    }
    if (includes.length > 0) {
      sb.setLength(sb.length() - 1);
    }
    sb.append(';');
    for (    String exclude : excludes) {
      sb.append(exclude);
      sb.append(',');
    }
    if (excludes.length > 0) {
      sb.setLength(sb.length() - 1);
    }
    System.setProperty("junit.cobertura.agent",sb.toString());
  }
  if (_coberturaClassFileTransformer == null) {
    _coberturaClassFileTransformer=new CoberturaClassFileTransformer(includes,excludes);
  }
  _instrumentation.addTransformer(_coberturaClassFileTransformer,true);
  Class<?>[] allLoadedClasses=_instrumentation.getAllLoadedClasses();
  List<Class<?>> modifiableClasses=new ArrayList<>();
  for (  Class<?> loadedClass : allLoadedClasses) {
    if (_instrumentation.isModifiableClass(loadedClass)) {
      String className=loadedClass.getName();
      className=className.replace('.','/');
      if (_coberturaClassFileTransformer.matches(className)) {
        modifiableClasses.add(loadedClass);
      }
    }
  }
  _instrumentation.retransformClasses(modifiableClasses.toArray(new Class<?>[modifiableClasses.size()]));
  _dynamicallyInstrumented=true;
  _originalClassDefinitions=null;
  System.setProperty("junit.code.coverage","true");
}
