{
  LayoutSet layoutSet=null;
  String host=PortalUtil.getHost(req);
  try {
    if (isValidHost(user.getActualCompanyId(),host)) {
      layoutSet=LayoutSetLocalServiceUtil.getLayoutSet(user.getActualCompanyId(),host);
      List layouts=LayoutLocalServiceUtil.getLayouts(layoutSet.getOwnerId(),LayoutImpl.DEFAULT_PARENT_LAYOUT_ID);
      if (layouts.size() > 0) {
        Layout layout=(Layout)layouts.get(0);
        return new Object[]{layout,layouts};
      }
    }
  }
 catch (  NoSuchLayoutSetException nslse) {
  }
  Layout layout=null;
  List layouts=null;
  if (signedIn) {
    Group userGroup=user.getGroup();
    layouts=LayoutLocalServiceUtil.getLayouts(LayoutImpl.PRIVATE + userGroup.getGroupId(),LayoutImpl.DEFAULT_PARENT_LAYOUT_ID);
    if (layouts.size() == 0) {
      layouts=LayoutLocalServiceUtil.getLayouts(LayoutImpl.PUBLIC + userGroup.getGroupId(),LayoutImpl.DEFAULT_PARENT_LAYOUT_ID);
    }
    if (layouts.size() > 0) {
      layout=(Layout)layouts.get(0);
    }
    if (layout == null) {
      Map groupParams=new HashMap();
      groupParams.put("usersGroups",user.getUserId());
      List groups=GroupLocalServiceUtil.search(user.getCompanyId(),null,null,groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
      for (int i=0; i < groups.size(); i++) {
        Group group=(Group)groups.get(i);
        layouts=LayoutLocalServiceUtil.getLayouts(LayoutImpl.PRIVATE + group.getGroupId(),LayoutImpl.DEFAULT_PARENT_LAYOUT_ID);
        if (layouts.size() == 0) {
          layouts=LayoutLocalServiceUtil.getLayouts(LayoutImpl.PUBLIC + group.getGroupId(),LayoutImpl.DEFAULT_PARENT_LAYOUT_ID);
        }
        if (layouts.size() > 0) {
          layout=(Layout)layouts.get(0);
          break;
        }
      }
    }
  }
 else {
    Group guestGroup=GroupLocalServiceUtil.getGroup(user.getActualCompanyId(),GroupImpl.GUEST);
    layouts=LayoutLocalServiceUtil.getLayouts(LayoutImpl.PUBLIC + guestGroup.getGroupId(),LayoutImpl.DEFAULT_PARENT_LAYOUT_ID);
    if (layouts.size() > 0) {
      layout=(Layout)layouts.get(0);
    }
  }
  return new Object[]{layout,layouts};
}
