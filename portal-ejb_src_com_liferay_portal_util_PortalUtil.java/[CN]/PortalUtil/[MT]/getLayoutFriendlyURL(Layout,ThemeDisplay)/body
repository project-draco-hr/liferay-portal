{
  if (!isLayoutFriendliable(layout)) {
    return null;
  }
  String layoutFriendlyURL=layout.getFriendlyURL();
  if (Validator.isNull(layoutFriendlyURL)) {
    layoutFriendlyURL=layout.getDefaultFriendlyURL();
  }
  LayoutSet layoutSet=layout.getLayoutSet();
  if (Validator.isNotNull(layoutSet.getVirtualHost())) {
    String portalURL=PortalUtil.getPortalURL(layoutSet.getVirtualHost(),themeDisplay.getServerPort(),themeDisplay.isSecure());
    String contextPath=themeDisplay.getPathContext();
    return portalURL + contextPath + layoutFriendlyURL;
  }
  Group group=GroupLocalServiceUtil.getGroup(layout.getGroupId());
  String parentFriendlyURL=group.getFriendlyURL();
  if (Validator.isNull(parentFriendlyURL)) {
    if (layout.isPrivateLayout() && layout.getGroup().isUser()) {
      String userId=layout.getGroup().getClassPK();
      User user=UserLocalServiceUtil.getUserById(userId);
      parentFriendlyURL=StringPool.SLASH + user.getDisplayUserId();
    }
 else {
      parentFriendlyURL=group.getDefaultFriendlyURL();
    }
  }
  String friendlyURL;
  if (layout.isPrivateLayout()) {
    if (layout.getGroup().isUser()) {
      friendlyURL=themeDisplay.getPathFriendlyURLPrivateUser();
    }
 else {
      friendlyURL=themeDisplay.getPathFriendlyURLPrivate();
    }
  }
 else {
    friendlyURL=themeDisplay.getPathFriendlyURLPublic();
  }
  return friendlyURL + parentFriendlyURL + layoutFriendlyURL;
}
