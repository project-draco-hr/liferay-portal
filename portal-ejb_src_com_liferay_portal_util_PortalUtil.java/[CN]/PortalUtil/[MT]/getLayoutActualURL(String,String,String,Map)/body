{
  Layout layout=null;
  String queryString=StringPool.BLANK;
  if (Validator.isNull(friendlyURL)) {
    List layouts=LayoutLocalServiceUtil.getLayouts(ownerId,LayoutImpl.DEFAULT_PARENT_LAYOUT_ID);
    if (layouts.size() > 0) {
      layout=(Layout)layouts.get(0);
    }
 else {
      throw new NoSuchLayoutException(ownerId + " does not have any layouts");
    }
  }
 else {
    Object[] friendlyURLMapper=getPortletFriendlyURLPlugin(ownerId,friendlyURL,params);
    layout=(Layout)friendlyURLMapper[0];
    queryString=(String)friendlyURLMapper[1];
  }
  String layoutActualURL=PortalUtil.getLayoutActualURL(layout,mainPath);
  if (Validator.isNotNull(queryString)) {
    layoutActualURL=layoutActualURL + queryString;
  }
  return layoutActualURL;
}
