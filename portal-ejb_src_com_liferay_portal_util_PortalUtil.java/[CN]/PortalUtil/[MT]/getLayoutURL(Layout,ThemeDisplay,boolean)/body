{
  String layoutFriendlyURL=getLayoutFriendlyURL(layout,themeDisplay);
  if (Validator.isNotNull(layoutFriendlyURL)) {
    if (doAsUser && Validator.isNotNull(themeDisplay.getDoAsUserId())) {
      layoutFriendlyURL=Http.addParameter(layoutFriendlyURL,"doAsUserId",themeDisplay.getDoAsUserId());
    }
    return layoutFriendlyURL;
  }
  String layoutURL=getLayoutActualURL(layout,themeDisplay);
  if (doAsUser && Validator.isNotNull(themeDisplay.getDoAsUserId())) {
    layoutURL=Http.addParameter(layoutURL,"doAsUserId",themeDisplay.getDoAsUserId());
  }
  return layoutURL;
}
