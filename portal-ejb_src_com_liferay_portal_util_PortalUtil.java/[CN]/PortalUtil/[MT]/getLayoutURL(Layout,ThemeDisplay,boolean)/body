{
  String layoutFriendlyURL=getLayoutFriendlyURL(layout,themeDisplay);
  if (Validator.isNotNull(layoutFriendlyURL)) {
    if (doAsUser && (themeDisplay.getDoAsUserId() > 0)) {
      layoutFriendlyURL=Http.addParameter(layoutFriendlyURL,"doAsUserId",themeDisplay.getDoAsUserId());
    }
    return layoutFriendlyURL;
  }
  String layoutURL=getLayoutActualURL(layout,themeDisplay);
  if (doAsUser && (themeDisplay.getDoAsUserId() > 0)) {
    layoutURL=Http.addParameter(layoutURL,"doAsUserId",themeDisplay.getDoAsUserId());
  }
  return layoutURL;
}
