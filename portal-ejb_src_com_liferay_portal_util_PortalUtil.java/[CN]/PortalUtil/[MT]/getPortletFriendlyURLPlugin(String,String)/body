{
  String friendlyURL=url;
  String queryString=StringPool.BLANK;
  Map friendlyURLMappers=PortletLocalServiceUtil.getFriendlyURLMappers();
  Iterator itr=friendlyURLMappers.entrySet().iterator();
  while (itr.hasNext()) {
    Map.Entry entry=(Map.Entry)itr.next();
    String className=(String)entry.getValue();
    FriendlyURLMapper friendlyURLMapper=(FriendlyURLMapper)InstancePool.get(className);
    if (url.endsWith(StringPool.SLASH + friendlyURLMapper.getMapping())) {
      url+=StringPool.SLASH;
    }
    int pos=url.indexOf(StringPool.SLASH + friendlyURLMapper.getMapping() + StringPool.SLASH);
    if (pos != -1) {
      String[] values=friendlyURLMapper.getValues(url,pos);
      friendlyURL=values[0];
      queryString=values[1];
      break;
    }
  }
  friendlyURL=StringUtil.replace(friendlyURL,"//",StringPool.SLASH);
  if (friendlyURL.endsWith(StringPool.SLASH)) {
    friendlyURL=friendlyURL.substring(0,friendlyURL.length() - 1);
  }
  Layout layout=null;
  try {
    layout=LayoutLocalServiceUtil.getFriendlyURLLayout(ownerId,friendlyURL);
  }
 catch (  NoSuchLayoutException nsle) {
    String layoutId=friendlyURL.substring(1);
    layout=LayoutLocalServiceUtil.getLayout(layoutId,ownerId);
  }
  return new Object[]{layout,queryString};
}
