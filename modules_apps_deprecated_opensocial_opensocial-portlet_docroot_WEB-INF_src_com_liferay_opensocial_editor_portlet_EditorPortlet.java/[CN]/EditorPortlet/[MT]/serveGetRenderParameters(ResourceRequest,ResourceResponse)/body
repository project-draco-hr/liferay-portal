{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  String fileEntryURL=ParamUtil.getString(resourceRequest,"fileEntryURL");
  GadgetSpec gadgetSpec=ShindigUtil.getGadgetSpec(fileEntryURL,true,true);
  ModulePrefs modulePrefs=gadgetSpec.getModulePrefs();
  jsonObject.put("height",modulePrefs.getHeight());
  long moduleId=ShindigUtil.getModuleId(resourceResponse.getNamespace());
  jsonObject.put("moduleId",moduleId);
  Map<String,Feature> features=modulePrefs.getFeatures();
  boolean requiresPubsub=features.containsKey("pubsub-2");
  jsonObject.put("requiresPubsub",requiresPubsub);
  boolean scrolling=modulePrefs.getScrolling();
  jsonObject.put("scrolling",scrolling);
  String ownerId=ShindigUtil.getOwnerId(themeDisplay.getLayout());
  String portalURL=PortalUtil.getPortalURL(themeDisplay);
  String currentURL=PortalUtil.getCurrentURL(resourceRequest);
  String secureToken=ShindigUtil.createSecurityToken(ownerId,themeDisplay.getUserId(),fileEntryURL,portalURL,fileEntryURL,moduleId,currentURL);
  jsonObject.put("secureToken",secureToken);
  jsonObject.put("specUrl",fileEntryURL);
  writeJSON(resourceRequest,resourceResponse,jsonObject);
}
