{
  if (checkLayoutUpdateable && !actionId.equals(ActionKeys.CUSTOMIZE) && !actionId.equals(ActionKeys.VIEW)&& (layout instanceof VirtualLayout)) {
    return false;
  }
  if (actionId.equals(ActionKeys.CUSTOMIZE) && (layout instanceof VirtualLayout)) {
    VirtualLayout virtualLayout=(VirtualLayout)layout;
    layout=virtualLayout.getWrappedModel();
  }
  if (actionId.equals(ActionKeys.DELETE) && !SitesUtil.isLayoutDeleteable(layout)) {
    return false;
  }
  Group group=layout.getGroup();
  if (checkLayoutUpdateable && !group.isLayoutSetPrototype() && isAttemptToModifyLockedLayout(layout,actionId)) {
    return false;
  }
  User user=UserLocalServiceUtil.getUserById(permissionChecker.getUserId());
  if (!user.isDefaultUser() && !group.isUser()) {
    ResourcePermission resourcePermission=ResourcePermissionLocalServiceUtil.getResourcePermission(layout.getCompanyId(),Layout.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(layout.getPlid()),permissionChecker.getOwnerRoleId());
    if (permissionChecker.hasOwnerPermission(layout.getCompanyId(),Layout.class.getName(),String.valueOf(layout.getPlid()),resourcePermission.getOwnerId(),actionId)) {
      return true;
    }
  }
  if (GroupPermissionUtil.contains(permissionChecker,layout.getGroupId(),ActionKeys.MANAGE_LAYOUTS)) {
    return true;
  }
 else   if (actionId.equals(ActionKeys.ADD_LAYOUT) && GroupPermissionUtil.contains(permissionChecker,layout.getGroupId(),ActionKeys.ADD_LAYOUT)) {
    return true;
  }
  if (PropsValues.PERMISSIONS_VIEW_DYNAMIC_INHERITANCE && !actionId.equals(ActionKeys.VIEW)) {
    long parentLayoutId=layout.getParentLayoutId();
    while (parentLayoutId != LayoutConstants.DEFAULT_PARENT_LAYOUT_ID) {
      Layout parentLayout=LayoutLocalServiceUtil.getLayout(layout.getGroupId(),layout.isPrivateLayout(),parentLayoutId);
      if (contains(permissionChecker,parentLayout,controlPanelCategory,actionId)) {
        return true;
      }
      parentLayoutId=parentLayout.getParentLayoutId();
    }
  }
  if (ResourcePermissionLocalServiceUtil.getResourcePermissionsCount(layout.getCompanyId(),Layout.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(layout.getPlid())) == 0) {
    boolean addGroupPermission=true;
    boolean addGuestPermission=true;
    if (layout.isPrivateLayout()) {
      addGuestPermission=false;
    }
    ResourceLocalServiceUtil.addResources(layout.getCompanyId(),layout.getGroupId(),0,Layout.class.getName(),layout.getPlid(),false,addGroupPermission,addGuestPermission);
  }
  return permissionChecker.hasPermission(layout.getGroupId(),Layout.class.getName(),layout.getPlid(),actionId);
}
