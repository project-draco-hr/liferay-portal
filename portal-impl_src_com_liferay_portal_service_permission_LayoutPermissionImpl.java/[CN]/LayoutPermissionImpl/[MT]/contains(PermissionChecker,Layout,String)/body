{
  if ((layout.isPrivateLayout() && !PropsValues.LAYOUT_USER_PRIVATE_LAYOUTS_MODIFIABLE) || (layout.isPublicLayout() && !PropsValues.LAYOUT_USER_PUBLIC_LAYOUTS_MODIFIABLE)) {
    if (actionId.equals(ActionKeys.UPDATE)) {
      Group group=GroupLocalServiceUtil.getGroup(layout.getGroupId());
      if (group.isUser()) {
        return false;
      }
    }
  }
  try {
    Group group=layout.getGroup();
    if (!group.isLayoutSetPrototype() && SitesUtil.isLayoutLocked(layout) && (ActionKeys.CUSTOMIZE.equals(actionId) || ActionKeys.UPDATE.equals(actionId))) {
      return false;
    }
  }
 catch (  Exception e) {
  }
  if (GroupPermissionUtil.contains(permissionChecker,layout.getGroupId(),ActionKeys.MANAGE_LAYOUTS)) {
    return true;
  }
  try {
    if (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 6) {
      if (ResourcePermissionLocalServiceUtil.getResourcePermissionsCount(layout.getCompanyId(),Layout.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(layout.getPlid())) == 0) {
        throw new NoSuchResourceException();
      }
    }
 else {
      ResourceLocalServiceUtil.getResource(layout.getCompanyId(),Layout.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(layout.getPlid()));
    }
  }
 catch (  NoSuchResourceException nsre) {
    boolean addGroupPermission=true;
    boolean addGuestPermission=true;
    if (layout.isPrivateLayout()) {
      addGuestPermission=false;
    }
    ResourceLocalServiceUtil.addResources(layout.getCompanyId(),layout.getGroupId(),0,Layout.class.getName(),layout.getPlid(),false,addGroupPermission,addGuestPermission);
  }
  return permissionChecker.hasPermission(layout.getGroupId(),Layout.class.getName(),layout.getPlid(),actionId);
}
