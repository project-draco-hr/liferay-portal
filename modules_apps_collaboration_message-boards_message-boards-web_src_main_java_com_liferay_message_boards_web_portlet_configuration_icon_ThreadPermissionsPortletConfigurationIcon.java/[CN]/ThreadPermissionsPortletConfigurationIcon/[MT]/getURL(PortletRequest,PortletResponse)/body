{
  String url=StringPool.BLANK;
  try {
    MBMessage rootMessage=null;
    MBMessageDisplay messageDisplay=ActionUtil.getMessageDisplay(portletRequest);
    MBMessage message=messageDisplay.getMessage();
    if (message.isRoot()) {
      rootMessage=message;
    }
 else {
      rootMessage=_mbMessageLocalService.getMessage(message.getRootMessageId());
    }
    String modelResource=MBMessage.class.getName();
    String modelResourceDescription=rootMessage.getSubject();
    MBThread thread=messageDisplay.getThread();
    String resourcePrimKey=String.valueOf(thread.getRootMessageId());
    ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
    url=PermissionsURLTag.doTag(StringPool.BLANK,modelResource,modelResourceDescription,null,resourcePrimKey,LiferayWindowState.POP_UP.toString(),null,themeDisplay.getRequest());
  }
 catch (  Exception e) {
  }
  return url;
}
