{
  try {
    request.setAttribute(_IS_WSRP_REQ,"true");
    String portletId=(String)request.getAttribute(_PORTAL_ID_STRING);
    Portlet portlet=PortletLocalServiceUtil.getPortletById(PortalInstances.getCompanyId(request),portletId);
    PortletWindowContext portletWindowContext=new PortletWindowContextImpl(request,portlet,PortletRequest.ACTION_PHASE);
    initializeLiferayRequest(request);
    return portletWindowContext;
  }
 catch (  Exception e) {
    throw new ProducerException(e);
  }
}
