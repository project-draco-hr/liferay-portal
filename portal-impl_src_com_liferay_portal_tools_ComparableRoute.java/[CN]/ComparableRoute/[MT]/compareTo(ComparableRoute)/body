{
  String[] myFragments=_pattern.split("[/\\.](?!\\*)");
  String[] theirFragments=r.getPattern().split("[/\\.](?!\\*)");
  int i;
  for (i=0; i < myFragments.length && i < theirFragments.length; i++) {
    String myFragment=myFragments[i];
    String theirFragment=theirFragments[i];
    boolean iCapture=isCaptureFragment(myFragment);
    boolean theyCapture=isCaptureFragment(theirFragment);
    if (theyCapture && !iCapture) {
      return -1;
    }
    if (iCapture && !theyCapture) {
      return 1;
    }
    boolean iMatchAny=isMatchAny(myFragment);
    boolean theyMatchAny=isMatchAny(theirFragment);
    if (theyMatchAny && !iMatchAny) {
      return -1;
    }
    if (iMatchAny && !theyMatchAny) {
      return 1;
    }
    boolean iRegex=hasRegex(myFragment);
    boolean theyRegex=hasRegex(theirFragment);
    if (iRegex && !theyRegex) {
      return -1;
    }
    if (theyRegex && !iRegex) {
      return 1;
    }
  }
  if (i < theirFragments.length && i >= myFragments.length) {
    return -1;
  }
  if (i < myFragments.length && i >= theirFragments.length) {
    return 1;
  }
  int myImplicitCount=_implicitParameters.size();
  int theirImplicitCount=r.getImplicitParameters().size();
  if (myImplicitCount > theirImplicitCount) {
    return -1;
  }
  if (theirImplicitCount > myImplicitCount) {
    return 1;
  }
  return _pattern.compareTo(r.getPattern());
}
