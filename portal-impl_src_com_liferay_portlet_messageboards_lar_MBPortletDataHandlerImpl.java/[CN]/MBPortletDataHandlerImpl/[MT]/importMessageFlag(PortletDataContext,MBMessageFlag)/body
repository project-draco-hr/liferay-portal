{
  long userId=portletDataContext.getUserId(flag.getUserUuid());
  Map<Long,Long> messagePKs=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(MBMessage.class);
  long messageId=MapUtil.getLong(messagePKs,flag.getMessageId(),flag.getMessageId());
  MBMessage message=MBMessageUtil.findByPrimaryKey(messageId);
  MBThread thread=message.getThread();
  MBMessageFlagLocalServiceUtil.addReadFlags(userId,thread);
}
