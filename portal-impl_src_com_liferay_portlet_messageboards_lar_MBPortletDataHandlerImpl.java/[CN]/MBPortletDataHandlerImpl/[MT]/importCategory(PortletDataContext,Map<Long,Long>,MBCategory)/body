{
  long userId=context.getUserId(category.getUserUuid());
  long plid=context.getPlid();
  long parentCategoryId=MapUtil.getLong(categoryPKs,category.getParentCategoryId(),category.getParentCategoryId());
  boolean addCommunityPermissions=true;
  boolean addGuestPermissions=true;
  MBCategory existingCategory=null;
  try {
    if (parentCategoryId != MBCategoryImpl.DEFAULT_PARENT_CATEGORY_ID) {
      MBCategoryUtil.findByPrimaryKey(parentCategoryId);
    }
    if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
      existingCategory=MBCategoryUtil.fetchByUUID_G(category.getUuid(),context.getGroupId());
      if (existingCategory == null) {
        existingCategory=MBCategoryLocalServiceUtil.addCategory(category.getUuid(),userId,plid,parentCategoryId,category.getName(),category.getDescription(),addCommunityPermissions,addGuestPermissions);
      }
 else {
        existingCategory=MBCategoryLocalServiceUtil.updateCategory(existingCategory.getCategoryId(),parentCategoryId,category.getName(),category.getDescription(),false);
      }
    }
 else {
      existingCategory=MBCategoryLocalServiceUtil.addCategory(userId,plid,parentCategoryId,category.getName(),category.getDescription(),addCommunityPermissions,addGuestPermissions);
    }
    categoryPKs.put(category.getCategoryId(),existingCategory.getCategoryId());
  }
 catch (  NoSuchCategoryException nsce) {
    _log.error("Could not find the parent category for category " + category.getCategoryId());
  }
}
