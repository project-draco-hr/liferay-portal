{
  long userId=context.getUserId(category.getUserUuid());
  long parentCategoryId=MapUtil.getLong(categoryPKs,category.getParentCategoryId(),category.getParentCategoryId());
  String emailAddress=null;
  String inProtocol=null;
  String inServerName=null;
  int inServerPort=0;
  boolean inUseSSL=false;
  String inUserName=null;
  String inPassword=null;
  int inReadInterval=0;
  String outEmailAddress=null;
  boolean outCustom=false;
  String outServerName=null;
  int outServerPort=0;
  boolean outUseSSL=false;
  String outUserName=null;
  String outPassword=null;
  boolean mailingListActive=false;
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddCommunityPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  serviceContext.setScopeGroupId(context.getGroupId());
  if ((parentCategoryId != MBCategoryConstants.DEFAULT_PARENT_CATEGORY_ID) && (parentCategoryId == category.getParentCategoryId())) {
    String path=getImportCategoryPath(context,parentCategoryId);
    MBCategory parentCategory=(MBCategory)context.getZipEntryAsObject(path);
    importCategory(context,categoryPKs,parentCategory);
    parentCategoryId=MapUtil.getLong(categoryPKs,category.getParentCategoryId(),category.getParentCategoryId());
  }
  MBCategory importedCategory=null;
  try {
    if (parentCategoryId != MBCategoryConstants.DEFAULT_PARENT_CATEGORY_ID) {
      MBCategoryUtil.findByPrimaryKey(parentCategoryId);
    }
    if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
      MBCategory existingCategory=MBCategoryUtil.fetchByUUID_G(category.getUuid(),context.getGroupId());
      if (existingCategory == null) {
        importedCategory=MBCategoryLocalServiceUtil.addCategory(category.getUuid(),userId,parentCategoryId,category.getName(),category.getDescription(),emailAddress,inProtocol,inServerName,inServerPort,inUseSSL,inUserName,inPassword,inReadInterval,outEmailAddress,outCustom,outServerName,outServerPort,outUseSSL,outUserName,outPassword,mailingListActive,serviceContext);
      }
 else {
        importedCategory=MBCategoryLocalServiceUtil.updateCategory(existingCategory.getCategoryId(),parentCategoryId,category.getName(),category.getDescription(),emailAddress,inProtocol,inServerName,inServerPort,inUseSSL,inUserName,inPassword,inReadInterval,outEmailAddress,outCustom,outServerName,outServerPort,outUseSSL,outUserName,outPassword,mailingListActive,false,serviceContext);
      }
    }
 else {
      importedCategory=MBCategoryLocalServiceUtil.addCategory(userId,parentCategoryId,category.getName(),category.getDescription(),emailAddress,inProtocol,inServerName,inServerPort,inUseSSL,inUserName,inPassword,inReadInterval,outEmailAddress,outCustom,outServerName,outServerPort,outUseSSL,outUserName,outPassword,mailingListActive,serviceContext);
    }
    categoryPKs.put(category.getCategoryId(),importedCategory.getCategoryId());
    context.importPermissions(MBCategory.class,category.getCategoryId(),importedCategory.getCategoryId());
  }
 catch (  NoSuchCategoryException nsce) {
    _log.error("Could not find the parent category for category " + category.getCategoryId());
  }
}
