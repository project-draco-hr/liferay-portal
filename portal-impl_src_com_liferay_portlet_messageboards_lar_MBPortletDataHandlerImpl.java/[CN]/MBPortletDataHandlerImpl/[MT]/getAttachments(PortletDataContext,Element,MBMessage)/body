{
  List<ObjectValuePair<String,File>> ovps=new ArrayList<ObjectValuePair<String,File>>();
  if (!(message.isAttachments() && portletDataContext.getBooleanParameter(_NAMESPACE,"attachments"))) {
    return ovps;
  }
  List<File> files=new ArrayList<File>();
  try {
    List<Element> attachmentElements=messageElement.elements("attachment");
    for (    Element attachmentElement : attachmentElements) {
      String name=attachmentElement.attributeValue("name");
      String binPath=attachmentElement.attributeValue("bin-path");
      InputStream is=portletDataContext.getZipEntryAsInputStream(binPath);
      File file=FileUtil.createTempFile(FileUtil.getExtension(name));
      files.add(file);
      FileUtil.write(file,is);
      ovps.add(new ObjectValuePair<String,File>(name,file));
    }
    if (ovps.size() <= 0) {
      _log.error("Could not find attachments for message " + message.getMessageId());
    }
    return ovps;
  }
 catch (  IOException ioe) {
    for (    File file : files) {
      FileUtil.delete(file);
    }
    throw ioe;
  }
}
