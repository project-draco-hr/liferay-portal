{
  if (!message.isAttachments() && portletDataContext.getBooleanParameter(_NAMESPACE,"attachments")) {
    return Collections.emptyList();
  }
  List<ObjectValuePair<String,InputStream>> ovps=new ArrayList<ObjectValuePair<String,InputStream>>();
  List<Element> attachmentElements=messageElement.elements("attachment");
  for (  Element attachmentElement : attachmentElements) {
    String name=attachmentElement.attributeValue("name");
    String binPath=attachmentElement.attributeValue("bin-path");
    InputStream is=portletDataContext.getZipEntryAsInputStream(binPath);
    ovps.add(new ObjectValuePair<String,InputStream>(name,is));
  }
  if (ovps.isEmpty()) {
    _log.error("Could not find attachments for message " + message.getMessageId());
  }
  return ovps;
}
