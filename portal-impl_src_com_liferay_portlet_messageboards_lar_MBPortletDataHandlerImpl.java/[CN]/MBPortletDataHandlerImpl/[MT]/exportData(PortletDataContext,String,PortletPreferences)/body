{
  try {
    context.addPermissions("com.liferay.portlet.messageboards",context.getGroupId());
    Document doc=SAXReaderUtil.createDocument();
    Element root=doc.addElement("message-boards-data");
    root.addAttribute("group-id",String.valueOf(context.getGroupId()));
    Element categoriesEl=root.addElement("categories");
    Element messagesEl=root.addElement("messages");
    Element messageFlagsEl=root.addElement("message-flags");
    Element userBansEl=root.addElement("user-bans");
    List<MBCategory> categories=MBCategoryUtil.findByGroupId(context.getGroupId());
    for (    MBCategory category : categories) {
      exportCategory(context,categoriesEl,messagesEl,messageFlagsEl,category);
    }
    List<MBMessage> messages=MBMessageUtil.findByG_C(context.getGroupId(),MBCategoryConstants.DEFAULT_PARENT_CATEGORY_ID);
    for (    MBMessage message : messages) {
      exportMessage(context,categoriesEl,messagesEl,messageFlagsEl,message);
    }
    if (context.getBooleanParameter(_NAMESPACE,"user-bans")) {
      List<MBBan> bans=MBBanUtil.findByGroupId(context.getGroupId());
      for (      MBBan ban : bans) {
        exportUserBan(context,userBansEl,ban);
      }
    }
    return doc.formattedString();
  }
 catch (  Exception e) {
    throw new PortletDataException(e);
  }
}
