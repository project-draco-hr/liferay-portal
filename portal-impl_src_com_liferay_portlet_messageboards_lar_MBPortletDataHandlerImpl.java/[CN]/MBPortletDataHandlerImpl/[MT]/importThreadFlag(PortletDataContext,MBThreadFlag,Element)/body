{
  long userId=portletDataContext.getUserId(threadFlag.getUserUuid());
  Map<Long,Long> messagePKs=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(MBMessage.class);
  long threadId=MapUtil.getLong(messagePKs,threadFlag.getThreadId(),threadFlag.getThreadId());
  MBThread thread=MBThreadUtil.fetchByPrimaryKey(threadId);
  if (thread == null) {
    String threadRootMessageUuid=threadFlagElement.attributeValue("threadRootMessageUuid");
    MBMessage threadRootMessage=MBMessageUtil.fetchByUUID_G(threadRootMessageUuid,portletDataContext.getScopeGroupId());
    if (threadRootMessage != null) {
      thread=threadRootMessage.getThread();
    }
  }
  if (thread == null) {
    return;
  }
  MBThreadFlagLocalServiceUtil.addThreadFlag(userId,thread);
}
