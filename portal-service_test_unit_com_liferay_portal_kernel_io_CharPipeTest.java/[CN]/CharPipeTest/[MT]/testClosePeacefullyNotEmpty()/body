{
  CharPipe charPipe=new CharPipe();
  Writer writer=charPipe.getWriter();
  writer.write("abcd");
  Assert.assertFalse(charPipe.finished);
  charPipe.close();
  Assert.assertNotNull(charPipe.buffer);
  Assert.assertTrue(charPipe.finished);
  char[] buffer=new char[5];
  Reader reader=charPipe.getReader();
  int result=reader.read(buffer);
  Assert.assertEquals(4,result);
  Assert.assertEquals('a',buffer[0]);
  Assert.assertEquals('b',buffer[1]);
  Assert.assertEquals('c',buffer[2]);
  Assert.assertEquals('d',buffer[3]);
  Assert.assertEquals(0,buffer[4]);
  Assert.assertEquals(-1,reader.read());
}
