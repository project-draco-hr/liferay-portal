{
  CharPipe charPipe=new CharPipe();
  Writer writer=charPipe.getWriter();
  writer.write("abcd");
  assertFalse(charPipe.finished);
  charPipe.close();
  assertNotNull(charPipe.buffer);
  assertTrue(charPipe.finished);
  char[] buffer=new char[5];
  Reader reader=charPipe.getReader();
  int result=reader.read(buffer);
  assertEquals(4,result);
  assertEquals('a',buffer[0]);
  assertEquals('b',buffer[1]);
  assertEquals('c',buffer[2]);
  assertEquals('d',buffer[3]);
  assertEquals(0,buffer[4]);
  assertEquals(-1,reader.read());
}
