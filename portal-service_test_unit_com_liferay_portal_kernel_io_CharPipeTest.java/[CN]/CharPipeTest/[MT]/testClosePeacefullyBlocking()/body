{
  final CharPipe charPipe=new CharPipe();
  Reader reader=charPipe.getReader();
  final AtomicLong timestampBeforeClose=new AtomicLong();
  Thread thread=new Thread(){
    @Override public void run(){
      try {
        timestampBeforeClose.set(System.currentTimeMillis());
        charPipe.close();
      }
 catch (      Exception e) {
        Assert.fail(e.getMessage());
      }
    }
  }
;
  thread.start();
  int result=reader.read();
  long timestampAfterRead=System.currentTimeMillis();
  thread.join();
  Assert.assertEquals(-1,result);
  Assert.assertTrue(timestampAfterRead >= timestampBeforeClose.get());
}
