{
  final CharPipe charPipe=new CharPipe();
  Reader reader=charPipe.getReader();
  final AtomicLong timestampBeforeClose=new AtomicLong();
  SyncThrowableThread<Void> syncThrowableThread=new SyncThrowableThread<>(new Callable<Void>(){
    @Override public Void call() throws Exception {
      timestampBeforeClose.set(System.currentTimeMillis());
      charPipe.close();
      return null;
    }
  }
);
  syncThrowableThread.start();
  int result=reader.read();
  long timestampAfterRead=System.currentTimeMillis();
  syncThrowableThread.sync();
  Assert.assertEquals(-1,result);
  Assert.assertTrue(timestampAfterRead >= timestampBeforeClose.get());
}
