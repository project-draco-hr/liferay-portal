{
  Release release=releaseLocalService.fetchRelease(servletContextName);
  if (release == null) {
    if (previousSchemaVersion.equals("0.0.0")) {
      release=releaseLocalService.addRelease(servletContextName,previousSchemaVersion);
    }
 else {
      throw new IllegalStateException("Unable to update release because it does not exist");
    }
  }
  String currentSchemaVersion=release.getSchemaVersion();
  if (Validator.isNull(currentSchemaVersion)) {
    currentSchemaVersion="0.0.0";
  }
  if (!previousSchemaVersion.equals(currentSchemaVersion)) {
    StringBundler sb=new StringBundler(5);
    sb.append("Unable to update release because the previous schema ");
    sb.append("version ");
    sb.append(previousSchemaVersion);
    sb.append(" does not match the expected schema version ");
    sb.append(currentSchemaVersion);
    throw new IllegalStateException(sb.toString());
  }
  release.setSchemaVersion(schemaVersion);
  releasePersistence.update(release);
}
