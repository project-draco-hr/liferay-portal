{
  Release release=releaseLocalService.fetchRelease(servletContextName);
  if (release == null) {
    if (previousVersion.equals("0.0.0")) {
      release=releaseLocalService.addRelease(servletContextName,previousVersion);
    }
 else {
      throw new IllegalStateException("Unable to update release because it does not exist");
    }
  }
  if (!previousVersion.equals(release.getVersion())) {
    throw new IllegalStateException("Unable to update release because the previous version " + previousVersion + " does not match the expected version "+ release.getVersion());
  }
  release.setVersion(version);
  releasePersistence.update(release);
}
