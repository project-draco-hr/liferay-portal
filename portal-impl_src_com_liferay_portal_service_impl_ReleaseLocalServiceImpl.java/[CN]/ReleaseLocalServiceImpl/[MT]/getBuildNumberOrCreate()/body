{
  DB db=DBFactoryUtil.getDB();
  try {
    db.runSQL("alter table Release_ add version VARCHAR(75) null");
    populateVersion();
  }
 catch (  Exception e) {
    if (_log.isDebugEnabled()) {
      _log.debug(e.getMessage());
    }
  }
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getConnection();
    ps=con.prepareStatement(_GET_BUILD_NUMBER);
    ps.setLong(1,ReleaseConstants.DEFAULT_ID);
    rs=ps.executeQuery();
    if (rs.next()) {
      int buildNumber=rs.getInt("buildNumber");
      if (_log.isDebugEnabled()) {
        _log.debug("Build number " + buildNumber);
      }
      try {
        db.runSQL("alter table Release_ add state_ INTEGER");
      }
 catch (      Exception e) {
        if (_log.isDebugEnabled()) {
          _log.debug(e.getMessage());
        }
      }
      testSupportsStringCaseSensitiveQuery();
      return buildNumber;
    }
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(e.getMessage());
    }
  }
 finally {
    DataAccess.cleanUp(con,ps,rs);
  }
  if (GetterUtil.getBoolean(PropsUtil.get(PropsKeys.SCHEMA_RUN_ENABLED))) {
    releaseLocalService.createTablesAndPopulate();
    testSupportsStringCaseSensitiveQuery();
    Release release=fetchRelease(ReleaseConstants.DEFAULT_SERVLET_CONTEXT_NAME);
    return release.getBuildNumber();
  }
 else {
    throw new NoSuchReleaseException("The database needs to be populated");
  }
}
