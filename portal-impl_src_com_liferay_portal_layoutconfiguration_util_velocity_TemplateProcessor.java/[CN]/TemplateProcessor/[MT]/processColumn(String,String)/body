{
  ThemeDisplay themeDisplay=(ThemeDisplay)_request.getAttribute(WebKeys.THEME_DISPLAY);
  LayoutTypePortlet layoutTypePortlet=themeDisplay.getLayoutTypePortlet();
  List<Portlet> portlets=layoutTypePortlet.getAllPortlets(columnId);
  StringBundler sb=new StringBundler(portlets.size() * 3 + 10);
  sb.append("<div class=\"portlet-dropzone");
  if (layoutTypePortlet.isCustomizable() && layoutTypePortlet.isColumnDisabled(columnId)) {
    sb.append(" portlet-dropzone-disabled");
  }
  if (layoutTypePortlet.isColumnCustomizable(columnId)) {
    sb.append(" customizable");
  }
  if (portlets.isEmpty()) {
    sb.append(" empty");
  }
  if (Validator.isNotNull(classNames)) {
    sb.append(" ");
    sb.append(classNames);
  }
  sb.append("\" id=\"layout-column_");
  sb.append(columnId);
  sb.append("\">");
  for (int i=0; i < portlets.size(); i++) {
    Portlet portlet=portlets.get(i);
    Integer columnCount=Integer.valueOf(portlets.size());
    Integer columnPos=Integer.valueOf(i);
    PortletRenderer portletRenderer=new PortletRenderer(portlet,columnId,columnCount,columnPos);
    if (_portletAjaxRender && (portlet.getRenderWeight() < 1)) {
      StringBundler renderResult=portletRenderer.renderAjax(_request,_response);
      sb.append(renderResult);
    }
 else {
      Integer renderWeight=portlet.getRenderWeight();
      List<PortletRenderer> portletRenderers=_portletRenderers.get(renderWeight);
      if (portletRenderers == null) {
        portletRenderers=new ArrayList<>();
        _portletRenderers.put(renderWeight,portletRenderers);
      }
      portletRenderers.add(portletRenderer);
      sb.append("[$TEMPLATE_PORTLET_");
      sb.append(portlet.getPortletId());
      sb.append("$]");
    }
  }
  sb.append("</div>");
  return sb.toString();
}
