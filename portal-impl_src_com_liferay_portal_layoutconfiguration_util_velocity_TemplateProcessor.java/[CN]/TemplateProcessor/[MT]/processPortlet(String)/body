{
  _request.setAttribute(WebKeys.RENDER_PORTLET_RESOURCE,Boolean.TRUE);
  BufferCacheServletResponse bufferCacheServletResponse=new BufferCacheServletResponse(_response);
  ThemeDisplay themeDisplay=(ThemeDisplay)_request.getAttribute(WebKeys.THEME_DISPLAY);
  Portlet portlet=PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),portletId);
  JSONObject jsonObject=null;
  jsonObject=JSONFactoryUtil.createJSONObject();
  PortletJSONUtil.populatePortletJSONObject(_request,StringPool.BLANK,portlet,jsonObject);
  try {
    if (jsonObject != null) {
      writeHeaderPaths(_response,jsonObject);
    }
    PortletContainerUtil.render(_request,bufferCacheServletResponse,portlet);
    if (jsonObject != null) {
      writeFooterPaths(_response,jsonObject);
    }
    return bufferCacheServletResponse.getString();
  }
  finally {
    _request.removeAttribute(WebKeys.RENDER_PORTLET_RESOURCE);
  }
}
