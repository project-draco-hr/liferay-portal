{
  final List<String> expectedList=new ArrayList<>();
  for (  Map.Entry<Group,Integer> entry : frequencies.entrySet()) {
    Group group=entry.getKey();
    expectedList.add(group.getGroupId() + "=" + entry.getValue());
  }
  Collections.sort(expectedList);
  IdempotentRetryAssert.retryAssert(10,TimeUnit.SECONDS,new Callable<Void>(){
    @Override public Void call() throws Exception {
      FacetedSearcher facetedSearcher=createFacetedSearcher();
      facetedSearcher.search(searchContext);
      Map<String,Facet> facets=searchContext.getFacets();
      Facet facet=facets.get(Field.GROUP_ID);
      FacetCollector facetCollector=facet.getFacetCollector();
      List<String> actualList=new ArrayList<>();
      List<TermCollector> termCollectors=facetCollector.getTermCollectors();
      for (      TermCollector termCollector : termCollectors) {
        actualList.add(termCollector.getTerm() + "=" + termCollector.getFrequency());
      }
      Collections.sort(actualList);
      Assert.assertEquals(expectedList.toString(),actualList.toString());
      return null;
    }
  }
);
}
