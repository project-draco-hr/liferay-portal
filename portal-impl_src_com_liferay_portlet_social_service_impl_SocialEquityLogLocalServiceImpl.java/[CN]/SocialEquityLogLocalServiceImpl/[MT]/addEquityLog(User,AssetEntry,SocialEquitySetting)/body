{
  int actionDate=getActionDate();
  double k=getK(equitySetting.getValue(),equitySetting.getValidity());
  double b=getB(actionDate,equitySetting.getValue(),equitySetting.getValidity());
  String[] sqls=getAddEquityLogSQLs(user,assetEntry,equitySetting,actionDate,k,b);
  for (  String sql : sqls) {
    runSQL(sql);
  }
  long equityLogId=counterLocalService.increment();
  SocialEquityLog equityLog=socialEquityLogPersistence.create(equityLogId);
  equityLog.setGroupId(assetEntry.getGroupId());
  equityLog.setCompanyId(user.getCompanyId());
  equityLog.setUserId(user.getUserId());
  equityLog.setAssetEntryId(assetEntry.getEntryId());
  equityLog.setActionId(equitySetting.getActionId());
  equityLog.setActionDate(actionDate);
  equityLog.setType(equitySetting.getType());
  equityLog.setValue(equitySetting.getValue());
  equityLog.setValidity(actionDate + equitySetting.getValidity());
  equityLog.setActive(true);
  socialEquityLogPersistence.update(equityLog,false);
}
