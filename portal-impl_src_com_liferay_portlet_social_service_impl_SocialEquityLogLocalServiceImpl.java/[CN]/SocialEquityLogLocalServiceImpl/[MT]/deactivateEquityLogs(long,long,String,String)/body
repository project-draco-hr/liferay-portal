{
  if (!PropsValues.SOCIAL_EQUITY_EQUITY_LOG_ENABLED) {
    return;
  }
  User user=userPersistence.findByPrimaryKey(userId);
  AssetEntry assetEntry=assetEntryPersistence.findByPrimaryKey(assetEntryId);
  if (isSocialEquityEnabled(assetEntry.getGroupId(),assetEntry.getClassName(),SocialEquitySettingConstants.TYPE_INFORMATION)) {
    List<SocialEquityLog> equityLogs=socialEquityLogPersistence.findByAEI_AID_A_T_E(assetEntryId,actionId,true,SocialEquitySettingConstants.TYPE_INFORMATION,extraData);
    SocialEquityValue socialEquityValue=new SocialEquityValue(0,0);
    for (    SocialEquityLog equityLog : equityLogs) {
      double k=calculateK(equityLog.getValue(),equityLog.getLifespan());
      double b=calculateB(equityLog.getActionDate(),equityLog.getValue(),equityLog.getLifespan());
      socialEquityValue.subtract(new SocialEquityValue(k,b));
      socialEquityLogPersistence.remove(equityLog);
    }
    socialEquityLogLocalService.incrementSocialEquityAssetEntry_IQ(assetEntryId,socialEquityValue);
    socialEquityLogLocalService.incrementSocialEquityUser_CQ(assetEntry.getGroupId(),assetEntry.getUserId(),socialEquityValue);
  }
  if (isSocialEquityEnabled(assetEntry.getGroupId(),assetEntry.getClassName(),SocialEquitySettingConstants.TYPE_PARTICIPATION)) {
    List<SocialEquityLog> equityLogs=socialEquityLogPersistence.findByU_AID_A_T_E(userId,actionId,true,SocialEquitySettingConstants.TYPE_PARTICIPATION,extraData);
    SocialEquityValue socialEquityValue=new SocialEquityValue(0,0);
    for (    SocialEquityLog equityLog : equityLogs) {
      double k=calculateK(equityLog.getValue(),equityLog.getLifespan());
      double b=calculateB(equityLog.getActionDate(),equityLog.getValue(),equityLog.getLifespan());
      socialEquityValue.subtract(new SocialEquityValue(k,b));
      socialEquityLogPersistence.remove(equityLog);
    }
    socialEquityLogLocalService.incrementSocialEquityUser_PQ(user.getGroup().getGroupId(),userId,socialEquityValue);
  }
}
