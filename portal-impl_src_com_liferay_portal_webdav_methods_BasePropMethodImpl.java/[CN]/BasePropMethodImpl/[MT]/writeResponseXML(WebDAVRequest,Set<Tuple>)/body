{
  WebDAVStorage storage=webDavRequest.getWebDAVStorage();
  long depth=WebDAVUtil.getDepth(webDavRequest.getHttpServletRequest());
  Document doc=SAXReaderUtil.createDocument();
  Element multistatus=SAXReaderUtil.createElement(SAXReaderUtil.createQName("multistatus",WebDAVUtil.DAV_URI));
  doc.setRootElement(multistatus);
  Resource resource=storage.getResource(webDavRequest);
  if (resource != null) {
    addResponse(storage,webDavRequest,resource,props,multistatus,depth);
    String xml=doc.formattedString(StringPool.FOUR_SPACES);
    if (_log.isDebugEnabled()) {
      _log.debug("Response XML\n" + xml);
    }
    int status=WebDAVUtil.SC_MULTI_STATUS;
    HttpServletResponse response=webDavRequest.getHttpServletResponse();
    response.setContentType(ContentTypes.TEXT_XML_UTF8);
    response.setStatus(status);
    if (_log.isInfoEnabled()) {
      _log.info("Status code " + status);
    }
    try {
      ServletResponseUtil.write(response,xml);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn(e);
      }
    }
    return -1;
  }
 else {
    if (_log.isDebugEnabled()) {
      _log.debug("No resource found for " + storage.getRootPath() + webDavRequest.getPath());
    }
    return HttpServletResponse.SC_NOT_FOUND;
  }
}
