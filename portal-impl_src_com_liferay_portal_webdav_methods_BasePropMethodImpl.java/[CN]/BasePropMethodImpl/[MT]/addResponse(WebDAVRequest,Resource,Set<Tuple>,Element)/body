{
  props=new HashSet<Tuple>(props);
  Element responseElement=DocUtil.add(multistatus,"response",WebDAVUtil.DAV_URI);
  DocUtil.add(responseElement,"href",WebDAVUtil.DAV_URI,resource.getHREF());
  Element successStatElement=DocUtil.add(responseElement,"propstat",WebDAVUtil.DAV_URI);
  Element successPropElement=DocUtil.add(successStatElement,"prop",WebDAVUtil.DAV_URI);
  Element failureStatElement=DocUtil.add(responseElement,"propstat",WebDAVUtil.DAV_URI);
  Element failurePropElement=DocUtil.add(failureStatElement,"prop",WebDAVUtil.DAV_URI);
  boolean hasSuccess=false;
  boolean hasFailure=false;
  if (props.contains(ALLPROP_PAIR)) {
    props.remove(ALLPROP_PAIR);
    if (resource.isCollection()) {
      props.addAll(_ALL_COLLECTION_PROPS);
    }
 else {
      props.addAll(_ALL_SIMPLE_PROPS);
    }
  }
  if (props.contains(CREATIONDATE_PAIR)) {
    props.remove(CREATIONDATE_PAIR);
    DocUtil.add(successPropElement,CREATIONDATE,WebDAVUtil.DAV_URI,resource.getCreateDate());
    hasSuccess=true;
  }
  if (props.contains(DISPLAYNAME_PAIR)) {
    props.remove(DISPLAYNAME_PAIR);
    DocUtil.add(successPropElement,DISPLAYNAME,WebDAVUtil.DAV_URI,resource.getDisplayName());
    hasSuccess=true;
  }
  if (props.contains(GETLASTMODIFIED_PAIR)) {
    props.remove(GETLASTMODIFIED_PAIR);
    DocUtil.add(successPropElement,GETLASTMODIFIED,WebDAVUtil.DAV_URI,resource.getModifiedDate());
    hasSuccess=true;
  }
  if (props.contains(GETCONTENTTYPE_PAIR)) {
    props.remove(GETCONTENTTYPE_PAIR);
    DocUtil.add(successPropElement,GETCONTENTTYPE,WebDAVUtil.DAV_URI,resource.getContentType());
    hasSuccess=true;
  }
  if (props.contains(GETCONTENTLENGTH_PAIR)) {
    props.remove(GETCONTENTLENGTH_PAIR);
    if (!resource.isCollection()) {
      DocUtil.add(successPropElement,GETCONTENTLENGTH,WebDAVUtil.DAV_URI,resource.getSize());
      hasSuccess=true;
    }
 else {
      DocUtil.add(failurePropElement,GETCONTENTLENGTH,WebDAVUtil.DAV_URI);
      hasFailure=true;
    }
  }
  if (props.contains(LOCKDISCOVERY_PAIR)) {
    props.remove(LOCKDISCOVERY_PAIR);
    Lock lock=resource.getLock();
    if (lock != null) {
      long now=System.currentTimeMillis();
      long timeRemaining=(lock.getExpirationDate().getTime() - now) / Time.SECOND;
      if (timeRemaining <= 0) {
        timeRemaining=1;
      }
      Element lockDiscoveryElement=addElement(successPropElement,LOCKDISCOVERY);
      Element activeLockElement=addElement(lockDiscoveryElement,"activelock");
      addElement(activeLockElement,"locktype","write");
      addElement(activeLockElement,"lockscope","exclusive");
      if (resource.isCollection()) {
        DocUtil.add(activeLockElement,"depth",WebDAVUtil.DAV_URI,"Infinity");
      }
      DocUtil.add(activeLockElement,"owner",WebDAVUtil.DAV_URI,lock.getOwner());
      DocUtil.add(activeLockElement,"timeout",WebDAVUtil.DAV_URI,"Second-" + timeRemaining);
      if (webDavRequest.getUserId() == lock.getUserId()) {
        Element lockTokenElement=addElement(activeLockElement,"locktoken","href");
        lockTokenElement.addText("opaquelocktoken:" + lock.getUuid());
      }
      hasSuccess=true;
    }
 else {
      DocUtil.add(failurePropElement,LOCKDISCOVERY,WebDAVUtil.DAV_URI);
      hasFailure=true;
    }
  }
  if (props.contains(RESOURCETYPE_PAIR)) {
    props.remove(RESOURCETYPE_PAIR);
    Element resourceTypeElement=DocUtil.add(successPropElement,RESOURCETYPE,WebDAVUtil.DAV_URI);
    if (resource.isCollection()) {
      DocUtil.add(resourceTypeElement,"collection",WebDAVUtil.DAV_URI);
    }
    hasSuccess=true;
  }
  WebDAVProps webDavProps=WebDAVPropsLocalServiceUtil.getWebDAVProps(webDavRequest.getCompanyId(),resource.getClassName(),resource.getPrimaryKey());
  Set<Tuple> customProps=webDavProps.getPropsSet();
  for (  Tuple tuple : props) {
    String name=(String)tuple.getObject(0);
    Namespace namespace=(Namespace)tuple.getObject(1);
    String prefix=namespace.getPrefix();
    String uri=namespace.getURI();
    if (customProps.contains(tuple)) {
      String text=webDavProps.getText(name,prefix,uri);
      DocUtil.add(successPropElement,name,namespace,text);
      hasSuccess=true;
    }
 else {
      DocUtil.add(failurePropElement,name,namespace);
      hasFailure=true;
    }
  }
  if (hasSuccess) {
    DocUtil.add(successStatElement,"status",WebDAVUtil.DAV_URI,"HTTP/1.1 200 OK");
  }
 else {
    responseElement.remove(successStatElement);
  }
  if (!hasSuccess && hasFailure) {
    DocUtil.add(failureStatElement,"status",WebDAVUtil.DAV_URI,"HTTP/1.1 404 Not Found");
  }
 else {
    responseElement.remove(failureStatElement);
  }
}
