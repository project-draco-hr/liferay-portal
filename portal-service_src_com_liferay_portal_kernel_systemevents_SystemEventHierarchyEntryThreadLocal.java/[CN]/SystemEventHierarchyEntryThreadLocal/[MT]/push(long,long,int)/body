{
  Stack<SystemEventHierarchyEntry> systemEventHierarchyEntries=_systemEventHierarchyEntries.get();
  SystemEventHierarchyEntry parentEntry=null;
  if (!systemEventHierarchyEntries.isEmpty()) {
    parentEntry=systemEventHierarchyEntries.peek();
  }
  long parentSystemEventId=0;
  long systemEventSetKey=0;
  if (parentEntry == null) {
    systemEventSetKey=CounterLocalServiceUtil.increment();
  }
 else   if (parentEntry.getAction() == SystemEventConstants.ACTION_SKIP) {
    return null;
  }
 else {
    parentSystemEventId=parentEntry.getSystemEventId();
    systemEventSetKey=parentEntry.getSystemEventSetKey();
  }
  long systemEventId=CounterLocalServiceUtil.increment();
  SystemEventHierarchyEntry systemEventHierarchyEntry=new SystemEventHierarchyEntry(systemEventId,classNameId,classPK,parentSystemEventId,systemEventSetKey,action);
  return systemEventHierarchyEntries.push(systemEventHierarchyEntry);
}
