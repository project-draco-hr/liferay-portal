{
  String markAsReadLI=StringPool.BLANK;
  if (!userNotificationEvent.isArchived()) {
    markAsReadLI=getMarkAsReadLI(themeDisplay);
  }
  String unsubscribeLI=StringPool.BLANK;
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject(userNotificationEvent.getPayload());
  long subscriptionId=jsonObject.getLong("subscriptionId");
  if (subscriptionId > 0) {
    Subscription subscription=_subscriptionLocalService.fetchSubscription(subscriptionId);
    if (subscription == null) {
      subscriptionId=0;
    }
  }
  if (subscriptionId > 0) {
    PortletURL unsubscribeActionURL=liferayPortletResponse.createActionURL(NotificationsPortletKeys.NOTIFICATIONS);
    unsubscribeActionURL.setParameter("subscriptionId",String.valueOf(subscriptionId));
    unsubscribeActionURL.setParameter("userNotificationEventId",String.valueOf(userNotificationEvent.getUserNotificationEventId()));
    unsubscribeActionURL.setWindowState(WindowState.NORMAL);
    unsubscribeActionURL.setParameter("javax.portlet.action","unsubscribe");
    unsubscribeLI=getUnsubscribeLI(unsubscribeActionURL.toString(),themeDisplay);
  }
  String listItems=markAsReadLI + unsubscribeLI;
  return getIconMenuDiv(listItems);
}
