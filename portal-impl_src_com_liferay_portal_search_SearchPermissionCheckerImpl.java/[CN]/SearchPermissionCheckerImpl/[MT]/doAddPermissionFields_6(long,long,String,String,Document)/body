{
  Group group=null;
  if (groupId > 0) {
    group=GroupLocalServiceUtil.getGroup(groupId);
  }
  List<Role> roles=ResourceActionsUtil.getRoles(companyId,group,className,null);
  long[] roleIdsArray=new long[roles.size()];
  for (int i=0; i < roleIdsArray.length; i++) {
    Role role=roles.get(i);
    roleIdsArray[i]=role.getRoleId();
  }
  boolean[] hasResourcePermissions=null;
  if (ResourceBlockLocalServiceUtil.isSupported(className)) {
    ResourceBlockIdsBag resourceBlockIdsBag=ResourceBlockLocalServiceUtil.getResourceBlockIdsBag(companyId,groupId,className,roleIdsArray);
    long actionId=ResourceBlockLocalServiceUtil.getActionId(className,ActionKeys.VIEW);
    List<Long> resourceBlockIds=resourceBlockIdsBag.getResourceBlockIds(actionId);
    hasResourcePermissions=new boolean[roleIdsArray.length];
    for (int i=0; i < resourceBlockIds.size(); i++) {
      for (int j=0; j < roleIdsArray.length; j++) {
        try {
          ResourceBlockPermissionUtil.findByR_R(resourceBlockIds.get(i),roleIdsArray[j]);
          hasResourcePermissions[j]=true;
        }
 catch (        NoSuchResourceBlockPermissionException nsrbpe) {
        }
      }
    }
  }
 else {
    hasResourcePermissions=ResourcePermissionLocalServiceUtil.hasResourcePermissions(companyId,className,ResourceConstants.SCOPE_INDIVIDUAL,classPK,roleIdsArray,ActionKeys.VIEW);
  }
  List<Long> roleIds=new ArrayList<Long>();
  List<String> groupRoleIds=new ArrayList<String>();
  for (int i=0; i < hasResourcePermissions.length; i++) {
    if (!hasResourcePermissions[i]) {
      continue;
    }
    Role role=roles.get(i);
    if ((role.getType() == RoleConstants.TYPE_ORGANIZATION) || (role.getType() == RoleConstants.TYPE_SITE)) {
      groupRoleIds.add(groupId + StringPool.DASH + role.getRoleId());
    }
 else {
      roleIds.add(role.getRoleId());
    }
  }
  doc.addKeyword(Field.ROLE_ID,roleIds.toArray(new Long[roleIds.size()]));
  doc.addKeyword(Field.GROUP_ROLE_ID,groupRoleIds.toArray(new String[groupRoleIds.size()]));
}
