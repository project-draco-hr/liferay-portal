{
  String[] permissionResourceIds=doc.getValues("permissionResourceId");
  Resource resource=null;
  try {
    resource=ResourceLocalServiceUtil.getResource(Long.parseLong(permissionResourceIds[0]));
  }
 catch (  Exception pe) {
    resource=ResourceLocalServiceUtil.getResource(companyId,className,ResourceConstants.SCOPE_INDIVIDUAL,classPK);
  }
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  List<Role> roles=ResourceActionsUtil.getRoles(group,className);
  List<Long> roleIds=new ArrayList<Long>();
  for (  Role role : roles) {
    long roleId=role.getRoleId();
    if (hasPermission(roleId,resource.getResourceId())) {
      roleIds.add(roleId);
    }
  }
  doc.addKeyword(Field.ROLE_ID,roleIds.toArray(new Long[roleIds.size()]));
}
