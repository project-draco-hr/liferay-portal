{
  PanelApp panelApp=_bundleContext.getService(reference);
  try {
    Portlet portlet=panelApp.getPortlet();
    if (portlet == null) {
      portlet=_portletLocalService.getPortletById(panelApp.getPortletId());
    }
    if (portlet == null) {
      Class panelAppClass=panelApp.getClass();
      _log.error("Unable to obtain portlet " + panelApp.getPortletId() + " for PanelApp "+ panelAppClass.getName()+ ". Please register PanelApp to OSGi with "+ "satisfied reference to the portlet.");
      return panelApp;
    }
    initPermissions(_companyLocalService.getCompanies(),portlet);
    return panelApp;
  }
 catch (  Throwable e) {
    _bundleContext.ungetService(reference);
    throw e;
  }
}
