{
  PanelApp panelApp=_bundleContext.getService(reference);
  try {
    Portlet portlet=panelApp.getPortlet();
    if (portlet == null) {
      portlet=_portletLocalService.getPortletById(panelApp.getPortletId());
    }
    if (portlet == null) {
      Class panelAppClass=panelApp.getClass();
      _log.error("Unable to get portlet " + panelApp.getPortletId() + " for panel app "+ panelAppClass.getName());
      return panelApp;
    }
    initPermissions(_companyLocalService.getCompanies(),portlet);
    return panelApp;
  }
 catch (  Throwable t) {
    _bundleContext.ungetService(reference);
    throw t;
  }
}
