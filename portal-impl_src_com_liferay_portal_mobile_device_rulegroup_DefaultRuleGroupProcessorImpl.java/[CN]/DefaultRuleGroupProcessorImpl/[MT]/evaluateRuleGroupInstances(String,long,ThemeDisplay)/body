{
  OrderByComparator orderByComparator=new RuleGroupInstancePriorityComparator();
  List<MDRRuleGroupInstance> ruleGroupInstances=_mdrRuleGroupInstanceLocalService.getRuleGroupInstances(className,classPK,0,Integer.MAX_VALUE,orderByComparator);
  for (  MDRRuleGroupInstance ruleGroupInstance : ruleGroupInstances) {
    long ruleGroupId=ruleGroupInstance.getRuleGroupId();
    MDRRuleGroup ruleGroup=_mdrRuleGroupLocalService.fetchRuleGroup(ruleGroupId);
    if (ruleGroup == null) {
      if (_log.isWarnEnabled()) {
        _log.warn("RuleGroupInstance " + ruleGroupInstance.getRuleGroupInstanceId() + " with unknown RuleGroup, skipping");
      }
    }
 else {
      Collection<MDRRule> rules=ruleGroup.getRules();
      for (      MDRRule rule : rules) {
        boolean result=evaluateRule(rule,themeDisplay);
        if (result) {
          return ruleGroupInstance;
        }
      }
    }
  }
  return null;
}
