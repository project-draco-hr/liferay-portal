{
  SyncWatchEvent lastSyncWatchEvent=SyncWatchEventService.fetchLastSyncWatchEvent(_syncAccountId);
  if (lastSyncWatchEvent == null) {
    return;
  }
  long delta=System.currentTimeMillis() - lastSyncWatchEvent.getTimestamp();
  if (delta <= 500) {
    _inProgress=true;
    SyncEngineUtil.fireSyncEngineStateChanged(SyncEngineUtil.SYNC_ENGINE_STATE_PROCESSING);
    return;
  }
  Watcher watcher=WatcherRegistry.getWatcher(_syncAccountId);
  if (watcher != null) {
    List<String> createdFilePathNames=watcher.getCreatedFilePathNames();
    createdFilePathNames.clear();
  }
  if (_logger.isTraceEnabled()) {
    _logger.trace("Processing sync watch events");
  }
  List<SyncWatchEvent> syncWatchEvents=SyncWatchEventService.findBySyncAccountId(_syncAccountId,"eventType",true);
  for (  SyncWatchEvent syncWatchEvent : syncWatchEvents) {
    SyncAccount syncAccount=SyncAccountService.fetchSyncAccount(_syncAccountId);
    if (syncAccount.getState() != SyncAccount.STATE_CONNECTED) {
      continue;
    }
    if (_processedSyncWatchEventIds.contains(syncWatchEvent.getSyncWatchEventId())) {
      SyncWatchEventService.deleteSyncWatchEvent(syncWatchEvent.getSyncWatchEventId());
      continue;
    }
    if (_logger.isDebugEnabled()) {
      _logger.debug("Event type {} file path {} file type {} timestamp {}",syncWatchEvent.getEventType(),syncWatchEvent.getFilePathName(),syncWatchEvent.getFileType(),syncWatchEvent.getTimestamp());
    }
    boolean syncWatchEventProcessed=true;
    String fileType=syncWatchEvent.getFileType();
    String eventType=syncWatchEvent.getEventType();
    if (eventType.equals(SyncWatchEvent.EVENT_TYPE_CREATE)) {
      if (fileType.equals(SyncFile.TYPE_FILE)) {
        syncWatchEventProcessed=addFile(syncWatchEvent);
      }
 else {
        syncWatchEventProcessed=addFolder(syncWatchEvent);
      }
    }
 else     if (eventType.equals(SyncWatchEvent.EVENT_TYPE_DELETE)) {
      if (fileType.equals(SyncFile.TYPE_FILE)) {
        deleteFile(syncWatchEvent);
      }
 else {
        deleteFolder(syncWatchEvent);
      }
    }
 else     if (eventType.equals(SyncWatchEvent.EVENT_TYPE_MODIFY)) {
      if (fileType.equals(SyncFile.TYPE_FILE)) {
        modifyFile(syncWatchEvent);
      }
    }
    syncAccount=SyncAccountService.fetchSyncAccount(_syncAccountId);
    if (syncWatchEventProcessed && (syncAccount.getState() == SyncAccount.STATE_CONNECTED)) {
      SyncWatchEventService.deleteSyncWatchEvent(syncWatchEvent.getSyncWatchEventId());
    }
  }
  _inProgress=false;
  SyncEngineUtil.fireSyncEngineStateChanged(SyncEngineUtil.SYNC_ENGINE_STATE_PROCESSED);
  _processedSyncWatchEventIds.clear();
}
