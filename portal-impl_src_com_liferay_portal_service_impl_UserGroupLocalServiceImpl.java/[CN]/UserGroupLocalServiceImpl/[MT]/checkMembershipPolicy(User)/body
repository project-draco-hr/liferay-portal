{
  List<UserGroup> userGroups=getUserUserGroups(user.getUserId());
  for (  UserGroup userGroup : userGroups) {
    if (!MembershipPolicyUtil.isMembershipAllowed(userGroup,user)) {
      userLocalService.unsetUserGroupUsers(userGroup.getUserGroupId(),new long[]{user.getUserId()});
    }
  }
  Set<UserGroup> mandatoryUserGroups=MembershipPolicyUtil.getMandatoryUserGroups(user);
  for (  UserGroup userGroup : mandatoryUserGroups) {
    if (!userLocalService.hasUserGroupUser(userGroup.getUserGroupId(),user.getUserId())) {
      userLocalService.addUserGroupUsers(userGroup.getUserGroupId(),new long[]{user.getUserId()});
    }
  }
}
