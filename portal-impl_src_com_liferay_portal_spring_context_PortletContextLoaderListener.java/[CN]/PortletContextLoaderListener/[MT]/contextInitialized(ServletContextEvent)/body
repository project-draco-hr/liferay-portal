{
  MethodCache.reset();
  ServletContext servletContext=servletContextEvent.getServletContext();
  HotDeployEvent hotDeployEvent=new HotDeployEvent(servletContext,PortletClassLoaderUtil.getClassLoader());
  if (HotDeployUtil.isMissingDependentServletContext(hotDeployEvent)) {
    HotDeployUtil.registerDependentServletContextListener(hotDeployEvent,servletContextEvent,this);
    return;
  }
  Object previousApplicationContext=servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
  servletContext.removeAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
  try {
    super.contextInitialized(servletContextEvent);
  }
  finally {
    String lockKey=getLockKey(servletContext);
    LockRegistry.freeLock(lockKey,lockKey,true);
  }
  PortletBeanFactoryCleaner.readBeans();
  ClassLoader classLoader=PortletClassLoaderUtil.getClassLoader();
  ApplicationContext applicationContext=WebApplicationContextUtils.getWebApplicationContext(servletContext);
  BeanLocator beanLocator=new BeanLocatorImpl(classLoader,applicationContext);
  try {
    Class<?> beanLocatorUtilClass=Class.forName("com.liferay.util.bean.PortletBeanLocatorUtil",true,classLoader);
    Method setBeanLocatorMethod=beanLocatorUtilClass.getMethod("setBeanLocator",new Class[]{BeanLocator.class});
    setBeanLocatorMethod.invoke(beanLocatorUtilClass,new Object[]{beanLocator});
    PortletBeanLocatorUtil.setBeanLocator(servletContext.getServletContextName(),beanLocator);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  if (previousApplicationContext == null) {
    servletContext.removeAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
  }
 else {
    servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE,previousApplicationContext);
  }
}
