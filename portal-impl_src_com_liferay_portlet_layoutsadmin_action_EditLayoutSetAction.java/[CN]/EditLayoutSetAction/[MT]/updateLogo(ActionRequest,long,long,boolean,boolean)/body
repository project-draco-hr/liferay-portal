{
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  boolean useLogo=ParamUtil.getBoolean(actionRequest,"useLogo");
  InputStream inputStream=null;
  try {
    File file=uploadPortletRequest.getFile("logoFileName");
    if (useLogo && !file.exists()) {
      if (hasLogo) {
        return;
      }
      throw new UploadException("No logo uploaded for use");
    }
    if (file.exists()) {
      inputStream=new ByteArrayFileInputStream(file,1024);
    }
    if (inputStream != null) {
      inputStream.mark(0);
    }
    long groupId=liveGroupId;
    if (stagingGroupId > 0) {
      groupId=stagingGroupId;
    }
    if (inputStream != null) {
      inputStream.reset();
    }
    LayoutSetServiceUtil.updateLogo(groupId,privateLayout,useLogo,inputStream,false);
  }
  finally {
    StreamUtil.cleanUp(inputStream);
  }
}
