{
  User user=userPersistence.findByPrimaryKey(userId);
  Date displayDate=new Date();
  if (!displayImmediately) {
    displayDate=PortalUtil.getDate(displayDateMonth,displayDateDay,displayDateYear,displayDateHour,displayDateMinute,user.getTimeZone(),EntryDisplayDateException.class);
  }
  Date expirationDate=PortalUtil.getDate(expirationDateMonth,expirationDateDay,expirationDateYear,expirationDateHour,expirationDateMinute,user.getTimeZone(),EntryExpirationDateException.class);
  validate(title,content,url,expirationDate);
  long entryId=counterLocalService.increment();
  AnnouncementsEntry entry=announcementsEntryPersistence.create(entryId);
  entry.setCompanyId(user.getCompanyId());
  entry.setUserId(user.getUserId());
  entry.setUserName(user.getFullName());
  entry.setClassNameId(classNameId);
  entry.setClassPK(classPK);
  entry.setTitle(title);
  entry.setContent(content);
  entry.setUrl(url);
  entry.setType(type);
  entry.setDisplayDate(displayDate);
  entry.setExpirationDate(expirationDate);
  entry.setPriority(priority);
  entry.setAlert(alert);
  announcementsEntryPersistence.update(entry);
  resourceLocalService.addResources(user.getCompanyId(),0,user.getUserId(),AnnouncementsEntry.class.getName(),entry.getEntryId(),false,false,false);
  return entry;
}
