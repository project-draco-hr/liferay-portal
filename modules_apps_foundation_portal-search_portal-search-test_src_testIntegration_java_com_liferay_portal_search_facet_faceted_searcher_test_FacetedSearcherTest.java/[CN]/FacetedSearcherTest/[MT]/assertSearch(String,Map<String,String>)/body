{
  IdempotentRetryAssert.retryAssert(10,TimeUnit.SECONDS,new Callable<Void>(){
    @Override public Void call() throws Exception {
      FacetedSearcher facetedSearcher=createFacetedSearcher();
      Hits hits=facetedSearcher.search(getSearchContext(tag));
      AssertUtils.assertEquals(tag,expected,toMap(hits.toList()));
      return null;
    }
  }
);
}
