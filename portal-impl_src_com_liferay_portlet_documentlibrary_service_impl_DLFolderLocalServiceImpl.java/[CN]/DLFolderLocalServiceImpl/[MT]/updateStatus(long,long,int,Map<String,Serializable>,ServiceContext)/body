{
  User user=userPersistence.findByPrimaryKey(userId);
  DLFolder dlFolder=dlFolderPersistence.findByPrimaryKey(folderId);
  if (dlFolder.isInTrash() && (status == WorkflowConstants.STATUS_APPROVED)) {
    dlFolder.setName(TrashUtil.getOriginalTitle(dlFolder.getName()));
  }
  dlFolder.setStatus(status);
  dlFolder.setStatusByUserId(user.getUserId());
  dlFolder.setStatusByUserName(user.getFullName());
  dlFolder.setStatusDate(new Date());
  dlFolderPersistence.update(dlFolder);
  QueryDefinition queryDefinition=new QueryDefinition(WorkflowConstants.STATUS_ANY);
  List<Object> foldersAndFileEntriesAndFileShortcuts=getFoldersAndFileEntriesAndFileShortcuts(dlFolder.getGroupId(),folderId,null,false,queryDefinition);
  dlAppHelperLocalService.updateChildrenStatus(user,foldersAndFileEntriesAndFileShortcuts,status);
  if (status == WorkflowConstants.STATUS_IN_TRASH) {
    UnicodeProperties typeSettingsProperties=new UnicodeProperties();
    typeSettingsProperties.put("title",dlFolder.getName());
    trashEntryLocalService.addTrashEntry(userId,dlFolder.getGroupId(),DLFolderConstants.getClassName(),dlFolder.getFolderId(),WorkflowConstants.STATUS_APPROVED,null,typeSettingsProperties);
  }
  return dlFolder;
}
