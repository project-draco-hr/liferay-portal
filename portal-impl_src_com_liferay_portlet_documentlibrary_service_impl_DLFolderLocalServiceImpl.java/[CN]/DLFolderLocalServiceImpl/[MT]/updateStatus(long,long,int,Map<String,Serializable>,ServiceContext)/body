{
  User user=userPersistence.findByPrimaryKey(userId);
  DLFolder dlFolder=dlFolderPersistence.findByPrimaryKey(folderId);
  int oldStatus=dlFolder.getStatus();
  dlFolder.setStatus(status);
  dlFolder.setStatusByUserId(user.getUserId());
  dlFolder.setStatusByUserName(user.getFullName());
  dlFolder.setStatusDate(new Date());
  dlFolderPersistence.update(dlFolder);
  if (status == WorkflowConstants.STATUS_APPROVED) {
    assetEntryLocalService.updateVisible(DLFolder.class.getName(),dlFolder.getFolderId(),true);
  }
 else   if (status == WorkflowConstants.STATUS_IN_TRASH) {
    assetEntryLocalService.updateVisible(DLFolder.class.getName(),dlFolder.getFolderId(),false);
  }
  if (((status == WorkflowConstants.STATUS_APPROVED) || (status == WorkflowConstants.STATUS_IN_TRASH) || (oldStatus == WorkflowConstants.STATUS_IN_TRASH)) && ((serviceContext == null) || serviceContext.isIndexingEnabled())) {
    Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(DLFolderConstants.getClassName());
    indexer.reindex(dlFolder);
  }
  return dlFolder;
}
