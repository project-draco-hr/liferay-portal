{
  boolean hasLock=hasFolderLock(userId,folderId);
  Lock lock=null;
  if (!hasLock) {
    lock=lockFolder(userId,folderId,null,false,DLFolderImpl.LOCK_EXPIRATION_TIME);
  }
  try {
    return deleteFolder(folderId,includeTrashedEntries);
  }
  finally {
    if (!hasLock) {
      unlockFolder(folderId,lock.getUuid());
    }
  }
}
