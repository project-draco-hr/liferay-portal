{
  if (parentFolderId.equals(DLFolderImpl.DEFAULT_PARENT_FOLDER_ID)) {
    return parentFolderId;
  }
  if (folder.getFolderId().equals(parentFolderId)) {
    return folder.getParentFolderId();
  }
 else {
    DLFolder parentFolder=DLFolderUtil.fetchByPrimaryKey(parentFolderId);
    if ((parentFolder == null) || (folder.getGroupId() != parentFolder.getGroupId())) {
      return folder.getParentFolderId();
    }
    List subfolderIds=new ArrayList();
    getSubfolderIds(subfolderIds,folder.getGroupId(),folder.getFolderId());
    if (subfolderIds.contains(parentFolderId)) {
      return folder.getParentFolderId();
    }
    return parentFolderId;
  }
}
