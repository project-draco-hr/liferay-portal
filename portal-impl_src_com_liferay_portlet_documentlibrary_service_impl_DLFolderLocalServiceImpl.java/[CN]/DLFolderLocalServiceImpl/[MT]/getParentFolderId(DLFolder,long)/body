{
  if (parentFolderId == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    return parentFolderId;
  }
  if (dlFolder.getFolderId() == parentFolderId) {
    throw new InvalidFolderException(String.format("Cannot move folder %s into itself",parentFolderId));
  }
  DLFolder parentDLFolder=dlFolderPersistence.findByPrimaryKey(parentFolderId);
  if (dlFolder.getGroupId() != parentDLFolder.getGroupId()) {
    throw new NoSuchFolderException(String.format("No DLFolder with primary key %s found on group %s",parentFolderId,dlFolder.getGroupId()));
  }
  if (dlFolder.getRepositoryId() != parentDLFolder.getRepositoryId()) {
    throw new NoSuchFolderException(String.format("No DLFolder with primary key %s found on repository %s",parentFolderId,dlFolder.getGroupId()));
  }
  List<Long> subfolderIds=new ArrayList<Long>();
  getSubfolderIds(subfolderIds,dlFolder.getGroupId(),dlFolder.getFolderId());
  if (subfolderIds.contains(parentFolderId)) {
    throw new InvalidFolderException(String.format("Cannot move folder %s into one of its children",parentFolderId));
  }
  return parentFolderId;
}
