{
  long groupId=dlFolder.getGroupId();
  long repositoryId=dlFolder.getRepositoryId();
  parentFolderId=getParentFolderId(groupId,repositoryId,parentFolderId);
  if (parentFolderId == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    return parentFolderId;
  }
  if (dlFolder.getFolderId() == parentFolderId) {
    throw new InvalidFolderException(String.format("Cannot move folder %s into itself",parentFolderId));
  }
  List<Long> subfolderIds=new ArrayList<Long>();
  getSubfolderIds(subfolderIds,dlFolder.getGroupId(),dlFolder.getFolderId());
  if (subfolderIds.contains(parentFolderId)) {
    throw new InvalidFolderException(String.format("Cannot move folder %s into one of its children",parentFolderId));
  }
  return parentFolderId;
}
