{
  JSONObject additionalInfo=new JSONObject();
  Role role=RoleLocalServiceUtil.getRole(roleId);
  long companyId=CompanyThreadLocal.getCompanyId();
  long realUserId=AuditThreadLocal.getRealUserId();
  long userId=0;
  long modifierId=0;
  String modifierUserName=StringPool.BLANK;
  if (PrincipalThreadLocal.getName() != null) {
    userId=Long.parseLong(PrincipalThreadLocal.getName());
    modifierId=userId;
  }
  if (realUserId > 0 && userId != realUserId) {
    modifierId=realUserId;
    additionalInfo.put("doAsUserId",String.valueOf(userId));
    additionalInfo.put("doAsUserName",PortalUtil.getUserName(userId,StringPool.BLANK));
  }
  modifierUserName=PortalUtil.getUserName(modifierId,StringPool.BLANK);
  additionalInfo.put("roleId",roleId);
  additionalInfo.put("roleName",role.getName());
  if (scopeClassPK > 0) {
    additionalInfo.put("scopeClassPK",scopeClassPK);
    additionalInfo.put("scopeClassName",scopeClassName);
  }
  String type=grant ? ROLE_GRANT_TYPE : ROLE_REVOKE_TYPE;
  String clientIP=AuditThreadLocal.getClientIP();
  String serverIP=AuditThreadLocal.getServerIP();
  String sessionID=AuditThreadLocal.getSessionID();
  return new AuditMessage(companyId,modifierId,modifierUserName,String.valueOf(classPK),className,type,sessionID,clientIP,serverIP,additionalInfo);
}
