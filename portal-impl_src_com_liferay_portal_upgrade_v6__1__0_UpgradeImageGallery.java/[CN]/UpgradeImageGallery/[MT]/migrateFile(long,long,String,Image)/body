{
  try {
    ClassLoader classLoader=PortalClassLoaderUtil.getClassLoader();
    String sourceHookClassName=FileSystemHook.class.getName();
    if (Validator.isNotNull(PropsValues.IMAGE_HOOK_IMPL)) {
      sourceHookClassName=PropsValues.IMAGE_HOOK_IMPL;
    }
    Hook sourceHook=(Hook)classLoader.loadClass(sourceHookClassName).newInstance();
    InputStream is=sourceHook.getImageAsStream(image);
    byte[] bytes=FileUtil.getBytes(is);
    if (name == null) {
      name=image.getImageId() + StringPool.PERIOD + image.getType();
    }
    if (DLStoreUtil.hasFile(companyId,repositoryId,name)) {
      DLStoreUtil.deleteFile(companyId,repositoryId,name);
    }
    DLStoreUtil.addFile(companyId,repositoryId,name,true,bytes);
  }
 catch (  Exception e) {
  }
}
