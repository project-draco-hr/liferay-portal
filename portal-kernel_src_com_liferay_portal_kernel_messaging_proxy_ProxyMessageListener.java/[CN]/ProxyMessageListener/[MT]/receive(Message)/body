{
  ProxyResponse proxyResponse=new ProxyResponse();
  try {
    Object payload=message.getPayload();
    if (payload == null) {
      throw new Exception("Payload is null");
    }
 else     if (!(payload instanceof ProxyRequest)) {
      throw new Exception("Payload " + payload.getClass() + " is not of type "+ ProxyRequest.class.getName());
    }
 else {
      MessageValuesThreadLocal.populateThreadLocalsFromMessage(message);
      ProxyRequest proxyRequest=(ProxyRequest)payload;
      Object result=proxyRequest.execute(_manager);
      proxyResponse.setResult(result);
    }
  }
 catch (  Exception e) {
    proxyResponse.setException(e);
  }
 finally {
    String responseDestinationName=message.getResponseDestinationName();
    Exception proxyResponseException=proxyResponse.getException();
    if (Validator.isNotNull(responseDestinationName)) {
      Message responseMessage=MessageBusUtil.createResponseMessage(message);
      responseMessage.setPayload(proxyResponse);
      if (_log.isDebugEnabled() && (proxyResponseException != null)) {
        _log.debug(proxyResponseException,proxyResponseException);
      }
      _messageBus.sendMessage(responseDestinationName,responseMessage);
    }
 else {
      if (proxyResponseException != null) {
        if (_log.isWarnEnabled()) {
          _log.warn(proxyResponseException,proxyResponseException);
        }
      }
      message.setResponse(proxyResponse);
    }
  }
}
