{
  if (ParamUtil.get(request,_COMPRESS,true) && !isInclude(request) && BrowserSnifferUtil.acceptsGzip(request)&& !isAlreadyFiltered(request)) {
    if (_log.isDebugEnabled()) {
      String completeURL=HttpUtil.getCompleteURL(request);
      _log.debug("Compressing " + completeURL);
    }
    request.setAttribute(SKIP_FILTER,Boolean.TRUE);
    GZipResponse gZipResponse=new GZipResponse(response);
    processFilter(GZipFilter.class,request,gZipResponse,filterChain);
    gZipResponse.finishResponse();
  }
 else {
    if (_log.isDebugEnabled()) {
      String completeURL=HttpUtil.getCompleteURL(request);
      _log.debug("Not compressing " + completeURL);
    }
    processFilter(GZipFilter.class,request,response,filterChain);
  }
}
