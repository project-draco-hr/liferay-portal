{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay == null) {
    return SKIP_BODY;
  }
  pageContext.setAttribute("themeDisplay",themeDisplay);
  pageContext.setAttribute("company",themeDisplay.getCompany());
  pageContext.setAttribute("account",themeDisplay.getAccount());
  pageContext.setAttribute("user",themeDisplay.getUser());
  pageContext.setAttribute("realUser",themeDisplay.getRealUser());
  pageContext.setAttribute("contact",themeDisplay.getContact());
  if (themeDisplay.getLayout() != null) {
    pageContext.setAttribute("layout",themeDisplay.getLayout());
  }
  if (themeDisplay.getLayouts() != null) {
    pageContext.setAttribute("layouts",themeDisplay.getLayouts());
  }
  pageContext.setAttribute("plid",new Long(themeDisplay.getPlid()));
  if (themeDisplay.getLayoutTypePortlet() != null) {
    pageContext.setAttribute("layoutTypePortlet",themeDisplay.getLayoutTypePortlet());
  }
  pageContext.setAttribute("scopeGroupId",new Long(themeDisplay.getScopeGroupId()));
  pageContext.setAttribute("permissionChecker",themeDisplay.getPermissionChecker());
  pageContext.setAttribute("locale",themeDisplay.getLocale());
  pageContext.setAttribute("timeZone",themeDisplay.getTimeZone());
  pageContext.setAttribute("theme",themeDisplay.getTheme());
  pageContext.setAttribute("colorScheme",themeDisplay.getColorScheme());
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  pageContext.setAttribute("portletDisplay",portletDisplay);
  String portletId=portletDisplay.getId();
  try {
    PortletSettings portletCompanyPortletSettings=PortletSettingsFactoryUtil.getCompanyPortletSettings(themeDisplay.getCompanyId(),portletId);
    pageContext.setAttribute("portletCompanyPortletSettings",portletCompanyPortletSettings);
    PortletSettings portletInstancePortletSettings=PortletSettingsFactoryUtil.getPortletInstancePortletSettings(themeDisplay.getLayout(),portletId);
    pageContext.setAttribute("portletInstancePortletSettings",portletInstancePortletSettings);
    PortletSettings portletGroupPortletSettings=PortletSettingsFactoryUtil.getGroupPortletSettings(themeDisplay.getSiteGroupId(),portletId);
    pageContext.setAttribute("portletGroupPortletSettings",portletGroupPortletSettings);
  }
 catch (  SystemException se) {
    throw new RuntimeException(se);
  }
catch (  PortalException pe) {
    throw new RuntimeException(pe);
  }
  pageContext.setAttribute("portletGroupId",new Long(themeDisplay.getScopeGroupId()));
  return SKIP_BODY;
}
