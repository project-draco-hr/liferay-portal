{
  DDMStructure structure=DDMStructureLocalServiceUtil.getStructure(structureId);
  DDMFormValues ddmFormValues=StorageEngineUtil.getDDMFormValues(storageId);
  Fields fields=DDMFormValuesToFieldsConverterUtil.convert(structure,ddmFormValues);
  for (  Field field : fields) {
    String dataType=field.getDataType();
    if (!dataType.equals("file-upload") || Validator.isNull(field.getValue())) {
      continue;
    }
    long primaryKey=GetterUtil.getLong(baseModel.getPrimaryKeyObj());
    Folder folder=addFolder(userId,groupId,primaryKey,field.getName());
    String valueString=String.valueOf(field.getValue());
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject(valueString);
    String filePath=getFileUploadPath(baseModel) + StringPool.SLASH + field.getName();
    FileEntry fileEntry=addFileEntry(companyId,userId,groupId,folder.getFolderId(),jsonObject.getString("name"),filePath,status);
    if (fileEntry != null) {
      field.setValue(getJSON(fileEntry));
    }
  }
  ddmFormValues=FieldsToDDMFormValuesConverterUtil.convert(structure,fields);
  StorageEngineUtil.update(storageId,ddmFormValues,new ServiceContext());
}
