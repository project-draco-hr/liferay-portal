{
  ZipFile zipFile=new ZipFile(file);
  JarOutputStream jarOutputStream=new JarOutputStream(outputStream);
  ZipEntry zipEntry=zipFile.getEntry("liferay-marketplace.properties");
  InputStream inputStream=zipFile.getInputStream(zipEntry);
  Properties properties=new Properties();
  properties.load(new StringReader(StringUtil.read(inputStream)));
  Manifest manifest=getManifest(properties);
  ZipEntry newZipEntry=new ZipEntry(JarFile.MANIFEST_NAME);
  jarOutputStream.putNextEntry(newZipEntry);
  manifest.write(jarOutputStream);
  jarOutputStream.closeEntry();
  Enumeration<? extends ZipEntry> entries=zipFile.entries();
  while (entries.hasMoreElements()) {
    zipEntry=entries.nextElement();
    newZipEntry=new ZipEntry(zipEntry.getName());
    jarOutputStream.putNextEntry(newZipEntry);
    StreamUtil.transfer(zipFile.getInputStream(zipEntry),jarOutputStream,false);
    jarOutputStream.closeEntry();
  }
  jarOutputStream.close();
}
