{
  ZipFile zipFile=new ZipFile(file);
  JarOutputStream jarOutputStream=new JarOutputStream(outputStream);
  ZipEntry zipEntry=zipFile.getEntry("liferay-marketplace.properties");
  InputStream inputStream=zipFile.getInputStream(zipEntry);
  Properties properties=new Properties();
  properties.load(new StringReader(StringUtil.read(inputStream)));
  Manifest manifest=new Manifest();
  Attributes attributes=manifest.getMainAttributes();
  attributes.putValue("Manifest-Version","2");
  attributes.putValue(Constants.BUNDLE_MANIFESTVERSION,"2");
  attributes.putValue(Constants.BUNDLE_SYMBOLICNAME,properties.getProperty("title"));
  attributes.putValue(Constants.BUNDLE_DESCRIPTION,properties.getProperty("description"));
  attributes.putValue(Constants.BUNDLE_VERSION,properties.getProperty("version"));
  ZipEntry newZipEntry=new ZipEntry(JarFile.MANIFEST_NAME);
  jarOutputStream.putNextEntry(newZipEntry);
  manifest.write(jarOutputStream);
  jarOutputStream.closeEntry();
  Enumeration<? extends ZipEntry> entries=zipFile.entries();
  while (entries.hasMoreElements()) {
    zipEntry=entries.nextElement();
    newZipEntry=new ZipEntry(zipEntry.getName());
    jarOutputStream.putNextEntry(newZipEntry);
    StreamUtil.transfer(zipFile.getInputStream(zipEntry),jarOutputStream,false);
    jarOutputStream.closeEntry();
  }
  jarOutputStream.close();
}
