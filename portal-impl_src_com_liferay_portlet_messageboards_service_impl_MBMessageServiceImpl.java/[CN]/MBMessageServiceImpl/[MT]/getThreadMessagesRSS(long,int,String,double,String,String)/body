{
  String name=StringPool.BLANK;
  String description=StringPool.BLANK;
  List messages=new ArrayList();
  boolean rssPermission=true;
  List tempMessages=MBMessageLocalServiceUtil.getThreadMessages(threadId,new MessageCreateDateComparator(false));
  Iterator itr=tempMessages.iterator();
  while (itr.hasNext() && messages.size() < max) {
    MBMessage message=(MBMessage)itr.next();
    try {
      long messageId=message.getMessageId();
      MBMessagePermission.check(getPermissionChecker(),messageId,ActionKeys.VIEW);
      messages.add(message);
    }
 catch (    PrincipalException pe) {
      rssPermission=false;
    }
  }
  if (messages.size() > 0) {
    MBMessage message=(MBMessage)messages.get(messages.size() - 1);
    name=message.getSubject();
    description=message.getSubject();
  }
 else   if (!rssPermission) {
    name=_RSS_PERMISSIONS_ERROR;
  }
  return exportToRSS(name,description,type,version,feedURL,entryURL,messages);
}
