{
  MBMessage message=mbMessagePersistence.findByPrimaryKey(messageId);
  if (lockLocalService.isLocked(MBThread.class.getName(),message.getThreadId())) {
    throw new LockedThreadException();
  }
  MBCategoryPermission.check(getPermissionChecker(),message.getGroupId(),message.getCategoryId(),ActionKeys.ADD_FILE);
  mbMessageLocalService.addMessageAttachment(messageId,fileName,file,indexingEnabled);
}
