{
  MBMessage message=mbMessageLocalService.getMBMessage(messageId);
  if (lockLocalService.isLocked(MBThread.class.getName(),message.getThreadId())) {
    throw new LockedThreadException();
  }
  MBCategoryPermission.contains(getPermissionChecker(),message.getGroupId(),message.getCategoryId(),ActionKeys.ADD_FILE);
  mbMessageLocalService.addMessageAttachment(messageId,fileName,file,mimeType,indexingEnabled);
}
