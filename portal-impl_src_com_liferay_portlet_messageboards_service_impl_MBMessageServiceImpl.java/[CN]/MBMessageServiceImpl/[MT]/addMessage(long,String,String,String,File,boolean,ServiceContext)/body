{
  long groupId=0;
  if (categoryId > 0) {
    MBCategory category=mbCategoryPersistence.findByPrimaryKey(categoryId);
    groupId=category.getGroupId();
  }
 else {
    groupId=serviceContext.getScopeGroupId();
  }
  List<ObjectValuePair<String,InputStream>> inputStreamOVPs=Collections.emptyList();
  MBMessage message=addMessage(groupId,categoryId,subject,body,MBMessageConstants.DEFAULT_FORMAT,inputStreamOVPs,false,0.0,false,serviceContext);
  addMessageAttachment(message.getMessageId(),fileName,file,indexingEnabled);
  return message;
}
