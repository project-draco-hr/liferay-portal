{
  MBCategoryPermission.check(getPermissionChecker(),categoryId,ActionKeys.ADD_MESSAGE);
  if (!MBCategoryPermission.contains(getPermissionChecker(),categoryId,ActionKeys.ADD_FILE)) {
    files.clear();
  }
  if (!MBCategoryPermission.contains(getPermissionChecker(),categoryId,ActionKeys.UPDATE_THREAD_PRIORITY)) {
    priority=MBThreadImpl.PRIORITY_NOT_GIVEN;
  }
  return mbMessageLocalService.addMessage(getGuestOrUserId(),categoryId,subject,body,files,anonymous,priority,tagsEntries,null,communityPermissions,guestPermissions);
}
