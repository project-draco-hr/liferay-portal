{
  String name=StringPool.BLANK;
  String description=StringPool.BLANK;
  try {
    MBCategory category=mbCategoryLocalService.getCategory(categoryId);
    name=category.getName();
    description=category.getDescription();
    groupId=category.getGroupId();
  }
 catch (  NoSuchCategoryException nsce) {
    Group group=groupLocalService.getGroup(categoryId);
    name=group.getName();
    description=group.getDescription();
    groupId=group.getGroupId();
    categoryId=MBCategoryConstants.DEFAULT_PARENT_CATEGORY_ID;
  }
  List<MBMessage> messages=new ArrayList<MBMessage>();
  int lastIntervalStart=0;
  boolean listNotExhausted=true;
  MessageCreateDateComparator comparator=new MessageCreateDateComparator(false);
  while ((messages.size() < max) && listNotExhausted) {
    List<MBMessage> messageList=mbMessageLocalService.getCategoryMessages(groupId,categoryId,status,lastIntervalStart,lastIntervalStart + max,comparator);
    Iterator<MBMessage> itr=messageList.iterator();
    lastIntervalStart+=max;
    listNotExhausted=(messageList.size() == max);
    while (itr.hasNext() && (messages.size() < max)) {
      MBMessage message=itr.next();
      if (MBMessagePermission.contains(getPermissionChecker(),message,ActionKeys.VIEW)) {
        messages.add(message);
      }
    }
  }
  return exportToRSS(name,description,type,version,displayStyle,feedURL,entryURL,messages,themeDisplay);
}
