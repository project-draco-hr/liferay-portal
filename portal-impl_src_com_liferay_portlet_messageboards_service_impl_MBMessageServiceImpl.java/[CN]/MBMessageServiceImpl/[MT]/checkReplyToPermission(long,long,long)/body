{
  PermissionChecker permissionChecker=getPermissionChecker();
  if (parentMessageId > 0) {
    if (MBCategoryPermission.contains(permissionChecker,groupId,categoryId,ActionKeys.ADD_MESSAGE)) {
      return;
    }
    if (!MBCategoryPermission.contains(permissionChecker,groupId,categoryId,ActionKeys.REPLY_TO_MESSAGE)) {
      throw new PrincipalException.MustHavePermission(permissionChecker,MBCategory.class.getName(),categoryId,ActionKeys.REPLY_TO_MESSAGE);
    }
  }
 else {
    MBCategoryPermission.check(permissionChecker,groupId,categoryId,ActionKeys.ADD_MESSAGE);
  }
}
