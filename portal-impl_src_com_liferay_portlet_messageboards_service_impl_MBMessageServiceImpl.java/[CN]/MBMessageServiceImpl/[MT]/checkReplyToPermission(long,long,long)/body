{
  if (parentMessageId > 0) {
    if (MBCategoryPermission.contains(getPermissionChecker(),groupId,categoryId,ActionKeys.ADD_MESSAGE)) {
      return;
    }
    MBMessage parentMessage=mbMessagePersistence.fetchByPrimaryKey(parentMessageId);
    if ((parentMessage == null) || !MBCategoryPermission.contains(getPermissionChecker(),groupId,categoryId,ActionKeys.REPLY_TO_MESSAGE)) {
      throw new PrincipalException();
    }
  }
 else {
    MBCategoryPermission.check(getPermissionChecker(),groupId,categoryId,ActionKeys.ADD_MESSAGE);
  }
}
