{
  MBMessage message=mbMessageLocalService.getMBMessage(messageId);
  if (LockHelperUtil.isLocked(MBThread.class.getName(),message.getThreadId())) {
    throw new LockedThreadException();
  }
  MBCategoryPermission.contains(getPermissionChecker(),message.getGroupId(),message.getCategoryId(),ActionKeys.ADD_FILE);
  mbMessageLocalService.addMessageAttachment(getUserId(),messageId,fileName,file,mimeType);
}
