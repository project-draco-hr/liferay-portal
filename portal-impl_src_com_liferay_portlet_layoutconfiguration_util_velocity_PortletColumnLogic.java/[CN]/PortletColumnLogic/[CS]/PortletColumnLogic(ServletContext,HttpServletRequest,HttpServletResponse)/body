{
  _ctx=ctx;
  _req=req;
  _res=res;
  _themeDisplay=(ThemeDisplay)_req.getAttribute(WebKeys.THEME_DISPLAY);
  _portletsMap=new TreeMap(new PortletRenderWeightComparator());
  _parallelRenderEnable=PropsValues.LAYOUT_PARALLEL_RENDER_ENABLE;
  if (_parallelRenderEnable) {
    if (PropsValues.SESSION_DISABLED) {
      if (_log.isWarnEnabled()) {
        _log.warn("Parallel rendering should be disabled if sessions " + "are disabled");
      }
    }
  }
  if (_parallelRenderEnable) {
    Boolean portletParallelRender=(Boolean)req.getAttribute(WebKeys.PORTLET_PARALLEL_RENDER);
    if ((portletParallelRender != null) && (portletParallelRender.booleanValue() == false)) {
      _parallelRenderEnable=false;
    }
  }
 else {
    req.removeAttribute(WebKeys.PORTLET_PARALLEL_RENDER);
  }
}
