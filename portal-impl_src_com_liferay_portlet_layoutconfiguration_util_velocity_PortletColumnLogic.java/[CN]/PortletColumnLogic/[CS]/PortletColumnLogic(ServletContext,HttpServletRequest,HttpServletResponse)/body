{
  _ctx=ctx;
  _req=req;
  _res=res;
  _themeDisplay=(ThemeDisplay)_req.getAttribute(WebKeys.THEME_DISPLAY);
  _portletsMap=new TreeMap(new PortletRenderWeightComparator());
  _parallelRenderEnable=GetterUtil.getBoolean(PropsUtil.get(PropsUtil.LAYOUT_PARALLEL_RENDER_ENABLE));
  if (_parallelRenderEnable) {
    boolean sessionDisabled=GetterUtil.getBoolean(PropsUtil.get(PropsUtil.SESSION_DISABLED));
    if (sessionDisabled) {
      _parallelRenderEnable=false;
    }
  }
  if (_parallelRenderEnable) {
    Boolean portletParallelRender=(Boolean)req.getAttribute(WebKeys.PORTLET_PARALLEL_RENDER);
    if ((portletParallelRender != null) && (portletParallelRender.booleanValue() == false)) {
      _parallelRenderEnable=false;
    }
  }
 else {
    req.removeAttribute(WebKeys.PORTLET_PARALLEL_RENDER);
  }
}
