{
  AntiSamyConfiguration antiSamyConfiguration=Configurable.createConfigurable(AntiSamyConfiguration.class,properties);
  if (!antiSamyConfiguration.enabled()) {
    return;
  }
  Bundle bundle=bundleContext.getBundle();
  URL url=bundle.getResource(antiSamyConfiguration.configurationFileURL());
  if (url == null) {
    throw new IllegalStateException("Configuration " + antiSamyConfiguration.configurationFileURL() + " not found");
  }
  Sanitizer sanitizer=new AntiSamySanitizerImpl(url);
  _sanitizerServiceRegistration=bundleContext.registerService(Sanitizer.class,sanitizer,null);
}
