{
  DDLRecordSet recordSet=record.getRecordSet();
  DDMStructure ddmStructure=recordSet.getDDMStructure();
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  for (  String fieldName : ddmStructure.getFieldNames()) {
    jsonObject.put(fieldName,StringPool.BLANK);
  }
  jsonObject.put("displayIndex",record.getDisplayIndex());
  jsonObject.put("recordId",record.getRecordId());
  DDLRecordVersion recordVersion=record.getRecordVersion();
  if (latestRecordVersion) {
    recordVersion=record.getLatestRecordVersion();
  }
  DDMFormValues ddmFormValues=_storageEngine.getDDMFormValues(recordVersion.getDDMStorageId());
  Fields fields=_ddmFormValuesToFieldsConverter.convert(ddmStructure,ddmFormValues);
  for (  Field field : fields) {
    String fieldName=field.getName();
    String fieldType=field.getType();
    Object fieldValue=field.getValue(locale);
    if (fieldValue instanceof Date) {
      jsonObject.put(fieldName,((Date)fieldValue).getTime());
    }
 else     if (fieldType.equals(DDMFormFieldType.DOCUMENT_LIBRARY) && Validator.isNotNull(fieldValue)) {
      JSONObject fieldValueJSONObject=JSONFactoryUtil.createJSONObject(String.valueOf(fieldValue));
      String uuid=fieldValueJSONObject.getString("uuid");
      long groupId=fieldValueJSONObject.getLong("groupId");
      fieldValueJSONObject.put("title",getFileEntryTitle(uuid,groupId));
      jsonObject.put(fieldName,fieldValueJSONObject.toString());
    }
 else     if (fieldType.equals(DDMFormFieldType.LINK_TO_PAGE) && Validator.isNotNull(fieldValue)) {
      JSONObject fieldValueJSONObject=JSONFactoryUtil.createJSONObject(String.valueOf(fieldValue));
      long groupId=fieldValueJSONObject.getLong("groupId");
      boolean privateLayout=fieldValueJSONObject.getBoolean("privateLayout");
      long layoutId=fieldValueJSONObject.getLong("layoutId");
      String layoutName=getLayoutName(groupId,privateLayout,layoutId,LanguageUtil.getLanguageId(locale));
      fieldValueJSONObject.put("name",layoutName);
      jsonObject.put(fieldName,fieldValueJSONObject.toString());
    }
 else     if ((fieldType.equals(DDMFormFieldType.RADIO) || fieldType.equals(DDMFormFieldType.SELECT)) && Validator.isNotNull(fieldValue)) {
      fieldValue=JSONFactoryUtil.createJSONArray(String.valueOf(fieldValue));
      jsonObject.put(fieldName,(JSONArray)fieldValue);
    }
 else {
      jsonObject.put(fieldName,String.valueOf(fieldValue));
    }
  }
  return jsonObject;
}
