{
  StringBundler sb=new StringBundler(4);
  sb.append(getCacheDirName());
  sb.append(DateUtil.getCurrentDate(_CACHE_DIR_PATTERN,LocaleUtil.getDefault()));
  sb.append(_s3KeyTransformer.getNormalizedFileName(fileName));
  ObjectMetadata objectMetadata=s3Object.getObjectMetadata();
  Date lastModifiedDate=objectMetadata.getLastModified();
  sb.append(lastModifiedDate.getTime());
  String cacheFileName=sb.toString();
  File cacheFile=new File(cacheFileName);
  if (cacheFile.exists() && (cacheFile.lastModified() >= lastModifiedDate.getTime())) {
    return cacheFile;
  }
  InputStream inputStream=s3Object.getObjectContent();
  if (inputStream == null) {
    throw new IOException("S3 object input stream is null");
  }
  OutputStream outputStream=null;
  try {
    File parentFile=cacheFile.getParentFile();
    FileUtil.mkdirs(parentFile);
    outputStream=new FileOutputStream(cacheFile);
    StreamUtil.transfer(inputStream,outputStream);
  }
  finally {
    StreamUtil.cleanUp(inputStream,outputStream);
  }
  return cacheFile;
}
