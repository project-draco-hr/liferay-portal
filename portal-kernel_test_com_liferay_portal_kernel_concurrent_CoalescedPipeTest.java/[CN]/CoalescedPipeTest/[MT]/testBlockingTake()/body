{
  final CoalescedPipe<String> coalescedPipe=new CoalescedPipe<String>();
  ScheduledExecutorService scheduledExecutorService=Executors.newScheduledThreadPool(1);
  scheduledExecutorService.schedule(new Runnable(){
    public void run(){
      try {
        coalescedPipe.put("test1");
      }
 catch (      InterruptedException ex) {
        fail("Should never happen");
      }
    }
  }
,500,TimeUnit.MILLISECONDS);
  long startTime=System.currentTimeMillis();
  assertEquals("test1",coalescedPipe.take());
  long time=System.currentTimeMillis() - startTime;
  assertTrue(time > 250L);
  scheduledExecutorService.shutdownNow();
  scheduledExecutorService.awaitTermination(120,TimeUnit.SECONDS);
}
