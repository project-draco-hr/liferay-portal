{
  Role role=rolePersistence.findByPrimaryKey(roleId);
  String roleName=role.getName();
  if ((roleName.equals(RoleConstants.ADMINISTRATOR) && (getRoleUsersCount(role.getRoleId()) <= 1)) || roleName.equals(RoleConstants.USER)) {
    return;
  }
  rolePersistence.removeUsers(roleId,users);
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(User.class);
  indexer.reindex(users);
  long[] userIds=new long[users.size()];
  for (int i=0; i < users.size(); i++) {
    User user=users.get(i);
    userIds[i]=user.getUserId();
  }
  PermissionCacheUtil.clearCache(userIds);
}
