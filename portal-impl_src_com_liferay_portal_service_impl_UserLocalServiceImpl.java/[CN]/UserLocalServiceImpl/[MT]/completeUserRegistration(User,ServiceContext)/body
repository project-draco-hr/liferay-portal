{
  boolean sendEmail=GetterUtil.getBoolean(serviceContext.getAttribute(_NOTIFY_USER_CONTEXT_ATTR),false);
  boolean autoPassword=GetterUtil.getBoolean(serviceContext.getAttribute(_AUTO_PASSWORD_CONTEXT_ATT),false);
  String password1=null;
  if (autoPassword) {
    long companyId=user.getCompanyId();
    long[] organizationIds=user.getOrganizationIds();
    PasswordPolicy passwordPolicy=passwordPolicyLocalService.getPasswordPolicy(companyId,organizationIds);
    password1=PwdToolkitUtil.generate(passwordPolicy);
  }
  if (sendEmail) {
    try {
      sendEmail(user,password1);
    }
 catch (    IOException ioe) {
      throw new SystemException(ioe);
    }
  }
}
