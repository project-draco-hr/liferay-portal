{
  User user=userPersistence.findByPrimaryKey(userId);
  Date lastLoginDate=user.getLoginDate();
  if (lastLoginDate == null) {
    lastLoginDate=new Date();
  }
  user.setLoginDate(new Date());
  user.setLoginIP(loginIP);
  user.setLastLoginDate(lastLoginDate);
  user.setLastLoginIP(user.getLoginIP());
  user.setLastFailedLoginDate(null);
  user.setFailedLoginAttempts(0);
  userPersistence.update(user);
  return user;
}
