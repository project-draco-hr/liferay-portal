{
  if (Validator.isNull(screenName)) {
    throw new UserScreenNameException.MustNotBeNull(userId);
  }
  ScreenNameValidator screenNameValidator=ScreenNameValidatorFactory.getInstance();
  if (!screenNameValidator.validate(companyId,screenName)) {
    throw new UserScreenNameException.MustValidate(userId,screenName,screenNameValidator);
  }
  if (Validator.isNumber(screenName)) {
    if (!PropsValues.USERS_SCREEN_NAME_ALLOW_NUMERIC) {
      throw new UserScreenNameException.MustNotBeNumeric(userId,screenName);
    }
    if (!screenName.equals(String.valueOf(userId))) {
      Group group=groupPersistence.fetchByPrimaryKey(GetterUtil.getLong(screenName));
      if (group != null) {
        throw new UserScreenNameException.MustNotBeUsedByGroup(userId,screenName,group);
      }
    }
  }
  String[] anonymousNames=BaseServiceImpl.ANONYMOUS_NAMES;
  for (  String anonymousName : anonymousNames) {
    if (StringUtil.equalsIgnoreCase(screenName,anonymousName)) {
      throw new UserScreenNameException.MustNotBeReservedForAnonymous(userId,screenName,anonymousNames);
    }
  }
  User user=userPersistence.fetchByC_SN(companyId,screenName);
  if ((user != null) && (user.getUserId() != userId)) {
    throw new UserScreenNameException.MustNotBeDuplicate(user.getUserId(),screenName);
  }
  String friendlyURL=StringPool.SLASH + screenName;
  Group group=groupPersistence.fetchByC_F(companyId,friendlyURL);
  if ((group != null) && (group.getClassPK() != userId)) {
    GroupFriendlyURLException gfurle=new GroupFriendlyURLException(GroupFriendlyURLException.DUPLICATE);
    gfurle.setDuplicateClassPK(group.getGroupId());
    gfurle.setDuplicateClassName(Group.class.getName());
    throw gfurle;
  }
  int exceptionType=LayoutImpl.validateFriendlyURL(friendlyURL);
  if (exceptionType != -1) {
    throw new UserScreenNameException.MustProduceValidFriendlyURL(userId,screenName,exceptionType);
  }
  String[] reservedScreenNames=PrefsPropsUtil.getStringArray(companyId,PropsKeys.ADMIN_RESERVED_SCREEN_NAMES,StringPool.NEW_LINE,PropsValues.ADMIN_RESERVED_SCREEN_NAMES);
  for (  String reservedScreenName : reservedScreenNames) {
    if (StringUtil.equalsIgnoreCase(screenName,reservedScreenName)) {
      throw new UserScreenNameException.MustNotBeReserved(userId,screenName,reservedScreenNames);
    }
  }
}
