{
  if (!PropsValues.USERS_DELETE) {
    throw new RequiredUserException();
  }
  browserTrackerLocalService.deleteUserBrowserTracker(user.getUserId());
  Group group=null;
  if (!user.isDefaultUser()) {
    group=user.getGroup();
  }
  if (group != null) {
    groupLocalService.deleteGroup(group);
  }
  try {
    imageLocalService.deleteImage(user.getPortraitId());
  }
 catch (  NoSuchImageException nsie) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to delete image " + user.getPortraitId());
    }
  }
  passwordPolicyRelLocalService.deletePasswordPolicyRel(User.class.getName(),user.getUserId());
  passwordTrackerLocalService.deletePasswordTrackers(user.getUserId());
  subscriptionLocalService.deleteSubscriptions(user.getUserId());
  userIdMapperLocalService.deleteUserIdMappers(user.getUserId());
  announcementsDeliveryLocalService.deleteDeliveries(user.getUserId());
  assetEntryLocalService.deleteEntry(User.class.getName(),user.getUserId());
  blogsStatsUserLocalService.deleteStatsUserByUserId(user.getUserId());
  dlFileRankLocalService.deleteFileRanksByUserId(user.getUserId());
  expandoRowLocalService.deleteRows(user.getUserId());
  mbBanLocalService.deleteBansByBanUserId(user.getUserId());
  mbStatsUserLocalService.deleteStatsUsersByUserId(user.getUserId());
  mbThreadFlagLocalService.deleteThreadFlagsByUserId(user.getUserId());
  membershipRequestLocalService.deleteMembershipRequestsByUserId(user.getUserId());
  shoppingCartLocalService.deleteUserCarts(user.getUserId());
  socialActivityLocalService.deleteUserActivities(user.getUserId());
  socialRequestLocalService.deleteReceiverUserRequests(user.getUserId());
  socialRequestLocalService.deleteUserRequests(user.getUserId());
  mailService.deleteUser(user.getCompanyId(),user.getUserId());
  Contact contact=contactLocalService.fetchContact(user.getContactId());
  if (contact != null) {
    contactLocalService.deleteContact(contact);
  }
  resourceLocalService.deleteResource(user.getCompanyId(),User.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,user.getUserId());
  userGroupRoleLocalService.deleteUserGroupRolesByUserId(user.getUserId());
  if (user.isDefaultUser()) {
    _defaultUsers.remove(user.getCompanyId());
  }
  userPersistence.remove(user);
  PermissionCacheUtil.clearCache();
  workflowInstanceLinkLocalService.deleteWorkflowInstanceLinks(user.getCompanyId(),0,User.class.getName(),user.getUserId());
  return user;
}
