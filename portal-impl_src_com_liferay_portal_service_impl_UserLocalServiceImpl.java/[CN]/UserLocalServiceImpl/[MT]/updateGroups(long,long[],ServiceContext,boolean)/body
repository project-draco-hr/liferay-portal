{
  if (newGroupIds == null) {
    return;
  }
  long[] oldGroupIds=getGroupPrimaryKeys(userId);
  for (  long oldGroupId : oldGroupIds) {
    if (!ArrayUtil.contains(newGroupIds,oldGroupId)) {
      unsetGroupUsers(oldGroupId,new long[]{userId},serviceContext);
    }
  }
  for (  long newGroupId : newGroupIds) {
    if (!ArrayUtil.contains(oldGroupIds,newGroupId)) {
      addGroupUsers(newGroupId,new long[]{userId});
    }
  }
  if (indexingEnabled) {
    Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(User.class);
    indexer.reindex(new long[]{userId});
  }
  PermissionCacheUtil.clearCache(userId);
}
