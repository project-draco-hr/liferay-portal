{
  User user=userPersistence.findByPrimaryKey(userId);
  Set<Long> groupIdsSet=new HashSet<Long>();
  String[] defaultGroupNames=PrefsPropsUtil.getStringArray(user.getCompanyId(),PropsKeys.ADMIN_DEFAULT_GROUP_NAMES,StringPool.NEW_LINE,PropsValues.ADMIN_DEFAULT_GROUP_NAMES);
  for (  String defaultGroupName : defaultGroupNames) {
    Company company=companyPersistence.findByPrimaryKey(user.getCompanyId());
    Account account=company.getAccount();
    if (defaultGroupName.equalsIgnoreCase(account.getName())) {
      defaultGroupName=GroupConstants.GUEST;
    }
    try {
      Group group=groupPersistence.findByC_N(user.getCompanyId(),defaultGroupName);
      if (!userPersistence.containsGroup(userId,group.getGroupId())) {
        groupIdsSet.add(group.getGroupId());
      }
    }
 catch (    NoSuchGroupException nsge) {
    }
  }
  String[] defaultOrganizationGroupNames=PrefsPropsUtil.getStringArray(user.getCompanyId(),PropsKeys.ADMIN_DEFAULT_ORGANIZATION_GROUP_NAMES,StringPool.NEW_LINE,PropsValues.ADMIN_DEFAULT_ORGANIZATION_GROUP_NAMES);
  for (  String defaultOrganizationGroupName : defaultOrganizationGroupNames) {
    defaultOrganizationGroupName+=GroupLocalServiceImpl.ORGANIZATION_NAME_SUFFIX;
    try {
      Group group=groupPersistence.findByC_N(user.getCompanyId(),defaultOrganizationGroupName);
      if (!userPersistence.containsGroup(userId,group.getGroupId())) {
        groupIdsSet.add(group.getGroupId());
      }
    }
 catch (    NoSuchGroupException nsge) {
    }
  }
  long[] groupIds=ArrayUtil.toArray(groupIdsSet.toArray(new Long[groupIdsSet.size()]));
  groupLocalService.addUserGroups(userId,groupIds);
}
