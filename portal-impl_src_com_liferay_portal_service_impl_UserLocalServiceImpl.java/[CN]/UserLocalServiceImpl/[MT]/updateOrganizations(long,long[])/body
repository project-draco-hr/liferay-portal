{
  List oldOrganizations=userPersistence.getOrganizations(userId);
  List oldOrganizationIds=new ArrayList(oldOrganizations.size());
  for (int i=0; i < oldOrganizations.size(); i++) {
    Organization oldOrganization=(Organization)oldOrganizations.get(i);
    long oldOrganizationId=oldOrganization.getOrganizationId();
    oldOrganizationIds.add(new Long(oldOrganizationId));
    if (!ArrayUtil.contains(newOrganizationIds,oldOrganizationId)) {
      unsetOrganizationUsers(oldOrganizationId,new long[]{userId});
    }
  }
  for (int i=0; i < newOrganizationIds.length; i++) {
    long newOrganizationId=newOrganizationIds[i];
    if (!oldOrganizationIds.contains(new Long(newOrganizationId))) {
      addOrganizationUsers(newOrganizationId,new long[]{userId});
    }
  }
  PermissionCacheUtil.clearCache();
}
