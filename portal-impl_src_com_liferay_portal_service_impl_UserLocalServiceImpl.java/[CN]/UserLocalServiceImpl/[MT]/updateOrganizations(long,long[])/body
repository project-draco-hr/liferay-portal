{
  if (newOrganizationIds == null) {
    return;
  }
  List<Organization> oldOrganizations=userPersistence.getOrganizations(userId);
  List<Long> oldOrganizationIds=new ArrayList<Long>(oldOrganizations.size());
  for (  Organization oldOrganization : oldOrganizations) {
    long oldOrganizationId=oldOrganization.getOrganizationId();
    oldOrganizationIds.add(oldOrganizationId);
    if (!ArrayUtil.contains(newOrganizationIds,oldOrganizationId)) {
      unsetOrganizationUsers(oldOrganizationId,new long[]{userId});
    }
  }
  for (  long newOrganizationId : newOrganizationIds) {
    if (!oldOrganizationIds.contains(newOrganizationId)) {
      addOrganizationUsers(newOrganizationId,new long[]{userId});
    }
  }
  try {
    UserIndexer.updateUsers(new long[]{userId});
  }
 catch (  SearchException se) {
    _log.error("Indexing " + userId,se);
  }
  PermissionCacheUtil.clearCache();
}
