{
  try {
    User user=UserUtil.findByPrimaryKey(userId);
    if (user.isDefaultUser()) {
      _log.error("The default user should never be allowed to authenticate");
      return false;
    }
    String password=user.getPassword();
    if (user.isPasswordEncrypted()) {
      if (password.equals(encPwd)) {
        return true;
      }
      if (!GetterUtil.getBoolean(PropsUtil.get(PropsUtil.PORTAL_JAAS_STRICT_PASSWORD))) {
        encPwd=PwdEncryptor.encrypt(encPwd,password);
        if (password.equals(encPwd)) {
          return true;
        }
      }
    }
 else {
      if (!GetterUtil.getBoolean(PropsUtil.get(PropsUtil.PORTAL_JAAS_STRICT_PASSWORD))) {
        if (password.equals(encPwd)) {
          return true;
        }
      }
      password=PwdEncryptor.encrypt(password);
      if (password.equals(encPwd)) {
        return true;
      }
    }
  }
 catch (  Exception e) {
    _log.error(e);
  }
  return false;
}
