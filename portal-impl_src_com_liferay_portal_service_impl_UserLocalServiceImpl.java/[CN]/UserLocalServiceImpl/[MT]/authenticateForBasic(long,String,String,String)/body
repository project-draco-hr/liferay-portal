{
  if (PropsValues.AUTH_LOGIN_DISABLED) {
    return 0;
  }
  User user=null;
  if (authType.equals(CompanyConstants.AUTH_TYPE_EA)) {
    user=fetchUserByEmailAddress(companyId,login);
  }
 else   if (authType.equals(CompanyConstants.AUTH_TYPE_SN)) {
    user=fetchUserByScreenName(companyId,login);
  }
 else   if (authType.equals(CompanyConstants.AUTH_TYPE_ID)) {
    user=userPersistence.fetchByPrimaryKey(GetterUtil.getLong(login));
  }
  if (user == null) {
    return 0;
  }
  if (!isUserAllowedToAuthenticate(user)) {
    return 0;
  }
  if (!PropsValues.BASIC_AUTH_PASSWORD_REQUIRED) {
    return user.getUserId();
  }
  String userPassword=user.getPassword();
  if (!user.isPasswordEncrypted()) {
    userPassword=PasswordEncryptorUtil.encrypt(userPassword);
  }
  String encPassword=PasswordEncryptorUtil.encrypt(password,userPassword);
  if (userPassword.equals(password) || userPassword.equals(encPassword)) {
    return user.getUserId();
  }
  handleAuthenticationFailure(login,authType,user,Collections.<String,String[]>emptyMap(),Collections.<String,String[]>emptyMap());
  return 0;
}
