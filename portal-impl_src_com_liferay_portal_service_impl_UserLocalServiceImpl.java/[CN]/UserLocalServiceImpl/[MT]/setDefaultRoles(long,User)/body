{
  Set<Long> roleIdSet=new HashSet<Long>();
  String[] defaultRoleNames=PrefsPropsUtil.getStringArray(companyId,PropsKeys.ADMIN_DEFAULT_ROLE_NAMES,StringPool.NEW_LINE,PropsValues.ADMIN_DEFAULT_ROLE_NAMES);
  List<Role> currentRoles=user.getRoles();
  for (  String defaultRoleName : defaultRoleNames) {
    try {
      Role defaultRole=rolePersistence.findByC_N(companyId,defaultRoleName);
      if (!currentRoles.contains(defaultRole)) {
        roleIdSet.add(defaultRole.getRoleId());
      }
    }
 catch (    NoSuchRoleException nsre) {
    }
  }
  long[] roleIds=ArrayUtil.toArray((Long[])roleIdSet.toArray(new Long[roleIdSet.size()]));
  roleIds=EnterpriseAdminUtil.addRequiredRoles(user.getUserId(),roleIds);
  userPersistence.setRoles(user.getUserId(),roleIds);
}
