{
  PasswordPolicy passwordPolicy=user.getPasswordPolicy();
  if ((passwordPolicy == null) || !passwordPolicy.isLockout()) {
    return user;
  }
  Date lockoutDate=null;
  if (lockout) {
    lockoutDate=new Date();
  }
  user.setLockout(lockout);
  user.setLockoutDate(lockoutDate);
  if (!lockout) {
    user.setLastFailedLoginDate(lockoutDate);
    user.setFailedLoginAttempts(0);
  }
  userPersistence.update(user);
  return user;
}
