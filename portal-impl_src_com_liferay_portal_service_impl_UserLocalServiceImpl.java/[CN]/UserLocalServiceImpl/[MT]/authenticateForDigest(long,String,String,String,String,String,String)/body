{
  long userId=0;
  User user=null;
  try {
    user=getUserByEmailAddress(companyId,username);
  }
 catch (  NoSuchUserException nsue) {
    try {
      user=getUserByScreenName(companyId,username);
    }
 catch (    NoSuchUserException nsue2) {
      try {
        user=getUserById(Long.parseLong(username));
      }
 catch (      NoSuchUserException nsue3) {
        return userId;
      }
    }
  }
  String digest=user.getDigest();
  if (Validator.isNull(digest)) {
    if (_log.isWarnEnabled()) {
      _log.warn("User must first log in through the portal " + user.getUserId());
    }
    return userId;
  }
  String[] digestArray=StringUtil.split(user.getDigest());
  for (  String ha1 : digestArray) {
    String ha2=DigesterUtil.digestHex(Digester.MD5,method,uri);
    String myresponse=DigesterUtil.digestHex(Digester.MD5,ha1,nonce,ha2);
    if (myresponse.equals(response)) {
      userId=user.getUserId();
      break;
    }
  }
  return userId;
}
