{
  if (ListUtil.isEmpty(userGroupRoles)) {
    return;
  }
  userGroupRoles=new ArrayList<UserGroupRole>(userGroupRoles);
  for (  UserGroupRole userGroupRole : previousUserGroupRoles) {
    if (userGroupRoles.contains(userGroupRole)) {
      userGroupRoles.remove(userGroupRole);
    }
 else {
      userGroupRoleLocalService.deleteUserGroupRole(userGroupRole);
    }
  }
  long[] validGroupIds=null;
  if (groupIds != null) {
    validGroupIds=ArrayUtil.clone(groupIds);
  }
 else {
    validGroupIds=user.getGroupIds();
  }
  if (organizationIds == null) {
    organizationIds=user.getOrganizationIds();
  }
  for (  long organizationId : organizationIds) {
    long[] organizationGroupIds=organizationPersistence.getGroupPrimaryKeys(organizationId);
    validGroupIds=ArrayUtil.append(validGroupIds,organizationGroupIds);
  }
  Arrays.sort(validGroupIds);
  for (  UserGroupRole userGroupRole : userGroupRoles) {
    if (Arrays.binarySearch(validGroupIds,userGroupRole.getGroupId()) >= 0) {
      userGroupRoleLocalService.addUserGroupRole(userGroupRole);
    }
  }
}
