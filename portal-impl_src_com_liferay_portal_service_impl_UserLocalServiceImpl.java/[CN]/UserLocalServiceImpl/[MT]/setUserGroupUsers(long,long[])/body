{
  if (PropsValues.USER_GROUPS_COPY_LAYOUTS_TO_USER_PERSONAL_SITE) {
    userGroupLocalService.copyUserGroupLayouts(userGroupId,userIds);
  }
  long[] oldUserIds=userGroupPersistence.getUserPrimaryKeys(userGroupId);
  Set<Long> updatedUserIdsSet=SetUtil.symmetricDifference(userIds,oldUserIds);
  long[] updateUserIds=ArrayUtil.toLongArray(updatedUserIdsSet);
  userGroupPersistence.setUsers(userGroupId,userIds);
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(User.class);
  indexer.reindex(updateUserIds);
  PermissionCacheUtil.clearCache(updateUserIds);
}
