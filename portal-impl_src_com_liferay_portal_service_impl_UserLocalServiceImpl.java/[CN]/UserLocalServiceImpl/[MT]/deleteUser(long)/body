{
  if (!GetterUtil.getBoolean(PropsUtil.get(PropsUtil.USERS_DELETE))) {
    throw new RequiredUserException();
  }
  User user=UserUtil.findByPrimaryKey(userId);
  Group group=user.getGroup();
  GroupLocalServiceUtil.deleteGroup(group.getGroupId());
  ImageLocalUtil.deleteImage(user.getPortraitId());
  PasswordPolicyRelLocalServiceUtil.deletePasswordPolicyRel(User.class.getName(),userId);
  PasswordTrackerLocalServiceUtil.deletePasswordTrackers(userId);
  UserIdMapperLocalServiceUtil.deleteUserIdMappers(userId);
  BlogsStatsUserLocalServiceUtil.deleteStatsUserByUserId(userId);
  DLFileRankLocalServiceUtil.deleteFileRanks(userId);
  MBBanLocalServiceUtil.deleteBansByBanUserId(userId);
  MBMessageFlagLocalServiceUtil.deleteFlags(userId);
  MBStatsUserLocalServiceUtil.deleteStatsUserByUserId(userId);
  ShoppingCartLocalServiceUtil.deleteUserCarts(userId);
  try {
    MailServiceUtil.deleteUser(userId);
  }
 catch (  RemoteException re) {
    throw new SystemException(re);
  }
  ContactLocalServiceUtil.deleteContact(user.getContactId());
  ResourceLocalServiceUtil.deleteResource(user.getCompanyId(),User.class.getName(),ResourceImpl.SCOPE_INDIVIDUAL,user.getUserId());
  UserGroupRoleLocalServiceUtil.deleteUserGroupRolesByUserId(userId);
  UserUtil.remove(userId);
  PermissionCacheUtil.clearCache();
}
