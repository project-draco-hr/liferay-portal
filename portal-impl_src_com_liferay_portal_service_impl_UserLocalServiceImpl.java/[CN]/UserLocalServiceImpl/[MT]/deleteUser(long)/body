{
  if (!PropsValues.USERS_DELETE) {
    throw new RequiredUserException();
  }
  User user=userPersistence.findByPrimaryKey(userId);
  Indexer indexer=IndexerRegistryUtil.getIndexer(User.class);
  indexer.delete(user);
  browserTrackerLocalService.deleteUserBrowserTracker(userId);
  Group group=user.getGroup();
  if (group != null) {
    groupLocalService.deleteGroup(group.getGroupId());
  }
  imageLocalService.deleteImage(user.getPortraitId());
  passwordPolicyRelLocalService.deletePasswordPolicyRel(User.class.getName(),userId);
  passwordTrackerLocalService.deletePasswordTrackers(userId);
  subscriptionLocalService.deleteSubscriptions(userId);
  userIdMapperLocalService.deleteUserIdMappers(userId);
  announcementsDeliveryLocalService.deleteDeliveries(userId);
  assetEntryLocalService.deleteEntry(User.class.getName(),userId);
  blogsStatsUserLocalService.deleteStatsUserByUserId(userId);
  dlFileRankLocalService.deleteFileRanks(userId);
  expandoValueLocalService.deleteValues(User.class.getName(),userId);
  mbBanLocalService.deleteBansByBanUserId(userId);
  mbMessageFlagLocalService.deleteFlags(userId);
  mbStatsUserLocalService.deleteStatsUsersByUserId(userId);
  shoppingCartLocalService.deleteUserCarts(userId);
  socialActivityLocalService.deleteUserActivities(userId);
  socialRequestLocalService.deleteReceiverUserRequests(userId);
  socialRequestLocalService.deleteUserRequests(userId);
  mailService.deleteUser(user.getCompanyId(),userId);
  try {
    contactLocalService.deleteContact(user.getContactId());
  }
 catch (  NoSuchContactException nsce) {
  }
  resourceLocalService.deleteResource(user.getCompanyId(),User.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,user.getUserId());
  userGroupRoleLocalService.deleteUserGroupRolesByUserId(userId);
  userPersistence.remove(userId);
  PermissionCacheUtil.clearCache();
}
