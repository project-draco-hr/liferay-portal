{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  String billingFirstName=ParamUtil.getString(req,"billingFirstName");
  String billingLastName=ParamUtil.getString(req,"billingLastName");
  String billingEmailAddress=ParamUtil.getString(req,"billingEmailAddress");
  String billingCompany=ParamUtil.getString(req,"billingCompany");
  String billingStreet=ParamUtil.getString(req,"billingStreet");
  String billingCity=ParamUtil.getString(req,"billingCity");
  String billingStateSel=ParamUtil.getString(req,"billingStateSel");
  String billingState=billingStateSel;
  if (Validator.isNull(billingStateSel)) {
    billingState=ParamUtil.getString(req,"billingState");
  }
  String billingZip=ParamUtil.getString(req,"billingZip");
  String billingCountry=ParamUtil.getString(req,"billingCountry");
  String billingPhone=ParamUtil.getString(req,"billingPhone");
  boolean shipToBilling=ParamUtil.getBoolean(req,"shipToBilling");
  String shippingFirstName=ParamUtil.getString(req,"shippingFirstName");
  String shippingLastName=ParamUtil.getString(req,"shippingLastName");
  String shippingEmailAddress=ParamUtil.getString(req,"shippingEmailAddress");
  String shippingCompany=ParamUtil.getString(req,"shippingCompany");
  String shippingStreet=ParamUtil.getString(req,"shippingStreet");
  String shippingCity=ParamUtil.getString(req,"shippingCity");
  String shippingStateSel=ParamUtil.getString(req,"shippingStateSel");
  String shippingState=shippingStateSel;
  if (Validator.isNull(shippingStateSel)) {
    shippingState=ParamUtil.getString(req,"shippingState");
  }
  String shippingZip=ParamUtil.getString(req,"shippingZip");
  String shippingCountry=ParamUtil.getString(req,"shippingCountry");
  String shippingPhone=ParamUtil.getString(req,"shippingPhone");
  String ccName=ParamUtil.getString(req,"ccName");
  String ccType=ParamUtil.getString(req,"ccType");
  String ccNumber=ParamUtil.getString(req,"ccNumber");
  int ccExpMonth=ParamUtil.getInteger(req,"ccExpMonth");
  int ccExpYear=ParamUtil.getInteger(req,"ccExpYear");
  String ccVerNumber=ParamUtil.getString(req,"ccVerNumber");
  String comments=ParamUtil.getString(req,"comments");
  ShoppingOrder order=ShoppingOrderLocalServiceUtil.updateLatestOrder(themeDisplay.getUserId(),themeDisplay.getPortletGroupId(),billingFirstName,billingLastName,billingEmailAddress,billingCompany,billingStreet,billingCity,billingState,billingZip,billingCountry,billingPhone,shipToBilling,shippingFirstName,shippingLastName,shippingEmailAddress,shippingCompany,shippingStreet,shippingCity,shippingState,shippingZip,shippingCountry,shippingPhone,ccName,ccType,ccNumber,ccExpMonth,ccExpYear,ccVerNumber,comments);
  req.setAttribute(WebKeys.SHOPPING_ORDER,order);
}
