{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  if (!cmd.equals(Constants.UPDATE)) {
    return;
  }
  String initUrl=ParamUtil.getString(req,"initUrl");
  if (!initUrl.startsWith("/") && !StringUtil.startsWith(initUrl,"http://") && !StringUtil.startsWith(initUrl,"https://")&& !StringUtil.startsWith(initUrl,"mhtml://")) {
    initUrl=Http.getProtocol(req) + "://" + initUrl;
  }
  String scope=ParamUtil.getString(req,"scope");
  String proxyHost=ParamUtil.getString(req,"proxyHost");
  String proxyPort=ParamUtil.getString(req,"proxyPort");
  String proxyAuthentication=ParamUtil.getString(req,"proxyAuthentication");
  String proxyAuthenticationUsername=ParamUtil.getString(req,"proxyAuthenticationUsername");
  String proxyAuthenticationPassword=ParamUtil.getString(req,"proxyAuthenticationPassword");
  String proxyAuthenticationHost=ParamUtil.getString(req,"proxyAuthenticationHost");
  String proxyAuthenticationDomain=ParamUtil.getString(req,"proxyAuthenticationDomain");
  String stylesheet=ParamUtil.getString(req,"stylesheet");
  String portletResource=ParamUtil.getString(req,"portletResource");
  PortletPreferences prefs=PortletPreferencesFactoryUtil.getPortletSetup(req,portletResource,true,true);
  prefs.setValue("initUrl",initUrl);
  prefs.setValue("scope",scope);
  prefs.setValue("proxyHost",proxyHost);
  prefs.setValue("proxyPort",proxyPort);
  prefs.setValue("proxyAuthentication",proxyAuthentication);
  prefs.setValue("proxyAuthenticationUsername",proxyAuthenticationUsername);
  prefs.setValue("proxyAuthenticationPassword",proxyAuthenticationPassword);
  prefs.setValue("proxyAuthenticationHost",proxyAuthenticationHost);
  prefs.setValue("proxyAuthenticationDomain",proxyAuthenticationDomain);
  prefs.setValue("stylesheet",stylesheet);
  prefs.store();
  SessionMessages.add(req,config.getPortletName() + ".doConfigure");
}
