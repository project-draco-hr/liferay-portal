{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Group group=themeDisplay.getScopeGroup();
  if (!group.isControlPanel()) {
    return group;
  }
  HttpServletRequest originalRequest=PortalUtil.getOriginalServletRequest(request);
  long groupId=GetterUtil.getLong(SessionClicks.get(originalRequest.getSession(),_KEY_LATENT_GROUP,null));
  if (groupId > 0) {
    return _groupLocalService.fetchGroup(groupId);
  }
  return null;
}
