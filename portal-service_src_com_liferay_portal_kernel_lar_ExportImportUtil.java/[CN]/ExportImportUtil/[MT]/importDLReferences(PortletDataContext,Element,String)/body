{
  List<Element> dlReferenceElements=parentElement.elements("dl-reference");
  for (  Element dlReferenceElement : dlReferenceElements) {
    String dlReferencePath=dlReferenceElement.attributeValue("path");
    String fileEntryUUID=null;
    long fileEntryGroupId=0;
    try {
      Object zipEntryObject=portletDataContext.getZipEntryAsObject(dlReferencePath);
      if (zipEntryObject == null) {
        if (_log.isWarnEnabled()) {
          _log.warn("Unable to reference " + dlReferencePath);
        }
        continue;
      }
      boolean defaultRepository=GetterUtil.getBoolean(dlReferenceElement.attributeValue("default-repository"));
      if (defaultRepository) {
        FileEntry fileEntry=(FileEntry)zipEntryObject;
        fileEntryUUID=fileEntry.getUuid();
        fileEntryGroupId=fileEntry.getGroupId();
      }
 else {
        RepositoryEntry repositoryEntry=(RepositoryEntry)zipEntryObject;
        fileEntryUUID=repositoryEntry.getUuid();
        fileEntryGroupId=repositoryEntry.getGroupId();
      }
    }
 catch (    Exception e) {
      if (_log.isDebugEnabled()) {
        _log.debug(e,e);
      }
 else       if (_log.isWarnEnabled()) {
        _log.warn(e.getMessage());
      }
    }
    if (fileEntryUUID == null) {
      continue;
    }
    FileEntry fileEntry=null;
    try {
      long groupId=portletDataContext.getScopeGroupId();
      if (fileEntryGroupId == portletDataContext.getSourceCompanyGroupId()) {
        groupId=portletDataContext.getSourceCompanyGroupId();
      }
      fileEntry=DLAppLocalServiceUtil.getFileEntryByUuidAndGroupId(fileEntryUUID,groupId);
    }
 catch (    NoSuchFileEntryException nsfee) {
      continue;
    }
    String dlReference="[$dl-reference=" + dlReferencePath + "$]";
    String url=DLUtil.getPreviewURL(fileEntry,fileEntry.getFileVersion(),null,StringPool.BLANK,false,false);
    content=StringUtil.replace(content,dlReference,url);
  }
  return content;
}
