{
  User user=userPersistence.findByPrimaryKey(userId);
  DDLRecordVersion recordVersion=ddlRecordVersionPersistence.findByPrimaryKey(recordVersionId);
  recordVersion.setStatus(status);
  recordVersion.setStatusByUserId(user.getUserId());
  recordVersion.setStatusByUserName(user.getFullName());
  recordVersion.setStatusDate(new Date());
  ddlRecordVersionPersistence.update(recordVersion,false);
  DDLRecord record=ddlRecordPersistence.findByPrimaryKey(recordVersion.getRecordId());
  if (status == WorkflowConstants.STATUS_APPROVED) {
    if (DLUtil.compareVersions(record.getVersion(),recordVersion.getVersion()) <= 0) {
      record.setDDMStorageId(recordVersion.getDDMStorageId());
      record.setVersion(recordVersion.getVersion());
      record.setRecordSetId(recordVersion.getRecordSetId());
      record.setDisplayIndex(recordVersion.getDisplayIndex());
      record.setVersion(recordVersion.getVersion());
      record.setVersionUserId(recordVersion.getUserId());
      record.setVersionUserName(recordVersion.getUserName());
      record.setModifiedDate(recordVersion.getCreateDate());
      ddlRecordPersistence.update(record,false);
    }
  }
 else {
    if (record.getVersion().equals(recordVersion.getVersion())) {
      String newVersion=DDLRecordConstants.VERSION_DEFAULT;
      List<DDLRecordVersion> approvedRecordVersions=ddlRecordVersionPersistence.findByR_S(record.getRecordId(),WorkflowConstants.STATUS_APPROVED);
      if (!approvedRecordVersions.isEmpty()) {
        newVersion=approvedRecordVersions.get(0).getVersion();
      }
      record.setVersion(newVersion);
      ddlRecordPersistence.update(record,false);
    }
    if (recordVersion.getVersion().equals(DDLRecordConstants.VERSION_DEFAULT)) {
      Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(DDLRecord.class);
      indexer.delete(record);
    }
  }
  if (status == WorkflowConstants.STATUS_APPROVED) {
    Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(DDLRecord.class);
    indexer.reindex(record);
  }
  return record;
}
