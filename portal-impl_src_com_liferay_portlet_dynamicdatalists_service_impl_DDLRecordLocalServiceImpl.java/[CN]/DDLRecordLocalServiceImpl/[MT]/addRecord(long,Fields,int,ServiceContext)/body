{
  DDLRecordSet recordSet=ddlRecordSetPersistence.findByPrimaryKey(recordSetId);
  long recordId=counterLocalService.increment();
  DDLRecord record=ddlRecordPersistence.create(recordId);
  DDMStructure ddmStructure=recordSet.getDDMStructure();
  record.setClassNameId(ddmStructure.getClassNameId());
  long classPK=StorageEngineUtil.create(recordSet.getCompanyId(),recordSet.getDDMStructureId(),fields,serviceContext);
  record.setClassPK(classPK);
  record.setDisplayIndex(displayIndex);
  record.setRecordSetId(recordSetId);
  ddlRecordPersistence.update(record,false);
  long classNameId=PortalUtil.getClassNameId(DDLRecord.class);
  ddmStructureLinkLocalService.addStructureLink(classNameId,recordId,recordSet.getDDMStructureId(),serviceContext);
  return record;
}
