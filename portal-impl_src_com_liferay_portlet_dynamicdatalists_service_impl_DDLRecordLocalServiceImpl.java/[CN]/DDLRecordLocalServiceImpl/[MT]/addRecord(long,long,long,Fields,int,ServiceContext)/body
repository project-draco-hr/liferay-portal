{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  DDLRecordSet recordSet=ddlRecordSetPersistence.findByPrimaryKey(recordSetId);
  long recordId=counterLocalService.increment();
  DDLRecord record=ddlRecordPersistence.create(recordId);
  record.setUuid(serviceContext.getUuid());
  record.setGroupId(groupId);
  record.setCompanyId(user.getCompanyId());
  record.setUserId(user.getUserId());
  record.setUserName(user.getFullName());
  record.setCreateDate(serviceContext.getCreateDate(now));
  record.setModifiedDate(serviceContext.getModifiedDate(now));
  DDMStructure ddmStructure=recordSet.getDDMStructure();
  record.setClassNameId(ddmStructure.getClassNameId());
  long classPK=StorageEngineUtil.create(recordSet.getCompanyId(),recordSet.getDDMStructureId(),fields,serviceContext);
  record.setClassPK(classPK);
  record.setRecordSetId(recordSetId);
  record.setDisplayIndex(displayIndex);
  ddlRecordPersistence.update(record,false);
  return record;
}
