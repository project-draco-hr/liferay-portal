{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  DDLRecordSet recordSet=ddlRecordSetPersistence.findByPrimaryKey(recordSetId);
  long recordId=counterLocalService.increment();
  DDLRecord record=ddlRecordPersistence.create(recordId);
  record.setUuid(serviceContext.getUuid());
  record.setGroupId(groupId);
  record.setCompanyId(user.getCompanyId());
  record.setUserId(user.getUserId());
  record.setUserName(user.getFullName());
  record.setVersionUserId(user.getUserId());
  record.setVersionUserName(user.getFullName());
  record.setCreateDate(serviceContext.getCreateDate(now));
  record.setModifiedDate(serviceContext.getModifiedDate(now));
  DDMStructure ddmStructure=recordSet.getDDMStructure();
  record.setClassNameId(ddmStructure.getClassNameId());
  long classPK=StorageEngineUtil.create(recordSet.getCompanyId(),recordSet.getDDMStructureId(),fields,serviceContext);
  record.setClassPK(classPK);
  record.setRecordSetId(recordSetId);
  record.setDisplayIndex(displayIndex);
  record.setVersion(DDLRecordConstants.DEFAULT_VERSION);
  ddlRecordPersistence.update(record,false);
  DDLRecordVersion recordVersion=addRecordVersion(user,record,serviceContext.getModifiedDate(now),recordSetId,ddmStructure.getClassNameId(),classPK,displayIndex,DDLRecordConstants.DEFAULT_VERSION,WorkflowConstants.STATUS_DRAFT,serviceContext);
  Locale locale=ServiceContextUtil.getLocale(serviceContext);
  updateAsset(userId,record,recordVersion,locale,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames());
  WorkflowHandlerRegistryUtil.startWorkflowInstance(user.getCompanyId(),groupId,userId,DDLRecord.class.getName(),record.getRecordId(),record,serviceContext);
  return record;
}
