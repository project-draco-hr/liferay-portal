{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  DDLRecordSet recordSet=ddlRecordSetPersistence.findByPrimaryKey(recordSetId);
  long recordId=counterLocalService.increment();
  DDLRecord record=ddlRecordPersistence.create(recordId);
  record.setUuid(serviceContext.getUuid());
  record.setGroupId(groupId);
  record.setCompanyId(user.getCompanyId());
  record.setUserId(user.getUserId());
  record.setUserName(user.getFullName());
  record.setVersionUserId(user.getUserId());
  record.setVersionUserName(user.getFullName());
  record.setCreateDate(serviceContext.getCreateDate(now));
  record.setModifiedDate(serviceContext.getModifiedDate(now));
  long ddmStorageId=StorageEngineUtil.create(recordSet.getCompanyId(),recordSet.getDDMStructureId(),fields,serviceContext);
  record.setDDMStorageId(ddmStorageId);
  record.setRecordSetId(recordSetId);
  record.setVersion(DDLRecordConstants.DEFAULT_VERSION);
  record.setDisplayIndex(displayIndex);
  ddlRecordPersistence.update(record,false);
  DDLRecordVersion recordVersion=addRecordVersion(user,record,ddmStorageId,DDLRecordConstants.DEFAULT_VERSION,displayIndex,WorkflowConstants.STATUS_DRAFT);
  Locale locale=ServiceContextUtil.getLocale(serviceContext);
  updateAsset(userId,record,recordVersion,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames(),locale);
  WorkflowHandlerRegistryUtil.startWorkflowInstance(user.getCompanyId(),groupId,userId,DDLRecord.class.getName(),recordVersion.getPrimaryKey(),recordVersion,serviceContext);
  return record;
}
