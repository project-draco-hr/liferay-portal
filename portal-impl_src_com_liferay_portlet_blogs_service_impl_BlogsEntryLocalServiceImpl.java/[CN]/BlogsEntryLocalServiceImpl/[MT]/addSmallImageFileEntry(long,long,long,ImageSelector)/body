{
  byte[] imageBytes=imageSelector.getImageBytes();
  if (imageBytes == null) {
    return 0;
  }
  try {
    BlogsGroupServiceSettings blogsGroupServiceSettings=BlogsGroupServiceSettings.getInstance(groupId);
    ImageSelectorProcessor imageSelectorProcessor=new ImageSelectorProcessor(imageSelector.getImageBytes());
    imageBytes=imageSelectorProcessor.scaleImage(blogsGroupServiceSettings.getSmallImageWidth());
    if (imageBytes == null) {
      throw new EntrySmallImageScaleException();
    }
    Folder folder=addSmallImageFolder(userId,groupId);
    return addProcessedImageFileEntry(userId,groupId,entryId,folder.getFolderId(),imageSelector.getImageTitle(),imageSelector.getImageMimeType(),imageBytes);
  }
 catch (  IOException ioe) {
    throw new EntrySmallImageScaleException();
  }
}
