{
  long coverImageId=0;
  byte[] bytes=null;
  try {
    bytes=coverImageImageSelector.getCroppedImageBytes();
  }
 catch (  IOException ioe) {
    if (_log.isDebugEnabled()) {
      _log.debug("Cannot obtain cropped image from image selector image " + "id " + coverImageImageSelector.getImageId());
    }
  }
  if (bytes != null) {
    File file=null;
    try {
      file=FileUtil.createTempFile(bytes);
      String title=coverImageImageSelector.getTitle();
      String mimeType=coverImageImageSelector.getMimeType();
      if (Validator.isNull(title)) {
        title=StringUtil.randomString() + "_tempCroppedImage_" + entryId;
      }
      ServiceContext serviceContext=new ServiceContext();
      serviceContext.setAddGroupPermissions(true);
      serviceContext.setAddGuestPermissions(true);
      Folder folder=PortletFileRepositoryUtil.addPortletFolder(groupId,userId,PortletKeys.BLOGS,DLFolderConstants.DEFAULT_PARENT_FOLDER_ID,String.valueOf(entryId),serviceContext);
      FileEntry fileEntry=PortletFileRepositoryUtil.addPortletFileEntry(groupId,userId,BlogsEntry.class.getName(),entryId,PortletKeys.BLOGS,folder.getFolderId(),file,title,mimeType,false);
      coverImageId=fileEntry.getFileEntryId();
      PortletFileRepositoryUtil.deletePortletFileEntry(coverImageImageSelector.getImageId());
    }
 catch (    IOException ioe) {
      if (_log.isDebugEnabled()) {
        _log.debug("Cannot obtain cropped image from image selector " + "image id " + coverImageImageSelector.getImageId());
      }
    }
 finally {
      FileUtil.delete(file);
    }
  }
  return coverImageId;
}
