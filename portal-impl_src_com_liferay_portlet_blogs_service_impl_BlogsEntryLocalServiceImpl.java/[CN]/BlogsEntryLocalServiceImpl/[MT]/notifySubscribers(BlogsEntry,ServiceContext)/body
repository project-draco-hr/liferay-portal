{
  String layoutFullURL=serviceContext.getLayoutFullURL();
  if (!entry.isApproved() || Validator.isNull(layoutFullURL)) {
    return;
  }
  PortletPreferences preferences=ServiceContextUtil.getPortletPreferences(serviceContext);
  if (preferences == null) {
    long ownerId=entry.getGroupId();
    int ownerType=PortletKeys.PREFS_OWNER_TYPE_GROUP;
    long plid=PortletKeys.PREFS_PLID_SHARED;
    String portletId=PortletKeys.BLOGS;
    String defaultPreferences=null;
    preferences=portletPreferencesLocalService.getPreferences(entry.getCompanyId(),ownerId,ownerType,plid,portletId,defaultPreferences);
  }
  if (serviceContext.isCommandAdd() && BlogsUtil.getEmailEntryAddedEnabled(preferences)) {
  }
 else   if (serviceContext.isCommandUpdate() && BlogsUtil.getEmailEntryUpdatedEnabled(preferences)) {
  }
 else {
    return;
  }
  String fromName=BlogsUtil.getEmailFromName(preferences,entry.getCompanyId());
  String fromAddress=BlogsUtil.getEmailFromAddress(preferences,entry.getCompanyId());
  Map<Locale,String> localizedSubjectMap=null;
  Map<Locale,String> localizedBodyMap=null;
  if (serviceContext.isCommandUpdate()) {
    localizedSubjectMap=BlogsUtil.getEmailEntryUpdatedSubjectMap(preferences);
    localizedBodyMap=BlogsUtil.getEmailEntryUpdatedBodyMap(preferences);
  }
 else {
    localizedSubjectMap=BlogsUtil.getEmailEntryAddedSubjectMap(preferences);
    localizedBodyMap=BlogsUtil.getEmailEntryAddedBodyMap(preferences);
  }
  SubscriptionSender subscriptionSender=new SubscriptionSender();
  subscriptionSender.setClassPK(entry.getEntryId());
  subscriptionSender.setCompanyId(entry.getCompanyId());
  subscriptionSender.setContextAttribute("[$BLOGS_ENTRY_CONTENT$]",entry.getContent(),false);
  subscriptionSender.setContextAttributes("[$BLOGS_ENTRY_DESCRIPTION$]",entry.getDescription(),"[$BLOGS_ENTRY_STATUS_BY_USER_NAME$]",entry.getStatusByUserName(),"[$BLOGS_ENTRY_TITLE$]",entry.getTitle(),"[$BLOGS_ENTRY_URL$]",getEntryURL(entry,serviceContext));
  subscriptionSender.setContextUserPrefix("BLOGS_ENTRY");
  subscriptionSender.setFrom(fromAddress,fromName);
  subscriptionSender.setHtmlFormat(true);
  subscriptionSender.setLocalizedBodyMap(localizedBodyMap);
  subscriptionSender.setLocalizedSubjectMap(localizedSubjectMap);
  subscriptionSender.setMailId("blogs_entry",entry.getEntryId());
  int notificationType=UserNotificationDefinition.NOTIFICATION_TYPE_ADD_ENTRY;
  if (serviceContext.isCommandUpdate()) {
    notificationType=UserNotificationDefinition.NOTIFICATION_TYPE_UPDATE_ENTRY;
  }
  subscriptionSender.setNotificationType(notificationType);
  subscriptionSender.setPortletId(PortletKeys.BLOGS);
  subscriptionSender.setReplyToAddress(fromAddress);
  subscriptionSender.setScopeGroupId(entry.getGroupId());
  subscriptionSender.setServiceContext(serviceContext);
  subscriptionSender.setUserId(entry.getUserId());
  subscriptionSender.addPersistedSubscribers(BlogsEntry.class.getName(),entry.getGroupId());
  subscriptionSender.flushNotificationsAsync();
}
