{
  if (!entry.isApproved()) {
    return;
  }
  String layoutFullURL=PortalUtil.getLayoutFullURL(serviceContext.getScopeGroupId(),PortletKeys.BLOGS);
  if (Validator.isNull(layoutFullURL)) {
    return;
  }
  PortletPreferences preferences=ServiceContextUtil.getPortletPreferences(serviceContext);
  if (preferences == null) {
    long ownerId=entry.getGroupId();
    int ownerType=PortletKeys.PREFS_OWNER_TYPE_GROUP;
    long plid=PortletKeys.PREFS_PLID_SHARED;
    String portletId=PortletKeys.BLOGS;
    String defaultPreferences=null;
    preferences=portletPreferencesLocalService.getPreferences(entry.getCompanyId(),ownerId,ownerType,plid,portletId,defaultPreferences);
  }
  if (serviceContext.isCommandAdd() && BlogsUtil.getEmailEntryAddedEnabled(preferences)) {
  }
 else   if (serviceContext.isCommandUpdate() && BlogsUtil.getEmailEntryUpdatedEnabled(preferences)) {
  }
 else {
    return;
  }
  Company company=companyPersistence.findByPrimaryKey(entry.getCompanyId());
  Group group=groupPersistence.findByPrimaryKey(serviceContext.getScopeGroupId());
  String emailAddress=StringPool.BLANK;
  String fullName=entry.getUserName();
  try {
    User user=userPersistence.findByPrimaryKey(entry.getUserId());
    emailAddress=user.getEmailAddress();
    fullName=user.getFullName();
  }
 catch (  NoSuchUserException nsue) {
  }
  String portletName=PortalUtil.getPortletTitle(PortletKeys.BLOGS,LocaleUtil.getDefault());
  String fromName=BlogsUtil.getEmailFromName(preferences);
  String fromAddress=BlogsUtil.getEmailFromAddress(preferences);
  fromName=StringUtil.replace(fromName,new String[]{"[$BLOGS_ENTRY_USER_ADDRESS$]","[$BLOGS_ENTRY_USER_NAME$]","[$COMPANY_ID$]","[$COMPANY_MX$]","[$COMPANY_NAME$]","[$COMMUNITY_NAME$]","[$PORTLET_NAME$]"},new String[]{emailAddress,fullName,String.valueOf(company.getCompanyId()),company.getMx(),company.getName(),group.getName(),portletName});
  fromAddress=StringUtil.replace(fromAddress,new String[]{"[$BLOGS_ENTRY_USER_ADDRESS$]","[$BLOGS_ENTRY_USER_NAME$]","[$COMPANY_ID$]","[$COMPANY_MX$]","[$COMPANY_NAME$]","[$COMMUNITY_NAME$]","[$PORTLET_NAME$]"},new String[]{emailAddress,fullName,String.valueOf(company.getCompanyId()),company.getMx(),company.getName(),group.getName(),portletName});
  String entryURL=layoutFullURL + Portal.FRIENDLY_URL_SEPARATOR + "blogs"+ StringPool.SLASH+ entry.getEntryId();
  String subject=null;
  String body=null;
  if (serviceContext.isCommandUpdate()) {
    subject=BlogsUtil.getEmailEntryUpdatedSubject(preferences);
    body=BlogsUtil.getEmailEntryUpdatedBody(preferences);
  }
 else {
    subject=BlogsUtil.getEmailEntryAddedSubject(preferences);
    body=BlogsUtil.getEmailEntryAddedBody(preferences);
  }
  subject=StringUtil.replace(subject,new String[]{"[$BLOGS_ENTRY_USER_ADDRESS$]","[$BLOGS_ENTRY_USER_NAME$]","[$BLOGS_ENTRY_URL$]","[$COMPANY_ID$]","[$COMPANY_MX$]","[$COMPANY_NAME$]","[$COMMUNITY_NAME$]","[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$PORTLET_NAME$]"},new String[]{emailAddress,fullName,entryURL,String.valueOf(company.getCompanyId()),company.getMx(),company.getName(),group.getName(),fromAddress,fromName,company.getVirtualHostname(),portletName});
  body=StringUtil.replace(body,new String[]{"[$BLOGS_ENTRY_USER_ADDRESS$]","[$BLOGS_ENTRY_USER_NAME$]","[$BLOGS_ENTRY_URL$]","[$COMPANY_ID$]","[$COMPANY_MX$]","[$COMPANY_NAME$]","[$COMMUNITY_NAME$]","[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$PORTLET_NAME$]"},new String[]{emailAddress,fullName,entryURL,String.valueOf(company.getCompanyId()),company.getMx(),company.getName(),group.getName(),fromAddress,fromName,company.getVirtualHostname(),portletName});
  SubscriptionSender subscriptionSender=new SubscriptionSender();
  subscriptionSender.setBody(body);
  subscriptionSender.setCompanyId(entry.getCompanyId());
  subscriptionSender.setFrom(fromAddress,fromName);
  subscriptionSender.setGroupId(entry.getGroupId());
  subscriptionSender.setHtmlFormat(true);
  subscriptionSender.setMailId(company,"blogs_entry",entry.getEntryId());
  subscriptionSender.setReplyToAddress(fromAddress);
  subscriptionSender.setSubject(subject);
  subscriptionSender.setUserId(entry.getUserId());
  subscriptionSender.addPersistedSubscribers(BlogsEntry.class.getName(),entry.getGroupId());
  subscriptionSender.flushNotificationsAsync();
}
