{
  int oldStatus=entry.getStatus();
  updateStatus(userId,entry.getEntryId(),WorkflowConstants.STATUS_IN_TRASH,new ServiceContext());
  socialActivityLocalService.addActivity(userId,entry.getGroupId(),BlogsEntry.class.getName(),entry.getEntryId(),SocialActivityConstants.TYPE_MOVE_TO_TRASH,StringPool.BLANK,0);
  trashEntryLocalService.addTrashEntry(userId,entry.getGroupId(),BlogsEntry.class.getName(),entry.getEntryId(),oldStatus,null,null);
  if (oldStatus == WorkflowConstants.STATUS_PENDING) {
    WorkflowInstanceLink workflowInstanceLink=workflowInstanceLinkLocalService.getWorkflowInstanceLink(entry.getCompanyId(),entry.getGroupId(),BlogsEntry.class.getName(),entry.getEntryId());
    WorkflowInstance workflowInstance=WorkflowInstanceManagerUtil.getWorkflowInstance(entry.getCompanyId(),workflowInstanceLink.getWorkflowInstanceId());
    Map<String,Serializable> workflowContext=workflowInstance.getWorkflowContext();
    ServiceContext serviceContext=(ServiceContext)workflowContext.get(WorkflowConstants.CONTEXT_SERVICE_CONTEXT);
    boolean update=ParamUtil.getBoolean(serviceContext,"update");
    if (update) {
      entry.setStatus(WorkflowConstants.STATUS_DRAFT_FROM_APPROVED);
    }
 else {
      entry.setStatus(WorkflowConstants.STATUS_DRAFT);
    }
    workflowInstanceLinkLocalService.deleteWorkflowInstanceLink(workflowInstanceLink.getWorkflowInstanceId());
  }
  return entry;
}
