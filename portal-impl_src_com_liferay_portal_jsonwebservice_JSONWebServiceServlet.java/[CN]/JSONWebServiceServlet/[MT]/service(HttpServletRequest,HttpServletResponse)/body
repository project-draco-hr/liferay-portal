{
  String path=GetterUtil.getString(request.getPathInfo());
  if (!PropsValues.JSONWS_WEB_SERVICE_API_DISCOVERABLE || (!path.equals(StringPool.BLANK) && !path.equals(StringPool.SLASH)) || (request.getParameter("discover") != null)) {
    Locale locale=PortalUtil.getLocale(request,response,true);
    LocaleThreadLocal.setThemeDisplayLocale(locale);
    super.service(request,response);
    return;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Servlet context " + request.getContextPath());
  }
  String portalContextPath=PortalContextLoaderListener.getPortalServletContextPath();
  String currentContextPath=request.getContextPath();
  if (currentContextPath.equals(portalContextPath)) {
    RequestDispatcher requestDispatcher=request.getRequestDispatcher(Portal.PATH_MAIN + "/portal/api/jsonws");
    requestDispatcher.forward(request,response);
  }
 else {
    String contextName=getServletContext().getServletContextName();
    String redirectPath=PortalUtil.getPathContext() + "/api/jsonws?contextName=" + HttpUtil.encodeURL(contextName);
    response.sendRedirect(redirectPath);
  }
}
