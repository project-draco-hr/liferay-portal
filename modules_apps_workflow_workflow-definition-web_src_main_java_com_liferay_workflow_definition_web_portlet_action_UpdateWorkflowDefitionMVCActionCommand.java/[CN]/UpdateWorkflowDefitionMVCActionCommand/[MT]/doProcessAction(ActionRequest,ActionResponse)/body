{
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String name=ParamUtil.getString(actionRequest,"name");
  Map<Locale,String> titleMap=LocalizationUtil.getLocalizationMap(actionRequest,"title");
  int version=ParamUtil.getInteger(actionRequest,"version");
  File file=uploadPortletRequest.getFile("file");
  WorkflowDefinition workflowDefinition=null;
  if (file == null) {
    workflowDefinition=WorkflowDefinitionManagerUtil.updateTitle(themeDisplay.getCompanyId(),themeDisplay.getUserId(),name,version,getTitle(titleMap));
  }
 else {
    workflowDefinition=WorkflowDefinitionManagerUtil.deployWorkflowDefinition(themeDisplay.getCompanyId(),themeDisplay.getUserId(),getTitle(titleMap),getFileBytes(file));
  }
  actionRequest.setAttribute(WebKeys.WORKFLOW_DEFINITION,workflowDefinition);
}
