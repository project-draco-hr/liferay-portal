{
  Path zipPath=Files.createTempFile(destDirPath,null,null);
  try (OutputStream outputStream=Files.newOutputStream(zipPath)){
    ZipOutputStream zipOutputStream=new ZipOutputStream(outputStream);
    zipOutputStream.setLevel(compressionLevel.getLevel());
    long startTime=System.currentTimeMillis();
    long rawSize=zip(sourcePath,zipOutputStream);
    if (_log.isDebugEnabled()) {
      long zippedSize=Files.size(zipPath);
      long time=(System.currentTimeMillis() - startTime) / 1000;
      double compressionRatio=rawSize / zippedSize;
      StringBundler sb=new StringBundler(13);
      sb.append("Zipped ");
      sb.append(sourcePath);
      sb.append(" (");
      sb.append(rawSize);
      sb.append(" bytes) to ");
      sb.append(zipPath);
      sb.append(" (");
      sb.append(zippedSize);
      sb.append(" bytes)\" in ");
      sb.append(time);
      sb.append("s with a ");
      sb.append(compressionRatio);
      sb.append("compression ratio");
      _log.debug(sb.toString());
    }
  }
 catch (  IOException ioe) {
    Files.delete(zipPath);
    throw ioe;
  }
  return zipPath;
}
