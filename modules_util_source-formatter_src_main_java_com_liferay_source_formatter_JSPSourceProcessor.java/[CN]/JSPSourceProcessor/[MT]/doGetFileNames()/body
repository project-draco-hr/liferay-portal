{
  _moveFrequentlyUsedImportsToCommonInit=GetterUtil.getBoolean(getProperty("move.frequently.used.imports.to.common.init"));
  _unusedVariablesExclusionFiles=getPropertyList("jsp.unused.variables.excludes.files");
  String[] excludes=new String[]{"**/null.jsp","**/tools/**"};
  List<String> fileNames=getFileNames(excludes,getIncludes());
  if (fileNames.isEmpty()) {
    return fileNames;
  }
  List<String> allFileNames=null;
  if (sourceFormatterArgs.isFormatCurrentBranch() || sourceFormatterArgs.isFormatLatestAuthor() || sourceFormatterArgs.isFormatLocalChanges()) {
    allFileNames=getFileNames(sourceFormatterArgs.getBaseDirName(),null,excludes,getIncludes());
  }
 else {
    allFileNames=fileNames;
  }
  try {
    Pattern pattern=Pattern.compile("\\s*@\\s*include\\s*file=['\"](.*)['\"]");
    for (    String fileName : allFileNames) {
      File file=new File(fileName);
      fileName=StringUtil.replace(fileName,StringPool.BACK_SLASH,StringPool.SLASH);
      String absolutePath=getAbsolutePath(file);
      String content=FileUtil.read(file);
      Matcher matcher=pattern.matcher(content);
      String newContent=content;
      while (matcher.find()) {
        newContent=StringUtil.replaceFirst(newContent,matcher.group(),"@ include file=\"" + matcher.group(1) + "\"",matcher.start());
      }
      processFormattedFile(file,fileName,content,newContent);
      if (portalSource && _moveFrequentlyUsedImportsToCommonInit && fileName.endsWith("/init.jsp")&& !isModulesFile(absolutePath)&& !fileName.endsWith("/common/init.jsp")) {
        addImportCounts(content);
      }
      _jspContents.put(fileName,newContent);
    }
    if (portalSource && _moveFrequentlyUsedImportsToCommonInit) {
      moveFrequentlyUsedImportsToCommonInit(4);
    }
  }
 catch (  Exception e) {
    ReflectionUtil.throwException(e);
  }
  if (!sourceFormatterArgs.isFormatCurrentBranch() && !sourceFormatterArgs.isFormatLatestAuthor() && !sourceFormatterArgs.isFormatLocalChanges()) {
    return fileNames;
  }
  return addIncludedAndReferencedFileNames(fileNames,new HashSet<String>());
}
