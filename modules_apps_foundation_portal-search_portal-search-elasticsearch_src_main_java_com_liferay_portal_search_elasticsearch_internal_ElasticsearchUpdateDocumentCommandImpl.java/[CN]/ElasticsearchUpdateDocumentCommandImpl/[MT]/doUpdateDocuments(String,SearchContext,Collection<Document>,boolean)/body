{
  try {
    Client client=elasticsearchConnectionManager.getClient();
    BulkRequestBuilder bulkRequestBuilder=client.prepareBulk();
    for (    Document document : documents) {
      if (deleteFirst) {
        DeleteRequestBuilder deleteRequestBuilder=client.prepareDelete(indexNameBuilder.getIndexName(searchContext.getCompanyId()),DocumentTypes.LIFERAY,document.getUID());
        bulkRequestBuilder.add(deleteRequestBuilder);
      }
      UpdateRequestBuilder updateRequestBuilder=buildUpdateRequestBuilder(documentType,searchContext,document);
      bulkRequestBuilder.add(updateRequestBuilder);
    }
    if (PortalRunMode.isTestMode() || searchContext.isCommitImmediately()) {
      bulkRequestBuilder.setRefresh(true);
    }
    BulkResponse bulkResponse=bulkRequestBuilder.get();
    LogUtil.logActionResponse(_log,bulkResponse);
    return bulkResponse;
  }
 catch (  Exception e) {
    throw new SearchException("Unable to update documents " + documents,e);
  }
}
