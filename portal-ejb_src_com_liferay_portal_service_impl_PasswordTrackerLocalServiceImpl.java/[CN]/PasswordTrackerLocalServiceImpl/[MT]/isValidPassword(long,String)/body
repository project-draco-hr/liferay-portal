{
  String newEncPwd=PwdEncryptor.encrypt(password);
  PasswordPolicy passwordPolicy=PasswordPolicyLocalServiceUtil.getPasswordPolicyByUserId(userId);
  if (!passwordPolicy.getHistory()) {
    return true;
  }
  int historyCount=1;
  Iterator itr=PasswordTrackerUtil.findByUserId(userId).iterator();
  while (itr.hasNext()) {
    if (historyCount > passwordPolicy.getHistoryCount()) {
      break;
    }
    PasswordTracker passwordTracker=(PasswordTracker)itr.next();
    if (passwordTracker.getPassword().equals(newEncPwd)) {
      return false;
    }
    historyCount++;
  }
  return true;
}
