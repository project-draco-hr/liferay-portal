{
  try {
    UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
    UploadException uploadException=(UploadException)uploadPortletRequest.getAttribute(WebKeys.UPLOAD_EXCEPTION);
    if (uploadException != null) {
      if (uploadException.isExceededSizeLimit()) {
        throw new LARFileSizeException(uploadException.getCause());
      }
      throw new PortalException(uploadException.getCause());
    }
    long groupId=ParamUtil.getLong(uploadPortletRequest,"groupId");
    boolean privateLayout=ParamUtil.getBoolean(uploadPortletRequest,"privateLayout");
    File file=uploadPortletRequest.getFile("importFileName");
    if (!file.exists()) {
      throw new LARFileException("Import file does not exist");
    }
    LayoutServiceUtil.importLayouts(groupId,privateLayout,actionRequest.getParameterMap(),file);
    addSuccessMessage(actionRequest,actionResponse);
    String redirect=ParamUtil.getString(actionRequest,"redirect");
    sendRedirect(actionRequest,actionResponse,redirect);
  }
 catch (  Exception e) {
    if ((e instanceof LARFileException) || (e instanceof LARFileSizeException) || (e instanceof LARTypeException)) {
      SessionErrors.add(actionRequest,e.getClass());
    }
 else     if ((e instanceof LayoutPrototypeException) || (e instanceof LocaleException)) {
      SessionErrors.add(actionRequest,e.getClass(),e);
    }
 else {
      _log.error(e,e);
      SessionErrors.add(actionRequest,LayoutImportException.class.getName());
    }
  }
}
