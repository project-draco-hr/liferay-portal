{
  HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
  response.setContentType(ContentTypes.TEXT_HTML);
  response.setStatus(HttpServletResponse.SC_OK);
  int errorType=0;
  String errorMessage=StringPool.BLANK;
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  if (e instanceof DuplicateFileException || e instanceof FileExtensionException || e instanceof FileNameException|| e instanceof LARFileException|| e instanceof LARFileSizeException|| e instanceof LARTypeException|| e instanceof LayoutPrototypeException|| e instanceof LocaleException|| e instanceof FileSizeException) {
    if (e instanceof DuplicateFileException) {
      errorType=ServletResponseConstants.SC_DUPLICATE_FILE_EXCEPTION;
      errorMessage=themeDisplay.translate("please-enter-a-unique-document-name");
    }
 else     if (e instanceof FileExtensionException) {
      errorType=ServletResponseConstants.SC_FILE_EXTENSION_EXCEPTION;
      errorMessage=themeDisplay.translate("document-names-must-end-with-one-of-the-following-" + "extensions",StringUtil.merge(getAllowedFileExtensions(portletConfig,actionRequest,actionResponse)));
    }
 else     if (e instanceof FileNameException) {
      errorType=ServletResponseConstants.SC_FILE_NAME_EXCEPTION;
      errorMessage=themeDisplay.translate("please-enter-a-file-with-a-valid-file-name");
    }
 else     if (e instanceof FileSizeException || e instanceof LARFileSizeException) {
      errorType=ServletResponseConstants.SC_FILE_SIZE_EXCEPTION;
      long fileMaxSize=PrefsPropsUtil.getLong(PropsKeys.DL_FILE_MAX_SIZE);
      if (fileMaxSize == 0) {
        fileMaxSize=PrefsPropsUtil.getLong(PropsKeys.UPLOAD_SERVLET_REQUEST_IMPL_MAX_SIZE);
      }
      fileMaxSize/=1024;
      errorMessage=themeDisplay.translate("please-enter-a-file-with-a-valid-file-size-no-larger" + "-than-x",fileMaxSize);
    }
 else     if (e instanceof LARTypeException) {
      LARTypeException lte=(LARTypeException)e;
      errorType=ServletResponseConstants.SC_FILE_CUSTOM_EXCEPTION;
      errorMessage=themeDisplay.translate("please-import-a-lar-file-of-the-correct-type" + "-x-is-not-valid",lte.getMessage());
    }
 else     if (e instanceof LARFileException) {
      errorType=ServletResponseConstants.SC_FILE_CUSTOM_EXCEPTION;
      errorMessage=themeDisplay.translate("please-specify-a-lar-file-to-import");
    }
 else     if (e instanceof LocaleException) {
      LocaleException le=(LocaleException)e;
      errorType=ServletResponseConstants.SC_FILE_CUSTOM_EXCEPTION;
      errorMessage=themeDisplay.translate("the-available-languages-in-the-lar-file-x-do" + "-not-match-the-portal's-available-languages-x",new String[]{StringUtil.merge(le.getSourceAvailableLocales(),StringPool.COMMA_AND_SPACE),StringUtil.merge(le.getTargetAvailableLocales(),StringPool.COMMA_AND_SPACE)});
    }
 else     if (e instanceof LayoutPrototypeException) {
      LayoutPrototypeException lpe=(LayoutPrototypeException)e;
      errorType=ServletResponseConstants.SC_FILE_CUSTOM_EXCEPTION;
      List<Tuple> missingLayoutPrototypes=lpe.getMissingLayoutPrototypes();
      StringBundler sb=new StringBundler(3 + (10 * missingLayoutPrototypes.size()));
      sb.append(themeDisplay.translate("the-lar-file-could-not-be-imported-because-it-" + "requires-page-templates-or-site-templates-" + "that-could-not-be-found.-please-import-the-"+ "following-templates-manually"));
      sb.append("<ul>");
      for (      Tuple missingLayoutPrototype : missingLayoutPrototypes) {
        String layoutPrototypeClassName=(String)missingLayoutPrototype.getObject(0);
        String layoutPrototypeUuid=(String)missingLayoutPrototype.getObject(1);
        String layoutPrototypeName=(String)missingLayoutPrototype.getObject(2);
        sb.append("<li>");
        sb.append(ResourceActionsUtil.getModelResource(themeDisplay.getLocale(),layoutPrototypeClassName));
        sb.append(StringPool.COLON);
        sb.append(StringPool.SPACE);
        sb.append("<strong>");
        sb.append(layoutPrototypeName);
        sb.append("</strong>");
        sb.append(StringPool.OPEN_PARENTHESIS);
        sb.append(layoutPrototypeUuid);
        sb.append(StringPool.CLOSE_PARENTHESIS);
        sb.append("</li>");
      }
      sb.append("</ul>");
      errorMessage=sb.toString();
    }
  }
 else {
    errorType=ServletResponseConstants.SC_FILE_CUSTOM_EXCEPTION;
  }
  deleteTempFileEntry(themeDisplay.getScopeGroupId());
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  jsonObject.put("status",errorType);
  jsonObject.put("message",errorMessage);
  writeJSON(actionRequest,actionResponse,jsonObject);
  ServletResponseUtil.write(response,String.valueOf(errorType));
}
