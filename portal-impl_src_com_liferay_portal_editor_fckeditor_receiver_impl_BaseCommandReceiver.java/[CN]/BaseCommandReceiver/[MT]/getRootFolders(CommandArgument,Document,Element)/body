{
  LinkedHashMap<String,Object> groupParams=new LinkedHashMap<String,Object>();
  groupParams.put("usersGroups",new Long(arg.getUserId()));
  List<Group> groups=GroupLocalServiceUtil.search(arg.getCompanyId(),null,null,groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  User user=UserLocalServiceUtil.getUserById(arg.getUserId());
  List<Organization> userOrgs=user.getOrganizations();
  for (  Organization organization : userOrgs) {
    groups.add(0,organization.getGroup());
  }
  if (user.isLayoutsRequired()) {
    Group userGroup=user.getGroup();
    groups.add(0,userGroup);
  }
  for (  Group group : groups) {
    Element folderEl=doc.createElement("Folder");
    foldersEl.appendChild(folderEl);
    folderEl.setAttribute("name",group.getGroupId() + " - " + group.getDescriptiveName());
  }
}
