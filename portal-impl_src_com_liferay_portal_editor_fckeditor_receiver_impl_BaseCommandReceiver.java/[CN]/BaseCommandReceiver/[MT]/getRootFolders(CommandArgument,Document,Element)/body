{
  LinkedHashMap groupParams=new LinkedHashMap();
  groupParams.put("usersGroups",new Long(arg.getUserId()));
  List groups=GroupLocalServiceUtil.search(arg.getCompanyId(),null,null,groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  User user=UserLocalServiceUtil.getUserById(arg.getUserId());
  List userOrgs=user.getOrganizations();
  Iterator itr=userOrgs.iterator();
  while (itr.hasNext()) {
    Organization organization=(Organization)itr.next();
    groups.add(0,organization.getGroup());
  }
  if (user.isLayoutsRequired()) {
    Group userGroup=user.getGroup();
    groups.add(0,userGroup);
  }
  for (int i=0; i < groups.size(); ++i) {
    Group group=(Group)groups.get(i);
    Element folderEl=doc.createElement("Folder");
    foldersEl.appendChild(folderEl);
    folderEl.setAttribute("name",group.getGroupId() + " - " + group.getDescriptiveName());
  }
}
