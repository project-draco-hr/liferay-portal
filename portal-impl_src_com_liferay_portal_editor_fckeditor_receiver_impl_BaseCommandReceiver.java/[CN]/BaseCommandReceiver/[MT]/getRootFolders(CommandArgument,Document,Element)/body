{
  List<Group> groups=new UniqueList<Group>();
  LinkedHashMap<String,Object> groupParams=new LinkedHashMap<String,Object>();
  groupParams.put("usersGroups",new Long(commandArgument.getUserId()));
  groups.addAll(GroupLocalServiceUtil.search(commandArgument.getCompanyId(),null,null,groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS));
  List<Organization> userOrgs=OrganizationLocalServiceUtil.getUserOrganizations(commandArgument.getUserId());
  for (  Organization organization : userOrgs) {
    groups.add(0,organization.getGroup());
  }
  if (PropsValues.LAYOUT_USER_PRIVATE_LAYOUTS_ENABLED || PropsValues.LAYOUT_USER_PUBLIC_LAYOUTS_ENABLED) {
    Group userGroup=GroupLocalServiceUtil.getUserGroup(commandArgument.getCompanyId(),commandArgument.getUserId());
    groups.add(0,userGroup);
  }
  Group companyGroup=GroupLocalServiceUtil.getCompanyGroup(commandArgument.getCompanyId());
  groups.add(0,companyGroup);
  ThemeDisplay themeDisplay=commandArgument.getThemeDisplay();
  long doAsGroupId=themeDisplay.getDoAsGroupId();
  HttpServletRequest request=commandArgument.getHttpServletRequest();
  String portletId=ParamUtil.getString(request,"p_p_id");
  for (  Group group : groups) {
    Element folderElement=document.createElement("Folder");
    foldersElement.appendChild(folderElement);
    long groupId=group.getGroupId();
    String descriptiveName=HtmlUtil.escape(group.getDescriptiveName());
    if (group.hasStagingGroup()) {
      Group stagingGroup=group.getStagingGroup();
      if ((stagingGroup.getGroupId() == doAsGroupId) && group.isStagedPortlet(portletId) && !group.isStagedRemotely()&& isStagedData(group)) {
        groupId=stagingGroup.getGroupId();
        descriptiveName=HtmlUtil.escape(stagingGroup.getDescriptiveName());
      }
    }
    folderElement.setAttribute("name",groupId + " - " + descriptiveName);
  }
}
