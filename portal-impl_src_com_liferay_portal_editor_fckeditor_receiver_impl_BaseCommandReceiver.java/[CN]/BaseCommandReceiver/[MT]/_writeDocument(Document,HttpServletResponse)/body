{
  try {
    doc.getDocumentElement().normalize();
    TransformerFactory transformerFactory=TransformerFactory.newInstance();
    Transformer transformer=transformerFactory.newTransformer();
    DOMSource source=new DOMSource(doc);
    if (_log.isDebugEnabled()) {
      StreamResult result=new StreamResult(System.out);
      transformer.transform(source,result);
    }
    response.setContentType("text/xml; charset=UTF-8");
    response.setHeader("Cache-Control","no-cache");
    PrintWriter out=response.getWriter();
    StreamResult result=new StreamResult(out);
    transformer.transform(source,result);
    out.flush();
    out.close();
  }
 catch (  Exception e) {
    throw new FCKException(e);
  }
}
