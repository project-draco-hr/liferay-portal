{
  String returnValue=null;
  try {
    ServletFileUpload servletFileUpload=new LiferayFileUpload(new LiferayFileItemFactory(UploadServletRequestImpl.getTempDir()),request);
    servletFileUpload.setFileSizeMax(PrefsPropsUtil.getLong(PropsKeys.UPLOAD_SERVLET_REQUEST_IMPL_MAX_SIZE));
    LiferayServletRequest liferayServletRequest=new LiferayServletRequest(request);
    List<FileItem> fileItems=servletFileUpload.parseRequest(liferayServletRequest);
    Map<String,Object> fields=new HashMap<String,Object>();
    for (    FileItem fileItem : fileItems) {
      if (fileItem.isFormField()) {
        fields.put(fileItem.getFieldName(),fileItem.getString());
      }
 else {
        fields.put(fileItem.getFieldName(),fileItem);
      }
    }
    DiskFileItem diskFileItem=(DiskFileItem)fields.get("NewFile");
    String fileName=StringUtil.replace(diskFileItem.getName(),CharPool.BACK_SLASH,CharPool.SLASH);
    String[] fileNameArray=StringUtil.split(fileName,"/");
    fileName=fileNameArray[fileNameArray.length - 1];
    String extension=_getExtension(fileName);
    returnValue=fileUpload(commandArgument,fileName,diskFileItem.getStoreLocation(),extension);
  }
 catch (  Exception e) {
    FCKException fcke=null;
    if (e instanceof FCKException) {
      fcke=(FCKException)e;
    }
 else {
      fcke=new FCKException(e);
    }
    Throwable cause=fcke.getCause();
    returnValue="203";
    if (cause != null) {
      String causeString=GetterUtil.getString(cause.toString());
      if ((causeString.indexOf("NoSuchFolderException") != -1) || (causeString.indexOf("NoSuchGroupException") != -1)) {
        returnValue="204";
      }
 else       if (causeString.indexOf("ImageNameException") != -1) {
        returnValue="205";
      }
 else       if ((causeString.indexOf("FileExtensionException") != -1) || (causeString.indexOf("FileNameException") != -1)) {
        returnValue="206";
      }
 else       if (causeString.indexOf("PrincipalException") != -1) {
        returnValue="207";
      }
 else       if ((causeString.indexOf("ImageSizeException") != -1) || (causeString.indexOf("FileSizeException") != -1)) {
        returnValue="208";
      }
 else       if (causeString.indexOf("SystemException") != -1) {
        returnValue="209";
      }
 else {
        throw fcke;
      }
    }
    _writeUploadResponse(returnValue,response);
  }
  _writeUploadResponse(returnValue,response);
}
