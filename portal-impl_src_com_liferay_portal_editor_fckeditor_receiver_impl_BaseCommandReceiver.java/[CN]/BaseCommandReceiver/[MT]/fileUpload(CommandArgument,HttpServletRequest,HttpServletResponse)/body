{
  ServletFileUpload upload=new ServletFileUpload(new LiferayFileItemFactory(UploadServletRequest.DEFAULT_TEMP_DIR));
  List items=null;
  try {
    items=upload.parseRequest(req);
  }
 catch (  FileUploadException fue) {
    throw new FCKException(fue);
  }
  Map fields=new HashMap();
  Iterator itr=items.iterator();
  while (itr.hasNext()) {
    FileItem item=(FileItem)itr.next();
    if (item.isFormField()) {
      fields.put(item.getFieldName(),item.getString());
    }
 else {
      fields.put(item.getFieldName(),item);
    }
  }
  DiskFileItem fileItem=(DiskFileItem)fields.get("NewFile");
  String fileName=StringUtil.replace(fileItem.getName(),"\\","/");
  String[] fileNameArray=StringUtil.split(fileName,"/");
  fileName=fileNameArray[fileNameArray.length - 1];
  String extension=_getExtension(fileName);
  String returnValue=null;
  try {
    returnValue=fileUpload(arg,fileName,fileItem.getStoreLocation(),extension);
  }
 catch (  FCKException fcke) {
    Throwable cause=fcke.getCause();
    returnValue="203";
    if (cause != null) {
      String causeString=GetterUtil.getString(cause.toString());
      if ((causeString.indexOf("NoSuchFolderException") != -1) || (causeString.indexOf("NoSuchGroupException") != -1)) {
        returnValue="204";
      }
 else       if (causeString.indexOf("ImageNameException") != -1) {
        returnValue="205";
      }
 else       if (causeString.indexOf("FileNameException") != -1) {
        returnValue="206";
      }
 else       if (causeString.indexOf("PrincipalException") != -1) {
        returnValue="207";
      }
 else {
        throw fcke;
      }
    }
    _writeUploadResponse(returnValue,res);
  }
  _writeUploadResponse(returnValue,res);
}
