{
  String salt=null;
  if (Validator.isNull(currentEncryptedPassword)) {
    int rounds=_DEFAULT_BCRYPT_ROUNDS;
    Matcher algorithmRoundsMatcher=_BCRYPT_PATTERN.matcher(algorithm);
    if (algorithmRoundsMatcher.matches()) {
      rounds=GetterUtil.getInteger(algorithmRoundsMatcher.group(1),rounds);
    }
    salt=BCrypt.gensalt(rounds);
  }
 else {
    salt=currentEncryptedPassword.substring(0,29);
  }
  return BCrypt.hashpw(clearTextPassword,salt);
}
