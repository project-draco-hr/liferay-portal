{
  StringBundler sb=new StringBundler();
  String page=_internalPage.toString();
  int ixTagOpen=page.indexOf(startTag);
  int ixTagEnd=0;
  int ixRefStart=0;
  int ixRefEnd=0;
  try {
    while (ixTagOpen != -1) {
      sb.append(page.substring(0,ixTagOpen));
      page=page.substring(ixTagOpen);
      ixTagEnd=page.indexOf(endTag);
      ixRefStart=page.indexOf(ref);
      if ((ixRefStart == -1) || (ixRefStart > ixTagEnd)) {
        sb.append(page.substring(0,ixTagEnd));
        page=page.substring(ixTagEnd);
      }
 else {
        String strQuote=StringPool.BLANK;
        String url=StringPool.BLANK;
        ixRefStart=ixRefStart + ref.length();
        sb.append(page.substring(0,ixRefStart));
        page=page.substring(ixRefStart);
        if (page.startsWith(StringPool.APOSTROPHE)) {
          strQuote=StringPool.APOSTROPHE;
        }
 else         if (page.startsWith(StringPool.QUOTE)) {
          strQuote=StringPool.QUOTE;
        }
        if (strQuote.length() > 0) {
          sb.append(strQuote);
          page=page.substring(1);
          ixRefEnd=page.indexOf(strQuote);
          url=page.substring(0,ixRefEnd);
        }
 else {
          ixTagEnd=page.indexOf(endTag);
          ixRefEnd=0;
          StringBundler nqurl=new StringBundler();
          boolean bEnd=false;
          while (bEnd == false) {
            char c=page.charAt(ixRefEnd);
            if ((Character.isSpaceChar(c) == false) && (ixRefEnd < ixTagEnd)) {
              ixRefEnd++;
              nqurl.append(c);
            }
 else {
              bEnd=true;
              ixRefEnd--;
            }
          }
          url=nqurl.toString();
        }
        if (url.charAt(0) == CharPool.POUND || url.startsWith("http")) {
          sb.append(url).append(strQuote);
        }
 else {
          actionURL.setParameter(actionParameterName,url);
          sb.append(actionURL.toString()).append(strQuote);
        }
        page=page.substring(ixRefEnd + 1);
      }
      ixTagOpen=page.indexOf(startTag);
    }
    sb.append(page);
  }
 catch (  Exception e) {
    _log.error(e);
  }
  _internalPage=sb;
}
