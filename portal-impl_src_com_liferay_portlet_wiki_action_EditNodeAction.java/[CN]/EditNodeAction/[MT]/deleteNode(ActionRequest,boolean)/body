{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  int nodeCount=WikiNodeLocalServiceUtil.getNodesCount(themeDisplay.getScopeGroupId());
  if (nodeCount == 1) {
    SessionErrors.add(actionRequest,RequiredNodeException.class);
    return;
  }
  long nodeId=ParamUtil.getLong(actionRequest,"nodeId");
  WikiNode wikiNode=WikiNodeServiceUtil.getNode(nodeId);
  String oldName=wikiNode.getName();
  WikiCacheThreadLocal.setClearCache(false);
  WikiNode trashWikiNode=null;
  if (moveToTrash) {
    trashWikiNode=WikiNodeServiceUtil.moveNodeToTrash(nodeId);
  }
 else {
    WikiNodeServiceUtil.deleteNode(nodeId);
  }
  WikiCacheUtil.clearCache(nodeId);
  WikiCacheThreadLocal.setClearCache(true);
  WikiSettings wikiSettings=WikiUtil.getWikiSettings(wikiNode.getGroupId());
  replace(wikiSettings,oldName,StringPool.BLANK);
  if (moveToTrash && (trashWikiNode != null)) {
    TrashUtil.addTrashSessionMessages(actionRequest,trashWikiNode);
    hideDefaultSuccessMessage(actionRequest);
  }
}
