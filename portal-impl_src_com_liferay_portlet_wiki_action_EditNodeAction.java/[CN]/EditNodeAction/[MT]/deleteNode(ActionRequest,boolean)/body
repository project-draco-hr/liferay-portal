{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  int nodeCount=WikiNodeLocalServiceUtil.getNodesCount(themeDisplay.getScopeGroupId());
  if (nodeCount == 1) {
    SessionErrors.add(actionRequest,RequiredNodeException.class);
    return;
  }
  long nodeId=ParamUtil.getLong(actionRequest,"nodeId");
  String oldName=getNodeName(nodeId);
  WikiCacheThreadLocal.setClearCache(false);
  WikiNode node=null;
  if (moveToTrash) {
    node=WikiNodeServiceUtil.moveNodeToTrash(nodeId);
  }
 else {
    WikiNodeServiceUtil.deleteNode(nodeId);
  }
  WikiCacheUtil.clearCache(nodeId);
  WikiCacheThreadLocal.setClearCache(true);
  updatePreferences(actionRequest,oldName,StringPool.BLANK);
  if (moveToTrash && (node != null)) {
    TrashUtil.addTrashSessionMessages(actionRequest,node);
    hideDefaultSuccessMessage(actionRequest);
  }
}
