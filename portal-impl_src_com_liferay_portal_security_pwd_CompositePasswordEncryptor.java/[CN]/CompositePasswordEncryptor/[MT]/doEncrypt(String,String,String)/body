{
  if (Validator.isNull(algorithm)) {
    throw new IllegalArgumentException("Must specify an encryption algorithm.");
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Searching passwordEncryptor for " + algorithm);
  }
  PasswordEncryptor passwordEncryptor=null;
  if (algorithm.startsWith(PasswordEncryptorUtil.TYPE_BCRYPT)) {
    passwordEncryptor=_passwordEncryptors.get(PasswordEncryptorUtil.TYPE_BCRYPT);
  }
 else   if (algorithm.startsWith(PasswordEncryptorUtil.TYPE_PBKDF2)) {
    passwordEncryptor=_passwordEncryptors.get(PasswordEncryptorUtil.TYPE_PBKDF2);
  }
 else {
    passwordEncryptor=_passwordEncryptors.get(algorithm);
  }
  if (passwordEncryptor == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("No passwordEncryptor found for " + algorithm + ", using default");
    }
    passwordEncryptor=_defaultPasswordEncryptor;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Found " + passwordEncryptor.getClass().getName() + " to encrypt password using "+ algorithm);
  }
  return passwordEncryptor.encrypt(algorithm,clearTextPassword,currentEncryptedPassword);
}
