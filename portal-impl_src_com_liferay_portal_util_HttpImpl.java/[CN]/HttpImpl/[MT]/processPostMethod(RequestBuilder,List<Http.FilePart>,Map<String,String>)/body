{
  if ((fileParts == null) || fileParts.isEmpty()) {
    if (parts != null) {
      for (      Map.Entry<String,String> entry : parts.entrySet()) {
        String value=entry.getValue();
        if (value != null) {
          requestBuilder.addParameter(entry.getKey(),value);
        }
      }
    }
  }
 else {
    MultipartEntityBuilder multipartEntityBuilder=MultipartEntityBuilder.create();
    if (parts != null) {
      for (      Map.Entry<String,String> entry : parts.entrySet()) {
        String value=entry.getValue();
        if (value != null) {
          multipartEntityBuilder.addPart(entry.getKey(),new StringBody(value,ContentType.create("text/plain",StringPool.UTF8)));
        }
      }
    }
    for (    Http.FilePart filePart : fileParts) {
      ByteArrayBody byteArrayBody=new ByteArrayBody(filePart.getValue(),ContentType.DEFAULT_BINARY,filePart.getFileName());
      multipartEntityBuilder.addPart(filePart.getName(),byteArrayBody);
    }
    requestBuilder.setEntity(multipartEntityBuilder.build());
  }
}
