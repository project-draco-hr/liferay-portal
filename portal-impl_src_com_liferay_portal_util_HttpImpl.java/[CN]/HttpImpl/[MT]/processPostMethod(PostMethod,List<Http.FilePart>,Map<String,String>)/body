{
  if ((fileParts == null) || fileParts.isEmpty()) {
    if (parts != null) {
      for (      Map.Entry<String,String> entry : parts.entrySet()) {
        String value=entry.getValue();
        if (value != null) {
          postMethod.addParameter(entry.getKey(),value);
        }
      }
    }
  }
 else {
    List<Part> partsList=new ArrayList<Part>();
    if (parts != null) {
      for (      Map.Entry<String,String> entry : parts.entrySet()) {
        String value=entry.getValue();
        if (value != null) {
          StringPart stringPart=new StringPart(entry.getKey(),value);
          partsList.add(stringPart);
        }
      }
    }
    for (    Http.FilePart filePart : fileParts) {
      partsList.add(toCommonsFilePart(filePart));
    }
    MultipartRequestEntity multipartRequestEntity=new MultipartRequestEntity(partsList.toArray(new Part[partsList.size()]),postMethod.getParams());
    postMethod.setRequestEntity(multipartRequestEntity);
  }
}
