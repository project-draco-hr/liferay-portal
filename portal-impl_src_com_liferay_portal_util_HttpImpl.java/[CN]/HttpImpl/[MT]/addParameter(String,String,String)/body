{
  if (url == null) {
    return null;
  }
  String[] urlArray=PortalUtil.stripURLAnchor(url,StringPool.POUND);
  url=urlArray[0];
  String anchor=urlArray[1];
  StringBundler sb=new StringBundler(6);
  sb.append(url);
  if (url.indexOf(CharPool.QUESTION) == -1) {
    sb.append(StringPool.QUESTION);
  }
 else   if (!url.endsWith(StringPool.QUESTION) && !url.endsWith(StringPool.AMPERSAND)) {
    sb.append(StringPool.AMPERSAND);
  }
  sb.append(name);
  sb.append(StringPool.EQUAL);
  sb.append(encodeURL(value));
  sb.append(anchor);
  String result=sb.toString();
  if (result.length() > URL_MAXIMUM_LENGTH) {
    result=shortenURL(result,2);
  }
  return result;
}
