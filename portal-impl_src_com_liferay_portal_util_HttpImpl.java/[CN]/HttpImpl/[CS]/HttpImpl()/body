{
  if (Validator.isNotNull(_NON_PROXY_HOSTS)) {
    String nonProxyHostsRegEx=_NON_PROXY_HOSTS;
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\.","\\\\.");
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\*",".*?");
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\|",")|(");
    nonProxyHostsRegEx="(" + nonProxyHostsRegEx + ")";
    _nonProxyHostsPattern=Pattern.compile(nonProxyHostsRegEx);
  }
 else {
    _nonProxyHostsPattern=null;
  }
  _poolingHttpClientConnectionManager=new PoolingHttpClientConnectionManager();
  _poolingHttpClientConnectionManager.setDefaultMaxPerRoute(_MAX_CONNECTIONS_PER_HOST);
  _poolingHttpClientConnectionManager.setMaxTotal(_MAX_TOTAL_CONNECTIONS);
  RequestConfig.Builder requestConfigBuilder=RequestConfig.custom();
  requestConfigBuilder=requestConfigBuilder.setConnectTimeout(_TIMEOUT);
  requestConfigBuilder=requestConfigBuilder.setConnectionRequestTimeout(_TIMEOUT);
  RequestConfig requestConfig=requestConfigBuilder.build();
  HttpClientBuilder httpClientBuilder=HttpClientBuilder.create();
  httpClientBuilder.setConnectionManager(_poolingHttpClientConnectionManager);
  httpClientBuilder.setDefaultRequestConfig(requestConfig);
  _httpClient=httpClientBuilder.build();
  if (!hasProxyConfig() || Validator.isNull(_PROXY_USERNAME)) {
    _proxyCredentials=null;
    _proxyHttpClient=_httpClient;
    return;
  }
  _proxyAuthPrefs.add(AuthSchemes.BASIC);
  _proxyAuthPrefs.add(AuthSchemes.DIGEST);
  if (_PROXY_AUTH_TYPE.equals("username-password")) {
    _proxyCredentials=new UsernamePasswordCredentials(_PROXY_USERNAME,_PROXY_PASSWORD);
    _proxyAuthPrefs.add(AuthSchemes.NTLM);
  }
 else   if (_PROXY_AUTH_TYPE.equals("ntlm")) {
    _proxyCredentials=new NTCredentials(_PROXY_USERNAME,_PROXY_PASSWORD,_PROXY_NTLM_HOST,_PROXY_NTLM_DOMAIN);
    _proxyAuthPrefs.add(0,AuthSchemes.NTLM);
  }
 else {
    _proxyCredentials=null;
  }
  HttpClientBuilder proxyHttpClientBuilder=HttpClientBuilder.create();
  proxyHttpClientBuilder.setConnectionManager(_poolingHttpClientConnectionManager);
  requestConfigBuilder.setProxy(new HttpHost(_PROXY_HOST,_PROXY_PORT));
  requestConfigBuilder.setProxyPreferredAuthSchemes(_proxyAuthPrefs);
  RequestConfig proxyRequestConfig=requestConfigBuilder.build();
  proxyHttpClientBuilder.setDefaultRequestConfig(proxyRequestConfig);
  _proxyHttpClient=proxyHttpClientBuilder.build();
}
