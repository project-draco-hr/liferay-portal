{
  if (Validator.isNotNull(_NON_PROXY_HOSTS)) {
    String nonProxyHostsRegEx=_NON_PROXY_HOSTS;
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\.","\\\\.");
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\*",".*?");
    nonProxyHostsRegEx=nonProxyHostsRegEx.replaceAll("\\|",")|(");
    nonProxyHostsRegEx="(" + nonProxyHostsRegEx + ")";
    _nonProxyHostsPattern=Pattern.compile(nonProxyHostsRegEx);
  }
  MultiThreadedHttpConnectionManager connectionManager=new MultiThreadedHttpConnectionManager();
  HttpConnectionParams params=connectionManager.getParams();
  params.setParameter("maxConnectionsPerHost",new Integer(_MAX_CONNECTIONS_PER_HOST));
  params.setParameter("maxTotalConnections",new Integer(_MAX_TOTAL_CONNECTIONS));
  params.setConnectionTimeout(_TIMEOUT);
  params.setSoTimeout(_TIMEOUT);
  _client.setHttpConnectionManager(connectionManager);
  _proxyClient.setHttpConnectionManager(connectionManager);
  if (hasProxyConfig() && Validator.isNotNull(_PROXY_USERNAME)) {
    if (_PROXY_AUTH_TYPE.equals("username-password")) {
      _proxyCredentials=new UsernamePasswordCredentials(_PROXY_USERNAME,_PROXY_PASSWORD);
    }
 else     if (_PROXY_AUTH_TYPE.equals("ntlm")) {
      _proxyCredentials=new NTCredentials(_PROXY_USERNAME,_PROXY_PASSWORD,_PROXY_NTLM_HOST,_PROXY_NTLM_DOMAIN);
      List<String> authPrefs=new ArrayList<String>();
      authPrefs.add(AuthPolicy.NTLM);
      authPrefs.add(AuthPolicy.BASIC);
      authPrefs.add(AuthPolicy.DIGEST);
      _proxyClient.getParams().setParameter(AuthPolicy.AUTH_SCHEME_PRIORITY,authPrefs);
    }
  }
}
