{
  RenderedImage renderedImage=pdPage.convertToImage(BufferedImage.TYPE_INT_RGB,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_DPI);
  if (PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_MAX_HEIGHT != 0) {
    renderedImage=ImageProcessorUtil.scale(renderedImage,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_MAX_WIDTH,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_MAX_HEIGHT);
  }
 else {
    renderedImage=ImageProcessorUtil.scale(renderedImage,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_MAX_WIDTH);
  }
  if (index == 0) {
    storeThumbnailImages(fileVersion,renderedImage);
  }
 else {
    File tempFile=null;
    try {
      String tempFileId=DLUtil.getTempFileId(fileVersion.getFileEntryId(),fileVersion.getVersion());
      tempFile=getPreviewTempFile(tempFileId,index);
      tempFile.createNewFile();
      ImageIO.write(renderedImage,PREVIEW_TYPE,new FileOutputStream(tempFile));
      addFileToStore(fileVersion.getCompanyId(),PREVIEW_PATH,getPreviewFilePath(fileVersion,index),tempFile);
    }
  finally {
      FileUtil.delete(tempFile);
    }
  }
}
