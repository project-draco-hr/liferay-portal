{
  CharPipe charPipe=new CharPipe(4);
  Writer writer=charPipe.getWriter();
  char[] data="abcd".toCharArray();
  writer.write(data);
  Reader reader=charPipe.getReader();
  char[] buffer=new char[4];
  int result=reader.read(buffer,0,3);
  Assert.assertEquals(3,result);
  Assert.assertEquals('a',buffer[0]);
  Assert.assertEquals('b',buffer[1]);
  Assert.assertEquals('c',buffer[2]);
  writer.write(data,0,3);
  result=reader.read(buffer);
  Assert.assertEquals(4,result);
  Assert.assertEquals('d',buffer[0]);
  Assert.assertEquals('a',buffer[1]);
  Assert.assertEquals('b',buffer[2]);
  Assert.assertEquals('c',buffer[3]);
  writer.write(data);
  result=reader.read(buffer);
  Assert.assertEquals(4,result);
  Assert.assertEquals('a',buffer[0]);
  Assert.assertEquals('b',buffer[1]);
  Assert.assertEquals('c',buffer[2]);
  Assert.assertEquals('d',buffer[3]);
  charPipe.close();
}
