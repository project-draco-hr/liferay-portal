{
  String mainPath=Portal.PATH_MAIN;
  String redirect=mainPath;
  String pathInfo=request.getPathInfo();
  request.setAttribute(WebKeys.FRIENDLY_URL,_friendlyURLPathPrefix.concat(pathInfo));
  Object[] object=null;
  boolean forceRedirect=false;
  try {
    object=getRedirect(request,pathInfo,mainPath,request.getParameterMap());
    redirect=(String)object[0];
    forceRedirect=GetterUtil.getBoolean(object[1]);
    if (request.getAttribute(WebKeys.LAST_PATH) == null) {
      LastPath lastPath=new LastPath(_friendlyURLPathPrefix,pathInfo,request.getParameterMap());
      request.setAttribute(WebKeys.LAST_PATH,lastPath);
    }
  }
 catch (  NoSuchLayoutException nsle) {
    _log.warn(nsle);
    PortalUtil.sendError(HttpServletResponse.SC_NOT_FOUND,nsle,request,response);
    return;
  }
catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(e);
    }
  }
  if (Validator.isNull(redirect)) {
    redirect=mainPath;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Redirect " + redirect);
  }
  if ((redirect.charAt(0) == CharPool.SLASH) && !forceRedirect) {
    ServletContext servletContext=getServletContext();
    RequestDispatcher requestDispatcher=servletContext.getRequestDispatcher(redirect);
    if (requestDispatcher != null) {
      requestDispatcher.forward(request,response);
    }
  }
 else {
    response.sendRedirect(redirect);
  }
}
