{
  String[] oldValues=portletPreferences.getValues(key,null);
  if (oldValues == null) {
    return;
  }
  Layout layout=_layoutLocalService.getLayout(plid);
  String companyGroupScopeId=AssetPublisherUtil.SCOPE_ID_GROUP_PREFIX + companyGroupId;
  List<String> newValues=new ArrayList<>(oldValues.length);
  for (  String oldValue : oldValues) {
    String newValue=StringUtil.replace(oldValue,"[$COMPANY_GROUP_SCOPE_ID$]",companyGroupScopeId);
    try {
      if (!AssetPublisherUtil.isScopeIdSelectable(PermissionThreadLocal.getPermissionChecker(),newValue,companyGroupId,layout)) {
        continue;
      }
      newValues.add(newValue);
    }
 catch (    NoSuchGroupException nsge) {
      if (_log.isInfoEnabled()) {
        _log.info("Ignoring scope " + newValue + " because the "+ "referenced group was not found",nsge);
      }
    }
catch (    NoSuchLayoutException nsle) {
      if (_log.isInfoEnabled()) {
        _log.info("Ignoring scope " + newValue + " because the "+ "referenced layout was not found",nsle);
      }
    }
catch (    PrincipalException pe) {
      if (_log.isInfoEnabled()) {
        _log.info("Ignoring scope " + newValue + " because the "+ "referenced parent group no longer allows "+ "sharing content with child sites",pe);
      }
    }
  }
  portletPreferences.setValues(key,newValues.toArray(new String[newValues.size()]));
}
