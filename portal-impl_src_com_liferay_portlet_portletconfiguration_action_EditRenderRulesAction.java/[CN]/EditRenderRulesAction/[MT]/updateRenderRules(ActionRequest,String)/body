{
  Layout layout=(Layout)actionRequest.getAttribute(WebKeys.LAYOUT);
  Layout storedLayout=LayoutLocalServiceUtil.getLayout(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId());
  UnicodeProperties layoutTypeSettingsProperties=layout.getTypeSettingsProperties();
  UnicodeProperties storedLayoutTypeSettingsProperties=storedLayout.getTypeSettingsProperties();
  boolean modified=false;
  for (  String className : PropsValues.PORTLET_RENDER_RULES_EVALUATORS) {
    String key=portletId + "_" + className;
    String oldRules=layoutTypeSettingsProperties.getProperty(key);
    String newRules=ParamUtil.getString(actionRequest,className);
    if (oldRules != null) {
      modified=!oldRules.equals(newRules);
    }
 else     if (newRules != null) {
      modified=!newRules.equals(oldRules);
    }
    if (modified) {
      layoutTypeSettingsProperties.setProperty(key,newRules);
      storedLayoutTypeSettingsProperties.setProperty(key,newRules);
    }
  }
  if (modified) {
    LayoutLocalServiceUtil.updateLayout(storedLayout);
  }
}
