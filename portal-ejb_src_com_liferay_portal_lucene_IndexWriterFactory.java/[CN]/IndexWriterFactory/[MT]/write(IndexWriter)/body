{
  boolean writerFound=false;
synchronized (this) {
    if (!_writerLookup.isEmpty()) {
      Iterator itr=_writerLookup.values().iterator();
      while (itr.hasNext()) {
        IndexWriterData writerData=(IndexWriterData)itr.next();
        if (writerData.getWriter() == writer) {
          writerFound=true;
          decrement(writerData);
          break;
        }
      }
    }
  }
  if (!writerFound) {
    try {
      writer.optimize();
    }
  finally {
      writer.close();
    }
  }
}
