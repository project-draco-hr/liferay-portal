{
  Bundle bundle=bundleContext.getBundle();
  Dictionary<String,String> headers=bundle.getHeaders();
  String configs=headers.get("Spring-Context");
  if (configs == null) {
    return null;
  }
  Bundle extenderBundle=_getExtenderBundle();
  ClassLoader classLoader=new BundleResolverClassLoader(bundle,extenderBundle);
  Bundle compositeResourceLoaderBundle=new CompositeResourceLoaderBundle(bundle,extenderBundle);
  ServiceBuilderApplicationContext serviceBuilderApplicationContext=new ServiceBuilderApplicationContext(compositeResourceLoaderBundle,buildConfigLocations(headers));
  serviceBuilderApplicationContext.setBundleContext(bundleContext);
  serviceBuilderApplicationContext.addBeanFactoryPostProcessor(new ModuleBeanFactoryPostProcessor(classLoader));
  return serviceBuilderApplicationContext;
}
