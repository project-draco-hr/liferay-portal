{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  Theme theme=themeDisplay.getTheme();
  Layout layout=(Layout)req.getAttribute(WebKeys.LAYOUT);
  LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
  LayoutTemplate newTemplate=LayoutTemplateLocalUtil.getLayoutTemplate(newLayoutTemplateId,false,theme.getThemeId());
  List newColumns=getColumnNames(newTemplate.getContent(),portletResource);
  LayoutTemplate oldTemplate=LayoutTemplateLocalUtil.getLayoutTemplate(oldLayoutTemplateId,false,theme.getThemeId());
  List oldColumns=getColumnNames(oldTemplate.getContent(),portletResource);
  layoutTypePortlet.reorganizePortlets(newColumns,oldColumns);
  LayoutLocalServiceUtil.updateLayout(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId(),layout.getTypeSettings());
}
