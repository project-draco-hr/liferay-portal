{
  String layoutTemplateId=ParamUtil.getString(actionRequest,"layoutTemplateId");
  String portletSetupShowBorders=ParamUtil.getString(actionRequest,"portletSetupShowBorders");
  String portletResource=ParamUtil.getString(actionRequest,"portletResource");
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getPortletSetup(actionRequest,portletResource);
  String oldLayoutTemplateId=preferences.getValue("layout-template-id",PropsValues.NESTED_PORTLETS_LAYOUT_TEMPLATE_DEFAULT);
  if (!oldLayoutTemplateId.equals(layoutTemplateId)) {
    reorganizeNestedColumns(actionRequest,portletResource,layoutTemplateId,oldLayoutTemplateId);
  }
  preferences.setValue("layout-template-id",layoutTemplateId);
  preferences.setValue("portlet-setup-show-borders",portletSetupShowBorders);
  preferences.store();
  SessionMessages.add(actionRequest,portletConfig.getPortletName() + ".doConfigure");
}
