{
  String layoutTemplateId=ParamUtil.getString(req,"layoutTemplateId");
  String portletSetupShowBorders=ParamUtil.getString(req,"portletSetupShowBorders");
  String portletResource=ParamUtil.getString(req,"portletResource");
  PortletPreferences prefs=PortletPreferencesFactoryUtil.getPortletSetup(req,portletResource,true,true);
  String defaultLayoutTemplateId=PropsUtil.get(PropsUtil.NESTED_PORTLETS_LAYOUT_TEMPLATE_DEFAULT);
  String oldLayoutTemplateId=prefs.getValue("layout-template-id",defaultLayoutTemplateId);
  if (!oldLayoutTemplateId.equals(layoutTemplateId)) {
    reorganizePortlets(req,portletResource,layoutTemplateId,oldLayoutTemplateId);
  }
  prefs.setValue("layout-template-id",layoutTemplateId);
  prefs.setValue("portlet-setup-show-borders",portletSetupShowBorders);
  prefs.store();
  SessionMessages.add(req,config.getPortletName() + ".doConfigure");
}
