{
  if (scope.equals(Resource.SCOPE_COMPANY)) {
    unsetRolePermissions(roleId,companyId,name,typeId,Resource.SCOPE_GROUP,actionId);
  }
 else   if (scope.equals(Resource.SCOPE_GROUP)) {
    unsetRolePermissions(roleId,companyId,name,typeId,Resource.SCOPE_COMPANY,actionId);
  }
 else   if (scope.equals(Resource.SCOPE_INDIVIDUAL)) {
    throw new NoSuchPermissionException();
  }
  Resource resource=ResourceLocalServiceUtil.addResource(companyId,name,typeId,scope,primKey);
  Permission permission=null;
  try {
    permission=PermissionUtil.findByA_R(actionId,resource.getResourceId());
  }
 catch (  NoSuchPermissionException nspe) {
    String permissionId=Long.toString(CounterLocalServiceUtil.increment(Permission.class.getName()));
    permission=PermissionUtil.create(permissionId);
    permission.setCompanyId(companyId);
    permission.setActionId(actionId);
    permission.setResourceId(resource.getResourceId());
    PermissionUtil.update(permission);
  }
  RoleUtil.addPermission(roleId,permission);
}
