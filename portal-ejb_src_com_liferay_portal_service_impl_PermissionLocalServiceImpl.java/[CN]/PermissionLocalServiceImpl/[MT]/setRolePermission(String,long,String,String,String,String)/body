{
  if (scope.equals(ResourceImpl.SCOPE_COMPANY)) {
    unsetRolePermissions(roleId,companyId,name,ResourceImpl.SCOPE_GROUP,actionId);
  }
 else   if (scope.equals(ResourceImpl.SCOPE_GROUP)) {
    unsetRolePermissions(roleId,companyId,name,ResourceImpl.SCOPE_COMPANY,actionId);
  }
 else   if (scope.equals(ResourceImpl.SCOPE_INDIVIDUAL)) {
    throw new NoSuchPermissionException();
  }
  Resource resource=ResourceLocalServiceUtil.addResource(companyId,name,scope,primKey);
  Permission permission=null;
  try {
    permission=PermissionUtil.findByA_R(actionId,resource.getResourceId());
  }
 catch (  NoSuchPermissionException nspe) {
    long permissionId=CounterLocalServiceUtil.increment(Permission.class.getName());
    permission=PermissionUtil.create(permissionId);
    permission.setCompanyId(companyId);
    permission.setActionId(actionId);
    permission.setResourceId(resource.getResourceId());
    PermissionUtil.update(permission);
  }
  RoleUtil.addPermission(roleId,permission);
}
