{
  String portletAppName=portletModel.getPortletWebAppName();
  String portletName=portletModel.getPortletName();
  if (portletName == null || portletAppName == null) {
    int index=portletId.indexOf(PortletConstants.WAR_SEPARATOR);
    if (index != -1) {
      if (portletName == null) {
        if (_log.isDebugEnabled()) {
          _log.debug("Portlet Name is null for the Id:" + portletId);
        }
        portletName=portletId.substring(0,index);
      }
      if (portletAppName == null) {
        if (_log.isDebugEnabled()) {
          _log.debug("Portlet App Name is null for the Id:" + portletId);
        }
        portletAppName=portletId.substring(index + 5);
        int indexNext=portletAppName.indexOf("_INSTANCE_");
        if (indexNext != -1) {
          portletAppName=portletAppName.substring(0,indexNext);
        }
      }
    }
  }
  EntityID portletEntityId=new EntityID(new PortletID(portletAppName,portletName));
  portletEntityId.setPortletWindowName(portletId);
  return portletEntityId;
}
