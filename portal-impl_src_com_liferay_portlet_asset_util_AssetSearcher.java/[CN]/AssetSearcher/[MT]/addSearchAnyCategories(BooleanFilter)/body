{
  PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
  long[] anyCategoryIds=_assetEntryQuery.getAnyCategoryIds();
  if (anyCategoryIds.length == 0) {
    return;
  }
  long[] filteredAnyCategoryIds=AssetUtil.filterCategoryIds(permissionChecker,anyCategoryIds);
  if (filteredAnyCategoryIds.length == 0) {
    addImpossibleTerm(queryBooleanFilter,Field.ASSET_CATEGORY_IDS);
    return;
  }
  TermsFilter categoryIdsTermsFilter=new TermsFilter(Field.ASSET_CATEGORY_IDS);
  for (  long anyCategoryId : filteredAnyCategoryIds) {
    AssetCategory assetCategory=AssetCategoryLocalServiceUtil.fetchAssetCategory(anyCategoryId);
    if (assetCategory == null) {
      continue;
    }
    List<Long> categoryIds=new ArrayList<>();
    if (PropsValues.ASSET_CATEGORIES_SEARCH_HIERARCHICAL) {
      categoryIds.addAll(AssetCategoryLocalServiceUtil.getSubcategoryIds(anyCategoryId));
    }
    if (categoryIds.isEmpty()) {
      categoryIds.add(anyCategoryId);
    }
    categoryIdsTermsFilter.addValues(ArrayUtil.toStringArray(categoryIds.toArray(new Long[categoryIds.size()])));
  }
  queryBooleanFilter.add(categoryIdsTermsFilter,BooleanClauseOccur.MUST);
}
