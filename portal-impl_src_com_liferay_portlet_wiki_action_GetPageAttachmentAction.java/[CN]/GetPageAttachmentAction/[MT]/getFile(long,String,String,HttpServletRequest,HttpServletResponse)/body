{
  int x=fileName.indexOf(StringPool.SLASH);
  if (x != -1) {
    title=fileName.substring(0,x);
    fileName=fileName.substring(x + 1);
  }
  InputStream is=null;
  try {
    long pageResourceId=WikiPageResourceLocalServiceUtil.getPageResourcePrimKey(nodeId,title);
    WikiPageResource pageResource=WikiPageResourceLocalServiceUtil.getPageResource(pageResourceId);
    is=DLLocalServiceUtil.getFileAsStream(pageResource.getNode().getCompanyId(),CompanyImpl.SYSTEM,pageResource.getAttachmentsDir() + "/" + fileName);
    String contentType=MimeTypesUtil.getContentType(fileName);
    ServletResponseUtil.sendFile(res,fileName,is,contentType);
  }
 catch (  NoSuchFileException nsfe) {
    PortalUtil.sendError(HttpServletResponse.SC_NOT_FOUND,nsfe,req,res);
  }
catch (  NoSuchPageException nspe) {
    PortalUtil.sendError(HttpServletResponse.SC_NOT_FOUND,nspe,req,res);
  }
 finally {
    ServletResponseUtil.cleanUp(is);
  }
}
