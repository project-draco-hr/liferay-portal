{
  Registry registry=RegistryUtil.getRegistry();
  ResourceBundle resourceBundle=registry.getService(serviceReference);
  String languageId=(String)serviceReference.getProperty("language.id");
  ResourceBundleWrapper resourceBundleWrapper=_resourceBundleWrappers.get(languageId);
  if (resourceBundleWrapper == null) {
    resourceBundleWrapper=new ResourceBundleWrapper(languageId,resourceBundle);
    ResourceBundleWrapper previousResourceBundleWrapper=_resourceBundleWrappers.putIfAbsent(languageId,resourceBundleWrapper);
    if (previousResourceBundleWrapper == null) {
      return resourceBundle;
    }
 else {
      resourceBundleWrapper=previousResourceBundleWrapper;
    }
  }
  resourceBundleWrapper._addResourceBundle(resourceBundle);
  return resourceBundle;
}
