{
  long startTime=0;
  if (_log.isInfoEnabled()) {
    _log.info("Exporting portlet " + portletId);
    startTime=System.currentTimeMillis();
  }
  try {
    portletDataContext.addDeletionSystemEventStagedModelTypes(getDeletionSystemEventStagedModelTypes());
    for (    PortletDataHandlerControl portletDataHandlerControl : getExportControls()) {
      addUncheckedModelAdditionCount(portletDataContext,portletDataHandlerControl);
    }
    if (BackgroundTaskThreadLocal.hasBackgroundTask()) {
      PortletDataContext clonePortletDataContext=PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext);
      prepareManifestSummary(clonePortletDataContext,portletPreferences);
      PortletDataHandlerStatusMessageSenderUtil.sendStatusMessage("portletExport",portletId,clonePortletDataContext.getManifestSummary());
    }
    return doExportData(portletDataContext,portletId,portletPreferences);
  }
 catch (  Exception e) {
    throw new PortletDataException(e);
  }
 finally {
    if (_log.isInfoEnabled()) {
      long duration=System.currentTimeMillis() - startTime;
      _log.info("Exported portlet in " + Time.getDuration(duration));
    }
  }
}
