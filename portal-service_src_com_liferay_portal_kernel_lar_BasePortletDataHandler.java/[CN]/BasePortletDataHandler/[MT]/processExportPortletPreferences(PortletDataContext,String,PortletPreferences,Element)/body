{
  String displayStyle=getDisplayTemplate(portletDataContext,portletId,portletPreferences);
  if (Validator.isNotNull(displayStyle) && displayStyle.startsWith(PortletDisplayTemplate.DISPLAY_STYLE_PREFIX)) {
    long displayStyleGroupId=getDisplayTemplateGroupId(portletDataContext,portletId,portletPreferences);
    long previousScopeGroupId=portletDataContext.getScopeGroupId();
    if (displayStyleGroupId != portletDataContext.getScopeGroupId()) {
      portletDataContext.setScopeGroupId(displayStyleGroupId);
    }
    DDMTemplate ddmTemplate=PortletDisplayTemplateUtil.fetchDDMTemplate(portletDataContext.getGroupId(),displayStyle);
    if (ddmTemplate != null) {
      StagedModelDataHandlerUtil.exportStagedModel(portletDataContext,ddmTemplate);
    }
    portletDataContext.setScopeGroupId(previousScopeGroupId);
  }
  try {
    return doProcessExportPortletPreferences(portletDataContext,portletId,portletPreferences,rootElement);
  }
 catch (  Exception e) {
    throw new PortletDataException(e);
  }
}
