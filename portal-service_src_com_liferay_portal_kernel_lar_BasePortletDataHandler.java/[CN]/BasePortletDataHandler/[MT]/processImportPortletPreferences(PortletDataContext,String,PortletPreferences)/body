{
  try {
    String displayStyle=getDisplayTemplate(portletDataContext,portletId,portletPreferences);
    if (Validator.isNotNull(displayStyle) && displayStyle.startsWith(PortletDisplayTemplate.DISPLAY_STYLE_PREFIX)) {
      StagedModelDataHandlerUtil.importReferenceStagedModels(portletDataContext,DDMTemplate.class);
      long displayStyleGroupId=getDisplayTemplateGroupId(portletDataContext,portletId,portletPreferences);
      Map<Long,Long> groupIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(Group.class);
      long groupId=MapUtil.getLong(groupIds,displayStyleGroupId,displayStyleGroupId);
      DDMTemplate ddmTemplate=PortletDisplayTemplateUtil.fetchDDMTemplate(groupId,displayStyle);
      if (ddmTemplate != null) {
        portletPreferences.setValue("displayStyleGroupId",String.valueOf(ddmTemplate.getGroupId()));
      }
    }
 else {
      portletPreferences.setValue("displayStyleGroupId",StringPool.BLANK);
    }
    return doProcessImportPortletPreferences(portletDataContext,portletId,portletPreferences);
  }
 catch (  PortletDataException pde) {
    throw pde;
  }
catch (  Exception e) {
    throw new PortletDataException(e);
  }
}
