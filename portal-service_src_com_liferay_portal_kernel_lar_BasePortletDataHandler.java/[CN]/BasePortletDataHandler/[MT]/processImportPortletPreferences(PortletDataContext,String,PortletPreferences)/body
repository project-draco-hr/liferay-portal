{
  String displayStyle=getDisplayTemplate(portletDataContext,portletId,portletPreferences);
  if (Validator.isNotNull(displayStyle) && displayStyle.startsWith(PortletDisplayTemplate.DISPLAY_STYLE_PREFIX)) {
    DDMTemplate ddmTemplate=PortletDisplayTemplateUtil.fetchDDMTemplate(portletDataContext.getGroupId(),displayStyle);
    if (ddmTemplate == null) {
      ddmTemplate=PortletDisplayTemplateUtil.fetchDDMTemplate(portletDataContext.getCompanyGroupId(),displayStyle);
    }
    if (ddmTemplate == null) {
      String ddmTemplateUuid=PortletDisplayTemplateUtil.getDDMTemplateUuid(displayStyle);
      Element ddmTemplateElement=portletDataContext.getImportDataElement(DDMTemplate.class.getSimpleName(),"uuid",ddmTemplateUuid);
      String ddmTemplatePath=ddmTemplateElement.attributeValue("path");
      ddmTemplate=(DDMTemplate)portletDataContext.getZipEntryAsObject(ddmTemplatePath);
      if (ddmTemplate != null) {
        StagedModelDataHandlerUtil.importStagedModel(portletDataContext,ddmTemplate);
      }
    }
  }
  try {
    return doProcessImportPortletPreferences(portletDataContext,portletId,portletPreferences);
  }
 catch (  Exception e) {
    throw new PortletDataException(e);
  }
}
