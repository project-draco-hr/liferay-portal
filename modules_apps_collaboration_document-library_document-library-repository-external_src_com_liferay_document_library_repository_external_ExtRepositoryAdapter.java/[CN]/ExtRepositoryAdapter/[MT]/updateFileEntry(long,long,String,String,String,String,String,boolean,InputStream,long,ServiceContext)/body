{
  String extRepositoryFileEntryKey=getExtRepositoryObjectKey(fileEntryId);
  ExtRepositoryFileEntry extRepositoryFileEntry=_extRepository.getExtRepositoryObject(ExtRepositoryObjectType.FILE,extRepositoryFileEntryKey);
  boolean needsCheckIn=false;
  if (!isCheckedOut(extRepositoryFileEntry)) {
    _extRepository.checkOutExtRepositoryFileEntry(extRepositoryFileEntryKey);
    needsCheckIn=true;
  }
  if (inputStream != null) {
    extRepositoryFileEntry=_extRepository.updateExtRepositoryFileEntry(extRepositoryFileEntryKey,mimeType,inputStream);
  }
  if (!title.equals(extRepositoryFileEntry.getTitle())) {
    ExtRepositoryFolder folder=_extRepository.getExtRepositoryParentFolder(extRepositoryFileEntry);
    extRepositoryFileEntry=_extRepository.moveExtRepositoryObject(ExtRepositoryObjectType.FILE,extRepositoryFileEntryKey,folder.getExtRepositoryModelKey(),title);
    ExtRepositoryAdapterCache extRepositoryAdapterCache=ExtRepositoryAdapterCache.getInstance();
    extRepositoryAdapterCache.remove(extRepositoryFileEntryKey);
  }
  if (needsCheckIn) {
    _extRepository.checkInExtRepositoryFileEntry(extRepositoryFileEntryKey,majorVersion,changeLog);
  }
  return _toExtRepositoryObjectAdapter(ExtRepositoryObjectAdapterType.FILE,extRepositoryFileEntry);
}
