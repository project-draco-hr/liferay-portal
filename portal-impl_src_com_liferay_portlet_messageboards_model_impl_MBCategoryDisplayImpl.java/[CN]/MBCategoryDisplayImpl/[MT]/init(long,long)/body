{
  long[] categoryIds=MBCategoryServiceUtil.getCategoryIds(scopeGroupId,categoryId);
  _allCategories=MBCategoryServiceUtil.getCategories(scopeGroupId,categoryIds,WorkflowConstants.STATUS_APPROVED,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  _rootCategory=new MBCategoryImpl();
  _rootCategory.setCategoryId(categoryId);
  _categoryTree=new ListTree<MBCategory>(_rootCategory);
  _categoryNodesMap=new HashMap<Long,TreeNode<MBCategory>>();
  Map<Long,List<MBCategory>> categoriesMap=new HashMap<Long,List<MBCategory>>();
  for (  MBCategory category : _allCategories) {
    Long parentCategoryId=category.getParentCategoryId();
    List<MBCategory> curCategories=categoriesMap.get(parentCategoryId);
    if (curCategories == null) {
      curCategories=new ArrayList<MBCategory>();
      categoriesMap.put(parentCategoryId,curCategories);
    }
    curCategories.add(category);
  }
  populateCategoryNodesMap(_categoryTree.getRootNode(),categoriesMap);
}
