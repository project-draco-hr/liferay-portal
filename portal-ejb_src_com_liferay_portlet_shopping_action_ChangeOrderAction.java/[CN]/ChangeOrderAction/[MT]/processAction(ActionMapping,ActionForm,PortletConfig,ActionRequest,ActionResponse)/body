{
  try {
    PortletPreferences prefs=req.getPreferences();
    String orderByCol=req.getParameter("order_by_col");
    if (Validator.isNotNull(orderByCol)) {
      String oldOrderByCol=prefs.getValue("order-by-col",StringPool.BLANK);
      if (oldOrderByCol.equals(orderByCol)) {
        String orderByType=prefs.getValue("order-by-type",StringPool.BLANK);
        String newOrderByType="asc";
        if (orderByType.equals("asc")) {
          newOrderByType="desc";
        }
        prefs.setValue("order-by-type",newOrderByType);
      }
      prefs.setValue("order-by-col",orderByCol);
    }
    prefs.store();
    SessionMessages.add(req,ChangeOrderAction.class.getName());
    res.sendRedirect(ParamUtil.getString(req,"redirect"));
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    setForward(req,Constants.COMMON_ERROR);
  }
}
