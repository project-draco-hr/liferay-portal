{
  Filter filter=(Filter)InstanceFactory.newInstance(portletClassLoader,filterClassName);
  FilterConfig filterConfig=new InvokerFilterConfig(servletContext,filterName,initParams);
  filter.init(filterConfig);
  Filter filterProxy=null;
  if (filter instanceof LiferayFilter) {
    filterProxy=(Filter)Proxy.newProxyInstance(portletClassLoader,new Class[]{LiferayFilter.class},new ClassLoaderBeanHandler(filter,portletClassLoader));
  }
 else {
    filterProxy=(Filter)Proxy.newProxyInstance(portletClassLoader,new Class[]{Filter.class},new ClassLoaderBeanHandler(filter,portletClassLoader));
  }
  servletFiltersContainer.registerFilter(filterName,filter,filterConfig);
}
