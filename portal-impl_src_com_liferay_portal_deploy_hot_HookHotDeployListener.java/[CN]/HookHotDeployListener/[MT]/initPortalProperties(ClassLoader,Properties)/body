{
  PropsUtil.addProperties(portalProperties);
  if (_log.isDebugEnabled() && portalProperties.containsKey(LOCALES)) {
    _log.debug("Portlet locales " + portalProperties.getProperty(LOCALES));
    _log.debug("Merged locales " + PropsUtil.get(LOCALES));
    _log.debug("Merged locales array length " + PropsUtil.getArray(LOCALES).length);
  }
  resetPortalProperties(portalProperties);
  if (portalProperties.contains(PropsKeys.LDAP_ATTRS_TRANSFORMER_IMPL)) {
    String attributesTransformerClassName=portalProperties.getProperty(PropsKeys.LDAP_ATTRS_TRANSFORMER_IMPL);
    AttributesTransformer attributesTransformer=(AttributesTransformer)portletClassLoader.loadClass(attributesTransformerClassName).newInstance();
    attributesTransformer=(AttributesTransformer)Proxy.newProxyInstance(portletClassLoader,new Class[]{AttributesTransformer.class},new ContextClassLoaderBeanHandler(attributesTransformer,portletClassLoader));
    AttributesTransformerFactory.setInstance(attributesTransformer);
  }
  if (portalProperties.contains(PropsKeys.USERS_SCREEN_NAME_GENERATOR)) {
    String screenNameGeneratorClassName=portalProperties.getProperty(PropsKeys.USERS_SCREEN_NAME_GENERATOR);
    ScreenNameGenerator screenNameGenerator=(ScreenNameGenerator)portletClassLoader.loadClass(screenNameGeneratorClassName).newInstance();
    screenNameGenerator=(ScreenNameGenerator)Proxy.newProxyInstance(portletClassLoader,new Class[]{ScreenNameGenerator.class},new ContextClassLoaderBeanHandler(screenNameGenerator,portletClassLoader));
    ScreenNameGeneratorFactory.setInstance(screenNameGenerator);
  }
  if (portalProperties.contains(PropsKeys.USERS_SCREEN_NAME_VALIDATOR)) {
    String screenNameValidatorClassName=portalProperties.getProperty(PropsKeys.USERS_SCREEN_NAME_VALIDATOR);
    ScreenNameValidator screenNameValidator=(ScreenNameValidator)portletClassLoader.loadClass(screenNameValidatorClassName).newInstance();
    screenNameValidator=(ScreenNameValidator)Proxy.newProxyInstance(portletClassLoader,new Class[]{ScreenNameValidator.class},new ContextClassLoaderBeanHandler(screenNameValidator,portletClassLoader));
    ScreenNameValidatorFactory.setInstance(screenNameValidator);
  }
}
