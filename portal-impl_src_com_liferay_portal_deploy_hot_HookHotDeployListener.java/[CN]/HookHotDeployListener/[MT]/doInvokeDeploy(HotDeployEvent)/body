{
  ServletContext ctx=event.getServletContext();
  String servletContextName=ctx.getServletContextName();
  if (_log.isDebugEnabled()) {
    _log.debug("Invoking deploy for " + servletContextName);
  }
  String xml=HttpUtil.URLtoString(ctx.getResource("/WEB-INF/liferay-hook.xml"));
  if (xml == null) {
    return;
  }
  if (_log.isInfoEnabled()) {
    _log.info("Registering hook for " + servletContextName);
  }
  ClassLoader portletClassLoader=event.getContextClassLoader();
  Document doc=DocumentUtil.readDocumentFromXML(xml,true);
  Element root=doc.getRootElement();
  List<Element> eventEls=root.elements("event");
  for (  Element eventEl : eventEls) {
    String eventClass=eventEl.elementText("event-class");
    String eventType=eventEl.elementText("event-type");
    Object obj=initEvent(eventClass,eventType,portletClassLoader);
    if (obj != null) {
      List<Object> events=_eventsMap.get(eventType);
      if (events == null) {
        events=new ArrayList<Object>();
        _eventsMap.put(eventType,events);
      }
      events.add(obj);
    }
  }
  List<Element> modelListenerEls=root.elements("model-listener");
  for (  Element modelListenerEl : modelListenerEls) {
    String modelListenerClass=modelListenerEl.elementText("model-listener-class");
    String modelName=modelListenerEl.elementText("model-name");
    ModelListener modelListener=initModelListener(modelListenerClass,modelName,portletClassLoader);
    if (modelListener != null) {
      List<ModelListener> modelListeners=_modelListenersMap.get(modelName);
      if (modelListeners == null) {
        modelListeners=new ArrayList<ModelListener>();
        _modelListenersMap.put(modelName,modelListeners);
      }
      modelListeners.add(modelListener);
    }
  }
  String portalPropertiesLocation=root.elementText("portal-properties");
  if (Validator.isNotNull(portalPropertiesLocation)) {
    Configuration portalPropertiesConfiguration=null;
    try {
      String name=portalPropertiesLocation;
      int pos=name.lastIndexOf(".properties");
      if (pos != -1) {
        name=name.substring(0,pos);
      }
      portalPropertiesConfiguration=ConfigurationFactoryUtil.getConfiguration(portletClassLoader,name);
    }
 catch (    Exception e) {
      _log.error("Unable to read " + portalPropertiesLocation,e);
    }
    if (portalPropertiesConfiguration != null) {
      _portalPropertiesConfigurationMap.put(servletContextName,portalPropertiesConfiguration);
      initPortalPropertiesConfiguration(portalPropertiesConfiguration);
    }
  }
  if (_log.isInfoEnabled()) {
    _log.info("Hook for " + servletContextName + " registered successfully");
  }
}
