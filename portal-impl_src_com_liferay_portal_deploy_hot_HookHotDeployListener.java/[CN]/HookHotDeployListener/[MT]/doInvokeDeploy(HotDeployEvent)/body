{
  ServletContext servletContext=event.getServletContext();
  String servletContextName=servletContext.getServletContextName();
  if (_log.isDebugEnabled()) {
    _log.debug("Invoking deploy for " + servletContextName);
  }
  String xml=HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-hook.xml"));
  if (xml == null) {
    return;
  }
  if (_log.isInfoEnabled()) {
    _log.info("Registering hook for " + servletContextName);
  }
  _servletContextNames.add(servletContextName);
  ClassLoader portletClassLoader=event.getContextClassLoader();
  Document doc=SAXReaderUtil.read(xml,true);
  Element root=doc.getRootElement();
  String portalPropertiesLocation=root.elementText("portal-properties");
  if (Validator.isNotNull(portalPropertiesLocation)) {
    Configuration portalPropertiesConfiguration=null;
    try {
      String name=portalPropertiesLocation;
      int pos=name.lastIndexOf(".properties");
      if (pos != -1) {
        name=name.substring(0,pos);
      }
      portalPropertiesConfiguration=ConfigurationFactoryUtil.getConfiguration(portletClassLoader,name);
    }
 catch (    Exception e) {
      _log.error("Unable to read " + portalPropertiesLocation,e);
    }
    if (portalPropertiesConfiguration != null) {
      Properties portalProperties=portalPropertiesConfiguration.getProperties();
      if (portalProperties.size() > 0) {
        _portalPropertiesMap.put(servletContextName,portalProperties);
        initPortalProperties(portalProperties);
        initAutoLogins(servletContextName,portletClassLoader,portalProperties);
        initModelListeners(servletContextName,portletClassLoader,portalProperties);
        initEvents(servletContextName,portletClassLoader,portalProperties);
      }
    }
  }
  LanguagesContainer languagesContainer=new LanguagesContainer();
  _languagesContainerMap.put(servletContextName,languagesContainer);
  List<Element> languagePropertiesEls=root.elements("language-properties");
  for (  Element languagePropertiesEl : languagePropertiesEls) {
    String languagePropertiesLocation=languagePropertiesEl.getText();
    try {
      URL url=portletClassLoader.getResource(languagePropertiesLocation);
      if (url == null) {
        continue;
      }
      InputStream is=url.openStream();
      Properties properties=new Properties();
      properties.load(is);
      is.close();
      String localeKey=getLocaleKey(languagePropertiesLocation);
      if (localeKey != null) {
        languagesContainer.addLanguage(localeKey,properties);
      }
    }
 catch (    Exception e) {
      _log.error("Unable to read " + languagePropertiesLocation,e);
    }
  }
  String customJspDir=root.elementText("custom-jsp-dir");
  if (Validator.isNotNull(customJspDir)) {
    if (_log.isDebugEnabled()) {
      _log.debug("Custom JSP directory: " + customJspDir);
    }
    List<String> customJsps=new ArrayList<String>();
    String webDir=servletContext.getRealPath(StringPool.SLASH);
    getCustomJsps(servletContext,webDir,customJspDir,customJsps);
    if (customJsps.size() > 0) {
      CustomJspBag customJspBag=new CustomJspBag(customJspDir,customJsps);
      if (_log.isDebugEnabled()) {
        StringBuilder sb=new StringBuilder();
        sb.append("Custom JSP files:\n");
        Iterator<String> itr=customJsps.iterator();
        while (itr.hasNext()) {
          String customJsp=itr.next();
          sb.append(customJsp);
          if (itr.hasNext()) {
            sb.append(StringPool.NEW_LINE);
          }
        }
        _log.debug(sb.toString());
      }
      _customJspBagsMap.put(servletContextName,customJspBag);
      initCustomJspBag(customJspBag);
    }
  }
  ModelListenersContainer modelListenersContainer=_modelListenersContainerMap.get(servletContextName);
  if (modelListenersContainer == null) {
    modelListenersContainer=new ModelListenersContainer();
    _modelListenersContainerMap.put(servletContextName,modelListenersContainer);
  }
  List<Element> modelListenerEls=root.elements("model-listener");
  for (  Element modelListenerEl : modelListenerEls) {
    String modelName=modelListenerEl.elementText("model-name");
    String modelListenerClass=modelListenerEl.elementText("model-listener-class");
    ModelListener<BaseModel<?>> modelListener=initModelListener(modelName,modelListenerClass,portletClassLoader);
    if (modelListener != null) {
      modelListenersContainer.registerModelListener(modelName,modelListener);
    }
  }
  EventsContainer eventsContainer=_eventsContainerMap.get(servletContextName);
  if (eventsContainer == null) {
    eventsContainer=new EventsContainer();
    _eventsContainerMap.put(servletContextName,eventsContainer);
  }
  List<Element> eventEls=root.elements("event");
  for (  Element eventEl : eventEls) {
    String eventName=eventEl.elementText("event-type");
    String eventClass=eventEl.elementText("event-class");
    Object obj=initEvent(eventName,eventClass,portletClassLoader);
    if (obj != null) {
      eventsContainer.registerEvent(eventName,obj);
    }
  }
  registerClpMessageListeners(servletContext,portletClassLoader);
  if (_log.isInfoEnabled()) {
    _log.info("Hook for " + servletContextName + " is available for use");
  }
}
