{
  String customJspDir=rootElement.elementText("custom-jsp-dir");
  if (Validator.isNull(customJspDir)) {
    return;
  }
  if (!checkPermission(PACLConstants.PORTAL_HOOK_PERMISSION_CUSTOM_JSP_DIR,portletClassLoader,null,"Rejecting custom JSP directory")) {
    return;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Custom JSP directory: " + customJspDir);
  }
  boolean customJspGlobal=GetterUtil.getBoolean(rootElement.elementText("custom-jsp-global"),true);
  List<String> customJsps=new ArrayList<>();
  String webDir=servletContext.getRealPath(StringPool.SLASH);
  getCustomJsps(servletContext,webDir,customJspDir,customJsps);
  if (customJsps.isEmpty()) {
    return;
  }
  CustomJspBag customJspBag=new CustomJspBag(customJspDir,customJspGlobal,customJsps);
  if (_log.isDebugEnabled()) {
    StringBundler sb=new StringBundler(customJsps.size() * 2);
    sb.append("Custom JSP files:\n");
    int i=0;
    for (    String customJsp : customJsps) {
      sb.append(customJsp);
      if ((i + 1) < customJsps.size()) {
        sb.append(StringPool.NEW_LINE);
      }
      i++;
    }
    Log log=SanitizerLogWrapper.allowCRLF(_log);
    log.debug(sb.toString());
  }
  if (customJspGlobal && !_customJspBagsMap.isEmpty() && !_customJspBagsMap.containsKey(servletContextName)) {
    verifyCustomJsps(servletContextName,customJspBag);
  }
  _customJspBagsMap.put(servletContextName,customJspBag);
  initCustomJspBag(servletContextName,pluginPackage.getName(),customJspBag);
}
