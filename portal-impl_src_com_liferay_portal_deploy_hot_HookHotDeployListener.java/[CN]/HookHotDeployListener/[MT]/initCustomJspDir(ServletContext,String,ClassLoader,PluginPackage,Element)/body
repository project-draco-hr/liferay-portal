{
  SecurityManager securityManager=System.getSecurityManager();
  if (securityManager != null) {
    Permission permission=new PortalHookPermission(PACLConstants.PORTAL_HOOK_PERMISSION_CUSTOM_JSP_DIR,portletClassLoader,null);
    try {
      securityManager.checkPermission(permission);
    }
 catch (    SecurityException se) {
      if (_log.isInfoEnabled()) {
        _log.info("Rejecting custom JSP directory");
      }
      return;
    }
  }
  String customJspDir=rootElement.elementText("custom-jsp-dir");
  if (Validator.isNull(customJspDir)) {
    return;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Custom JSP directory: " + customJspDir);
  }
  boolean customJspGlobal=GetterUtil.getBoolean(rootElement.elementText("custom-jsp-global"),true);
  List<String> customJsps=new ArrayList<String>();
  String webDir=servletContext.getRealPath(StringPool.SLASH);
  getCustomJsps(servletContext,webDir,customJspDir,customJsps);
  if (customJsps.isEmpty()) {
    return;
  }
  CustomJspBag customJspBag=new CustomJspBag(customJspDir,customJspGlobal,customJsps);
  if (_log.isDebugEnabled()) {
    StringBundler sb=new StringBundler(customJsps.size() * 2 + 1);
    sb.append("Custom JSP files:\n");
    for (    String customJsp : customJsps) {
      sb.append(customJsp);
      sb.append(StringPool.NEW_LINE);
    }
    sb.setIndex(sb.index() - 1);
    _log.debug(sb.toString());
  }
  _customJspBagsMap.put(servletContextName,customJspBag);
  initCustomJspBag(servletContextName,pluginPackage.getName(),customJspBag);
}
