{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  boolean userPrivatePages=layout.getGroup().isUser() && layout.isPrivateLayout();
  String roleName=PropsValues.IFRAME_PASSWORD_PASSWORD_TOKEN_ROLE;
  boolean passwordTokenEnabled=true;
  if (!userPrivatePages && Validator.isNotNull(roleName)) {
    try {
      Role role=RoleLocalServiceUtil.getRole(themeDisplay.getCompanyId(),roleName);
      if (!UserLocalServiceUtil.hasRoleUser(role.getRoleId(),themeDisplay.getUserId())) {
        passwordTokenEnabled=false;
      }
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Error checking role " + roleName + ". The password "+ "token will be disabled");
      }
      passwordTokenEnabled=false;
    }
  }
  return passwordTokenEnabled;
}
