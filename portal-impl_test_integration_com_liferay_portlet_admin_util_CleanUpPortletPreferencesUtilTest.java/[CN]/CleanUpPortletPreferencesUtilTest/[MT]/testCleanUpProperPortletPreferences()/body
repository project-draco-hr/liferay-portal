{
  LayoutRevision layoutRevision=getLayoutRevision();
  String portletId=PortletConstants.assemblePortletId(com.liferay.portlet.util.test.PortletKeys.TEST,PortletConstants.generateInstanceId());
  UnicodeProperties typeSettingProperties=layoutRevision.getTypeSettingsProperties();
  typeSettingProperties.setProperty("column-1",portletId);
  layoutRevision=LayoutRevisionLocalServiceUtil.updateLayoutRevision(layoutRevision);
  PortletPreferences portletPreferences=PortletPreferencesLocalServiceUtil.addPortletPreferences(TestPropsValues.getCompanyId(),TestPropsValues.getUserId(),0,layoutRevision.getLayoutRevisionId(),portletId,null,StringPool.BLANK);
  Assert.assertNotNull(portletPreferences);
  Layout layout=LayoutLocalServiceUtil.getLayout(layoutRevision.getPlid());
  LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
  Assert.assertTrue(layoutTypePortlet.getPortletIds().isEmpty());
  CleanUpPortletPreferencesUtil.cleanUpLayoutRevisionPortletPreferences();
  portletPreferences=PortletPreferencesLocalServiceUtil.fetchPortletPreferences(portletPreferences.getPortletPreferencesId());
  Assert.assertNotNull(portletPreferences);
}
