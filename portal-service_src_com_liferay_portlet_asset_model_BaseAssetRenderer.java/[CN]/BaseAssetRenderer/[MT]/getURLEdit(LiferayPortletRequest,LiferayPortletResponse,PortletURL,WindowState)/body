{
  LiferayPortletURL editPortletURL=(LiferayPortletURL)getURLEdit(liferayPortletRequest,liferayPortletResponse);
  if (editPortletURL == null) {
    return null;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)liferayPortletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Group stageableGroup=themeDisplay.getScopeGroup();
  if (stageableGroup.isLayout()) {
    Layout layout=themeDisplay.getLayout();
    stageableGroup=layout.getGroup();
  }
  if (stageableGroup.hasStagingGroup()) {
    return null;
  }
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  String portletResource=ParamUtil.getString(liferayPortletRequest,"portletResource",portletDisplay.getId());
  if (Validator.isNotNull(portletResource)) {
    editPortletURL.setParameter("referringPortletResource",portletResource);
  }
 else {
    editPortletURL.setParameter("referringPortletResource",portletDisplay.getId());
  }
  editPortletURL.setParameter("redirect",redirectURL.toString());
  editPortletURL.setParameter("originalRedirect",redirectURL.toString());
  editPortletURL.setWindowState(windowState);
  editPortletURL.setPortletMode(PortletMode.VIEW);
  editPortletURL.setDoAsGroupId(getGroupId());
  editPortletURL.setRefererPlid(themeDisplay.getPlid());
  return editPortletURL;
}
