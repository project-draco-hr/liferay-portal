{
  FileEntry fileEntry=dlAppLocalService.getFileEntry(fileEntryId);
  InputStream originalInputStream=null;
  File patchedFile=null;
  InputStream patchedInputStream=null;
  try {
    originalInputStream=fileEntry.getContentStream();
    patchedFile=FileUtil.createTempFile();
    patchFile(originalInputStream,deltaInputStream,patchedFile);
    patchedInputStream=new FileInputStream(patchedFile);
    return dlAppService.updateFileEntry(fileEntryId,sourceFileName,mimeType,title,description,changeLog,majorVersion,patchedInputStream,size,serviceContext);
  }
 catch (  Exception e) {
    throw new PortalException(e);
  }
 finally {
    StreamUtil.cleanUp(originalInputStream);
    StreamUtil.cleanUp(patchedInputStream);
    FileUtil.delete(patchedFile);
  }
}
