{
  FileEntry fileEntry=dlAppLocalService.getFileEntry(fileEntryId);
  InputStream patchedInputStream=null;
  File patchedFile=null;
  try {
    InputStream originalInputStream=fileEntry.getContentStream();
    patchedFile=FileUtil.createTempFile();
    patchFile(originalInputStream,deltaInputStream,patchedFile);
    patchedInputStream=new FileInputStream(patchedFile);
    return dlAppLocalService.updateFileEntry(userId,fileEntryId,sourceFileName,mimeType,title,description,changeLog,majorVersion,patchedInputStream,size,serviceContext);
  }
 catch (  Exception e) {
    throw new PortalException(e);
  }
 finally {
    FileUtil.delete(patchedFile);
  }
}
