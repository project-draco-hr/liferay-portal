{
  BundlePortletApp bundlePortletApp=serviceRegistrations.getBundlePortletApp();
  if (bundlePortletApp != null) {
    return bundlePortletApp;
  }
  com.liferay.portal.kernel.model.Portlet portalPortletModel=_portletLocalService.getPortletById(CompanyConstants.SYSTEM,PortletKeys.PORTAL);
  ServletContextHelperRegistration servletContextHelperRegistration=getServletContextHelperRegistration(bundle,serviceRegistrations);
  ServiceReference<ServletContextHelper> serviceReference=servletContextHelperRegistration.getServiceReference();
  String servletContextName=GetterUtil.getString(serviceReference.getProperty(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_NAME));
  String contextPath=GetterUtil.getString(serviceReference.getProperty(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_PATH));
  bundlePortletApp=new BundlePortletApp(bundle,portalPortletModel,servletContextName,_httpServiceEndpoint + contextPath);
  bundlePortletApp.setServletContext(servletContextHelperRegistration.getServletContext());
  serviceRegistrations.setBundlePortletApp(bundlePortletApp);
  serviceRegistrations.doConfiguration(classLoader);
  return bundlePortletApp;
}
