{
  long companyId=PortalUtil.getCompanyId(request);
  long userId=PortalUtil.getUserId(request);
  if (userId == 0) {
    return StringPool.BLANK;
  }
  String pollerRequestString=ParamUtil.getString(request,"pollerRequest");
  PollerHeader pollerHeader=PollerRequestHandlerUtil.getPollerHeader(pollerRequestString);
  if (pollerHeader == null) {
    return StringPool.BLANK;
  }
  if (userId != pollerHeader.getUserId()) {
    return StringPool.BLANK;
  }
  SynchronousPollerChannelListener synchronousPollerChannelListener=new SynchronousPollerChannelListener();
  ChannelHubManagerUtil.getChannel(companyId,userId,true);
  ChannelHubManagerUtil.registerChannelListener(companyId,userId,synchronousPollerChannelListener);
  try {
    JSONObject pollerResponseHeaderJSONObject=PollerRequestHandlerUtil.processRequest(request,pollerRequestString);
    if (pollerResponseHeaderJSONObject == null) {
      return StringPool.BLANK;
    }
    return synchronousPollerChannelListener.getNotificationEvents(companyId,userId,pollerResponseHeaderJSONObject,PropsValues.POLLER_REQUEST_TIMEOUT);
  }
  finally {
    ChannelHubManagerUtil.unregisterChannelListener(companyId,userId,synchronousPollerChannelListener);
  }
}
