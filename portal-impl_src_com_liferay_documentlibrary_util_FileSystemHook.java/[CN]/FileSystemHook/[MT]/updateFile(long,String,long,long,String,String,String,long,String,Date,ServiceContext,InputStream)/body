{
  try {
    File fileNameVersionFile=getFileNameVersionFile(companyId,repositoryId,fileName,versionNumber);
    if (fileNameVersionFile.exists()) {
      String extension=StringPool.PERIOD + System.currentTimeMillis() + _ORPHAN;
      _log.warn("An orphaned version " + fileNameVersionFile.getPath() + " was found. It will be saved to "+ fileNameVersionFile.getPath()+ extension);
      fileNameVersionFile.renameTo(new File(fileNameVersionFile.getPath() + extension));
    }
    FileUtil.write(fileNameVersionFile,is);
    Indexer indexer=IndexerRegistryUtil.getIndexer(FileModel.class);
    FileModel fileModel=new FileModel();
    fileModel.setAssetCategoryIds(serviceContext.getAssetCategoryIds());
    fileModel.setAssetTagNames(serviceContext.getAssetTagNames());
    fileModel.setCompanyId(companyId);
    fileModel.setFileEntryId(fileEntryId);
    fileModel.setFileName(fileName);
    fileModel.setGroupId(groupId);
    fileModel.setModifiedDate(modifiedDate);
    fileModel.setPortletId(portletId);
    fileModel.setProperties(properties);
    fileModel.setRepositoryId(repositoryId);
    indexer.reindex(fileModel);
  }
 catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
