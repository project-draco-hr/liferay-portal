{
  String userAgent=getUserAgent(request);
  String version=StringPool.BLANK;
  Pattern pattern=Pattern.compile("(?:version)[\\/]([\\d.]+)");
  Matcher matcher=pattern.matcher(userAgent);
  if (matcher.find()) {
    version=matcher.group(1);
  }
 else   if (isFirefox(request)) {
    Pattern firefoxPattern=Pattern.compile("(?:firefox|minefield)[\\/]([\\d.]+)");
    Matcher firefoxMatcher=firefoxPattern.matcher(userAgent);
    if (firefoxMatcher.find()) {
      version=firefoxMatcher.group(1);
    }
  }
 else   if (isChrome(request)) {
    Pattern chromePattern=Pattern.compile("(?:chrome)[\\/]([\\d.]+)");
    Matcher chromeMatcher=chromePattern.matcher(userAgent);
    if (chromeMatcher.find()) {
      version=chromeMatcher.group(1);
    }
  }
 else {
    version=getRevision(request);
  }
  return version;
}
