{
  String userAgent=StringPool.BLANK;
  if (request != null) {
    Object userAgentAttribute=request.getAttribute(HttpHeaders.USER_AGENT);
    if ((userAgentAttribute == null) || !(userAgentAttribute instanceof String)) {
      String userAgentHeader=request.getHeader(HttpHeaders.USER_AGENT);
      if (userAgentHeader != null) {
        userAgent=userAgentHeader.toLowerCase();
      }
 else {
        userAgent=StringPool.BLANK;
      }
      request.setAttribute(HttpHeaders.USER_AGENT,userAgent);
    }
  }
  return userAgent;
}
