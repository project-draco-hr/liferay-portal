{
  String userAgent=StringPool.BLANK;
  if (request == null) {
    return userAgent;
  }
  Object userAgentAttribute=request.getAttribute(HttpHeaders.USER_AGENT);
  if (userAgentAttribute instanceof String) {
    userAgent=(String)userAgentAttribute;
  }
  if (Validator.isNotNull(userAgent)) {
    return userAgent;
  }
  String userAgentHeader=request.getHeader(HttpHeaders.USER_AGENT);
  if (userAgentHeader != null) {
    userAgent=userAgentHeader.toLowerCase();
  }
 else {
    userAgent=StringPool.BLANK;
  }
  request.setAttribute(HttpHeaders.USER_AGENT,userAgent);
  return userAgent;
}
