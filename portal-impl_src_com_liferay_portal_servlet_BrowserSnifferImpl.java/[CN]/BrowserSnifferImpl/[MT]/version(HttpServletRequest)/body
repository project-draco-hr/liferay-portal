{
  String agent=_getUserAgent(request);
  String _version=StringPool.BLANK;
  Pattern versionPattern=Pattern.compile("(?:version)[\\/]([\\d.]+)");
  Matcher varsionMatcher=versionPattern.matcher(agent);
  if (varsionMatcher.find()) {
    _version=varsionMatcher.group(1);
  }
 else   if (isFirefox(request)) {
    Pattern pattern=Pattern.compile("(?:firefox|minefield)[\\/]([\\d.]+)");
    Matcher matcher=pattern.matcher(agent);
    if (matcher.find()) {
      _version=matcher.group(1);
    }
  }
 else   if (isChrome(request)) {
    Pattern pattern=Pattern.compile("(?:chrome)[\\/]([\\d.]+)");
    Matcher matcher=pattern.matcher(agent);
    if (matcher.find()) {
      _version=matcher.group(1);
    }
  }
 else {
    _version=revision(request);
  }
  return _version;
}
