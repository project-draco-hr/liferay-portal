{
  Set<Element> commandElementsSet=new HashSet<Element>();
  Element macroRootElement=getMacroRootElement(macroName);
  List<Element> macroCommandElements=macroRootElement.elements("command");
  String extendsName=macroRootElement.attributeValue("extends");
  if (extendsName != null) {
    Element extendsRootElement=getMacroRootElement(extendsName);
    List<Element> extendsCommandElements=extendsRootElement.elements("command");
    Set<String> commandNames=getMacroCommandNames(macroName);
    for (    String commandName : commandNames) {
      boolean macroElementFound=false;
      for (      Element macroCommandElement : macroCommandElements) {
        String macroCommandName=macroCommandElement.attributeValue("name");
        if (commandName.equals(macroCommandName)) {
          commandElementsSet.add(macroCommandElement);
          macroElementFound=true;
          break;
        }
      }
      if (macroElementFound) {
        continue;
      }
      for (      Element extendsCommandElement : extendsCommandElements) {
        String extendsCommandName=extendsCommandElement.attributeValue("name");
        if (commandName.equals(extendsCommandName)) {
          commandElementsSet.add(extendsCommandElement);
          break;
        }
      }
    }
  }
 else {
    commandElementsSet.addAll(macroCommandElements);
  }
  return commandElementsSet;
}
