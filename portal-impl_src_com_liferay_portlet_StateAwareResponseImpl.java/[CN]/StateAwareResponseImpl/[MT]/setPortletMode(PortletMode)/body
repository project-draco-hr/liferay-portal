{
  if (_redirectLocation != null) {
    throw new IllegalStateException();
  }
  if (!_req.isPortletModeAllowed(portletMode)) {
    throw new PortletModeException(portletMode.toString(),portletMode);
  }
  try {
    _portletMode=PortalUtil.updatePortletMode(_portletName,_user,_layout,portletMode,_req.getHttpServletRequest());
    _req.setPortletMode(_portletMode);
  }
 catch (  Exception e) {
    throw new PortletModeException(e,portletMode);
  }
  _calledSetRenderParameter=true;
}
