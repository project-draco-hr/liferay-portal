{
  int importedKBArticlesCount=0;
  PrioritizationStrategy prioritizationStrategy=PrioritizationStrategy.create(groupId,parentKBFolderId,prioritizeByNumericalPrefix);
  KBArchive kbArchive=_kbArchiveFactory.createKBArchive(groupId,zipReader);
  Map<KBArchive.File,KBArticle> introFileNameKBArticleMap=new HashMap<>();
  for (  KBArchive.Folder folder : kbArchive.getFolders()) {
    KBArchive.File introFile=folder.getIntroFile();
    KBArticle introKBArticle=introFileNameKBArticleMap.get(introFile);
    if ((introFile != null) && (introKBArticle == null)) {
      long sectionResourceClassNameId=PortalUtil.getClassNameId(KBFolderConstants.getClassName());
      long sectionResourcePrimaryKey=parentKBFolderId;
      KBArticle parentIntroKBArticle=introFileNameKBArticleMap.get(folder.getParentFolderIntroFile());
      if (parentIntroKBArticle != null) {
        sectionResourceClassNameId=PortalUtil.getClassNameId(KBArticleConstants.getClassName());
        sectionResourcePrimaryKey=parentIntroKBArticle.getResourcePrimKey();
      }
      introKBArticle=addKBArticleMarkdown(userId,groupId,parentKBFolderId,sectionResourceClassNameId,sectionResourcePrimaryKey,introFile.getContent(),introFile.getName(),zipReader,metadata,prioritizationStrategy,serviceContext);
      importedKBArticlesCount++;
      introFileNameKBArticleMap.put(introFile,introKBArticle);
    }
    long sectionResourceClassNameId=PortalUtil.getClassNameId(KBFolderConstants.getClassName());
    long sectionResourcePrimaryKey=parentKBFolderId;
    if (introKBArticle != null) {
      sectionResourceClassNameId=PortalUtil.getClassNameId(KBArticleConstants.getClassName());
      sectionResourcePrimaryKey=introKBArticle.getResourcePrimKey();
    }
    for (    KBArchive.File file : folder.getFiles()) {
      String markdown=file.getContent();
      if (Validator.isNull(markdown)) {
        if (_log.isWarnEnabled()) {
          _log.warn("Missing Markdown in file entry " + file.getName());
        }
      }
      addKBArticleMarkdown(userId,groupId,parentKBFolderId,sectionResourceClassNameId,sectionResourcePrimaryKey,markdown,file.getName(),zipReader,metadata,prioritizationStrategy,serviceContext);
      importedKBArticlesCount++;
    }
  }
  prioritizationStrategy.prioritizeKBArticles();
  return importedKBArticlesCount;
}
