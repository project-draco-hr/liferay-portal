{
  if (!hasGuestViewPermission) {
    Role role=RoleLocalServiceUtil.getRole(_group.getCompanyId(),RoleConstants.GUEST);
    ResourcePermissionLocalServiceUtil.removeResourcePermissions(_group.getCompanyId(),Layout.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,role.getRoleId(),ActionKeys.VIEW);
  }
  if (signedIn) {
    _user=UserTestUtil.addUser();
  }
 else {
    _user=PortalUtil.initUser(_request);
  }
  _request.setAttribute(WebKeys.USER,_user);
  ThemeDisplay themeDisplay=TestServicePreAction.INSTANCE.initThemeDisplay(_request,_response);
  return themeDisplay.getPlid();
}
