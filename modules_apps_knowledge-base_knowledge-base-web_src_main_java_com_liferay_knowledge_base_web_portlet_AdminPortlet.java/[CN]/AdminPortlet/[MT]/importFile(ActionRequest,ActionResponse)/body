{
  InputStream inputStream=null;
  try {
    ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
    UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
    checkExceededSizeLimit(actionRequest);
    long parentKBFolderId=ParamUtil.getLong(uploadPortletRequest,"parentKBFolderId",KBFolderConstants.DEFAULT_PARENT_FOLDER_ID);
    String fileName=uploadPortletRequest.getFileName("file");
    if (Validator.isNull(fileName)) {
      throw new KBArticleImportException("File name is null");
    }
    boolean prioritizeByNumericalPrefix=ParamUtil.getBoolean(uploadPortletRequest,"prioritizeByNumericalPrefix");
    inputStream=uploadPortletRequest.getFileAsStream("file");
    ServiceContext serviceContext=ServiceContextFactory.getInstance(AdminPortlet.class.getName(),actionRequest);
    serviceContext.setGuestPermissions(new String[]{ActionKeys.VIEW});
    int importedKBArticlesCount=KBArticleServiceUtil.addKBArticlesMarkdown(themeDisplay.getScopeGroupId(),parentKBFolderId,fileName,prioritizeByNumericalPrefix,inputStream,serviceContext);
    SessionMessages.add(actionRequest,"importedKBArticlesCount",importedKBArticlesCount);
  }
 catch (  KBArticleImportException kbaie) {
    SessionErrors.add(actionRequest,kbaie.getClass(),kbaie);
  }
 finally {
    StreamUtil.cleanUp(inputStream);
  }
}
