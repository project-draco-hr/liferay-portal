{
  EntityID entityID=WindowInvokerUtil.getEntityID(portlet);
  ChannelState channelWindowState=new ChannelState(windowState.toString());
  ChannelMode channelPortletMode=new ChannelMode(portletMode.toString());
  PortletWindowContext portletWindowContext=new PortletWindowContextImpl(request,portlet,lifecycle);
  ChannelURLFactory channelURLFactory=null;
  if (!remotePortlet) {
    channelURLFactory=new PortletWindowURLFactory(request,portlet,channelWindowState,channelPortletMode,plid);
  }
 else {
    channelURLFactory=new WSRPWindowChannelURLFactory(request,portlet,channelWindowState,channelPortletMode,plid);
  }
  WindowRequestReader windowRequestReader=null;
  if (lifecycle.equals(PortletRequest.ACTION_PHASE) || lifecycle.equals(PortletRequest.RESOURCE_PHASE)) {
    if (!remotePortlet) {
      windowRequestReader=new PortletWindowRequestReader(facesPortlet);
    }
 else {
      windowRequestReader=new WSRPWindowRequestReader();
    }
    ChannelState newWindowState=windowRequestReader.readNewWindowState(request);
    if (newWindowState != null) {
      channelWindowState=newWindowState;
    }
    ChannelMode newPortletWindowMode=windowRequestReader.readNewPortletWindowMode(request);
    if (newPortletWindowMode != null) {
      channelPortletMode=newPortletWindowMode;
    }
  }
  Container container=null;
  if (remotePortlet) {
    container=WSRPWindowInvoker.getContainer();
  }
 else {
    container=ContainerFactory.getContainer(ContainerType.PORTLET_CONTAINER);
  }
  ContainerRequest containerRequest=null;
  if (lifecycle.equals(PortletRequest.ACTION_PHASE)) {
    containerRequest=container.createExecuteActionRequest(request,entityID,channelWindowState,channelPortletMode,portletWindowContext,channelURLFactory,windowRequestReader);
  }
 else   if (lifecycle.equals(PortletRequest.RENDER_PHASE)) {
    containerRequest=container.createGetMarkUpRequest(request,entityID,channelWindowState,channelPortletMode,portletWindowContext,channelURLFactory);
  }
 else   if (lifecycle.equals(PortletRequest.RESOURCE_PHASE)) {
    containerRequest=container.createGetResourceRequest(request,entityID,channelWindowState,channelPortletMode,portletWindowContext,channelURLFactory,windowRequestReader);
  }
  if (containerRequest != null) {
    String namespace=WindowInvokerUtil.getPortletNamespace(entityID);
    String windowID=WindowInvokerUtil.getPortletWindowID(entityID,plid);
    containerRequest.setAllowableWindowStates(windowStates);
    containerRequest.setAllowableChannelModes(portletModes);
    containerRequest.setNamespace(namespace);
    containerRequest.setPortalInfo(ReleaseInfo.getReleaseInfo());
    containerRequest.setWindowID(windowID);
  }
  return containerRequest;
}
