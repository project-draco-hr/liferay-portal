{
  if (_stub != null) {
    return doGetStub();
  }
synchronized (_registrationReference) {
    if (_stub != null) {
      return doGetStub();
    }
    Future<Boolean> future=IntrabandRPCUtil.execute(_registrationReference,_startupFinishedProcessCallable);
    boolean startupFinished=false;
    try {
      startupFinished=future.get();
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to detect SPI's startup status",e);
      }
    }
    if (!startupFinished) {
      return _originalT;
    }
    try {
      _stub=_stubCreator.createStub(_stubId,_originalT,_registrationReference);
      return _stub;
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to create stub",e);
      }
      return _stubCreator.onCreationFailure(_stubId,_originalT,e);
    }
  }
}
