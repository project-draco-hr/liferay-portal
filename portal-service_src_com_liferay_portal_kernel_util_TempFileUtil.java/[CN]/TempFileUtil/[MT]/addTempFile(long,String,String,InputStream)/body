{
  File uploadedFile=null;
  if (inputStream instanceof ByteArrayFileInputStream) {
    uploadedFile=((ByteArrayFileInputStream)inputStream).getFile();
    DLStoreUtil.validate(fileName,true,uploadedFile);
  }
 else {
    DLStoreUtil.validate(fileName,true,inputStream);
  }
  File tempFile=getTempFile(userId,fileName,tempPathName);
  if (uploadedFile != null) {
    FileUtil.copyFile(uploadedFile,tempFile);
  }
 else {
    FileUtil.write(tempFile,inputStream);
  }
  return fileName;
}
