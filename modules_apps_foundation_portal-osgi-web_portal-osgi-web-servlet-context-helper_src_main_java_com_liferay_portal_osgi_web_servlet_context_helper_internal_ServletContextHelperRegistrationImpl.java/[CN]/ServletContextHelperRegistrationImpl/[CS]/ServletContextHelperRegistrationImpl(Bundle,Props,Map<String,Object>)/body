{
  _props=props;
  _properties=properties;
  String contextPath=getContextPath(bundle);
  String servletContextName=getServletContextName(bundle,contextPath);
  boolean wabShapedBundle=false;
  URL url=bundle.getEntry("WEB-INF/");
  if (url != null) {
    wabShapedBundle=true;
  }
  BundleContext bundleContext=bundle.getBundleContext();
  _customServletContextHelper=new CustomServletContextHelper(bundle,wabShapedBundle);
  _servletContextHelperServiceRegistration=createServletContextHelper(bundleContext,servletContextName,contextPath);
  _servletContextListenerServiceRegistration=createServletContextListener(bundleContext,servletContextName);
  _defaultServletServiceRegistration=createDefaultServlet(bundleContext,servletContextName,wabShapedBundle);
  _jspServletServiceRegistration=createJspServlet(bundleContext,servletContextName);
  _portletServletServiceRegistration=createPortletServlet(bundleContext,servletContextName,wabShapedBundle);
  _portletServletRequestFilterServiceRegistration=createRestrictPortletServletRequestFilter(bundleContext,servletContextName);
}
