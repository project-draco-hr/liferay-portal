{
  _props=props;
  _properties=properties;
  String contextPath=getContextPath(bundle);
  String servletContextName=getServletContextName(bundle,contextPath);
  boolean wabShapedBundle=false;
  URL url=bundle.getEntry("WEB-INF/");
  if (url != null) {
    wabShapedBundle=true;
  }
  BundleContext bundleContext=bundle.getBundleContext();
  _customServletContextHelper=new CustomServletContextHelper(bundle,wabShapedBundle);
  _servletContextHelperRegistration=createServletContextHelper(bundleContext,servletContextName,contextPath);
  _servletContextListenerRegistration=createServletContextListener(bundleContext,servletContextName);
  _defaultServletRegistration=createDefaultServlet(bundleContext,servletContextName,wabShapedBundle);
  _jspServletRegistration=createJspServlet(bundleContext,servletContextName);
  _portletServletRegistration=createPortletServlet(bundleContext,servletContextName,wabShapedBundle);
  _portletServletRequestFilterRegistration=createRestrictPortletServletRequestFilter(bundleContext,servletContextName);
}
