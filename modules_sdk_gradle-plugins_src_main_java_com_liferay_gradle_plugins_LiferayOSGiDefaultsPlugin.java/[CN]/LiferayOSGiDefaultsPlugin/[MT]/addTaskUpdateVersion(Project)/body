{
  final ReplaceRegexTask replaceRegexTask=GradleUtil.addTask(project,LiferayRelengPlugin.UPDATE_VERSION_TASK_NAME,ReplaceRegexTask.class);
  replaceRegexTask.match("Bundle-Version: (.+)(?:\\s|$)","bnd.bnd");
  replaceRegexTask.onlyIf(new Spec<Task>(){
    @Override public boolean isSatisfiedBy(    Task task){
      Project project=task.getProject();
      String version=String.valueOf(project.getVersion());
      if (version.contains("LIFERAY-PATCHED-")) {
        return false;
      }
      return true;
    }
  }
);
  replaceRegexTask.setDescription("Updates the project version in the " + Constants.BUNDLE_VERSION + " header.");
  replaceRegexTask.setReplacement(IncrementVersionClosure.MICRO_INCREMENT);
  project.afterEvaluate(new Action<Project>(){
    @Override public void execute(    Project project){
      File moduleConfigFile=getModuleConfigFile(project);
      if ((moduleConfigFile == null) || !moduleConfigFile.exists()) {
        return;
      }
      replaceRegexTask.match("\\n\\t\"version\": \"(.+)\"",moduleConfigFile);
    }
  }
);
  return replaceRegexTask;
}
