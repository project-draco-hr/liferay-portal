{
  long userId=portletDataContext.getUserId(calendar.getUserUuid());
  Map<Long,Long> calendarResourceIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(CalendarResource.class);
  long calendarResourceId=MapUtil.getLong(calendarResourceIds,calendar.getCalendarResourceId(),calendar.getCalendarResourceId());
  Map<Locale,String> calendarNameMap=getCalendarNameMap(portletDataContext,calendar);
  ServiceContext serviceContext=portletDataContext.createServiceContext(calendar);
  Calendar importedCalendar=null;
  if (portletDataContext.isDataStrategyMirror()) {
    Calendar existingCalendar=fetchStagedModelByUuidAndGroupId(calendar.getUuid(),portletDataContext.getScopeGroupId());
    if (existingCalendar == null) {
      serviceContext.setUuid(calendar.getUuid());
      importedCalendar=CalendarLocalServiceUtil.addCalendar(userId,portletDataContext.getScopeGroupId(),calendarResourceId,calendarNameMap,calendar.getDescriptionMap(),calendar.getTimeZoneId(),calendar.getColor(),calendar.isDefaultCalendar(),calendar.isEnableComments(),calendar.isEnableRatings(),serviceContext);
    }
 else {
      importedCalendar=CalendarLocalServiceUtil.updateCalendar(existingCalendar.getCalendarId(),calendar.getNameMap(),calendar.getDescriptionMap(),calendar.getTimeZoneId(),calendar.getColor(),calendar.isDefaultCalendar(),calendar.isEnableComments(),calendar.isEnableRatings(),serviceContext);
    }
  }
 else {
    importedCalendar=CalendarLocalServiceUtil.addCalendar(userId,portletDataContext.getScopeGroupId(),calendarResourceId,calendarNameMap,calendar.getDescriptionMap(),calendar.getTimeZoneId(),calendar.getColor(),calendar.isDefaultCalendar(),calendar.isEnableComments(),calendar.isEnableRatings(),serviceContext);
  }
  portletDataContext.importClassedModel(calendar,importedCalendar);
}
