{
  long groupId=ParamUtil.getLong(actionRequest,"groupId");
  long recordSetId=ParamUtil.getLong(actionRequest,"recordSetId");
  DDLRecordSet recordSet=_ddlRecordSetService.getRecordSet(recordSetId);
  validateCaptcha(actionRequest,recordSet);
  DDMForm ddmForm=getDDMForm(recordSet);
  DDMFormValues ddmFormValues=_ddmFormValuesFactory.create(actionRequest,ddmForm);
  ServiceContext serviceContext=ServiceContextFactory.getInstance(DDLRecord.class.getName(),actionRequest);
  DDLRecord ddlRecord=_ddlRecordService.addRecord(groupId,recordSetId,DDLRecordConstants.DISPLAY_INDEX_DEFAULT,ddmFormValues,serviceContext);
  boolean sendEmailNotification=GetterUtil.getBoolean(recordSet.getSettingsProperty("sendEmailNotification",StringPool.BLANK));
  if (sendEmailNotification) {
    DDLFormEmailNotificationSenderUtil.sendEmailNotification(actionRequest,ddlRecord);
  }
  String redirectURL=GetterUtil.getString(recordSet.getSettingsProperty("redirectURL",StringPool.BLANK));
  if (SessionErrors.isEmpty(actionRequest) && Validator.isNotNull(redirectURL)) {
    String portletId=PortalUtil.getPortletId(actionRequest);
    SessionMessages.add(actionRequest,portletId,SessionMessages.KEY_SUFFIX_HIDE_DEFAULT_SUCCESS_MESSAGE);
    actionResponse.sendRedirect(redirectURL);
  }
}
