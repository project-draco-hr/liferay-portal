{
  if (_log.isInfoEnabled()) {
    _log.info("Re-indexing Lucene started");
  }
  if (ServerDetector.isOrion()) {
    try {
      Thread.sleep(Time.SECOND * 10);
    }
 catch (    InterruptedException ie) {
    }
  }
  long start1=System.currentTimeMillis();
  LuceneUtil.delete(_companyId);
  try {
    IndexWriter writer=LuceneUtil.getWriter(_companyId,true);
    LuceneUtil.write(writer);
  }
 catch (  IOException ioe) {
    _log.error(ioe.getMessage());
  }
  String[] indexIds=new String[]{_companyId};
  try {
    List portlets=PortletLocalServiceUtil.getPortlets(_companyId);
    Collections.sort(portlets,new PortletLuceneComparator());
    Iterator itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=(Portlet)itr.next();
      String className=portlet.getIndexerClass();
      if (portlet.isActive() && className != null) {
        long start2=System.currentTimeMillis();
        if (_log.isDebugEnabled()) {
          _log.debug("Re-indexing with " + className + " started");
        }
        Indexer indexer=(Indexer)InstancePool.get(className);
        indexer.reIndex(indexIds);
        long end2=System.currentTimeMillis();
        if (_log.isDebugEnabled()) {
          _log.debug("Re-indexing with " + className + " completed in "+ ((end2 - start2) / Time.SECOND)+ " seconds");
        }
      }
    }
    long end1=System.currentTimeMillis();
    if (_log.isInfoEnabled()) {
      _log.info("Re-indexing Lucene completed in " + ((end1 - start1) / Time.SECOND) + " seconds");
    }
  }
 catch (  Exception e) {
    _log.error(e);
    if (_log.isInfoEnabled()) {
      _log.info("Re-indexing Lucene failed");
    }
  }
  _finished=true;
}
