{
  _log.info("Re-indexing Lucene started");
  if (ServerDetector.isOrion()) {
    try {
      Thread.sleep(Time.SECOND * 30);
    }
 catch (    InterruptedException ie) {
    }
  }
  long start=System.currentTimeMillis();
  LuceneUtil.delete(_companyId);
  try {
    IndexWriter writer=LuceneUtil.getWriter(_companyId,true);
    LuceneUtil.write(writer);
  }
 catch (  IOException ioe) {
    _log.error(ioe.getMessage());
  }
  String[] indexIds=new String[]{_companyId};
  try {
    List portlets=PortletServiceUtil.getPortlets(_companyId);
    Collections.sort(portlets,new PortletLuceneComparator());
    Iterator itr=portlets.iterator();
    while (itr.hasNext()) {
      Portlet portlet=(Portlet)itr.next();
      String className=portlet.getIndexerClass();
      if (portlet.isActive() && className != null) {
        _log.debug("Re-indexing with " + className + " started");
        Indexer indexer=(Indexer)InstancePool.get(className);
        indexer.reIndex(indexIds);
        _log.debug("Re-indexing with " + className + " completed");
      }
    }
    long end=System.currentTimeMillis();
    _log.info("Re-indexing Lucene completed in " + ((end - start) / Time.SECOND) + " seconds");
  }
 catch (  Exception e) {
    _log.error(e);
    _log.info("Re-indexing Lucene failed");
  }
  _finished=true;
}
