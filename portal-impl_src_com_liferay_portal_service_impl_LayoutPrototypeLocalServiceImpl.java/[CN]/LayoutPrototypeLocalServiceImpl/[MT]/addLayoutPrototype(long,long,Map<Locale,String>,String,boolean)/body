{
  long layoutPrototypeId=counterLocalService.increment();
  LayoutPrototype layoutPrototype=layoutPrototypePersistence.create(layoutPrototypeId);
  layoutPrototype.setCompanyId(companyId);
  layoutPrototype.setNameMap(nameMap);
  layoutPrototype.setDescription(description);
  layoutPrototype.setActive(active);
  layoutPrototypePersistence.update(layoutPrototype,false);
  if (userId > 0) {
    resourceLocalService.addResources(companyId,0,userId,LayoutPrototype.class.getName(),layoutPrototype.getLayoutPrototypeId(),false,false,false);
  }
  String friendlyURL="/template-" + layoutPrototype.getLayoutPrototypeId();
  Group group=groupLocalService.addGroup(userId,LayoutPrototype.class.getName(),layoutPrototype.getLayoutPrototypeId(),layoutPrototype.getName(LocaleUtil.getDefault()),null,0,friendlyURL,false,true,null);
  ServiceContext serviceContext=new ServiceContext();
  layoutLocalService.addLayout(userId,group.getGroupId(),true,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID,layoutPrototype.getName(LocaleUtil.getDefault()),null,null,LayoutConstants.TYPE_PORTLET,false,"/layout",false,serviceContext);
  return layoutPrototype;
}
