{
  List<MenuItem> portletTitleMenuItems=getPortletTitleMenuItems(portletRequest,portletResponse);
  if (ListUtil.isEmpty(portletTitleMenuItems)) {
    return null;
  }
  Menu menu=new Menu();
  Map<String,Object> data=new HashMap<>();
  data.put("qa-id","addButton");
  menu.setData(data);
  menu.setDirection("right");
  menu.setExtended(false);
  menu.setIcon("plus");
  menu.setMarkupView("lexicon");
  menu.setMenuItems(portletTitleMenuItems);
  menu.setScroll(false);
  menu.setShowArrow(false);
  menu.setShowWhenSingleIcon(true);
  boolean showWhenSingleIcon=true;
  if (portletTitleMenuItems.size() == 1) {
    MenuItem menuItem=portletTitleMenuItems.get(0);
    if (Validator.isNull(menuItem.getLabel())) {
      showWhenSingleIcon=false;
    }
  }
  menu.setShowWhenSingleIcon(showWhenSingleIcon);
  return menu;
}
