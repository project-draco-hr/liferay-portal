{
  long plid=LayoutLocalServiceUtil.getDefaultPlid(groupId,false,portletId);
  if (plid == 0) {
    plid=LayoutLocalServiceUtil.getDefaultPlid(groupId,true,portletId);
  }
  if (plid == 0) {
    Layout layout=(Layout)request.getAttribute(WebKeys.LAYOUT);
    if (layout != null) {
      plid=layout.getPlid();
    }
  }
  PortletURL portletURL=PortletURLFactoryUtil.create(request,portletId,plid,PortletRequest.RENDER_PHASE);
  portletURL.setWindowState(WindowState.MAXIMIZED);
  portletURL.setPortletMode(PortletMode.VIEW);
  return portletURL;
}
