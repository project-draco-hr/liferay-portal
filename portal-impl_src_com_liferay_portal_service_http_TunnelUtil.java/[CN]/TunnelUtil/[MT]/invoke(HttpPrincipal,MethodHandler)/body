{
  if (Validator.isNull(PropsValues.TUNNELING_SERVLET_PRESHARED_SECRET)) {
    throw new PortalException("The tunneling servlet preshared key is not set");
  }
  String password=StringPool.BLANK;
  SecretKeySpec keySpec=new SecretKeySpec(PropsValues.TUNNELING_SERVLET_PRESHARED_SECRET.getBytes(),"HmacSHA1");
  try {
    Mac mac=Mac.getInstance("HmacSHA1");
    mac.init(keySpec);
    String login=httpPrincipal.getLogin();
    password=new String(mac.doFinal(login.getBytes()));
  }
 catch (  NoSuchAlgorithmException nsae) {
  }
catch (  InvalidKeyException ike) {
    throw new PortalException("Invalid tunneling servlet preshared key");
  }
  httpPrincipal.setPassword(password);
  HttpURLConnection urlc=_getConnection(httpPrincipal);
  ObjectOutputStream oos=new ObjectOutputStream(urlc.getOutputStream());
  oos.writeObject(new ObjectValuePair<HttpPrincipal,MethodHandler>(httpPrincipal,methodHandler));
  oos.flush();
  oos.close();
  Object returnObj=null;
  try {
    ObjectInputStream ois=new ObjectInputStream(urlc.getInputStream());
    returnObj=ois.readObject();
    ois.close();
  }
 catch (  EOFException eofe) {
  }
catch (  IOException ioe) {
    String ioeMessage=ioe.getMessage();
    if ((ioeMessage != null) && ioeMessage.contains("HTTP response code: 401")) {
      throw new PrincipalException(ioeMessage);
    }
 else {
      throw ioe;
    }
  }
  if ((returnObj != null) && returnObj instanceof Exception) {
    throw (Exception)returnObj;
  }
  return returnObj;
}
