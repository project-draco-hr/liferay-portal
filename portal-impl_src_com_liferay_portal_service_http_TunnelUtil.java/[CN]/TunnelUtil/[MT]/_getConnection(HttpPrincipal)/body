{
  if (httpPrincipal == null || httpPrincipal.getUrl() == null) {
    return null;
  }
  URL url=null;
  if (Validator.isNull(httpPrincipal.getLogin()) || Validator.isNull(httpPrincipal.getPassword())) {
    url=new URL(httpPrincipal.getUrl() + "/tunnel-web/liferay/do");
  }
 else {
    url=new URL(httpPrincipal.getUrl() + "/tunnel-web/secure/liferay/do");
  }
  HttpURLConnection urlc=(HttpURLConnection)url.openConnection();
  urlc.setDoInput(true);
  urlc.setDoOutput(true);
  urlc.setUseCaches(false);
  urlc.setRequestProperty("Content-Type","application/x-java-serialized-object");
  urlc.setRequestMethod("POST");
  if (Validator.isNotNull(httpPrincipal.getLogin()) && Validator.isNotNull(httpPrincipal.getPassword())) {
    String userNameAndPassword=httpPrincipal.getLogin() + StringPool.COLON + httpPrincipal.getPassword();
    urlc.setRequestProperty(HttpHeaders.AUTHORIZATION,HttpServletRequest.BASIC_AUTH + StringPool.SPACE + Base64.encode(userNameAndPassword.getBytes()));
  }
  return urlc;
}
