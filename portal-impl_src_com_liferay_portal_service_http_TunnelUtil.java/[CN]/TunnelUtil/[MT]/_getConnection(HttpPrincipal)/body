{
  if (httpPrincipal == null || httpPrincipal.getUrl() == null) {
    return null;
  }
  URL url=null;
  if (Validator.isNull(httpPrincipal.getLogin()) || Validator.isNull(httpPrincipal.getPassword())) {
    url=new URL(httpPrincipal.getUrl() + "/tunnel-web/liferay/do");
  }
 else {
    url=new URL(httpPrincipal.getUrl() + "/tunnel-web/secure/liferay/do");
  }
  HttpURLConnection httpURLConnection=(HttpURLConnection)url.openConnection();
  if ((httpURLConnection instanceof HttpsURLConnection) && _OVERRIDE_HOSTNAME_VERIFICATION) {
    HttpsURLConnection httpsURLConnection=(HttpsURLConnection)httpURLConnection;
    httpsURLConnection.setHostnameVerifier(new HostnameVerifier(){
      public boolean verify(      String hostname,      SSLSession session){
        return true;
      }
    }
);
  }
  httpURLConnection.setDoInput(true);
  httpURLConnection.setDoOutput(true);
  httpURLConnection.setRequestProperty(HttpHeaders.CONTENT_TYPE,ContentTypes.APPLICATION_X_JAVA_SERIALIZED_OBJECT);
  httpURLConnection.setUseCaches(false);
  httpURLConnection.setRequestMethod("POST");
  if (Validator.isNotNull(httpPrincipal.getLogin()) && Validator.isNotNull(httpPrincipal.getPassword())) {
    String userNameAndPassword=httpPrincipal.getLogin() + StringPool.COLON + httpPrincipal.getPassword();
    httpURLConnection.setRequestProperty(HttpHeaders.AUTHORIZATION,HttpServletRequest.BASIC_AUTH + StringPool.SPACE + Base64.encode(userNameAndPassword.getBytes()));
  }
  return httpURLConnection;
}
