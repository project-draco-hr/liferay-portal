{
  long userId=portletDataContext.getUserId(fileShortcut.getUserUuid());
  if (fileShortcut.getFolderId() != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    String folderPath=ExportImportPathUtil.getModelPath(portletDataContext,Folder.class.getName(),fileShortcut.getFolderId());
    Folder folder=(Folder)portletDataContext.getZipEntryAsObject(folderPath);
    StagedModelDataHandlerUtil.importReferenceStagedModel(portletDataContext,folder);
  }
  Map<Long,Long> folderIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(Folder.class);
  long folderId=MapUtil.getLong(folderIds,fileShortcut.getFolderId(),fileShortcut.getFolderId());
  long groupId=portletDataContext.getScopeGroupId();
  if (folderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    Folder folder=FolderUtil.findByPrimaryKey(folderId);
    groupId=folder.getRepositoryId();
  }
  String fileEntryPath=ExportImportPathUtil.getModelPath(portletDataContext,FileEntry.class.getName(),fileShortcut.getToFileEntryId());
  FileEntry fileEntry=(FileEntry)portletDataContext.getZipEntryAsObject(fileEntryPath);
  StagedModelDataHandlerUtil.importReferenceStagedModel(portletDataContext,fileEntry);
  Element fileShortcutElement=portletDataContext.getImportDataStagedModelElement(fileShortcut);
  String fileEntryUuid=fileShortcutElement.attributeValue("file-entry-uuid");
  FileEntry importedFileEntry=FileEntryUtil.fetchByUUID_R(fileEntryUuid,groupId);
  if (importedFileEntry == null) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to fetch file entry {uuid=" + fileEntryUuid + ", groupId="+ groupId+ "}");
    }
    return;
  }
  ServiceContext serviceContext=portletDataContext.createServiceContext(fileShortcut,DLPortletDataHandler.NAMESPACE);
  DLFileShortcut importedFileShortcut=null;
  if (portletDataContext.isDataStrategyMirror()) {
    DLFileShortcut existingFileShortcut=DLFileShortcutLocalServiceUtil.fetchDLFileShortcutByUuidAndGroupId(fileShortcut.getUuid(),portletDataContext.getScopeGroupId());
    if (existingFileShortcut == null) {
      serviceContext.setUuid(fileShortcut.getUuid());
      importedFileShortcut=DLAppLocalServiceUtil.addFileShortcut(userId,groupId,folderId,importedFileEntry.getFileEntryId(),serviceContext);
    }
 else {
      importedFileShortcut=DLAppLocalServiceUtil.updateFileShortcut(userId,existingFileShortcut.getFileShortcutId(),folderId,importedFileEntry.getFileEntryId(),serviceContext);
    }
  }
 else {
    importedFileShortcut=DLAppLocalServiceUtil.addFileShortcut(userId,groupId,folderId,importedFileEntry.getFileEntryId(),serviceContext);
  }
  portletDataContext.importClassedModel(fileShortcut,importedFileShortcut,DLPortletDataHandler.NAMESPACE);
}
