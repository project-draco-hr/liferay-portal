{
  User user=UserUtil.findByPrimaryKey(userId);
  long groupId=PortalUtil.getPortletGroupId(plid);
  Date now=new Date();
  Date expirationDate=null;
  if (!neverExpire) {
    expirationDate=PortalUtil.getDate(expirationDateMonth,expirationDateDay,expirationDateYear,expirationDateHour,expirationDateMinute,user.getTimeZone(),new QuestionExpirationDateException());
  }
  validate(title,description,choices);
  String questionId=Long.toString(CounterLocalServiceUtil.increment(PollsQuestion.class.getName()));
  PollsQuestion question=PollsQuestionUtil.create(questionId);
  question.setGroupId(groupId);
  question.setCompanyId(user.getCompanyId());
  question.setUserId(user.getUserId());
  question.setUserName(user.getFullName());
  question.setCreateDate(now);
  question.setModifiedDate(now);
  question.setTitle(title);
  question.setDescription(description);
  question.setExpirationDate(expirationDate);
  PollsQuestionUtil.update(question);
  if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
    addQuestionResources(question,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
  }
 else {
    addQuestionResources(question,communityPermissions,guestPermissions);
  }
  Iterator itr=choices.iterator();
  while (itr.hasNext()) {
    PollsChoice choice=(PollsChoice)itr.next();
    choice.setQuestionId(questionId);
    PollsChoiceUtil.update(choice);
  }
  return question;
}
