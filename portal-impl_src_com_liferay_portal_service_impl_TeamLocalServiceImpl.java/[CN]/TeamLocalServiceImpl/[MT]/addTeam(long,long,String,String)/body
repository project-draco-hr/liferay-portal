{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  validate(0,groupId,name);
  long teamId=counterLocalService.increment();
  Team team=teamPersistence.create(teamId);
  team.setUserId(userId);
  team.setCompanyId(user.getCompanyId());
  team.setUserName(user.getFullName());
  team.setCreateDate(now);
  team.setModifiedDate(now);
  team.setGroupId(groupId);
  team.setName(name);
  team.setDescription(description);
  teamPersistence.update(team,false);
  resourceLocalService.addResources(user.getCompanyId(),groupId,userId,Team.class.getName(),team.getTeamId(),false,true,true);
  roleLocalService.addRole(userId,user.getCompanyId(),String.valueOf(teamId),null,null,RoleConstants.TYPE_EXTERNAL,Team.class.getName(),teamId);
  return team;
}
