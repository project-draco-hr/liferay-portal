{
  List<Group> parentGroups=new ArrayList<Group>();
  parentGroups.add(group);
  LinkedHashMap<String,Object> groupParams=new LinkedHashMap<String,Object>();
  groupParams.put("groupsTree",parentGroups);
  groupParams.put("membershipRestriction",GroupConstants.MEMBERSHIP_RESTRICTION_TO_PARENT_SITE_MEMBERS);
  groupParams.put("site",Boolean.TRUE);
  List<Group> childrenGroups=GroupLocalServiceUtil.search(group.getCompanyId(),null,StringPool.BLANK,groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  List<Group> filteredChildrenGroups=ListUtil.copy(childrenGroups);
  for (  Group childrenGroup : childrenGroups) {
    for (    Group ancestorGroup : childrenGroup.getAncestors()) {
      if ((ancestorGroup.getGroupId() != group.getGroupId()) && !ancestorGroup.isLimitedToParentSiteMembers()) {
        filteredChildrenGroups.remove(childrenGroup);
        break;
      }
    }
  }
  return filteredChildrenGroups;
}
