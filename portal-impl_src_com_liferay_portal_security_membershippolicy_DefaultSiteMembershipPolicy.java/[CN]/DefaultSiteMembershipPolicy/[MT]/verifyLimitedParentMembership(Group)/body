{
  final List<Long> userIds=new ArrayList<Long>();
  ActionableDynamicQuery userActionableDynamicQuery=UserLocalServiceUtil.getActionableDynamicQuery();
  userActionableDynamicQuery.setCompanyId(group.getCompanyId());
  userActionableDynamicQuery.setPerformActionMethod(new ActionableDynamicQuery.PerformActionMethod(){
    @Override public void performAction(    Object object) throws PortalException {
      User user=(User)object;
      if (UserLocalServiceUtil.hasGroupUser(group.getGroupId(),user.getUserId()) && !UserLocalServiceUtil.hasGroupUser(group.getParentGroupId(),user.getUserId())) {
        userIds.add(user.getUserId());
      }
    }
  }
);
  userActionableDynamicQuery.performActions();
  UserLocalServiceUtil.unsetGroupUsers(group.getGroupId(),ArrayUtil.toArray(userIds.toArray(new Long[userIds.size()])),null);
}
