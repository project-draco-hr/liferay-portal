{
  ActionableDynamicQuery actionableDynamicQuery=JournalArticleLocalServiceUtil.getActionableDynamicQuery();
  if (_log.isDebugEnabled()) {
    long count=actionableDynamicQuery.performCount();
    _log.debug("Processing " + count + " journal articles for bad structures");
  }
  actionableDynamicQuery.setPerformActionMethod(new ActionableDynamicQuery.PerformActionMethod(){
    @Override public void performAction(    Object object) throws PortalException {
      JournalArticle article=(JournalArticle)object;
      try {
        JournalArticleLocalServiceUtil.checkStructure(article.getGroupId(),article.getArticleId(),article.getVersion());
      }
 catch (      NoSuchStructureException nsse) {
        if (_log.isWarnEnabled()) {
          _log.warn("Removing reference to missing structure for " + "article " + article.getId());
        }
        article.setDDMStructureKey(StringPool.BLANK);
        article.setDDMTemplateKey(StringPool.BLANK);
        JournalArticleLocalServiceUtil.updateJournalArticle(article);
      }
catch (      Exception e) {
        _log.error("Unable to check the structure for article " + article.getId(),e);
      }
    }
  }
);
  long count=actionableDynamicQuery.performCount();
  if (_log.isDebugEnabled()) {
    _log.debug("Processing " + count + " default article versions in draft mode");
  }
  actionableDynamicQuery.performActions();
}
