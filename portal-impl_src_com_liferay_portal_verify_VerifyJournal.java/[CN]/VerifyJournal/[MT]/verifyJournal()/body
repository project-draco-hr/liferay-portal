{
  List<JournalStructure> structures=JournalStructureLocalServiceUtil.getStructures();
  for (int i=0; i < structures.size(); i++) {
    JournalStructure structure=(JournalStructure)structures.get(i);
    ResourceLocalServiceUtil.addResources(structure.getCompanyId(),0,0,JournalStructure.class.getName(),structure.getId(),false,true,true);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Permissions verified for Journal structures");
  }
  List<JournalTemplate> templates=JournalTemplateLocalServiceUtil.getTemplates();
  for (int i=0; i < templates.size(); i++) {
    JournalTemplate template=(JournalTemplate)templates.get(i);
    ResourceLocalServiceUtil.addResources(template.getCompanyId(),0,0,JournalTemplate.class.getName(),template.getId(),false,true,true);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Permissions verified for Journal templates");
  }
  List<JournalArticle> articles=JournalArticleLocalServiceUtil.getArticles();
  for (int i=0; i < articles.size(); i++) {
    JournalArticle article=(JournalArticle)articles.get(i);
    long groupId=article.getGroupId();
    String articleId=article.getArticleId();
    double version=article.getVersion();
    if (article.getResourcePrimKey() <= 0) {
      article=JournalArticleLocalServiceUtil.checkArticleResourcePrimKey(groupId,articleId,version);
    }
    ResourceLocalServiceUtil.addResources(article.getCompanyId(),0,0,JournalArticle.class.getName(),article.getResourcePrimKey(),false,true,true);
    try {
      TagsAssetLocalServiceUtil.getAsset(JournalArticle.class.getName(),article.getResourcePrimKey());
    }
 catch (    NoSuchAssetException nsae) {
      try {
        JournalArticleLocalServiceUtil.updateTagsAsset(article.getUserId(),article,new String[0]);
      }
 catch (      Exception e) {
        if (_log.isWarnEnabled()) {
          _log.warn("Unable to update tags asset for article " + article.getId() + ": "+ e.getMessage());
        }
      }
    }
    String content=GetterUtil.getString(article.getContent());
    String newContent=Html.replaceMsWordCharacters(content);
    if (!content.equals(newContent)) {
      JournalArticleLocalServiceUtil.updateContent(groupId,articleId,version,newContent);
    }
    JournalArticleLocalServiceUtil.checkStructure(groupId,articleId,version);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Permissions and Tags assets verified for Journal articles");
  }
}
