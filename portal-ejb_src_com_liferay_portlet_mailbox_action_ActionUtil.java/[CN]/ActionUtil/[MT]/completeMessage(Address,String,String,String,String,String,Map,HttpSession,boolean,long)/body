{
  MailMessage mm=new MailMessage();
  mm.setFrom(from);
  mm.setTo(getAddresses(tos));
  mm.setCc(getAddresses(ccs));
  mm.setBcc(getAddresses(bccs));
  mm.setSubject(subject);
  mm.setHtmlBody(body);
  mm.setMessageUID(draftMessageUID);
  Set filenames=attachments.keySet();
  for (Iterator itr=filenames.iterator(); itr.hasNext(); ) {
    String filename=(String)itr.next();
    byte[] attachment=(byte[])attachments.get(filename);
    MailAttachment ma=new MailAttachment();
    ma.setFilename(filename);
    ma.setContentType(ContentTypeUtil.getContentType(filename));
    ma.setContent(attachment);
    mm.appendAttachment(ma);
  }
  MailUtil.completeMessage(ses,mm,send);
}
