{
  StringBuilder sb=new StringBuilder();
  if (count) {
    sb.append("SELECT COUNT(AssetEntry.entryId) AS COUNT_VALUE ");
  }
 else {
    sb.append("SELECT DISTINCT {AssetEntry.*} ");
  }
  sb.append("FROM AssetEntry ");
  if (entryQuery.getAnyTagIds().length > 0) {
    sb.append("INNER JOIN ");
    sb.append("AssetEntries_AssetTags ON ");
    sb.append("(AssetEntries_AssetTags.entryId = ");
    sb.append("AssetEntry.entryId) ");
    sb.append("INNER JOIN ");
    sb.append("AssetTag ON ");
    sb.append("(AssetTag.tagId = AssetEntries_AssetTags.tagId) ");
  }
  if (entryQuery.getAnyCategoryIds().length > 0) {
    sb.append("INNER JOIN ");
    sb.append("AssetEntries_AssetCategories ON ");
    sb.append("(AssetEntries_AssetCategories.entryId = ");
    sb.append("AssetEntry.entryId) ");
    sb.append("INNER JOIN ");
    sb.append("AssetCategory ON ");
    sb.append("(AssetCategory.categoryId = ");
    sb.append("AssetEntries_AssetCategories.categoryId) ");
  }
  sb.append("WHERE (1 = 1)");
  if (entryQuery.isVisible() != null) {
    sb.append(" AND (visible = ?)");
  }
  if (entryQuery.isExcludeZeroViewCount()) {
    sb.append(" AND (AssetEntry.viewCount > 0)");
  }
  if (entryQuery.getAllCategoryIds().length > 0) {
    buildAllCategoriesSQL(entryQuery.getAllCategoryIds(),sb);
  }
  if (entryQuery.getAnyCategoryIds().length > 0) {
    sb.append(" AND (");
    sb.append(getCategoryIds(entryQuery.getAnyCategoryIds(),StringPool.EQUAL));
    sb.append(") ");
  }
  if (entryQuery.getNotAllCategoryIds().length > 0) {
    buildNotAnyCategoriesSQL(entryQuery.getNotAllCategoryIds(),sb);
  }
  if (entryQuery.getNotAnyCategoryIds().length > 0) {
    sb.append(" AND (");
    sb.append(getNotCategoryIds(entryQuery.getNotAnyCategoryIds()));
    sb.append(") ");
  }
  if (entryQuery.getAllTagIds().length > 0) {
    buildAllTagsSQL(entryQuery.getAllTagIds(),sb);
  }
  if (entryQuery.getAnyTagIds().length > 0) {
    sb.append(" AND (");
    sb.append(getTagIds(entryQuery.getAnyTagIds(),StringPool.EQUAL));
    sb.append(") ");
  }
  if (entryQuery.getNotAllTagIds().length > 0) {
    buildNotAnyTagsSQL(entryQuery.getNotAllTagIds(),sb);
  }
  if (entryQuery.getNotAnyTagIds().length > 0) {
    sb.append(" AND (");
    sb.append(getNotTagIds(entryQuery.getNotAnyTagIds()));
    sb.append(") ");
  }
  sb.append("[$DATES$]");
  sb.append(getGroupIds(entryQuery.getGroupIds()));
  sb.append(getClassNameIds(entryQuery.getClassNameIds()));
  if (!count) {
    sb.append(" ORDER BY AssetEntry.");
    sb.append(entryQuery.getOrderByCol1());
    sb.append(StringPool.SPACE);
    sb.append(entryQuery.getOrderByType1());
    if (Validator.isNotNull(entryQuery.getOrderByCol2()) && !entryQuery.getOrderByCol1().equals(entryQuery.getOrderByCol2())) {
      sb.append(", AssetEntry.");
      sb.append(entryQuery.getOrderByCol2());
      sb.append(StringPool.SPACE);
      sb.append(entryQuery.getOrderByType2());
    }
  }
  String sql=sb.toString();
  sql=getDates(sql,entryQuery.getPublishDate(),entryQuery.getExpirationDate());
  SQLQuery q=session.createSQLQuery(sql);
  if (count) {
    q.addScalar(COUNT_COLUMN_NAME,Type.LONG);
  }
 else {
    q.addEntity("AssetEntry",AssetEntryImpl.class);
  }
  QueryPos qPos=QueryPos.getInstance(q);
  if (entryQuery.isVisible() != null) {
    qPos.add(entryQuery.isVisible().booleanValue());
  }
  qPos.add(entryQuery.getAllCategoryIds());
  qPos.add(entryQuery.getAnyCategoryIds());
  qPos.add(entryQuery.getNotAllCategoryIds());
  qPos.add(entryQuery.getNotAnyCategoryIds());
  qPos.add(entryQuery.getAllTagIds());
  qPos.add(entryQuery.getAnyTagIds());
  qPos.add(entryQuery.getNotAllTagIds());
  qPos.add(entryQuery.getNotAnyTagIds());
  setDates(qPos,entryQuery.getPublishDate(),entryQuery.getExpirationDate());
  qPos.add(entryQuery.getGroupIds());
  qPos.add(entryQuery.getClassNameIds());
  return q;
}
