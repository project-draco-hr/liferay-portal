{
  if (notCategoryIds.length == 0) {
    return;
  }
  String sql=CustomSQLUtil.get(FIND_BY_AND_CATEGORY_IDS);
  long[] categoryIds=notCategoryIds;
  if (PropsValues.ASSET_CATEGORIES_SEARCH_HIERARCHICAL) {
    List<Long> categoryIdArray=new ArrayList<Long>();
    for (    long categoryId : notCategoryIds) {
      categoryIdArray.addAll(AssetCategoryFinderUtil.getTreeCategoryIds(categoryId));
    }
    categoryIds=new long[categoryIdArray.size()];
    for (int i=0; i < categoryIdArray.size(); i++) {
      categoryIds[i]=categoryIdArray.get(i);
    }
  }
  sb.append(" AND (NOT ");
  String categoryIdsString=StringUtil.merge(categoryIds);
  sql=StringUtil.replace(sql,"[$CATEGORY_IDS$]",categoryIdsString);
  sb.append(sql);
  sb.append(StringPool.CLOSE_PARENTHESIS);
}
