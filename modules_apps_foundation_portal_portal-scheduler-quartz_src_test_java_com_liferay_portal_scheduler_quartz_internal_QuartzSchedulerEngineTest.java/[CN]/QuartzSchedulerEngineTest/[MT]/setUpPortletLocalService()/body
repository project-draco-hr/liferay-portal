{
  PortletLocalService portletLocalService=Mockito.mock(PortletLocalService.class);
  Mockito.when(portletLocalService.getPortletById(Mockito.anyString())).then(new Answer<Portlet>(){
    @Override public Portlet answer(    InvocationOnMock invocationOnMock) throws Throwable {
      Portlet portlet=Mockito.mock(Portlet.class);
      PortletApp portletApp=Mockito.mock(PortletApp.class);
      ServletContext servletContext=Mockito.mock(ServletContext.class);
      Thread currentThread=Thread.currentThread();
      Mockito.when(servletContext.getClassLoader()).thenReturn(currentThread.getContextClassLoader());
      Mockito.when(portletApp.getServletContext()).thenReturn(servletContext);
      Mockito.when(portlet.getPortletApp()).thenReturn(portletApp);
      return portlet;
    }
  }
);
  return portletLocalService;
}
