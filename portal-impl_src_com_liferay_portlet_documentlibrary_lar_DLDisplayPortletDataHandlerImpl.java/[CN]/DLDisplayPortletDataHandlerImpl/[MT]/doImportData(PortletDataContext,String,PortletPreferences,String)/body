{
  context.importPermissions("com.liferay.portlet.documentlibrary",context.getSourceGroupId(),context.getScopeGroupId());
  Document document=SAXReaderUtil.read(data);
  Element rootElement=document.getRootElement();
  Element foldersElement=rootElement.element("folders");
  List<Element> folderElements=foldersElement.elements("folder");
  for (  Element folderElement : folderElements) {
    DLPortletDataHandlerImpl.importFolder(context,folderElement);
  }
  Element fileEntriesElement=rootElement.element("file-entries");
  List<Element> fileEntryElements=fileEntriesElement.elements("file-entry");
  for (  Element fileEntryElement : fileEntryElements) {
    DLPortletDataHandlerImpl.importFileEntry(context,fileEntryElement);
  }
  if (context.getBooleanParameter(_NAMESPACE,"shortcuts")) {
    List<Element> fileShortcutElements=rootElement.element("file-shortcuts").elements("file-shortcut");
    for (    Element fileShortcutElement : fileShortcutElements) {
      DLPortletDataHandlerImpl.importFileShortcut(context,fileShortcutElement);
    }
  }
  if (context.getBooleanParameter(_NAMESPACE,"ranks")) {
    Element fileRanksElement=rootElement.element("file-ranks");
    List<Element> fileRankElements=fileRanksElement.elements("file-rank");
    for (    Element fileRankElement : fileRankElements) {
      DLPortletDataHandlerImpl.importFileRank(context,fileRankElement);
    }
  }
  long rootFolderId=GetterUtil.getLong(rootElement.attributeValue("root-folder-id"));
  if (Validator.isNotNull(rootFolderId)) {
    Map<Long,Long> folderPKs=(Map<Long,Long>)context.getNewPrimaryKeysMap(DLFolder.class);
    rootFolderId=MapUtil.getLong(folderPKs,rootFolderId,rootFolderId);
    preferences.setValue("rootFolderId",String.valueOf(rootFolderId));
  }
  return preferences;
}
