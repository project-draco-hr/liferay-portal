{
  portletDataContext.addExpandoColumns(DLFileEntry.class.getName());
  portletDataContext.addExpandoColumns(DLFolder.class.getName());
  portletDataContext.addPermissions("com.liferay.portlet.documentlibrary",portletDataContext.getScopeGroupId());
  long rootFolderId=GetterUtil.getLong(portletPreferences.getValue("rootFolderId",null));
  Document document=SAXReaderUtil.createDocument();
  Element rootElement=document.addElement("documentlibrary-display-data");
  Element foldersElement=rootElement.addElement("folders");
  Element fileEntriesElement=rootElement.addElement("file-entries");
  Element fileShortcutsElement=rootElement.addElement("file-shortcuts");
  Element fileRanksElement=rootElement.addElement("file-ranks");
  if (rootFolderId == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    List<Folder> folders=FolderUtil.findByRepositoryId(portletDataContext.getScopeGroupId());
    for (    Folder folder : folders) {
      DLPortletDataHandlerImpl.exportFolder(portletDataContext,foldersElement,fileEntriesElement,fileShortcutsElement,fileRanksElement,folder,false);
    }
  }
 else {
    Folder folder=FolderUtil.findByPrimaryKey(rootFolderId);
    rootElement.addAttribute("root-folder-id",String.valueOf(folder.getFolderId()));
    DLPortletDataHandlerImpl.exportFolder(portletDataContext,foldersElement,fileEntriesElement,fileShortcutsElement,fileRanksElement,folder,true);
  }
  return document.formattedString();
}
