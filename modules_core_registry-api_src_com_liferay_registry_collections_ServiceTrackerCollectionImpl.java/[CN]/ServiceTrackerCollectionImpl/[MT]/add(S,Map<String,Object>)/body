{
  if (service == null) {
    throw new IllegalArgumentException("Null is not allowed as an element");
  }
  properties=new HashMap<String,Object>(properties);
  properties.putAll(_properties);
  if ((_filter != null) && !_filter.matches(properties)) {
    throw new IllegalArgumentException("Provided properties " + properties + " do not match filter");
  }
  Registry registry=RegistryUtil.getRegistry();
  ServiceRegistration<S> serviceRegistration=registry.registerService(_clazz,service,properties);
  _serviceRegistrations.put(service,serviceRegistration);
  return true;
}
