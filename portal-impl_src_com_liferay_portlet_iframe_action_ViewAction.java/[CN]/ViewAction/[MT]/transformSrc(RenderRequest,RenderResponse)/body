{
  PortletPreferences preferences=renderRequest.getPreferences();
  String src=getSrc(renderRequest,renderResponse);
  boolean auth=GetterUtil.getBoolean(preferences.getValue("auth",StringPool.BLANK));
  if (auth) {
    String authType=preferences.getValue("authType",StringPool.BLANK);
    if (authType.equals("basic")) {
      String userName=getUserName(renderRequest,renderResponse);
      String password=getPassword(renderRequest,renderResponse);
      int pos=src.indexOf("://");
      String protocol=src.substring(0,pos + 3);
      String url=src.substring(pos + 3,src.length());
      src=protocol + userName + ":"+ password+ "@"+ url;
    }
 else {
      ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
      String portletId=PortalUtil.getPortletId(renderRequest);
      Portlet portlet=PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),portletId);
      src=themeDisplay.getPathMain() + "/" + portlet.getStrutsPath()+ "/proxy?p_l_id="+ themeDisplay.getPlid()+ "&p_p_id="+ portletId;
    }
  }
  return src;
}
