{
  String ext=StringPool.PERIOD + FileUtil.getExtension(fileName);
  int pos=fileName.lastIndexOf(StringPool.SLASH);
  if (pos == -1) {
    StringBuilder sb=new StringBuilder();
    String fileNameFragment=removeExtension(fileName);
    if (fileNameFragment.startsWith("DLFE-")) {
      fileNameFragment=fileNameFragment.substring(5);
      sb.append("DLFE" + StringPool.SLASH);
    }
    buildPath(sb,fileNameFragment);
    File repositoryDir=getRepositoryDir(companyId,repositoryId);
    return new File(repositoryDir + StringPool.SLASH + sb.toString()+ StringPool.SLASH+ fileNameFragment+ ext+ StringPool.SLASH+ fileNameFragment+ StringPool.UNDERLINE+ version+ ext);
  }
 else {
    File fileNameDir=getDirNameDir(companyId,repositoryId,fileName);
    String fileNameFragment=removeExtension(fileName.substring(pos + 1));
    return new File(fileNameDir + StringPool.SLASH + fileNameFragment+ StringPool.UNDERLINE+ version+ ext);
  }
}
