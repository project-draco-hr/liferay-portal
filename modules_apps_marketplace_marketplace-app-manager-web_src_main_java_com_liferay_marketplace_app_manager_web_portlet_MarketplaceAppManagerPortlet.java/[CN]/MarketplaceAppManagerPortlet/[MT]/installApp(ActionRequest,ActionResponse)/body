{
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  String installMethod=ParamUtil.getString(uploadPortletRequest,"installMethod");
  if (installMethod.equals("local")) {
    String fileName=GetterUtil.getString(uploadPortletRequest.getFileName("file"));
    File file=uploadPortletRequest.getFile("file");
    byte[] bytes=FileUtil.getBytes(file);
    if (ArrayUtil.isEmpty(bytes)) {
      SessionErrors.add(actionRequest,UploadException.class.getName());
    }
 else     if (!fileName.endsWith(".jar") && !fileName.endsWith(".lpkg") && !fileName.endsWith(".war")) {
      SessionErrors.add(actionRequest,FileExtensionException.class.getName());
    }
 else {
      String deployDir=PrefsPropsUtil.getString(PropsKeys.AUTO_DEPLOY_DEPLOY_DIR);
      FileUtil.copyFile(file.toString(),deployDir + StringPool.SLASH + fileName);
      SessionMessages.add(actionRequest,"pluginUploaded");
    }
  }
 else {
    try {
      String url=ParamUtil.getString(uploadPortletRequest,"url");
      URL urlObj=new URL(url);
      String host=urlObj.getHost();
      if (host.endsWith("sf.net") || host.endsWith("sourceforge.net")) {
        doInstallSourceForgeApp(urlObj.getPath(),uploadPortletRequest,actionRequest);
      }
 else {
        doInstallRemoteApp(url,uploadPortletRequest,actionRequest,true);
      }
    }
 catch (    MalformedURLException murle) {
      SessionErrors.add(actionRequest,"invalidUrl",murle);
    }
  }
  String redirect=ParamUtil.getString(uploadPortletRequest,"redirect");
  actionResponse.sendRedirect(redirect);
}
