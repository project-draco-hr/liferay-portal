{
  Bundle bundle=serviceReference.getBundle();
  List<ServiceRegistration<?>> serviceRegistrations=new ArrayList<>();
  BundleWiring bundleWiring=bundle.adapt(BundleWiring.class);
  ClassLoader classLoader=bundleWiring.getClassLoader();
  ResourceBundleLoader resourceBundleLoader=new CacheResourceBundleLoader(ResourceBundleUtil.getResourceBundleLoader("content.Language",classLoader));
  Dictionary<String,Object> properties=new Hashtable<>();
  properties.put("bundle.symbolic.name",bundle.getSymbolicName());
  Object contextName=serviceReference.getProperty(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_NAME);
  properties.put("servlet.context.name",contextName);
  properties.put("service.ranking",Integer.MIN_VALUE);
  serviceRegistrations.add(_bundleContext.registerService(ResourceBundleLoader.class,resourceBundleLoader,properties));
  String filterString="(&(bundle.symbolic.name=" + bundle.getSymbolicName() + ")(objectClass="+ ResourceBundleLoader.class.getName()+ "))";
  ServiceTracker<ResourceBundleLoader,ResourceBundleLoader> serviceTracker=ServiceTrackerFactory.open(_bundleContext,filterString);
  Filter filter=new LanguageFilter(new ServiceTrackerResourceBundleLoader(serviceTracker));
  properties=new Hashtable<>();
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_SELECT,contextName);
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_FILTER_DISPATCHER,new String[]{DispatcherType.ASYNC.toString(),DispatcherType.FORWARD.toString(),DispatcherType.INCLUDE.toString(),DispatcherType.REQUEST.toString()});
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_FILTER_NAME,"Language Filter");
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_FILTER_PATTERN,new String[]{"*.css","*.js"});
  serviceRegistrations.add(_bundleContext.registerService(Filter.class,filter,properties));
  return new TrackedServletContextHelper(serviceTracker,serviceRegistrations);
}
