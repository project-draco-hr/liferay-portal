{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String cmd=ParamUtil.getString(request,Constants.CMD);
  long doAsGroupId=ParamUtil.getLong(request,"doAsGroupId");
  long groupId=ParamUtil.getLong(request,"groupId");
  Group group=null;
  if (groupId > 0) {
    if ((doAsGroupId != 0) && (doAsGroupId != groupId)) {
      group=GroupLocalServiceUtil.getGroup(doAsGroupId);
    }
 else {
      group=GroupLocalServiceUtil.getGroup(groupId);
    }
  }
 else   if (!cmd.equals(Constants.ADD)) {
    group=themeDisplay.getScopeGroup();
  }
  request.setAttribute(WebKeys.GROUP,group);
  return group;
}
