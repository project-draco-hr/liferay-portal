{
  String sessionId=session.getId();
  if (CompoundSessionIdSplitterUtil.hasSessionDelimiter()) {
    sessionId=CompoundSessionIdSplitterUtil.parseSessionId(sessionId);
  }
  Map<String,HttpSession> sessions=_sessions.get(sessionId);
  if (sessions == null) {
    sessions=new ConcurrentHashMap<>();
    Map<String,HttpSession> previousSessions=_sessions.putIfAbsent(sessionId,sessions);
    if (previousSessions != null) {
      sessions=previousSessions;
    }
  }
  ServletContext servletContext=session.getServletContext();
  String contextPath=servletContext.getContextPath();
  if (!sessions.containsKey(contextPath)) {
    sessions.put(contextPath,session);
  }
}
