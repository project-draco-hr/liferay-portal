{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Group scopeGroup=themeDisplay.getScopeGroup();
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  String portletName=portletDisplay.getPortletName();
  AssetPublisherDisplayContext assetPublisherDisplayContext=new AssetPublisherDisplayContext(PortalUtil.getHttpServletRequest(portletRequest),portletRequest.getPreferences());
  if (!assetPublisherDisplayContext.isShowAddContentButton() || (scopeGroup == null) || scopeGroup.isLayoutPrototype()|| (scopeGroup.hasStagingGroup() && !scopeGroup.isStagingGroup())|| portletName.equals(AssetPublisherPortletKeys.HIGHEST_RATED_ASSETS)|| portletName.equals(AssetPublisherPortletKeys.MOST_VIEWED_ASSETS)|| portletName.equals(AssetPublisherPortletKeys.RELATED_ASSETS)) {
    return;
  }
  Map<Long,Map<String,PortletURL>> scopeAddPortletURLs=_getScopeAddPortletURLs(themeDisplay,assetPublisherDisplayContext,portletRequest,portletResponse,1);
  if (MapUtil.isEmpty(scopeAddPortletURLs)) {
    return;
  }
  if (scopeAddPortletURLs.size() == 1) {
    Set<Map.Entry<Long,Map<String,PortletURL>>> entrySet=scopeAddPortletURLs.entrySet();
    Iterator<Map.Entry<Long,Map<String,PortletURL>>> iterator=entrySet.iterator();
    Map.Entry<Long,Map<String,PortletURL>> scopeAddPortletURL=iterator.next();
    long groupId=scopeAddPortletURL.getKey();
    Map<String,PortletURL> addPortletURLs=scopeAddPortletURL.getValue();
    for (    Map.Entry<String,PortletURL> entry : addPortletURLs.entrySet()) {
      URLMenuItem urlMenuItem=_getPortletTitleAddAssetEntryMenuItem(themeDisplay,assetPublisherDisplayContext,groupId,entry.getKey(),entry.getValue());
      menuItems.add(urlMenuItem);
    }
    return;
  }
  URLMenuItem urlMenuItem=new URLMenuItem();
  Map<String,Object> data=new HashMap<>();
  data.put("id",HtmlUtil.escape(portletDisplay.getNamespace()) + "editAsset");
  ResourceBundle resourceBundle=ResourceBundleUtil.getBundle("content.Language",themeDisplay.getLocale(),getClass());
  String title=LanguageUtil.get(resourceBundle,"add-content-select-scope-and-type");
  data.put("title",title);
  urlMenuItem.setData(data);
  urlMenuItem.setIcon("icon-plus-sign-2");
  LiferayPortletResponse liferayPortletResponse=PortalUtil.getLiferayPortletResponse(portletResponse);
  PortletURL portletURL=liferayPortletResponse.createRenderURL();
  portletURL.setParameter("mvcPath","/add_asset_selector.jsp");
  portletURL.setParameter("redirect",themeDisplay.getURLCurrent());
  portletURL.setWindowState(LiferayWindowState.POP_UP);
  urlMenuItem.setURL(portletURL.toString());
  urlMenuItem.setUseDialog(true);
  menuItems.add(urlMenuItem);
}
