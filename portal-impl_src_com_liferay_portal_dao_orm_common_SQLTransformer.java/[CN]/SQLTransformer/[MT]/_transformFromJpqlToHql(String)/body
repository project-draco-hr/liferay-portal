{
  String newSQL=_transformedSqls.get(sql);
  if (newSQL != null) {
    return newSQL;
  }
  newSQL=_transform(sql);
  Matcher matcher=_jpqlCountPattern.matcher(newSQL);
  if (matcher.find()) {
    String countExpression=matcher.group(1);
    String entityAlias=matcher.group(3);
    if (entityAlias.equals(countExpression)) {
      newSQL=matcher.replaceFirst(_HQL_COUNT_SQL);
    }
  }
  _transformedSqls.put(sql,newSQL);
  return newSQL;
}
