{
  if (cacheConfiguration == null) {
    return null;
  }
  String portalCacheName=cacheConfiguration.getName();
  if (portalCacheName == null) {
    portalCacheName=PortalCacheConfiguration.DEFAULT_PORTAL_CACHE_NAME;
  }
  Set<Properties> portalCacheListenerPropertiesSet=new HashSet<>();
  List<CacheEventListenerFactoryConfiguration> cacheEventListenerConfigurations=cacheConfiguration.getCacheEventListenerConfigurations();
  for (  CacheEventListenerFactoryConfiguration cacheEventListenerFactoryConfiguration : cacheEventListenerConfigurations) {
    String factoryClassName=_parseFactoryClassName(cacheEventListenerFactoryConfiguration.getFullyQualifiedClassPath());
    Properties properties=_parseProperties(cacheEventListenerFactoryConfiguration.getProperties(),cacheEventListenerFactoryConfiguration.getPropertySeparator());
    PortalCacheListenerScope portalCacheListenerScope=_portalCacheListenerScopes.get(cacheEventListenerFactoryConfiguration.getListenFor());
    if (factoryClassName.equals(props.get(PropsKeys.EHCACHE_CACHE_EVENT_LISTENER_FACTORY))) {
      if (clusterAware && _clusterEnabled) {
        if (!_clusterLinkReplicationEnabled) {
          properties.put(EhcacheConstants.CACHE_EVENT_LISTENER_FACTORY_CLASS_NAME,factoryClassName);
        }
        properties.put(PortalCacheConfiguration.PORTAL_CACHE_LISTENER_SCOPE,portalCacheListenerScope);
        properties.put(PortalCacheReplicator.REPLICATOR,true);
        portalCacheListenerPropertiesSet.add(properties);
      }
    }
 else     if (!usingDefault) {
      properties.put(EhcacheConstants.CACHE_EVENT_LISTENER_FACTORY_CLASS_NAME,factoryClassName);
      properties.put(PortalCacheConfiguration.PORTAL_CACHE_LISTENER_SCOPE,portalCacheListenerScope);
      portalCacheListenerPropertiesSet.add(properties);
    }
  }
  cacheEventListenerConfigurations.clear();
  Properties portalCacheBootstrapLoaderProperties=null;
  BootstrapCacheLoaderFactoryConfiguration bootstrapCacheLoaderFactoryConfiguration=cacheConfiguration.getBootstrapCacheLoaderFactoryConfiguration();
  if (bootstrapCacheLoaderFactoryConfiguration != null) {
    portalCacheBootstrapLoaderProperties=_parseProperties(bootstrapCacheLoaderFactoryConfiguration.getProperties(),bootstrapCacheLoaderFactoryConfiguration.getPropertySeparator());
    if (clusterAware && _clusterEnabled) {
      if (!_clusterLinkReplicationEnabled) {
        portalCacheBootstrapLoaderProperties.put(EhcacheConstants.BOOTSTRAP_CACHE_LOADER_FACTORY_CLASS_NAME,_parseFactoryClassName(bootstrapCacheLoaderFactoryConfiguration.getFullyQualifiedClassPath()));
      }
    }
    cacheConfiguration.addBootstrapCacheLoaderFactory(null);
  }
  boolean requireSerialization=_isRequireSerialization(cacheConfiguration,clusterAware);
  return new EhcachePortalCacheConfiguration(portalCacheName,portalCacheListenerPropertiesSet,portalCacheBootstrapLoaderProperties,requireSerialization);
}
