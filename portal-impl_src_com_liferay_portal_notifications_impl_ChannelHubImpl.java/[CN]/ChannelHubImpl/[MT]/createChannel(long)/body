{
  Lock writeLock=_channelsRWLock.writeLock();
  try {
    writeLock.lock();
    if (_channels.containsKey(userId)) {
      throw new DuplicateChannelException(userId);
    }
    Channel channel=_channelPrototype.clone(_companyId,userId);
    _channels.put(userId,channel);
    channel.init();
    return channel;
  }
  finally {
    writeLock.unlock();
  }
}
