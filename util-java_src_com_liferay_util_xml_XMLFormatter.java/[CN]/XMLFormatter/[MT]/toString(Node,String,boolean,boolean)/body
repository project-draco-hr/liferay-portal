{
  UnsyncByteArrayOutputStream unsyncByteArrayOutputStream=new UnsyncByteArrayOutputStream();
  OutputFormat outputFormat=OutputFormat.createPrettyPrint();
  outputFormat.setExpandEmptyElements(expandEmptyElements);
  outputFormat.setIndent(indent);
  outputFormat.setLineSeparator(StringPool.NEW_LINE);
  outputFormat.setTrimText(trimText);
  XMLWriter xmlWriter=new XMLWriter(unsyncByteArrayOutputStream,outputFormat);
  xmlWriter.write(node);
  String content=unsyncByteArrayOutputStream.toString(StringPool.UTF8);
  if (content.endsWith("\n\n")) {
    content=content.substring(0,content.length() - 2);
  }
  if (content.endsWith("\n")) {
    content=content.substring(0,content.length() - 1);
  }
  while (content.indexOf(" \n") != -1) {
    content=StringUtil.replace(content," \n","\n");
  }
  if (content.startsWith("<?xml version=\"1.0\" encoding=\"UTF-8\"?>")) {
    content=StringUtil.replaceFirst(content,"<?xml version=\"1.0\" encoding=\"UTF-8\"?>","<?xml version=\"1.0\"?>");
  }
  return content;
}
