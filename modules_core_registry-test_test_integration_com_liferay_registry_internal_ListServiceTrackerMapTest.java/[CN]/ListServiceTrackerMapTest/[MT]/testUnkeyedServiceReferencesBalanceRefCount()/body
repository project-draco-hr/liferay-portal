{
  Registry registry=RegistryUtil.getRegistry();
  RegistryWrapper registryWrapper=new RegistryWrapper(registry);
  ServiceTrackerMap<TrackedOne,TrackedOne> serviceTrackerMap=ServiceTrackerMapFactory.createObjectServiceTrackerMap(TrackedOne.class,null,new ServiceReferenceMapper<TrackedOne>(){
    @Override public void map(    ServiceReference<?> serviceReference,    Emitter<TrackedOne> emitter){
    }
  }
);
  serviceTrackerMap.open();
  ServiceRegistration<TrackedOne> sr1=registerService(new TrackedOne());
  ServiceRegistration<TrackedOne> sr2=registerService(new TrackedOne());
  Collection<AtomicInteger> values=registryWrapper.getReferences().values();
  Assert.assertEquals(0,values.size());
  for (  AtomicInteger i : values) {
    int count=i.get();
    Assert.assertEquals(0,count);
  }
  sr1.unregister();
  sr2.unregister();
  values=registryWrapper.getReferences().values();
  Assert.assertEquals(0,values.size());
  for (  AtomicInteger i : values) {
    int count=i.get();
    Assert.assertEquals(0,count);
  }
  serviceTrackerMap.close();
}
