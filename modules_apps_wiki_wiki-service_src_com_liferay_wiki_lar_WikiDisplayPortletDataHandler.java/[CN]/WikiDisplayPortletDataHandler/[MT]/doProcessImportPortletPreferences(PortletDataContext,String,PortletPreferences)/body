{
  portletDataContext.importPortletPermissions(WikiResourcePermissionChecker.RESOURCE_NAME);
  StagedModelDataHandlerUtil.importReferenceStagedModels(portletDataContext,WikiNode.class);
  StagedModelDataHandlerUtil.importReferenceStagedModels(portletDataContext,WikiPage.class);
  long nodeId=GetterUtil.getLong(portletPreferences.getValue("nodeId",StringPool.BLANK));
  if (nodeId > 0) {
    Map<Long,Long> nodeIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(WikiNode.class);
    nodeId=MapUtil.getLong(nodeIds,nodeId,nodeId);
    portletPreferences.setValue("nodeId",String.valueOf(nodeId));
  }
  return portletPreferences;
}
