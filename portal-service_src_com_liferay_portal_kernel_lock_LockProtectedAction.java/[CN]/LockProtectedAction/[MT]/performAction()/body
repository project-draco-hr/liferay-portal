{
  Lock lock=null;
  while (true) {
    try {
      lock=LockHelperUtil.lock(_className,_lockKey,_lockKey);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to acquire lock. Retrying.");
      }
      continue;
    }
    if (lock.isNew()) {
      try {
        _returnValue=performProtectedAction();
      }
  finally {
        LockHelperUtil.unlock(_className,_lockKey,_lockKey);
      }
      break;
    }
    Date createDate=lock.getCreateDate();
    if ((System.currentTimeMillis() - createDate.getTime()) >= _timeout) {
      LockHelperUtil.unlock(_className,_lockKey,lock.getOwner());
      if (_log.isWarnEnabled()) {
        _log.warn("Removed lock " + lock + " due to timeout");
      }
    }
 else {
      try {
        Thread.sleep(_retryDelay);
      }
 catch (      InterruptedException ie) {
        if (_log.isWarnEnabled()) {
          _log.warn("Interrupted while waiting to reacquire lock",ie);
        }
      }
    }
  }
}
