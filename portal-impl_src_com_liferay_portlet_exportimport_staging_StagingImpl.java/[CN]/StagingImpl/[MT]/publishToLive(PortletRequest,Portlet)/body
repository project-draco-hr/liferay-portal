{
  long plid=ParamUtil.getLong(portletRequest,"plid");
  Layout sourceLayout=LayoutLocalServiceUtil.getLayout(plid);
  Group stagingGroup=null;
  Group liveGroup=null;
  Layout targetLayout=null;
  long scopeGroupId=PortalUtil.getScopeGroupId(portletRequest);
  if (sourceLayout.isTypeControlPanel()) {
    stagingGroup=GroupLocalServiceUtil.fetchGroup(scopeGroupId);
    liveGroup=stagingGroup.getLiveGroup();
    targetLayout=sourceLayout;
  }
 else   if (sourceLayout.hasScopeGroup() && (sourceLayout.getScopeGroup().getGroupId() == scopeGroupId)) {
    stagingGroup=sourceLayout.getScopeGroup();
    liveGroup=stagingGroup.getLiveGroup();
    targetLayout=LayoutLocalServiceUtil.getLayout(liveGroup.getClassPK());
  }
 else {
    stagingGroup=sourceLayout.getGroup();
    liveGroup=stagingGroup.getLiveGroup();
    targetLayout=LayoutLocalServiceUtil.fetchLayoutByUuidAndGroupId(sourceLayout.getUuid(),liveGroup.getGroupId(),sourceLayout.isPrivateLayout());
  }
  copyPortlet(portletRequest,stagingGroup.getGroupId(),liveGroup.getGroupId(),sourceLayout.getPlid(),targetLayout.getPlid(),portlet.getPortletId());
}
