{
  PermissionChecker permissionChecker=getPermissionChecker();
  TrashEntry entry=trashEntryPersistence.findByPrimaryKey(entryId);
  TrashHandler trashHandler=TrashHandlerRegistryUtil.getTrashHandler(entry.getClassName());
  if (!trashHandler.hasTrashPermission(permissionChecker,0,entry.getClassPK(),TrashActionKeys.RESTORE)) {
    throw new PrincipalException("trash.restore.error");
  }
  if (overrideClassPK > 0) {
    if (!trashHandler.hasTrashPermission(permissionChecker,0,overrideClassPK,TrashActionKeys.OVERWRITE)) {
      throw new PrincipalException("trash.restore.overwrite.error");
    }
    trashHandler.deleteTrashEntry(overrideClassPK);
  }
 else   if (name != null) {
    if (!trashHandler.hasTrashPermission(permissionChecker,0,entry.getClassPK(),TrashActionKeys.RENAME)) {
      throw new PrincipalException("trash.restore.rename.error");
    }
    trashHandler.updateTitle(entry.getClassPK(),name);
  }
  trashHandler.checkDuplicateTrashEntry(entry,TrashEntryConstants.DEFAULT_CONTAINER_ID,null);
  trashHandler.restoreTrashEntry(getUserId(),entry.getClassPK());
  return entry;
}
