{
  Map<String,Map<String,String>> fieldsMap=_localizedFieldsMap.get(locale);
  Map<String,Map<String,String>> transientFieldsMap=_localizedTransientFieldsMap.get(locale);
  if (fieldsMap != null) {
    return;
  }
  if (getParentStructureId() > 0) {
    DDMStructure parentStructure=DDMStructureLocalServiceUtil.getStructure(getParentStructureId());
    fieldsMap=parentStructure.getFieldsMap(locale);
    transientFieldsMap=parentStructure.getTransientFieldsMap(locale);
  }
 else {
    fieldsMap=new LinkedHashMap<String,Map<String,String>>();
    transientFieldsMap=new LinkedHashMap<String,Map<String,String>>();
  }
  XPath xPathSelector=SAXReaderUtil.createXPath("//dynamic-element");
  List<Node> nodes=xPathSelector.selectNodes(getDocument());
  for (  Node node : nodes) {
    Element element=(Element)node;
    String name=element.attributeValue("name");
    if (Validator.isNotNull(element.attributeValue("dataType"))) {
      fieldsMap.put(name,_getField(element,locale));
    }
 else {
      transientFieldsMap.put(name,_getField(element,locale));
    }
  }
  _localizedFieldsMap.put(locale,fieldsMap);
  _localizedTransientFieldsMap.put(locale,transientFieldsMap);
}
