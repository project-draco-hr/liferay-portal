{
  _request=request;
  _fileVersion=fileVersion;
  _themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  _companyId=_themeDisplay.getCompanyId();
  if (fileVersion != null) {
    _fileEntry=fileVersion.getFileEntry();
  }
  _dlFileEntryActionsDisplayContextHelper=new DLFileEntryActionsDisplayContextHelper(_themeDisplay.getPermissionChecker(),_fileEntry,fileVersion);
  _fileEntryTypeId=ParamUtil.getLong(request,"fileEntryTypeId",-1);
  if ((_fileEntryTypeId == -1) && (_fileEntry != null) && (_fileEntry.getModel() instanceof DLFileEntry)) {
    DLFileEntry dlFileEntry=(DLFileEntry)_fileEntry.getModel();
    _fileEntryTypeId=dlFileEntry.getFileEntryTypeId();
  }
  _folderId=BeanParamUtil.getLong(_fileEntry,request,"folderId");
  _portletDisplay=_themeDisplay.getPortletDisplay();
  _scopeGroupId=_themeDisplay.getScopeGroupId();
  PortletResponse portletResponse=(PortletResponse)_request.getAttribute(JavaConstants.JAVAX_PORTLET_RESPONSE);
  _liferayPortletResponse=PortalUtil.getLiferayPortletResponse(portletResponse);
  PortletRequest portletRequest=(PortletRequest)_request.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  _liferayPortletRequest=PortalUtil.getLiferayPortletRequest(portletRequest);
  PortletDisplay portletDisplay=_themeDisplay.getPortletDisplay();
  _portletId=portletDisplay.getId();
  if (_portletId.equals(PortletKeys.PORTLET_CONFIGURATION)) {
    _portletId=ParamUtil.getString(_request,"portletResource");
  }
  DLPortletInstanceSettings dlPortletInstanceSettings=DLPortletInstanceSettings.getInstance(_themeDisplay.getLayout(),_portletId);
  _dlActionsDisplayContext=new DLActionsDisplayContext(_request,dlPortletInstanceSettings);
  PortletURL portletURL=PortletURLUtil.getCurrent(_liferayPortletRequest,_liferayPortletResponse);
  _currentURL=portletURL.toString();
}
