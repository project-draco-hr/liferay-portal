{
  Directory directory=null;
  if (PropsUtil.get(PropsUtil.LUCENE_STORE_TYPE).equals(_LUCENE_STORE_TYPE_JDBC)) {
    try {
      DataSource ds=(DataSource)JNDIUtil.lookup(new InitialContext(),Constants.DATA_SOURCE);
      directory=new JdbcDirectory(ds,_dialect,_getTableName(companyId));
      JdbcDirectory jdbcDir=(JdbcDirectory)directory;
      if (!jdbcDir.tableExists()) {
        jdbcDir.create();
      }
    }
 catch (    IOException ioe) {
      throw new RuntimeException(ioe);
    }
catch (    NamingException ne) {
      throw new RuntimeException(ne);
    }
catch (    UnsupportedOperationException uoe) {
      throw new RuntimeException(uoe);
    }
  }
 else {
    String path=PropsUtil.get(PropsUtil.LUCENE_DIR) + companyId + StringPool.SLASH;
    try {
      directory=FSDirectory.getDirectory(path,false);
    }
 catch (    IOException ioe) {
      try {
        directory=FSDirectory.getDirectory(path,true);
      }
 catch (      IOException ioe2) {
        throw new RuntimeException(ioe2);
      }
    }
  }
  return directory;
}
