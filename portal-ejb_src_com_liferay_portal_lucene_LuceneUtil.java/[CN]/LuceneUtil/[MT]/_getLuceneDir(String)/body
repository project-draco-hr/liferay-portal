{
  Directory directory=null;
  if (PropsUtil.get(PropsUtil.LUCENE_STORE_TYPE).equals(_LUCENE_STORE_TYPE_JDBC)) {
    try {
      DataSource ds=HibernateUtil.getDataSource();
      directory=new JdbcDirectory(ds,_dialect,_getTableName(companyId));
      JdbcDirectory jdbcDir=(JdbcDirectory)directory;
      if (!jdbcDir.tableExists()) {
        jdbcDir.create();
      }
    }
 catch (    IOException ioe) {
      throw new RuntimeException(ioe);
    }
catch (    NamingException ne) {
      throw new RuntimeException(ne);
    }
catch (    UnsupportedOperationException uoe) {
      throw new RuntimeException(uoe);
    }
  }
 else {
    String path=PropsUtil.get(PropsUtil.LUCENE_DIR) + companyId + StringPool.SLASH;
    try {
      directory=FSDirectory.getDirectory(path,false);
    }
 catch (    IOException ioe1) {
      try {
        if (directory != null) {
          directory.close();
        }
        directory=FSDirectory.getDirectory(path,true);
      }
 catch (      IOException ioe2) {
        throw new RuntimeException(ioe2);
      }
    }
  }
  return directory;
}
