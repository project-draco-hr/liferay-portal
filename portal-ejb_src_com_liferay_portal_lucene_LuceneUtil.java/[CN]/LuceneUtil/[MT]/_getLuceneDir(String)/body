{
  if (PropsUtil.get(PropsUtil.LUCENE_STORE_TYPE).equals(_LUCENE_STORE_TYPE_JDBC)) {
    try {
      DataSource ds=(DataSource)JNDIUtil.lookup(new InitialContext(),Constants.DATA_SOURCE);
      JdbcDirectory directory=new JdbcDirectory(ds,_dialect,_getTableName(companyId));
      if (!directory.tableExists()) {
        directory.create();
      }
      return directory;
    }
 catch (    IOException ioe) {
      throw new RuntimeException(ioe);
    }
catch (    NamingException ne) {
      throw new RuntimeException(ne);
    }
catch (    UnsupportedOperationException uoe) {
      throw new RuntimeException(uoe);
    }
  }
 else {
    try {
      return FSDirectory.getDirectory(PropsUtil.get(PropsUtil.LUCENE_DIR) + companyId + StringPool.SLASH,true);
    }
 catch (    IOException ioe) {
      throw new RuntimeException(ioe);
    }
  }
}
