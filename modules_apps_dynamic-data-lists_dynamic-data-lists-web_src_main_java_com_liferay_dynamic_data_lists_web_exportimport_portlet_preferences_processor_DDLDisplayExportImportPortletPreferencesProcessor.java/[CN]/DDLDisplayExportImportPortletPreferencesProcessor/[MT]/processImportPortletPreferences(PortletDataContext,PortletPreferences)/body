{
  try {
    portletDataContext.importPortletPermissions(DDLPermission.RESOURCE_NAME);
  }
 catch (  PortalException pe) {
    throw new PortletDataException("Unable to export portlet permissions",pe);
  }
  long importedRecordSetId=GetterUtil.getLong(portletPreferences.getValue("recordSetId",null));
  long importedDisplayDDMTemplateId=GetterUtil.getLong(portletPreferences.getValue("displayDDMTemplateId",null));
  long importedFormDDMTemplateId=GetterUtil.getLong(portletPreferences.getValue("formDDMTemplateId",null));
  Map<Long,Long> recordSetIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(DDLRecordSet.class);
  long recordSetId=MapUtil.getLong(recordSetIds,importedRecordSetId,importedRecordSetId);
  Map<Long,Long> templateIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(DDMTemplate.class);
  long displayDDMTemplateId=MapUtil.getLong(templateIds,importedDisplayDDMTemplateId,importedDisplayDDMTemplateId);
  long formDDMTemplateId=MapUtil.getLong(templateIds,importedFormDDMTemplateId,importedFormDDMTemplateId);
  try {
    portletPreferences.setValue("recordSetId",String.valueOf(recordSetId));
    portletPreferences.setValue("displayDDMTemplateId",String.valueOf(displayDDMTemplateId));
    portletPreferences.setValue("formDDMTemplateId",String.valueOf(formDDMTemplateId));
  }
 catch (  ReadOnlyException roe) {
    throw new PortletDataException("Unable to update portlet preferences during import",roe);
  }
  return portletPreferences;
}
