{
  if (text == null) {
    return null;
  }
  String prefix=StringPool.BLANK;
  String postfix=StringPool.BLANK;
  if (type == ESCAPE_MODE_ATTRIBUTE) {
    prefix="&#x";
    postfix=StringPool.SEMICOLON;
  }
 else   if (type == ESCAPE_MODE_CSS) {
    prefix=StringPool.BACK_SLASH;
  }
 else   if (type == ESCAPE_MODE_JS) {
    prefix="\\x";
  }
 else   if (type == ESCAPE_MODE_URL) {
    return HttpUtil.encodeURL(text,true);
  }
 else {
    return escape(text);
  }
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < text.length(); i++) {
    char c=text.charAt(i);
    if ((Character.isLetterOrDigit(c)) || (c == CharPool.DASH) || (c == CharPool.UNDERLINE)) {
      sb.append(c);
    }
 else {
      sb.append(prefix);
      sb.append(Integer.toHexString(c));
      sb.append(postfix);
    }
  }
  return sb.toString();
}
