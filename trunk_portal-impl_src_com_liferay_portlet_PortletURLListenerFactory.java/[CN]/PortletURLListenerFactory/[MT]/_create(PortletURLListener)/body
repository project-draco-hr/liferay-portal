{
  PortletApp portletApp=portletURLListener.getPortletApp();
  Map<String,PortletURLGenerationListener> portletURLGenerationListeners=_pool.get(portletApp.getServletContextName());
  if (portletURLGenerationListeners == null) {
    portletURLGenerationListeners=new ConcurrentHashMap<String,PortletURLGenerationListener>();
    _pool.put(portletApp.getServletContextName(),portletURLGenerationListeners);
  }
  PortletURLGenerationListener portletURLGenerationListener=portletURLGenerationListeners.get(portletURLListener.getListenerClass());
  if (portletURLGenerationListener == null) {
    if (portletApp.isWARFile()) {
      PortletContextBag portletContextBag=PortletContextBagPool.get(portletApp.getServletContextName());
      portletURLGenerationListener=portletContextBag.getPortletURLListeners().get(portletURLListener.getListenerClass());
      portletURLGenerationListener=_init(portletURLListener,portletURLGenerationListener);
    }
 else {
      portletURLGenerationListener=_init(portletURLListener);
    }
    portletURLGenerationListeners.put(portletURLListener.getListenerClass(),portletURLGenerationListener);
  }
  return portletURLGenerationListener;
}
