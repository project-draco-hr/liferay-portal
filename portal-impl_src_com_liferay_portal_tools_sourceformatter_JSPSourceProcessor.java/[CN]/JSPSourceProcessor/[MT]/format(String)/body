{
  File file=new File(BASEDIR + fileName);
  fileName=StringUtil.replace(fileName,StringPool.BACK_SLASH,StringPool.SLASH);
  String absolutePath=fileUtil.getAbsolutePath(file);
  String content=fileUtil.read(file);
  String oldContent=content;
  String newContent=StringPool.BLANK;
  while (true) {
    newContent=formatJSP(fileName,absolutePath,oldContent);
    if (oldContent.equals(newContent)) {
      break;
    }
    oldContent=newContent;
  }
  newContent=StringUtil.replace(newContent,new String[]{"<br/>","\"/>","\" >","@page import","\"%>",")%>","else{","for(","function (","if(","javascript: ","while(","){\n",";;\n","\n\n\n"},new String[]{"<br />","\" />","\">","@ page import","\" %>",") %>","else {","for (","function(","if (","javascript:","while (",") {\n",";\n","\n\n"});
  newContent=fixCompatClassImports(absolutePath,newContent);
  if (_stripJSPImports && !_jspContents.isEmpty()) {
    try {
      newContent=stripJSPImports(fileName,newContent);
    }
 catch (    RuntimeException re) {
      _stripJSPImports=false;
    }
  }
  if (portalSource && !mainReleaseVersion.equals(MAIN_RELEASE_VERSION_6_1_0) && content.contains("page import=")&& !fileName.contains("init.jsp")&& !fileName.contains("init-ext.jsp")&& !fileName.contains("/taglib/aui/")&& !fileName.endsWith("touch.jsp")&& (fileName.endsWith(".jspf") || content.contains("include file="))) {
    processErrorMessage(fileName,"move imports to init.jsp: " + fileName);
  }
  newContent=fixCopyright(newContent,absolutePath,fileName);
  newContent=StringUtil.replace(newContent,new String[]{"alert('<%= LanguageUtil.","alert(\"<%= LanguageUtil.","confirm('<%= LanguageUtil.","confirm(\"<%= LanguageUtil."},new String[]{"alert('<%= UnicodeLanguageUtil.","alert(\"<%= UnicodeLanguageUtil.","confirm('<%= UnicodeLanguageUtil.","confirm(\"<%= UnicodeLanguageUtil."});
  if (newContent.contains("    ")) {
    if (!fileName.matches(".*template.*\\.vm$")) {
      processErrorMessage(fileName,"tab: " + fileName);
    }
  }
  if (fileName.endsWith("init.jsp") || fileName.endsWith("init.jspf")) {
    int x=newContent.indexOf("<%@ page import=");
    int y=newContent.lastIndexOf("<%@ page import=");
    y=newContent.indexOf("%>",y);
    if ((x != -1) && (y != -1) && (y > x)) {
      boolean compressImports=true;
      if (compressImports) {
        String imports=newContent.substring(x,y);
        imports=StringUtil.replace(imports,new String[]{"%>\r\n<%@ ","%>\n<%@ "},new String[]{"%><%@\r\n","%><%@\n"});
        newContent=newContent.substring(0,x) + imports + newContent.substring(y);
      }
    }
  }
  newContent=fixSessionKey(fileName,newContent,sessionKeyPattern);
  newContent=fixSessionKey(fileName,newContent,taglibSessionKeyPattern);
  checkLanguageKeys(fileName,newContent,languageKeyPattern);
  checkLanguageKeys(fileName,newContent,_taglibLanguageKeyPattern1);
  checkLanguageKeys(fileName,newContent,_taglibLanguageKeyPattern2);
  checkLanguageKeys(fileName,newContent,_taglibLanguageKeyPattern3);
  checkXSS(fileName,newContent);
  newContent=fixIncorrectParameterTypeForLanguageUtil(newContent,true,fileName);
  Matcher matcher=_javaClassPattern.matcher(newContent);
  if (matcher.find()) {
    newContent=formatJavaTerms(fileName,newContent,matcher.group(),null,null);
  }
  compareAndAutoFixContent(file,fileName,content,newContent);
  return newContent;
}
