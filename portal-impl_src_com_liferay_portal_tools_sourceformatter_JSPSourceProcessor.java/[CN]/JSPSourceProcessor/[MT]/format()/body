{
  _unusedVariablesExclusions=getPropertyList("jsp.unused.variables.excludes");
  String[] excludes=new String[]{"**\\null.jsp","**\\tools\\**"};
  String[] includes=new String[]{"**\\*.jsp","**\\*.jspf","**\\*.vm"};
  List<String> fileNames=getFileNames(excludes,includes);
  Pattern pattern=Pattern.compile("\\s*@\\s*include\\s*file=['\"](.*)['\"]");
  for (  String fileName : fileNames) {
    File file=new File(BASEDIR + fileName);
    fileName=StringUtil.replace(fileName,StringPool.BACK_SLASH,StringPool.SLASH);
    String absolutePath=getAbsolutePath(file);
    String content=fileUtil.read(file);
    Matcher matcher=pattern.matcher(content);
    String newContent=content;
    while (matcher.find()) {
      newContent=StringUtil.replaceFirst(newContent,matcher.group(),"@ include file=\"" + matcher.group(1) + "\"",matcher.start());
    }
    processFormattedFile(file,fileName,content,newContent);
    if (portalSource && mainReleaseVersion.equals(MAIN_RELEASE_LATEST_VERSION) && fileName.endsWith("/init.jsp")&& !absolutePath.contains("/modules/")&& !fileName.endsWith("/common/init.jsp")) {
      addImportCounts(content);
    }
    _jspContents.put(fileName,newContent);
  }
  if (portalSource && !mainReleaseVersion.equals(MAIN_RELEASE_VERSION_6_1_0)) {
    moveFrequentlyUsedImportsToCommonInit(4);
  }
  for (  String fileName : fileNames) {
    format(fileName);
  }
}
