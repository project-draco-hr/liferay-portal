{
  String selectSQL="select classNameId, classPK, count(1) as totalEntries, " + "sum(RatingsEntry.score) as totalScore, " + "sum(RatingsEntry.score) / count(1) as averageScore "+ "from RatingsEntry group by classNameId, classPK";
  String updateSQL="update RatingsStats set totalEntries = ?, totalScore = ?, " + "averageScore = ? where classNameId = ? and classPK = ?";
  try (Connection con=DataAccess.getUpgradeOptimizedConnection();PreparedStatement ps=con.prepareStatement(selectSQL);ResultSet rs=ps.executeQuery()){
    try (PreparedStatement ps2=AutoBatchPreparedStatementUtil.autoBath(con.prepareStatement(updateSQL))){
      while (rs.next()) {
        ps2.setInt(1,rs.getInt("totalEntries"));
        ps2.setDouble(2,rs.getDouble("totalScore"));
        ps2.setDouble(3,rs.getDouble("averageScore"));
        ps2.setLong(4,rs.getLong("classNameId"));
        ps2.setLong(5,rs.getLong("classPK"));
        ps2.addBatch();
      }
      ps2.executeBatch();
    }
   }
 }
