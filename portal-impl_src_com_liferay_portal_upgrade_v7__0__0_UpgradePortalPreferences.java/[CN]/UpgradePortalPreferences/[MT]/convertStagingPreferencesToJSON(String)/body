{
  Document newDocument=SAXReaderUtil.createDocument();
  Element newRootElement=SAXReaderUtil.createElement("portlet-preferences");
  newDocument.add(newRootElement);
  Document document=SAXReaderUtil.read(preferences);
  Element rootElement=document.getRootElement();
  Iterator<Element> itr=rootElement.elementIterator();
  Map<String,String> stagingPreferencesMap=new HashMap<>();
  while (itr.hasNext()) {
    Element preferenceElement=itr.next();
    String preferenceName=preferenceElement.elementText("name");
    if (preferenceName.contains(Staging.class.getName())) {
      String preferenceValue=preferenceElement.elementText("value");
      int index=preferenceName.indexOf(StringPool.POUND);
      stagingPreferencesMap.put(preferenceName.substring(index + 1),preferenceValue);
    }
 else {
      newRootElement.add(preferenceElement.createCopy());
    }
  }
  JSONArray stagingPreferencesJsonArray=JSONFactoryUtil.createJSONArray();
  for (  String key : stagingPreferencesMap.keySet()) {
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    jsonObject.put(key,stagingPreferencesMap.get(key));
    stagingPreferencesJsonArray.put(jsonObject);
  }
  if (stagingPreferencesJsonArray.length() > 0) {
    Element preferenceElement=SAXReaderUtil.createElement("preference");
    Element nameElement=SAXReaderUtil.createElement("name");
    String stagingPreferencesName=Staging.class.getName() + StringPool.POUND + StagingConstants.STAGING_RECENT_LAYOUT_IDS_MAP;
    nameElement.setText(stagingPreferencesName);
    Element valueElement=SAXReaderUtil.createElement("value");
    valueElement.setText(stagingPreferencesJsonArray.toString());
    preferenceElement.add(nameElement);
    preferenceElement.add(valueElement);
    newRootElement.add(preferenceElement);
  }
  return DDMXMLUtil.formatXML(newDocument);
}
