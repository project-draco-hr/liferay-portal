{
  ExportImportConfiguration exportImportConfiguration=getExportImportConfiguration(backgroundTask);
  Map<String,Serializable> settingsMap=exportImportConfiguration.getSettingsMap();
  long userId=MapUtil.getLong(settingsMap,"userId");
  long targetPlid=MapUtil.getLong(settingsMap,"targetPlid");
  long targetGroupId=MapUtil.getLong(settingsMap,"targetGroupId");
  String portletId=MapUtil.getString(settingsMap,"portletId");
  Map<String,String[]> parameterMap=(Map<String,String[]>)settingsMap.get("parameterMap");
  List<FileEntry> attachmentsFileEntries=backgroundTask.getAttachmentsFileEntries();
  File file=null;
  for (  FileEntry attachmentsFileEntry : attachmentsFileEntries) {
    try {
      file=FileUtil.createTempFile("lar");
      FileUtil.write(file,attachmentsFileEntry.getContentStream());
      TransactionHandlerUtil.invoke(transactionAttribute,new PortletImportCallable(file,parameterMap,portletId,targetGroupId,targetPlid,userId));
    }
 catch (    Throwable t) {
      if (_log.isDebugEnabled()) {
        _log.debug(t,t);
      }
 else       if (_log.isWarnEnabled()) {
        _log.warn("Unable to import portlet: " + t.getMessage());
      }
      throw new SystemException(t);
    }
 finally {
      FileUtil.delete(file);
    }
  }
  return BackgroundTaskResult.SUCCESS;
}
