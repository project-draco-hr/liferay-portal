{
  try (LoggingTimer loggingTimer=new LoggingTimer()){
    List<MBThread> threads=MBThreadLocalServiceUtil.getMBThreads(QueryUtil.ALL_POS,QueryUtil.ALL_POS);
    if (_log.isDebugEnabled()) {
      _log.debug("Processing " + threads.size() + " threads for statistics accuracy");
    }
    for (    MBThread thread : threads) {
      int messageCount=MBMessageLocalServiceUtil.getThreadMessagesCount(thread.getThreadId(),WorkflowConstants.STATUS_APPROVED);
      if (thread.getMessageCount() != messageCount) {
        thread.setMessageCount(messageCount);
        MBThreadLocalServiceUtil.updateMBThread(thread);
      }
    }
    if (_log.isDebugEnabled()) {
      _log.debug("Statistics verified for threads");
    }
  }
 }
