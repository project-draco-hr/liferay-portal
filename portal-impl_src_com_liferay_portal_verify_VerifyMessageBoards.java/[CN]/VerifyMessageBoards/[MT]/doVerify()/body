{
  List<MBCategory> categories=MBCategoryLocalServiceUtil.getMBCategories(QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  if (_log.isDebugEnabled()) {
    _log.debug("Processing " + categories.size() + " categories for statistics accuracy");
  }
  for (  MBCategory category : categories) {
    int threadCount=MBThreadLocalServiceUtil.getCategoryThreadsCount(category.getGroupId(),category.getCategoryId(),WorkflowConstants.STATUS_APPROVED);
    int messageCount=MBMessageLocalServiceUtil.getCategoryMessagesCount(category.getGroupId(),category.getCategoryId(),WorkflowConstants.STATUS_APPROVED);
    if ((category.getThreadCount() != threadCount) || (category.getMessageCount() != messageCount)) {
      category.setThreadCount(threadCount);
      category.setMessageCount(messageCount);
      MBCategoryLocalServiceUtil.updateMBCategory(category);
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Statistics verified for categories");
  }
  List<MBThread> threads=MBThreadLocalServiceUtil.getMBThreads(QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  if (_log.isDebugEnabled()) {
    _log.debug("Processing " + threads.size() + " threads for statistics accuracy");
  }
  for (  MBThread thread : threads) {
    int messageCount=MBMessageLocalServiceUtil.getThreadMessagesCount(thread.getThreadId(),WorkflowConstants.STATUS_APPROVED);
    if (thread.getMessageCount() != messageCount) {
      thread.setMessageCount(messageCount);
      MBThreadLocalServiceUtil.updateMBThread(thread);
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Statistics verified for threads");
  }
  List<MBMessage> messages=MBMessageLocalServiceUtil.getNoAssetMessages();
  if (_log.isDebugEnabled()) {
    _log.debug("Processing " + messages.size() + " messages with no asset");
  }
  for (  MBMessage message : messages) {
    try {
      MBMessageLocalServiceUtil.updateAsset(message.getUserId(),message,null,null);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to update asset for message " + message.getMessageId() + ": "+ e.getMessage());
      }
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Assets verified for messages");
  }
}
