{
  try (LoggingTimer loggingTimer=new LoggingTimer()){
    if (_log.isDebugEnabled()) {
      _log.debug("Processing categories for statistics accuracy");
    }
    ActionableDynamicQuery actionableDynamicQuery=MBCategoryLocalServiceUtil.getActionableDynamicQuery();
    actionableDynamicQuery.setParallel(true);
    actionableDynamicQuery.setPerformActionMethod(new ActionableDynamicQuery.PerformActionMethod<MBCategory>(){
      @Override public void performAction(      MBCategory category){
        int threadCount=MBThreadLocalServiceUtil.getCategoryThreadsCount(category.getGroupId(),category.getCategoryId(),WorkflowConstants.STATUS_APPROVED);
        int messageCount=MBMessageLocalServiceUtil.getCategoryMessagesCount(category.getGroupId(),category.getCategoryId(),WorkflowConstants.STATUS_APPROVED);
        if ((category.getThreadCount() != threadCount) || (category.getMessageCount() != messageCount)) {
          category.setThreadCount(threadCount);
          category.setMessageCount(messageCount);
          MBCategoryLocalServiceUtil.updateMBCategory(category);
        }
      }
    }
);
    actionableDynamicQuery.performActions();
    if (_log.isDebugEnabled()) {
      _log.debug("Statistics verified for categories");
    }
  }
 }
