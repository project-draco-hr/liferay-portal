{
  try (LoggingTimer loggingTimer=new LoggingTimer()){
    List<MBCategory> categories=MBCategoryLocalServiceUtil.getMBCategories(QueryUtil.ALL_POS,QueryUtil.ALL_POS);
    if (_log.isDebugEnabled()) {
      _log.debug("Processing " + categories.size() + " categories for statistics accuracy");
    }
    for (    MBCategory category : categories) {
      int threadCount=MBThreadLocalServiceUtil.getCategoryThreadsCount(category.getGroupId(),category.getCategoryId(),WorkflowConstants.STATUS_APPROVED);
      int messageCount=MBMessageLocalServiceUtil.getCategoryMessagesCount(category.getGroupId(),category.getCategoryId(),WorkflowConstants.STATUS_APPROVED);
      if ((category.getThreadCount() != threadCount) || (category.getMessageCount() != messageCount)) {
        category.setThreadCount(threadCount);
        category.setMessageCount(messageCount);
        MBCategoryLocalServiceUtil.updateMBCategory(category);
      }
    }
    if (_log.isDebugEnabled()) {
      _log.debug("Statistics verified for categories");
    }
  }
 }
