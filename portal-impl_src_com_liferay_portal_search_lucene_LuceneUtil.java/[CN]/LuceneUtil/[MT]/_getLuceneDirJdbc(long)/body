{
  JdbcDirectory directory=null;
  ClassLoader contextClassLoader=Thread.currentThread().getContextClassLoader();
  try {
    Thread.currentThread().setContextClassLoader(PortalClassLoaderUtil.getClassLoader());
    String tableName=_getTableName(companyId);
    directory=(JdbcDirectory)_jdbcDirectories.get(tableName);
    if (directory != null) {
      return directory;
    }
    try {
      DataSource ds=PortalJNDIUtil.getDataSource();
      directory=new JdbcDirectory(ds,_dialect,tableName);
      _jdbcDirectories.put(tableName,directory);
      if (!directory.tableExists()) {
        directory.create();
      }
    }
 catch (    IOException ioe) {
      throw new RuntimeException(ioe);
    }
catch (    NamingException ne) {
      throw new RuntimeException(ne);
    }
catch (    UnsupportedOperationException uoe) {
      if (_log.isWarnEnabled()) {
        _log.warn("Database doesn't support the ability to check " + "whether a table exists");
      }
      _manuallyCreateJdbcDirectory(directory,tableName);
    }
  }
  finally {
    Thread.currentThread().setContextClassLoader(contextClassLoader);
  }
  return directory;
}
