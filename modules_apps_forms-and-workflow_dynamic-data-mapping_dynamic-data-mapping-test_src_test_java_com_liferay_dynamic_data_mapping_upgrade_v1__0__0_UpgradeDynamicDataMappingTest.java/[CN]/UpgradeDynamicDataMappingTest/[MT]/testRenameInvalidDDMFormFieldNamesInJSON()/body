{
  long structureId=RandomTestUtil.randomLong();
  DDMForm ddmForm=DDMFormTestUtil.createDDMForm();
  DDMFormField ddmFormField=DDMFormTestUtil.createTextDDMFormField("name",false,false,false);
  ddmFormField.setProperty("oldName","name<!**>");
  ddmForm.addDDMFormField(ddmFormField);
  _upgradeDynamicDataMapping.populateStructureInvalidDDMFormFieldNamesMap(structureId,ddmForm);
  DDMFormValues ddmFormValues=DDMFormValuesTestUtil.createDDMFormValues(ddmForm);
  ddmFormValues.addDDMFormFieldValue(DDMFormValuesTestUtil.createUnlocalizedDDMFormFieldValue("name<!**>","Joe Bloggs"));
  String serializedDDMFormValues=_ddmFormValuesJSONSerializer.serialize(ddmFormValues);
  String updatedSerializedDDMFormValues=_upgradeDynamicDataMapping.renameInvalidDDMFormFieldNames(structureId,serializedDDMFormValues);
  DDMFormValues updatedDDMFormValues=_ddmFormValuesJSONDeserializer.deserialize(ddmForm,updatedSerializedDDMFormValues);
  List<DDMFormFieldValue> updatedDDMFormFieldValues=updatedDDMFormValues.getDDMFormFieldValues();
  Assert.assertEquals(1,updatedDDMFormFieldValues.size());
  DDMFormFieldValue updatedDDMFormFieldValue=updatedDDMFormFieldValues.get(0);
  Value value=updatedDDMFormFieldValue.getValue();
  Assert.assertEquals("name",updatedDDMFormFieldValue.getName());
  Assert.assertEquals("Joe Bloggs",value.getString(Locale.US));
}
