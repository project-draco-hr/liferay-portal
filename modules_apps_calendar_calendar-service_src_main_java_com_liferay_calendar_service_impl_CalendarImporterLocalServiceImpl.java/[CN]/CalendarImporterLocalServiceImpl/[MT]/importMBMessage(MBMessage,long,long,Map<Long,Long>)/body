{
  Long messageId=mbMessageIds.get(mbMessage.getMessageId());
  if (messageId != null) {
    return messageId;
  }
  messageId=counterLocalService.increment();
  addMBMessage(PortalUUIDUtil.generate(),messageId,mbMessage.getGroupId(),mbMessage.getCompanyId(),mbMessage.getUserId(),mbMessage.getUserName(),mbMessage.getCreateDate(),mbMessage.getModifiedDate(),classNameLocalService.getClassNameId(CalendarBooking.class.getName()),calendarBookingId,mbMessage.getCategoryId(),threadId,mbMessage.getRootMessageId(),mbMessage.getParentMessageId(),mbMessage.getSubject(),mbMessage.getBody(),mbMessage.getFormat(),mbMessage.isAnonymous(),mbMessage.getPriority(),mbMessage.getAllowPingbacks(),mbMessage.isAnswer(),mbMessage.getStatus(),mbMessage.getStatusByUserId(),mbMessage.getStatusByUserName(),mbMessage.getStatusDate(),mbMessageIds);
  long mbDiscussionClassNameId=classNameLocalService.getClassNameId(MBDiscussion.class.getName());
  importRatings(mbDiscussionClassNameId,mbMessage.getMessageId(),mbDiscussionClassNameId,messageId);
  mbMessageIds.put(mbMessage.getMessageId(),messageId);
  return messageId;
}
