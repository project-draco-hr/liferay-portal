{
  StringBuilder sb=new StringBuilder(getDesktopURL(req));
  if (Validator.isNotNull(query)) {
    sb.append(StringPool.QUESTION);
    sb.append(query);
  }
  String url=sb.toString();
  if (escape) {
    try {
      url=URLEncoder.encode(url,StringPool.UTF8);
    }
 catch (    UnsupportedEncodingException uee) {
    }
  }
  return url;
}
