{
  StringBuffer urlBuffer=new StringBuffer(getDesktopURL(_request));
  if (query != null && query.length() != 0) {
    urlBuffer.append("?").append(query);
  }
  String url=urlBuffer.toString();
  if (escape) {
    try {
      url=URLEncoder.encode(url,ENC);
    }
 catch (    UnsupportedEncodingException ex) {
    }
  }
  return url;
}
