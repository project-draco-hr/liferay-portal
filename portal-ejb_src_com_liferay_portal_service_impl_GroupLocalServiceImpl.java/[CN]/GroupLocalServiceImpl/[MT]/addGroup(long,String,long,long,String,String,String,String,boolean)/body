{
  User user=UserUtil.findByPrimaryKey(userId);
  long classNameId=PortalUtil.getClassNameId(className);
  if ((classNameId <= 0) || (classPK <= 0)) {
    validateName(0,user.getCompanyId(),name);
  }
  friendlyURL=getFriendlyURL(classNameId,friendlyURL);
  validateFriendlyURL(0,user.getCompanyId(),friendlyURL);
  long groupId=CounterLocalServiceUtil.increment();
  if ((classNameId > 0) && (classPK > 0)) {
    name=String.valueOf(groupId);
  }
  Group group=GroupUtil.create(groupId);
  group.setCompanyId(user.getCompanyId());
  group.setCreatorUserId(userId);
  group.setClassNameId(classNameId);
  group.setClassPK(classPK);
  group.setParentGroupId(GroupImpl.DEFAULT_PARENT_GROUP_ID);
  group.setLiveGroupId(liveGroupId);
  group.setName(name);
  group.setDescription(description);
  group.setType(type);
  group.setFriendlyURL(friendlyURL);
  group.setActive(active);
  GroupUtil.update(group);
  LayoutSetLocalServiceUtil.addLayoutSet(LayoutImpl.PRIVATE + groupId,group.getCompanyId());
  LayoutSetLocalServiceUtil.addLayoutSet(LayoutImpl.PUBLIC + groupId,group.getCompanyId());
  if ((classNameId <= 0) && (classPK <= 0) && !user.isDefaultUser()) {
    ResourceLocalServiceUtil.addResources(group.getCompanyId(),0,0,Group.class.getName(),group.getGroupId(),false,false,false);
    Role role=RoleLocalServiceUtil.getRole(group.getCompanyId(),RoleImpl.COMMUNITY_OWNER);
    UserGroupRoleLocalServiceUtil.addUserGroupRoles(userId,groupId,new long[]{role.getRoleId()});
    UserLocalServiceUtil.addGroupUsers(group.getGroupId(),new long[]{userId});
  }
  return group;
}
