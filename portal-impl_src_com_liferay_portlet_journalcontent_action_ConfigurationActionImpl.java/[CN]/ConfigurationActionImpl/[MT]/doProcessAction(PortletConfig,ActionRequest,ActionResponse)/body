{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  String portletResource=ParamUtil.getString(actionRequest,"portletResource");
  PortletPreferences preferences=actionRequest.getPreferences();
  String articleId=getArticleId(actionRequest);
  String originalArticleId=preferences.getValue("articleId",null);
  Portlet portlet=PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),portletResource);
  PortletLayoutListener portletLayoutListener=portlet.getPortletLayoutListenerInstance();
  if ((portletLayoutListener != null) && Validator.isNotNull(originalArticleId) && !originalArticleId.equals(articleId)) {
    portletLayoutListener.onRemoveFromLayout(portletResource,layout.getPlid());
  }
  super.processAction(portletConfig,actionRequest,actionResponse);
  if (SessionErrors.isEmpty(actionRequest) && (portletLayoutListener != null)) {
    portletLayoutListener.onAddToLayout(portletResource,layout.getPlid());
  }
}
