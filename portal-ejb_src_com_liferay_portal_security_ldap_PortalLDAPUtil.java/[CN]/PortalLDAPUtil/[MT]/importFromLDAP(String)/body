{
  if (!isImportEnabled(companyId)) {
    return;
  }
  LdapContext ctx=getContext(companyId);
  if (ctx == null) {
    return;
  }
  try {
    Properties userMappings=getUserMappings(companyId);
    Properties groupMappings=getGroupMappings(companyId);
    String baseDN=PrefsPropsUtil.getString(companyId,PropsUtil.LDAP_BASE_DN);
    String filter=PrefsPropsUtil.getString(companyId,PropsUtil.LDAP_IMPORT_SEARCH_FILTER);
    SearchControls cons=new SearchControls(SearchControls.SUBTREE_SCOPE,0,0,null,false,false);
    NamingEnumeration enu=ctx.search(baseDN,filter,cons);
    while (enu.hasMore()) {
      SearchResult result=(SearchResult)enu.next();
      _importFromLDAP(companyId,ctx,userMappings,groupMappings,baseDN,result);
    }
  }
 catch (  Exception e) {
    _log.error("Error importing LDAP users and groups",e);
  }
 finally {
    if (ctx != null) {
      ctx.close();
    }
  }
}
