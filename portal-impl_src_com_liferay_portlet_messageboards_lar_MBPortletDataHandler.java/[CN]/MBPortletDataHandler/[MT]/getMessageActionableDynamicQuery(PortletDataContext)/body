{
  final ExportActionableDynamicQuery messageActionableDynamicQuery=MBMessageLocalServiceUtil.getExportActionableDynamicQuery(portletDataContext);
  messageActionableDynamicQuery.setAddCriteriaMethod(new ActionableDynamicQuery.AddCriteriaMethod(){
    @Override public void addCriteria(    DynamicQuery dynamicQuery){
      Criterion modifiedDateCriterion=portletDataContext.getDateRangeCriteria("modifiedDate");
      Criterion statusDateCriterion=portletDataContext.getDateRangeCriteria("statusDate");
      if ((modifiedDateCriterion != null) && (statusDateCriterion != null)) {
        Disjunction disjunction=RestrictionsFactoryUtil.disjunction();
        disjunction.add(modifiedDateCriterion);
        disjunction.add(statusDateCriterion);
        dynamicQuery.add(disjunction);
      }
      Property classNameIdProperty=PropertyFactoryUtil.forName("classNameId");
      dynamicQuery.add(classNameIdProperty.eq(0L));
      Property workflowStatusProperty=PropertyFactoryUtil.forName("status");
      if (portletDataContext.isInitialPublication()) {
        dynamicQuery.add(workflowStatusProperty.ne(WorkflowConstants.STATUS_IN_TRASH));
      }
 else {
        StagedModelDataHandler<?> stagedModelDataHandler=StagedModelDataHandlerRegistryUtil.getStagedModelDataHandler(MBMessage.class.getName());
        dynamicQuery.add(workflowStatusProperty.in(stagedModelDataHandler.getExportableStatuses()));
      }
    }
  }
);
  return messageActionableDynamicQuery;
}
