{
  BackgroundTaskResult backgroundTaskResult=new BackgroundTaskResult();
  Map<String,Serializable> taskContextMap=backgroundTask.getTaskContextMap();
  List<AssetEntry> assetEntries=(List<AssetEntry>)taskContextMap.get("assetEntries");
  long companyId=GetterUtil.getLong(taskContextMap.get("companyId"));
  com.liferay.portal.kernel.model.PortletPreferences portletPreferencesModel=(com.liferay.portal.kernel.model.PortletPreferences)taskContextMap.get("portletPreferences");
  List<Subscription> subscriptions=SubscriptionLocalServiceUtil.getSubscriptions(companyId,com.liferay.portal.kernel.model.PortletPreferences.class.getName(),AssetPublisherUtil.getSubscriptionClassPK(portletPreferencesModel.getPlid(),portletPreferencesModel.getPortletId()));
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.fromXML(companyId,portletPreferencesModel.getOwnerId(),portletPreferencesModel.getOwnerType(),portletPreferencesModel.getPlid(),portletPreferencesModel.getPortletId(),portletPreferencesModel.getPreferences());
  for (  Subscription subscription : subscriptions) {
    AssetPublisherUtil.notifySubscriber(subscription.getUserId(),portletPreferences,filterAssetEntries(subscription.getUserId(),assetEntries));
  }
  try {
    portletPreferences.setValues("notifiedAssetEntryIds",StringUtil.split(ListUtil.toString(assetEntries,AssetEntry.ENTRY_ID_ACCESSOR)));
    portletPreferences.store();
    backgroundTaskResult.setStatus(BackgroundTaskConstants.STATUS_SUCCESSFUL);
  }
 catch (  IOException ioe) {
    backgroundTaskResult.setStatus(BackgroundTaskConstants.STATUS_FAILED);
    throw new SystemException(ioe);
  }
catch (  PortletException pe) {
    backgroundTaskResult.setStatus(BackgroundTaskConstants.STATUS_FAILED);
    throw new SystemException(pe);
  }
  return backgroundTaskResult;
}
