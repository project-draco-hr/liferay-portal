{
  if (fileName.indexOf(CharPool.SLASH) != -1) {
    return getDirNameDir(companyId,repositoryId,fileName);
  }
  String ext=StringPool.PERIOD + FileUtil.getExtension(fileName);
  if (ext.equals(StringPool.PERIOD)) {
    ext+=_HOOK_EXTENSION;
  }
  StringBundler sb=new StringBundler();
  String fileNameFragment=FileUtil.stripExtension(fileName);
  if (fileNameFragment.startsWith("DLFE-")) {
    fileNameFragment=fileNameFragment.substring(5);
    sb.append("DLFE/");
  }
  buildPath(sb,fileNameFragment);
  File repositoryDir=getRepositoryDir(companyId,repositoryId);
  StringBundler pathSB=new StringBundler(6);
  pathSB.append(repositoryDir);
  pathSB.append(StringPool.SLASH);
  pathSB.append(sb.toString());
  FileUtil.mkdirs(pathSB.toString());
  pathSB.append(StringPool.SLASH);
  pathSB.append(fileNameFragment);
  pathSB.append(ext);
  return new File(pathSB.toString());
}
