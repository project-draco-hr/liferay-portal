{
  AppConfigurationEntry[] aceArray=_config.getAppConfigurationEntry(name);
  if ((name != null) && !name.equals(JBOSS_LOGIN_MODULE)) {
    if (_log.isDebugEnabled()) {
      _log.debug(name);
    }
    Map options=null;
    if (aceArray == null || aceArray.length == 0) {
      options=new HashMap();
    }
 else {
      options=aceArray[0].getOptions();
    }
    AppConfigurationEntry ace=new AppConfigurationEntry(com.liferay.portal.kernel.security.jaas.PortalLoginModule.class.getName(),AppConfigurationEntry.LoginModuleControlFlag.SUFFICIENT,options);
    if (aceArray == null || aceArray.length == 0) {
      aceArray=new AppConfigurationEntry[]{ace};
    }
 else {
      AppConfigurationEntry[] newAceArray=new AppConfigurationEntry[aceArray.length + 1];
      if (name.equals(REALM_NAME)) {
        newAceArray[0]=ace;
        System.arraycopy(aceArray,0,newAceArray,1,aceArray.length);
      }
 else {
        newAceArray[aceArray.length]=ace;
        System.arraycopy(aceArray,0,newAceArray,0,aceArray.length);
      }
      aceArray=newAceArray;
      for (int i=0; i < newAceArray.length; i++) {
        if (newAceArray[i].getControlFlag().equals(AppConfigurationEntry.LoginModuleControlFlag.REQUIRED)) {
          newAceArray[i]=new AppConfigurationEntry(newAceArray[i].getLoginModuleName(),AppConfigurationEntry.LoginModuleControlFlag.SUFFICIENT,newAceArray[i].getOptions());
        }
        if (_log.isDebugEnabled()) {
          _log.debug(newAceArray[i].getLoginModuleName() + " " + newAceArray[i].getControlFlag());
        }
      }
    }
  }
  return aceArray;
}
