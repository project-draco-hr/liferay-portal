{
  ObjectValuePair<ClassLoader,TemplateContextType> cacheKey=new ObjectValuePair<ClassLoader,TemplateContextType>(contextClassLoader,templateContextType);
  Map<String,Object> helperUtilities=_helperUtilitiesCache.get(cacheKey);
  if (helperUtilities != null) {
    return helperUtilities;
  }
  helperUtilities=new HashMap<String,Object>();
  populateCommonHelperUtilities(helperUtilities);
  populateExtraHelperUtilities(helperUtilities);
  if (templateContextType.equals(TemplateContextType.RESTRICTED)) {
    Set<String> restrictedVariables=getRestrictedVariables();
    for (    String restrictedVariable : restrictedVariables) {
      helperUtilities.remove(restrictedVariable);
    }
  }
  helperUtilities=Collections.unmodifiableMap(helperUtilities);
  _helperUtilitiesCache.put(cacheKey,helperUtilities);
  return helperUtilities;
}
