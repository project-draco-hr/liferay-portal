{
  HelperUtilitiesMap helperUtilitiesMap=_helperUtilitiesMaps.get(classLoader);
  if (helperUtilitiesMap == null) {
    helperUtilitiesMap=new HelperUtilitiesMap(TemplateContextType.class);
    _helperUtilitiesMaps.put(classLoader,helperUtilitiesMap);
  }
  Map<String,Object> helperUtilities=helperUtilitiesMap.get(templateContextType);
  if (helperUtilities != null) {
    return helperUtilities;
  }
  helperUtilities=new HashMap<String,Object>();
  populateCommonHelperUtilities(helperUtilities);
  populateExtraHelperUtilities(helperUtilities);
  if (templateContextType.equals(TemplateContextType.RESTRICTED)) {
    Set<String> restrictedVariables=getRestrictedVariables();
    for (    String restrictedVariable : restrictedVariables) {
      helperUtilities.remove(restrictedVariable);
    }
  }
  helperUtilities=Collections.unmodifiableMap(helperUtilities);
  helperUtilitiesMap.put(templateContextType,helperUtilities);
  return helperUtilities;
}
