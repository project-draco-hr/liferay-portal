{
  EnumMap<TemplateContextType,Map<String,Object>> helperUtilitiesMap=_helperUtilitiesMapCache.get(contextClassLoader);
  if (helperUtilitiesMap == null) {
    helperUtilitiesMap=new EnumMap<TemplateContextType,Map<String,Object>>(TemplateContextType.class);
    _helperUtilitiesMapCache.put(contextClassLoader,helperUtilitiesMap);
  }
  Map<String,Object> helperUtilities=helperUtilitiesMap.get(templateContextType);
  if (helperUtilities != null) {
    return helperUtilities;
  }
  helperUtilities=new HashMap<String,Object>();
  populateCommonHelperUtilities(helperUtilities);
  populateExtraHelperUtilities(helperUtilities);
  if (templateContextType.equals(TemplateContextType.RESTRICTED)) {
    Set<String> restrictedVariables=getRestrictedVariables();
    for (    String restrictedVariable : restrictedVariables) {
      helperUtilities.remove(restrictedVariable);
    }
  }
  helperUtilities=Collections.unmodifiableMap(helperUtilities);
  helperUtilitiesMap.put(templateContextType,helperUtilities);
  return helperUtilities;
}
