{
  List<Long> newUserGroupIds=new ArrayList<Long>(attribute.size());
  for (int i=0; i < attribute.size(); i++) {
    String fullGroupDN=(String)attribute.get(i);
    Attributes groupAttributes=null;
    try {
      groupAttributes=PortalLDAPUtil.getGroupAttributes(ldapServerId,companyId,ldapContext,fullGroupDN);
    }
 catch (    NameNotFoundException nnfe) {
      _log.error("LDAP group not found with fullGroupDN " + fullGroupDN,nnfe);
      continue;
    }
    UserGroup userGroup=PortalLDAPImporter.importLDAPGroup(ldapServerId,companyId,ldapContext,groupAttributes,false);
    if (userGroup != null) {
      if (_log.isDebugEnabled()) {
        _log.debug("Adding " + userId + " to group "+ userGroup.getUserGroupId());
      }
      newUserGroupIds.add(userGroup.getUserGroupId());
    }
  }
  UserGroupLocalServiceUtil.setUserUserGroups(userId,ArrayUtil.toArray(newUserGroupIds.toArray(new Long[newUserGroupIds.size()])));
}
