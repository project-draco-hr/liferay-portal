{
  String fileName="OverrideCheckoutTest.txt";
  ServiceTestUtil.setUser(author);
  try {
    FileEntry fileEntry=createFileEntry(fileName);
    long fileEntryId=fileEntry.getFileEntryId();
    DLAppServiceUtil.checkOutFileEntry(fileEntryId,_serviceContext);
    ServiceTestUtil.setUser(overrider);
    try {
      DLAppServiceUtil.cancelCheckOut(fileEntryId);
      if (!expectOverride) {
        Assert.fail("Should not have succeeded cancel check out");
      }
    }
 catch (    Exception e) {
      if (expectOverride) {
        Assert.fail("Should not have failed cancel check out " + e);
      }
    }
    if (expectOverride) {
      ServiceTestUtil.setUser(author);
      DLAppServiceUtil.checkOutFileEntry(fileEntryId,_serviceContext);
      updateFileEntry(fileEntryId,fileName);
      ServiceTestUtil.setUser(overrider);
    }
    try {
      DLAppServiceUtil.checkInFileEntry(fileEntryId,false,StringPool.NULL,_serviceContext);
      if (!expectOverride) {
        Assert.fail("Should not have succeeded check in");
      }
      fileEntry=DLAppServiceUtil.getFileEntry(fileEntryId);
      Assert.assertEquals("1.1",fileEntry.getVersion());
    }
 catch (    Exception e) {
      if (expectOverride) {
        Assert.fail("Should not have failed check in " + e);
      }
    }
  }
  finally {
    ServiceTestUtil.setUser(TestPropsValues.getUser());
  }
}
