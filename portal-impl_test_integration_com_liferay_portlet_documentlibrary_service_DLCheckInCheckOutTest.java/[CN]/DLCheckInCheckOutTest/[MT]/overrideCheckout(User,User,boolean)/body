{
  ServiceTestUtil.setUser(authorUser);
  try {
    String fileName="OverrideCheckoutTest.txt";
    FileEntry fileEntry=createFileEntry(fileName);
    long fileEntryId=fileEntry.getFileEntryId();
    Folder folder=DLAppServiceUtil.getFolder(_folder.getFolderId());
    Date lastPostDate=folder.getLastPostDate();
    DLAppServiceUtil.checkOutFileEntry(fileEntryId,_serviceContext);
    ServiceTestUtil.setUser(overriderUser);
    try {
      DLAppServiceUtil.cancelCheckOut(fileEntryId);
      if (!expectOverride) {
        Assert.fail("Should not have succeeded cancel check out");
      }
    }
 catch (    Exception e) {
      if (expectOverride) {
        Assert.fail("Should not have failed cancel check out " + e);
      }
    }
    if (expectOverride) {
      ServiceTestUtil.setUser(authorUser);
      DLAppServiceUtil.checkOutFileEntry(fileEntryId,_serviceContext);
      updateFileEntry(fileEntryId,fileName);
      ServiceTestUtil.setUser(overriderUser);
    }
    try {
      DLAppServiceUtil.checkInFileEntry(fileEntryId,false,StringPool.NULL,_serviceContext);
      if (!expectOverride) {
        Assert.fail("Should not have succeeded check in");
      }
      folder=DLAppServiceUtil.getFolder(_folder.getFolderId());
      Assert.assertTrue(lastPostDate.before(folder.getLastPostDate()));
      fileEntry=DLAppServiceUtil.getFileEntry(fileEntryId);
      Assert.assertEquals("1.1",fileEntry.getVersion());
    }
 catch (    Exception e) {
      if (expectOverride) {
        Assert.fail("Should not have failed check in " + e);
      }
    }
  }
  finally {
    ServiceTestUtil.setUser(TestPropsValues.getUser());
  }
}
