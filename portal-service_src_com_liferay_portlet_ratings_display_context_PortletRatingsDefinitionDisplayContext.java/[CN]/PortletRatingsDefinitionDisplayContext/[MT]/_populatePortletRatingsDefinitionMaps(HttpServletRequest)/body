{
  Map<String,PortletRatingsDefinitionValues> portletRatingsDefinitionValuesMap=PortletRatingsDefinitionUtil.getPortletRatingsDefinitionValuesMap();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PortletPreferences companyPortletPreferences=PrefsPropsUtil.getPreferences(themeDisplay.getCompanyId());
  Group liveGroup=(Group)request.getAttribute("site.liveGroup");
  UnicodeProperties groupTypeSettings=new UnicodeProperties();
  if (liveGroup != null) {
    groupTypeSettings=liveGroup.getTypeSettingsProperties();
  }
  for (  String className : portletRatingsDefinitionValuesMap.keySet()) {
    PortletRatingsDefinitionValues portletRatingsDefinitionValues=portletRatingsDefinitionValuesMap.get(className);
    if (portletRatingsDefinitionValues == null) {
      continue;
    }
    String propertyKey=RatingsDataTransformerUtil.getPropertyKey(className);
    RatingsType defaultRatingsType=portletRatingsDefinitionValues.getDefaultRatingsType();
    Map<String,RatingsType> ratingsTypeMap=new HashMap<>();
    String companyRatingsTypeString=PrefsParamUtil.getString(companyPortletPreferences,request,propertyKey,defaultRatingsType.getValue());
    ratingsTypeMap.put(className,RatingsType.parse(companyRatingsTypeString));
    String portletId=portletRatingsDefinitionValues.getPortletId();
    _companyPortletRatingsDefinitionMap.put(portletId,ratingsTypeMap);
    String groupRatingsTypeString=PropertiesParamUtil.getString(groupTypeSettings,request,propertyKey,companyRatingsTypeString);
    ratingsTypeMap.put(className,RatingsType.parse(groupRatingsTypeString));
    _groupPortletRatingsDefinitionMap.put(portletId,ratingsTypeMap);
  }
}
