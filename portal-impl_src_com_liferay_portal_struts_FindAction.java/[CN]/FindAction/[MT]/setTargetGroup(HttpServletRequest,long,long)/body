{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  Group targetGroup=GroupLocalServiceUtil.getGroup(groupId);
  if ((groupId == layout.getGroupId()) || (targetGroup.getParentGroupId() == layout.getGroupId()) || (layout.isPrivateLayout() && !SitesUtil.isUserGroupLayoutSetViewable(permissionChecker,layout.getGroup()))) {
    return;
  }
  layout=new VirtualLayout(layout,targetGroup);
  request.setAttribute(WebKeys.LAYOUT,layout);
}
