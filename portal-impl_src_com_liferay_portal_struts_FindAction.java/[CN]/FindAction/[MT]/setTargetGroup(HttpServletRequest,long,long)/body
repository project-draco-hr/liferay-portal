{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  long layoutGroupId=layout.getGroupId();
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  long parentGroupId=group.getParentGroupId();
  if ((groupId == layoutGroupId) || (parentGroupId == layoutGroupId) || (layout.isPrivateLayout() && !SitesUtil.isUserGroupLayoutSetViewable(permissionChecker,layout.getGroup()))) {
    return;
  }
  Group targetGroup=GroupLocalServiceUtil.getGroup(groupId);
  layout=new VirtualLayout(layout,targetGroup);
  request.setAttribute(WebKeys.LAYOUT,layout);
}
