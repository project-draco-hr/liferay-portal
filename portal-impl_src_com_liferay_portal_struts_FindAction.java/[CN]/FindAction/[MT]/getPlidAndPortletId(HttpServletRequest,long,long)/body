{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long groupId=ParamUtil.getLong(request,"groupId",themeDisplay.getScopeGroupId());
  if (primaryKey > 0) {
    try {
      groupId=getGroupId(primaryKey);
    }
 catch (    Exception e) {
      if (_log.isDebugEnabled()) {
        _log.debug(e,e);
      }
    }
  }
  if ((plid != LayoutConstants.DEFAULT_PLID) && (groupId == themeDisplay.getScopeGroupId())) {
    try {
      Layout layout=LayoutLocalServiceUtil.getLayout(plid);
      LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
      for (      String portletId : _portletIds) {
        if (!layoutTypePortlet.hasPortletId(portletId) || !LayoutPermissionUtil.contains(permissionChecker,layout,ActionKeys.VIEW)) {
          continue;
        }
        portletId=getPortletId(layoutTypePortlet,portletId);
        return new Object[]{plid,portletId};
      }
    }
 catch (    NoSuchLayoutException nsle) {
    }
  }
  return fetchPlidAndPortletId(permissionChecker,groupId);
}
