{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  String ownerId=Layout.getOwnerId(themeDisplay.getPlid());
  String groupId=Layout.getGroupId(ownerId);
  String portletResource=ParamUtil.getString(req,"portletResource");
  String resourcePrimKey=themeDisplay.getPlid() + Portlet.LAYOUT_SEPARATOR + portletResource;
  if (!permissionChecker.hasPermission(groupId,portletResource,resourcePrimKey,ActionKeys.CONFIGURATION) && !GroupPermission.contains(permissionChecker,groupId,ActionKeys.MANAGE_LAYOUTS)) {
    throw new PrincipalException();
  }
}
