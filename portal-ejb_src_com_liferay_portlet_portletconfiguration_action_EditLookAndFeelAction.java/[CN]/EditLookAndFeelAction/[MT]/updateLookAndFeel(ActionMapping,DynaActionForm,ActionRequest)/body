{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  String portletResource=ParamUtil.getString(req,"portletResource");
  checkPermissions(req);
  PortletPreferences portletSetup=PortletPreferencesFactory.getPortletSetup(req,portletResource,true,true);
  String title=ParamUtil.getString(req,"title");
  boolean showBorders=ParamUtil.getBoolean(req,"showBorders");
  if (cmd.equals(Constants.RESET)) {
    form.initialize(mapping);
    title=StringPool.BLANK;
    showBorders=true;
  }
  StringBuffer sb=new StringBuffer();
  Map styleMap=form.getMap();
  Iterator itr=styleMap.keySet().iterator();
  while (itr.hasNext()) {
    String key=(String)itr.next();
    if (!key.startsWith("list")) {
      String value=form.getString(key);
      if (Validator.isNotNull(value)) {
        sb.append(key + "=" + value+ "\n");
      }
    }
  }
  portletSetup.setValue("portlet-setup-title",title);
  portletSetup.setValue("portlet-setup-show-borders",String.valueOf(showBorders));
  portletSetup.setValue("portlet-setup-css",sb.toString());
  portletSetup.store();
}
