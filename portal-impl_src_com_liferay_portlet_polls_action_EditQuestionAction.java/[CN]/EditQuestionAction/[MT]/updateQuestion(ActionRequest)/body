{
  Layout layout=(Layout)req.getAttribute(WebKeys.LAYOUT);
  long questionId=ParamUtil.getLong(req,"questionId");
  String title=ParamUtil.getString(req,"title");
  String description=ParamUtil.getString(req,"description");
  int expirationDateMonth=ParamUtil.getInteger(req,"expirationDateMonth");
  int expirationDateDay=ParamUtil.getInteger(req,"expirationDateDay");
  int expirationDateYear=ParamUtil.getInteger(req,"expirationDateYear");
  int expirationDateHour=ParamUtil.getInteger(req,"expirationDateHour");
  int expirationDateMinute=ParamUtil.getInteger(req,"expirationDateMinute");
  int expirationDateAmPm=ParamUtil.getInteger(req,"expirationDateAmPm");
  boolean neverExpire=ParamUtil.getBoolean(req,"neverExpire");
  if (expirationDateAmPm == Calendar.PM) {
    expirationDateHour+=12;
  }
  List<PollsChoice> choices=new ArrayList<PollsChoice>();
  Enumeration<String> enu=req.getParameterNames();
  while (enu.hasMoreElements()) {
    String param=enu.nextElement();
    if (param.startsWith(CHOICE_DESCRIPTION_PREFIX)) {
      try {
        String id=param.substring(CHOICE_DESCRIPTION_PREFIX.length(),param.length());
        String choiceName=ParamUtil.getString(req,CHOICE_NAME_PREFIX + id);
        String choiceDescription=ParamUtil.getString(req,param);
        PollsChoice choice=PollsChoiceUtil.create(0);
        choice.setName(choiceName);
        choice.setDescription(choiceDescription);
        choices.add(choice);
      }
 catch (      Exception e) {
      }
    }
  }
  String[] communityPermissions=req.getParameterValues("communityPermissions");
  String[] guestPermissions=req.getParameterValues("guestPermissions");
  if (questionId <= 0) {
    PollsQuestionServiceUtil.addQuestion(layout.getPlid(),title,description,expirationDateMonth,expirationDateDay,expirationDateYear,expirationDateHour,expirationDateMinute,neverExpire,choices,communityPermissions,guestPermissions);
  }
 else {
    PollsQuestionServiceUtil.updateQuestion(questionId,title,description,expirationDateMonth,expirationDateDay,expirationDateYear,expirationDateHour,expirationDateMinute,neverExpire,choices);
  }
}
