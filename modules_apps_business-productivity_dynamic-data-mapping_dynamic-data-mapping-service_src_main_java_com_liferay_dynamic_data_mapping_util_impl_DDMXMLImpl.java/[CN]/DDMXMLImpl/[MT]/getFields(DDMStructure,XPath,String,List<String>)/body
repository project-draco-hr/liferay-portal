{
  Document document=null;
  try {
    document=SAXReaderUtil.read(xml);
  }
 catch (  DocumentException de) {
    if (_log.isDebugEnabled()) {
      _log.debug(de.getMessage(),de);
    }
    return null;
  }
  if ((xPath != null) && !xPath.booleanValueOf(document)) {
    return null;
  }
  Fields fields=new Fields();
  Element rootElement=document.getRootElement();
  List<Element> dynamicElementElements=rootElement.elements("dynamic-element");
  for (  Element dynamicElementElement : dynamicElementElements) {
    String fieldName=dynamicElementElement.attributeValue("name");
    if (!structure.hasField(fieldName) || ((fieldNames != null) && !fieldNames.contains(fieldName))) {
      continue;
    }
    String fieldDataType=structure.getFieldDataType(fieldName);
    List<Element> dynamicContentElements=dynamicElementElement.elements("dynamic-content");
    for (    Element dynamicContentElement : dynamicContentElements) {
      String fieldValue=dynamicContentElement.getText();
      String languageId=dynamicContentElement.attributeValue("language-id");
      Locale locale=LocaleUtil.fromLanguageId(languageId);
      Serializable fieldValueSerializable=FieldConstants.getSerializable(fieldDataType,fieldValue);
      Field field=fields.get(fieldName);
      if (field == null) {
        field=new Field();
        String defaultLanguageId=dynamicElementElement.attributeValue("default-language-id");
        if (Validator.isNull(defaultLanguageId)) {
          defaultLanguageId=rootElement.attributeValue("default-locale");
        }
        Locale defaultLocale=LocaleUtil.fromLanguageId(defaultLanguageId);
        field.setDefaultLocale(defaultLocale);
        field.setDDMStructureId(structure.getStructureId());
        field.setName(fieldName);
        field.setValue(locale,fieldValueSerializable);
        fields.put(field);
      }
 else {
        field.addValue(locale,fieldValueSerializable);
      }
    }
  }
  return fields;
}
