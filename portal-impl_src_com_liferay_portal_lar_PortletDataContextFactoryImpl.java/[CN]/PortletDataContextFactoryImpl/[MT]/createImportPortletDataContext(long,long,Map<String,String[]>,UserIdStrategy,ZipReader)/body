{
  PortletDataContext portletDataContext=new PortletDataContextImpl();
  portletDataContext.setCompanyId(companyId);
  try {
    Group companyGroup=GroupLocalServiceUtil.getCompanyGroup(companyId);
    portletDataContext.setCompanyGroupId(companyGroup.getGroupId());
  }
 catch (  Exception e) {
    throw new IllegalStateException(e);
  }
  portletDataContext.setGroupId(groupId);
  portletDataContext.setScopeGroupId(groupId);
  portletDataContext.setNewLayouts(new ArrayList<Layout>());
  portletDataContext.setParameterMap(parameterMap);
  String dataStrategy=MapUtil.getString(parameterMap,PortletDataHandlerKeys.DATA_STRATEGY,PortletDataHandlerKeys.DATA_STRATEGY_MIRROR);
  portletDataContext.setDataStrategy(dataStrategy);
  portletDataContext.setUserIdStrategy(userIdStrategy);
  portletDataContext.setZipReader(zipReader);
  return portletDataContext;
}
