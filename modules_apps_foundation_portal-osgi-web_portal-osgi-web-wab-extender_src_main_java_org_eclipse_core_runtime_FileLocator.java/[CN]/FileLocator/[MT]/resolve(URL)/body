{
  String protocol=url.getProtocol();
  _lock.lock();
  try {
    if (_serviceTrackerMap == null) {
      Bundle bundle=FrameworkUtil.getBundle(FileLocator.class);
      _serviceTrackerMap=ServiceTrackerMapFactory.openSingleValueMap(bundle.getBundleContext(),URLConverter.class,"protocol");
    }
    URLConverter converter=_serviceTrackerMap.getService(protocol);
    if (converter == null) {
      return url;
    }
    return converter.resolve(url);
  }
  finally {
    _lock.unlock();
  }
}
