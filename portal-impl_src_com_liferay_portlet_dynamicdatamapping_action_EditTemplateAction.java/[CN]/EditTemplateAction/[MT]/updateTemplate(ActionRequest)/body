{
  UploadPortletRequest uploadRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  long templateId=ParamUtil.getLong(uploadRequest,"templateId");
  long groupId=ParamUtil.getLong(uploadRequest,"groupId");
  String structureKey=ParamUtil.getString(uploadRequest,"structureKey");
  String name=ParamUtil.getString(uploadRequest,"name");
  String description=ParamUtil.getString(uploadRequest,"description");
  String type=ParamUtil.getString(uploadRequest,"type");
  String language=ParamUtil.getString(uploadRequest,"language",DDMTemplateConstants.LANG_TYPE_VM);
  String script=ParamUtil.getString(uploadRequest,"script");
  String scriptContent=JS.decodeURIComponent(ParamUtil.getString(uploadRequest,"scriptContent"));
  if (Validator.isNull(script)) {
    script=scriptContent;
  }
  ServiceContext serviceContext=ServiceContextFactory.getInstance(DDMTemplate.class.getName(),actionRequest);
  DDMTemplate template=null;
  if (templateId <= 0) {
    DDMStructure structure=DDMStructureLocalServiceUtil.getStructure(groupId,structureKey);
    template=DDMTemplateServiceUtil.addTemplate(groupId,structure.getStructureId(),name,description,type,language,script,serviceContext);
  }
 else {
    template=DDMTemplateServiceUtil.updateTemplate(templateId,name,description,type,language,script,serviceContext);
  }
  return template;
}
