{
  String registrationHandle=KeyGenerator.generateKey();
  String consumerModes=StringUtil.merge(registrationRecord.getConsumerModes());
  String consumerWindowStates=StringUtil.merge(registrationRecord.getConsumerWindowStates());
  String customUserProfileData=StringUtil.merge(registrationRecord.getCustomUserProfileData());
  String consumerUserScopes=StringUtil.merge(registrationRecord.getConsumerUserScopes());
  String registrationProperties=null;
  String lifeTime=null;
  if (registrationRecord.getLifetime() != null) {
    LeaseTime leaseTime=registrationRecord.getLifetime();
    XMLGregorianCalendar terminationTime=leaseTime.getTerminationTime();
    if (terminationTime != null) {
      lifeTime=terminationTime.toXMLFormat();
    }
  }
  try {
    WSRPConsumerRegistrationLocalServiceUtil.addConsumerRegistration(registrationRecord.getConsumerName(),true,registrationHandle,registrationRecord.getConsumerAgent(),registrationRecord.isMethodGetSupported(),consumerModes,consumerWindowStates,consumerUserScopes,customUserProfileData,registrationProperties,lifeTime,_producerModel.getInstanceName());
  }
 catch (  Exception e) {
    throw new ProducerException(e);
  }
  return registrationHandle;
}
