{
  SearchContext searchContext=new SearchContext();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  searchContext.setCompanyId(themeDisplay.getCompanyId());
  searchContext.setGroupIds(new long[]{themeDisplay.getScopeGroupId()});
  searchContext.setLayout(themeDisplay.getLayout());
  searchContext.setLocale(themeDisplay.getLocale());
  searchContext.setTimeZone(themeDisplay.getTimeZone());
  searchContext.setUserId(themeDisplay.getUserId());
  Map<String,Serializable> attributes=new HashMap<>();
  Map<String,String[]> parameters=request.getParameterMap();
  for (  Map.Entry<String,String[]> entry : parameters.entrySet()) {
    String name=entry.getKey();
    String[] values=entry.getValue();
    if (ArrayUtil.isNotEmpty(values)) {
      if (values.length == 1) {
        attributes.put(name,values[0]);
      }
 else {
        attributes.put(name,values);
      }
    }
  }
  if (!parameters.containsKey("groupId")) {
    String[] scopes=parameters.get("scope");
    if (scopes != null) {
      String groupId="0";
      if (Validator.equals(scopes[0],"this-site")) {
        groupId=String.valueOf(themeDisplay.getScopeGroupId());
      }
      attributes.put("groupId",groupId);
    }
  }
  searchContext.setAttributes(attributes);
  long[] assetCategoryIds=StringUtil.split(ParamUtil.getString(request,"assetCategoryIds"),0L);
  String[] assetTagNames=StringUtil.split(ParamUtil.getString(request,"assetTagNames"));
  searchContext.setAssetCategoryIds(assetCategoryIds);
  searchContext.setAssetTagNames(assetTagNames);
  String keywords=ParamUtil.getString(request,"keywords");
  searchContext.setKeywords(keywords);
  QueryConfig queryConfig=searchContext.getQueryConfig();
  queryConfig.setLocale(themeDisplay.getLocale());
  return searchContext;
}
