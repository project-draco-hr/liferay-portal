{
  MBMessage rootMessage=MBMessageUtil.findByPrimaryKey(thread.getRootMessageId());
  try {
    Indexer.deleteMessages(rootMessage.getCompanyId(),thread.getThreadId());
  }
 catch (  IOException ioe) {
    _log.error("Deleting index " + thread.getThreadId(),ioe);
  }
catch (  ParseException pe) {
    _log.error("Deleting index " + thread.getThreadId(),pe);
  }
  long companyId=rootMessage.getCompanyId();
  String portletId=CompanyImpl.SYSTEM_STRING;
  String repositoryId=CompanyImpl.SYSTEM_STRING;
  String dirName=thread.getAttachmentsDir();
  try {
    DLServiceUtil.deleteDirectory(companyId,portletId,repositoryId,dirName);
  }
 catch (  NoSuchDirectoryException nsde) {
  }
catch (  RemoteException re) {
    throw new SystemException(re);
  }
  Iterator itr=MBMessageUtil.findByThreadId(thread.getThreadId()).iterator();
  while (itr.hasNext()) {
    MBMessage message=(MBMessage)itr.next();
    TagsAssetLocalServiceUtil.deleteAsset(MBMessage.class.getName(),String.valueOf(message.getMessageId()));
    MBMessageFlagUtil.removeByMessageId(message.getMessageId());
    if (!message.isDiscussion()) {
      ResourceLocalServiceUtil.deleteResource(message.getCompanyId(),MBMessage.class.getName(),ResourceImpl.SCOPE_INDIVIDUAL,message.getMessageId());
    }
    MBMessageUtil.remove(message.getMessageId());
  }
  MBThreadUtil.remove(thread.getThreadId());
}
