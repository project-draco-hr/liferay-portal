{
  long classNameId=PortalUtil.getClassNameId(templateHandler.getClassName());
  ServiceContext serviceContext=new ServiceContext();
  long companyId=PortalUtil.getDefaultCompanyId();
  Group group=GroupLocalServiceUtil.getCompanyGroup(companyId);
  serviceContext.setScopeGroupId(group.getGroupId());
  long userId=UserLocalServiceUtil.getDefaultUserId(companyId);
  serviceContext.setUserId(userId);
  List<Element> templateElements=templateHandler.getDefaultTemplateElements();
  for (  Element templateElement : templateElements) {
    String templateKey=templateElement.elementText("template-key");
    DDMTemplate ddmTemplate=DDMTemplateLocalServiceUtil.fetchTemplate(group.getGroupId(),classNameId,templateKey);
    if (ddmTemplate != null) {
      continue;
    }
    Class<?> clazz=templateHandler.getClass();
    ClassLoader classLoader=clazz.getClassLoader();
    Map<Locale,String> nameMap=_getLocalizationMap(classLoader,group.getGroupId(),templateElement.elementText("name"));
    Map<Locale,String> descriptionMap=_getLocalizationMap(classLoader,group.getGroupId(),templateElement.elementText("description"));
    String language=templateElement.elementText("language");
    String scriptFileName=templateElement.elementText("script-file");
    String script=StringUtil.read(classLoader,scriptFileName);
    boolean cacheable=GetterUtil.getBoolean(templateElement.elementText("cacheable"));
    DDMTemplateLocalServiceUtil.addTemplate(userId,group.getGroupId(),classNameId,0,PortalUtil.getClassNameId("com.liferay.portlet.display" + ".template.service.PortletDisplayTemplate"),templateKey,nameMap,descriptionMap,DDMTemplateConstants.TEMPLATE_TYPE_DISPLAY,null,language,script,cacheable,false,null,null,serviceContext);
  }
}
