{
  long companyId=PortalUtil.getDefaultCompanyId();
  ServiceContext serviceContext=new ServiceContext();
  Group group=GroupLocalServiceUtil.getCompanyGroup(companyId);
  serviceContext.setScopeGroupId(group.getGroupId());
  long userId=UserLocalServiceUtil.getDefaultUserId(companyId);
  serviceContext.setUserId(userId);
  long classNameId=PortalUtil.getClassNameId(templateHandler.getClassName());
  List<Element> templateElements=templateHandler.getDefaultTemplateElements();
  for (  Element templateElement : templateElements) {
    String templateKey=templateElement.elementText("template-key");
    DDMTemplate ddmTemplate=DDMTemplateLocalServiceUtil.fetchTemplate(group.getGroupId(),classNameId,templateKey);
    if (ddmTemplate != null) {
      continue;
    }
    Map<Locale,String> nameMap=_getLocalizationMap(group.getGroupId(),templateElement.elementText("name"));
    Map<Locale,String> descriptionMap=_getLocalizationMap(group.getGroupId(),templateElement.elementText("description"));
    String language=templateElement.elementText("language");
    String scriptFileName=templateElement.elementText("script-file");
    Class<?> clazz=templateHandler.getClass();
    ClassLoader classLoader=clazz.getClassLoader();
    String script=StringUtil.read(classLoader,scriptFileName);
    boolean cacheable=GetterUtil.getBoolean(templateElement.elementText("cacheable"));
    DDMTemplateLocalServiceUtil.addTemplate(userId,group.getGroupId(),classNameId,0,PortalUtil.getClassNameId(PortletDisplayTemplate.class),templateKey,nameMap,descriptionMap,DDMTemplateConstants.TEMPLATE_TYPE_DISPLAY,null,language,script,cacheable,false,null,null,serviceContext);
  }
}
