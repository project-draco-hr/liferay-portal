{
  String productId=licenseProperties.get("productId");
  if (Validator.isNull(productId)) {
    return 0;
  }
  String productVersion=licenseProperties.get("productVersion");
  String userCount=licenseProperties.get("userCount");
  String randomUuid=UUID.randomUUID().toString();
  try {
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    byte[] serverIdBytes=LicenseUtil.getServerIdBytes();
    jsonObject.put("cmd","GET_LICENSE_STATE");
    jsonObject.put("productId",productId);
    jsonObject.put("productVersion",productVersion);
    jsonObject.put("randomUuid",randomUuid);
    jsonObject.put("serverId",Arrays.toString(serverIdBytes));
    jsonObject.put("userCount",userCount);
    jsonObject.put("version",2);
    String response=LicenseUtil.sendRequest(jsonObject.toString());
    JSONObject responseJSONObject=JSONFactoryUtil.createJSONObject(response);
    String errorMessage=responseJSONObject.getString("errorMessage");
    if (Validator.isNotNull(errorMessage)) {
      throw new Exception(errorMessage);
    }
    int licenseState=responseJSONObject.getInt("licenseState");
    String responseRandomUuid=responseJSONObject.getString("randomUuid");
    if (responseRandomUuid.equals(randomUuid)) {
      return licenseState;
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  return 0;
}
