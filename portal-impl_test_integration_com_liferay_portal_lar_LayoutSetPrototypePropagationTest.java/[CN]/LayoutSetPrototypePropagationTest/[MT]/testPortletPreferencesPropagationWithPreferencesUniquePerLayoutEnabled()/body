{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(TestPropsValues.getCompanyId(),PortletKeys.NAVIGATION);
  portlet.setPreferencesUniquePerLayout(false);
  Layout layoutSetPrototypeLayout=LayoutTestUtil.addLayout(_layoutSetPrototypeGroup.getGroupId(),ServiceTestUtil.randomString(),true,layoutPrototype,true);
  Map<String,String[]> preferenceMap=new HashMap<String,String[]>();
  preferenceMap.put("bulletStyle",new String[]{"Dots"});
  String navigationPortletId1=LayoutTestUtil.addPortletToLayout(TestPropsValues.getUserId(),layoutSetPrototypeLayout,PortletKeys.NAVIGATION,"column-1",preferenceMap);
  preferenceMap.put("bulletStyle",new String[]{"Arrows"});
  String navigationPortletId2=LayoutTestUtil.addPortletToLayout(TestPropsValues.getUserId(),layoutSetPrototypeLayout,PortletKeys.NAVIGATION,"column-2",preferenceMap);
  propagateChanges(group);
  Layout layout=LayoutLocalServiceUtil.getFriendlyURLLayout(group.getGroupId(),false,layoutSetPrototypeLayout.getFriendlyURL());
  PortletPreferences navigationPortletIdPortletPreferences=PortletPreferencesFactoryUtil.getPortletSetup(group.getGroupId(),layout,PortletKeys.NAVIGATION,null);
  Assert.assertEquals("Arrows",navigationPortletIdPortletPreferences.getValue("bulletStyle",StringPool.BLANK));
  PortletPreferences navigationPortletId1PortletPreferences=PortletPreferencesFactoryUtil.getPortletSetup(layout,navigationPortletId1,null);
  Assert.assertEquals("Arrows",navigationPortletId1PortletPreferences.getValue("bulletStyle",StringPool.BLANK));
  PortletPreferences navigationPortletId2PortletPreferences=PortletPreferencesFactoryUtil.getPortletSetup(layout,navigationPortletId2,null);
  Assert.assertEquals("Arrows",navigationPortletId2PortletPreferences.getValue("bulletStyle",StringPool.BLANK));
}
