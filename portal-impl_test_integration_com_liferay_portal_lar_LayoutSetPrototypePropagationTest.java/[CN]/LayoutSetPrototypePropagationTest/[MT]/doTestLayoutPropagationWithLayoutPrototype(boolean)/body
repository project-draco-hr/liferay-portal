{
  MergeLayoutPrototypesThreadLocal.clearMergeComplete();
  Layout layoutSetPrototypeLayout=LayoutTestUtil.addLayout(_layoutSetPrototypeGroup.getGroupId(),ServiceTestUtil.randomString(),true,layoutPrototype,layoutSetLayoutLinkEnabled);
  layoutSetPrototypeLayout=propagateChanges(layoutSetPrototypeLayout);
  propagateChanges(group);
  Layout layout=LayoutLocalServiceUtil.getFriendlyURLLayout(group.getGroupId(),false,layoutSetPrototypeLayout.getFriendlyURL());
  LayoutTestUtil.updateLayoutTemplateId(layoutPrototypeLayout,"1_column");
  if (layoutSetLayoutLinkEnabled) {
    Assert.assertEquals(initialLayoutTemplateId,LayoutTestUtil.getLayoutTemplateId(layout));
  }
  layout=propagateChanges(layout);
  propagateChanges(group);
  if (layoutSetLayoutLinkEnabled) {
    Assert.assertEquals("1_column",LayoutTestUtil.getLayoutTemplateId(layout));
  }
 else {
    Assert.assertEquals(initialLayoutTemplateId,LayoutTestUtil.getLayoutTemplateId(layout));
  }
}
