{
  if (_log.isDebugEnabled()) {
    PortletRequestUtil.testMultipartWithCommonsFileUpload(actionRequest);
  }
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  User user=PortalUtil.getSelectedUser(uploadPortletRequest);
  InputStream inputStream=null;
  try {
    inputStream=uploadPortletRequest.getFileAsStream("fileName");
    if (inputStream == null) {
      throw new UploadException("No logo uploaded.");
    }
    byte[] bytes=FileUtil.getBytes(inputStream);
    UserServiceUtil.updatePortrait(user.getUserId(),bytes);
  }
  finally {
    StreamUtil.cleanUp(inputStream);
  }
}
