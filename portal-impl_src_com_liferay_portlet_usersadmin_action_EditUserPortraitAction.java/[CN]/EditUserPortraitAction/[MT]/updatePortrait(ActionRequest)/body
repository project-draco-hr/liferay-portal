{
  if (_log.isDebugEnabled()) {
    PortletRequestUtil.testMultipartWithCommonsFileUpload(actionRequest);
  }
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  User user=PortalUtil.getSelectedUser(uploadPortletRequest);
  File file=uploadPortletRequest.getFile("fileName");
  byte[] bytes=FileUtil.getBytes(file);
  if ((bytes == null) || (bytes.length == 0)) {
    throw new UploadException();
  }
  UserServiceUtil.updatePortrait(user.getUserId(),bytes);
}
