{
  HttpResponse response=fetchFromServer(request);
  checkForProtocolProblem(response);
  OAuthMessage reply=new OAuthMessage(null,null,null);
  reply.addParameters(OAuth.decodeForm(response.getResponseAsString()));
  reply=parseAuthHeader(reply,response);
  if (OAuthUtil.getParameter(reply,OAuth.OAUTH_TOKEN) == null) {
    throw new OAuthRequestException(OAuthError.MISSING_OAUTH_PARAMETER,OAuth.OAUTH_TOKEN);
  }
  if (OAuthUtil.getParameter(reply,OAuth.OAUTH_TOKEN_SECRET) == null) {
    throw new OAuthRequestException(OAuthError.MISSING_OAUTH_PARAMETER,OAuth.OAUTH_TOKEN_SECRET);
  }
  return reply;
}
