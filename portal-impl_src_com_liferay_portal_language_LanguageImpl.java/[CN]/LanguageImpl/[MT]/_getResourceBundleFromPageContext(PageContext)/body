{
  if (pageContext == null) {
    return null;
  }
  Locale locale=null;
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay != null) {
    locale=themeDisplay.getLocale();
  }
 else {
    locale=request.getLocale();
    if (!isAvailableLocale(locale)) {
      locale=LocaleUtil.getDefault();
    }
  }
  PortletConfig portletConfig=(PortletConfig)request.getAttribute(JavaConstants.JAVAX_PORTLET_CONFIG);
  if (portletConfig != null) {
    return portletConfig.getResourceBundle(locale);
  }
  return null;
}
