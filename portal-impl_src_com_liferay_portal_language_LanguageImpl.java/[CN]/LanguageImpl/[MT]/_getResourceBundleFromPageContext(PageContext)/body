{
  Locale locale=null;
  PortletConfig configPortletConfig=null;
  if (pageContext != null) {
    HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    if (themeDisplay != null) {
      locale=themeDisplay.getLocale();
    }
 else {
      locale=request.getLocale();
      if (!isAvailableLocale(locale)) {
        locale=LocaleUtil.getDefault();
      }
    }
    configPortletConfig=(PortletConfig)request.getAttribute(JavaConstants.JAVAX_PORTLET_CONFIG);
  }
  if (configPortletConfig != null) {
    ResourceBundle configResourceBundle=configPortletConfig.getResourceBundle(locale);
    String portletName=configPortletConfig.getPortletName();
    if (portletName.equals(PortletKeys.PORTLET_CONFIGURATION)) {
      try {
        ResourceBundle resourceBundle=_getResourceBundleFromConfiguratingPortlet(pageContext,locale);
        return new CompositeResourceBundle(configResourceBundle,resourceBundle);
      }
 catch (      SystemException e) {
        if (_log.isErrorEnabled()) {
          _log.error(e.getMessage(),e);
        }
      }
    }
    return configResourceBundle;
  }
  return null;
}
