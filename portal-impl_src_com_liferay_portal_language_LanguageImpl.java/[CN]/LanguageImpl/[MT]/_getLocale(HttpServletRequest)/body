{
  Locale locale=null;
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay != null) {
    locale=themeDisplay.getLocale();
  }
 else {
    locale=request.getLocale();
    if (!isAvailableLocale(locale)) {
      locale=LocaleUtil.getDefault();
    }
  }
  return locale;
}
