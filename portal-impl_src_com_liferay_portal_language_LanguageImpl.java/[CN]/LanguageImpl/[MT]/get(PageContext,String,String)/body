{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay != null) {
    return get(themeDisplay.getCompanyId(),themeDisplay.getLocale(),key,defaultValue);
  }
  if (key == null) {
    return null;
  }
  String value=null;
  try {
    value=TagUtils.getInstance().message(pageContext,null,null,key);
  }
 catch (  Exception e) {
    _log.error(e);
  }
  if (value == null) {
    PortletConfig portletConfig=(PortletConfig)request.getAttribute(JavaConstants.JAVAX_PORTLET_CONFIG);
    if (portletConfig != null) {
      Locale locale=request.getLocale();
      ResourceBundle bundle=portletConfig.getResourceBundle(locale);
      try {
        value=bundle.getString(key);
      }
 catch (      MissingResourceException mre) {
      }
    }
  }
  if (value == null) {
    value=defaultValue;
  }
  return value;
}
