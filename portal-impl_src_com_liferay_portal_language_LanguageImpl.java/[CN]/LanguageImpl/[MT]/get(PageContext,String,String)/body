{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PortletConfig portletConfig=(PortletConfig)request.getAttribute(JavaConstants.JAVAX_PORTLET_CONFIG);
  String value=null;
  if (themeDisplay != null) {
    if ((portletConfig != null) && (key != null) && (!key.endsWith(StringPool.CLOSE_BRACKET))) {
      StringBuilder sb=new StringBuilder();
      sb.append(key);
      sb.append(StringPool.OPEN_BRACKET);
      sb.append(portletConfig.getPortletName());
      sb.append(StringPool.CLOSE_BRACKET);
      key=sb.toString();
    }
    value=get(themeDisplay.getCompanyId(),themeDisplay.getLocale(),key,defaultValue);
    if (((value == null) || (value.equals(defaultValue))) && ((key != null) && (key.endsWith(StringPool.CLOSE_BRACKET)))) {
      int pos=key.lastIndexOf(StringPool.OPEN_BRACKET);
      if (pos != -1) {
        key=key.substring(0,pos);
        value=get(themeDisplay.getCompanyId(),themeDisplay.getLocale(),key,defaultValue);
      }
    }
    if ((value != null) && !value.equals(defaultValue)) {
      return value;
    }
  }
  if (key == null) {
    return null;
  }
  try {
    value=TagUtils.getInstance().message(pageContext,null,null,key);
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(e);
    }
  }
  if ((value == null) || value.equals(defaultValue)) {
    if (portletConfig != null) {
      Locale locale=request.getLocale();
      ResourceBundle bundle=portletConfig.getResourceBundle(locale);
      try {
        value=bundle.getString(key);
      }
 catch (      MissingResourceException mre) {
      }
      if (((value == null) || (value.equals(defaultValue))) && (portletConfig.getPortletName().equals(PortletKeys.PORTLET_CONFIGURATION))) {
        value=_getPortletConfigurationValue(pageContext,key);
      }
    }
  }
  if (value == null) {
    value=defaultValue;
  }
  return value;
}
