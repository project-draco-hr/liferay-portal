{
  Message jxMessage=new MimeMessage(_imapConnection.getSession());
  jxMessage.setFrom(new InternetAddress(sender,personalName));
  jxMessage.addRecipients(Message.RecipientType.TO,to);
  jxMessage.addRecipients(Message.RecipientType.CC,cc);
  jxMessage.addRecipients(Message.RecipientType.BCC,bcc);
  jxMessage.setSentDate(new Date());
  jxMessage.setSubject(subject);
  MimeMultipart multipart=new MimeMultipart();
  BodyPart messageBodyPart=new MimeBodyPart();
  messageBodyPart.setContent(body,ContentTypes.TEXT_HTML_UTF8);
  multipart.addBodyPart(messageBodyPart);
  if (mailFiles != null) {
    for (    MailFile mailFile : mailFiles) {
      File file=mailFile.getFile();
      if (!file.exists()) {
        continue;
      }
      DataSource dataSource=new FileDataSource(file);
      BodyPart attachmentBodyPart=new MimeBodyPart();
      attachmentBodyPart.setDataHandler(new DataHandler(dataSource));
      attachmentBodyPart.setFileName(mailFile.getFileName());
      multipart.addBodyPart(attachmentBodyPart);
    }
  }
  jxMessage.setContent(multipart);
  return jxMessage;
}
