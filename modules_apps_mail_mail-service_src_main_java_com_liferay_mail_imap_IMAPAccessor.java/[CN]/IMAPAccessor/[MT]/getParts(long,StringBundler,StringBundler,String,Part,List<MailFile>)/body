{
  String fileName=part.getFileName();
  Object content=part.getContent();
  if (content instanceof Multipart) {
    Multipart multipart=(Multipart)content;
    for (int i=0; i < multipart.getCount(); i++) {
      Part curPart=multipart.getBodyPart(i);
      getParts(userId,bodyPlain,bodyHtml,contentPath.concat(StringPool.PERIOD).concat(String.valueOf(i)),curPart,mailFiles);
    }
  }
 else   if (Validator.isNull(fileName)) {
    String contentType=StringUtil.toLowerCase(part.getContentType());
    if (contentType.startsWith(ContentTypes.TEXT_PLAIN)) {
      bodyPlain.append(content.toString().replaceAll("\r\n","<br />"));
    }
 else     if (contentType.startsWith(ContentTypes.TEXT_HTML)) {
      bodyHtml.append(HtmlContentUtil.getInlineHtml(content.toString()));
    }
  }
 else {
    MailFile mailFile=new MailFile(contentPath.concat(StringPool.PERIOD).concat("-1"),fileName,part.getSize());
    mailFiles.add(mailFile);
  }
}
