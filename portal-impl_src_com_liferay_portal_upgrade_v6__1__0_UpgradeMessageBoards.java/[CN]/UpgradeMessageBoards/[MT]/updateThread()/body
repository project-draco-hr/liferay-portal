{
  try (PreparedStatement ps=connection.prepareStatement("select MBThread.threadId, MBMessage.companyId, " + "MBMessage.userId from MBThread inner join MBMessage on " + "MBThread.rootMessageId = MBMessage.messageId");ResultSet rs=ps.executeQuery()){
    while (rs.next()) {
      long threadId=rs.getLong("threadId");
      long companyId=rs.getLong("companyId");
      long userId=rs.getLong("userId");
      runSQL("update MBThread set companyId = " + companyId + ", rootMessageUserId = "+ userId+ " where threadId = "+ threadId);
    }
  }
   try (PreparedStatement ps=connection.prepareStatement("select threadId from MBMessageFlag where flag = 2");ResultSet rs=ps.executeQuery()){
    while (rs.next()) {
      long threadId=rs.getLong("threadId");
      updateThreadQuestion(threadId,true);
    }
  }
   StringBundler sb=new StringBundler(4);
  sb.append("select messageFlag.threadId as threadId from ");
  sb.append("MBMessageFlag messageFlag inner join MBMessage ");
  sb.append("message on messageFlag.messageId = message.messageId ");
  sb.append("where message.parentMessageId = 0 and flag = 3");
  try (PreparedStatement ps=connection.prepareStatement(sb.toString());ResultSet rs=ps.executeQuery()){
    while (rs.next()) {
      long threadId=rs.getLong("threadId");
      updateThreadQuestion(threadId,true);
    }
  }
 }
