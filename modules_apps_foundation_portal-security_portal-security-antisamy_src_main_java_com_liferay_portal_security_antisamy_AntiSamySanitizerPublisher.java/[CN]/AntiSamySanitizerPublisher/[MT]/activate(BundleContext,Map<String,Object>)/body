{
  AntiSamyConfiguration antiSamyConfiguration=ConfigurableUtil.createConfigurable(AntiSamyConfiguration.class,properties);
  if (!antiSamyConfiguration.enabled()) {
    return;
  }
  Bundle bundle=bundleContext.getBundle();
  URL url=bundle.getResource(antiSamyConfiguration.configurationFileURL());
  if (url == null) {
    throw new IllegalStateException("Unable to find " + antiSamyConfiguration.configurationFileURL());
  }
  Sanitizer sanitizer=new AntiSamySanitizerImpl(antiSamyConfiguration.blacklist(),url,antiSamyConfiguration.whitelist());
  _sanitizerServiceRegistration=bundleContext.registerService(Sanitizer.class,sanitizer,null);
}
