{
  DDLRecordSet recordSet=record.getRecordSet();
  DDMStructure ddmStructure=recordSet.getDDMStructure();
  Fields fields=new Fields();
  String fileName=uploadPortletRequest.getFileName(fieldName);
  Field oldField=record.getField(fieldName);
  String fieldValue=StringPool.BLANK;
  if (oldField != null) {
    fieldValue=String.valueOf(oldField.getValue());
  }
  if (inputStream != null) {
    String filePath=storeRecordFieldFile(record,fieldName,inputStream);
    JSONObject recordFileJSONObject=JSONFactoryUtil.createJSONObject();
    recordFileJSONObject.put("name",fileName);
    recordFileJSONObject.put("path",filePath);
    recordFileJSONObject.put("recordId",record.getRecordId());
    fieldValue=recordFileJSONObject.toString();
  }
  Field field=new Field(ddmStructure.getStructureId(),fieldName,fieldValue);
  fields.put(field);
  DDLRecordVersion recordVersion=record.getLatestRecordVersion();
  StorageEngineUtil.update(recordVersion.getDDMStorageId(),fields,true,serviceContext);
}
