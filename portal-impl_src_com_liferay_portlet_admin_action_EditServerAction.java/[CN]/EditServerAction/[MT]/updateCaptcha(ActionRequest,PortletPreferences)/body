{
  boolean recaptchaEnabled=ParamUtil.getBoolean(actionRequest,"recaptchaEnabled");
  String recaptchaPrivateKey=ParamUtil.getString(actionRequest,"recaptchaPrivateKey");
  String recaptchaPublicKey=ParamUtil.getString(actionRequest,"recaptchaPublicKey");
  String captchaEngineImpl="com.liferay.portal.captcha.simplecaptcha.SimpleCaptchaImpl";
  if (recaptchaEnabled) {
    captchaEngineImpl="com.liferay.portal.captcha.recaptcha.ReCaptchaImpl";
  }
  preferences.setValue(PropsKeys.CAPTCHA_ENGINE_IMPL,captchaEngineImpl);
  preferences.setValue(PropsKeys.CAPTCHA_ENGINE_RECAPTCHA_KEY_PRIVATE,recaptchaPrivateKey);
  preferences.setValue(PropsKeys.CAPTCHA_ENGINE_RECAPTCHA_KEY_PUBLIC,recaptchaPublicKey);
  CaptchaImpl captchaImpl=(CaptchaImpl)CaptchaUtil.getCaptcha();
  if (recaptchaEnabled) {
    captchaImpl.setCaptcha(new ReCaptchaImpl());
  }
 else {
    captchaImpl.setCaptcha(new SimpleCaptchaImpl());
  }
  preferences.store();
}
