{
  String portletId=ParamUtil.getString(actionRequest,"portletId");
  long[] companyIds=PortalInstances.getCompanyIds();
  if (LuceneHelperUtil.isLoadIndexFromClusterEnabled()) {
    MessageValuesThreadLocal.setValue(ClusterLinkUtil._CLUSTER_FORWARD_MESSAGE,true);
  }
  if (Validator.isNull(portletId)) {
    for (    long companyId : companyIds) {
      try {
        LuceneIndexer indexer=new LuceneIndexer(companyId);
        indexer.reindex();
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
    }
  }
 else {
    Portlet portlet=PortletLocalServiceUtil.getPortletById(companyIds[0],portletId);
    if (portlet == null) {
      return;
    }
    Indexer indexer=portlet.getIndexerInstance();
    if (indexer == null) {
      return;
    }
    for (    long companyId : companyIds) {
      try {
        SearchEngineUtil.deletePortletDocuments(companyId,portletId);
        indexer.reindex(new String[]{String.valueOf(companyId)});
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
    }
  }
  if (LuceneHelperUtil.isLoadIndexFromClusterEnabled()) {
    Address localAddress=ClusterExecutorUtil.getLocalClusterNodeAddress();
    ClusterRequest clusterRequest=ClusterRequest.createMulticastRequest(new MethodHandler(_LOAD_INDEXES_FROM_CLUSTER,companyIds,localAddress),true);
    ClusterExecutorUtil.execute(clusterRequest);
    return;
  }
}
