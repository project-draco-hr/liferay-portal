{
  String portletId=getPortletId(portletContext);
  if (navigationalContext == null) {
    return portletId;
  }
  String opaqueValue=navigationalContext.getOpaqueValue();
  if (Validator.isNotNull(opaqueValue)) {
    opaqueValue=new String(Base64.decode(Base64.fromURLSafe(opaqueValue)),StringPool.UTF8);
  }
  Map<String,String[]> parameterMap=HttpUtil.parameterMapFromString(opaqueValue);
  String portletConfigurationPortletId=PortletProviderUtil.getPortletId(PortletConfigurationApplicationType.PortletConfiguration.CLASS_NAME,PortletProvider.Action.VIEW);
  if (parameterMap.containsKey(PortalUtil.getPortletNamespace(portletConfigurationPortletId) + "portletConfiguration")) {
    portletId=portletConfigurationPortletId;
  }
  return portletId;
}
