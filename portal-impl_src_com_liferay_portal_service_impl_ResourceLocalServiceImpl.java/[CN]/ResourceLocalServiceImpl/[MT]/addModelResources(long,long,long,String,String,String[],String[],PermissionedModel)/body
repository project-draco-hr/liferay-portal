{
  if (!PermissionThreadLocal.isAddResource()) {
    return;
  }
  validate(name,false);
  if (primKey == null) {
    return;
  }
  Resource resource=getResource(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,primKey);
  boolean flushResourceBlockEnabled=PermissionThreadLocal.isFlushResourceBlockEnabled();
  boolean flushResourcePermissionEnabled=PermissionThreadLocal.isFlushResourcePermissionEnabled();
  PermissionThreadLocal.setFlushResourceBlockEnabled(false);
  PermissionThreadLocal.setFlushResourcePermissionEnabled(false);
  try {
    addModelResources(companyId,groupId,userId,resource,groupPermissions,guestPermissions,permissionedModel);
  }
  finally {
    PermissionThreadLocal.setFlushResourceBlockEnabled(flushResourceBlockEnabled);
    PermissionThreadLocal.setFlushResourcePermissionEnabled(flushResourcePermissionEnabled);
    PermissionCacheUtil.clearResourceCache();
    SearchEngineUtil.updatePermissionFields(name,primKey);
  }
}
