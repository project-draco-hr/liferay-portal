{
  ModelPermissions modelPermissions=serviceContext.getModelPermissions();
  if ((modelPermissions != null) && !modelPermissions.isEmpty()) {
    addModelResources(auditedModel.getCompanyId(),getGroupId(auditedModel),auditedModel.getUserId(),auditedModel.getModelClassName(),String.valueOf(auditedModel.getPrimaryKeyObj()),modelPermissions,getPermissionedModel(auditedModel));
  }
 else   if (serviceContext.isAddGroupPermissions() || serviceContext.isAddGuestPermissions()) {
    addResources(auditedModel.getCompanyId(),getGroupId(auditedModel),auditedModel.getUserId(),auditedModel.getModelClassName(),String.valueOf(auditedModel.getPrimaryKeyObj()),false,serviceContext.isAddGroupPermissions(),serviceContext.isAddGuestPermissions(),getPermissionedModel(auditedModel));
  }
 else {
    if (serviceContext.isDeriveDefaultPermissions()) {
      serviceContext.deriveDefaultPermissions(getGroupId(auditedModel),auditedModel.getModelClassName());
    }
    addModelResources(auditedModel.getCompanyId(),getGroupId(auditedModel),auditedModel.getUserId(),auditedModel.getModelClassName(),String.valueOf(auditedModel.getPrimaryKeyObj()),serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions(),getPermissionedModel(auditedModel));
  }
}
