{
  List<String> actions=null;
  if (portletActions) {
    actions=ResourceActionsUtil.getPortletResourceGuestDefaultActions(name);
  }
 else {
    actions=ResourceActionsUtil.getModelResourceGuestDefaultActions(name);
  }
  String[] actionIds=actions.toArray(new String[actions.size()]);
  List<Permission> guestPermissionsList=permissionLocalService.getPermissions(companyId,actionIds,resource.getResourceId());
  PermissionsListFilter permissionsListFilter=PermissionsListFilterFactory.getInstance();
  guestPermissionsList=permissionsListFilter.filterGuestPermissions(companyId,groupId,userId,name,resource.getPrimKey(),portletActions,guestPermissionsList);
  if (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 5) {
    Role guestRole=roleLocalService.getRole(companyId,RoleImpl.GUEST);
    rolePersistence.addPermissions(guestRole.getRoleId(),guestPermissionsList);
  }
 else {
    long defaultUserId=userLocalService.getDefaultUserId(companyId);
    userPersistence.addPermissions(defaultUserId,guestPermissionsList);
  }
}
