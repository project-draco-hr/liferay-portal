{
  validate(companyId,name,false);
  addResource(companyId,name,ResourceImpl.SCOPE_COMPANY,String.valueOf(companyId));
  Group guestGroup=groupLocalService.getGroup(companyId,GroupImpl.GUEST);
  addResource(companyId,name,ResourceImpl.SCOPE_GROUP,String.valueOf(guestGroup.getGroupId()));
  if ((groupId > 0) && (guestGroup.getGroupId() != groupId)) {
    addResource(companyId,name,ResourceImpl.SCOPE_GROUP,String.valueOf(groupId));
  }
  if (primKey != null) {
    Resource resource=addResource(companyId,name,ResourceImpl.SCOPE_INDIVIDUAL,primKey);
    List permissions=permissionLocalService.addPermissions(companyId,name,resource.getResourceId(),false);
    long defaultUserId=userLocalService.getDefaultUserId(companyId);
    if ((userId > 0) && (userId != defaultUserId)) {
      userPersistence.addPermissions(userId,permissions);
    }
    if ((groupId > 0) && (communityPermissions != null)) {
      addModelPermissions(groupId,resource.getResourceId(),communityPermissions);
    }
    if (guestPermissions != null) {
      List guestPermissionsList=permissionLocalService.getPermissions(companyId,guestPermissions,resource.getResourceId());
      userPersistence.addPermissions(defaultUserId,guestPermissionsList);
    }
  }
}
