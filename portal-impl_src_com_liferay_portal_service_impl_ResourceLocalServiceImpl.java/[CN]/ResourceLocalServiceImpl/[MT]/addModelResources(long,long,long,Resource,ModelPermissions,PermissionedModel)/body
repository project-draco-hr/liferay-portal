{
  Role ownerRole=roleLocalService.getRole(companyId,RoleConstants.OWNER);
  List<String> ownerActionIds=ResourceActionsUtil.getModelResourceActions(resource.getName());
  ownerActionIds=ListUtil.copy(ownerActionIds);
  filterOwnerActions(resource.getName(),ownerActionIds);
  String[] ownerPermissions=ownerActionIds.toArray(new String[ownerActionIds.size()]);
  if (resourceBlockLocalService.isSupported(resource.getName())) {
    if (permissionedModel == null) {
      throw new IllegalArgumentException("Permissioned model is null");
    }
    resourceBlockLocalService.setIndividualScopePermissions(resource.getCompanyId(),groupId,resource.getName(),permissionedModel,ownerRole.getRoleId(),ownerActionIds);
    if (modelPermissions != null) {
      for (      String roleName : modelPermissions.getRoleNames()) {
        Role role=getRole(resource.getCompanyId(),groupId,roleName);
        resourceBlockLocalService.setIndividualScopePermissions(resource.getCompanyId(),groupId,resource.getName(),permissionedModel,role.getRoleId(),modelPermissions.getActionIdsList(roleName));
      }
    }
  }
 else {
    resourcePermissionLocalService.setOwnerResourcePermissions(resource.getCompanyId(),resource.getName(),resource.getScope(),resource.getPrimKey(),ownerRole.getRoleId(),userId,ownerPermissions);
    if (modelPermissions != null) {
      for (      String roleName : modelPermissions.getRoleNames()) {
        Role role=getRole(resource.getCompanyId(),groupId,roleName);
        resourcePermissionLocalService.setResourcePermissions(resource.getCompanyId(),resource.getName(),resource.getScope(),resource.getPrimKey(),role.getRoleId(),modelPermissions.getActionIds(roleName));
      }
    }
  }
}
