{
  LinkedHashMap<String,Object> params=(LinkedHashMap<String,Object>)searchContext.getAttribute("params");
  if (params == null) {
    return;
  }
  List<Long> excludedOrganizationIds=(List<Long>)params.get("excludedOrganizationIds");
  if ((excludedOrganizationIds != null) && !excludedOrganizationIds.isEmpty()) {
    BooleanQuery booleanQuery=BooleanQueryFactoryUtil.create(searchContext);
    for (    long excludedOrganizationId : excludedOrganizationIds) {
      booleanQuery.addTerm("organizationId",String.valueOf(excludedOrganizationId));
    }
    contextQuery.add(booleanQuery,BooleanClauseOccur.MUST_NOT);
  }
  List<Organization> organizationsTree=(List<Organization>)params.get("organizationsTree");
  if ((organizationsTree != null) && !organizationsTree.isEmpty()) {
    BooleanQuery booleanQuery=BooleanQueryFactoryUtil.create(searchContext);
    for (    Organization organization : organizationsTree) {
      String treePath=organization.buildTreePath();
      booleanQuery.addTerm(Field.TREE_PATH,treePath,true);
    }
    contextQuery.add(booleanQuery,BooleanClauseOccur.MUST);
  }
 else {
    long parentOrganizationId=GetterUtil.getLong(searchContext.getAttribute("parentOrganizationId"));
    if (parentOrganizationId != OrganizationConstants.ANY_PARENT_ORGANIZATION_ID) {
      contextQuery.addRequiredTerm("parentOrganizationId",parentOrganizationId);
    }
  }
}
