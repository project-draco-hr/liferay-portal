{
  if (layouts.isEmpty()) {
    return;
  }
  if ((rootLayout != null) && !LayoutPermissionUtil.contains(themeDisplay.getPermissionChecker(),rootLayout,ActionKeys.VIEW)) {
    return;
  }
  sb.append("<ul>");
  if (includeRootInTree && (rootLayout != null) && (curDepth == 1)) {
    sb.append("<li>");
    String cssClass="root";
    if (rootLayout.getPlid() == layout.getPlid()) {
      cssClass+=" current";
    }
    _buildLayoutView(rootLayout,cssClass,useHtmlTitle,themeDisplay,sb);
    _buildSiteMap(layout,layouts,rootLayout,includeRootInTree,displayDepth,showCurrentPage,useHtmlTitle,showHiddenPages,curDepth + 1,themeDisplay,sb);
    sb.append("</li>");
  }
 else {
    for (    Layout curLayout : layouts) {
      if ((showHiddenPages || !curLayout.isHidden()) && LayoutPermissionUtil.contains(themeDisplay.getPermissionChecker(),curLayout,ActionKeys.VIEW)) {
        sb.append("<li>");
        String cssClass=StringPool.BLANK;
        if (curLayout.getPlid() == layout.getPlid()) {
          cssClass="current";
        }
        _buildLayoutView(curLayout,cssClass,useHtmlTitle,themeDisplay,sb);
        if ((displayDepth == 0) || (displayDepth > curDepth)) {
          if (showHiddenPages) {
            _buildSiteMap(layout,curLayout.getChildren(),rootLayout,includeRootInTree,displayDepth,showCurrentPage,useHtmlTitle,showHiddenPages,curDepth + 1,themeDisplay,sb);
          }
 else {
            _buildSiteMap(layout,curLayout.getChildren(themeDisplay.getPermissionChecker()),rootLayout,includeRootInTree,displayDepth,showCurrentPage,useHtmlTitle,showHiddenPages,curDepth + 1,themeDisplay,sb);
          }
        }
        sb.append("</li>");
      }
    }
  }
  sb.append("</ul>");
}
