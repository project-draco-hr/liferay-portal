{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String plid=ParamUtil.getString(request,"p_l_id");
  long companyId=ParamUtil.getLong(request,"companyId");
  long groupId=ParamUtil.getLong(request,"groupId");
  long userId=ParamUtil.getLong(request,"userId");
  long categoryId=ParamUtil.getLong(request,"mbCategoryId");
  long threadId=ParamUtil.getLong(request,"threadId");
  int max=ParamUtil.getInteger(request,"max",SearchContainer.DEFAULT_DELTA);
  String type=ParamUtil.getString(request,"type",RSSUtil.FORMAT_DEFAULT);
  double version=ParamUtil.getDouble(request,"version",RSSUtil.VERSION_DEFAULT);
  String displayStyle=ParamUtil.getString(request,"displayStyle",RSSUtil.DISPLAY_STYLE_DEFAULT);
  String entryURL=themeDisplay.getPortalURL() + themeDisplay.getPathMain() + "/message_boards/find_message?p_l_id="+ plid;
  String rss=StringPool.BLANK;
  if (companyId > 0) {
    String feedURL=StringPool.BLANK;
    rss=MBMessageServiceUtil.getCompanyMessagesRSS(companyId,WorkflowConstants.STATUS_APPROVED,max,type,version,displayStyle,feedURL,entryURL,themeDisplay);
  }
 else   if (groupId > 0) {
    String topLink=ParamUtil.getString(request,"topLink");
    String feedURL=null;
    if (topLink.equals("recent-posts")) {
      feedURL=themeDisplay.getPortalURL() + themeDisplay.getPathMain() + "/message_boards/find_recent_posts?p_l_id="+ plid;
    }
 else {
      feedURL=themeDisplay.getPortalURL() + themeDisplay.getPathMain() + "/message_boards/find_category?p_l_id="+ plid+ "&mbCategoryId="+ categoryId;
    }
    if (userId > 0) {
      rss=MBMessageServiceUtil.getGroupMessagesRSS(groupId,userId,WorkflowConstants.STATUS_APPROVED,max,type,version,displayStyle,feedURL,entryURL,themeDisplay);
    }
 else {
      rss=MBMessageServiceUtil.getGroupMessagesRSS(groupId,WorkflowConstants.STATUS_APPROVED,max,type,version,displayStyle,feedURL,entryURL,themeDisplay);
    }
  }
 else   if (categoryId > 0) {
    String feedURL=themeDisplay.getPortalURL() + themeDisplay.getPathMain() + "/message_boards/find_category?p_l_id="+ plid+ "&mbCategoryId="+ categoryId;
    rss=MBMessageServiceUtil.getCategoryMessagesRSS(groupId,categoryId,WorkflowConstants.STATUS_APPROVED,max,type,version,displayStyle,feedURL,entryURL,themeDisplay);
  }
 else   if (threadId > 0) {
    String feedURL=themeDisplay.getPortalURL() + themeDisplay.getPathMain() + "/message_boards/find_thread?p_l_id="+ plid+ "&threadId="+ threadId;
    rss=MBMessageServiceUtil.getThreadMessagesRSS(threadId,WorkflowConstants.STATUS_APPROVED,max,type,version,displayStyle,feedURL,entryURL,themeDisplay);
  }
  return rss.getBytes(StringPool.UTF8);
}
