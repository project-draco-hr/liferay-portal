{
  HttpSession ses=req.getSession();
  MailAccount account=null;
  AccountFinder accountFinder=AccountFinderLocator.getAccountFinderInstance();
  User user=null;
  String password=null;
  try {
    user=PortalUtil.getUser(req);
    if (Validator.isNull(ACCOUNT_FINDER_PASSWORD)) {
      password=PortalUtil.getUserPassword(ses);
      if (password == null) {
        password=user.getPassword();
      }
    }
 else {
      password=ACCOUNT_FINDER_PASSWORD;
    }
    account=accountFinder.findAccount(user,password,accountName);
  }
 catch (  AccountNotFoundException anfe) {
    try {
      account=accountFinder.findAccount(user,password,accountFinder.getDefaultAccountName());
    }
 catch (    Exception e1) {
      throw new MailAccountsException("Could not read the default account",e1);
    }
  }
catch (  Exception e2) {
    throw new MailAccountsException("Could not read the account " + accountName,e2);
  }
  _findAllAccounts(user,password);
  return account;
}
