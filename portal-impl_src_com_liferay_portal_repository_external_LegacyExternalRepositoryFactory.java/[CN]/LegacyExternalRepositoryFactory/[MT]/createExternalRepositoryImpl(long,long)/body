{
  BaseRepository baseRepository=null;
  com.liferay.portal.model.Repository repository=null;
  try {
    repository=_repositoryLocalService.getRepository(repositoryId);
    ClassName className=_classNameLocalService.getClassName(classNameId);
    String repositoryImplClassName=className.getValue();
    baseRepository=ExternalRepositoryFactoryUtil.getInstance(repositoryImplClassName);
  }
 catch (  Exception e) {
    throw new RepositoryException("Unable to find a valid repository for class name ID " + classNameId,e);
  }
  setupRepository(repositoryId,repository,baseRepository);
  if (!ExportImportThreadLocal.isImportInProcess()) {
    baseRepository.initRepository();
  }
  return baseRepository;
}
