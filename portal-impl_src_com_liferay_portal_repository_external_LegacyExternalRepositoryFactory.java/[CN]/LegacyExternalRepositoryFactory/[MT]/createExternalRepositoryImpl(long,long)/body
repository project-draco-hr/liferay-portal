{
  BaseRepository baseRepository=null;
  com.liferay.portal.kernel.model.Repository repository=null;
  ClassName className=_classNameLocalService.getClassName(classNameId);
  String repositoryImplClassName=className.getValue();
  try {
    repository=_repositoryLocalService.getRepository(repositoryId);
    baseRepository=ExternalRepositoryFactoryUtil.getInstance(repositoryImplClassName);
  }
 catch (  Exception e) {
    throw new RepositoryException("Unable to find a valid repository for class name ID " + classNameId,e);
  }
  setupRepository(repositoryId,repository,baseRepository);
  if (!ExportImportThreadLocal.isImportInProcess()) {
    try {
      baseRepository.initRepository();
    }
 catch (    Exception e) {
      throw new RepositoryException(e);
    }
  }
  return baseRepository;
}
