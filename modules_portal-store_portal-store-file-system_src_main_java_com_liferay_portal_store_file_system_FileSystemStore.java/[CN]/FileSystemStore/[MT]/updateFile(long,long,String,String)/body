{
  if (fileName.equals(newFileName)) {
    throw new DuplicateFileException(companyId,repositoryId,newFileName);
  }
  File fileNameDir=getFileNameDir(companyId,repositoryId,fileName);
  if (!fileNameDir.exists()) {
    throw new NoSuchFileException(companyId,repositoryId,fileName);
  }
  File newFileNameDir=getFileNameDir(companyId,repositoryId,newFileName);
  if (newFileNameDir.exists()) {
    throw new DuplicateFileException(companyId,repositoryId,newFileName);
  }
  File parentFile=fileNameDir.getParentFile();
  boolean renamed=FileUtil.move(fileNameDir,newFileNameDir);
  if (!renamed) {
    throw new SystemException("File name directory was not renamed from " + fileNameDir.getPath() + " to "+ newFileNameDir.getPath());
  }
  deleteEmptyAncestors(companyId,repositoryId,parentFile);
}
