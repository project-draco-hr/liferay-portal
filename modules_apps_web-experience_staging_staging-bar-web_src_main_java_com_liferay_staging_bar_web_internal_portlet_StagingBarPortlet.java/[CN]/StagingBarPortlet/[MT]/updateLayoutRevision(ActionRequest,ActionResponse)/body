{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long layoutRevisionId=ParamUtil.getLong(actionRequest,"layoutRevisionId");
  LayoutRevision layoutRevision=_layoutRevisionLocalService.getLayoutRevision(layoutRevisionId);
  ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
  LayoutRevision enableLayoutRevision=_layoutRevisionLocalService.updateLayoutRevision(serviceContext.getUserId(),layoutRevisionId,layoutRevision.getLayoutBranchId(),layoutRevision.getName(),layoutRevision.getTitle(),layoutRevision.getDescription(),layoutRevision.getKeywords(),layoutRevision.getRobots(),layoutRevision.getTypeSettings(),layoutRevision.getIconImage(),layoutRevision.getIconImageId(),layoutRevision.getThemeId(),layoutRevision.getColorSchemeId(),layoutRevision.getCss(),serviceContext);
  if (layoutRevision.getStatus() != WorkflowConstants.STATUS_INCOMPLETE) {
    StagingUtil.setRecentLayoutRevisionId(themeDisplay.getUser(),layoutRevision.getLayoutSetBranchId(),layoutRevision.getPlid(),layoutRevision.getLayoutRevisionId());
    addLayoutRevisionSessionMessages(actionRequest,actionResponse);
    return;
  }
  LayoutRevision lastLayoutRevision=_layoutRevisionLocalService.fetchLastLayoutRevision(enableLayoutRevision.getPlid(),true);
  if (lastLayoutRevision != null) {
    LayoutRevision newLayoutRevision=_layoutRevisionLocalService.addLayoutRevision(serviceContext.getUserId(),layoutRevision.getLayoutSetBranchId(),layoutRevision.getLayoutBranchId(),enableLayoutRevision.getLayoutRevisionId(),false,layoutRevision.getPlid(),lastLayoutRevision.getLayoutRevisionId(),lastLayoutRevision.isPrivateLayout(),lastLayoutRevision.getName(),lastLayoutRevision.getTitle(),lastLayoutRevision.getDescription(),lastLayoutRevision.getKeywords(),lastLayoutRevision.getRobots(),lastLayoutRevision.getTypeSettings(),lastLayoutRevision.isIconImage(),lastLayoutRevision.getIconImageId(),lastLayoutRevision.getThemeId(),lastLayoutRevision.getColorSchemeId(),lastLayoutRevision.getCss(),serviceContext);
    StagingUtil.setRecentLayoutRevisionId(themeDisplay.getUser(),newLayoutRevision.getLayoutSetBranchId(),newLayoutRevision.getPlid(),newLayoutRevision.getLayoutRevisionId());
  }
  addLayoutRevisionSessionMessages(actionRequest,actionResponse);
}
