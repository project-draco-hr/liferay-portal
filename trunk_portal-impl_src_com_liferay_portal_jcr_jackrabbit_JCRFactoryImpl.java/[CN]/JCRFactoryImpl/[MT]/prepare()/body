{
  try {
    File repositoryRoot=new File(JCRFactoryImpl.REPOSITORY_ROOT);
    if (repositoryRoot.exists()) {
      return;
    }
    repositoryRoot.mkdirs();
    File tempFile=new File(SystemProperties.get(SystemProperties.TMP_DIR) + File.separator + Time.getTimestamp());
    String repositoryXmlPath="com/liferay/portal/jcr/jackrabbit/dependencies/" + "repository-ext.xml";
    ClassLoader classLoader=getClass().getClassLoader();
    if (classLoader.getResource(repositoryXmlPath) == null) {
      repositoryXmlPath="com/liferay/portal/jcr/jackrabbit/dependencies/" + "repository.xml";
    }
    FileUtil.write(tempFile,classLoader.getResourceAsStream(repositoryXmlPath));
    FileUtil.copyFile(tempFile,new File(JCRFactoryImpl.CONFIG_FILE_PATH));
    tempFile.delete();
  }
 catch (  IOException ioe) {
    _log.error("Could not prepare Jackrabbit directory");
    throw new RepositoryException(ioe);
  }
}
