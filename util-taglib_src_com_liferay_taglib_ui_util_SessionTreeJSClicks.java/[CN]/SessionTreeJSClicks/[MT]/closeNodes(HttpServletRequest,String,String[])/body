{
  try {
    PortalPreferences preferences=PortletPreferencesFactoryUtil.getPortalPreferences(request);
    Callable<String> modifyOperation=new SessionTreeJSClicksOperation(request,treeId,nodeIds){
      @Override public String call() throws Exception {
        PortalPreferences preferences=PortletPreferencesFactoryUtil.getPortalPreferences(_request);
        String openNodesString=preferences.getValue(SessionTreeJSClicks.class.getName(),_treeId);
        for (        String nodeId : _nodeIds) {
          openNodesString=StringUtil.removeFromList(openNodesString,nodeId);
        }
        return openNodesString;
      }
    }
;
    preferences.getAndUpdateValue(SessionTreeJSClicks.class.getName(),treeId,modifyOperation);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
