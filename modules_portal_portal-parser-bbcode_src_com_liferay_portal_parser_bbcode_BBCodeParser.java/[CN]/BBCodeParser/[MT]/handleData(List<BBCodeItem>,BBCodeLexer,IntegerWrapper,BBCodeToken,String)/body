{
  int lastIndex=0;
  int length=data.length();
  if (bbCodeToken != null) {
    lastIndex=bbCodeLexer.getLastIndex();
    length=lastIndex;
    String tag=bbCodeToken.getStartTag();
    if (tag == null) {
      tag=bbCodeToken.getEndTag();
    }
    if (isValidTag(tag)) {
      length=bbCodeToken.getStart();
    }
  }
  if (length > marker.getValue()) {
    BBCodeItem bbCodeItem=new BBCodeItem(TYPE_DATA,null,data.substring(marker.getValue(),length));
    bbCodeItems.add(bbCodeItem);
  }
  marker.setValue(lastIndex);
}
