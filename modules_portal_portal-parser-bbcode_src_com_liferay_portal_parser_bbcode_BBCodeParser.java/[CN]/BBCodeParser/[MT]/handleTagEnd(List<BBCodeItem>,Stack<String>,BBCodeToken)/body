{
  String endTag=null;
  int size=0;
  if (bbCodeToken != null) {
    endTag=bbCodeToken.getEndTag();
    for (size=tags.size() - 1; size >= 0; size--) {
      if (endTag.equals(tags.elementAt(size))) {
        break;
      }
    }
  }
  if ((size >= 0) && isValidTag(endTag)) {
    for (int i=tags.size() - 1; i >= size; i--) {
      BBCodeItem bbCodeItem=new BBCodeItem(TYPE_TAG_END,null,tags.elementAt(i));
      bbCodeItems.add(bbCodeItem);
    }
    tags.setSize(size);
  }
}
