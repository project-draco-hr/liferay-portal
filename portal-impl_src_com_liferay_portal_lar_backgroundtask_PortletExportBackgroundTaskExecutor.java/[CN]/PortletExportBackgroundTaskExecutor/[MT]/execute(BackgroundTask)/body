{
  ExportImportConfiguration exportImportConfiguration=getExportImportConfiguration(backgroundTask);
  Map<String,Serializable> settingsMap=exportImportConfiguration.getSettingsMap();
  long userId=MapUtil.getLong(settingsMap,"userId");
  String fileName=MapUtil.getString(settingsMap,"fileName");
  long sourcePlid=MapUtil.getLong(settingsMap,"sourcePlid");
  long sourceGroupId=MapUtil.getLong(settingsMap,"sourceGroupId");
  String portletId=MapUtil.getString(settingsMap,"portletId");
  Map<String,String[]> parameterMap=(Map<String,String[]>)settingsMap.get("parameterMap");
  DateRange dateRange=ExportImportDateUtil.getDateRange(exportImportConfiguration,ExportImportDateUtil.RANGE_ALL);
  File larFile=LayoutLocalServiceUtil.exportPortletInfoAsFile(sourcePlid,sourceGroupId,portletId,parameterMap,dateRange.getStartDate(),dateRange.getEndDate());
  BackgroundTaskLocalServiceUtil.addBackgroundTaskAttachment(userId,backgroundTask.getBackgroundTaskId(),fileName,larFile);
  return BackgroundTaskResult.SUCCESS;
}
