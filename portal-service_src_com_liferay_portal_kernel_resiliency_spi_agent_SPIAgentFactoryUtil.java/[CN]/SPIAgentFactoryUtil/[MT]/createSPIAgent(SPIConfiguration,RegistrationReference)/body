{
  String agentClassName=spiConfiguration.getAgentClassName();
  if (agentClassName == null) {
    throw new NullPointerException("Missing agentClassName");
  }
  Class<? extends SPIAgent> agentClass=_spiAgentClassMap.get(agentClassName);
  if (agentClass == null) {
    throw new IllegalArgumentException("Unkown SPIAgent class name " + agentClassName);
  }
  try {
    Constructor<? extends SPIAgent> constructor=agentClass.getConstructor(SPIConfiguration.class,RegistrationReference.class);
    return constructor.newInstance(spiConfiguration,registrationReference);
  }
 catch (  Exception e) {
    throw new RuntimeException("Unable to create instance of class " + agentClass,e);
  }
}
