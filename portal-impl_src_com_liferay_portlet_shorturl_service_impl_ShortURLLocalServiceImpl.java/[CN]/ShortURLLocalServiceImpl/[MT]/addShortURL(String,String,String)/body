{
  ShortURL shortURL=shortURLPersistence.fetchByOriginalURL(url);
  if (shortURL == null) {
    shortURL=shortURLPersistence.create(counterLocalService.increment(ShortURL.class.getName()));
  }
  long shortURLId=shortURL.getShortURLId();
  shortURL.setOriginalURL(url);
  if (Validator.isNull(hash)) {
    shortURL.setHash(generateHash(shortURLId));
  }
 else {
    shortURL.setHash(hash);
  }
  shortURL.setDescriptor(generateDescriptor(description));
  return shortURLPersistence.update(shortURL,false);
}
