{
  File file=null;
  try {
    HttpServletRequest req=webDavReq.getHttpServletRequest();
    String[] pathArray=webDavReq.getPathArray();
    long parentFolderId=getParentFolderId(pathArray);
    String name=WebDAVUtil.getResourceName(pathArray);
    String description=StringPool.BLANK;
    String contentType=ContentTypeUtil.getContentType(name);
    String[] tagsEntries=null;
    boolean addCommunityPermissions=true;
    boolean addGuestPermissions=true;
    file=FileUtil.createTempFile(FileUtil.getExtension(name));
    FileUtil.write(file,req.getInputStream());
    try {
      IGImage image=IGImageServiceUtil.getImageByFolderIdAndNameWithExtension(parentFolderId,name);
      long imageId=image.getImageId();
      description=image.getDescription();
      tagsEntries=TagsEntryServiceUtil.getEntryNames(IGImage.class.getName(),imageId);
      IGImageServiceUtil.updateImage(imageId,parentFolderId,name,description,file,contentType,tagsEntries);
    }
 catch (    NoSuchImageException nsie) {
      IGImageServiceUtil.addImage(parentFolderId,name,description,file,contentType,tagsEntries,addCommunityPermissions,addGuestPermissions);
    }
    return HttpServletResponse.SC_CREATED;
  }
 catch (  PrincipalException pe) {
    return HttpServletResponse.SC_FORBIDDEN;
  }
catch (  PortalException pe) {
    if (_log.isWarnEnabled()) {
      _log.warn(pe,pe);
    }
    return HttpServletResponse.SC_CONFLICT;
  }
catch (  Exception e) {
    throw new WebDAVException(e);
  }
 finally {
    if (file != null) {
      file.delete();
    }
  }
}
