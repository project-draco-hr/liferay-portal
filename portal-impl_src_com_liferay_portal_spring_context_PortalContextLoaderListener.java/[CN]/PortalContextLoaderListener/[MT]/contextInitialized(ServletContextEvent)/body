{
  SystemProperties.reload();
  DBFactoryUtil.reset();
  DeployManagerUtil.reset();
  InstancePool.reset();
  MethodCache.reset();
  PortalBeanLocatorUtil.reset();
  PortletBagPool.reset();
  ReferenceRegistry.releaseReferences();
  InitUtil.init();
  ServletContext servletContext=servletContextEvent.getServletContext();
  _portalServlerContextName=servletContext.getServletContextName();
  if (_portalServlerContextName == null) {
    _portalServlerContextName=StringPool.BLANK;
  }
  _portalServletContextPath=servletContext.getContextPath();
  ClassPathUtil.initializeClassPaths(servletContext);
  CacheRegistryUtil.clear();
  CharBufferPool.cleanUp();
  PortletContextBagPool.clear();
  WebAppPool.clear();
  File tempDir=(File)servletContext.getAttribute(JavaConstants.JAVAX_SERVLET_CONTEXT_TEMPDIR);
  PropsValues.LIFERAY_WEB_PORTAL_CONTEXT_TEMPDIR=tempDir.getAbsolutePath();
  try {
    ModuleFrameworkUtilAdapter.startFramework();
  }
 catch (  Exception e) {
    _log.error("Unable to load the module framework because of a bug in the " + "application server. Support for OSGi plugins is disabled.",e);
    ModuleFrameworkUtilAdapter.setModuleFramework(new DummyModuleFramework());
  }
  SecurityManagerUtil.applySmartStrategy();
  PortalContextLoaderLifecycleThreadLocal.setInitializing(true);
  try {
    super.contextInitialized(servletContextEvent);
  }
  finally {
    PortalContextLoaderLifecycleThreadLocal.setInitializing(false);
  }
  ApplicationContext applicationContext=ContextLoader.getCurrentWebApplicationContext();
  try {
    BeanReferenceRefreshUtil.refresh(applicationContext);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  FinderCacheUtil.clearCache();
  FinderCacheUtil.clearLocalCache();
  EntityCacheUtil.clearCache();
  EntityCacheUtil.clearLocalCache();
  PermissionCacheUtil.clearCache();
  PermissionCacheUtil.clearLocalCache();
  TemplateResourceLoaderUtil.clearCache();
  WikiCacheUtil.clearCache(0);
  ServletContextPool.clear();
  CacheUtil.clearCache();
  MultiVMPoolUtil.clear();
  SingleVMPoolUtil.clear();
  WebCachePoolUtil.clear();
  ClassLoader portalClassLoader=ClassLoaderUtil.getPortalClassLoader();
  ClassLoaderPool.register(_portalServlerContextName,portalClassLoader);
  ServletContextPool.put(_portalServlerContextName,servletContext);
  BeanLocatorImpl beanLocatorImpl=new BeanLocatorImpl(portalClassLoader,applicationContext);
  PortalBeanLocatorUtil.setBeanLocator(beanLocatorImpl);
  ClassLoader classLoader=portalClassLoader;
  while (classLoader != null) {
    CachedIntrospectionResults.clearClassLoader(classLoader);
    classLoader=classLoader.getParent();
  }
  AutowireCapableBeanFactory autowireCapableBeanFactory=applicationContext.getAutowireCapableBeanFactory();
  clearFilteredPropertyDescriptorsCache(autowireCapableBeanFactory);
  try {
    ModuleFrameworkUtilAdapter.registerContext(applicationContext);
    ModuleFrameworkUtilAdapter.registerContext(servletContext);
    ModuleFrameworkUtilAdapter.startRuntime();
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
