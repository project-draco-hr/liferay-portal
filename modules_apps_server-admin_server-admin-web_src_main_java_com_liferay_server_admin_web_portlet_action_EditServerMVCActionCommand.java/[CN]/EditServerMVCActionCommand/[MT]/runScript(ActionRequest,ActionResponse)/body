{
  String language=ParamUtil.getString(actionRequest,"language");
  String script=ParamUtil.getString(actionRequest,"script");
  PortletConfig portletConfig=getPortletConfig(actionRequest);
  PortletContext portletContext=portletConfig.getPortletContext();
  Map<String,Object> portletObjects=ScriptingHelperUtil.getPortletObjects(portletConfig,portletContext,actionRequest,actionResponse);
  UnsyncByteArrayOutputStream unsyncByteArrayOutputStream=new UnsyncByteArrayOutputStream();
  UnsyncPrintWriter unsyncPrintWriter=UnsyncPrintWriterPool.borrow(unsyncByteArrayOutputStream);
  portletObjects.put("out",unsyncPrintWriter);
  try {
    SessionMessages.add(actionRequest,"language",language);
    SessionMessages.add(actionRequest,"script",script);
    _scripting.exec(null,portletObjects,language,script);
    unsyncPrintWriter.flush();
    SessionMessages.add(actionRequest,"scriptOutput",unsyncByteArrayOutputStream.toString());
  }
 catch (  ScriptingException se) {
    SessionErrors.add(actionRequest,ScriptingException.class.getName(),se);
    Log log=SanitizerLogWrapper.allowCRLF(_log);
    log.error(se.getMessage());
  }
}
