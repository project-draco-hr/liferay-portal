{
  ThemeDisplay themeDisplay=(ThemeDisplay)liferayPortletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  if (Validator.isNotNull(_article.getLayoutUuid())) {
    layout=LayoutLocalServiceUtil.getLayoutByUuidAndCompanyId(_article.getLayoutUuid(),_article.getCompanyId());
  }
  String portletId=(String)liferayPortletRequest.getAttribute(WebKeys.PORTLET_ID);
  PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portletId);
  String linkToLayoutUuid=GetterUtil.getString(portletSetup.getValue("portletSetupLinkToLayoutUuid",null));
  if (Validator.isNotNull(_article.getLayoutUuid()) && Validator.isNull(linkToLayoutUuid)) {
    Group group=themeDisplay.getScopeGroup();
    if (group.getGroupId() != _article.getGroupId()) {
      group=GroupLocalServiceUtil.getGroup(_article.getGroupId());
    }
    String groupFriendlyURL=PortalUtil.getGroupFriendlyURL(group,layout.isPrivateLayout(),themeDisplay);
    return groupFriendlyURL.concat(JournalArticleConstants.CANONICAL_URL_SEPARATOR).concat(_article.getUrlTitle());
  }
  List<Long> hitLayoutIds=JournalContentSearchLocalServiceUtil.getLayoutIds(_article.getGroupId(),layout.isPrivateLayout(),_article.getArticleId());
  if (!hitLayoutIds.isEmpty()) {
    Long hitLayoutId=hitLayoutIds.get(0);
    Layout hitLayout=LayoutLocalServiceUtil.getLayout(_article.getGroupId(),layout.isPrivateLayout(),hitLayoutId.longValue());
    return PortalUtil.getLayoutURL(hitLayout,themeDisplay);
  }
  return noSuchEntryRedirect;
}
