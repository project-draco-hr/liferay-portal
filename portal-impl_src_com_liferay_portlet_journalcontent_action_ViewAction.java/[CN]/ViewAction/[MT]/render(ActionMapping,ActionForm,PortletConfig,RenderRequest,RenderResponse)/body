{
  PortletPreferences portletPreferences=renderRequest.getPreferences();
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long articleGroupId=ParamUtil.getLong(renderRequest,"articleGroupId");
  if (articleGroupId <= 0) {
    articleGroupId=GetterUtil.getLong(portletPreferences.getValue("groupId",null));
  }
  String articleId=ParamUtil.getString(renderRequest,"articleId");
  String ddmTemplateKey=ParamUtil.getString(renderRequest,"ddmTemplateKey");
  if (Validator.isNull(articleId)) {
    articleId=GetterUtil.getString(portletPreferences.getValue("articleId",null));
    ddmTemplateKey=GetterUtil.getString(portletPreferences.getValue("ddmTemplateKey",null));
  }
  String viewMode=ParamUtil.getString(renderRequest,"viewMode");
  String languageId=LanguageUtil.getLanguageId(renderRequest);
  int page=ParamUtil.getInteger(renderRequest,"page",1);
  String xmlRequest=PortletRequestUtil.toXML(renderRequest,renderResponse);
  JournalArticle article=null;
  JournalArticleDisplay articleDisplay=null;
  if ((articleGroupId > 0) && Validator.isNotNull(articleId)) {
    article=JournalArticleLocalServiceUtil.fetchLatestArticle(articleGroupId,articleId,WorkflowConstants.STATUS_APPROVED);
    try {
      if (article == null) {
        article=JournalArticleLocalServiceUtil.getLatestArticle(articleGroupId,articleId,WorkflowConstants.STATUS_ANY);
      }
      double version=article.getVersion();
      articleDisplay=JournalContentUtil.getDisplay(articleGroupId,articleId,version,ddmTemplateKey,viewMode,languageId,themeDisplay,page,xmlRequest);
    }
 catch (    Exception e) {
      renderRequest.removeAttribute(WebKeys.JOURNAL_ARTICLE);
      articleDisplay=JournalContentUtil.getDisplay(articleGroupId,articleId,ddmTemplateKey,viewMode,languageId,themeDisplay,page,xmlRequest);
    }
  }
  if (article != null) {
    renderRequest.setAttribute(WebKeys.JOURNAL_ARTICLE,article);
  }
  if (articleDisplay != null) {
    renderRequest.setAttribute(WebKeys.JOURNAL_ARTICLE_DISPLAY,articleDisplay);
  }
 else {
    renderRequest.removeAttribute(WebKeys.JOURNAL_ARTICLE_DISPLAY);
  }
  return actionMapping.findForward("portlet.journal_content.view");
}
