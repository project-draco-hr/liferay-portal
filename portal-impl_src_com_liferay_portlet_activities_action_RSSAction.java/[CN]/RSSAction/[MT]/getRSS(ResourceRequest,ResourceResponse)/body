{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  SyndFeed syndFeed=new SyndFeedImpl();
  String description=ParamUtil.getString(resourceRequest,"feedTitle");
  syndFeed.setDescription(description);
  List<SyndEntry> syndEntries=new ArrayList<SyndEntry>();
  syndFeed.setEntries(syndEntries);
  List<SocialActivity> activities=getActivities(resourceRequest);
  for (  SocialActivity activity : activities) {
    SocialActivityFeedEntry activityFeedEntry=SocialActivityInterpreterLocalServiceUtil.interpret(activity,themeDisplay);
    if (activityFeedEntry == null) {
      continue;
    }
    SyndEntry syndEntry=new SyndEntryImpl();
    SyndContent syndContent=new SyndContentImpl();
    syndContent.setType(RSSUtil.FEED_TYPE_DEFAULT);
    syndContent.setValue(activityFeedEntry.getBody());
    syndEntry.setDescription(syndContent);
    if (Validator.isNotNull(activityFeedEntry.getLink())) {
      syndEntry.setLink(activityFeedEntry.getLink());
    }
    syndEntry.setPublishedDate(new Date(activity.getCreateDate()));
    syndEntry.setTitle(HtmlUtil.extractText(activityFeedEntry.getTitle()));
    syndEntries.add(syndEntry);
  }
  syndFeed.setFeedType(RSSUtil.FEED_TYPE_DEFAULT);
  String link=PortalUtil.getLayoutFullURL(themeDisplay) + Portal.FRIENDLY_URL_SEPARATOR + "activities/rss";
  List<SyndLink> syndLinks=new ArrayList<SyndLink>();
  syndFeed.setLinks(syndLinks);
  SyndLink syndLinkSelf=new SyndLinkImpl();
  syndLinks.add(syndLinkSelf);
  syndLinkSelf.setHref(link);
  syndLinkSelf.setRel("self");
  SyndLink syndLinkAlternate=new SyndLinkImpl();
  syndLinks.add(syndLinkAlternate);
  syndLinkAlternate.setHref(PortalUtil.getLayoutFullURL(themeDisplay));
  syndLinkAlternate.setRel("alternate");
  syndFeed.setPublishedDate(new Date());
  syndFeed.setTitle(description);
  syndFeed.setUri(link);
  String rss=StringPool.BLANK;
  try {
    rss=RSSUtil.export(syndFeed);
  }
 catch (  FeedException fe) {
    throw new SystemException(fe);
  }
  return rss.getBytes(StringPool.UTF8);
}
