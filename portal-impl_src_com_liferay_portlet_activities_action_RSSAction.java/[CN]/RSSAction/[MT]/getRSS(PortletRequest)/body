{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  SyndFeed syndFeed=new SyndFeedImpl();
  String feedTitle=ParamUtil.getString(portletRequest,"feedTitle");
  syndFeed.setDescription(feedTitle);
  syndFeed.setFeedType(RSSUtil.FEED_TYPE_DEFAULT);
  String feedLink=PortalUtil.getLayoutFullURL(themeDisplay) + Portal.FRIENDLY_URL_SEPARATOR + "activities/rss";
  syndFeed.setLink(feedLink);
  syndFeed.setTitle(feedTitle);
  List<SyndEntry> syndEntries=new ArrayList<SyndEntry>();
  syndFeed.setEntries(syndEntries);
  List<SocialActivity> activities=getActivities(portletRequest);
  for (  SocialActivity activity : activities) {
    SocialActivityFeedEntry activityFeedEntry=SocialActivityInterpreterLocalServiceUtil.interpret(activity,themeDisplay);
    if (activityFeedEntry == null) {
      continue;
    }
    SyndEntry syndEntry=new SyndEntryImpl();
    SyndContent syndContent=new SyndContentImpl();
    syndContent.setType(RSSUtil.FEED_TYPE_DEFAULT);
    syndContent.setValue(activityFeedEntry.getBody());
    syndEntry.setDescription(syndContent);
    if (Validator.isNotNull(activityFeedEntry.getLink())) {
      syndEntry.setLink(activityFeedEntry.getLink());
    }
    syndEntry.setPublishedDate(new Date(activity.getCreateDate()));
    syndEntry.setTitle(HtmlUtil.extractText(activityFeedEntry.getTitle()));
    syndEntries.add(syndEntry);
  }
  String rss=StringPool.BLANK;
  try {
    rss=RSSUtil.export(syndFeed);
  }
 catch (  FeedException fe) {
    throw new SystemException(fe);
  }
  return rss.getBytes(StringPool.UTF8);
}
