{
  DDMContent ddmContent=DDMContentLocalServiceUtil.getContent(classPK);
  Document document=null;
  Element rootElement=null;
  if (mergeFields) {
    document=SAXReaderUtil.read(ddmContent.getXml());
    rootElement=document.getRootElement();
  }
 else {
    document=SAXReaderUtil.createDocument();
    rootElement=document.addElement("root");
  }
  Iterator<Field> itr=fields.iterator();
  while (itr.hasNext()) {
    Field field=itr.next();
    Object value=field.getValue();
    if (value instanceof Date) {
      Date valueDate=(Date)value;
      value=valueDate.getTime();
    }
    String fieldName=field.getName();
    String fieldValue=String.valueOf(value);
    Element dynamicElementElement=_getElementByName(document,fieldName);
    if (dynamicElementElement == null) {
      _appendField(rootElement,fieldName,fieldValue);
    }
 else {
      _updateField(dynamicElementElement,fieldName,fieldValue);
    }
  }
  ddmContent.setModifiedDate(serviceContext.getModifiedDate(null));
  ddmContent.setXml(document.formattedString());
  DDMContentLocalServiceUtil.updateContent(ddmContent.getPrimaryKey(),ddmContent.getName(),ddmContent.getDescription(),ddmContent.getXml(),serviceContext);
}
