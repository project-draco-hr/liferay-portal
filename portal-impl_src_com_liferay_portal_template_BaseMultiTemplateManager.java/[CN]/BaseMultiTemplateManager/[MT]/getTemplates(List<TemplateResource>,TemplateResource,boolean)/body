{
  TemplateControlContext templateControlContext=templateContextHelper.getTemplateControlContext();
  AccessControlContext accessControlContext=templateControlContext.getAccessControlContext();
  ClassLoader classLoader=templateControlContext.getClassLoader();
  if (accessControlContext == null) {
    Map<String,Object> helperUtilities=templateContextHelper.getHelperUtilities(classLoader,restricted);
    return doGetTemplate(templateResources,errorTemplateResource,restricted,helperUtilities,false);
  }
  Map<String,Object> helperUtilities=AccessController.doPrivileged(new DoGetHelperUtilitiesPrivilegedAction(templateContextHelper,classLoader,restricted),accessControlContext);
  Template template=AccessController.doPrivileged(new DoGetTemplatePrivilegedAction(templateResources,errorTemplateResource,restricted,helperUtilities));
  return new PrivilegedTemplateWrapper(accessControlContext,template);
}
