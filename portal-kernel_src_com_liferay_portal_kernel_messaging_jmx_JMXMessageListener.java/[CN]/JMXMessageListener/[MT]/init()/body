{
  if ((_mBeanServer == null) || (_messageBus == null)) {
    throw new IllegalStateException("MBean server and message bus are not configured");
  }
  try {
    _mBeanServer.registerMBean(new MessageBusManager(_messageBus),MessageBusManager.createObjectName());
  }
 catch (  InstanceAlreadyExistsException e) {
    _mBeanServer.unregisterMBean(MessageBusManager.createObjectName());
    _mBeanServer.registerMBean(new MessageBusManager(_messageBus),MessageBusManager.createObjectName());
  }
catch (  Exception e) {
    if (log.isWarnEnabled()) {
      log.warn("Unable to register Message Bus Manager",e);
    }
  }
  Collection<Destination> destinations=_messageBus.getDestinations();
  for (  Destination destination : destinations) {
    try {
      registerDestination(destination);
    }
 catch (    Exception e) {
      if (log.isWarnEnabled()) {
        log.warn("Unable to register destination:" + destination.getName(),e);
      }
    }
  }
}
