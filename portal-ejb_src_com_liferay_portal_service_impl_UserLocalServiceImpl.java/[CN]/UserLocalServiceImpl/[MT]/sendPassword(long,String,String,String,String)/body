{
  if (!PrefsPropsUtil.getBoolean(companyId,PropsUtil.COMPANY_SECURITY_SEND_PASSWORD) || !PrefsPropsUtil.getBoolean(companyId,PropsUtil.ADMIN_EMAIL_PASSWORD_SENT_ENABLED)) {
    return;
  }
  emailAddress=emailAddress.trim().toLowerCase();
  if (!Validator.isEmailAddress(emailAddress)) {
    throw new UserEmailAddressException();
  }
  Company company=CompanyUtil.findByPrimaryKey(companyId);
  User user=UserUtil.findByC_EA(companyId,emailAddress);
  if (PwdEncryptor.PASSWORDS_ENCRYPTED) {
    user.setPassword(PwdToolkitUtil.generate());
    user.setPasswordEncrypted(false);
    user.setPasswordReset(GetterUtil.getBoolean(PropsUtil.get(PropsUtil.PASSWORDS_CHANGE_ON_FIRST_USE)));
    UserUtil.update(user);
  }
  try {
    String fromName=PrefsPropsUtil.getString(companyId,PropsUtil.ADMIN_EMAIL_FROM_NAME);
    String fromAddress=PrefsPropsUtil.getString(companyId,PropsUtil.ADMIN_EMAIL_FROM_ADDRESS);
    String toName=user.getFullName();
    String toAddress=user.getEmailAddress();
    String subject=PrefsPropsUtil.getContent(companyId,PropsUtil.ADMIN_EMAIL_PASSWORD_SENT_SUBJECT);
    String body=PrefsPropsUtil.getContent(companyId,PropsUtil.ADMIN_EMAIL_PASSWORD_SENT_BODY);
    subject=StringUtil.replace(subject,new String[]{"[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$REMOTE_ADDRESS$]","[$REMOTE_HOST$]","[$TO_ADDRESS$]","[$TO_NAME$]","[$USER_AGENT$]","[$USER_ID$]","[$USER_PASSWORD$]"},new String[]{fromAddress,fromName,company.getPortalURL(),remoteAddr,remoteHost,toAddress,toName,userAgent,String.valueOf(user.getUserId()),user.getPassword()});
    body=StringUtil.replace(body,new String[]{"[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$REMOTE_ADDRESS$]","[$REMOTE_HOST$]","[$TO_ADDRESS$]","[$TO_NAME$]","[$USER_AGENT$]","[$USER_ID$]","[$USER_PASSWORD$]"},new String[]{fromAddress,fromName,company.getPortalURL(),remoteAddr,remoteHost,toAddress,toName,userAgent,String.valueOf(user.getUserId()),user.getPassword()});
    InternetAddress from=new InternetAddress(fromAddress,fromName);
    InternetAddress to=new InternetAddress(toAddress,toName);
    MailMessage message=new MailMessage(from,to,subject,body,true);
    MailServiceUtil.sendEmail(message);
  }
 catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
