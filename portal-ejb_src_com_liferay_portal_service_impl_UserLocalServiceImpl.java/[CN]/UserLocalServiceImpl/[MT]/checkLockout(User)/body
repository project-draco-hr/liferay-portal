{
  PasswordPolicy passwordPolicy=user.getPasswordPolicy();
  if (passwordPolicy.getLockout()) {
    Date now=new Date();
    if (user.getFailedLoginAttempts() > 0) {
      long failedLoginTime=user.getLastFailedLoginDate().getTime();
      long elapsedTime=now.getTime() - failedLoginTime;
      long requiredElapsedTime=passwordPolicy.getResetFailureCount() * 1000;
      if ((requiredElapsedTime != 0) && (elapsedTime > requiredElapsedTime)) {
        user.setLastFailedLoginDate(null);
        user.setFailedLoginAttempts(0);
      }
    }
    if (user.isLockout()) {
      long lockoutTime=user.getLockoutDate().getTime();
      long elapsedTime=now.getTime() - lockoutTime;
      long requiredElapsedTime=passwordPolicy.getResetFailureCount() * 1000;
      if ((requiredElapsedTime != 0) && (elapsedTime > requiredElapsedTime)) {
        user.setLockout(false);
        user.setLockoutDate(null);
      }
      if (user.isLockout()) {
        throw new UserLockoutException();
      }
    }
  }
}
