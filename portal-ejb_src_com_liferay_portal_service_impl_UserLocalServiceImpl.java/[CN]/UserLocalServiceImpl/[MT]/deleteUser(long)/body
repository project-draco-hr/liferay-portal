{
  if (!GetterUtil.getBoolean(PropsUtil.get(PropsUtil.USERS_DELETE))) {
    throw new RequiredUserException();
  }
  User user=UserUtil.findByPrimaryKey(userId);
  Group group=user.getGroup();
  GroupLocalServiceUtil.deleteGroup(group.getGroupId());
  ImageLocalUtil.remove(user.getCompanyId() + ".portal.user." + userId);
  PasswordPolicyRelLocalServiceUtil.deletePasswordPolicyRel(User.class.getName(),String.valueOf(userId));
  PasswordTrackerLocalServiceUtil.deletePasswordTrackers(userId);
  UserIdMapperLocalServiceUtil.deleteUserIdMappers(userId);
  DLFileRankLocalServiceUtil.deleteFileRanks(userId);
  MBBanLocalServiceUtil.deleteBansByBanUserId(userId);
  MBMessageFlagLocalServiceUtil.deleteFlags(userId);
  MBStatsUserLocalServiceUtil.deleteStatsUserByUserId(userId);
  ShoppingCartLocalServiceUtil.deleteUserCarts(userId);
  try {
    MailServiceUtil.deleteUser(userId);
  }
 catch (  RemoteException re) {
    throw new SystemException(re);
  }
  ContactLocalServiceUtil.deleteContact(user.getContactId());
  ResourceLocalServiceUtil.deleteResource(user.getCompanyId(),User.class.getName(),ResourceImpl.SCOPE_INDIVIDUAL,user.getPrimaryKey());
  UserGroupRoleLocalServiceUtil.deleteUserGroupRolesByUserId(userId);
  UserUtil.remove(userId);
}
