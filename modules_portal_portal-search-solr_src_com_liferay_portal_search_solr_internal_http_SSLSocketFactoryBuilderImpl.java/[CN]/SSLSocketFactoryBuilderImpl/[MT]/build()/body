{
  KeyStore keyStore=_keyStoreLoader.load(_keyStoreType,_keyStorePath,_keyStorePassword);
  if (keyStore == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Use system defaults because there is no custom key store");
    }
    return SSLSocketFactory.getSystemSocketFactory();
  }
  KeyStore trustKeyStore=null;
  TrustStrategy trustStrategy=null;
  if (_verifyServerCertificate) {
    trustKeyStore=_keyStoreLoader.load(_trustStoreType,_trustStorePath,_trustStorePassword);
    if (trustKeyStore == null) {
      if (_log.isDebugEnabled()) {
        _log.debug("Use system defaults because there is no custom " + "trust store");
      }
      return SSLSocketFactory.getSystemSocketFactory();
    }
  }
 else {
    trustStrategy=new TrustSelfSignedStrategy();
  }
  X509HostnameVerifier x509HostnameVerifier=SSLSocketFactory.BROWSER_COMPATIBLE_HOSTNAME_VERIFIER;
  if (!_verifyServerHostname) {
    x509HostnameVerifier=SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER;
  }
  try {
    return new SSLSocketFactory(SSLSocketFactory.TLS,keyStore,String.valueOf(_keyStorePassword),trustKeyStore,null,trustStrategy,x509HostnameVerifier);
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn("Use system defaults because the custom SSL socket " + "factory was not able to initialize",e);
    }
    return SSLSocketFactory.getSystemSocketFactory();
  }
}
