{
  Iterator itr=JournalArticleLocalServiceUtil.getArticles().iterator();
  while (itr.hasNext()) {
    JournalArticle article=(JournalArticle)itr.next();
    if (article.isTemplateDriven()) {
      SAXReader reader=new SAXReader();
      try {
        Document doc=reader.read(new StringReader(article.getContent()));
        Element root=doc.getRootElement();
        _updateImageId(article.getGroupId(),root);
        String content=JournalUtil.formatXML(doc);
        JournalArticleLocalServiceUtil.updateContent(article.getCompanyId(),article.getGroupId(),article.getArticleId(),article.getVersion(),content);
      }
 catch (      DocumentException de) {
        _log.error(de.getMessage() + "\n" + "Unable to read article "+ article.getPrimaryKey()+ " with content\n"+ article.getContent());
        throw de;
      }
    }
  }
}
