{
  if (protectionDomain == null) {
    return new LenientPermissionCollection();
  }
  Object key=_getKey(protectionDomain);
  PermissionCollection permissionCollection=null;
  if (key != null) {
    permissionCollection=_permissionCollections.get(key);
  }
  if (permissionCollection == null) {
    CodeSource codeSource=protectionDomain.getCodeSource();
    if ((codeSource != null) && (codeSource.getLocation() != null)) {
      permissionCollection=_urlPermissionCollections.get(new URLWrapper(codeSource.getLocation()));
    }
  }
  if (permissionCollection != null) {
    return permissionCollection;
  }
  PACLPolicy paclPolicy=PACLPolicyManager.getPACLPolicy(protectionDomain);
  if (paclPolicy != null) {
    permissionCollection=new PortalPermissionCollection(paclPolicy);
  }
 else {
    if (JavaDetector.isIBM()) {
      permissionCollection=_policy.getPermissions(protectionDomain);
    }
 else {
      permissionCollection=new LenientPermissionCollection();
    }
  }
  if (key != null) {
    _permissionCollections.put(key,permissionCollection);
  }
  return permissionCollection;
}
