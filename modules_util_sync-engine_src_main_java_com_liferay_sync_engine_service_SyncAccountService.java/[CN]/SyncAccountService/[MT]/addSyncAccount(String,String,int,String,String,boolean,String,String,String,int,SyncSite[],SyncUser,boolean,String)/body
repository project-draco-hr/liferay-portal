{
  SyncAccount syncAccount=new SyncAccount();
  syncAccount.setFilePathName(filePathName);
  syncAccount.setLogin(login);
  syncAccount.setMaxConnections(maxConnections);
  syncAccount.setOAuthConsumerKey(oAuthConsumerKey);
  syncAccount.setOAuthConsumerSecret(oAuthConsumerSecret);
  syncAccount.setOAuthEnabled(oAuthEnabled);
  syncAccount.setOAuthToken(oAuthToken);
  syncAccount.setOAuthTokenSecret(Encryptor.encrypt(oAuthTokenSecret));
  syncAccount.setPassword(Encryptor.encrypt(password));
  syncAccount.setPollInterval(pollInterval);
  syncAccount.setTrustSelfSigned(trustSelfSigned);
  syncAccount.setUrl(url);
  _syncAccountPersistence.create(syncAccount);
  Path filePath=Paths.get(filePathName);
  Path dataFilePath=Files.createDirectories(filePath.resolve(".data"));
  if (OSDetector.isWindows()) {
    Files.setAttribute(dataFilePath,"dos:hidden",true);
  }
  SyncFileService.addSyncFile(null,null,null,filePathName,null,String.valueOf(filePath.getFileName()),0,0,SyncFile.STATE_SYNCED,syncAccount.getSyncAccountId(),SyncFile.TYPE_SYSTEM,false);
  if (syncSites != null) {
    for (    SyncSite syncSite : syncSites) {
      String syncSiteName=syncSite.getName();
      if (!FileUtil.isValidFileName(syncSiteName)) {
        syncSiteName=String.valueOf(syncSite.getGroupId());
      }
      syncSite.setFilePathName(FileUtil.getFilePathName(syncAccount.getFilePathName(),syncSiteName));
      syncSite.setRemoteSyncTime(-1);
      syncSite.setSyncAccountId(syncAccount.getSyncAccountId());
      SyncSiteService.update(syncSite);
      SyncFileService.addSyncFile(null,null,null,syncSite.getFilePathName(),null,syncSite.getName(),0,syncSite.getGroupId(),SyncFile.STATE_SYNCED,syncSite.getSyncAccountId(),SyncFile.TYPE_SYSTEM,false);
      if (syncSite.isActive() && !Files.exists(Paths.get(syncSite.getFilePathName()))) {
        Files.createDirectories(Paths.get(syncSite.getFilePathName()));
      }
    }
  }
  if (syncUser != null) {
    syncUser.setSyncAccountId(syncAccount.getSyncAccountId());
    SyncUserService.update(syncUser);
  }
  return syncAccount;
}
