{
  String content=FileUtil.read(webXml);
  int x=content.indexOf("<display-name>");
  if (x != -1) {
    int y=content.indexOf("</display-name>",x);
    y=content.indexOf(">",y) + 1;
    content=content.substring(0,x) + content.substring(y);
  }
  double webXmlVersion=2.3;
  Document webXmlDoc=SAXReaderUtil.read(content);
  Element webXmlRoot=webXmlDoc.getRootElement();
  webXmlVersion=GetterUtil.getDouble(webXmlRoot.attributeValue("version"),webXmlVersion);
  String extraContent=getExtraContent(webXmlVersion,srcFile,displayName);
  if (webXmlVersion > 2.3) {
    while (true) {
      int pos=extraContent.indexOf("<param-name>servlet-2.4-dispatcher</param-name>");
      if (pos == -1) {
        break;
      }
      x=extraContent.lastIndexOf("<init-param>",pos);
      int y=extraContent.indexOf("</init-param>",pos);
      extraContent=extraContent.substring(0,x) + extraContent.substring(y + 13);
    }
  }
  int pos=content.indexOf("</web-app>");
  String newContent=content.substring(0,pos) + extraContent + content.substring(pos,content.length());
  newContent=StringUtil.replace(newContent,"com.liferay.portal.shared.","com.liferay.portal.kernel.");
  newContent=WebXMLBuilder.organizeWebXML(newContent);
  FileUtil.write(webXml,newContent,true);
  if (_log.isInfoEnabled()) {
    _log.info("Modifying Servlet " + webXmlVersion + " "+ webXml);
  }
}
