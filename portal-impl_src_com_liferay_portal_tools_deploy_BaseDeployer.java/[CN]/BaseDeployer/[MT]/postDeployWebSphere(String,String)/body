{
  if (Validator.isNull(PropsValues.AUTO_DEPLOY_WEBSPHERE_WSADMIN_APP_MANAGER_QUERY)) {
    if (_log.isInfoEnabled()) {
      StringBundler sb=new StringBundler();
      sb.append("Do not install the plugin with wsadmin since the ");
      sb.append("property \"");
      sb.append(PropsKeys.AUTO_DEPLOY_WEBSPHERE_WSADMIN_APP_MANAGER_QUERY);
      sb.append("\"is not configured");
      _log.info(sb.toString());
    }
    return;
  }
  String wsadminContent=FileUtil.read(DeployUtil.getResourcePath("wsadmin.py"));
  String pluginServletContextName=deployDir.substring(0,deployDir.length() - 4);
  String pluginApplicationName=pluginServletContextName;
  if (Validator.isNotNull(PropsValues.AUTO_DEPLOY_WEBSPHERE_WSADMIN_APP_NAME_SUFFIX)) {
    pluginApplicationName=pluginApplicationName + StringPool.UNDERLINE + PropsValues.AUTO_DEPLOY_WEBSPHERE_WSADMIN_APP_NAME_SUFFIX;
  }
  wsadminContent=StringUtil.replace(wsadminContent,new String[]{"${auto.deploy.dest.dir}","${auto.deploy.websphere.wsadmin.app.manager.query}","${auto.deploy.websphere.wsadmin.app.name}","${plugin.servlet.context.name}"},new String[]{destDir,PropsValues.AUTO_DEPLOY_WEBSPHERE_WSADMIN_APP_MANAGER_QUERY,pluginApplicationName,pluginServletContextName});
  String wsadminFileName=FileUtil.createTempFileName("py");
  FileUtil.write(wsadminFileName,wsadminContent);
  String webSphereHome=System.getenv("WAS_HOME");
  List<String> commands=new ArrayList<String>();
  if (OSDetector.isWindows()) {
    commands.add(webSphereHome + "\\bin\\wsadmin.bat");
  }
 else {
    commands.add(webSphereHome + "/bin/wsadmin.sh");
  }
  if (Validator.isNotNull(PropsValues.AUTO_DEPLOY_WEBSPHERE_WSADMIN_PROPERTIES_FILE)) {
    commands.add("-p");
    commands.add(PropsValues.AUTO_DEPLOY_WEBSPHERE_WSADMIN_PROPERTIES_FILE);
  }
  commands.add("-f");
  commands.add(wsadminFileName);
  if (_log.isInfoEnabled()) {
    StringBundler sb=new StringBundler(commands.size() + 1);
    sb.append("Installing plugin by executing");
    for (    String command : commands) {
      sb.append(StringPool.SPACE);
      sb.append(command);
    }
    _log.info(sb.toString());
  }
  ProcessBuilder processBuilder=new ProcessBuilder(commands);
  processBuilder.redirectErrorStream(true);
  Process process=processBuilder.start();
  if (_log.isInfoEnabled()) {
    InputStream inputStream=process.getInputStream();
    String output=StringUtil.read(inputStream);
    for (    String line : StringUtil.split(output,CharPool.NEW_LINE)) {
      _log.info("Process output: " + line);
    }
    int exitValue=process.exitValue();
    if (exitValue == 0) {
      _log.info("Successfully executed command with an exit value of " + exitValue);
    }
 else {
      _log.info("Unsuccessfully executed command with an exit value of " + exitValue);
    }
  }
  FileUtil.delete(wsadminFileName);
}
