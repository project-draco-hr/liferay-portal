{
  CharPipe charPipe=new CharPipe(4);
  Reader reader=charPipe.getReader();
  Writer writer=charPipe.getWriter();
  char[] data="abcd".toCharArray();
  char[] readBuffer=new char[4];
  writer.write(data);
  int result=reader.read(readBuffer,0,3);
  assertEquals(3,result);
  assertEquals('a',readBuffer[0]);
  assertEquals('b',readBuffer[1]);
  assertEquals('c',readBuffer[2]);
  writer.write(data,0,3);
  result=reader.read(readBuffer);
  assertEquals(4,result);
  assertEquals('d',readBuffer[0]);
  assertEquals('a',readBuffer[1]);
  assertEquals('b',readBuffer[2]);
  assertEquals('c',readBuffer[3]);
  writer.write(data);
  result=reader.read(readBuffer);
  assertEquals(4,result);
  assertEquals('a',readBuffer[0]);
  assertEquals('b',readBuffer[1]);
  assertEquals('c',readBuffer[2]);
  assertEquals('d',readBuffer[3]);
  charPipe.close();
}
