{
  final CharPipe charPipe=new CharPipe();
  Reader reader=charPipe.getReader();
  final AtomicLong timeStampBeforeClose=new AtomicLong();
  Thread thread=new Thread(){
    public void run(){
      try {
        timeStampBeforeClose.set(System.currentTimeMillis());
        charPipe.close();
      }
 catch (      Exception e) {
        fail(e.getMessage());
      }
    }
  }
;
  thread.start();
  int result=reader.read();
  long timeStampAfterRead=System.currentTimeMillis();
  thread.join();
  assertEquals(-1,result);
  assertTrue(timeStampAfterRead >= timeStampBeforeClose.get());
}
