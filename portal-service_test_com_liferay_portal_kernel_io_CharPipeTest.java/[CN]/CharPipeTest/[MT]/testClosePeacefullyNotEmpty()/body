{
  CharPipe charPipe=new CharPipe();
  charPipe.getWriter().write("abcd");
  assertFalse(charPipe.finished);
  charPipe.close();
  assertNotNull(charPipe.buffer);
  assertTrue(charPipe.finished);
  char[] readBuffer=new char[5];
  Reader reader=charPipe.getReader();
  int result=reader.read(readBuffer);
  assertEquals(4,result);
  assertEquals('a',readBuffer[0]);
  assertEquals('b',readBuffer[1]);
  assertEquals('c',readBuffer[2]);
  assertEquals('d',readBuffer[3]);
  assertEquals(0,readBuffer[4]);
  assertEquals(-1,reader.read());
}
