{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  try {
    StringBundler bodyContentSB=getBodyContentAsStringBundler();
    if (isPositionInLine()) {
      ScriptData scriptData=new ScriptData();
      request.setAttribute(ScriptTag.class.getName(),scriptData);
      scriptData.append(bodyContentSB,_use);
      if (FileAvailabilityUtil.isAvailable(pageContext.getServletContext(),PAGE)) {
        PortalIncludeUtil.include(pageContext,PAGE);
      }
 else {
        processEndTag(scriptData);
      }
    }
 else {
      ScriptData scriptData=(ScriptData)request.getAttribute(WebKeys.AUI_SCRIPT_DATA);
      if (scriptData == null) {
        scriptData=new ScriptData();
        request.setAttribute(WebKeys.AUI_SCRIPT_DATA,scriptData);
      }
      scriptData.append(bodyContentSB,_use);
    }
    return EVAL_PAGE;
  }
 catch (  Exception e) {
    throw new JspException(e);
  }
 finally {
    if (isPositionInLine()) {
      request.removeAttribute(ScriptTag.class.getName());
    }
    if (!ServerDetector.isResin()) {
      cleanUp();
    }
  }
}
