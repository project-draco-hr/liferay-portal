{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  String position=_position;
  String fragmentId=ParamUtil.getString(request,"p_f_id");
  if (Validator.isNotNull(fragmentId)) {
    position=_POSITION_INLINE;
  }
  try {
    if (Validator.isNull(position)) {
      ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
      if (themeDisplay.isIsolated() || themeDisplay.isLifecycleResource() || themeDisplay.isStateExclusive()) {
        position=_POSITION_INLINE;
      }
 else {
        position=_POSITION_AUTO;
      }
    }
    StringBundler bodyContentSB=getBodyContentAsStringBundler();
    if (position.equals(_POSITION_INLINE)) {
      ScriptData scriptData=new ScriptData();
      request.setAttribute(ScriptTag.class.getName(),scriptData);
      scriptData.append(bodyContentSB,_use);
      processEndTag(scriptData);
    }
 else {
      ScriptData scriptData=(ScriptData)request.getAttribute(WebKeys.AUI_SCRIPT_DATA);
      if (scriptData == null) {
        scriptData=new ScriptData();
        request.setAttribute(WebKeys.AUI_SCRIPT_DATA,scriptData);
      }
      scriptData.append(bodyContentSB,_use);
    }
    return EVAL_PAGE;
  }
 catch (  Exception e) {
    throw new JspException(e);
  }
 finally {
    if (position.equals(_POSITION_INLINE)) {
      request.removeAttribute(ScriptTag.class.getName());
    }
    if (!ServerDetector.isResin()) {
      cleanUp();
    }
  }
}
