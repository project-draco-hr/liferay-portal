{
  int minSize=index + ensureExtraSpace;
  if (minSize < 0) {
    throw new OutOfMemoryError();
  }
  int oldSize=buffer.length;
  if (minSize > oldSize) {
    int newSize=oldSize << 1;
    if (newSize < minSize) {
      newSize=minSize;
    }
    buffer=Arrays.copyOf(buffer,newSize);
  }
  return buffer;
}
