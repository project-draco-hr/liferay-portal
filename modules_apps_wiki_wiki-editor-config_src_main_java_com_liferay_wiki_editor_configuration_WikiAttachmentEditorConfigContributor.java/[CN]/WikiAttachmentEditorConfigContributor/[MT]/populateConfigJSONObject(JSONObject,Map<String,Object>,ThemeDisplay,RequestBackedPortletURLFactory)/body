{
  boolean allowBrowseDocuments=GetterUtil.getBoolean(inputEditorTaglibAttributes.get("liferay-ui:input-editor:allowBrowseDocuments"));
  if (!allowBrowseDocuments) {
    return;
  }
  Map<String,String> fileBrowserParamsMap=(Map<String,String>)inputEditorTaglibAttributes.get("liferay-ui:input-editor:fileBrowserParams");
  long wikiPageResourcePrimKey=0;
  if (fileBrowserParamsMap != null) {
    wikiPageResourcePrimKey=GetterUtil.getLong(fileBrowserParamsMap.get("wikiPageResourcePrimKey"));
  }
  if (wikiPageResourcePrimKey == 0) {
    removeImageButton(jsonObject);
    return;
  }
  String extraPlugins=jsonObject.getString("extraPlugins");
  if (Validator.isNotNull(extraPlugins)) {
    extraPlugins+=",itemselector,media";
  }
 else {
    extraPlugins="itemselector,media";
  }
  jsonObject.put("extraPlugins",extraPlugins);
  ItemSelectorCriterion attachmentItemSelectorCriterion=new WikiAttachmentItemSelectorCriterion(wikiPageResourcePrimKey);
  List<ItemSelectorReturnType> desiredItemSelectorReturnTypes=new ArrayList<>();
  desiredItemSelectorReturnTypes.add(new UploadableFileReturnType());
  desiredItemSelectorReturnTypes.add(new FileEntryItemSelectorReturnType());
  attachmentItemSelectorCriterion.setDesiredItemSelectorReturnTypes(desiredItemSelectorReturnTypes);
  PortletURL uploadURL=requestBackedPortletURLFactory.createActionURL(WikiPortletKeys.WIKI);
  uploadURL.setParameter(ActionRequest.ACTION_NAME,"/wiki/upload_page_attachment");
  uploadURL.setParameter("resourcePrimKey",String.valueOf(wikiPageResourcePrimKey));
  ItemSelectorCriterion uploadItemSelectorCriterion=new UploadItemSelectorCriterion(uploadURL.toString(),LanguageUtil.get(themeDisplay.getLocale(),"page-attachments"));
  List<ItemSelectorReturnType> uploadDesiredItemSelectorReturnTypes=new ArrayList<>();
  uploadDesiredItemSelectorReturnTypes.add(new UploadableFileReturnType());
  uploadItemSelectorCriterion.setDesiredItemSelectorReturnTypes(uploadDesiredItemSelectorReturnTypes);
  String name=GetterUtil.getString(inputEditorTaglibAttributes.get("liferay-ui:input-editor:name"));
  boolean inlineEdit=GetterUtil.getBoolean(inputEditorTaglibAttributes.get("liferay-ui:input-editor:inlineEdit"));
  if (!inlineEdit) {
    String namespace=GetterUtil.getString(inputEditorTaglibAttributes.get("liferay-ui:input-editor:namespace"));
    name=namespace + name;
  }
  PortletURL itemSelectorURL=_itemSelector.getItemSelectorURL(requestBackedPortletURLFactory,name + "selectItem",attachmentItemSelectorCriterion,uploadItemSelectorCriterion);
  jsonObject.put("filebrowserImageBrowseLinkUrl",itemSelectorURL.toString());
  jsonObject.put("filebrowserImageBrowseUrl",itemSelectorURL.toString());
}
