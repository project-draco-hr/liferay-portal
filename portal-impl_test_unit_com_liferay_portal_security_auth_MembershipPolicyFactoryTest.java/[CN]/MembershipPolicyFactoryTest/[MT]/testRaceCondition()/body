{
  Thread hookThread=new Thread(){
    @Override public void run(){
      MembershipPolicy membershipPolicy=new DefaultMembershipPolicy();
      while (!isInterrupted()) {
        MembershipPolicyFactory.setInstance(membershipPolicy);
        MembershipPolicyFactory.setInstance(null);
      }
    }
  }
;
  hookThread.start();
  int loopTimes=10000;
  for (int i=0; i < loopTimes; i++) {
    MembershipPolicy membershipPolicy=MembershipPolicyFactory.getInstance();
    if (membershipPolicy == null) {
      Assert.fail("Got a null MembershipPolicy at " + i);
    }
  }
  hookThread.interrupt();
  hookThread.join();
}
