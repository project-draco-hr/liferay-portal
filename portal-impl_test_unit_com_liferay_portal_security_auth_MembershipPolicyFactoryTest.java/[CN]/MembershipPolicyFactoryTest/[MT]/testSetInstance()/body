{
  Thread thread=new Thread(){
    @Override public void run(){
      MembershipPolicy membershipPolicy=new DefaultMembershipPolicy();
      while (!isInterrupted()) {
        MembershipPolicyFactory.setInstance(membershipPolicy);
        MembershipPolicyFactory.setInstance(null);
      }
    }
  }
;
  thread.start();
  for (int i=0; i < 10000; i++) {
    MembershipPolicy membershipPolicy=MembershipPolicyFactory.getInstance();
    if (membershipPolicy == null) {
      Assert.fail("Membership policy is null");
    }
  }
  thread.interrupt();
  thread.join();
}
