{
  BBCodeItem nextItem=null;
  if (_regexStringIsNewLine.matcher(data).matches()) {
    nextItem=_parsedData.get(_itemPointer + 1);
    if (nextItem != null) {
      String nextItemValue=nextItem.getValue();
      if (_mapTokensExcludeNewLine.containsKey(nextItemValue)) {
        int nextItemType=nextItem.getType();
        int mappedValue=_mapTokensExcludeNewLine.get(nextItemValue);
        if ((nextItemType & mappedValue) > 0) {
          data=StringPool.BLANK;
        }
      }
    }
  }
 else   if (_regexLastCharNewLine.matcher(data).matches()) {
    nextItem=_parsedData.get(_itemPointer + 1);
    if (nextItem != null && (nextItem.getType() == TOKEN_TAG_END) && (nextItem.getValue().equals(STR_TAG_LIST_ITEM_SHORT))) {
      data=data.substring(0,data.length() - 1);
    }
  }
  if (!data.isEmpty()) {
    data=_regexNewLine.matcher(data).replaceAll(STR_TAG_BR);
  }
  return data;
}
