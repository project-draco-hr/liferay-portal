{
  String portletId=null;
  if (isPortletInstanceable()) {
    portletId=routeParameters.remove("p_p_id");
    if (Validator.isNull(portletId)) {
      String instanceId=routeParameters.remove("instanceId");
      if (Validator.isNull(instanceId)) {
        if (_log.isErrorEnabled()) {
          _log.error("Either p_p_id or instanceId must be provided " + "for an instanceable portlet");
        }
        return null;
      }
 else {
        portletId=getPortletId() + PortletConstants.INSTANCE_SEPARATOR + instanceId;
      }
    }
  }
 else {
    portletId=getPortletId();
  }
  return portletId;
}
