{
  Map<String,String[]> portletURLParameters=portletURL.getParameterMap();
  Map<String,String[]> parameters=new HashMap<String,String[]>(portletURLParameters);
  WindowState windowState=portletURL.getWindowState();
  addParameter(parameters,"p_p_state",windowState);
  addParameter(parameters,"p_p_lifecycle",getLifecycle(portletURL));
  String friendlyURLPath=router.parametersToUrl(parameters);
  if (friendlyURLPath == null) {
    return null;
  }
  for (  String name : portletURLParameters.keySet()) {
    if (!parameters.containsKey(name)) {
      portletURL.addParameterIncludedInPath(name);
    }
  }
  portletURL.addParameterIncludedInPath("p_p_id");
  friendlyURLPath=StringPool.SLASH.concat(getMapping()).concat(friendlyURLPath);
  return friendlyURLPath;
}
