{
  Map<String,String[]> portletURLParameters=portletURL.getParameterMap();
  for (  Map.Entry<String,String[]> entry : portletURLParameters.entrySet()) {
    String[] values=entry.getValue();
    if (values.length > 0) {
      routeParameters.put(entry.getKey(),values[0]);
    }
  }
  if (isPortletInstanceable()) {
    String portletId=portletURL.getPortletId();
    routeParameters.put("p_p_id",portletId);
    if (Validator.isNotNull(portletId)) {
      String[] parts=portletId.split(PortletConstants.INSTANCE_SEPARATOR);
      if (parts.length > 1) {
        routeParameters.put("instanceId",parts[1]);
      }
    }
  }
  routeParameters.putAll(portletURL.getReservedParameterMap());
}
