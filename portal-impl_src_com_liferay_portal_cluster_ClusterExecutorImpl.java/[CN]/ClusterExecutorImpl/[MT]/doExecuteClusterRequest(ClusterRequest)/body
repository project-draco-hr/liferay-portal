{
  boolean isMulticast=clusterRequest.isMulticast();
  List<Address> addresses=null;
  if (isMulticast) {
    addresses=getControlAddresses();
  }
 else {
    Collection<String> clusterNodeIds=clusterRequest.getTargetClusterNodeIds();
    addresses=new ArrayList<Address>(clusterNodeIds.size());
    for (    String clusterNodeId : clusterNodeIds) {
      Address address=getAddress(clusterNodeId);
      addresses.add(address);
    }
  }
  Address localControlAddress=getLocalControlAddress();
  FutureClusterResponses futureClusterResponses=new FutureClusterResponses(addresses);
  String uuid=clusterRequest.getUuid();
  Reference<FutureClusterResponses> reference=FinalizeService.register(futureClusterResponses,new RemoveResultKeyFinalizeAction(uuid));
  if (!clusterRequest.isFireAndForget()) {
    _executionResultMap.put(uuid,reference);
  }
  if (clusterRequest.isSkipLocal()) {
    addresses.remove(localControlAddress);
  }
 else   if (_shortcutLocalMethod) {
    ClusterNodeResponse clusterNodeResponse=runLocalMethod(clusterRequest.getMethodWrapper());
    clusterNodeResponse.setMulticast(isMulticast);
    clusterNodeResponse.setUuid(clusterRequest.getUuid());
    futureClusterResponses.addClusterNodeResponse(clusterNodeResponse);
    addresses.remove(localControlAddress);
  }
  if (isMulticast) {
    try {
      _controlChannel.send(null,null,clusterRequest);
    }
 catch (    ChannelException ce) {
      _log.error("Unable to send multicast message " + clusterRequest,ce);
      throw new SystemException("Unable to send multicast request",ce);
    }
  }
 else {
    for (    Address address : addresses) {
      org.jgroups.Address jGroupsAddress=(org.jgroups.Address)address.getRealAddress();
      try {
        _controlChannel.send(jGroupsAddress,null,clusterRequest);
      }
 catch (      ChannelException ce) {
        _log.error("Unable to send unicast message " + clusterRequest,ce);
        throw new SystemException("Unable to send unicast request",ce);
      }
    }
  }
  return futureClusterResponses;
}
