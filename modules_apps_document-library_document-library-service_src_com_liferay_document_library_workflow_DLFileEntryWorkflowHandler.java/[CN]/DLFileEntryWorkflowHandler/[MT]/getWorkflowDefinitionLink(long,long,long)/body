{
  DLFileVersion dlFileVersion=_dlFileVersionLocalService.getFileVersion(classPK);
  long folderId=dlFileVersion.getFolderId();
  while (folderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    DLFolder dlFolder=_dlFolderLocalService.getFolder(folderId);
    if (dlFolder.getRestrictionType() != DLFolderConstants.RESTRICTION_TYPE_INHERIT) {
      break;
    }
    folderId=dlFolder.getParentFolderId();
  }
  WorkflowDefinitionLink workflowDefinitionLink=_workflowDefinitionLinkLocalService.fetchWorkflowDefinitionLink(companyId,groupId,DLFolder.class.getName(),folderId,dlFileVersion.getFileEntryTypeId(),true);
  if (workflowDefinitionLink == null) {
    workflowDefinitionLink=_workflowDefinitionLinkLocalService.fetchWorkflowDefinitionLink(companyId,groupId,DLFolder.class.getName(),folderId,DLFileEntryTypeConstants.FILE_ENTRY_TYPE_ID_ALL,true);
  }
  return workflowDefinitionLink;
}
