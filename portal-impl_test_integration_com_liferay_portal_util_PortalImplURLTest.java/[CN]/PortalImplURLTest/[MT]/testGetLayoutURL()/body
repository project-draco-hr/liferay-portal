{
  Company company=CompanyLocalServiceUtil.getCompany(TestPropsValues.getCompanyId());
  String virtualHostname="test.com";
  company.setVirtualHostname(virtualHostname);
  Group group=GroupTestUtil.addGroup();
  long siteGroupId=PortalUtil.getSiteGroupId(group.getGroupId());
  User user=TestPropsValues.getUser();
  Layout layout=LayoutTestUtil.addLayout(group.getGroupId(),ServiceTestUtil.randomString());
  ThemeDisplay themeDisplay=new ThemeDisplay();
  themeDisplay.setCompany(company);
  themeDisplay.setI18nLanguageId(StringPool.BLANK);
  themeDisplay.setLayout(layout);
  themeDisplay.setLayoutSet(layout.getLayoutSet());
  themeDisplay.setSecure(false);
  themeDisplay.setServerName(virtualHostname);
  themeDisplay.setServerPort(8080);
  themeDisplay.setSiteGroupId(siteGroupId);
  themeDisplay.setUser(user);
  themeDisplay.setWidget(false);
  String friendlyURLUsingVirtualHost=PortalUtil.getLayoutURL(layout,themeDisplay,false);
  themeDisplay.setServerName("localhost");
  String friendlyURLUsingLocalhost=PortalUtil.getLayoutURL(layout,themeDisplay,false);
  Assert.assertEquals(friendlyURLUsingLocalhost,friendlyURLUsingVirtualHost);
  long controlPanelPlid=PortalUtil.getControlPanelPlid(company.getCompanyId());
  Layout controlPanelLayout=LayoutLocalServiceUtil.getLayout(controlPanelPlid);
  themeDisplay.setLayout(controlPanelLayout);
  themeDisplay.setLayoutSet(controlPanelLayout.getLayoutSet());
  String friendlyURLFromControlPanelUsingLocalhost=PortalUtil.getLayoutURL(layout,themeDisplay,false);
  themeDisplay.setServerName(virtualHostname);
  String friendlyURLFromControlPanelUsingVirtualHost=PortalUtil.getLayoutURL(layout,themeDisplay,false);
  Assert.assertEquals(friendlyURLUsingVirtualHost,friendlyURLFromControlPanelUsingVirtualHost);
  Assert.assertEquals(friendlyURLFromControlPanelUsingLocalhost,friendlyURLFromControlPanelUsingVirtualHost);
}
