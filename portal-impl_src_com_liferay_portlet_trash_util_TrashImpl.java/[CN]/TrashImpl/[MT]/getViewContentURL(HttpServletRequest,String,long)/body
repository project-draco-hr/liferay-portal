{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (!themeDisplay.isSignedIn() || !isTrashEnabled(themeDisplay.getScopeGroupId()) || !PortletPermissionUtil.hasControlPanelAccessPermission(themeDisplay.getPermissionChecker(),themeDisplay.getScopeGroupId(),PortletKeys.TRASH)) {
    return null;
  }
  TrashHandler trashHandler=TrashHandlerRegistryUtil.getTrashHandler(className);
  if (trashHandler.isInTrashContainer(classPK)) {
    TrashEntry trashEntry=trashHandler.getTrashEntry(classPK);
    className=trashEntry.getClassName();
    classPK=trashEntry.getClassPK();
    trashHandler=TrashHandlerRegistryUtil.getTrashHandler(className);
  }
  TrashRenderer trashRenderer=trashHandler.getTrashRenderer(classPK);
  if (trashRenderer == null) {
    return null;
  }
  Layout layout=themeDisplay.getLayout();
  PortletURL portletURL=PortalUtil.getControlPanelPortletURL(request,PortletKeys.TRASH,layout.getLayoutId(),PortletRequest.RENDER_PHASE);
  portletURL.setParameter("mvcPath","/html/portlet/trash/view_content.jsp");
  portletURL.setParameter("redirect",themeDisplay.getURLCurrent());
  portletURL.setParameter("status",String.valueOf(WorkflowConstants.STATUS_IN_TRASH));
  TrashEntry trashEntry=TrashEntryLocalServiceUtil.getEntry(className,classPK);
  if (trashEntry.getRootEntry() != null) {
    portletURL.setParameter("className",className);
    portletURL.setParameter("classPK",String.valueOf(classPK));
  }
 else {
    portletURL.setParameter("trashEntryId",String.valueOf(trashEntry.getEntryId()));
  }
  portletURL.setParameter("type",trashRenderer.getType());
  portletURL.setParameter("showActions",Boolean.FALSE.toString());
  portletURL.setParameter("showAssetMetadata",Boolean.TRUE.toString());
  portletURL.setParameter("showEditURL",Boolean.FALSE.toString());
  return portletURL;
}
