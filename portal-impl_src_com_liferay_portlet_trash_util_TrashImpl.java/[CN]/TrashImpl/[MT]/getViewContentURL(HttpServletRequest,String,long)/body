{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String portletId=PortletProviderUtil.getPortletId(TrashEntry.class.getName(),PortletProvider.Action.VIEW);
  if (!themeDisplay.isSignedIn() || !isTrashEnabled(themeDisplay.getScopeGroupId()) || !PortletPermissionUtil.hasControlPanelAccessPermission(themeDisplay.getPermissionChecker(),themeDisplay.getScopeGroupId(),portletId)) {
    return null;
  }
  TrashHandler trashHandler=TrashHandlerRegistryUtil.getTrashHandler(className);
  if (trashHandler.isInTrashContainer(classPK)) {
    TrashEntry trashEntry=trashHandler.getTrashEntry(classPK);
    className=trashEntry.getClassName();
    classPK=trashEntry.getClassPK();
    trashHandler=TrashHandlerRegistryUtil.getTrashHandler(className);
  }
  TrashRenderer trashRenderer=trashHandler.getTrashRenderer(classPK);
  if (trashRenderer == null) {
    return null;
  }
  Layout layout=themeDisplay.getLayout();
  PortletURL portletURL=PortalUtil.getControlPanelPortletURL(request,portletId,layout.getLayoutId(),PortletRequest.RENDER_PHASE);
  portletURL.setParameter("mvcPath","/view_content.jsp");
  portletURL.setParameter("redirect",themeDisplay.getURLCurrent());
  TrashEntry trashEntry=TrashEntryLocalServiceUtil.getEntry(className,classPK);
  if (trashEntry.getRootEntry() != null) {
    portletURL.setParameter("className",className);
    portletURL.setParameter("classPK",String.valueOf(classPK));
  }
 else {
    portletURL.setParameter("trashEntryId",String.valueOf(trashEntry.getEntryId()));
  }
  portletURL.setParameter("showAssetMetadata",Boolean.TRUE.toString());
  return portletURL;
}
