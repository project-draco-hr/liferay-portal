{
  DDMForm parentDDMForm=DDMFormTestUtil.createDDMForm();
  DDMFormField nameDDMFormField=DDMFormTestUtil.createTextDDMFormField("Name",true,false,false);
  nameDDMFormField.addNestedDDMFormField(DDMFormTestUtil.createTextDDMFormField("Age",true,false,false));
  parentDDMForm.addDDMFormField(nameDDMFormField);
  DDMStructure parentStructure=ddmStructureTestHelper.addStructure(parentDDMForm,StorageType.JSON.toString());
  DDMForm childDDMForm=DDMFormTestUtil.createDDMForm();
  DDMFormField descriptionDDMFormField=DDMFormTestUtil.createTextDDMFormField("Description",true,false,false);
  childDDMForm.addDDMFormField(descriptionDDMFormField);
  DDMStructure childStructure=ddmStructureTestHelper.addStructure(parentStructure.getStructureId(),parentStructure.getClassNameId(),null,"Child Structure",StringPool.BLANK,childDDMForm,DDMUtil.getDefaultDDMFormLayout(childDDMForm),StorageType.JSON.toString(),DDMStructureConstants.TYPE_DEFAULT);
  Map<String,DDMFormField> childFullHierarchyDDMFormFieldsMap=childStructure.getFullHierarchyDDMFormFieldsMap(true);
  Assert.assertTrue(childFullHierarchyDDMFormFieldsMap.containsKey("Name"));
  Assert.assertTrue(childFullHierarchyDDMFormFieldsMap.containsKey("Age"));
  Assert.assertTrue(childFullHierarchyDDMFormFieldsMap.containsKey("Description"));
  DDMForm parentDDMFormUpdated=DDMFormTestUtil.createDDMForm();
  parentDDMFormUpdated.addDDMFormField(nameDDMFormField);
  parentStructure.setDDMForm(parentDDMFormUpdated);
  DDMStructureLocalServiceUtil.updateDDMStructure(parentStructure);
  childStructure=DDMStructureLocalServiceUtil.getStructure(childStructure.getStructureId());
  childFullHierarchyDDMFormFieldsMap=childStructure.getFullHierarchyDDMFormFieldsMap(true);
  Assert.assertTrue(childFullHierarchyDDMFormFieldsMap.containsKey("Name"));
  Assert.assertTrue(childFullHierarchyDDMFormFieldsMap.containsKey("Description"));
}
