{
  User user=userPersistence.findByPrimaryKey(serviceContext.getGuestOrUserId());
  Date now=new Date();
  long kaleoTaskAssignmentInstanceId=counterLocalService.increment();
  KaleoTaskAssignmentInstance kaleoTaskAssignmentInstance=kaleoTaskAssignmentInstancePersistence.create(kaleoTaskAssignmentInstanceId);
  kaleoTaskAssignmentInstance.setGroupId(groupId);
  kaleoTaskAssignmentInstance.setCompanyId(user.getCompanyId());
  kaleoTaskAssignmentInstance.setUserId(user.getUserId());
  kaleoTaskAssignmentInstance.setUserName(user.getFullName());
  kaleoTaskAssignmentInstance.setCreateDate(now);
  kaleoTaskAssignmentInstance.setModifiedDate(now);
  kaleoTaskAssignmentInstance.setKaleoDefinitionId(kaleoTaskInstanceToken.getKaleoDefinitionId());
  kaleoTaskAssignmentInstance.setKaleoInstanceId(kaleoTaskInstanceToken.getKaleoInstanceId());
  kaleoTaskAssignmentInstance.setKaleoTaskInstanceTokenId(kaleoTaskInstanceToken.getKaleoTaskInstanceTokenId());
  kaleoTaskAssignmentInstance.setKaleoTaskId(kaleoTaskInstanceToken.getKaleoTaskId());
  kaleoTaskAssignmentInstance.setKaleoTaskName(kaleoTaskInstanceToken.getKaleoTaskName());
  kaleoTaskAssignmentInstance.setAssigneeClassName(assigneeClassName);
  if ((assigneeClassPK == 0) && assigneeClassName.equals(User.class.getName())) {
    KaleoInstance kaleoInstance=kaleoInstancePersistence.findByPrimaryKey(kaleoTaskInstanceToken.getKaleoInstanceId());
    kaleoTaskAssignmentInstance.setAssigneeClassPK(kaleoInstance.getUserId());
  }
 else {
    kaleoTaskAssignmentInstance.setAssigneeClassPK(assigneeClassPK);
  }
  kaleoTaskAssignmentInstance.setCompleted(false);
  kaleoTaskAssignmentInstancePersistence.update(kaleoTaskAssignmentInstance);
  return kaleoTaskAssignmentInstance;
}
