{
  ClusterNode newClusterNode=new ClusterNode("12345",_localhostInetAddress);
  newClusterNode.setPortalProtocol(Http.HTTP);
  ClusterEvent clusterEvent=ClusterEvent.join(newClusterNode);
  _mockClusterExecutor.reset();
  _mockClusterExecutor.setNodeNumber(2);
  _fireClusterEventListeners(clusterEvent);
  Assert.assertEquals(_COMPANY_ID,LuceneClusterUtilAdvice.getCompanyId());
  _mockClusterExecutor.reset();
  _mockClusterExecutor.setNodeNumber(3);
  List<LogRecord> logRecords=_captureHandler.resetLogLevel(Level.FINE);
  _fireClusterEventListeners(clusterEvent);
  Assert.assertEquals(1,logRecords.size());
  _assertLogger(logRecords.get(0),"Number of original cluster members is greater than one",null);
  Assert.assertNotEquals(_COMPANY_ID,LuceneClusterUtilAdvice.getCompanyId());
  _mockClusterExecutor.reset();
  _mockClusterExecutor.setNodeNumber(3);
  logRecords=_captureHandler.resetLogLevel(Level.INFO);
  _fireClusterEventListeners(clusterEvent);
  Assert.assertTrue(logRecords.isEmpty());
  Assert.assertNotEquals(_COMPANY_ID,LuceneClusterUtilAdvice.getCompanyId());
}
