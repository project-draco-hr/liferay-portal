{
  MockServer mockServer=new MockServer();
  mockServer.start();
  InetAddress inetAddress=mockServer.getInetAddress();
  int port=mockServer.getPort();
  _mockClusterExecutor.setNodeNumber(2);
  _mockClusterExecutor.setPort(port);
  _mockClusterExecutor.setPortalInetAddress(inetAddress);
  _clusterNode.setPortalInetSocketAddress(new InetSocketAddress(inetAddress,port));
  CaptureHandler captureHandler=JDKLoggerTestUtil.configureJDKLogger(LuceneHelperImpl.class.getName(),Level.OFF);
  try {
    ClusterEvent clusterEvent=ClusterEvent.join(_clusterNode);
    _fireClusterEventListeners(clusterEvent);
    byte[] responseMessage=_mockIndexAccessor.getResponseMessage();
    Assert.assertArrayEquals(_RESPONSE_MESSAGE,responseMessage);
  }
  finally {
    captureHandler.close();
  }
  mockServer.join();
}
