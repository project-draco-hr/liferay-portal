{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  long fileEntryId=ParamUtil.getLong(uploadPortletRequest,"fileEntryId");
  String sourceFileName=uploadPortletRequest.getFileName("imageEditorFileName");
  FileEntry fileEntry=_dlAppLocalService.getFileEntry(fileEntryId);
  InputStream inputStream=uploadPortletRequest.getFileAsStream("imageEditorFileName");
  String contentType=uploadPortletRequest.getContentType("imageEditorFileName");
  long size=uploadPortletRequest.getSize("imageEditorFileName");
  ServiceContext serviceContext=ServiceContextFactory.getInstance(DLFileEntry.class.getName(),uploadPortletRequest);
  fileEntry=_dlAppService.updateFileEntry(fileEntryId,sourceFileName,contentType,fileEntry.getTitle(),fileEntry.getDescription(),StringPool.BLANK,false,inputStream,size,serviceContext);
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
  jsonObject.put("success",Boolean.TRUE);
  ResourceBundle resourceBundle=_resourceBundleLoader.loadResourceBundle(LanguageUtil.getLanguageId(themeDisplay.getLocale()));
  SessionMessages.add(actionRequest,"requestProcessed",LanguageUtil.get(resourceBundle,"the-image-was-edited-successfully"));
  JSONPortletResponseUtil.writeJSON(actionRequest,actionResponse,jsonObject);
  return fileEntry;
}
