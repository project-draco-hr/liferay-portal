{
  try {
    String userName=ParamUtil.getString(req,"user_name");
    User user=PortalUtil.getUser(req);
    Contact contact=user.getContact();
    String emailAddress=userName + "@" + user.getCompanyMx();
    AdminUtil.updateUser(req,user.getUserId(),emailAddress,user.getLanguageId(),user.getTimeZoneId(),user.getGreeting(),user.getResolution(),user.getComments(),contact.getSmsSn(),contact.getAimSn(),contact.getIcqSn(),contact.getJabberSn(),contact.getMsnSn(),contact.getSkypeSn(),contact.getYmSn());
    SessionMessages.add(req,RegisterAction.class.getName());
    setForward(req,"portlet.mail.register");
  }
 catch (  Exception e) {
    if (e != null && e instanceof DuplicateUserEmailAddressException || e instanceof UserEmailAddressException) {
      SessionErrors.add(req,e.getClass().getName());
      setForward(req,"portlet.mail.register");
    }
 else {
      req.setAttribute(PageContext.EXCEPTION,e);
      setForward(req,Constants.COMMON_ERROR);
    }
  }
}
