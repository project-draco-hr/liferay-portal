{
  JSONObject jsonObject=JSONFactoryUtil.createJSONObject(userNotificationEvent.getPayload());
  long classPK=jsonObject.getLong("classPK");
  MBMessage message=MBMessageLocalServiceUtil.fetchMBMessage(classPK);
  if (message == null) {
    UserNotificationEventLocalServiceUtil.deleteUserNotificationEvent(userNotificationEvent.getUserNotificationEventId());
    return null;
  }
  int notificationType=jsonObject.getInt("notificationType");
  String title=StringPool.BLANK;
  AssetRenderer assetRenderer=getAssetRenderer(message);
  if (notificationType == UserNotificationDefinition.NOTIFICATION_TYPE_ADD_ENTRY) {
    if (assetRenderer != null) {
      title="x-added-a-new-comment-to-x";
    }
 else {
      title="x-added-a-new-comment";
    }
  }
 else   if (notificationType == UserNotificationDefinition.NOTIFICATION_TYPE_UPDATE_ENTRY) {
    if (assetRenderer != null) {
      title="x-updated-a-comment-to-x";
    }
 else {
      title="x-updated-a-comment";
    }
  }
  if (assetRenderer != null) {
    title=serviceContext.translate(title,HtmlUtil.escape(PortalUtil.getUserName(message.getUserId(),StringPool.BLANK)),HtmlUtil.escape(assetRenderer.getTitle(serviceContext.getLocale())));
  }
 else {
    title=serviceContext.translate(title,HtmlUtil.escape(PortalUtil.getUserName(message.getUserId(),StringPool.BLANK)));
  }
  StringBundler sb=new StringBundler(5);
  sb.append("<div class=\"title\">");
  sb.append(title);
  sb.append("</div><div class=\"body\">");
  String entryTitle=jsonObject.getString("entryTitle");
  sb.append(HtmlUtil.escape(StringUtil.shorten(entryTitle,50)));
  sb.append("</div>");
  return sb.toString();
}
