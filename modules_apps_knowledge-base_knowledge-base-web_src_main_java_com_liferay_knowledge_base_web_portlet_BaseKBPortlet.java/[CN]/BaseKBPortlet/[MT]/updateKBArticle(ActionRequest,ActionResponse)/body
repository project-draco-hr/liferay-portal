{
  String portletId=PortalUtil.getPortletId(actionRequest);
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  long resourcePrimKey=ParamUtil.getLong(actionRequest,"resourcePrimKey");
  long parentResourceClassNameId=ParamUtil.getLong(actionRequest,"parentResourceClassNameId",PortalUtil.getClassNameId(KBFolderConstants.getClassName()));
  long parentResourcePrimKey=ParamUtil.getLong(actionRequest,"parentResourcePrimKey",KBFolderConstants.DEFAULT_PARENT_FOLDER_ID);
  String title=ParamUtil.getString(actionRequest,"title");
  String urlTitle=ParamUtil.getString(actionRequest,"urlTitle");
  String content=ParamUtil.getString(actionRequest,"content");
  String description=ParamUtil.getString(actionRequest,"description");
  String sourceURL=ParamUtil.getString(actionRequest,"sourceURL");
  String[] sections=actionRequest.getParameterValues("sections");
  String[] selectedFileNames=ParamUtil.getParameterValues(actionRequest,"selectedFileName");
  long[] removeFileEntryIds=ParamUtil.getLongValues(actionRequest,"removeFileEntryIds");
  int workflowAction=ParamUtil.getInteger(actionRequest,"workflowAction");
  KBArticle kbArticle=null;
  ServiceContext serviceContext=ServiceContextFactory.getInstance(KBArticle.class.getName(),actionRequest);
  if (cmd.equals(Constants.ADD)) {
    kbArticle=KBArticleServiceUtil.addKBArticle(portletId,parentResourceClassNameId,parentResourcePrimKey,title,urlTitle,content,description,sourceURL,sections,selectedFileNames,serviceContext);
  }
 else   if (cmd.equals(Constants.REVERT)) {
    int version=ParamUtil.getInteger(actionRequest,"version",KBArticleConstants.DEFAULT_VERSION);
    kbArticle=KBArticleServiceUtil.revertKBArticle(resourcePrimKey,version,serviceContext);
  }
 else   if (cmd.equals(Constants.UPDATE)) {
    kbArticle=KBArticleServiceUtil.updateKBArticle(resourcePrimKey,title,content,description,sourceURL,sections,selectedFileNames,removeFileEntryIds,serviceContext);
  }
  if (!cmd.equals(Constants.ADD) && !cmd.equals(Constants.UPDATE)) {
    return;
  }
  if (workflowAction == WorkflowConstants.ACTION_SAVE_DRAFT) {
    String editURL=buildEditURL(actionRequest,actionResponse,kbArticle);
    actionRequest.setAttribute(WebKeys.REDIRECT,editURL);
  }
}
