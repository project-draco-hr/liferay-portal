{
  PortletPreferencesImpl portletPreferencesImpl=new PortletPreferencesImpl();
  portletPreferencesImpl.setValue("","");
  portletPreferencesImpl.setValues("name1",new String[0]);
  portletPreferencesImpl.setValues("name2",new String[]{"","value1"});
  Preference preference=new Preference("name3",new String[]{"value2","value3"},true);
  Map<String,Preference> preferencesMap=portletPreferencesImpl.getPreferences();
  preferencesMap.put("name3",preference);
  String actualXML=PortletPreferencesFactoryUtil.toXML(portletPreferencesImpl);
  portletPreferencesImpl=deserialize(actualXML);
  preferencesMap=portletPreferencesImpl.getPreferences();
  assertEquals(4,preferencesMap.size());
  preference=preferencesMap.get("");
  assertNotNull(preference);
  assertEquals("",preference.getName());
  String[] values=preference.getValues();
  assertEquals(1,values.length);
  assertEquals("",values[0]);
  assertFalse(preference.isReadOnly());
  preference=preferencesMap.get("name1");
  assertNotNull(preference);
  assertEquals("name1",preference.getName());
  values=preference.getValues();
  assertEquals(0,values.length);
  assertFalse(preference.isReadOnly());
  preference=preferencesMap.get("name2");
  assertNotNull(preference);
  assertEquals("name2",preference.getName());
  values=preference.getValues();
  assertEquals(2,values.length);
  assertEquals("",values[0]);
  assertEquals("value1",values[1]);
  assertFalse(preference.isReadOnly());
  preference=preferencesMap.get("name3");
  assertNotNull(preference);
  assertEquals("name3",preference.getName());
  values=preference.getValues();
  assertEquals(2,values.length);
  assertEquals("value2",values[0]);
  assertEquals("value3",values[1]);
  assertTrue(preference.isReadOnly());
}
