{
  super(layout);
  ServiceContext serviceContext=ServiceContextThreadLocal.getServiceContext();
  long layoutRevisionId=ParamUtil.getLong(serviceContext,"layoutRevisionId");
  long layoutSetBranchId=ParamUtil.getLong(serviceContext,"layoutSetBranchId");
  try {
    if (layoutRevisionId > 0) {
      _layoutRevision=LayoutRevisionLocalServiceUtil.getLayoutRevision(layoutRevisionId);
    }
 else     if (layoutSetBranchId > 0) {
      _layoutRevision=LayoutRevisionLocalServiceUtil.getLayoutRevision(layoutSetBranchId,layout.getPlid(),true);
    }
 else {
      LayoutSetBranch branch=LayoutSetBranchLocalServiceUtil.getMasterLayoutSetBranch(layout.getGroupId(),layout.isPrivateLayout());
      _layoutRevision=LayoutRevisionLocalServiceUtil.getLayoutRevision(branch.getLayoutSetBranchId(),layout.getPlid(),true);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
    throw new IllegalStateException();
  }
}
