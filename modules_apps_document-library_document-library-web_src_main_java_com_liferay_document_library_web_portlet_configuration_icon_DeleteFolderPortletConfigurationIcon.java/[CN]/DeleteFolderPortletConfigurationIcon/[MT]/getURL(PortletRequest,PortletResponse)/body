{
  PortletURL portletURL=PortalUtil.getControlPanelPortletURL(portletRequest,DLPortletKeys.DOCUMENT_LIBRARY_ADMIN,PortletRequest.ACTION_PHASE);
  Folder folder=null;
  try {
    folder=ActionUtil.getFolder(portletRequest);
  }
 catch (  Exception e) {
    return null;
  }
  if (folder.isMountPoint()) {
    portletURL.setParameter(ActionRequest.ACTION_NAME,"/document_library/edit_repository");
  }
 else {
    portletURL.setParameter(ActionRequest.ACTION_NAME,"/document_library/edit_folder");
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  if (folder.isMountPoint() || !isTrashEnabled(themeDisplay.getScopeGroupId()) || !(folder.getModel() instanceof DLFolder)) {
    portletURL.setParameter(Constants.CMD,Constants.DELETE);
  }
 else {
    portletURL.setParameter(Constants.CMD,Constants.MOVE_TO_TRASH);
  }
  PortletURL redirectURL=PortalUtil.getControlPanelPortletURL(portletRequest,DLPortletKeys.DOCUMENT_LIBRARY_ADMIN,PortletRequest.RENDER_PHASE);
  long parentFolderId=folder.getParentFolderId();
  if (parentFolderId == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    redirectURL.setParameter("mvcRenderCommandName","/document_library/view");
  }
 else {
    redirectURL.setParameter("mvcRenderCommandName","/document_library/view_folder");
  }
  redirectURL.setParameter("folderId",String.valueOf(parentFolderId));
  portletURL.setParameter("redirect",redirectURL.toString());
  portletURL.setParameter("folderId",String.valueOf(folder.getFolderId()));
  return portletURL.toString();
}
