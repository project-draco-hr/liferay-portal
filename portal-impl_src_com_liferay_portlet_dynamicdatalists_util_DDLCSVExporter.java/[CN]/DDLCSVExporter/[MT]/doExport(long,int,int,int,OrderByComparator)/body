{
  DDLRecordSet recordSet=DDLRecordSetServiceUtil.getRecordSet(recordSetId);
  DDMStructure ddmStructure=recordSet.getDDMStructure();
  Map<String,Map<String,String>> fieldsMap=ddmStructure.getFieldsMap();
  StringBuilder sb=new StringBuilder();
  for (  Map<String,String> fieldMap : fieldsMap.values()) {
    String label=fieldMap.get(DDMFieldConstants.LABEL);
    sb.append(label);
    sb.append(CharPool.COMMA);
  }
  sb.deleteCharAt(sb.length() - 1);
  sb.append(StringPool.NEW_LINE);
  List<DDLRecord> records=DDLRecordLocalServiceUtil.getRecords(recordSetId,status,start,end,orderByComparator);
  for (  DDLRecord record : records) {
    Fields fields=record.getFields();
    for (    Map<String,String> fieldMap : fieldsMap.values()) {
      String name=fieldMap.get(DDMFieldConstants.NAME);
      Field field=fields.get(name);
      Serializable value=field.getValue();
      sb.append(value);
      sb.append(CharPool.COMMA);
    }
    sb.deleteCharAt(sb.length() - 1);
    sb.append(StringPool.NEW_LINE);
  }
  String document=sb.toString();
  return document.getBytes();
}
