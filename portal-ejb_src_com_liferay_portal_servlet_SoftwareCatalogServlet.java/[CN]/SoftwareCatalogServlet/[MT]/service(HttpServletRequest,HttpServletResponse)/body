{
  if (!PortalInstances.matches()) {
    return;
  }
  res.setContentType("text/xml; charset=UTF-8");
  OutputStreamWriter out=new OutputStreamWriter(res.getOutputStream());
  try {
    long groupId=_getGroupId(req);
    String baseImageURL=_getBaseImageURL(req);
    Date oldestDate=_getOldestDate(req);
    int maxNumOfVersions=GetterUtil.getInteger(req.getParameter("maxNumOfVersions"));
    Properties repoSettings=_getRepoSettings(req);
    String repositoryXML=SCProductEntryLocalServiceUtil.getRepositoryXML(groupId,baseImageURL,oldestDate,maxNumOfVersions,repoSettings);
    if (!res.isCommitted()) {
      out.write(repositoryXML);
    }
  }
 catch (  NoSuchGroupException e) {
    res.sendError(404);
  }
catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(e,e);
    }
    res.sendError(500);
  }
 finally {
    out.flush();
    out.close();
  }
}
