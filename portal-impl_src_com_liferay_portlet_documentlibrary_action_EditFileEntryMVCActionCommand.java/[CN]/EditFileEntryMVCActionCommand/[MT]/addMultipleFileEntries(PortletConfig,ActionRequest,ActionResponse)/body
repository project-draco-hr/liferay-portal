{
  List<KeyValuePair> validFileNameKVPs=new ArrayList<>();
  List<KeyValuePair> invalidFileNameKVPs=new ArrayList<>();
  String[] selectedFileNames=ParamUtil.getParameterValues(actionRequest,"selectedFileName",new String[0],false);
  for (  String selectedFileName : selectedFileNames) {
    addMultipleFileEntries(portletConfig,actionRequest,actionResponse,selectedFileName,validFileNameKVPs,invalidFileNameKVPs);
  }
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  for (  KeyValuePair validFileNameKVP : validFileNameKVPs) {
    String fileName=validFileNameKVP.getKey();
    String originalFileName=validFileNameKVP.getValue();
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    jsonObject.put("added",Boolean.TRUE);
    jsonObject.put("fileName",fileName);
    jsonObject.put("originalFileName",originalFileName);
    jsonArray.put(jsonObject);
  }
  for (  KeyValuePair invalidFileNameKVP : invalidFileNameKVPs) {
    String fileName=invalidFileNameKVP.getKey();
    String errorMessage=invalidFileNameKVP.getValue();
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    jsonObject.put("added",Boolean.FALSE);
    jsonObject.put("errorMessage",errorMessage);
    jsonObject.put("fileName",fileName);
    jsonObject.put("originalFileName",fileName);
    jsonArray.put(jsonObject);
  }
  JSONPortletResponseUtil.writeJSON(actionRequest,actionResponse,jsonArray);
}
