{
  Map<String,Object> map=new HashMap<String,Object>();
  Enumeration<String> enu=_getAttributeNames(scope,false);
  int portletScopeLength=_portletScope.length();
  while (enu.hasMoreElements()) {
    String name=enu.nextElement();
    Object value=_session.getAttribute(name);
    if (scope == PortletSession.PORTLET_SCOPE) {
      if ((name.length() <= (portletScopeLength + 1)) || !name.startsWith(_portletScope + StringPool.QUESTION)) {
        continue;
      }
      name=name.substring(portletScopeLength + 1);
    }
    map.put(name,value);
  }
  return map;
}
