{
  Map<String,Object> map=new HashMap<String,Object>();
  Enumeration<String> enu=_getAttributeNames(scope,false);
  String portletScope=getPortletScope(_portletName,_plid);
  int portletScopeLength=portletScope.length();
  while (enu.hasMoreElements()) {
    String name=enu.nextElement();
    Object value=_session.getAttribute(name);
    if (scope == PortletSession.PORTLET_SCOPE) {
      name=name.substring(portletScopeLength + 1);
    }
    map.put(name,value);
  }
  return map;
}
