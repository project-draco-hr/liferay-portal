{
  if (_invalid) {
    throw new IllegalStateException();
  }
  if (scope == PortletSession.PORTLET_SCOPE) {
    List<String> attributeNames=new ArrayList<String>();
    String portletScope=getPortletScope(_portletName,_plid);
    int portletScopeLength=portletScope.length();
    Enumeration<String> enu=getHttpSession().getAttributeNames();
    while (enu.hasMoreElements()) {
      String name=enu.nextElement();
      if ((name.length() > (portletScopeLength + 1)) && (name.charAt(portletScopeLength) == CharPool.QUESTION) && name.startsWith(portletScope)) {
        String attributeName=name.substring(portletScopeLength + 1);
        attributeNames.add(attributeName);
      }
    }
    return Collections.enumeration(attributeNames);
  }
 else {
    return getHttpSession().getAttributeNames();
  }
}
