{
  if (_invalid) {
    throw new IllegalStateException();
  }
  if (scope == PortletSession.PORTLET_SCOPE) {
    List<String> attributeNames=new ArrayList<String>();
    String portletScope=getPortletScope(_portletName,_plid);
    Enumeration<String> enu=getHttpSession().getAttributeNames();
    while (enu.hasMoreElements()) {
      String name=enu.nextElement();
      StringTokenizer st=new StringTokenizer(name,StringPool.QUESTION);
      if (st.countTokens() == 2) {
        if (st.nextToken().equals(portletScope)) {
          attributeNames.add(st.nextToken());
        }
      }
    }
    return Collections.enumeration(attributeNames);
  }
 else {
    return getHttpSession().getAttributeNames();
  }
}
