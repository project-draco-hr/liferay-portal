{
  String ddmStructureKey=ParamUtil.getString(actionRequest,"ddmStructureKey");
  PortalPreferences portalPreferences=PortletPreferencesFactoryUtil.getPortalPreferences(actionRequest);
  String key=JournalPortletUtil.getAddMenuFavItemKey(actionRequest,actionResponse);
  String[] addMenuFavItems=portalPreferences.getValues(JournalPortletKeys.JOURNAL,key,new String[0]);
  if (addMenuFavItems.length >= _journalWebConfiguration.maxAddMenuItems()) {
    hideDefaultErrorMessage(actionRequest);
    throw new MaxAddMenuFavItemsException();
  }
  portalPreferences.setValues(JournalPortletKeys.JOURNAL,key,ArrayUtil.append(addMenuFavItems,ddmStructureKey));
  SessionMessages.add(actionRequest,PortalUtil.getPortletId(actionRequest) + SessionMessages.KEY_SUFFIX_REFRESH_PORTLET,JournalPortletKeys.JOURNAL);
}
