{
  PortletMode portletMode=getPortletMode();
  WindowState windowState=getWindowState();
  boolean action=isAction();
  HttpServletRequest req=getReq();
  boolean secure=isSecure();
  if (portletMode == null) {
    portletMode=PortletMode.VIEW;
  }
  if (windowState == null) {
    windowState=WindowState.NORMAL;
  }
  URLComposer urlComposer=_wsrpProvider.getURLComposer();
  String encodedParams=_getEncodedParameters();
  String url=StringPool.BLANK;
  if (action) {
    url=urlComposer.createBlockingActionURL(WSRPUtil.toWsrpMode(portletMode.toString()),null,encodedParams,WSRPUtil.toWsrpWindowState(windowState.toString()),secure,_runtimeContext,_portletContext,_userContext);
  }
 else {
    url=urlComposer.createRenderURL(WSRPUtil.toWsrpMode(portletMode.toString()),encodedParams,WSRPUtil.toWsrpWindowState(windowState.toString()),secure,_runtimeContext,_portletContext,_userContext);
  }
  return url;
}
