{
  Connection con=getConnection();
  DatabaseMetaData metaData=con.getMetaData();
  String productName=metaData.getDatabaseProductName();
  if (!productName.equals("Microsoft SQL Server")) {
    return con;
  }
  Thread currentThread=Thread.currentThread();
  ClassLoader classLoader=currentThread.getContextClassLoader();
  return (Connection)ProxyUtil.newProxyInstance(classLoader,new Class[]{Connection.class},new UpgradeOptimizedConnectionHandler(con));
}
