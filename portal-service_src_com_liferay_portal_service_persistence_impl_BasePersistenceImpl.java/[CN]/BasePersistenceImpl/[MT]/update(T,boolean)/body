{
  boolean isNew=model.isNew();
  if (model instanceof ModelWrapper) {
    ModelWrapper<T> modelWrapper=(ModelWrapper<T>)model;
    model=modelWrapper.getWrappedModel();
  }
  for (  ModelListener<T> listener : listeners) {
    if (isNew) {
      listener.onBeforeCreate(model);
    }
 else {
      listener.onBeforeUpdate(model);
    }
  }
  model=updateImpl(model,merge);
  for (  ModelListener<T> listener : listeners) {
    if (isNew) {
      listener.onAfterCreate(model);
    }
 else {
      listener.onAfterUpdate(model);
    }
  }
  return model;
}
