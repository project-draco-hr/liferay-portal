{
  Set<String> badColumnNames=getBadColumnNames();
  String[] fields=StringUtil.split(orderBy,CharPool.COMMA);
  StringBundler fixedOrderBy=new StringBundler(fields.length);
  for (int i=0; i < fields.length; ++i) {
    String field=fields[i];
    String[] components=StringUtil.split(field,CharPool.SPACE);
    String orderByField=components[0];
    String orderByDirection=components[1];
    components=StringUtil.split(orderByField,CharPool.PERIOD);
    String orderByTableName=components[0];
    String orderByFieldName=components[1];
    fixedOrderBy.append(orderByTableName);
    fixedOrderBy.append(StringPool.PERIOD);
    fixedOrderBy.append(orderByFieldName);
    if (badColumnNames.contains(orderByFieldName)) {
      fixedOrderBy.append(StringPool.UNDERLINE);
    }
    fixedOrderBy.append(StringPool.SPACE);
    fixedOrderBy.append(orderByDirection);
    if (i < (fields.length - 1)) {
      fixedOrderBy.append(StringPool.COMMA);
    }
  }
  return fixedOrderBy.toString();
}
