{
  AdminClient adminClient=_client.admin();
  ClusterAdminClient clusterAdminClient=adminClient.cluster();
  ClusterHealthRequestBuilder clusterHealthRequestBuilder=clusterAdminClient.prepareHealth();
  clusterHealthRequestBuilder.setTimeout(TimeValue.timeValueMillis(timeout));
  clusterHealthRequestBuilder.setWaitForGreenStatus();
  clusterHealthRequestBuilder.setWaitForNodes(">" + (nodeCount - 1));
  Future<ClusterHealthResponse> future=clusterHealthRequestBuilder.execute();
  try {
    return future.get();
  }
 catch (  Exception e) {
    throw new IllegalStateException(e);
  }
}
