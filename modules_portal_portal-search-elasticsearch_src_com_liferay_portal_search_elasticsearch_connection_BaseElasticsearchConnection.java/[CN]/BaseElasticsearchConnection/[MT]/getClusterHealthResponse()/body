{
  AdminClient adminClient=_client.admin();
  ClusterAdminClient clusterAdminClient=adminClient.cluster();
  ClusterHealthRequestBuilder clusterHealthRequestBuilder=clusterAdminClient.prepareHealth();
  if (PortalRunMode.isTestMode()) {
    clusterHealthRequestBuilder.setTimeout(TimeValue.timeValueMillis(100));
  }
 else {
    clusterHealthRequestBuilder.setTimeout(TimeValue.timeValueSeconds(30));
  }
  clusterHealthRequestBuilder.setWaitForGreenStatus();
  clusterHealthRequestBuilder.setWaitForNodes(">1");
  Future<ClusterHealthResponse> future=clusterHealthRequestBuilder.execute();
  try {
    return future.get();
  }
 catch (  Exception e) {
    throw new IllegalStateException(e);
  }
}
