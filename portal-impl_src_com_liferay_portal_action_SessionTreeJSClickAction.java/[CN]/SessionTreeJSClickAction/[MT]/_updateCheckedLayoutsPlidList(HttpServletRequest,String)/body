{
  long groupId=ParamUtil.getLong(request,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(request,"privateLayout");
  JSONArray checkedNodesJSONArray=JSONFactoryUtil.createJSONArray();
  PortalPreferences portalPreferences=PortletPreferencesFactoryUtil.getPortalPreferences(request);
  String checkedLayoutIds=portalPreferences.getValue(SessionTreeJSClicks.class.getName(),treeId);
  for (  long checkedLayoutId : StringUtil.split(checkedLayoutIds,0L)) {
    Layout checkedLayout=LayoutLocalServiceUtil.fetchLayout(groupId,privateLayout,checkedLayoutId);
    if (checkedLayout == null) {
      continue;
    }
    checkedNodesJSONArray.put(String.valueOf(checkedLayout.getPlid()));
  }
  portalPreferences.setValue(SessionTreeJSClicks.class.getName(),treeId + "Plid",checkedNodesJSONArray.toString());
}
