{
  try {
    long groupId=ParamUtil.getLong(request,"groupId");
    boolean privateLayout=ParamUtil.getBoolean(request,"privateLayout");
    JSONArray checkedNodesJSONArray=JSONFactoryUtil.createJSONArray();
    String checkedLayoutIds=PortletPreferencesFactoryUtil.getPortalPreferences(request).getValue(SessionTreeJSClicks.class.getName(),treeId);
    if (Validator.isNotNull(checkedLayoutIds)) {
      for (      long checkedLayoutId : StringUtil.split(checkedLayoutIds,0L)) {
        try {
          Layout checkedLayout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,checkedLayoutId);
          checkedNodesJSONArray.put(String.valueOf(checkedLayout.getPlid()));
        }
 catch (        NoSuchLayoutException nsle) {
        }
      }
    }
    PortletPreferencesFactoryUtil.getPortalPreferences(request).setValue(SessionTreeJSClicks.class.getName(),treeId + "Plid",checkedNodesJSONArray.toString());
  }
 catch (  Exception e) {
  }
}
