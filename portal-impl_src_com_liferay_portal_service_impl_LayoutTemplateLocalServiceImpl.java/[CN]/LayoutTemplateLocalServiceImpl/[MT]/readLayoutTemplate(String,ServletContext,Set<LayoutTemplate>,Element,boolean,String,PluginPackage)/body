{
  Map<String,LayoutTemplate> installedLayoutTemplates=null;
  if (themeId != null) {
    if (standard) {
      installedLayoutTemplates=_getThemesStandard(themeId);
    }
 else {
      installedLayoutTemplates=_getThemesCustom(themeId);
    }
  }
 else   if (servletContextName != null) {
    if (standard) {
      installedLayoutTemplates=_warStandard;
    }
 else {
      installedLayoutTemplates=_warCustom;
    }
  }
 else {
    if (standard) {
      installedLayoutTemplates=_portalStandard;
    }
 else {
      installedLayoutTemplates=_portalCustom;
    }
  }
  List<Element> layoutTemplateElements=element.elements("layout-template");
  for (  Element layoutTemplateElement : layoutTemplateElements) {
    String layoutTemplateId=layoutTemplateElement.attributeValue("id");
    LayoutTemplate layoutTemplateModel=installedLayoutTemplates.get(layoutTemplateId);
    if (layoutTemplateModel == null) {
      layoutTemplateModel=new LayoutTemplateImpl(layoutTemplateId);
      installedLayoutTemplates.put(layoutTemplateId,layoutTemplateModel);
    }
    PluginSetting pluginSetting=pluginSettingLocalService.getDefaultPluginSetting();
    layoutTemplateModel.setPluginPackage(pluginPackage);
    layoutTemplateModel.setServletContext(servletContext);
    if (servletContextName != null) {
      layoutTemplateModel.setServletContextName(servletContextName);
    }
    layoutTemplateModel.setStandard(standard);
    layoutTemplateModel.setThemeId(themeId);
    String templateName=GetterUtil.getString(layoutTemplateElement.attributeValue("name"));
    if (Validator.isNotNull(templateName)) {
      layoutTemplateModel.setName(templateName);
    }
    layoutTemplateModel.setTemplatePath(GetterUtil.getString(layoutTemplateElement.elementText("template-path"),layoutTemplateModel.getTemplatePath()));
    layoutTemplateModel.setThumbnailPath(GetterUtil.getString(layoutTemplateElement.elementText("thumbnail-path"),layoutTemplateModel.getThumbnailPath()));
    String content=null;
    try {
      content=HttpUtil.URLtoString(servletContext.getResource(layoutTemplateModel.getTemplatePath()));
    }
 catch (    Exception e) {
      _log.error("Unable to get content at template path " + layoutTemplateModel.getTemplatePath() + ": "+ e.getMessage());
    }
    if (Validator.isNull(content)) {
      _log.error("No content found at template path " + layoutTemplateModel.getTemplatePath());
    }
 else {
      StringBundler sb=new StringBundler(3);
      sb.append(themeId);
      if (standard) {
        sb.append(LayoutTemplateConstants.STANDARD_SEPARATOR);
      }
 else {
        sb.append(LayoutTemplateConstants.CUSTOM_SEPARATOR);
      }
      sb.append(layoutTemplateId);
      String velocityTemplateId=sb.toString();
      layoutTemplateModel.setContent(content);
      layoutTemplateModel.setColumns(_getColumns(velocityTemplateId,content));
    }
    Element rolesElement=layoutTemplateElement.element("roles");
    if (rolesElement != null) {
      List<Element> roleNameElements=rolesElement.elements("role-name");
      for (      Element roleNameElement : roleNameElements) {
        pluginSetting.addRole(roleNameElement.getText());
      }
    }
    layoutTemplateModel.setDefaultPluginSetting(pluginSetting);
    if (layoutTemplates != null) {
      layoutTemplates.add(layoutTemplateModel);
    }
  }
}
