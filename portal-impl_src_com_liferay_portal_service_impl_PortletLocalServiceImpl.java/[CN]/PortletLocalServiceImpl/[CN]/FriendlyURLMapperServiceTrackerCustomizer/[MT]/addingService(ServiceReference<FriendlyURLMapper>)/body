{
  Object propertyValue=serviceReference.getProperty("javax.portlet.name");
  if (propertyValue == null) {
    return null;
  }
  if (propertyValue instanceof String) {
    String portletId=(String)propertyValue;
    String rootPortletId=PortletConstants.getRootPortletId(portletId);
    while (true) {
      String[] friendlyURLMapperRootPortletIds=_friendlyURLMapperRootPortletIds.get();
      String[] newFriendlyURLMapperRootPortletIds=ArrayUtil.append(friendlyURLMapperRootPortletIds,rootPortletId);
      Arrays.sort(newFriendlyURLMapperRootPortletIds);
      if (_friendlyURLMapperRootPortletIds.compareAndSet(friendlyURLMapperRootPortletIds,newFriendlyURLMapperRootPortletIds)) {
        break;
      }
    }
    return new String[]{rootPortletId};
  }
  if (propertyValue instanceof String[]) {
    String[] portletIds=(String[])propertyValue;
    String[] rootPortletIds=new String[portletIds.length];
    for (int i=0; i < portletIds.length; i++) {
      String rootPortletId=PortletConstants.getRootPortletId(portletIds[i]);
      rootPortletIds[i]=rootPortletId;
    }
    while (true) {
      String[] friendlyURLMapperRootPortletIds=_friendlyURLMapperRootPortletIds.get();
      String[] newFriendlyURLMapperRootPortletIds=ArrayUtil.append(friendlyURLMapperRootPortletIds,rootPortletIds);
      Arrays.sort(newFriendlyURLMapperRootPortletIds);
      if (_friendlyURLMapperRootPortletIds.compareAndSet(friendlyURLMapperRootPortletIds,newFriendlyURLMapperRootPortletIds)) {
        break;
      }
    }
    return rootPortletIds;
  }
  return null;
}
