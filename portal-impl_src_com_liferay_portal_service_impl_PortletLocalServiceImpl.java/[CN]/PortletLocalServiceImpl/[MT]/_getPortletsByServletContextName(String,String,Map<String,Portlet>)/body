{
  List<Portlet> portlets=new ArrayList<>();
  String servletContextNameSuffix=null;
  if (Validator.isNotNull(servletContextName)) {
    servletContextNameSuffix=PortalUtil.getJsSafePortletId(PortletConstants.WAR_SEPARATOR.concat(servletContextName));
  }
  for (  Map.Entry<String,Portlet> entry : portletsMap.entrySet()) {
    String portletId=entry.getKey();
    if (!portletId.startsWith(portletNamePrefix)) {
      continue;
    }
    if (servletContextNameSuffix == null) {
      if (!portletId.contains(PortletConstants.WAR_SEPARATOR)) {
        portlets.add(entry.getValue());
      }
    }
 else     if (portletId.endsWith(servletContextNameSuffix)) {
      portlets.add(entry.getValue());
    }
  }
  return portlets;
}
