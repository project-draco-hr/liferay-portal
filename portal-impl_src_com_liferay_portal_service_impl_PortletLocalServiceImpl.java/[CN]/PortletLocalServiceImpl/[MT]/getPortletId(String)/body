{
  if (_portletIdsByStrutsPath.isEmpty()) {
    for (    Portlet portlet : _portletsMap.values()) {
      String strutsPath=portlet.getStrutsPath();
      if (_portletIdsByStrutsPath.containsKey(strutsPath)) {
        if (_log.isWarnEnabled()) {
          _log.warn("Duplicate struts path " + strutsPath);
        }
      }
      _portletIdsByStrutsPath.put(strutsPath,portlet.getPortletId());
    }
  }
  String portletId=_portletIdsByStrutsPath.get(securityPath);
  if (Validator.isNull(portletId)) {
    for (    Map.Entry<String,String> entry : _portletIdsByStrutsPath.entrySet()) {
      String strutsPath=entry.getKey();
      if (securityPath.startsWith(strutsPath.concat(StringPool.SLASH))) {
        portletId=entry.getValue();
        break;
      }
    }
  }
  if (Validator.isNull(portletId)) {
    _log.error("Struts path " + securityPath + " is not mapped to a portlet "+ "in liferay-portlet.xml");
  }
  return portletId;
}
