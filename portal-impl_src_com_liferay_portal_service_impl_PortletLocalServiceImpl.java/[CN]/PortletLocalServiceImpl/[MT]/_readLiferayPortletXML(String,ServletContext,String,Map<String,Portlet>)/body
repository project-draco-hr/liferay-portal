{
  Set<String> liferayPortletIds=new HashSet<>();
  if (xml == null) {
    return liferayPortletIds;
  }
  Document document=UnsecureSAXReaderUtil.read(xml,true);
  Element rootElement=document.getRootElement();
  PortletApp portletApp=getPortletApp(servletContextName);
  Map<String,String> roleMappers=new HashMap<>();
  for (  Element roleMapperElement : rootElement.elements("role-mapper")) {
    String roleName=roleMapperElement.elementText("role-name");
    String roleLink=roleMapperElement.elementText("role-link");
    roleMappers.put(roleName,roleLink);
  }
  Map<String,String> customUserAttributes=portletApp.getCustomUserAttributes();
  for (  Element customUserAttributeElement : rootElement.elements("custom-user-attribute")) {
    String customClass=customUserAttributeElement.elementText("custom-class");
    for (    Element nameElement : customUserAttributeElement.elements("name")) {
      String name=nameElement.getText();
      customUserAttributes.put(name,customClass);
    }
  }
  for (  Element portletElement : rootElement.elements("portlet")) {
    _readLiferayPortletXML(servletContextName,servletContext,liferayPortletIds,roleMappers,portletElement,portletsMap);
  }
  return liferayPortletIds;
}
