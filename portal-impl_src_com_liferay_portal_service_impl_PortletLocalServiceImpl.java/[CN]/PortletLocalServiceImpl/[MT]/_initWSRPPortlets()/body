{
  List<Portlet> wsrpPortlets=Collections.EMPTY_LIST;
  try {
    WSRPPersistenceHelper wsrpPersistence=WSRPPersistenceHelper.getInstance();
    wsrpPortlets=wsrpPersistence.getWSRPPortlets();
    for (    Portlet wsrpPortlet : wsrpPortlets) {
      PortletApp portletApp=_getPortletApp(StringPool.BLANK);
      wsrpPortlet.setPortletApp(portletApp);
      _getPortletsPool().put(wsrpPortlet.getPortletId(),wsrpPortlet);
      long[] companyIds=PortalInstances.getCompanyIds();
      PortletCategory newPortletCategory=new PortletCategory();
      PortletCategory wsrpCategory=new PortletCategory(_WSRP_CATEGORY);
      newPortletCategory.addCategory(wsrpCategory);
      wsrpCategory.getPortletIds().add(wsrpPortlet.getPortletId());
      for (int i=0; i < companyIds.length; i++) {
        long companyId=companyIds[i];
        PortletCategory portletCategory=(PortletCategory)WebAppPool.get(String.valueOf(companyId),WebKeys.PORTLET_CATEGORY);
        if (portletCategory != null) {
          portletCategory.merge(newPortletCategory);
        }
 else {
          _log.error("Unable to register remote portlet for company " + companyId + " because it does not exist");
        }
      }
    }
  }
 catch (  WSRPConsumerException ex) {
    _log.error("Cannot load WSRP Portlets",ex);
  }
  return wsrpPortlets;
}
