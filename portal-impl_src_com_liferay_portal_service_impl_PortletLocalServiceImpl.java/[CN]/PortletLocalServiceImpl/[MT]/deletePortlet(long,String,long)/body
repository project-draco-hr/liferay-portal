{
  String rootPortletId=PortletConstants.getRootPortletId(portletId);
  resourceLocalService.deleteResource(companyId,rootPortletId,ResourceConstants.SCOPE_INDIVIDUAL,PortletPermissionUtil.getPrimaryKey(plid,portletId));
  int ownerType=PortletKeys.PREFS_OWNER_TYPE_LAYOUT;
  if (PortletConstants.hasUserId(portletId)) {
    ownerType=PortletKeys.PREFS_OWNER_TYPE_USER;
  }
  List<PortletPreferences> portletPreferencesList=portletPreferencesLocalService.getPortletPreferences(PortletKeys.PREFS_OWNER_TYPE_LAYOUT,plid,portletId);
  Portlet portlet=getPortletById(companyId,portletId);
  PortletLayoutListener portletLayoutListener=null;
  if (portlet != null) {
    portletLayoutListener=portlet.getPortletLayoutListenerInstance();
    PortletInstanceFactoryUtil.delete(portlet);
  }
  for (  PortletPreferences portletPreferences : portletPreferencesList) {
    if (portletLayoutListener != null) {
      portletLayoutListener.onRemoveFromLayout(portletPreferences.getPortletId(),plid);
    }
    portletPreferencesLocalService.deletePortletPreferences(portletPreferences.getPortletPreferencesId());
  }
}
