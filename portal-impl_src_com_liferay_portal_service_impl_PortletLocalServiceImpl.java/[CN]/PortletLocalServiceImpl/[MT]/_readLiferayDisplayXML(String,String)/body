{
  PortletCategory portletCategory=new PortletCategory();
  if (xml == null) {
    xml=ContentUtil.get("com/liferay/portal/deploy/dependencies/liferay-display.xml");
  }
  Document doc=SAXReaderUtil.read(xml,true);
  Element root=doc.getRootElement();
  Set<String> portletIds=new HashSet<String>();
  _readLiferayDisplay(servletContextName,root,portletCategory,portletIds);
  Set<String> undefinedPortletIds=new HashSet<String>();
  Iterator<Portlet> itr=_getPortletsPool().values().iterator();
  while (itr.hasNext()) {
    Portlet portlet=itr.next();
    if (portlet.isRemote()) {
      _readRemoteDisplay(portlet,portletCategory);
      continue;
    }
    String portletId=portlet.getPortletId();
    PortletApp portletApp=portlet.getPortletApp();
    if ((servletContextName != null) && (portletApp.isWARFile()) && (portletId.endsWith(PortletConstants.WAR_SEPARATOR + PortalUtil.getJsSafePortletId(servletContextName)) && (!portletIds.contains(portletId)))) {
      undefinedPortletIds.add(portletId);
    }
 else     if ((servletContextName == null) && (!portletApp.isWARFile()) && (portletId.indexOf(PortletConstants.WAR_SEPARATOR) == -1)&& (!portletIds.contains(portletId))) {
      undefinedPortletIds.add(portletId);
    }
  }
  if (undefinedPortletIds.size() > 0) {
    PortletCategory undefinedCategory=new PortletCategory("category.undefined");
    portletCategory.addCategory(undefinedCategory);
    undefinedCategory.getPortletIds().addAll(undefinedPortletIds);
  }
  return portletCategory;
}
