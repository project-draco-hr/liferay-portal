{
  PortletCategory portletCategory=new PortletCategory();
  if (xml == null) {
    xml=ContentUtil.get("com/liferay/portal/deploy/dependencies/liferay-display.xml");
  }
  Document document=SAXReaderUtil.read(xml,true);
  Element rootElement=document.getRootElement();
  Set<String> portletIds=new HashSet<String>();
  _readLiferayDisplay(servletContextName,rootElement,portletCategory,portletIds);
  Set<String> undefinedPortletIds=new HashSet<String>();
  for (  Portlet portlet : _getPortletsPool().values()) {
    String portletId=portlet.getPortletId();
    PortletApp portletApp=portlet.getPortletApp();
    if ((servletContextName != null) && portletApp.isWARFile() && (portletId.endsWith(PortletConstants.WAR_SEPARATOR + PortalUtil.getJsSafePortletId(servletContextName)) && !portletIds.contains(portletId))) {
      undefinedPortletIds.add(portletId);
    }
 else     if ((servletContextName == null) && !portletApp.isWARFile() && (portletId.indexOf(PortletConstants.WAR_SEPARATOR) == -1)&& !portletIds.contains(portletId)) {
      undefinedPortletIds.add(portletId);
    }
  }
  if (!undefinedPortletIds.isEmpty()) {
    PortletCategory undefinedCategory=new PortletCategory("category.undefined");
    portletCategory.addCategory(undefinedCategory);
    undefinedCategory.getPortletIds().addAll(undefinedPortletIds);
  }
  return portletCategory;
}
