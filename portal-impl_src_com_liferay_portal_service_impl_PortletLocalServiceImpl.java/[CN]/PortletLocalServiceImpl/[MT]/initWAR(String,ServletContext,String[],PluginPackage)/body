{
  List<Portlet> portlets=new ArrayList<Portlet>();
  Map<String,Portlet> portletsPool=_getPortletsPool();
  try {
    List<String> servletURLPatterns=_readWebXML(xmls[3]);
    Set<String> portletIds=_readPortletXML(servletContextName,servletContext,xmls[0],portletsPool,servletURLPatterns,pluginPackage);
    portletIds.addAll(_readPortletXML(servletContextName,servletContext,xmls[1],portletsPool,servletURLPatterns,pluginPackage));
    Set<String> liferayPortletIds=_readLiferayPortletXML(servletContextName,xmls[2],portletsPool);
    Iterator<String> itr=portletIds.iterator();
    while (itr.hasNext()) {
      String portletId=itr.next();
      if (_log.isWarnEnabled() && !liferayPortletIds.contains(portletId)) {
        _log.warn("Portlet with the name " + portletId + " is described in portlet.xml but does not "+ "have a matching entry in liferay-portlet.xml");
      }
    }
    itr=liferayPortletIds.iterator();
    while (itr.hasNext()) {
      String portletId=itr.next();
      if (_log.isWarnEnabled() && !portletIds.contains(portletId)) {
        _log.warn("Portlet with the name " + portletId + " is described in liferay-portlet.xml but does "+ "not have a matching entry in portlet.xml");
      }
    }
    itr=portletIds.iterator();
    while (itr.hasNext()) {
      String portletId=itr.next();
      Portlet portlet=_getPortletsPool().get(portletId);
      portlets.add(portlet);
      PortletInstanceFactory.clear(portlet);
    }
    PortletApp portletApp=_getPortletApp(servletContextName);
    _setSpriteImages(servletContext,portletApp,StringPool.SLASH);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  _clearCaches();
  return portlets;
}
