{
  portletLocalService.clearCompanyPortletsPool();
  _portletAppsPool.clear();
  _portletsPool.clear();
  _portletIdsByStrutsPath.clear();
  Map<String,Portlet> portletsPool=_getPortletsPool();
  try {
    PortletApp portletApp=_getPortletApp(StringPool.BLANK);
    portletApp.setContextPath(servletContext.getContextPath());
    Set<String> servletURLPatterns=_readWebXML(xmls[4]);
    Set<String> portletIds=_readPortletXML(servletContext,xmls[0],portletsPool,servletURLPatterns,pluginPackage);
    portletIds.addAll(_readPortletXML(servletContext,xmls[1],portletsPool,servletURLPatterns,pluginPackage));
    Set<String> liferayPortletIds=_readLiferayPortletXML(xmls[2],portletsPool);
    liferayPortletIds.addAll(_readLiferayPortletXML(xmls[3],portletsPool));
    for (    String portletId : portletIds) {
      if (_log.isWarnEnabled() && !liferayPortletIds.contains(portletId)) {
        _log.warn("Portlet with the name " + portletId + " is described in portlet.xml but does not "+ "have a matching entry in liferay-portlet.xml");
      }
    }
    for (    String portletId : liferayPortletIds) {
      if (_log.isWarnEnabled() && !portletIds.contains(portletId)) {
        _log.warn("Portlet with the name " + portletId + " is described in liferay-portlet.xml but does "+ "not have a matching entry in portlet.xml");
      }
    }
    Iterator<Map.Entry<String,Portlet>> portletPoolsItr=portletsPool.entrySet().iterator();
    while (portletPoolsItr.hasNext()) {
      Map.Entry<String,Portlet> entry=portletPoolsItr.next();
      Portlet portletModel=entry.getValue();
      if (!portletModel.getPortletId().equals(PortletKeys.ADMIN) && !portletModel.getPortletId().equals(PortletKeys.MY_ACCOUNT) && !portletModel.isInclude()) {
        portletPoolsItr.remove();
      }
    }
    _setSpriteImages(servletContext,portletApp,"/html/icons/");
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
