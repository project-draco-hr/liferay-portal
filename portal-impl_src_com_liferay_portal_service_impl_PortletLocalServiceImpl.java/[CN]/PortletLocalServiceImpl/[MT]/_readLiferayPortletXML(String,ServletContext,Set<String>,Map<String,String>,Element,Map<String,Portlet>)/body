{
  String portletId=portletElement.elementText("portlet-name");
  if (Validator.isNotNull(servletContextName)) {
    portletId=portletId.concat(PortletConstants.WAR_SEPARATOR).concat(servletContextName);
  }
  portletId=PortalUtil.getJsSafePortletId(portletId);
  if (_log.isDebugEnabled()) {
    _log.debug("Reading portlet extension " + portletId);
  }
  liferayPortletIds.add(portletId);
  Portlet portletModel=portletsMap.get(portletId);
  if (portletModel == null) {
    return;
  }
  portletModel.setIcon(GetterUtil.getString(portletElement.elementText("icon"),portletModel.getIcon()));
  portletModel.setVirtualPath(GetterUtil.getString(portletElement.elementText("virtual-path"),portletModel.getVirtualPath()));
  portletModel.setStrutsPath(GetterUtil.getString(portletElement.elementText("struts-path"),portletModel.getStrutsPath()));
  String strutsPath=portletModel.getStrutsPath();
  if (Validator.isNotNull(strutsPath)) {
    if (_portletIdsByStrutsPath.containsKey(strutsPath)) {
      String strutsPathPortletId=_portletIdsByStrutsPath.get(strutsPath);
      if (!strutsPathPortletId.equals(portletId)) {
        if (_log.isWarnEnabled()) {
          _log.warn("Duplicate struts path " + strutsPath);
        }
      }
    }
    _portletIdsByStrutsPath.put(strutsPath,portletId);
  }
  portletModel.setParentStrutsPath(GetterUtil.getString(portletElement.elementText("parent-struts-path"),portletModel.getParentStrutsPath()));
  if (Validator.isNotNull(portletElement.elementText("configuration-path"))) {
    _log.error("The configuration-path element is no longer supported. Use " + "configuration-action-class instead.");
  }
  portletModel.setConfigurationActionClass(GetterUtil.getString(portletElement.elementText("configuration-action-class"),portletModel.getConfigurationActionClass()));
  List<String> indexerClasses=new ArrayList<>();
  for (  Element indexerClassElement : portletElement.elements("indexer-class")) {
    indexerClasses.add(indexerClassElement.getText());
  }
  portletModel.setIndexerClasses(indexerClasses);
  portletModel.setOpenSearchClass(GetterUtil.getString(portletElement.elementText("open-search-class"),portletModel.getOpenSearchClass()));
  for (  Element schedulerEntryElement : portletElement.elements("scheduler-entry")) {
    SchedulerEntryImpl schedulerEntryImpl=new SchedulerEntryImpl();
    String description=GetterUtil.getString(schedulerEntryElement.elementText("scheduler-description"));
    schedulerEntryImpl.setDescription(description);
    String eventListenerClass=GetterUtil.getString(schedulerEntryElement.elementText("scheduler-event-listener-class"));
    schedulerEntryImpl.setEventListenerClass(eventListenerClass);
    Element triggerElement=schedulerEntryElement.element("trigger");
    Element cronElement=triggerElement.element("cron");
    Element simpleElement=triggerElement.element("simple");
    if (cronElement != null) {
      Element propertyKeyElement=cronElement.element("property-key");
      String cronException=null;
      if (propertyKeyElement != null) {
        cronException=_getTriggerValue(portletModel,propertyKeyElement.getTextTrim());
      }
 else {
        cronException=cronElement.elementText("cron-trigger-value");
      }
      schedulerEntryImpl.setTrigger(TriggerFactoryUtil.createTrigger(eventListenerClass,eventListenerClass,cronException));
    }
 else     if (simpleElement != null) {
      Element propertyKeyElement=simpleElement.element("property-key");
      String intervalString=null;
      if (propertyKeyElement != null) {
        intervalString=_getTriggerValue(portletModel,propertyKeyElement.getTextTrim());
      }
 else {
        Element simpleTriggerValueElement=simpleElement.element("simple-trigger-value");
        intervalString=simpleTriggerValueElement.getTextTrim();
      }
      String timeUnitString=StringUtil.toUpperCase(GetterUtil.getString(simpleElement.elementText("time-unit"),TimeUnit.SECOND.getValue()));
      schedulerEntryImpl.setTrigger(TriggerFactoryUtil.createTrigger(eventListenerClass,eventListenerClass,Integer.parseInt(intervalString),TimeUnit.valueOf(timeUnitString)));
    }
    portletModel.addSchedulerEntry(schedulerEntryImpl);
  }
  portletModel.setPortletURLClass(GetterUtil.getString(portletElement.elementText("portlet-url-class"),portletModel.getPortletURLClass()));
  portletModel.setFriendlyURLMapperClass(GetterUtil.getString(portletElement.elementText("friendly-url-mapper-class"),portletModel.getFriendlyURLMapperClass()));
  portletModel.setFriendlyURLMapping(GetterUtil.getString(portletElement.elementText("friendly-url-mapping"),portletModel.getFriendlyURLMapping()));
  portletModel.setFriendlyURLRoutes(GetterUtil.getString(portletElement.elementText("friendly-url-routes"),portletModel.getFriendlyURLRoutes()));
  portletModel.setURLEncoderClass(GetterUtil.getString(portletElement.elementText("url-encoder-class"),portletModel.getURLEncoderClass()));
  portletModel.setPortletDataHandlerClass(GetterUtil.getString(portletElement.elementText("portlet-data-handler-class"),portletModel.getPortletDataHandlerClass()));
  List<String> stagedModelDataHandlerClasses=new ArrayList<>();
  for (  Element stagedModelDataHandlerClassElement : portletElement.elements("staged-model-data-handler-class")) {
    stagedModelDataHandlerClasses.add(stagedModelDataHandlerClassElement.getText());
  }
  portletModel.setStagedModelDataHandlerClasses(stagedModelDataHandlerClasses);
  portletModel.setTemplateHandlerClass(GetterUtil.getString(portletElement.elementText("template-handler"),portletModel.getTemplateHandlerClass()));
  portletModel.setPortletLayoutListenerClass(GetterUtil.getString(portletElement.elementText("portlet-layout-listener-class"),portletModel.getPortletLayoutListenerClass()));
  portletModel.setPollerProcessorClass(GetterUtil.getString(portletElement.elementText("poller-processor-class"),portletModel.getPollerProcessorClass()));
  portletModel.setPopMessageListenerClass(GetterUtil.getString(portletElement.elementText("pop-message-listener-class"),portletModel.getPopMessageListenerClass()));
  List<String> socialActivityInterpreterClasses=new ArrayList<>();
  for (  Element socialActivityInterpreterClassElement : portletElement.elements("social-activity-interpreter-class")) {
    socialActivityInterpreterClasses.add(socialActivityInterpreterClassElement.getText());
  }
  portletModel.setSocialActivityInterpreterClasses(socialActivityInterpreterClasses);
  portletModel.setSocialRequestInterpreterClass(GetterUtil.getString(portletElement.elementText("social-request-interpreter-class"),portletModel.getSocialRequestInterpreterClass()));
  portletModel.setSocialInteractionsConfiguration(GetterUtil.getBoolean(portletElement.elementText("social-interactions-configuration"),portletModel.getSocialInteractionsConfiguration()));
  portletModel.setUserNotificationDefinitions(GetterUtil.getString(portletElement.elementText("user-notification-definitions"),portletModel.getUserNotificationDefinitions()));
  List<String> userNotificationHandlerClasses=new ArrayList<>();
  for (  Element userNotificationHandlerClassElement : portletElement.elements("user-notification-handler-class")) {
    userNotificationHandlerClasses.add(userNotificationHandlerClassElement.getText());
  }
  portletModel.setUserNotificationHandlerClasses(userNotificationHandlerClasses);
  portletModel.setWebDAVStorageToken(GetterUtil.getString(portletElement.elementText("webdav-storage-token"),portletModel.getWebDAVStorageToken()));
  portletModel.setWebDAVStorageClass(GetterUtil.getString(portletElement.elementText("webdav-storage-class"),portletModel.getWebDAVStorageClass()));
  portletModel.setXmlRpcMethodClass(GetterUtil.getString(portletElement.elementText("xml-rpc-method-class"),portletModel.getXmlRpcMethodClass()));
  String controlPanelEntryCategory=GetterUtil.getString(portletElement.elementText("control-panel-entry-category"),portletModel.getControlPanelEntryCategory());
  controlPanelEntryCategory=PortletCategoryUtil.getPortletCategoryKey(controlPanelEntryCategory);
  portletModel.setControlPanelEntryCategory(controlPanelEntryCategory);
  portletModel.setControlPanelEntryWeight(GetterUtil.getDouble(portletElement.elementText("control-panel-entry-weight"),portletModel.getControlPanelEntryWeight()));
  portletModel.setControlPanelEntryClass(GetterUtil.getString(portletElement.elementText("control-panel-entry-class"),portletModel.getControlPanelEntryClass()));
  List<String> assetRendererFactoryClasses=new ArrayList<>();
  for (  Element assetRendererFactoryClassElement : portletElement.elements("asset-renderer-factory")) {
    assetRendererFactoryClasses.add(assetRendererFactoryClassElement.getText());
  }
  portletModel.setAssetRendererFactoryClasses(assetRendererFactoryClasses);
  List<String> atomCollectionAdapterClasses=new ArrayList<>();
  for (  Element atomCollectionAdapterClassElement : portletElement.elements("atom-collection-adapter")) {
    atomCollectionAdapterClasses.add(atomCollectionAdapterClassElement.getText());
  }
  portletModel.setAtomCollectionAdapterClasses(atomCollectionAdapterClasses);
  List<String> customAttributesDisplayClasses=new ArrayList<>();
  for (  Element customAttributesDisplayClassElement : portletElement.elements("custom-attributes-display")) {
    customAttributesDisplayClasses.add(customAttributesDisplayClassElement.getText());
  }
  portletModel.setCustomAttributesDisplayClasses(customAttributesDisplayClasses);
  portletModel.setPermissionPropagatorClass(GetterUtil.getString(portletElement.elementText("permission-propagator"),portletModel.getPermissionPropagatorClass()));
  List<String> trashHandlerClasses=new ArrayList<>();
  for (  Element trashHandlerClassElement : portletElement.elements("trash-handler")) {
    trashHandlerClasses.add(trashHandlerClassElement.getText());
  }
  portletModel.setTrashHandlerClasses(trashHandlerClasses);
  List<String> workflowHandlerClasses=new ArrayList<>();
  for (  Element workflowHandlerClassElement : portletElement.elements("workflow-handler")) {
    workflowHandlerClasses.add(workflowHandlerClassElement.getText());
  }
  portletModel.setWorkflowHandlerClasses(workflowHandlerClasses);
  portletModel.setPreferencesCompanyWide(GetterUtil.getBoolean(portletElement.elementText("preferences-company-wide"),portletModel.isPreferencesCompanyWide()));
  portletModel.setPreferencesUniquePerLayout(GetterUtil.getBoolean(portletElement.elementText("preferences-unique-per-layout"),portletModel.isPreferencesUniquePerLayout()));
  portletModel.setPreferencesOwnedByGroup(GetterUtil.getBoolean(portletElement.elementText("preferences-owned-by-group"),portletModel.isPreferencesOwnedByGroup()));
  portletModel.setUseDefaultTemplate(GetterUtil.getBoolean(portletElement.elementText("use-default-template"),portletModel.isUseDefaultTemplate()));
  portletModel.setShowPortletAccessDenied(GetterUtil.getBoolean(portletElement.elementText("show-portlet-access-denied"),portletModel.isShowPortletAccessDenied()));
  portletModel.setShowPortletInactive(GetterUtil.getBoolean(portletElement.elementText("show-portlet-inactive"),portletModel.isShowPortletInactive()));
  portletModel.setActionURLRedirect(GetterUtil.getBoolean(portletElement.elementText("action-url-redirect"),portletModel.isActionURLRedirect()));
  portletModel.setRestoreCurrentView(GetterUtil.getBoolean(portletElement.elementText("restore-current-view"),portletModel.isRestoreCurrentView()));
  portletModel.setMaximizeEdit(GetterUtil.getBoolean(portletElement.elementText("maximize-edit"),portletModel.isMaximizeEdit()));
  portletModel.setMaximizeHelp(GetterUtil.getBoolean(portletElement.elementText("maximize-help"),portletModel.isMaximizeHelp()));
  portletModel.setPopUpPrint(GetterUtil.getBoolean(portletElement.elementText("pop-up-print"),portletModel.isPopUpPrint()));
  portletModel.setLayoutCacheable(GetterUtil.getBoolean(portletElement.elementText("layout-cacheable"),portletModel.isLayoutCacheable()));
  portletModel.setInstanceable(GetterUtil.getBoolean(portletElement.elementText("instanceable"),portletModel.isInstanceable()));
  portletModel.setRemoteable(GetterUtil.getBoolean(portletElement.elementText("remoteable"),portletModel.isRemoteable()));
  portletModel.setScopeable(GetterUtil.getBoolean(portletElement.elementText("scopeable"),portletModel.isScopeable()));
  portletModel.setSinglePageApplication(GetterUtil.getBoolean(portletElement.elementText("single-page-application"),portletModel.isSinglePageApplication()));
  portletModel.setUserPrincipalStrategy(GetterUtil.getString(portletElement.elementText("user-principal-strategy"),portletModel.getUserPrincipalStrategy()));
  portletModel.setPrivateRequestAttributes(GetterUtil.getBoolean(portletElement.elementText("private-request-attributes"),portletModel.isPrivateRequestAttributes()));
  portletModel.setPrivateSessionAttributes(GetterUtil.getBoolean(portletElement.elementText("private-session-attributes"),portletModel.isPrivateSessionAttributes()));
  Element autopropagatedParametersElement=portletElement.element("autopropagated-parameters");
  Set<String> autopropagatedParameters=new HashSet<>();
  if (autopropagatedParametersElement != null) {
    String[] autopropagatedParametersArray=StringUtil.split(autopropagatedParametersElement.getText());
    for (    String autopropagatedParameter : autopropagatedParametersArray) {
      autopropagatedParameters.add(autopropagatedParameter);
    }
  }
  portletModel.setAutopropagatedParameters(autopropagatedParameters);
  boolean defaultRequiresNamespacedParameters=GetterUtil.getBoolean(servletContext.getInitParameter("com.liferay.portlet.requires-namespaced-parameters"),portletModel.isRequiresNamespacedParameters());
  portletModel.setRequiresNamespacedParameters(GetterUtil.getBoolean(portletElement.elementText("requires-namespaced-parameters"),defaultRequiresNamespacedParameters));
  portletModel.setActionTimeout(GetterUtil.getInteger(portletElement.elementText("action-timeout"),portletModel.getActionTimeout()));
  portletModel.setRenderTimeout(GetterUtil.getInteger(portletElement.elementText("render-timeout"),portletModel.getRenderTimeout()));
  portletModel.setRenderWeight(GetterUtil.getInteger(portletElement.elementText("render-weight"),portletModel.getRenderWeight()));
  portletModel.setAjaxable(GetterUtil.getBoolean(portletElement.elementText("ajaxable"),portletModel.isAjaxable()));
  List<String> headerPortalCssList=new ArrayList<>();
  for (  Element headerPortalCssElement : portletElement.elements("header-portal-css")) {
    headerPortalCssList.add(headerPortalCssElement.getText());
  }
  portletModel.setHeaderPortalCss(headerPortalCssList);
  List<String> headerPortletCssList=new ArrayList<>();
  for (  Element headerPortletCssElement : portletElement.elements("header-portlet-css")) {
    headerPortletCssList.add(headerPortletCssElement.getText());
  }
  portletModel.setHeaderPortletCss(headerPortletCssList);
  List<String> headerPortalJavaScriptList=new ArrayList<>();
  for (  Element headerPortalJavaScriptElement : portletElement.elements("header-portal-javascript")) {
    headerPortalJavaScriptList.add(headerPortalJavaScriptElement.getText());
  }
  portletModel.setHeaderPortalJavaScript(headerPortalJavaScriptList);
  List<String> headerPortletJavaScriptList=new ArrayList<>();
  for (  Element headerPortletJavaScriptElement : portletElement.elements("header-portlet-javascript")) {
    headerPortletJavaScriptList.add(headerPortletJavaScriptElement.getText());
  }
  portletModel.setHeaderPortletJavaScript(headerPortletJavaScriptList);
  List<String> footerPortalCssList=new ArrayList<>();
  for (  Element footerPortalCssElement : portletElement.elements("footer-portal-css")) {
    footerPortalCssList.add(footerPortalCssElement.getText());
  }
  portletModel.setFooterPortalCss(footerPortalCssList);
  List<String> footerPortletCssList=new ArrayList<>();
  for (  Element footerPortletCssElement : portletElement.elements("footer-portlet-css")) {
    footerPortletCssList.add(footerPortletCssElement.getText());
  }
  portletModel.setFooterPortletCss(footerPortletCssList);
  List<String> footerPortalJavaScriptList=new ArrayList<>();
  for (  Element footerPortalJavaScriptElement : portletElement.elements("footer-portal-javascript")) {
    footerPortalJavaScriptList.add(footerPortalJavaScriptElement.getText());
  }
  portletModel.setFooterPortalJavaScript(footerPortalJavaScriptList);
  List<String> footerPortletJavaScriptList=new ArrayList<>();
  for (  Element footerPortletJavaScriptElement : portletElement.elements("footer-portlet-javascript")) {
    footerPortletJavaScriptList.add(footerPortletJavaScriptElement.getText());
  }
  portletModel.setFooterPortletJavaScript(footerPortletJavaScriptList);
  portletModel.setCssClassWrapper(GetterUtil.getString(portletElement.elementText("css-class-wrapper"),portletModel.getCssClassWrapper()));
  portletModel.setFacebookIntegration(GetterUtil.getString(portletElement.elementText("facebook-integration"),portletModel.getFacebookIntegration()));
  portletModel.setAddDefaultResource(GetterUtil.getBoolean(portletElement.elementText("add-default-resource"),portletModel.isAddDefaultResource()));
  portletModel.setSystem(GetterUtil.getBoolean(portletElement.elementText("system"),portletModel.isSystem()));
  portletModel.setActive(GetterUtil.getBoolean(portletElement.elementText("active"),portletModel.isActive()));
  portletModel.setInclude(GetterUtil.getBoolean(portletElement.elementText("include"),portletModel.isInclude()));
  if (Validator.isNull(servletContextName)) {
    portletModel.setReady(true);
  }
  if (!portletModel.isAjaxable() && (portletModel.getRenderWeight() < 1)) {
    portletModel.setRenderWeight(1);
  }
  portletModel.getRoleMappers().putAll(roleMappers);
  portletModel.linkRoles();
}
