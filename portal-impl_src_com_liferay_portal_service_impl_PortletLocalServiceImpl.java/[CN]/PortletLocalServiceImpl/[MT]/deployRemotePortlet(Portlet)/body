{
  PortletApp portletApp=_getPortletApp(StringPool.BLANK);
  portlet.setPortletApp(portletApp);
  Map<String,Portlet> portletsPool=_getPortletsPool();
  portletsPool.put(portlet.getPortletId(),portlet);
  _clearCaches();
  PortletCategory newPortletCategory=new PortletCategory();
  PortletCategory wsrpCategory=new PortletCategory(_WSRP_CATEGORY);
  newPortletCategory.addCategory(wsrpCategory);
  wsrpCategory.getPortletIds().add(portlet.getPortletId());
  long[] companyIds=PortalInstances.getCompanyIds();
  for (  long companyId : companyIds) {
    PortletCategory portletCategory=(PortletCategory)WebAppPool.get(String.valueOf(companyId),WebKeys.PORTLET_CATEGORY);
    if (portletCategory != null) {
      portletCategory.merge(newPortletCategory);
    }
 else {
      _log.error("Unable to register remote portlet for company " + companyId + " because it does not exist");
    }
  }
  return portlet;
}
