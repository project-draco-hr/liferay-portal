{
  _portletsMap.put(portlet.getRootPortletId(),portlet);
  PortletApp portletApp=portlet.getPortletApp();
  if (portletApp != null) {
    _portletApps.put(portletApp.getServletContextName(),portletApp);
  }
  clearCache();
  ServletContext servletContext=portletApp.getServletContext();
  PortletBagFactory portletBagFactory=new PortletBagFactory();
  portletBagFactory.setClassLoader(ClassLoaderPool.getClassLoader(servletContext.getServletContextName()));
  portletBagFactory.setServletContext(servletContext);
  portletBagFactory.setWARFile(true);
  portletBagFactory.create(portlet,true);
}
