{
  long companyId=portlet.getCompanyId();
  String name=portlet.getPortletId();
  if (resourcePermissionLocalService.getResourcePermissionsCount(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,name) < 1) {
    resourceLocalService.addResources(companyId,0,0,name,name,true,false,false);
  }
  if (portlet.isSystem()) {
    return;
  }
  String[] roleNames=portlet.getRolesArray();
  if (roleNames.length == 0) {
    return;
  }
  int scope=ResourceConstants.SCOPE_COMPANY;
  String primKey=String.valueOf(companyId);
  String actionId=ActionKeys.ADD_TO_PAGE;
  List<String> actionIds=ResourceActionsUtil.getPortletResourceActions(name);
  if (actionIds.contains(actionId)) {
    for (    String roleName : roleNames) {
      Role role=roleLocalService.getRole(companyId,roleName);
      if (resourceBlockLocalService.isSupported(name)) {
        resourceBlockLocalService.addCompanyScopePermission(companyId,name,role.getRoleId(),actionId);
      }
 else {
        resourcePermissionLocalService.addResourcePermission(companyId,name,scope,primKey,role.getRoleId(),actionId);
      }
    }
  }
  updatePortlet(companyId,portlet.getPortletId(),StringPool.BLANK,portlet.isActive());
}
