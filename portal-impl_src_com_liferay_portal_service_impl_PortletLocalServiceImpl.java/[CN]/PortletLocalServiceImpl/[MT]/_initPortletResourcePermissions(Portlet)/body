{
  long companyId=portlet.getCompanyId();
  String name=portlet.getRootPortletId();
  if (resourcePermissionLocalService.getResourcePermissionsCount(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,name) >= 4) {
    return;
  }
  List<String> groupActions=ResourceActionsUtil.getPortletResourceGroupDefaultActions(name);
  Role organizationUserRole=roleLocalService.getRole(companyId,RoleConstants.ORGANIZATION_USER);
  Role siteMemberRole=roleLocalService.getRole(companyId,RoleConstants.SITE_MEMBER);
  resourcePermissionLocalService.setResourcePermissions(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,name,organizationUserRole.getRoleId(),groupActions.toArray(new String[0]));
  resourcePermissionLocalService.setResourcePermissions(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,name,siteMemberRole.getRoleId(),groupActions.toArray(new String[0]));
  Role guestRole=roleLocalService.getRole(companyId,RoleConstants.GUEST);
  List<String> guestActions=ResourceActionsUtil.getPortletResourceGuestDefaultActions(name);
  resourcePermissionLocalService.setResourcePermissions(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,name,guestRole.getRoleId(),guestActions.toArray(new String[0]));
  Role ownerRole=roleLocalService.getRole(companyId,RoleConstants.OWNER);
  List<String> ownerActions=ResourceActionsUtil.getPortletResourceActions(name);
  resourcePermissionLocalService.setOwnerResourcePermissions(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,name,ownerRole.getRoleId(),0,ownerActions.toArray(new String[0]));
}
