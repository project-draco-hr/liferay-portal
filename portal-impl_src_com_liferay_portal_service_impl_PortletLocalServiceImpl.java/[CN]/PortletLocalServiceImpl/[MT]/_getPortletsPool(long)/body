{
  String key=_encodeKey(companyId);
  Map<String,Portlet> portletsPool=(Map<String,Portlet>)_companyPortletsPool.get(key);
  if (portletsPool == null) {
    portletsPool=new ConcurrentHashMap<String,Portlet>();
    Map<String,Portlet> parentPortletsPool=_getPortletsPool();
    if (parentPortletsPool == null) {
      return portletsPool;
    }
    for (    Portlet portlet : parentPortletsPool.values()) {
      portlet=(Portlet)portlet.clone();
      portlet.setCompanyId(companyId);
      portletsPool.put(portlet.getPortletId(),portlet);
    }
    List<Portlet> portlets=portletPersistence.findByCompanyId(companyId);
    for (    Portlet portlet : portlets) {
      Portlet portletModel=portletsPool.get(portlet.getPortletId());
      if (portletModel != null) {
        portletModel.setPluginPackage(portlet.getPluginPackage());
        portletModel.setDefaultPluginSetting(portlet.getDefaultPluginSetting());
        portletModel.setRoles(portlet.getRoles());
        portletModel.setActive(portlet.getActive());
      }
    }
    _companyPortletsPool.put(key,portletsPool);
  }
  return portletsPool;
}
