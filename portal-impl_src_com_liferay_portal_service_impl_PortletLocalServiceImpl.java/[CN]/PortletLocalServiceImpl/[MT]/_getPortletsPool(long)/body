{
  Long companyIdObj=new Long(companyId);
  Map portletsPool=(Map)_companyPortletsPool.get(companyIdObj);
  if (portletsPool == null) {
    portletsPool=CollectionFactory.getSyncHashMap();
    Map parentPortletsPool=_getPortletsPool();
    if (parentPortletsPool == null) {
      return portletsPool;
    }
    Iterator itr=parentPortletsPool.values().iterator();
    while (itr.hasNext()) {
      Portlet portlet=(Portlet)((Portlet)itr.next()).clone();
      portlet.setCompanyId(companyId);
      portletsPool.put(portlet.getPortletId(),portlet);
    }
    itr=portletPersistence.findByCompanyId(companyId).iterator();
    while (itr.hasNext()) {
      Portlet portlet=(Portlet)itr.next();
      Portlet portletModel=(Portlet)portletsPool.get(portlet.getPortletId());
      if (portletModel != null) {
        portletModel.setPluginPackage(portlet.getPluginPackage());
        portletModel.setDefaultPluginSetting(portlet.getDefaultPluginSetting());
        portletModel.setRoles(portlet.getRoles());
        portletModel.setActive(portlet.getActive());
      }
    }
    _companyPortletsPool.put(companyIdObj,portletsPool);
  }
  return portletsPool;
}
