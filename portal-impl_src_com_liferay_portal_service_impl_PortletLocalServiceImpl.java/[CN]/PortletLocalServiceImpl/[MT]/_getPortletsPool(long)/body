{
  String key=_encodeKey(companyId);
  Map<String,Portlet> portletsPool=(Map<String,Portlet>)_companyPortletsPool.get(key);
  if (portletsPool == null) {
    portletsPool=new ConcurrentHashMap<String,Portlet>();
    Map<String,Portlet> parentPortletsPool=_getPortletsPool();
    if (parentPortletsPool == null) {
      return portletsPool;
    }
    Iterator<Portlet> itr=parentPortletsPool.values().iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      portlet=(Portlet)portlet.clone();
      portlet.setCompanyId(companyId);
      portletsPool.put(portlet.getPortletId(),portlet);
    }
    itr=portletPersistence.findByCompanyId(companyId).iterator();
    while (itr.hasNext()) {
      Portlet portlet=itr.next();
      Portlet portletModel=portletsPool.get(portlet.getPortletId());
      if (portletModel != null) {
        portletModel.setPluginPackage(portlet.getPluginPackage());
        portletModel.setDefaultPluginSetting(portlet.getDefaultPluginSetting());
        portletModel.setRoles(portlet.getRoles());
        portletModel.setActive(portlet.getActive());
      }
    }
    _companyPortletsPool.put(key,portletsPool);
  }
  return portletsPool;
}
