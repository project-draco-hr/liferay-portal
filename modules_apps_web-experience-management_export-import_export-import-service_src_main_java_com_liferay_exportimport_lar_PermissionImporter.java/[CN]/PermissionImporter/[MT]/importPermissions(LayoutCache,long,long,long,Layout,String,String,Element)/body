{
  Map<Long,Set<String>> existingRoleIdsToActionIds=ExportImportPermissionUtil.getRoleIdsToActionIds(companyId,resourceName,resourcePrimKey);
  Map<Long,String[]> importedRoleIdsToActionIds=new HashMap<>();
  List<Element> roleElements=permissionsElement.elements("role");
  for (  Element roleElement : roleElements) {
    Role role=checkRole(layoutCache,companyId,groupId,userId,roleElement);
    if (role == null) {
      continue;
    }
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    if (!group.isLayoutPrototype() && !group.isLayoutSetPrototype() && layout.isPrivateLayout()) {
      String roleName=role.getName();
      if (roleName.equals(RoleConstants.GUEST)) {
        continue;
      }
    }
    List<String> actions=getActions(roleElement);
    importedRoleIdsToActionIds.put(role.getRoleId(),actions.toArray(new String[actions.size()]));
  }
  Map<Long,String[]> roleIdsToActionIds=ExportImportPermissionUtil.mergeImportedPermissionsWithExistingPermissions(existingRoleIdsToActionIds,importedRoleIdsToActionIds);
  ExportImportPermissionUtil.updateResourcePermissions(companyId,groupId,resourceName,resourcePrimKey,roleIdsToActionIds);
}
