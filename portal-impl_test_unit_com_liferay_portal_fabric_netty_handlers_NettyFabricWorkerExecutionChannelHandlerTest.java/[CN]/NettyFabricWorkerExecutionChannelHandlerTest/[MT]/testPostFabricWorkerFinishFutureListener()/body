{
  NettyFabricWorkerExecutionChannelHandler nettyFabricWorkerExecutionChannelHandler=new NettyFabricWorkerExecutionChannelHandler(new MockRepository<Channel>(),new LocalFabricAgent(new EmbeddedProcessExecutor()),Long.MAX_VALUE);
  Path inputPath1=FileServerTestUtil.createEmptyFile(Paths.get("inputPath1"));
  Path inputPath2=FileServerTestUtil.createEmptyFile(Paths.get("inputPath2"));
  Map<Path,Path> inputPaths=new HashMap<>();
  inputPaths.put(inputPath1,inputPath1);
  inputPaths.put(inputPath2,inputPath2);
  PostFabricWorkerFinishFutureListener postFabricWorkerFinishFutureListener=nettyFabricWorkerExecutionChannelHandler.new PostFabricWorkerFinishFutureListener(_embeddedChannel,createNettyFabricWorkerConfig(),new LoadedPaths(inputPaths,null,null));
  DefaultNoticeableFuture<Serializable> defaultNoticeableFuture=new DefaultNoticeableFuture<Serializable>();
  Throwable throwable=new Throwable();
  defaultNoticeableFuture.setException(throwable);
  installNettyFabricAgentStub();
  NettyFabricWorkerStub<Serializable> nettyFabricWorkerStub=installNettyFabricWorkerStub();
  NoticeableFuture<?> noticeableFuture=nettyFabricWorkerStub.getProcessNoticeableFuture();
  defaultNoticeableFuture.addFutureListener(postFabricWorkerFinishFutureListener);
  Assert.assertTrue(Files.notExists(inputPath1));
  Assert.assertTrue(Files.notExists(inputPath2));
  invokeRPC();
  try {
    noticeableFuture.get();
    Assert.fail();
  }
 catch (  ExecutionException ee) {
    Assert.assertEquals(throwable,ee.getCause());
  }
  nettyFabricWorkerStub=installNettyFabricWorkerStub();
  noticeableFuture=nettyFabricWorkerStub.getProcessNoticeableFuture();
  postFabricWorkerFinishFutureListener.complete(null);
  invokeRPC();
  try {
    noticeableFuture.get();
    Assert.fail();
  }
 catch (  ExecutionException ee) {
    Throwable t=ee.getCause();
    Assert.assertSame(NullPointerException.class,t.getClass());
  }
  inputPath1=FileServerTestUtil.createEmptyFile(Paths.get("inputPath1"));
  inputPath2=FileServerTestUtil.createEmptyFile(Paths.get("inputPath2"));
  inputPaths=new HashMap<>();
  inputPaths.put(inputPath1,inputPath1);
  inputPaths.put(inputPath2,inputPath2);
  postFabricWorkerFinishFutureListener=nettyFabricWorkerExecutionChannelHandler.new PostFabricWorkerFinishFutureListener(_embeddedChannel,createNettyFabricWorkerConfig(),new LoadedPaths(inputPaths,null,null));
  defaultNoticeableFuture=new DefaultNoticeableFuture<Serializable>();
  defaultNoticeableFuture.set(StringPool.BLANK);
  nettyFabricWorkerStub=installNettyFabricWorkerStub();
  noticeableFuture=nettyFabricWorkerStub.getProcessNoticeableFuture();
  defaultNoticeableFuture.addFutureListener(postFabricWorkerFinishFutureListener);
  Assert.assertTrue(Files.notExists(inputPath1));
  Assert.assertTrue(Files.notExists(inputPath2));
  invokeRPC();
  Assert.assertEquals(StringPool.BLANK,noticeableFuture.get());
}
