{
  ChannelPipeline channelPipeline=_embeddedChannel.pipeline();
  NettyFabricWorkerExecutionChannelHandler nettyFabricWorkerExecutionChannelHandler=new NettyFabricWorkerExecutionChannelHandler(new MockRepository<Channel>(),new LocalFabricAgent(new EmbeddedProcessExecutor()),Long.MAX_VALUE);
  channelPipeline.addLast(nettyFabricWorkerExecutionChannelHandler);
  ChannelHandlerContext channelHandlerContext=channelPipeline.lastContext();
  PostLoadPathsFutureListener postLoadPathsFutureListener=nettyFabricWorkerExecutionChannelHandler.new PostLoadPathsFutureListener(channelHandlerContext,createNettyFabricWorkerConfig());
  DefaultNoticeableFuture<LoadedPaths> defaultNoticeableFuture=new DefaultNoticeableFuture<>();
  Throwable throwable=new Throwable();
  defaultNoticeableFuture.setException(throwable);
  installNettyFabricAgentStub();
  NettyFabricWorkerStub<Serializable> nettyFabricWorkerStub=installNettyFabricWorkerStub();
  NoticeableFuture<Serializable> noticeableFuture=nettyFabricWorkerStub.getProcessNoticeableFuture();
  defaultNoticeableFuture.addFutureListener(postLoadPathsFutureListener);
  invokeRPC();
  try {
    noticeableFuture.get();
    Assert.fail();
  }
 catch (  ExecutionException ee) {
    Assert.assertSame(throwable,ee.getCause());
  }
  defaultNoticeableFuture=new DefaultNoticeableFuture<>();
  defaultNoticeableFuture.set(new LoadedPaths(Collections.<Path,Path>emptyMap(),null,null));
  nettyFabricWorkerStub=installNettyFabricWorkerStub();
  noticeableFuture=nettyFabricWorkerStub.getProcessNoticeableFuture();
  defaultNoticeableFuture.addFutureListener(postLoadPathsFutureListener);
  _embeddedChannel.runPendingTasks();
  FabricAgent fabricAgent=ReflectionTestUtil.getFieldValue(nettyFabricWorkerExecutionChannelHandler,"_fabricAgent");
  Collection<? extends FabricWorker<?>> fabricWorkers=fabricAgent.getFabricWorkers();
  Assert.assertEquals(1,fabricWorkers.size());
  Assert.assertFalse(noticeableFuture.isDone());
}
