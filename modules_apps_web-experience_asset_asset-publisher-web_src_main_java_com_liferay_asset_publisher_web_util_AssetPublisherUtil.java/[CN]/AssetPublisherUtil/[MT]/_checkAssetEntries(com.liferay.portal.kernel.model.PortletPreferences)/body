{
  Layout layout=_layoutLocalService.fetchLayout(portletPreferencesModel.getPlid());
  if (layout == null) {
    return;
  }
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.fromXML(layout.getCompanyId(),portletPreferencesModel.getOwnerId(),portletPreferencesModel.getOwnerType(),portletPreferencesModel.getPlid(),portletPreferencesModel.getPortletId(),portletPreferencesModel.getPreferences());
  if (!getEmailAssetEntryAddedEnabled(portletPreferences)) {
    return;
  }
  List<AssetEntry> assetEntries=getAssetEntries(portletPreferences,layout,layout.getGroupId(),AssetPublisherWebConfigurationValues.DYNAMIC_SUBSCRIPTION_LIMIT,false);
  if (assetEntries.isEmpty()) {
    return;
  }
  long[] notifiedAssetEntryIds=GetterUtil.getLongValues(portletPreferences.getValues("notifiedAssetEntryIds",null));
  ArrayList<AssetEntry> newAssetEntries=new ArrayList<>();
  for (  AssetEntry assetEntry : assetEntries) {
    if (!ArrayUtil.contains(notifiedAssetEntryIds,assetEntry.getEntryId())) {
      newAssetEntries.add(assetEntry);
    }
  }
  List<Subscription> subscriptions=_subscriptionLocalService.getSubscriptions(portletPreferencesModel.getCompanyId(),com.liferay.portal.kernel.model.PortletPreferences.class.getName(),AssetPublisherUtil.getSubscriptionClassPK(portletPreferencesModel.getPlid(),portletPreferencesModel.getPortletId()));
  _notifySubscribers(subscriptions,portletPreferences,assetEntries);
  try {
    portletPreferences.setValues("notifiedAssetEntryIds",StringUtil.split(ListUtil.toString(assetEntries,AssetEntry.ENTRY_ID_ACCESSOR)));
    portletPreferences.store();
  }
 catch (  IOException|PortletException e) {
    throw new PortalException(e);
  }
}
