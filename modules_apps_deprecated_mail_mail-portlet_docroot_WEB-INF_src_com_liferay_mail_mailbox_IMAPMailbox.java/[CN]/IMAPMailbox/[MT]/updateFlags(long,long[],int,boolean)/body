{
  Folder folder=FolderLocalServiceUtil.getFolder(folderId);
  Account account=AccountLocalServiceUtil.getAccount(folder.getAccountId());
  for (  long messageId : messageIds) {
    MessageLocalServiceUtil.updateFlag(messageId,flag,value);
  }
  if (account.getDraftFolderId() == folderId) {
    _imapAccessor.updateFlags(folderId,messageIds,flag,value,false);
  }
 else {
    _imapAccessor.updateFlags(folderId,messageIds,flag,value,true);
  }
}
