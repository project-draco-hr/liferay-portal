{
  SearchEngineRegistration searchEngineRegistration=new SearchEngineRegistration(searchEngine);
  _searchEngineRegistrations.add(searchEngineRegistration);
  MessageBus messageBus=getMessageBus();
  Destination searchReaderDestination=getSearchReaderDestination(messageBus,searchEngine);
  searchEngineRegistration.setSearchReaderDestinationName(searchReaderDestination.getName());
  Destination searchWriterDestination=getSearchWriterDestination(messageBus,searchEngine);
  searchEngineRegistration.setSearchWriterDestinationName(searchWriterDestination.getName());
  SearchEngine originalSearchEngine=SearchEngineUtil.getSearchEngine(searchEngine.getName());
  if (originalSearchEngine != null) {
    searchEngineRegistration.setOverride(true);
    searchEngineRegistration.setOriginalSearchEngineProxyWrapper((SearchEngineProxyWrapper)originalSearchEngine);
    savePreviousSearchEngineListeners(searchReaderDestination,searchWriterDestination,searchEngineRegistration);
    messageBus.removeDestination(searchReaderDestination.getName());
    searchReaderDestination=getSearchReaderDestination(messageBus,originalSearchEngine);
    messageBus.removeDestination(searchWriterDestination.getName());
    searchWriterDestination=getSearchWriterDestination(messageBus,originalSearchEngine);
  }
  createSearchEngineListeners(searchEngine,searchReaderDestination,searchWriterDestination);
  SearchEngineProxyWrapper searchEngineProxyWrapper=new SearchEngineProxyWrapper(searchEngine,getIndexSearcher(),getIndexWriter());
  SearchEngineUtil.addSearchEngine(searchEngineProxyWrapper);
}
