{
  File tempFile=null;
  if (file == null || !file.exists()) {
    tempFile=FileUtil.createTempFile();
    file=tempFile;
  }
  try {
    LocalRepository localRepository=getLocalRepository(repositoryId);
    FileEntry fileEntry=localRepository.addFileEntry(userId,folderId,sourceFileName,mimeType,title,description,changeLog,file,serviceContext);
    DLProcessorRegistryUtil.trigger(fileEntry);
    return fileEntry;
  }
  finally {
    FileUtil.delete(tempFile);
  }
}
