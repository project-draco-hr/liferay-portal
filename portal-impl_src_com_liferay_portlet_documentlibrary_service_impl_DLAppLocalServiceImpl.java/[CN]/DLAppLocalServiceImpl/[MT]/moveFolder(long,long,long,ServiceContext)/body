{
  SystemEventHierarchyEntryThreadLocal.push(Folder.class);
  try {
    LocalRepository sourceLocalRepository=getFolderLocalRepository(folderId);
    LocalRepository destinationLocalRepository=getFolderLocalRepository(parentFolderId,serviceContext.getScopeGroupId());
    if (parentFolderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      Folder toFolder=destinationLocalRepository.getFolder(parentFolderId);
      if (toFolder.isMountPoint()) {
        destinationLocalRepository=getLocalRepository(toFolder.getRepositoryId());
      }
    }
    Folder folder=null;
    if (sourceLocalRepository.getRepositoryId() == destinationLocalRepository.getRepositoryId()) {
      folder=sourceLocalRepository.moveFolder(userId,folderId,parentFolderId,serviceContext);
    }
 else {
      folder=moveFolders(userId,folderId,parentFolderId,sourceLocalRepository,destinationLocalRepository,serviceContext);
    }
    return folder;
  }
  finally {
    SystemEventHierarchyEntryThreadLocal.pop(Folder.class);
  }
}
