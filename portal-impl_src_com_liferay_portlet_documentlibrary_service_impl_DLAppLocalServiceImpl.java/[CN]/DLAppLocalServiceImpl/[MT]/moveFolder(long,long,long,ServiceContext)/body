{
  SystemEventHierarchyEntryThreadLocal.push(Folder.class);
  try {
    LocalRepository fromLocalRepository=repositoryProvider.getFolderLocalRepository(folderId);
    LocalRepository toLocalRepository=getFolderLocalRepository(parentFolderId,serviceContext.getScopeGroupId());
    if (parentFolderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      Folder toFolder=toLocalRepository.getFolder(parentFolderId);
      if (toFolder.isMountPoint()) {
        toLocalRepository=getLocalRepository(toFolder.getRepositoryId());
      }
    }
    if (fromLocalRepository.getRepositoryId() == toLocalRepository.getRepositoryId()) {
      return fromLocalRepository.moveFolder(userId,folderId,parentFolderId,serviceContext);
    }
    return moveFolder(userId,folderId,parentFolderId,fromLocalRepository,toLocalRepository,serviceContext);
  }
  finally {
    SystemEventHierarchyEntryThreadLocal.pop(Folder.class);
  }
}
