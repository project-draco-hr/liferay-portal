{
  SystemEventHierarchyEntryThreadLocal.push(FileEntry.class);
  try {
    FileEntry fileEntry=fromLocalRepository.getFileEntry(oldFileEntryId);
    fromLocalRepository.deleteFileEntry(oldFileEntryId);
    dlAppHelperLocalService.deleteFileEntry(fileEntry);
  }
 catch (  PortalException pe) {
    FileEntry fileEntry=toLocalRepository.getFileEntry(newFileEntryId);
    toLocalRepository.deleteFileEntry(newFileEntryId);
    dlAppHelperLocalService.deleteFileEntry(fileEntry);
    throw pe;
  }
 finally {
    SystemEventHierarchyEntryThreadLocal.pop(FileEntry.class);
  }
}
