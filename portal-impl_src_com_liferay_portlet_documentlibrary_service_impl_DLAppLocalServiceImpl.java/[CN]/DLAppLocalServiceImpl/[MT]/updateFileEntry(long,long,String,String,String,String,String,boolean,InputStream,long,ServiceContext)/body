{
  if (Validator.isNull(mimeType) || mimeType.equals(ContentTypes.APPLICATION_OCTET_STREAM)) {
    String extension=DLAppUtil.getExtension(title,sourceFileName);
    if (size == 0) {
      mimeType=MimeTypesUtil.getExtensionContentType(extension);
    }
 else {
      File file=null;
      try {
        file=FileUtil.createTempFile(is);
        return updateFileEntry(userId,fileEntryId,sourceFileName,mimeType,title,description,changeLog,majorVersion,file,serviceContext);
      }
 catch (      IOException ioe) {
        throw new SystemException("Unable to write temporary file",ioe);
      }
 finally {
        FileUtil.delete(file);
      }
    }
  }
  LocalRepository localRepository=getFileEntryLocalRepository(fileEntryId);
  FileEntry oldFileEntry=localRepository.getFileEntry(fileEntryId);
  FileVersion oldFileVersion=oldFileEntry.getFileVersion();
  FileEntry fileEntry=localRepository.updateFileEntry(userId,fileEntryId,sourceFileName,mimeType,title,description,changeLog,majorVersion,is,size,serviceContext);
  if (is != null) {
    DLProcessorRegistryUtil.cleanUp(fileEntry.getLatestFileVersion(true));
    oldFileVersion=null;
  }
  dlAppHelperLocalService.updateFileEntry(userId,fileEntry,oldFileVersion,fileEntry.getFileVersion(),serviceContext);
  return fileEntry;
}
