{
  Folder newFolder=null;
  try {
    Folder folder=fromLocalRepository.getFolder(folderId);
    newFolder=toLocalRepository.addFolder(userId,parentFolderId,folder.getName(),folder.getDescription(),serviceContext);
    dlAppHelperLocalService.addFolder(userId,newFolder,serviceContext);
    copyFolderDependencies(userId,folder,newFolder,fromLocalRepository,toLocalRepository,serviceContext);
    return newFolder;
  }
 catch (  PortalException pe) {
    if (newFolder != null) {
      toLocalRepository.deleteFolder(newFolder.getFolderId());
    }
    throw pe;
  }
}
