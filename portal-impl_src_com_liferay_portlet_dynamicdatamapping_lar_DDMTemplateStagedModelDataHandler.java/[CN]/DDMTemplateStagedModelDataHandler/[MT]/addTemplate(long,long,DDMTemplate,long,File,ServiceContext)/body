{
  DDMTemplate newTemplate=null;
  try {
    return DDMTemplateLocalServiceUtil.addTemplate(userId,groupId,template.getClassNameId(),classPK,template.getTemplateKey(),template.getNameMap(),template.getDescriptionMap(),template.getType(),template.getMode(),template.getLanguage(),template.getScript(),template.isCacheable(),template.isSmallImage(),template.getSmallImageURL(),smallFile,serviceContext);
  }
 catch (  TemplateDuplicateTemplateKeyException tdtke) {
    newTemplate=DDMTemplateLocalServiceUtil.addTemplate(userId,groupId,template.getClassNameId(),classPK,null,template.getNameMap(),template.getDescriptionMap(),template.getType(),template.getMode(),template.getLanguage(),template.getScript(),template.isCacheable(),template.isSmallImage(),template.getSmallImageURL(),smallFile,serviceContext);
    if (_log.isWarnEnabled()) {
      StringBundler sb=new StringBundler(4);
      sb.append("A template with the key ");
      sb.append(template.getTemplateKey());
      sb.append(" already exists. The new generated key is ");
      sb.append(newTemplate.getTemplateKey());
      _log.warn(sb.toString());
    }
  }
  return newTemplate;
}
