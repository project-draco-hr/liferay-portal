{
  DDMTemplate newTemplate=null;
  try {
    return DDMTemplateLocalServiceUtil.addTemplate(userId,groupId,template.getClassNameId(),classPK,template.getTemplateKey(),template.getNameMap(),template.getDescriptionMap(),template.getType(),template.getMode(),template.getLanguage(),template.getScript(),template.isCacheable(),template.isSmallImage(),template.getSmallImageURL(),smallFile,serviceContext);
  }
 catch (  TemplateDuplicateTemplateKeyException tdtke) {
    newTemplate=DDMTemplateLocalServiceUtil.addTemplate(userId,groupId,template.getClassNameId(),classPK,null,template.getNameMap(),template.getDescriptionMap(),template.getType(),template.getMode(),template.getLanguage(),template.getScript(),template.isCacheable(),template.isSmallImage(),template.getSmallImageURL(),smallFile,serviceContext);
    if (_log.isWarnEnabled()) {
      _log.warn("A template with the key " + template.getTemplateKey() + " already exists. The new generated key is "+ newTemplate.getTemplateKey());
    }
  }
  return newTemplate;
}
