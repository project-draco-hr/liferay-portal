{
  Element templatesElement=elements[0];
  Element dlFileEntryTypesElement=null;
  Element dlFoldersElement=null;
  Element dlFileEntriesElement=null;
  Element dlFileRanksElement=null;
  Element dlRepositoriesElement=null;
  Element dlRepositoryEntriesElement=null;
  if (elements.length > 1) {
    dlFileEntryTypesElement=elements[1];
    dlFoldersElement=elements[2];
    dlFileEntriesElement=elements[3];
    dlFileRanksElement=elements[4];
    dlRepositoriesElement=elements[5];
    dlRepositoryEntriesElement=elements[6];
  }
  Element templateElement=templatesElement.addElement("template");
  if (template.isSmallImage()) {
    Image smallImage=ImageUtil.fetchByPrimaryKey(template.getSmallImageId());
    if (Validator.isNotNull(template.getSmallImageURL())) {
      String smallImageURL=DDMPortletDataHandler.exportReferencedContent(portletDataContext,dlFileEntryTypesElement,dlFoldersElement,dlFileEntriesElement,dlFileRanksElement,dlRepositoriesElement,dlRepositoryEntriesElement,templateElement,template.getSmallImageURL().concat(StringPool.SPACE));
      template.setSmallImageURL(smallImageURL);
    }
 else     if (smallImage != null) {
      String smallImagePath=getTemplateSmallImagePath(portletDataContext,template);
      templateElement.addAttribute("small-image-path",smallImagePath);
      template.setSmallImageType(smallImage.getType());
      portletDataContext.addZipEntry(smallImagePath,smallImage.getTextObj());
    }
  }
  if (portletDataContext.getBooleanParameter(DDMPortletDataHandler.NAMESPACE,"embedded-assets")) {
    String content=DDMPortletDataHandler.exportReferencedContent(portletDataContext,dlFileEntryTypesElement,dlFoldersElement,dlFileEntriesElement,dlFileRanksElement,dlRepositoriesElement,dlRepositoryEntriesElement,templateElement,template.getScript());
    template.setScript(content);
  }
  portletDataContext.addClassedModel(templateElement,StagedModelPathUtil.getPath(template),template,DDMPortletDataHandler.NAMESPACE);
}
