{
  if (groupId <= 0) {
    return LayoutConstants.DEFAULT_PLID;
  }
  String scopeGroupLayoutUuid=null;
  Group scopeGroup=groupLocalService.getGroup(scopeGroupId);
  if (scopeGroup.isLayout()) {
    Layout scopeGroupLayout=layoutLocalService.getLayout(scopeGroup.getClassPK());
    scopeGroupLayoutUuid=scopeGroupLayout.getUuid();
  }
  List<Layout> layouts=layoutPersistence.filterFindByG_P(scopeGroupId,privateLayout);
  for (  Layout layout : layouts) {
    if (!LayoutPermissionUtil.contains(getPermissionChecker(),layout,ActionKeys.VIEW)) {
      continue;
    }
    if (!layout.isTypePortlet()) {
      continue;
    }
    LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
    if (!layoutTypePortlet.hasPortletId(portletId)) {
      continue;
    }
    javax.portlet.PortletPreferences jxPreferences=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portletId);
    String scopeType=GetterUtil.getString(jxPreferences.getValue("lfrScopeType",null));
    if (scopeGroup.isLayout()) {
      String scopeLayoutUuid=GetterUtil.getString(jxPreferences.getValue("lfrScopeLayoutUuid",null));
      if (Validator.isNotNull(scopeType) && Validator.isNotNull(scopeLayoutUuid) && scopeLayoutUuid.equals(scopeGroupLayoutUuid)) {
        return layout.getPlid();
      }
    }
 else     if (scopeGroup.isCompany()) {
      if (Validator.isNotNull(scopeType) && scopeType.equals("company")) {
        return layout.getPlid();
      }
    }
 else {
      if (Validator.isNull(scopeType)) {
        return layout.getPlid();
      }
    }
  }
  return LayoutConstants.DEFAULT_PLID;
}
