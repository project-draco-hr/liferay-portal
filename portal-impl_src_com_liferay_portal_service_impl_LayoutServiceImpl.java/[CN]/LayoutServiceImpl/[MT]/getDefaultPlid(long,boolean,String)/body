{
  if (groupId <= 0) {
    return LayoutConstants.DEFAULT_PLID;
  }
  String scopeGroupLayoutUuid=null;
  Group group=groupLocalService.getGroup(groupId);
  if (group.isLayout()) {
    groupId=group.getParentGroupId();
    Layout scopeGroupLayout=layoutLocalService.getLayout(group.getClassPK());
    scopeGroupLayoutUuid=scopeGroupLayout.getUuid();
  }
  List<Layout> layouts=layoutPersistence.filterFindByG_P(groupId,privateLayout);
  for (  Layout layout : layouts) {
    if (!layout.isTypePortlet()) {
      continue;
    }
    LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
    if (!layoutTypePortlet.hasPortletId(portletId)) {
      continue;
    }
    javax.portlet.PortletPreferences jxPreferences=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portletId);
    if (group.isLayout()) {
      String scopeLayoutUuid=GetterUtil.getString(jxPreferences.getValue("lfrScopeLayoutUuid",null));
      if (scopeGroupLayoutUuid.equals(scopeLayoutUuid)) {
        return layout.getPlid();
      }
    }
 else {
      String scopeType=GetterUtil.getString(jxPreferences.getValue("lfr-scope-type",null));
      if (Validator.isNull(scopeType)) {
        return layout.getPlid();
      }
    }
  }
  return LayoutConstants.DEFAULT_PLID;
}
