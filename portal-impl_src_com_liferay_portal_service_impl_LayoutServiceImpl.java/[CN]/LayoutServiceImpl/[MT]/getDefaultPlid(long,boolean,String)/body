{
  if (groupId > 0) {
    String scopeGroupLayoutUuid=null;
    Group group=groupLocalService.getGroup(groupId);
    if (group.isLayout()) {
      groupId=group.getParentGroupId();
      Layout scopeGroupLayout=layoutLocalService.getLayout(group.getClassPK());
      scopeGroupLayoutUuid=scopeGroupLayout.getUuid();
    }
    List<Layout> layouts=layoutPersistence.filterFindByG_P(groupId,privateLayout);
    for (    Layout layout : layouts) {
      if (layout.isTypePortlet()) {
        LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
        if (layoutTypePortlet.hasPortletId(portletId)) {
          javax.portlet.PortletPreferences jxPreferences=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portletId);
          if (group.isLayout()) {
            String scopeLayoutUuid=GetterUtil.getString(jxPreferences.getValue("lfrScopeLayoutUuid",null));
            if (scopeGroupLayoutUuid != null && scopeGroupLayoutUuid.equals(scopeLayoutUuid)) {
              return layout.getPlid();
            }
          }
 else {
            String scopeType=GetterUtil.getString(jxPreferences.getValue("lfr-scope-type",null));
            if (scopeType == null || scopeType.length() == 0) {
              return layout.getPlid();
            }
          }
        }
      }
    }
  }
  return LayoutConstants.DEFAULT_PLID;
}
