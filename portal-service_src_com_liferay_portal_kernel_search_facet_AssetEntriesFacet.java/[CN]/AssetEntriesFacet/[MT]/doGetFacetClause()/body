{
  SearchContext searchContext=getSearchContext();
  String[] entryClassNames=searchContext.getEntryClassNames();
  BooleanQuery facetQuery=BooleanQueryFactoryUtil.create();
  for (  String entryClassName : entryClassNames) {
    Indexer indexer=IndexerRegistryUtil.getIndexer(entryClassName);
    if (indexer == null) {
      continue;
    }
    try {
      BooleanQuery indexerBooleanQuery=indexer.getFacetQuery(entryClassName,searchContext);
      if ((indexerBooleanQuery == null) || (indexerBooleanQuery.clauses().isEmpty())) {
        continue;
      }
      indexer.postProcessContextQuery(indexerBooleanQuery,searchContext);
      for (      IndexerPostProcessor indexerPostProcessor : indexer.getIndexerPostProcessors()) {
        indexerPostProcessor.postProcessContextQuery(indexerBooleanQuery,searchContext);
      }
      facetQuery.add(indexerBooleanQuery,BooleanClauseOccur.SHOULD);
      if (!indexer.isStagingAware()) {
        continue;
      }
      if (!searchContext.isIncludeLiveGroups() && searchContext.isIncludeStagingGroups()) {
        facetQuery.addRequiredTerm(Field.STAGING_GROUP,true);
      }
 else       if (searchContext.isIncludeLiveGroups() && !searchContext.isIncludeStagingGroups()) {
        facetQuery.addRequiredTerm(Field.STAGING_GROUP,false);
      }
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
  if (facetQuery.clauses().isEmpty()) {
    return null;
  }
  return BooleanClauseFactoryUtil.create(facetQuery,BooleanClauseOccur.MUST.getName());
}
