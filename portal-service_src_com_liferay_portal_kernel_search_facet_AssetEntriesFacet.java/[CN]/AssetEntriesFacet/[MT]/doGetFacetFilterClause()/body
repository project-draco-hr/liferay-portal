{
  SearchContext searchContext=getSearchContext();
  String[] entryClassNames=searchContext.getEntryClassNames();
  BooleanFilter facetFilter=new BooleanFilter();
  for (  String entryClassName : entryClassNames) {
    Indexer indexer=IndexerRegistryUtil.getIndexer(entryClassName);
    if (indexer == null) {
      continue;
    }
    String searchEngineId=searchContext.getSearchEngineId();
    if (!searchEngineId.equals(indexer.getSearchEngineId())) {
      continue;
    }
    try {
      BooleanFilter indexerBooleanFilter=indexer.getFacetFilter(entryClassName,searchContext);
      if ((indexerBooleanFilter == null) || !indexerBooleanFilter.hasClauses()) {
        continue;
      }
      BooleanFilter entityFilter=new BooleanFilter();
      entityFilter.add(indexerBooleanFilter,BooleanClauseOccur.MUST);
      indexer.postProcessContextFilter(entityFilter,searchContext);
      for (      IndexerPostProcessor indexerPostProcessor : indexer.getIndexerPostProcessors()) {
        indexerPostProcessor.postProcessContextFilter(entityFilter,searchContext);
      }
      postProcessContextQuery(entityFilter,searchContext,indexer);
      if (indexer.isStagingAware()) {
        if (!searchContext.isIncludeLiveGroups() && searchContext.isIncludeStagingGroups()) {
          entityFilter.addRequiredTerm(Field.STAGING_GROUP,true);
        }
 else         if (searchContext.isIncludeLiveGroups() && !searchContext.isIncludeStagingGroups()) {
          entityFilter.addRequiredTerm(Field.STAGING_GROUP,false);
        }
      }
      if (entityFilter.hasClauses()) {
        facetFilter.add(entityFilter,BooleanClauseOccur.SHOULD);
      }
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
  if (!facetFilter.hasClauses()) {
    return null;
  }
  return BooleanClauseFactoryUtil.createFilter(searchContext,facetFilter,BooleanClauseOccur.MUST);
}
