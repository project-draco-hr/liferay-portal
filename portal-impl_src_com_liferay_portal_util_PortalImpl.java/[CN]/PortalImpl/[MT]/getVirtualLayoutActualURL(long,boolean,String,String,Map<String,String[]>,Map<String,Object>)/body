{
  String groupFriendlyURL=null;
  int pos=friendlyURL.indexOf(CharPool.SLASH,3);
  if (pos != -1) {
    groupFriendlyURL=friendlyURL.substring(2,pos);
  }
  if (Validator.isNull(groupFriendlyURL)) {
    return mainPath;
  }
  HttpServletRequest request=(HttpServletRequest)requestContext.get("request");
  long companyId=PortalInstances.getCompanyId(request);
  Group group=GroupLocalServiceUtil.fetchFriendlyURLGroup(companyId,groupFriendlyURL);
  if (group == null) {
    return mainPath;
  }
  String layoutFriendlyURL=null;
  if ((pos != -1) && ((pos + 1) != friendlyURL.length())) {
    layoutFriendlyURL=friendlyURL.substring(pos,friendlyURL.length());
  }
  if (Validator.isNull(layoutFriendlyURL)) {
    return mainPath;
  }
  String actualURL=getActualURL(group.getGroupId(),privateLayout,mainPath,layoutFriendlyURL,params,requestContext);
  return HttpUtil.addParameter(HttpUtil.removeParameter(actualURL,"hostGroupId"),"hostGroupId",groupId);
}
