{
  if (req instanceof PortletRequestImpl) {
    PortletRequestImpl reqImpl=(PortletRequestImpl)req;
    return reqImpl.getHttpServletRequest();
  }
 else   if (req instanceof PortletRequestWrapper) {
    PortletRequestWrapper reqWrapper=(PortletRequestWrapper)req;
    return getHttpServletRequest(reqWrapper.getRequest());
  }
 else {
    throw new RuntimeException("Unable to get the HTTP servlet request from " + req.getClass().getName());
  }
}
