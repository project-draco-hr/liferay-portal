{
  Layout layout=(Layout)request.getAttribute(WebKeys.LAYOUT);
  long scopeGroupId=0;
  if ((layout != null) && layout.getGroup().getName().equals(GroupConstants.CONTROL_PANEL)) {
    long doAsGroupId=ParamUtil.getLong(request,"doAsGroupId");
    if (doAsGroupId > 0) {
      scopeGroupId=doAsGroupId;
    }
  }
  if (scopeGroupId <= 0) {
    scopeGroupId=getScopeGroupId(layout,portletId);
  }
  return scopeGroupId;
}
