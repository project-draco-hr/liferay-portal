{
  if (Validator.isNull(url) || !HttpUtil.hasDomain(url)) {
    return url;
  }
  try {
    String securityMode=PropsValues.REDIRECT_URL_SECURITY_MODE;
    String domain=StringUtil.split(HttpUtil.getDomain(url),StringPool.COLON)[0];
    if (securityMode.equals("domain")) {
      String[] allowedDomains=PropsValues.REDIRECT_URL_DOMAINS_ALLOWED;
      if ((allowedDomains.length > 0) && !ArrayUtil.contains(allowedDomains,domain)) {
        if (_log.isDebugEnabled()) {
          _log.debug("Redirect URL " + url + " is not in the "+ "redirect.url.domains.allowed list.");
        }
        url=null;
      }
    }
 else     if (securityMode.equals("ip")) {
      String[] allowedIps=PropsValues.REDIRECT_URL_IPS_ALLOWED;
      InetAddress inetAddress=InetAddress.getByName(domain);
      if ((allowedIps.length > 0) && !ArrayUtil.contains(allowedIps,inetAddress.getHostAddress())) {
        String serverIp=getComputerAddress();
        if (!serverIp.equals(inetAddress.getHostAddress()) || !ArrayUtil.contains(allowedIps,"SERVER_IP")) {
          if (_log.isDebugEnabled()) {
            _log.debug("Redirect URL " + url + " is not in the "+ "redirect.url.ips.allowed list.");
          }
          url=null;
        }
      }
    }
  }
 catch (  UnknownHostException uhe) {
    if (_log.isDebugEnabled()) {
      _log.debug("Redirect URL " + url + " IP address could not be found.");
    }
    url=null;
  }
  return url;
}
