{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay.isAjax() || themeDisplay.isIsolated() || themeDisplay.isLifecycleResource()|| themeDisplay.isStateExclusive()) {
    return StringUtil.randomId();
  }
 else {
    return DeterminateKeyGenerator.generate(input);
  }
}
