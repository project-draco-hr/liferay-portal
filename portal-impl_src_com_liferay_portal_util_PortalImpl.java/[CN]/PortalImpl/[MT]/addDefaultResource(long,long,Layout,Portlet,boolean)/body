{
  String rootPortletId=portlet.getRootPortletId();
  String portletPrimaryKey=PortletPermissionUtil.getPrimaryKey(layout.getPlid(),portlet.getPortletId());
  String name=null;
  String primaryKey=null;
  if (portletActions) {
    name=rootPortletId;
    primaryKey=portletPrimaryKey;
  }
 else {
    Group group=GroupLocalServiceUtil.fetchGroup(groupId);
    if ((group != null) && group.isStagingGroup()) {
      groupId=group.getLiveGroupId();
    }
    name=ResourceActionsUtil.getPortletBaseResource(rootPortletId);
    primaryKey=String.valueOf(groupId);
  }
  if (Validator.isNull(name)) {
    return;
  }
  int count=ResourcePermissionLocalServiceUtil.getResourcePermissionsCount(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,primaryKey);
  if (count > 0) {
    return;
  }
  boolean addGuestPermissions=true;
  if (portletActions) {
    Group layoutGroup=layout.getGroup();
    if (layout.isPrivateLayout() && !layoutGroup.isLayoutPrototype()) {
      addGuestPermissions=false;
    }
  }
  ResourceLocalServiceUtil.addResources(companyId,groupId,0,name,primaryKey,portletActions,true,addGuestPermissions);
}
