{
  if (!isLayoutFriendliable(layout)) {
    return null;
  }
  String layoutFriendlyURL=layout.getFriendlyURL();
  LayoutSet layoutSet=layout.getLayoutSet();
  if (Validator.isNotNull(layoutSet.getVirtualHost())) {
    String portalURL=getPortalURL(layoutSet.getVirtualHost(),themeDisplay.getServerPort(),themeDisplay.isSecure());
    long curLayoutSetId=themeDisplay.getLayout().getLayoutSet().getLayoutSetId();
    if ((layoutSet.getLayoutSetId() != curLayoutSetId) || (portalURL.startsWith(themeDisplay.getPortalURL()))) {
      if (themeDisplay.isWidget()) {
        layoutFriendlyURL=_WIDGET_MAPPING + layoutFriendlyURL;
      }
      if (themeDisplay.isI18n()) {
        layoutFriendlyURL=StringPool.SLASH + themeDisplay.getI18nLanguageId() + layoutFriendlyURL;
      }
      return portalURL + getPathContext() + layoutFriendlyURL;
    }
  }
  Group group=layout.getGroup();
  String friendlyURL=null;
  if (layout.isPrivateLayout()) {
    if (group.isUser()) {
      friendlyURL=_PRIVATE_USER_MAPPING;
    }
 else {
      friendlyURL=_PRIVATE_GROUP_MAPPING;
    }
  }
 else {
    friendlyURL=_PUBLIC_GROUP_MAPPING;
  }
  if (themeDisplay.isWidget()) {
    friendlyURL=_WIDGET_MAPPING + friendlyURL;
  }
  if (themeDisplay.isI18n()) {
    friendlyURL=StringPool.SLASH + themeDisplay.getI18nLanguageId() + friendlyURL;
  }
  return getPathContext() + friendlyURL + group.getFriendlyURL()+ layoutFriendlyURL;
}
