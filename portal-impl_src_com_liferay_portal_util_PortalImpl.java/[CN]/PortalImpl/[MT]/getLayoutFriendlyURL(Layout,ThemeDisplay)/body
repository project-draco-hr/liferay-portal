{
  if (!isLayoutFriendliable(layout)) {
    return null;
  }
  String layoutFriendlyURL=layout.getFriendlyURL();
  LayoutSet layoutSet=layout.getLayoutSet();
  long curLayoutSetId=themeDisplay.getLayout().getLayoutSet().getLayoutSetId();
  String portalURL=StringPool.BLANK;
  if (!themeDisplay.getServerName().equals(_LOCALHOST)) {
    if (Validator.isNotNull(layoutSet.getVirtualHost())) {
      String layoutSetVirtualHost=getPortalURL(layoutSet.getVirtualHost(),themeDisplay.getServerPort(),themeDisplay.isSecure());
      if ((layoutSet.getLayoutSetId() != curLayoutSetId) || (layoutSetVirtualHost.startsWith(themeDisplay.getPortalURL()))) {
        if (themeDisplay.isWidget()) {
          layoutFriendlyURL=PropsValues.WIDGET_SERVLET_MAPPING + layoutFriendlyURL;
        }
        if (themeDisplay.isI18n()) {
          layoutFriendlyURL=StringPool.SLASH + themeDisplay.getI18nLanguageId() + layoutFriendlyURL;
        }
        return layoutSetVirtualHost + _pathContext + layoutFriendlyURL;
      }
    }
 else {
      if ((layoutSet.getLayoutSetId() != curLayoutSetId) && (layout.getGroup().getClassPK() != themeDisplay.getUserId())) {
        String virtualHost=themeDisplay.getCompany().getVirtualHost();
        if (!virtualHost.equalsIgnoreCase(_LOCALHOST)) {
          portalURL=getPortalURL(virtualHost,themeDisplay.getServerPort(),themeDisplay.isSecure());
        }
      }
    }
  }
  Group group=layout.getGroup();
  String friendlyURL=null;
  if (layout.isPrivateLayout()) {
    if (group.isUser()) {
      friendlyURL=_PRIVATE_USER_SERVLET_MAPPING;
    }
 else {
      friendlyURL=_PRIVATE_GROUP_SERVLET_MAPPING;
    }
  }
 else {
    friendlyURL=_PUBLIC_GROUP_SERVLET_MAPPING;
  }
  if (themeDisplay.isWidget()) {
    friendlyURL=PropsValues.WIDGET_SERVLET_MAPPING + friendlyURL;
  }
  if (themeDisplay.isI18n()) {
    friendlyURL=StringPool.SLASH + themeDisplay.getI18nLanguageId() + friendlyURL;
  }
  return portalURL + _pathContext + friendlyURL+ group.getFriendlyURL()+ layoutFriendlyURL;
}
