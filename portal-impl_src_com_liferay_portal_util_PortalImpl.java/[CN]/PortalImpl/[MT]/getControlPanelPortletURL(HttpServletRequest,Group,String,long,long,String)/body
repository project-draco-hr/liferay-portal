{
  RequestBackedPortletURLFactory requestBackedPortletURLFactory=RequestBackedPortletURLFactoryUtil.create(request);
  if (group == null) {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    group=getControlPanelDisplayGroup(themeDisplay.getCompanyId(),themeDisplay.getScopeGroupId(),themeDisplay.getDoAsGroupId(),portletId);
  }
  return requestBackedPortletURLFactory.createControlPanelPortletURL(portletId,group,refererGroupId,refererPlid,lifecycle);
}
