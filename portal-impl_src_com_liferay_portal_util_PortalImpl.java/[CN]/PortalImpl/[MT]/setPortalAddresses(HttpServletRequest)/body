{
  boolean secure=request.isSecure();
  if ((secure && (_securePortalLocalAddress.get() != null) && (_securePortalServerAddress.get() != null)) || (!secure && (_portalLocalAddress.get() != null) && (_portalServerAddress.get() != null))) {
    return;
  }
  String localAddress=request.getLocalAddr();
  int localPort=request.getLocalPort();
  String serverAddress=request.getServerName();
  int serverPort=request.getServerPort();
  InetAddress localInetAddress=null;
  InetAddress serverInetAddress=null;
  try {
    localInetAddress=InetAddress.getByName(localAddress);
    serverInetAddress=InetAddress.getByName(serverAddress);
  }
 catch (  UnknownHostException uhe) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to resolve portal host",uhe);
    }
    return;
  }
  InetSocketAddress localInetSocketAddress=new InetSocketAddress(localInetAddress,localPort);
  InetSocketAddress serverInetSocketAddress=new InetSocketAddress(serverInetAddress,serverPort);
  if (secure) {
    if (StringUtil.equalsIgnoreCase(Http.HTTPS,PropsValues.WEB_SERVER_PROTOCOL)) {
      if (_securePortalLocalAddress.compareAndSet(null,localInetSocketAddress)) {
        notifyPortalInetSocketAddressEventListeners(localInetSocketAddress,true);
      }
      if (_securePortalServerAddress.compareAndSet(null,serverInetSocketAddress)) {
        notifyPortalInetSocketAddressEventListeners(serverInetSocketAddress,false);
      }
    }
  }
 else {
    if (_portalLocalAddress.compareAndSet(null,localInetSocketAddress)) {
      notifyPortalInetSocketAddressEventListeners(localInetSocketAddress,true);
    }
    if (_portalServerAddress.compareAndSet(null,serverInetSocketAddress)) {
      notifyPortalInetSocketAddressEventListeners(serverInetSocketAddress,false);
    }
  }
}
