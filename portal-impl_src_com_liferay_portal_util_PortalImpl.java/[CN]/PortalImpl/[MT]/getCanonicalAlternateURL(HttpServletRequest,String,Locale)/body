{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  String layoutURL=PortalUtil.getLayoutFriendlyURL(layout,themeDisplay,locale);
  int pos=originalURL.indexOf(Portal.FRIENDLY_URL_SEPARATOR);
  if (pos == -1) {
    pos=originalURL.indexOf(StringPool.QUESTION);
  }
  if (pos != -1) {
    originalURL=originalURL.substring(pos);
  }
 else {
    originalURL=StringPool.BLANK;
  }
  String friendlyGroupURL=layout.getGroup().getFriendlyURL();
  String serverHost=StringPool.BLANK;
  int posFriendlyGroup=layoutURL.indexOf(friendlyGroupURL);
  if (posFriendlyGroup != -1) {
    serverHost=PortalUtil.getPortalURL(request);
  }
  if (layout.isFirstParent() && Validator.isNull(originalURL)) {
    String absolutGroupFriendlyURL=layoutURL.substring(0,layoutURL.indexOf(layout.getFriendlyURL()));
    originalURL=serverHost.concat(absolutGroupFriendlyURL);
  }
 else {
    originalURL=serverHost.concat(layoutURL).concat(originalURL);
  }
  return originalURL;
}
