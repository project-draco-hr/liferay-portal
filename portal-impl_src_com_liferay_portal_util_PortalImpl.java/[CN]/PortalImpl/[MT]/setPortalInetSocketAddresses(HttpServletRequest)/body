{
  boolean secure=request.isSecure();
  if ((secure && (_securePortalLocalInetSocketAddress.get() != null) && (_securePortalServerInetSocketAddress.get() != null)) || (!secure && (_portalLocalInetSocketAddress.get() != null) && (_portalServerInetSocketAddress.get() != null))) {
    return;
  }
  InetAddress localInetAddress=null;
  InetAddress serverInetAddress=null;
  try {
    localInetAddress=InetAddress.getByName(request.getLocalAddr());
    serverInetAddress=InetAddress.getByName(request.getServerName());
  }
 catch (  UnknownHostException uhe) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to resolve portal host",uhe);
    }
    return;
  }
  InetSocketAddress localInetSocketAddress=new InetSocketAddress(localInetAddress,request.getLocalPort());
  InetSocketAddress serverInetSocketAddress=new InetSocketAddress(serverInetAddress,request.getServerPort());
  if (secure) {
    if (_securePortalLocalInetSocketAddress.compareAndSet(null,localInetSocketAddress)) {
      notifyPortalInetSocketAddressEventListeners(localInetSocketAddress,true);
    }
    if (_securePortalServerInetSocketAddress.compareAndSet(null,serverInetSocketAddress)) {
      notifyPortalInetSocketAddressEventListeners(serverInetSocketAddress,false);
    }
  }
 else {
    if (_portalLocalInetSocketAddress.compareAndSet(null,localInetSocketAddress)) {
      notifyPortalInetSocketAddressEventListeners(localInetSocketAddress,true);
    }
    if (_portalServerInetSocketAddress.compareAndSet(null,serverInetSocketAddress)) {
      notifyPortalInetSocketAddressEventListeners(serverInetSocketAddress,false);
    }
  }
}
