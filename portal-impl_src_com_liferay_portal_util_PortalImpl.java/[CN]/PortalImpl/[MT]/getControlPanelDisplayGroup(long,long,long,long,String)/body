{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletId);
  String portletCategory=portlet.getControlPanelEntryCategory();
  if (portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_APPS) || portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_CONFIGURATION) || portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_SITES)|| portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_SYSTEM)|| portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_USERS)) {
    return null;
  }
 else   if (portletCategory.equals(PortletCategoryKeys.USER_MY_ACCOUNT)) {
    User user=UserLocalServiceUtil.fetchUser(userId);
    if (user != null) {
      return user.getGroup();
    }
    return null;
  }
 else {
    Group group=null;
    if (doAsGroupId > 0) {
      group=GroupLocalServiceUtil.fetchGroup(doAsGroupId);
    }
    if (group == null) {
      group=GroupLocalServiceUtil.fetchGroup(scopeGroupId);
    }
    return group;
  }
}
