{
  Map<String,List<Portlet>> categoriesMap=(Map<String,List<Portlet>>)request.getAttribute(attributeName);
  if (categoriesMap != null) {
    return categoriesMap;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  categoriesMap=new LinkedHashMap<String,List<Portlet>>();
  for (  String category : categories) {
    Group group=themeDisplay.getSiteGroup();
    if (group.isInheritContent() && category.equals(PortletCategoryKeys.SITE_ADMINISTRATION_CONTENT)) {
      continue;
    }
    List<Portlet> portlets=getControlPanelPortlets(category,themeDisplay);
    if (!portlets.isEmpty()) {
      categoriesMap.put(category,portlets);
    }
  }
  request.setAttribute(attributeName,categoriesMap);
  return categoriesMap;
}
