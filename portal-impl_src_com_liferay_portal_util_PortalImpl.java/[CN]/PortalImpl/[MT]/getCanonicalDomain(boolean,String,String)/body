{
  boolean defaultNonLocalhostVirtualhost=false;
  if (!StringUtil.equalsIgnoreCase(portalDomain,_LOCALHOST) && StringUtil.equalsIgnoreCase(virtualHostname,_LOCALHOST)) {
    defaultNonLocalhostVirtualhost=true;
  }
  if ((canonicalURL && !defaultNonLocalhostVirtualhost) || Validator.isBlank(portalDomain)) {
    return virtualHostname;
  }
  int pos=portalDomain.indexOf(CharPool.COLON);
  if (pos != -1) {
    portalDomain=portalDomain.substring(0,pos);
  }
  if (defaultNonLocalhostVirtualhost) {
    virtualHostname=portalDomain;
  }
  return virtualHostname;
}
