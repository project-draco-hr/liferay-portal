{
  if (canonicalURL || Validator.isBlank(portalDomain)) {
    return virtualHostname;
  }
  int pos=portalDomain.indexOf(CharPool.COLON);
  if (pos != -1) {
    portalDomain=portalDomain.substring(0,pos);
  }
  if (!StringUtil.equalsIgnoreCase(portalDomain,_LOCALHOST) && StringUtil.equalsIgnoreCase(virtualHostname,_LOCALHOST)) {
    virtualHostname=portalDomain;
  }
  return virtualHostname;
}
