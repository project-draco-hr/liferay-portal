{
  if (doAsUser) {
    if (Validator.isNotNull(themeDisplay.getDoAsUserId())) {
      url=HttpUtil.setParameter(url,"doAsUserId",themeDisplay.getDoAsUserId());
    }
    if (Validator.isNotNull(themeDisplay.getDoAsUserLanguageId())) {
      url=HttpUtil.setParameter(url,"doAsUserLanguageId",themeDisplay.getDoAsUserLanguageId());
    }
  }
  if (layout.isTypeControlPanel()) {
    if (themeDisplay.getDoAsGroupId() > 0) {
      url=HttpUtil.setParameter(url,"doAsGroupId",themeDisplay.getDoAsGroupId());
    }
    if (Validator.isNotNull(themeDisplay.getPpid())) {
      url=HttpUtil.setParameter(url,"p_p_id",themeDisplay.getPpid());
    }
    if (themeDisplay.getRefererGroupId() != GroupConstants.DEFAULT_PARENT_GROUP_ID) {
      url=HttpUtil.setParameter(url,"refererGroupId",themeDisplay.getRefererGroupId());
    }
    if (themeDisplay.getRefererPlid() != LayoutConstants.DEFAULT_PLID) {
      url=HttpUtil.setParameter(url,"refererPlid",themeDisplay.getRefererPlid());
    }
  }
  return url;
}
