{
  long companyId=getCompanyId(httpServletRequest);
  Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletDisplay.getId());
  boolean strutsPortlet=false;
  ServletContext servletContext=(ServletContext)httpServletRequest.getAttribute(WebKeys.CTX);
  InvokerPortlet invokerPortlet=PortletInstanceFactoryUtil.create(portlet,servletContext);
  if (invokerPortlet.isStrutsPortlet() || invokerPortlet.isStrutsBridgePortlet()) {
    strutsPortlet=true;
  }
  return (group.isLayoutPrototype() && layoutTypePortlet.hasPortletId(portletDisplay.getId()) && !portletName.equals(PortletKeys.NESTED_PORTLETS)&& portletDisplay.isModeView()&& !portlet.isSystem()&& !strutsPortlet);
}
