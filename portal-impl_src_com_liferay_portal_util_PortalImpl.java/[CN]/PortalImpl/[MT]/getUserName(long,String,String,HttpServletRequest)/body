{
  String userName=defaultUserName;
  try {
    User user=UserLocalServiceUtil.getUserById(userId);
    if (userAttribute.equals(UserAttributes.USER_NAME_FULL)) {
      userName=user.getFullName();
    }
 else {
      userName=user.getScreenName();
    }
    if (request != null) {
      Layout layout=(Layout)request.getAttribute(WebKeys.LAYOUT);
      PortletURL portletURL=new PortletURLImpl(request,PortletKeys.DIRECTORY,layout.getPlid(),PortletRequest.RENDER_PHASE);
      portletURL.setWindowState(WindowState.MAXIMIZED);
      portletURL.setPortletMode(PortletMode.VIEW);
      portletURL.setParameter("struts_action","/directory/view_user");
      portletURL.setParameter("p_u_i_d",String.valueOf(user.getUserId()));
      userName="<a href=\"" + portletURL.toString() + "\">"+ HtmlUtil.escape(userName)+ "</a>";
    }
  }
 catch (  Exception e) {
  }
  return userName;
}
