{
  String currentPortletURL=(String)portletRequest.getAttribute(WebKeys.CURRENT_PORTLET_URL);
  if (currentPortletURL != null) {
    return currentPortletURL;
  }
  LiferayPortletRequest liferayPortletRequest=getLiferayPortletRequest(portletRequest);
  LiferayPortletResponse liferayPortletResponse=getLiferayPortletResponse(portletResponse);
  PortletURL currentURLObj=PortletURLUtil.getCurrent(liferayPortletRequest,liferayPortletResponse);
  currentPortletURL=currentURLObj.toString();
  portletRequest.setAttribute(WebKeys.CURRENT_PORTLET_URL,currentPortletURL);
  return currentPortletURL;
}
