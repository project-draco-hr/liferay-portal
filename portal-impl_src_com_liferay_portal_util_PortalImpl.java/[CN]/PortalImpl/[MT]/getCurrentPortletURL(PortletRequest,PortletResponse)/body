{
  String currentPortletURL=(String)portletRequest.getAttribute(WebKeys.CURRENT_PORTLET_URL);
  if (currentPortletURL != null) {
    return currentPortletURL;
  }
  LiferayPortletRequest liferayPortletRequest=getLiferayPortletRequest(portletRequest);
  LiferayPortletResponse liferayPortletResponse=getLiferayPortletResponse(portletResponse);
  currentPortletURL=String.valueOf(PortletURLUtil.getCurrent(liferayPortletRequest,liferayPortletResponse));
  portletRequest.setAttribute(WebKeys.CURRENT_PORTLET_URL,currentPortletURL);
  return currentPortletURL;
}
