{
  Layout layout=null;
  String queryString=StringPool.BLANK;
  if (Validator.isNull(friendlyURL)) {
    List<Layout> layouts=LayoutLocalServiceUtil.getLayouts(groupId,privateLayout,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
    if (!layouts.isEmpty()) {
      layout=layouts.get(0);
    }
 else {
      throw new NoSuchLayoutException("{groupId=" + groupId + ",privateLayout="+ privateLayout+ "} does not have any layouts");
    }
  }
 else {
    Object[] friendlyURLMapper=getPortletFriendlyURLMapper(groupId,privateLayout,friendlyURL,params,requestContext);
    layout=(Layout)friendlyURLMapper[0];
    queryString=(String)friendlyURLMapper[1];
  }
  String layoutActualURL=getLayoutActualURL(layout,mainPath);
  if (Validator.isNotNull(queryString)) {
    layoutActualURL=layoutActualURL.concat(queryString);
  }
 else   if (params.isEmpty()) {
    LayoutType layoutType=layout.getLayoutType();
    UnicodeProperties typeSettingsProperties=layoutType.getTypeSettingsProperties();
    queryString=typeSettingsProperties.getProperty("query-string");
    if (Validator.isNotNull(queryString) && layoutActualURL.contains(StringPool.QUESTION)) {
      layoutActualURL=layoutActualURL.concat(StringPool.AMPERSAND).concat(queryString);
    }
  }
  return layoutActualURL;
}
