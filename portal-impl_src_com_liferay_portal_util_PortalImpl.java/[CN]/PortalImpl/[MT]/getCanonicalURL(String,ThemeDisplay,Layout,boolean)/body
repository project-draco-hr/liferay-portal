{
  completeURL=removeRedirectParameter(completeURL);
  String parametersURL=StringPool.BLANK;
  int pos=completeURL.indexOf(Portal.FRIENDLY_URL_SEPARATOR);
  if (pos == -1) {
    pos=completeURL.indexOf(StringPool.QUESTION);
  }
  String groupFriendlyURL=completeURL;
  if (pos != -1) {
    groupFriendlyURL=completeURL.substring(0,pos);
    parametersURL=completeURL.substring(pos);
  }
  if (layout == null) {
    layout=themeDisplay.getLayout();
  }
  String layoutFriendlyURL=StringPool.BLANK;
  if ((groupFriendlyURL.contains(layout.getFriendlyURL()) || groupFriendlyURL.contains(StringPool.SLASH + layout.getLayoutId())) && (!layout.isFirstParent() || Validator.isNotNull(parametersURL))) {
    layoutFriendlyURL=layout.getFriendlyURL();
  }
 else   if (forceLayoutInURL) {
    layoutFriendlyURL=layout.getFriendlyURL();
  }
  Group group=layout.getGroup();
  groupFriendlyURL=getGroupFriendlyURL(group,layout.isPrivateLayout(),themeDisplay,true);
  return groupFriendlyURL.concat(layoutFriendlyURL).concat(parametersURL);
}
