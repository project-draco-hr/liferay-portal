{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  String rootPortletId=portlet.getRootPortletId();
  String portletPrimaryKey=PortletPermissionUtil.getPrimaryKey(layout.getPlid(),portlet.getPortletId());
  try {
    if (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 6) {
      int resourcePermissionsCount=ResourcePermissionLocalServiceUtil.getResourcePermissionsCount(themeDisplay.getCompanyId(),rootPortletId,ResourceConstants.SCOPE_INDIVIDUAL,portletPrimaryKey);
      if (resourcePermissionsCount == 0) {
        throw new NoSuchResourceException();
      }
    }
 else     if (!portlet.isUndeployedPortlet()) {
      ResourceLocalServiceUtil.getResource(themeDisplay.getCompanyId(),rootPortletId,ResourceConstants.SCOPE_INDIVIDUAL,portletPrimaryKey);
    }
  }
 catch (  NoSuchResourceException nsre) {
    ResourceLocalServiceUtil.addResources(themeDisplay.getCompanyId(),layout.getGroupId(),0,rootPortletId,portletPrimaryKey,true,true,true);
  }
}
