{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=getControlPanelLayout(themeDisplay,group);
  Layout previousLayout=(Layout)request.getAttribute(WebKeys.LAYOUT);
  request.setAttribute(WebKeys.LAYOUT,layout);
  LiferayPortletURL liferayPortletURL=new PortletURLImpl(request,portletId,layout.getPlid(),lifecycle);
  request.setAttribute(WebKeys.LAYOUT,previousLayout);
  if (refererPlid > 0) {
    liferayPortletURL.setRefererPlid(refererPlid);
  }
  try {
    liferayPortletURL.setWindowState(WindowState.MAXIMIZED);
  }
 catch (  WindowStateException wse) {
    _log.error(wse);
  }
  return liferayPortletURL;
}
