{
  if (!image) {
    if (imageId > 0) {
      ImageLocalServiceUtil.deleteImage(imageId);
      BeanPropertiesUtil.setProperty(baseModel,fieldName,0);
    }
    return;
  }
  if (ArrayUtil.isEmpty(bytes)) {
    return;
  }
  if ((maxSize > 0) && ((bytes == null) || (bytes.length > maxSize))) {
    throw new ImageSizeException();
  }
  if (imageId <= 0) {
    imageId=CounterLocalServiceUtil.increment();
    BeanPropertiesUtil.setProperty(baseModel,fieldName,imageId);
  }
  if ((maxHeight > 0) || (maxWidth > 0)) {
    try {
      ImageBag imageBag=ImageToolUtil.read(bytes);
      RenderedImage renderedImage=imageBag.getRenderedImage();
      if (renderedImage == null) {
        throw new ImageTypeException();
      }
      renderedImage=ImageToolUtil.scale(renderedImage,maxHeight,maxWidth);
      bytes=ImageToolUtil.getBytes(renderedImage,imageBag.getType());
    }
 catch (    IOException ioe) {
      throw new ImageSizeException(ioe);
    }
  }
  ImageLocalServiceUtil.updateImage(imageId,bytes);
}
