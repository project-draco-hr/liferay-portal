{
  boolean secure=false;
  if (PropsValues.WEB_SERVER_FORWARD_PROTO_ENABLED) {
    String forwardedProto=request.getHeader(PropsValues.WEB_SERVER_FORWARD_PROTO_HEADER);
    if (Validator.equals(Http.HTTPS,forwardedProto)) {
      secure=true;
    }
    return secure;
  }
  HttpSession session=request.getSession();
  if (session == null) {
    return request.isSecure();
  }
  Boolean httpsInitial=(Boolean)session.getAttribute(WebKeys.HTTPS_INITIAL);
  if (PropsValues.COMPANY_SECURITY_AUTH_REQUIRES_HTTPS && !PropsValues.SESSION_ENABLE_PHISHING_PROTECTION && (httpsInitial != null)&& !httpsInitial.booleanValue()) {
    secure=false;
  }
 else {
    secure=request.isSecure();
  }
  return secure;
}
