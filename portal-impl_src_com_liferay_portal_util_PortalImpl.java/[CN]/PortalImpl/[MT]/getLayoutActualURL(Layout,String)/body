{
  Map<String,String> variables=new HashMap<>();
  layout=getBrowsableLayout(layout);
  variables.put("liferay:groupId",String.valueOf(layout.getGroupId()));
  variables.put("liferay:mainPath",mainPath);
  variables.put("liferay:plid",String.valueOf(layout.getPlid()));
  if (layout instanceof VirtualLayout) {
    variables.put("liferay:pvlsgid",String.valueOf(layout.getGroupId()));
  }
 else {
    variables.put("liferay:pvlsgid","0");
  }
  LayoutType layoutType=layout.getLayoutType();
  UnicodeProperties typeSettingsProperties=layoutType.getTypeSettingsProperties();
  variables.putAll(typeSettingsProperties);
  return layoutType.getURL(variables);
}
