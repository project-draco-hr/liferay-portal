{
  Layout layout=themeDisplay.getLayout();
  StringBundler sb=new StringBundler(9);
  sb.append(themeDisplay.getPortalURL());
  if (Validator.isNotNull(_pathContext)) {
    sb.append(_pathContext);
  }
  if (themeDisplay.isI18n()) {
    sb.append(themeDisplay.getI18nPath());
  }
  sb.append(servletPath);
  Group group=layout.getGroup();
  if (layout.isPrivateLayout()) {
    if (group.isUser()) {
      sb.append(_PRIVATE_USER_SERVLET_MAPPING);
    }
 else {
      sb.append(_PRIVATE_GROUP_SERVLET_MAPPING);
    }
  }
 else {
    sb.append(_PUBLIC_GROUP_SERVLET_MAPPING);
  }
  sb.append(group.getFriendlyURL());
  sb.append(layout.getFriendlyURL(themeDisplay.getLocale()));
  sb.append(FRIENDLY_URL_SEPARATOR);
  FriendlyURLMapper friendlyURLMapper=portlet.getFriendlyURLMapperInstance();
  if ((friendlyURLMapper != null) && !portlet.isInstanceable()) {
    sb.append(friendlyURLMapper.getMapping());
  }
 else {
    sb.append(portlet.getPortletId());
  }
  return sb.toString();
}
