{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletId);
  String portletCategory=portlet.getControlPanelEntryCategory();
  if (portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_APPS) || portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_CONFIGURATION) || portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_SITES)|| portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_SYSTEM)|| portletCategory.equals(PortletCategoryKeys.CONTROL_PANEL_USERS)|| portletCategory.equals(PortletCategoryKeys.USER_MY_ACCOUNT)) {
    return GroupLocalServiceUtil.fetchGroup(companyId,GroupConstants.CONTROL_PANEL);
  }
 else {
    Group group=null;
    if (doAsGroupId > 0) {
      group=GroupLocalServiceUtil.fetchGroup(doAsGroupId);
    }
    if (group == null) {
      group=GroupLocalServiceUtil.fetchGroup(scopeGroupId);
    }
    return group;
  }
}
