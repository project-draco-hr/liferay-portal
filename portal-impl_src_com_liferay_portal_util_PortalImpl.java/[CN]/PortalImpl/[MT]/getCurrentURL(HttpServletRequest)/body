{
  String currentURL=(String)request.getAttribute(WebKeys.CURRENT_URL);
  if (currentURL == null) {
    currentURL=ParamUtil.getString(request,"currentURL");
    if (Validator.isNull(currentURL)) {
      if (true) {
        currentURL=HttpUtil.getCompleteURL(request);
      }
 else {
        currentURL=_getCurrentURL(request);
      }
      if ((Validator.isNotNull(currentURL)) && (currentURL.indexOf("j_security_check") == -1)) {
        currentURL=currentURL.substring(currentURL.indexOf("://") + 3,currentURL.length());
        currentURL=currentURL.substring(currentURL.indexOf("/"),currentURL.length());
      }
      if (Validator.isNotNull(currentURL) && FacebookUtil.isFacebook(currentURL)) {
        String[] facebookData=FacebookUtil.getFacebookData(request);
        currentURL=FacebookUtil.FACEBOOK_APPS_URL + facebookData[0] + facebookData[2];
      }
    }
    if (Validator.isNull(currentURL)) {
      currentURL=getPathMain();
    }
    request.setAttribute(WebKeys.CURRENT_URL,currentURL);
  }
  return currentURL;
}
