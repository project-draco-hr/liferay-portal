{
  List<HttpServletRequestWrapper> persistentHttpServletRequestWrappers=new ArrayList<HttpServletRequestWrapper>();
  HttpServletRequest originalRequest=request;
  while (originalRequest.getClass().getName().startsWith("com.liferay.")) {
    if (originalRequest instanceof PersistentHttpServletRequestWrapper) {
      persistentHttpServletRequestWrappers.add((HttpServletRequestWrapper)originalRequest);
    }
    HttpServletRequestWrapper httpServletRequestWrapper=(HttpServletRequestWrapper)originalRequest;
    originalRequest=(HttpServletRequest)httpServletRequestWrapper.getRequest();
  }
  for (int i=persistentHttpServletRequestWrappers.size() - 1; i >= 0; i--) {
    HttpServletRequestWrapper httpServletRequestWrapper=persistentHttpServletRequestWrappers.get(i);
    httpServletRequestWrapper.setRequest(originalRequest);
    originalRequest=httpServletRequestWrapper;
  }
  if (ServerDetector.isWebLogic()) {
    originalRequest=new NonSerializableObjectRequestWrapper(originalRequest);
  }
  return originalRequest;
}
