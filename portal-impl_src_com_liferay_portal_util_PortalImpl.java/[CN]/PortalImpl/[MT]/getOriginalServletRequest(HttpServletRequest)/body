{
  List<PersistentHttpServletRequestWrapper> persistentHttpServletRequestWrappers=new ArrayList<>();
  HttpServletRequest originalRequest=request;
  while (originalRequest instanceof HttpServletRequestWrapper) {
    if (originalRequest instanceof PersistentHttpServletRequestWrapper) {
      PersistentHttpServletRequestWrapper persistentHttpServletRequestWrapper=(PersistentHttpServletRequestWrapper)originalRequest;
      persistentHttpServletRequestWrappers.add(persistentHttpServletRequestWrapper.clone());
    }
    HttpServletRequestWrapper httpServletRequestWrapper=(HttpServletRequestWrapper)originalRequest;
    originalRequest=(HttpServletRequest)httpServletRequestWrapper.getRequest();
  }
  for (int i=persistentHttpServletRequestWrappers.size() - 1; i >= 0; i--) {
    HttpServletRequestWrapper httpServletRequestWrapper=persistentHttpServletRequestWrappers.get(i);
    httpServletRequestWrapper.setRequest(originalRequest);
    originalRequest=httpServletRequestWrapper;
  }
  return originalRequest;
}
