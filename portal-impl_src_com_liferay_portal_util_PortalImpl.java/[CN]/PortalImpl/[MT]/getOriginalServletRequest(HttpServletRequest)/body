{
  List<PersistentHttpServletRequestWrapper> persistentHttpServletRequestWrappers=new ArrayList<PersistentHttpServletRequestWrapper>();
  HttpServletRequest originalRequest=request;
  while (originalRequest.getClass().getName().startsWith("com.liferay.")) {
    if (originalRequest instanceof PersistentHttpServletRequestWrapper) {
      PersistentHttpServletRequestWrapper persistentHttpServletRequestWrapper=(PersistentHttpServletRequestWrapper)originalRequest;
      persistentHttpServletRequestWrappers.add(persistentHttpServletRequestWrapper);
      originalRequest=(HttpServletRequest)persistentHttpServletRequestWrapper.getRealRequest();
    }
 else {
      HttpServletRequestWrapper httpServletRequestWrapper=(HttpServletRequestWrapper)originalRequest;
      originalRequest=(HttpServletRequest)httpServletRequestWrapper.getRequest();
    }
  }
  for (int i=persistentHttpServletRequestWrappers.size() - 1; i >= 0; i--) {
    PersistentHttpServletRequestWrapper persistentHttpServletRequestWrapper=persistentHttpServletRequestWrappers.get(i);
    persistentHttpServletRequestWrapper.setRealRequest(originalRequest);
    originalRequest=persistentHttpServletRequestWrapper;
  }
  return originalRequest;
}
