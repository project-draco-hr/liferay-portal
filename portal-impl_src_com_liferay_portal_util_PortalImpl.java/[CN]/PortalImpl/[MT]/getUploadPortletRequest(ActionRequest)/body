{
  if (actionRequest instanceof ActionRequestImpl) {
    ActionRequestImpl actionRequestImpl=(ActionRequestImpl)actionRequest;
    DynamicServletRequest dynamicRequest=(DynamicServletRequest)actionRequestImpl.getHttpServletRequest();
    HttpServletRequestWrapper requestWrapper=(HttpServletRequestWrapper)dynamicRequest.getRequest();
    UploadServletRequest uploadRequest=getUploadServletRequest(requestWrapper);
    return new UploadPortletRequestImpl(uploadRequest,PortalUtil.getPortletNamespace(actionRequestImpl.getPortletName()));
  }
 else {
    com.sun.portal.portletcontainer.portlet.impl.ActionRequestImpl actionRequestImpl=(com.sun.portal.portletcontainer.portlet.impl.ActionRequestImpl)actionRequest;
    HttpServletRequestWrapper requestWrapper=(HttpServletRequestWrapper)actionRequestImpl.getHttpServletRequest();
    UploadServletRequest uploadRequest=getUploadServletRequest(requestWrapper);
    String portletWindowName=(String)actionRequest.getAttribute("javax.portlet.portletc.portletWindowName");
    return new UploadPortletRequestImpl(uploadRequest,PortalUtil.getPortletNamespace(portletWindowName));
  }
}
