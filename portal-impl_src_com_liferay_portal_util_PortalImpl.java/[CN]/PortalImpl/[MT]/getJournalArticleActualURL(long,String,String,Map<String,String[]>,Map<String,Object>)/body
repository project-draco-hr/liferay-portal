{
  String articleUrlTitle=friendlyURL.substring(JournalArticleConstants.CANONICAL_URL_SEPARATOR.length());
  String layoutActualURL=StringPool.BLANK;
  JournalArticle article=JournalArticleLocalServiceUtil.getArticleByUrlTitle(groupId,articleUrlTitle);
  String layoutUuid=article.getLayoutUuid();
  Layout layout=LayoutLocalServiceUtil.getLayoutByUuidAndGroupId(layoutUuid,groupId);
  UnicodeProperties properties=layout.getTypeSettingsProperties();
  layoutActualURL=getLayoutActualURL(layout,mainPath);
  String defaultAssetPublisherPortletId=properties.get(LayoutTypePortletConstants.DEFAULT_ASSET_PUBLISHER_PORTLET_ID);
  if (Validator.isNull(defaultAssetPublisherPortletId)) {
    String instanceId=PwdGenerator.getPassword(PwdGenerator.KEY1 + PwdGenerator.KEY2 + PwdGenerator.KEY3,4);
    defaultAssetPublisherPortletId=PortletKeys.ASSET_PUBLISHER + PortletConstants.INSTANCE_SEPARATOR + instanceId;
  }
  HttpServletRequest request=(HttpServletRequest)requestContext.get("request");
  String namespace="_" + defaultAssetPublisherPortletId + "_";
  InheritableMap<String,String[]> actualParams=new InheritableMap<String,String[]>();
  if (params != null) {
    actualParams.setParentMap(params);
  }
  actualParams.put("p_p_id",new String[]{defaultAssetPublisherPortletId});
  actualParams.put("p_p_lifecycle",new String[]{"0"});
  actualParams.put("p_p_mode",new String[]{"view"});
  actualParams.put(namespace + "struts_action",new String[]{"/asset_publisher/view_content"});
  actualParams.put(namespace + "type",new String[]{JournalArticleAssetRendererFactory.TYPE});
  actualParams.put(namespace + "urlTitle",new String[]{article.getUrlTitle()});
  if (Validator.isNull(properties.get(LayoutTypePortletConstants.DEFAULT_ASSET_PUBLISHER_PORTLET_ID))) {
    String actualPortletAuthenticationToken=AuthTokenUtil.getToken(request,layout.getPlid(),defaultAssetPublisherPortletId);
    actualParams.put("p_p_auth",new String[]{actualPortletAuthenticationToken});
    actualParams.put("p_p_state",new String[]{WindowState.MAXIMIZED.toString()});
  }
  String queryString=HttpUtil.parameterMapToString(actualParams,false);
  if (layoutActualURL.contains(StringPool.QUESTION)) {
    layoutActualURL=layoutActualURL + StringPool.AMPERSAND + queryString;
  }
 else {
    layoutActualURL=layoutActualURL + StringPool.QUESTION + queryString;
  }
  return layoutActualURL;
}
