{
  User user=null;
  try {
    user=getUser(request);
  }
 catch (  NoSuchUserException nsue) {
    if (_log.isWarnEnabled()) {
      _log.warn(nsue.getMessage());
    }
    long userId=getUserId(request);
    if (userId > 0) {
      HttpSession session=request.getSession();
      session.invalidate();
    }
    throw nsue;
  }
  if (user != null) {
    return user;
  }
  Company company=getCompany(request);
  return company.getDefaultUser();
}
