{
  if (layout == null) {
    return 0;
  }
 else {
    if (Validator.isNotNull(portletId)) {
      try {
        PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portletId);
        long scopeLayoutId=GetterUtil.getLong(portletSetup.getValue("lfr-scope-layout-id",null));
        if (scopeLayoutId > 0) {
          Layout scopeLayout=LayoutLocalServiceUtil.getLayout(layout.getGroupId(),layout.isPrivateLayout(),scopeLayoutId);
          return scopeLayout.getScopeGroup().getGroupId();
        }
      }
 catch (      Exception e) {
      }
    }
    Group group=layout.getGroup();
    if (group.hasStagingGroup()) {
      Group stagingGroup=group.getStagingGroup();
      return stagingGroup.getGroupId();
    }
 else {
      return layout.getGroupId();
    }
  }
}
