{
  List<MDRRuleGroupInstance> mdrRuleGroupInstances=_mdrRuleGroupInstanceLocalService.getRuleGroupInstances(className,classPK,QueryUtil.ALL_POS,QueryUtil.ALL_POS,new RuleGroupInstancePriorityComparator());
  for (  MDRRuleGroupInstance mdrRuleGroupInstance : mdrRuleGroupInstances) {
    MDRRuleGroup mdrRuleGroup=_mdrRuleGroupLocalService.fetchRuleGroup(mdrRuleGroupInstance.getRuleGroupId());
    if (mdrRuleGroup == null) {
      if (_log.isWarnEnabled()) {
        _log.warn("Rule group instance " + mdrRuleGroupInstance.getRuleGroupInstanceId() + " has invalid rule group");
      }
      continue;
    }
    Collection<MDRRule> mdrRules=mdrRuleGroup.getRules();
    for (    MDRRule mdrRule : mdrRules) {
      if (evaluateRule(mdrRule,themeDisplay)) {
        return mdrRuleGroupInstance;
      }
    }
  }
  return null;
}
