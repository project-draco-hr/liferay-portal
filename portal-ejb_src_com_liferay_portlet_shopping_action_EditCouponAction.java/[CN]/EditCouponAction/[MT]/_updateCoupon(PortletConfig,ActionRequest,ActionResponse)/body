{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  String couponId=ParamUtil.getString(req,"coupon_id");
  boolean autoCouponId=ParamUtil.get(req,"auto_coupon_id",false);
  String name=ParamUtil.getString(req,"coupon_name");
  String description=ParamUtil.getString(req,"coupon_desc");
  int startMonth=ParamUtil.getInteger(req,"coupon_sd_month");
  int startDay=ParamUtil.getInteger(req,"coupon_sd_day");
  int startYear=ParamUtil.getInteger(req,"coupon_sd_year");
  int endMonth=ParamUtil.getInteger(req,"coupon_ed_month");
  int endDay=ParamUtil.getInteger(req,"coupon_ed_day");
  int endYear=ParamUtil.getInteger(req,"coupon_ed_year");
  boolean neverExpires=ParamUtil.get(req,"coupon_never_expires",false);
  boolean active=ParamUtil.get(req,"coupon_active",false);
  String limitCategories=StringUtil.replace(ParamUtil.getString(req,"coupon_limit_categories"),StringPool.SPACE,StringPool.BLANK);
  String limitSkus=StringUtil.replace(ParamUtil.getString(req,"coupon_limit_skus"),StringPool.SPACE,StringPool.BLANK);
  double minOrder=ParamUtil.getDouble(req,"coupon_min_order");
  double discount=ParamUtil.getDouble(req,"coupon_discount");
  String discountType=ParamUtil.getString(req,"coupon_discount_type");
  if (cmd.equals(Constants.ADD)) {
    ShoppingCouponServiceUtil.addCoupon(couponId,autoCouponId,name,description,startMonth,startDay,startYear,endMonth,endDay,endYear,neverExpires,active,limitCategories,limitSkus,minOrder,discount,discountType);
  }
 else {
    ShoppingCouponServiceUtil.updateCoupon(couponId,name,description,startMonth,startDay,startYear,endMonth,endDay,endYear,neverExpires,active,limitCategories,limitSkus,minOrder,discount,discountType);
  }
  res.sendRedirect(ParamUtil.getString(req,"redirect"));
}
