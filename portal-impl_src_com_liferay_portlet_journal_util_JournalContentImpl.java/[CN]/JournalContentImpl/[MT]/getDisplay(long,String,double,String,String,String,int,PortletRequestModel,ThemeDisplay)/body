{
  StopWatch stopWatch=new StopWatch();
  stopWatch.start();
  articleId=StringUtil.toUpperCase(GetterUtil.getString(articleId));
  ddmTemplateKey=StringUtil.toUpperCase(GetterUtil.getString(ddmTemplateKey));
  long layoutSetId=0;
  boolean secure=false;
  if (themeDisplay != null) {
    try {
      if (!JournalArticlePermission.contains(themeDisplay.getPermissionChecker(),groupId,articleId,ActionKeys.VIEW)) {
        return null;
      }
    }
 catch (    Exception e) {
    }
    LayoutSet layoutSet=themeDisplay.getLayoutSet();
    layoutSetId=layoutSet.getLayoutSetId();
    secure=themeDisplay.isSecure();
  }
  JournalContentKey key=new JournalContentKey(groupId,articleId,version,ddmTemplateKey,layoutSetId,viewMode,languageId,page,secure);
  JournalArticleDisplay articleDisplay=_portalCache.get(key);
  boolean lifecycleRender=false;
  if (portletRequestModel != null) {
    lifecycleRender=RenderRequest.RENDER_PHASE.equals(portletRequestModel.getLifecycle());
  }
  if ((articleDisplay == null) || !lifecycleRender) {
    articleDisplay=getArticleDisplay(groupId,articleId,ddmTemplateKey,viewMode,languageId,page,portletRequestModel,themeDisplay);
    if ((articleDisplay != null) && articleDisplay.isCacheable() && lifecycleRender) {
      _portalCache.put(key,articleDisplay);
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("getDisplay for {" + groupId + ", "+ articleId+ ", "+ ddmTemplateKey+ ", "+ viewMode+ ", "+ languageId+ ", "+ page+ "} takes "+ stopWatch.getTime()+ " ms");
  }
  return articleDisplay;
}
