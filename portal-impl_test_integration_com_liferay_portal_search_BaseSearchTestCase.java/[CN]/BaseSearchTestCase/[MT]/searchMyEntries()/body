{
  User user1=UserTestUtil.addUser(null,0);
  long initialUser1SearchGroupEntriesCount=searchGroupEntriesCount(group.getGroupId(),user1.getUserId());
  User user2=UserTestUtil.addUser(null,0);
  long initialUser2SearchGroupEntriesCount=searchGroupEntriesCount(group.getGroupId(),user2.getUserId());
  ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext(group.getGroupId());
  BaseModel<?> parentBaseModel1=getParentBaseModel(group,serviceContext);
  BaseModel<?> parentBaseModel2=getParentBaseModel(group,serviceContext);
  String name=PrincipalThreadLocal.getName();
  long userId=serviceContext.getUserId();
  try {
    PrincipalThreadLocal.setName(user1.getUserId());
    serviceContext.setUserId(user1.getUserId());
    baseModel=addBaseModel(parentBaseModel1,true,RandomTestUtil.randomString(),serviceContext);
    baseModel=addBaseModel(parentBaseModel1,true,RandomTestUtil.randomString(),serviceContext);
    baseModel=addBaseModel(parentBaseModel2,true,RandomTestUtil.randomString(),serviceContext);
    PrincipalThreadLocal.setName(user2.getUserId());
    serviceContext.setUserId(user2.getUserId());
    baseModel=addBaseModel(parentBaseModel1,true,RandomTestUtil.randomString(),serviceContext);
    baseModel=addBaseModel(parentBaseModel2,true,RandomTestUtil.randomString(),serviceContext);
  }
  finally {
    PrincipalThreadLocal.setName(name);
    serviceContext.setUserId(userId);
  }
  Assert.assertEquals(initialUser1SearchGroupEntriesCount + 3,searchGroupEntriesCount(group.getGroupId(),user1.getUserId()));
  Assert.assertEquals(initialUser2SearchGroupEntriesCount + 2,searchGroupEntriesCount(group.getGroupId(),user2.getUserId()));
  moveParentBaseModelToTrash((Long)parentBaseModel2.getPrimaryKeyObj());
  Assert.assertEquals(initialUser1SearchGroupEntriesCount + 2,searchGroupEntriesCount(group.getGroupId(),user1.getUserId()));
  Assert.assertEquals(initialUser2SearchGroupEntriesCount + 1,searchGroupEntriesCount(group.getGroupId(),user2.getUserId()));
  TrashHandler parentTrashHandler=TrashHandlerRegistryUtil.getTrashHandler(getParentBaseModelClassName());
  parentTrashHandler.restoreTrashEntry(user1.getUserId(),(Long)parentBaseModel2.getPrimaryKeyObj());
  Assert.assertEquals(initialUser1SearchGroupEntriesCount + 3,searchGroupEntriesCount(group.getGroupId(),user1.getUserId()));
  Assert.assertEquals(initialUser2SearchGroupEntriesCount + 2,searchGroupEntriesCount(group.getGroupId(),user2.getUserId()));
}
