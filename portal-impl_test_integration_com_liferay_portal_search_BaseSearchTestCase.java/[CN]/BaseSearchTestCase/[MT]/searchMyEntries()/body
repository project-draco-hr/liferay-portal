{
  ServiceContext serviceContext=ServiceTestUtil.getServiceContext(group.getGroupId());
  BaseModel<?> parentBaseModel1=getParentBaseModel(group,serviceContext);
  BaseModel<?> parentBaseModel2=getParentBaseModel(group,serviceContext);
  User user1=UserTestUtil.addUser(null,0);
  User user2=UserTestUtil.addUser(null,0);
  String name=PrincipalThreadLocal.getName();
  long userId=serviceContext.getUserId();
  long initialSearchGroupEntriesCountUser1=searchGroupEntriesCount(group.getGroupId(),user1.getUserId());
  long initialSearchGroupEntriesCountUser2=searchGroupEntriesCount(group.getGroupId(),user2.getUserId());
  try {
    PrincipalThreadLocal.setName(user1.getUserId());
    serviceContext.setUserId(user1.getUserId());
    baseModel=addBaseModel(parentBaseModel1,true,ServiceTestUtil.randomString(),serviceContext);
    baseModel=addBaseModel(parentBaseModel1,true,ServiceTestUtil.randomString(),serviceContext);
    baseModel=addBaseModel(parentBaseModel2,true,ServiceTestUtil.randomString(),serviceContext);
    PrincipalThreadLocal.setName(user2.getUserId());
    serviceContext.setUserId(user2.getUserId());
    baseModel=addBaseModel(parentBaseModel1,true,ServiceTestUtil.randomString(),serviceContext);
    baseModel=addBaseModel(parentBaseModel2,true,ServiceTestUtil.randomString(),serviceContext);
  }
  finally {
    PrincipalThreadLocal.setName(name);
    serviceContext.setUserId(userId);
  }
  Assert.assertEquals(initialSearchGroupEntriesCountUser1 + 3,searchGroupEntriesCount(group.getGroupId(),user1.getUserId()));
  Assert.assertEquals(initialSearchGroupEntriesCountUser2 + 2,searchGroupEntriesCount(group.getGroupId(),user2.getUserId()));
  moveParentBaseModelToTrash((Long)parentBaseModel2.getPrimaryKeyObj());
  Assert.assertEquals(initialSearchGroupEntriesCountUser1 + 2,searchGroupEntriesCount(group.getGroupId(),user1.getUserId()));
  Assert.assertEquals(initialSearchGroupEntriesCountUser2 + 1,searchGroupEntriesCount(group.getGroupId(),user2.getUserId()));
  TrashHandler parentTrashHandler=TrashHandlerRegistryUtil.getTrashHandler(getParentBaseModelClassName());
  parentTrashHandler.restoreTrashEntry(user1.getUserId(),(Long)parentBaseModel2.getPrimaryKeyObj());
  Assert.assertEquals(initialSearchGroupEntriesCountUser1 + 3,searchGroupEntriesCount(group.getGroupId(),user1.getUserId()));
  Assert.assertEquals(initialSearchGroupEntriesCountUser2 + 2,searchGroupEntriesCount(group.getGroupId(),user2.getUserId()));
}
