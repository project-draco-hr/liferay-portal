{
  int imageHeight=renderedImage.getHeight();
  int imageWidth=renderedImage.getWidth();
  if (maxHeight == 0) {
    maxHeight=imageHeight;
  }
  if (maxWidth == 0) {
    maxWidth=imageWidth;
  }
  if ((imageHeight <= maxHeight) && (imageWidth <= maxWidth)) {
    return renderedImage;
  }
  double factor=Math.min((double)maxHeight / imageHeight,(double)maxWidth / imageWidth);
  int thumbHeight=(int)(factor * imageHeight);
  int thumbWidth=(int)(factor * imageWidth);
  BufferedImage bufferedImage=getBufferedImage(renderedImage);
  Image thumb=bufferedImage.getScaledInstance(thumbWidth,thumbHeight,Image.SCALE_SMOOTH);
  BufferedImage scaledImage=new BufferedImage(thumbWidth,thumbHeight,BufferedImage.TYPE_INT_RGB);
  scaledImage.getGraphics().drawImage(thumb,0,0,null);
  return scaledImage;
}
