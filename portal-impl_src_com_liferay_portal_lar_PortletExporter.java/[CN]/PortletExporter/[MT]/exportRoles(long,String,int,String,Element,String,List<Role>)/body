{
  Element el=parentEl.addElement(elName);
  Map<String,List<String>> resourceRoles=RoleLocalServiceUtil.getResourceRoles(companyId,resourceName,scope,resourcePrimKey);
  Iterator<Map.Entry<String,List<String>>> itr=resourceRoles.entrySet().iterator();
  while (itr.hasNext()) {
    Map.Entry<String,List<String>> entry=itr.next();
    String roleName=entry.getKey().toString();
    if (hasRole(roles,roleName)) {
      Element roleEl=el.addElement("role");
      roleEl.addAttribute("name",roleName);
      List<String> actions=entry.getValue();
      for (int i=0; i < actions.size(); i++) {
        String action=actions.get(i);
        Element actionKeyEl=roleEl.addElement("action-key");
        actionKeyEl.addText(action);
        actionKeyEl.addAttribute("scope",String.valueOf(scope));
      }
    }
  }
  return el;
}
