{
  Document document=SAXReaderUtil.createDocument();
  Element rootElement=document.addElement("comments");
  Map<String,List<MBMessage>> commentsMap=portletDataContext.getComments();
  for (  Map.Entry<String,List<MBMessage>> entry : commentsMap.entrySet()) {
    String[] commentParts=StringUtil.split(entry.getKey(),CharPool.POUND);
    String className=commentParts[0];
    String classPK=commentParts[1];
    String commentsPath=getCommentsPath(portletDataContext,className,classPK);
    Element assetElement=rootElement.addElement("asset");
    assetElement.addAttribute("path",commentsPath);
    assetElement.addAttribute("class-name",className);
    assetElement.addAttribute("class-pk",classPK);
    List<MBMessage> mbMessages=entry.getValue();
    for (    MBMessage mbMessage : mbMessages) {
      String commentPath=getCommentPath(portletDataContext,className,classPK,mbMessage);
      if (portletDataContext.isPathNotProcessed(commentPath)) {
        User user=UserLocalServiceUtil.fetchUser(mbMessage.getUserId());
        if (user == null) {
          continue;
        }
        portletDataContext.addZipEntry(commentPath,mbMessage);
        MBDiscussion mbDiscussion=MBDiscussionLocalServiceUtil.getDiscussion(className,GetterUtil.getLong(classPK));
        portletDataContext.addReferenceElement(mbDiscussion,assetElement,user,PortletDataContext.REFERENCE_TYPE_WEAK,true);
      }
    }
  }
  portletDataContext.addZipEntry(ExportImportPathUtil.getRootPath(portletDataContext) + "/comments.xml",document.formattedString());
}
