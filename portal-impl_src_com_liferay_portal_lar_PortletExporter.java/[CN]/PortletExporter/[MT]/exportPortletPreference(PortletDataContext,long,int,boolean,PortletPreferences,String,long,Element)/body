{
  String preferencesXML=portletPreferences.getPreferences();
  if (Validator.isNull(preferencesXML)) {
    preferencesXML=PortletConstants.DEFAULT_PREFERENCES;
  }
  String rootPotletId=PortletConstants.getRootPortletId(portletId);
  if (rootPotletId.equals(PortletKeys.ASSET_PUBLISHER)) {
    preferencesXML=updateAssetPublisherPortletPreferences(portletDataContext,preferencesXML,plid);
  }
 else   if (rootPotletId.equals(PortletKeys.TAGS_CATEGORIES_NAVIGATION)) {
    preferencesXML=updateAssetCategoriesNavigationPortletPreferences(preferencesXML,plid);
  }
  Document document=SAXReaderUtil.read(preferencesXML);
  Element rootElement=document.getRootElement();
  rootElement.addAttribute("owner-id",String.valueOf(ownerId));
  rootElement.addAttribute("owner-type",String.valueOf(ownerType));
  rootElement.addAttribute("default-user",String.valueOf(defaultUser));
  rootElement.addAttribute("plid",String.valueOf(plid));
  rootElement.addAttribute("portlet-id",portletId);
  if (ownerType == PortletKeys.PREFS_OWNER_TYPE_ARCHIVED) {
    PortletItem portletItem=PortletItemLocalServiceUtil.getPortletItem(ownerId);
    rootElement.addAttribute("archive-user-uuid",portletItem.getUserUuid());
    rootElement.addAttribute("archive-name",portletItem.getName());
  }
 else   if (ownerType == PortletKeys.PREFS_OWNER_TYPE_USER) {
    User user=UserLocalServiceUtil.fetchUserById(ownerId);
    if (user == null) {
      return;
    }
    rootElement.addAttribute("user-uuid",user.getUserUuid());
  }
  List<Node> nodes=document.selectNodes("/portlet-preferences/preference[name/text() = " + "'last-publish-date']");
  for (  Node node : nodes) {
    document.remove(node);
  }
  String path=getPortletPreferencesPath(portletDataContext,portletId,ownerId,ownerType,plid);
  Element portletPreferencesElement=parentElement.addElement("portlet-preferences");
  portletPreferencesElement.addAttribute("path",path);
  if (portletDataContext.isPathNotProcessed(path)) {
    portletDataContext.addZipEntry(path,document.formattedString(StringPool.TAB,false,false));
  }
}
