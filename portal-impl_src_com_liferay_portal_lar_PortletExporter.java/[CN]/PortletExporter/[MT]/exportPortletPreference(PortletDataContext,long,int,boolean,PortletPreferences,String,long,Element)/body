{
  try {
    Document prefsDoc=SAXReaderUtil.read(portletPreferences.getPreferences());
    Element root=prefsDoc.getRootElement();
    root.addAttribute("owner-id",String.valueOf(ownerId));
    root.addAttribute("owner-type",String.valueOf(ownerType));
    root.addAttribute("default-user",String.valueOf(defaultUser));
    root.addAttribute("plid",String.valueOf(plid));
    root.addAttribute("portlet-id",portletId);
    if (ownerType == PortletKeys.PREFS_OWNER_TYPE_ARCHIVED) {
      PortletItem portletItem=PortletItemLocalServiceUtil.getPortletItem(ownerId);
      User user=UserLocalServiceUtil.getUserById(portletItem.getUserId());
      root.addAttribute("archive-user-uuid",user.getUuid());
      root.addAttribute("archive-name",portletItem.getName());
    }
    String path=getPortletPreferencesPath(context,portletId,ownerId,ownerType,plid);
    parentEl.addElement("portlet-preferences").addAttribute("path",path);
    if (context.isPathNotProcessed(path)) {
      context.addZipEntry(path,prefsDoc.formattedString());
    }
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
}
