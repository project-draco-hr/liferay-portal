{
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  ZipWriter zipWriter;
  if (!ExportImportThreadLocal.isStagingInProcess() || (PropsValues.STAGING_DELETE_TEMP_LAR_ON_FAILURE && PropsValues.STAGING_DELETE_TEMP_LAR_ON_SUCCESS)) {
    zipWriter=ZipWriterFactoryUtil.getZipWriter();
  }
 else {
    File file=new File(SystemProperties.get(SystemProperties.TMP_DIR) + StringPool.SLASH + MapUtil.getString(parameterMap,Constants.CMD)+ StringPool.DASH+ groupId+ StringPool.DASH+ Time.getShortTimestamp()+ ".lar");
    zipWriter=ZipWriterFactoryUtil.getZipWriter(file);
  }
  PortletDataContext portletDataContext=PortletDataContextFactoryUtil.createExportPortletDataContext(layout.getCompanyId(),groupId,parameterMap,startDate,endDate,zipWriter);
  portletDataContext.setOldPlid(plid);
  portletDataContext.setPlid(plid);
  portletDataContext.setPortletId(portletId);
  return portletDataContext;
}
