{
  try {
    Document doc=SAXReaderUtil.createDocument();
    Element root=doc.addElement("portlet-data-permissions");
    Map<String,List<KeyValuePair>> permissionsMap=context.getPermissions();
    for (    Map.Entry<String,List<KeyValuePair>> entry : permissionsMap.entrySet()) {
      String[] permissionEntry=entry.getKey().split(StringPool.POUND);
      Element portletDataEl=root.addElement("portlet-data");
      portletDataEl.addAttribute("class-name",permissionEntry[0]);
      portletDataEl.addAttribute("class-pk",permissionEntry[1]);
      List<KeyValuePair> permissions=entry.getValue();
      for (      KeyValuePair permission : permissions) {
        String roleName=permission.getKey();
        String actions=permission.getValue();
        Element permissionsEl=portletDataEl.addElement("permissions");
        permissionsEl.addAttribute("role-name",roleName);
        permissionsEl.addAttribute("actions",actions);
      }
    }
    context.addZipEntry(context.getRootPath() + "/portlet-data-permissions.xml",doc.formattedString());
  }
 catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
