{
  PortletDataContext portletDataContext=null;
  try {
    ExportImportThreadLocal.setPortletExportInProcess(true);
    portletDataContext=getPortletDataContext(plid,groupId,parameterMap,startDate,endDate);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_PORTLET_EXPORT_STARTED,portletDataContext);
    File file=doExportPortletInfoAsFile(portletDataContext,portletId);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_PORTLET_EXPORT_FINISHED,portletDataContext);
    return file;
  }
 catch (  Throwable t) {
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_PORTLET_EXPORT_FAILED,portletDataContext,t);
    throw t;
  }
 finally {
    ExportImportThreadLocal.setPortletExportInProcess(false);
  }
}
