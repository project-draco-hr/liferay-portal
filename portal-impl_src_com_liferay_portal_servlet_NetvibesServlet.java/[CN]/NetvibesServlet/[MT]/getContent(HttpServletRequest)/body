{
  String path=GetterUtil.getString(request.getPathInfo());
  if (Validator.isNull(path)) {
    return null;
  }
  int pos=path.indexOf(Portal.FRIENDLY_URL_SEPARATOR);
  if (pos == -1) {
    return null;
  }
  long companyId=PortalUtil.getCompanyId(request);
  String portletId=path.substring(pos + Portal.FRIENDLY_URL_SEPARATOR.length());
  Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletId);
  String title=HtmlUtil.escape(portlet.getDisplayName());
  String portalURL=PortalUtil.getPortalURL(request);
  String iconURL=portalURL + PortalUtil.getPathContext() + portlet.getIcon();
  String widgetJsURL=portalURL + PortalWebResourcesUtil.getContextPath(PortalWebResourceConstants.RESOURCE_TYPE_JS) + "/liferay/widget.js";
  String widgetURL=request.getRequestURL().toString();
  widgetURL=widgetURL.replaceFirst(PropsValues.NETVIBES_SERVLET_MAPPING,PropsValues.WIDGET_SERVLET_MAPPING);
  widgetURL=HtmlUtil.escapeJS(widgetURL);
  StringBundler sb=new StringBundler(31);
  sb.append("<!DOCTYPE html>");
  sb.append("<html>");
  sb.append("<head>");
  sb.append("<link href=\"");
  sb.append(_NETVIBES_CSS);
  sb.append("\" rel=\"stylesheet\" ");
  sb.append("type=\"text/css\" />");
  sb.append("<script src=\"");
  sb.append(_NETVIBES_JS);
  sb.append("\" ");
  sb.append("type=\"text/javascript\"></script>");
  sb.append("<title>");
  sb.append(title);
  sb.append("</title>");
  sb.append("<link href=\"");
  sb.append(iconURL);
  sb.append("\" rel=\"icon\" ");
  sb.append("type=\"image/png\" />");
  sb.append("</head>");
  sb.append("<body>");
  sb.append("<script src=\"");
  sb.append(widgetJsURL);
  sb.append("\" ");
  sb.append("type=\"text/javascript\"></script>");
  sb.append("<script type=\"text/javascript\">");
  sb.append("Liferay.Widget({url:\"");
  sb.append(widgetURL);
  sb.append("\"});");
  sb.append("</script>");
  sb.append("</body>");
  sb.append("</html>");
  return sb.toString();
}
