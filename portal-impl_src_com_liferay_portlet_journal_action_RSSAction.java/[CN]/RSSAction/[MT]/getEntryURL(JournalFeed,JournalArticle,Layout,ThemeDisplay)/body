{
  StringMaker sm=new StringMaker();
  List<Long> hitLayoutIds=JournalContentSearchLocalServiceUtil.getLayoutIds(layout.getGroupId(),layout.isPrivateLayout(),article.getArticleId());
  if (hitLayoutIds.size() > 0) {
    Long hitLayoutId=hitLayoutIds.get(0);
    Layout hitLayout=LayoutLocalServiceUtil.getLayout(layout.getGroupId(),layout.isPrivateLayout(),hitLayoutId.longValue());
    return PortalUtil.getLayoutFriendlyURL(hitLayout,themeDisplay);
  }
 else   if (Validator.isNotNull(feed.getTargetLayoutFriendlyUrl())) {
    long plid=PortalUtil.getPlidIdFromFriendlyURL(feed.getCompanyId(),feed.getTargetLayoutFriendlyUrl());
    Layout targetLayout=LayoutLocalServiceUtil.getLayout(plid);
    sm.append(PortalUtil.getLayoutFriendlyURL(targetLayout,themeDisplay));
  }
 else {
    sm.append(PortalUtil.getLayoutFriendlyURL(layout,themeDisplay));
  }
  sm.append("/journal_content/");
  if (Validator.isNotNull(feed.getTargetPortletId())) {
    sm.append(feed.getTargetPortletId());
  }
 else {
    sm.append(PortletKeys.JOURNAL_CONTENT);
  }
  sm.append(StringPool.SLASH);
  sm.append(article.getGroupId());
  sm.append(StringPool.SLASH);
  sm.append(article.getArticleId());
  return sm.toString();
}
