{
  List<Long> hitLayoutIds=JournalContentSearchLocalServiceUtil.getLayoutIds(layout.getGroupId(),layout.isPrivateLayout(),article.getArticleId());
  if (hitLayoutIds.size() > 0) {
    Long hitLayoutId=hitLayoutIds.get(0);
    Layout hitLayout=LayoutLocalServiceUtil.getLayout(layout.getGroupId(),layout.isPrivateLayout(),hitLayoutId.longValue());
    return PortalUtil.getLayoutFriendlyURL(hitLayout,themeDisplay);
  }
 else {
    long plid=PortalUtil.getPlidFromFriendlyURL(feed.getCompanyId(),feed.getTargetLayoutFriendlyUrl());
    String portletId=PortletKeys.JOURNAL_CONTENT;
    if (Validator.isNotNull(feed.getTargetPortletId())) {
      portletId=feed.getTargetPortletId();
    }
    PortletURL entryURL=new PortletURLImpl(resourceRequest,portletId,plid,PortletRequest.RENDER_PHASE);
    entryURL.setParameter("struts_action","/journal_content/view");
    entryURL.setParameter("groupId",String.valueOf(article.getGroupId()));
    entryURL.setParameter("articleId",article.getArticleId());
    return entryURL.toString();
  }
}
