{
  ResourceURL feedURL=res.createResourceURL();
  feedURL.setCacheability(ResourceURL.FULL);
  feedURL.setParameter("struts_action","/journal/rss");
  feedURL.setParameter("groupId",String.valueOf(feed.getGroupId()));
  feedURL.setParameter("feedId",String.valueOf(feed.getFeedId()));
  SyndFeed syndFeed=new SyndFeedImpl();
  syndFeed.setFeedType(feed.getFeedType() + "_" + feed.getFeedVersion());
  syndFeed.setTitle(feed.getName());
  syndFeed.setLink(feedURL.toString());
  syndFeed.setDescription(feed.getDescription());
  List<SyndEntry> entries=new ArrayList<SyndEntry>();
  syndFeed.setEntries(entries);
  List<JournalArticle> articles=JournalRSSUtil.getArticles(feed);
  if (_log.isDebugEnabled()) {
    _log.debug("Syndicating " + articles.size() + " articles");
  }
  Iterator<JournalArticle> itr=articles.iterator();
  while (itr.hasNext()) {
    JournalArticle article=itr.next();
    String author=PortalUtil.getUserName(article.getUserId(),article.getUserName());
    String link=getEntryURL(req,feed,article,layout,themeDisplay);
    SyndEntry syndEntry=new SyndEntryImpl();
    syndEntry.setAuthor(author);
    syndEntry.setTitle(article.getTitle());
    syndEntry.setLink(link);
    syndEntry.setPublishedDate(article.getDisplayDate());
    SyndContent syndContent=new SyndContentImpl();
    String value=article.getDescription();
    try {
      value=processContent(feed,article,languageId,themeDisplay,syndEntry,syndContent);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn(e,e);
      }
    }
    syndContent.setType(RSSUtil.DEFAULT_ENTRY_TYPE);
    syndContent.setValue(value);
    syndEntry.setDescription(syndContent);
    entries.add(syndEntry);
  }
  try {
    return RSSUtil.export(syndFeed);
  }
 catch (  FeedException fe) {
    throw new SystemException(fe);
  }
catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
