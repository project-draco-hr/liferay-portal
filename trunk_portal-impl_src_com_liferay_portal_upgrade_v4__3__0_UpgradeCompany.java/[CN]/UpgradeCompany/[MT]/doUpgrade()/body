{
  ValueMapper companyIdMapper=ValueMapperFactoryUtil.getValueMapper();
  AvailableMappersUtil.setCompanyIdMapper(companyIdMapper);
  String[] webIds=WebIdUtil.getWebIds();
  long[] companyIds=new long[webIds.length];
  for (int i=0; i < webIds.length; i++) {
    String webId=webIds[i];
    long companyId=upgradeWebId(webId);
    companyIds[i]=companyId;
    companyIdMapper.mapValue(webId,new Long(companyId));
  }
  UpgradeTable upgradeTable=UpgradeTableFactoryUtil.getUpgradeTable(CompanyTable.TABLE_NAME,CompanyTable.TABLE_COLUMNS);
  upgradeTable.setCreateSQL(CompanyTable.TABLE_SQL_CREATE);
  upgradeTable.setIndexesSQL(CompanyTable.TABLE_SQL_ADD_INDEXES);
  upgradeTable.updateTable();
  runSQL("update PortletPreferences set ownerId = '0', ownerType = " + PortletKeys.PREFS_OWNER_TYPE_COMPANY + " where ownerId = 'COMPANY.LIFERAY_PORTAL'");
}
