{
  long nodeId=ParamUtil.getLong(req,"nodeId");
  String title=ParamUtil.getString(req,"title");
  double version=ParamUtil.getDouble(req,"version");
  boolean removeRedirect=ParamUtil.getBoolean(req,"removeRedirect");
  if (nodeId == 0) {
    WikiNode node=(WikiNode)req.getAttribute(WebKeys.WIKI_NODE);
    if (node != null) {
      nodeId=node.getNodeId();
    }
  }
  WikiPage page=null;
  if (Validator.isNotNull(title)) {
    try {
      page=WikiPageServiceUtil.getPage(nodeId,title,version);
    }
 catch (    NoSuchPageException nspe) {
      if (title.equals(WikiPageImpl.FRONT_PAGE) && (version == 0)) {
        page=WikiPageServiceUtil.addPage(nodeId,title,null,null,null);
      }
 else {
        throw nspe;
      }
    }
    if (removeRedirect) {
      page.setContent(StringPool.BLANK);
      page.setRedirectTitle(StringPool.BLANK);
    }
  }
  req.setAttribute(WebKeys.WIKI_PAGE,page);
}
