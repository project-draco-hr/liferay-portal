{
  long nodeId=ParamUtil.getLong(renderRequest,"nodeId");
  String title=ParamUtil.getString(renderRequest,"title");
  double version=ParamUtil.getDouble(renderRequest,"version");
  boolean removeRedirect=ParamUtil.getBoolean(renderRequest,"removeRedirect");
  if (nodeId == 0) {
    WikiNode node=(WikiNode)renderRequest.getAttribute(WebKeys.WIKI_NODE);
    if (node != null) {
      nodeId=node.getNodeId();
    }
  }
  WikiPage page=null;
  if (Validator.isNotNull(title)) {
    try {
      if (version == 0) {
        page=WikiPageServiceUtil.getPage(nodeId,title,null);
      }
 else {
        page=WikiPageServiceUtil.getPage(nodeId,title,version);
      }
    }
 catch (    NoSuchPageException nspe1) {
      try {
        page=WikiPageServiceUtil.getPage(nodeId,title,false);
      }
 catch (      NoSuchPageException nspe2) {
        if (title.equals(WikiPageConstants.FRONT_PAGE) && (version == 0)) {
          ServiceContext serviceContext=new ServiceContext();
          page=WikiPageServiceUtil.addPage(nodeId,title,null,WikiPageConstants.NEW,true,serviceContext);
        }
 else {
          throw nspe2;
        }
      }
    }
    if (removeRedirect) {
      page.setContent(StringPool.BLANK);
      page.setRedirectTitle(StringPool.BLANK);
    }
  }
  renderRequest.setAttribute(WebKeys.WIKI_PAGE,page);
}
