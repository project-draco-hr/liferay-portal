{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  String originalRedirect=ParamUtil.getString(req,"originalRedirect");
  PortletURLImpl portletURL=new PortletURLImpl((ActionRequestImpl)req,config.getPortletName(),themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  portletURL.setWindowState(WindowState.MAXIMIZED);
  portletURL.setParameter("struts_action","/wiki/edit_page");
  portletURL.setParameter(Constants.CMD,Constants.UPDATE,false);
  portletURL.setParameter("redirect",redirect,false);
  portletURL.setParameter("originalRedirect",originalRedirect,false);
  portletURL.setParameter("groupId",String.valueOf(layout.getGroupId()),false);
  portletURL.setParameter("nodeId",String.valueOf(page.getNodeId()),false);
  portletURL.setParameter("title",page.getTitle(),false);
  return portletURL.toString();
}
