{
  PortletPreferencesImpl prefs=new PortletPreferencesImpl();
  if (Validator.isNull(xml)) {
    return prefs;
  }
  Map preferences=prefs.getPreferences();
  try {
    Document doc=new SAXReader().read(new StringReader(xml));
    Element root=doc.getRootElement();
    Iterator itr1=root.elements("preference").iterator();
    while (itr1.hasNext()) {
      Element prefEl=(Element)itr1.next();
      String name=prefEl.elementTextTrim("name");
      List values=new ArrayList();
      Iterator itr2=prefEl.elements("value").iterator();
      while (itr2.hasNext()) {
        Element valueEl=(Element)itr2.next();
        values.add(valueEl.getTextTrim());
      }
      boolean readOnly=GetterUtil.get(prefEl.elementText("read-only"),false);
      Preference preference=new Preference(name,(String[])values.toArray(new String[0]),readOnly);
      preferences.put(name,preference);
    }
    return prefs;
  }
 catch (  DocumentException de) {
    throw new SystemException(de);
  }
}
