{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  String portalURL=PortalUtil.getPortalURL(request);
  Layout layout=LayoutLocalServiceUtil.getLayout(getPlid());
  String url=PortalUtil.getLayoutURL(layout,themeDisplay);
  if (!CookieKeys.hasSessionId(request) && (url.startsWith(portalURL) || url.startsWith(StringPool.SLASH))) {
    url=PortalUtil.getURLWithSessionId(url,request.getSession().getId());
  }
  return url;
}
