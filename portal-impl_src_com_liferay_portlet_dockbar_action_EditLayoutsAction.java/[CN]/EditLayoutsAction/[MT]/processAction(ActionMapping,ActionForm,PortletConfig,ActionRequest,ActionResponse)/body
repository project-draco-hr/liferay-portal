{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  try {
    if (cmd.equals("reset_customized_view")) {
      if (!LayoutPermissionUtil.contains(themeDisplay.getPermissionChecker(),themeDisplay.getLayout(),ActionKeys.CUSTOMIZE)) {
        throw new PrincipalException();
      }
      LayoutTypePortlet layoutTypePortlet=themeDisplay.getLayoutTypePortlet();
      if ((layoutTypePortlet != null) && layoutTypePortlet.isCustomizable() && layoutTypePortlet.isCustomizedView()) {
        layoutTypePortlet.resetUserPreferences();
      }
    }
 else     if (cmd.equals("reset_prototype")) {
      SitesUtil.resetPrototype(themeDisplay.getLayout());
    }
    MultiSessionMessages.add(actionRequest,PortalUtil.getPortletId(actionRequest) + "requestProcessed");
    sendRedirect(actionRequest,actionResponse);
  }
 catch (  Exception e) {
    if (e instanceof SystemException) {
      SessionErrors.add(actionRequest,e.getClass(),e);
      sendRedirect(actionRequest,actionResponse);
    }
 else {
      throw e;
    }
  }
}
