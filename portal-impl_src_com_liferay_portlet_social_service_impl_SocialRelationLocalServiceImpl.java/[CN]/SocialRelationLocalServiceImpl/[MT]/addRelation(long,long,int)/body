{
  if (userId1 == userId2) {
    throw new RelationUserIdException();
  }
  User user1=userPersistence.findByPrimaryKey(userId1);
  User user2=userPersistence.findByPrimaryKey(userId2);
  if (user1.getCompanyId() != user2.getCompanyId()) {
    throw new RelationUserIdException();
  }
  SocialRelation relation=null;
  try {
    relation=socialRelationFinder.findByU_U_T(userId1,userId2,type);
  }
 catch (  NoSuchRelationException nsre) {
    long relationId=counterLocalService.increment();
    relation=socialRelationPersistence.create(relationId);
    relation.setCompanyId(user1.getCompanyId());
    relation.setCreateDate(new Date());
    relation.setUserId1(userId1);
    relation.setUserId2(userId2);
    relation.setType(type);
    socialRelationPersistence.update(relation,false);
  }
  return relation;
}
