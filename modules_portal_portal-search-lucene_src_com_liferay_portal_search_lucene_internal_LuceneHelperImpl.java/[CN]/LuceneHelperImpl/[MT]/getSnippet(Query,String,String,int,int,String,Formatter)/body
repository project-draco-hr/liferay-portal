{
  QueryScorer queryScorer=new QueryScorer(query,field);
  Highlighter highlighter=new Highlighter(formatter,queryScorer);
  highlighter.setTextFragmenter(new SimpleFragmenter(fragmentLength));
  TokenStream tokenStream=_analyzer.tokenStream(field,new UnsyncStringReader(s));
  try {
    String snippet=highlighter.getBestFragments(tokenStream,s,maxNumFragments,fragmentSuffix);
    if (Validator.isNotNull(snippet) && !StringUtil.endsWith(snippet,fragmentSuffix) && !s.equals(snippet)) {
      snippet=snippet.concat(fragmentSuffix);
    }
    return snippet;
  }
 catch (  InvalidTokenOffsetsException itoe) {
    throw new IOException(itoe);
  }
}
