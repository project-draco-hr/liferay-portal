{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long recordSetId=ParamUtil.getLong(resourceRequest,"recordSetId");
  String fileExtension=ParamUtil.getString(resourceRequest,"fileExtension");
  HttpServletRequest httpServletRequest=PortalUtil.getHttpServletRequest(resourceRequest);
  HttpServletResponse httpServletResponse=PortalUtil.getHttpServletResponse(resourceResponse);
  DDLRecordSet recordSet=DDLRecordSetServiceUtil.getRecordSet(recordSetId);
  String fileName=recordSet.getName(themeDisplay.getLocale()) + CharPool.PERIOD + fileExtension;
  DDLExportFormat exportFormat=DDLExportFormat.parse(fileExtension);
  DDLExporter exporter=DDLExporterFactory.getDDLExporter(exportFormat);
  byte[] bytes=exporter.export(recordSetId,WorkflowConstants.STATUS_APPROVED);
  String contentType=MimeTypesUtil.getContentType(fileName);
  ServletResponseUtil.sendFile(httpServletRequest,httpServletResponse,fileName,bytes,contentType);
}
