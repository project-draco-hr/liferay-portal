{
  long companyId=getCompanyId(layout.getGroupId());
  Settings portalPropertiesSettings=getPortalPropertiesSettings();
  Settings serviceConfigurationBeanSettings=getServiceConfigurationBeanSettings(portletId,portalPropertiesSettings);
  Settings portalPreferencesSettings=getPortalPreferencesSettings(companyId,serviceConfigurationBeanSettings);
  Settings companyPortletPreferencesSettings=getCompanyPortletPreferencesSettings(companyId,portletId,portalPreferencesSettings);
  Settings groupPortletPreferencesSettings=getGroupPortletPreferencesSettings(layout.getGroupId(),portletId,companyPortletPreferencesSettings);
  Settings portletInstancePortletPreferencesSettings=getPortletInstancePortletPreferencesSettings(layout,portletId,groupPortletPreferencesSettings);
  return applyFallbackKeys(portletId,portletInstancePortletPreferencesSettings);
}
