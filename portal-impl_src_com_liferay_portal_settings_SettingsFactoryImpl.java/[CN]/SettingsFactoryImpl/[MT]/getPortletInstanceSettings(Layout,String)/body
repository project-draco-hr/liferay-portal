{
  Settings portalPropertiesSettings=getPortalPropertiesSettings();
  Settings serviceConfigurationBeanSettings=getServiceConfigurationBeanSettings(portletId,portalPropertiesSettings);
  long groupId=layout.getGroupId();
  long companyId=getGroupCompanyId(groupId);
  Settings portalPreferencesSettings=getPortalPreferencesSettings(companyId,serviceConfigurationBeanSettings);
  Settings companyPortletPreferencesSettings=getCompanyPortletPreferencesSettings(companyId,portletId,portalPreferencesSettings);
  Settings groupPortletPreferencesSettings=getGroupPortletPreferencesSettings(groupId,portletId,companyPortletPreferencesSettings);
  Settings portletInstancePortletPreferencesSettings=getPortletInstancePortletPreferencesSettings(layout,portletId,groupPortletPreferencesSettings);
  return applyFallbackKeys(portletId,portletInstancePortletPreferencesSettings);
}
