{
  StringBundler sb=new StringBundler();
  if ((cdata == null) || cdata.isEmpty()) {
    return StringPool.BLANK;
  }
 else   if (cdata.contains("<pre>") || cdata.contains("<table>")) {
    int cdataBeginIndex=0;
    int startTagIndex=0;
    while (!cdata.isEmpty()) {
      int preTagIndex=cdata.indexOf("<pre>");
      int tableTagIndex=cdata.indexOf("<table>");
      boolean hasPreTag=(preTagIndex != -1) ? true : false;
      boolean hasTableTag=(tableTagIndex != -1) ? true : false;
      boolean startsWithPreformattedTag=((preTagIndex == 0) || (tableTagIndex == 0)) ? true : false;
      String tagName=null;
      if (hasPreTag && hasTableTag) {
        if (preTagIndex < tableTagIndex) {
          startTagIndex=preTagIndex;
          tagName="pre";
        }
 else {
          startTagIndex=tableTagIndex;
          tagName="table";
        }
      }
      if (!startsWithPreformattedTag) {
        if (!hasPreTag && !hasTableTag) {
          startTagIndex=cdata.length();
        }
 else         if (hasPreTag && !hasTableTag) {
          startTagIndex=preTagIndex;
        }
 else {
          startTagIndex=tableTagIndex;
        }
        String textToFormat=cdata.substring(0,startTagIndex);
        sb.append(_formatCDATA(textToFormat));
        cdataBeginIndex=startTagIndex;
      }
 else {
        startTagIndex=0;
        if (preTagIndex == 0) {
          tagName="pre";
        }
 else {
          tagName="table";
        }
        String startTag="<" + tagName + ">";
        String endTag="</" + tagName + ">";
        int startTagLength=startTag.length();
        int endTagLength=endTag.length();
        int endTagIndex=cdata.indexOf(endTag,startTagLength - 1);
        String entireElement=cdata.substring(startTagIndex,endTagIndex + endTagLength);
        sb.append("\n");
        sb.append(entireElement);
        sb.append("\n");
        cdataBeginIndex=endTagIndex + endTagLength;
      }
      cdata=cdata.substring(cdataBeginIndex);
    }
  }
 else {
    sb.append(_formatCDATA(cdata));
  }
  return sb.toString().trim();
}
