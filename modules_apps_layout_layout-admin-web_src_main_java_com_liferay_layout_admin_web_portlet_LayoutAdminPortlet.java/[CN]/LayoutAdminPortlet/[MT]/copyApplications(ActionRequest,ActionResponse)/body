{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long groupId=ParamUtil.getLong(actionRequest,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(actionRequest,"privateLayout");
  long layoutId=ParamUtil.getLong(actionRequest,"layoutId");
  Layout layout=layoutLocalService.getLayout(groupId,privateLayout,layoutId);
  LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
  if (!layout.getType().equals(LayoutConstants.TYPE_PORTLET)) {
    return;
  }
  String layoutTemplateId=ParamUtil.getString(actionRequest,"layoutTemplateId",PropsValues.DEFAULT_LAYOUT_TEMPLATE_ID);
  layoutTypePortlet.setLayoutTemplateId(themeDisplay.getUserId(),layoutTemplateId);
  long copyLayoutId=ParamUtil.getLong(actionRequest,"copyLayoutId");
  if ((copyLayoutId == 0) || (copyLayoutId == layout.getLayoutId())) {
    return;
  }
  Layout copyLayout=layoutLocalService.fetchLayout(groupId,privateLayout,copyLayoutId);
  if ((copyLayout == null) || !copyLayout.isTypePortlet()) {
    return;
  }
  ActionUtil.removePortletIds(actionRequest,layout);
  ActionUtil.copyPreferences(actionRequest,layout,copyLayout);
  SitesUtil.copyLookAndFeel(layout,copyLayout);
}
