{
  PKUpgradeColumnImpl pkUpgradeColumn=new PKUpgradeColumnImpl("userId",new Integer(Types.VARCHAR),true);
  UpgradeColumn upgradeUserPortraitIdColumn=new UserPortraitIdUpgradeColumnImpl(pkUpgradeColumn,AvailableMappersUtil.getImageIdMapper());
  UpgradeTable upgradeTable=new DefaultUpgradeTableImpl(UserImpl.TABLE_NAME,UserImpl.TABLE_COLUMNS,pkUpgradeColumn,upgradeUserPortraitIdColumn);
  upgradeTable.updateTable();
  ValueMapper userIdMapper=new DefaultPKMapper(pkUpgradeColumn.getValueMapper());
  AvailableMappersUtil.setUserIdMapper(userIdMapper);
  UpgradeColumn upgradeUserIdColumn=new SwapUpgradeColumnImpl("userId",new Integer(Types.VARCHAR),userIdMapper);
  upgradeTable=new DefaultUpgradeTableImpl(AccountImpl.TABLE_NAME,AccountImpl.TABLE_COLUMNS,upgradeUserIdColumn);
  upgradeTable.updateTable();
  UpgradeColumn upgradeContactIdColumn=new TempUpgradeColumnImpl("contactId",new Integer(Types.VARCHAR));
  upgradeTable=new DefaultUpgradeTableImpl(ContactImpl.TABLE_NAME,ContactImpl.TABLE_COLUMNS,upgradeContactIdColumn,upgradeUserIdColumn);
  upgradeTable.updateTable();
  upgradeTable=new DefaultUpgradeTableImpl(CyrusUser.TABLE_NAME,CyrusUser.TABLE_COLUMNS,upgradeUserIdColumn);
  upgradeTable.updateTable();
  upgradeTable=new DefaultUpgradeTableImpl(CyrusVirtual.TABLE_NAME,CyrusVirtual.TABLE_COLUMNS,upgradeUserIdColumn);
  upgradeTable.updateTable();
  UpgradeColumn upgradeApprovedByUserIdColumn=new SwapUpgradeColumnImpl("approvedByUserId",new Integer(Types.VARCHAR),userIdMapper);
  upgradeTable=new DefaultUpgradeTableImpl(JournalArticleImpl.TABLE_NAME,JournalArticleImpl.TABLE_COLUMNS,upgradeUserIdColumn,upgradeApprovedByUserIdColumn);
  upgradeTable.updateTable();
  upgradeTable=new DefaultUpgradeTableImpl(JournalStructureImpl.TABLE_NAME,JournalStructureImpl.TABLE_COLUMNS,upgradeUserIdColumn);
  upgradeTable.updateTable();
  upgradeTable=new DefaultUpgradeTableImpl(JournalTemplateImpl.TABLE_NAME,JournalTemplateImpl.TABLE_COLUMNS,upgradeUserIdColumn);
  upgradeTable.updateTable();
  upgradeTable=new DefaultUpgradeTableImpl(PasswordTrackerImpl.TABLE_NAME,PasswordTrackerImpl.TABLE_COLUMNS,new PKUpgradeColumnImpl("passwordTrackerId",false),upgradeUserIdColumn);
  upgradeTable.updateTable();
  UpgradeColumn skipUpgradeClassNameIdColumn=new TempUpgradeColumnImpl("classNameId",new Integer(Types.VARCHAR));
  UpgradeColumn skipUpgradeClassPKColumn=new TempUpgradeColumnImpl("classPK",new Integer(Types.VARCHAR));
  upgradeTable=new DefaultUpgradeTableImpl(RatingsEntryImpl.TABLE_NAME,RatingsEntryImpl.TABLE_COLUMNS,upgradeUserIdColumn,skipUpgradeClassNameIdColumn,skipUpgradeClassPKColumn);
  upgradeTable.updateTable();
  for (int i=0; i < _TABLES.length; i++) {
    String sql="alter_column_type " + _TABLES[i] + " userId LONG";
    if (_log.isDebugEnabled()) {
      _log.debug(sql);
    }
    runSQL(sql);
  }
  runSQL("alter_column_type JournalArticle approvedByUserId LONG");
}
