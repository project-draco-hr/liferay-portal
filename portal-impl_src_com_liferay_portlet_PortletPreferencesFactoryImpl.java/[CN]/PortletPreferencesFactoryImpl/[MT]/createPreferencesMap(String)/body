{
  XMLEventReader xmlEventReader=null;
  Map<String,Preference> preferencesMap=new HashMap<>();
  try {
    XMLInputFactory xmlInputFactory=StAXReaderUtil.getXMLInputFactory();
    xmlEventReader=xmlInputFactory.createXMLEventReader(new UnsyncStringReader(xml));
    while (xmlEventReader.hasNext()) {
      XMLEvent xmlEvent=xmlEventReader.nextEvent();
      if (xmlEvent.isStartElement()) {
        StartElement startElement=xmlEvent.asStartElement();
        String elementName=startElement.getName().getLocalPart();
        if (elementName.equals("preference")) {
          Preference preference=readPreference(xmlEventReader);
          preferencesMap.put(preference.getName(),preference);
        }
      }
    }
  }
 catch (  XMLStreamException xmlse) {
    throw new SystemException(xmlse);
  }
 finally {
    if (xmlEventReader != null) {
      try {
        xmlEventReader.close();
      }
 catch (      XMLStreamException xmlse) {
        if (_log.isDebugEnabled()) {
          _log.debug(xmlse,xmlse);
        }
      }
    }
  }
  return preferencesMap;
}
