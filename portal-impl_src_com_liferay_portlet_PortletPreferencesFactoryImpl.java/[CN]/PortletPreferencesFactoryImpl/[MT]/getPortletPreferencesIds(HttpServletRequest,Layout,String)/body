{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  long scopeGroupId=PortalUtil.getScopeGroupId(request,portletId,true);
  long userId=PortalUtil.getUserId(request);
  LayoutTypePortlet layoutTypePortlet=themeDisplay.getLayoutTypePortlet();
  boolean modeEditGuest=false;
  String portletMode=ParamUtil.getString(request,"p_p_mode");
  if (portletMode.equals(LiferayPortletMode.EDIT_GUEST.toString()) || ((layoutTypePortlet != null) && (layoutTypePortlet.hasModeEditGuestPortletId(portletId)))) {
    modeEditGuest=true;
  }
  return getPortletPreferencesIds(scopeGroupId,userId,layout,portletId,modeEditGuest);
}
