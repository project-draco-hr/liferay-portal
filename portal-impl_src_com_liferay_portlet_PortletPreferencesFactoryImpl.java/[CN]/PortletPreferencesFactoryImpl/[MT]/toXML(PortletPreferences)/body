{
  PortletPreferencesImpl portletPreferencesImpl=null;
  if (portletPreferences instanceof PortletPreferencesWrapper) {
    PortletPreferencesWrapper portletPreferencesWrapper=(PortletPreferencesWrapper)portletPreferences;
    portletPreferencesImpl=portletPreferencesWrapper.getPortletPreferencesImpl();
  }
 else {
    portletPreferencesImpl=(PortletPreferencesImpl)portletPreferences;
  }
  return portletPreferencesImpl.toXML();
}
