{
  PortletPreferencesImpl portletPreferencesImpl=(PortletPreferencesImpl)portletPreferences;
  Map<String,Preference> preferencesMap=portletPreferencesImpl.getPreferences();
  Element portletPreferencesElement=new Element("portlet-preferences",false);
  for (  Map.Entry<String,Preference> entry : preferencesMap.entrySet()) {
    Preference preference=entry.getValue();
    Element preferenceElement=portletPreferencesElement.addElement("preference");
    preferenceElement.addElement("name",preference.getName());
    for (    String value : preference.getValues()) {
      preferenceElement.addElement("value",value);
    }
    if (preference.isReadOnly()) {
      preferenceElement.addElement("read-only",Boolean.TRUE);
    }
  }
  return portletPreferencesElement.toXMLString();
}
