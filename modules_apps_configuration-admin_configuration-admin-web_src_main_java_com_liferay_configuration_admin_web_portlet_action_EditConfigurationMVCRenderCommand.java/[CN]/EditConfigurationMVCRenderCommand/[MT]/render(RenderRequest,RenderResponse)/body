{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  ConfigurationHelper configurationHelper=new ConfigurationHelper(_bundleContext,_configurationAdmin,_extendedMetaTypeService,themeDisplay.getLanguageId());
  String pid=ParamUtil.getString(renderRequest,"pid",factoryPid);
  ConfigurationModel configurationModel=configurationHelper.getConfigurationModel(pid);
  String factoryPid=ParamUtil.getString(renderRequest,"factoryPid");
  if ((configurationModel == null) && Validator.isNotNull(factoryPid)) {
    configurationModel=configurationHelper.getConfigurationModel(factoryPid);
  }
  if (configurationModel != null) {
    configurationModel=new ConfigurationModel(configurationModel.getExtendedObjectClassDefinition(),configurationHelper.getConfiguration(pid),configurationModel.getBundleLocation(),configurationModel.isFactory());
  }
  renderRequest.setAttribute(ConfigurationAdminWebKeys.CONFIGURATION_MODEL,configurationModel);
  DDMFormRendererHelper ddmFormRendererHelper=new DDMFormRendererHelper(renderRequest,renderResponse,configurationModel,_ddmFormRenderer);
  renderRequest.setAttribute(DDMWebKeys.DYNAMIC_DATA_MAPPING_FORM_HTML,ddmFormRendererHelper.getDDMFormHTML());
  return "/edit_configuration.jsp";
}
