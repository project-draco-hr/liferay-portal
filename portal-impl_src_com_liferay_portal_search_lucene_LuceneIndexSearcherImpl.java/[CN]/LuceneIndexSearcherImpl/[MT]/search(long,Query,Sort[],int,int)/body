{
  if (_log.isDebugEnabled()) {
    _log.debug("Query " + query);
  }
  Hits hits=null;
  org.apache.lucene.search.IndexSearcher searcher=null;
  try {
    searcher=LuceneUtil.getSearcher(companyId);
    org.apache.lucene.search.Sort luceneSort=null;
    if (sorts != null) {
      SortField[] sortFields=new SortField[sorts.length];
      for (int i=0; i < sorts.length; i++) {
        Sort sort=sorts[i];
        sortFields[i]=new SortField(sort.getFieldName(),sort.getType(),sort.isReverse());
      }
      luceneSort=new org.apache.lucene.search.Sort(sortFields);
    }
    org.apache.lucene.search.Hits luceneHits=searcher.search(QueryTranslator.translate(query),luceneSort);
    hits=subset(luceneHits,start,end);
  }
 catch (  RuntimeException re) {
    String msg=GetterUtil.getString(re.getMessage());
    if (!msg.endsWith("does not appear to be indexed")) {
      throw re;
    }
  }
catch (  Exception e) {
    if (e instanceof BooleanQuery.TooManyClauses || e instanceof ParseException) {
      _log.error("Query: " + query,e);
      return new HitsImpl();
    }
 else {
      throw new SearchException(e);
    }
  }
 finally {
    try {
      if (searcher != null) {
        searcher.close();
      }
    }
 catch (    IOException ioe) {
      throw new SearchException(ioe);
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Search found " + hits.getLength() + " results in "+ hits.getSearchTime()+ "ms");
  }
  return hits;
}
