{
  if (_log.isDebugEnabled()) {
    _log.debug("Query: " + query);
  }
  Hits hits=null;
  org.apache.lucene.search.IndexSearcher searcher=null;
  try {
    searcher=LuceneUtil.getSearcher(companyId);
    org.apache.lucene.search.Sort luceneSort=null;
    if (sort != null) {
      SortField[] sortFieldArray=new SortField[sort.length];
      int i=0;
      for (      Sort sortField : sort) {
        sortFieldArray[i]=new SortField(sortField.getFieldName(),sortField.isReverse());
        i++;
      }
      luceneSort=new org.apache.lucene.search.Sort(sortFieldArray);
    }
    org.apache.lucene.search.Hits luceneHits=searcher.search(QueryTranslator.translate(query),luceneSort);
    hits=subset(luceneHits,start,end);
  }
 catch (  RuntimeException re) {
    String msg=GetterUtil.getString(re.getMessage());
    if (!msg.endsWith("does not appear to be indexed")) {
      throw re;
    }
  }
catch (  Exception e) {
    if (e instanceof BooleanQuery.TooManyClauses || e instanceof ParseException) {
      _log.error("Query: " + query,e);
      return new HitsImpl();
    }
 else {
      throw new SearchException(e);
    }
  }
 finally {
    try {
      if (searcher != null) {
        searcher.close();
      }
    }
 catch (    IOException ioe) {
      throw new SearchException(ioe);
    }
  }
  return hits;
}
