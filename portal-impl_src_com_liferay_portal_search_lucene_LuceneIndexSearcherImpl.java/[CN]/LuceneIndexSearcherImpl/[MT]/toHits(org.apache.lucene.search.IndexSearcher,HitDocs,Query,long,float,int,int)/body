{
  int length=hitDocs.getTotalHits();
  if ((start == QueryUtil.ALL_POS) && (end == QueryUtil.ALL_POS)) {
    start=0;
    end=length;
  }
  Set<String> queryTerms=new HashSet<String>();
  IndexReader indexReader=indexSearcher.getIndexReader();
  List<String> indexedFieldNames=new ArrayList<String>(indexReader.getFieldNames(IndexReader.FieldOption.INDEXED));
  org.apache.lucene.search.Query luceneQuery=(org.apache.lucene.search.Query)QueryTranslatorUtil.translate(query);
  int scoredFieldNamesCount=LuceneHelperUtil.countScoredFieldNames(luceneQuery,ArrayUtil.toStringArray(indexedFieldNames.toArray()));
  Hits hits=new HitsImpl();
  if ((start > -1) && (start <= end)) {
    if (end > length) {
      end=length;
    }
    if (start > end) {
      start=end;
    }
    int subsetTotal=end - start;
    if (subsetTotal > PropsValues.INDEX_SEARCH_LIMIT) {
      subsetTotal=PropsValues.INDEX_SEARCH_LIMIT;
    }
    List<Document> subsetDocs=new ArrayList<Document>(subsetTotal);
    List<String> subsetSnippets=new ArrayList<String>(subsetTotal);
    List<Float> subsetScores=new ArrayList<Float>(subsetTotal);
    QueryConfig queryConfig=query.getQueryConfig();
    for (int i=start; i < start + subsetTotal; i++) {
      int docId=hitDocs.getDocId(i);
      org.apache.lucene.document.Document document=indexSearcher.doc(docId);
      Document subsetDocument=getDocument(document);
      String subsetSnippet=StringPool.BLANK;
      if (queryConfig.isHighlightEnabled()) {
        Locale locale=queryConfig.getLocale();
        subsetSnippet=getSnippet(document,query,Field.CONTENT,locale,queryTerms);
        getSnippet(document,query,Field.DESCRIPTION,locale,queryTerms);
        getSnippet(document,query,Field.TITLE,locale,queryTerms);
      }
      subsetDocument.addText(Field.SNIPPET,subsetSnippet);
      subsetSnippets.add(subsetSnippet);
      subsetDocs.add(subsetDocument);
      Float subsetScore=hitDocs.getScore(i);
      if (scoredFieldNamesCount > 0) {
        subsetScore=subsetScore / scoredFieldNamesCount;
      }
      subsetScores.add(subsetScore);
      if (_log.isDebugEnabled()) {
        try {
          Explanation explanation=indexSearcher.explain(luceneQuery,docId);
          _log.debug(explanation.toString());
        }
 catch (        Exception e) {
        }
      }
    }
    if (!queryConfig.isHighlightEnabled()) {
      queryTerms=getQueryTerms(query);
    }
    hits.setStart(startTime);
    hits.setSearchTime(searchTime);
    hits.setQuery(query);
    hits.setQueryTerms(queryTerms.toArray(new String[queryTerms.size()]));
    hits.setDocs(subsetDocs.toArray(new Document[subsetDocs.size()]));
    hits.setLength(length);
    hits.setSnippets(subsetSnippets.toArray(new String[subsetSnippets.size()]));
    hits.setScores(subsetScores.toArray(new Float[subsetScores.size()]));
  }
  return hits;
}
