{
  if (actionId.equals(ActionKeys.ADD_FOLDER)) {
    actionId=ActionKeys.ADD_SUBFOLDER;
  }
  Boolean hasPermission=StagingPermissionUtil.hasPermission(permissionChecker,dlFolder.getGroupId(),DLFolder.class.getName(),dlFolder.getFolderId(),PortletKeys.DOCUMENT_LIBRARY,actionId);
  if (hasPermission != null) {
    return hasPermission.booleanValue();
  }
  long folderId=dlFolder.getFolderId();
  if (actionId.equals(ActionKeys.VIEW)) {
    while (folderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      if (!permissionChecker.hasOwnerPermission(dlFolder.getCompanyId(),DLFolder.class.getName(),dlFolder.getFolderId(),dlFolder.getUserId(),actionId) && !permissionChecker.hasPermission(dlFolder.getGroupId(),DLFolder.class.getName(),dlFolder.getFolderId(),actionId)) {
        return false;
      }
      if (!PropsValues.PERMISSIONS_VIEW_DYNAMIC_INHERITANCE) {
        break;
      }
      folderId=dlFolder.getParentFolderId();
      dlFolder=DLFolderLocalServiceUtil.getFolder(folderId);
    }
    return true;
  }
 else {
    while (folderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      if (permissionChecker.hasOwnerPermission(dlFolder.getCompanyId(),DLFolder.class.getName(),dlFolder.getFolderId(),dlFolder.getUserId(),actionId)) {
        return true;
      }
      if (permissionChecker.hasPermission(dlFolder.getGroupId(),DLFolder.class.getName(),dlFolder.getFolderId(),actionId)) {
        return true;
      }
      folderId=dlFolder.getParentFolderId();
      dlFolder=DLFolderLocalServiceUtil.getFolder(folderId);
    }
    return false;
  }
}
