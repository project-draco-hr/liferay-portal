{
  if (actionId.equals(ActionKeys.ADD_FOLDER)) {
    actionId=ActionKeys.ADD_SUBFOLDER;
  }
  Boolean hasPermission=StagingPermissionUtil.hasPermission(permissionChecker,folder.getGroupId(),DLFolder.class.getName(),folder.getFolderId(),PortletKeys.DOCUMENT_LIBRARY,actionId);
  if (hasPermission != null) {
    return hasPermission.booleanValue();
  }
  long folderId=folder.getFolderId();
  if (actionId.equals(ActionKeys.VIEW)) {
    while (folderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      folder=DLRepositoryLocalServiceUtil.getFolder(folderId);
      folderId=folder.getParentFolderId();
      if (!permissionChecker.hasOwnerPermission(folder.getCompanyId(),DLFolder.class.getName(),folder.getFolderId(),folder.getUserId(),actionId) && !permissionChecker.hasPermission(folder.getGroupId(),DLFolder.class.getName(),folder.getFolderId(),actionId)) {
        return false;
      }
      if (!PropsValues.PERMISSIONS_VIEW_DYNAMIC_INHERITANCE) {
        break;
      }
    }
    return true;
  }
 else {
    while (folderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      folder=DLRepositoryLocalServiceUtil.getFolder(folderId);
      folderId=folder.getParentFolderId();
      if (permissionChecker.hasOwnerPermission(folder.getCompanyId(),DLFolder.class.getName(),folder.getFolderId(),folder.getUserId(),actionId)) {
        return true;
      }
      if (permissionChecker.hasPermission(folder.getGroupId(),DLFolder.class.getName(),folder.getFolderId(),actionId)) {
        return true;
      }
    }
    return false;
  }
}
