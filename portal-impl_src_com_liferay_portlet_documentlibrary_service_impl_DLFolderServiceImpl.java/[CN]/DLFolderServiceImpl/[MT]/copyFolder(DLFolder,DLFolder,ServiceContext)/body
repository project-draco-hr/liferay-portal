{
  List<DLFileEntry> srcFileEntries=dlFileEntryService.getFileEntries(srcFolder.getFolderId());
  for (  DLFileEntry srcFileEntry : srcFileEntries) {
    String name=srcFileEntry.getName();
    String title=srcFileEntry.getTitleWithExtension();
    String description=srcFileEntry.getDescription();
    String extraSettings=srcFileEntry.getExtraSettings();
    File file=null;
    try {
      file=FileUtil.createTempFile(FileUtil.getExtension(name));
      InputStream is=dlLocalService.getFileAsStream(srcFolder.getCompanyId(),srcFolder.getFolderId(),name);
      FileUtil.write(file,is);
    }
 catch (    Exception e) {
      _log.error(e,e);
      continue;
    }
    dlFileEntryService.addFileEntry(destFolder.getFolderId(),name,title,description,extraSettings,file,serviceContext);
    file.delete();
  }
  List<DLFolder> srcSubfolders=getFolders(srcFolder.getGroupId(),srcFolder.getFolderId());
  for (  DLFolder srcSubfolder : srcSubfolders) {
    String name=srcSubfolder.getName();
    String description=srcSubfolder.getDescription();
    DLFolder destSubfolder=addFolder(destFolder.getGroupId(),destFolder.getFolderId(),name,description,serviceContext);
    copyFolder(srcSubfolder,destSubfolder,serviceContext);
  }
}
