{
  PermissionChecker permissionChecker=getPermissionChecker();
  DLFolder dlFolder=dlFolderLocalService.getFolder(folderId);
  DLFolderPermission.check(permissionChecker,dlFolder,ActionKeys.UPDATE);
  DLFolderPermission.check(permissionChecker,serviceContext.getScopeGroupId(),parentFolderId,ActionKeys.ADD_DOCUMENT);
  boolean hasLock=lockLocalService.hasLock(getUserId(),DLFolder.class.getName(),folderId);
  Lock lock=null;
  if (!hasLock) {
    lock=lockFolder(folderId);
  }
  try {
    return dlFolderLocalService.moveFolder(folderId,parentFolderId,serviceContext);
  }
  finally {
    if (!hasLock) {
      unlockFolder(dlFolder.getGroupId(),folderId,lock.getUuid());
    }
  }
}
