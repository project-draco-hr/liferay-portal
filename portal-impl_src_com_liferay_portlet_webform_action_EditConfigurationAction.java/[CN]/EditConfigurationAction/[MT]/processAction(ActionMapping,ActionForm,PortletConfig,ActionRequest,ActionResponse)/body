{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  if (!cmd.equals(Constants.UPDATE)) {
    return;
  }
  String title=ParamUtil.getString(req,"title");
  String description=ParamUtil.getString(req,"description");
  boolean requireCaptcha=ParamUtil.getBoolean(req,"requireCaptcha");
  String subject=ParamUtil.getString(req,"subject");
  String emailAddress=ParamUtil.getString(req,"emailAddress");
  String portletResource=ParamUtil.getString(req,"portletResource");
  PortletPreferences prefs=PortletPreferencesFactory.getPortletSetup(req,portletResource,true,true);
  if (Validator.isNull(title)) {
    SessionErrors.add(req,"titleRequired");
  }
  if (Validator.isNull(subject)) {
    SessionErrors.add(req,"subjectRequired");
  }
  if (Validator.isNull(emailAddress)) {
    SessionErrors.add(req,"emailAddressRequired");
  }
 else   if (!Validator.isEmailAddress(emailAddress)) {
    SessionErrors.add(req,"emailAddressInvalid");
  }
  if (!SessionErrors.isEmpty(req)) {
    return;
  }
  prefs.setValue("title",title);
  prefs.setValue("description",description);
  prefs.setValue("require-captcha",String.valueOf(requireCaptcha));
  prefs.setValue("subject",subject);
  prefs.setValue("emailAddress",emailAddress);
  int i=1;
  String fieldLabel=ParamUtil.getString(req,"fieldLabel" + i);
  String fieldType=ParamUtil.getString(req,"fieldType" + i);
  String fieldOptions=ParamUtil.getString(req,"fieldOptions" + i);
  while ((i == 1) || (fieldLabel.trim().length() > 0)) {
    prefs.setValue("fieldLabel" + i,fieldLabel);
    prefs.setValue("fieldType" + i,fieldType);
    prefs.setValue("fieldOptions" + i,fieldOptions);
    i++;
    fieldLabel=ParamUtil.getString(req,"fieldLabel" + i);
    fieldType=ParamUtil.getString(req,"fieldType" + i);
    fieldOptions=ParamUtil.getString(req,"fieldOptions" + i);
  }
  if (SessionErrors.isEmpty(req)) {
    prefs.store();
    SessionMessages.add(req,config.getPortletName() + ".doConfigure");
  }
}
