{
  User user=userPersistence.findByPrimaryKey(serviceContext.getGuestOrUserId());
  Date now=new Date();
  long kaleoConditionId=counterLocalService.increment();
  KaleoCondition kaleoCondition=kaleoConditionPersistence.create(kaleoConditionId);
  kaleoCondition.setCompanyId(user.getCompanyId());
  kaleoCondition.setUserId(user.getUserId());
  kaleoCondition.setUserName(user.getFullName());
  kaleoCondition.setCreateDate(now);
  kaleoCondition.setModifiedDate(now);
  kaleoCondition.setKaleoDefinitionId(kaleoDefinitionId);
  kaleoCondition.setKaleoNodeId(kaleoNodeId);
  kaleoCondition.setScript(condition.getScript());
  kaleoCondition.setScriptLanguage(condition.getScriptLanguage().getValue());
  kaleoCondition.setScriptRequiredContexts(condition.getScriptRequiredContexts());
  kaleoConditionPersistence.update(kaleoCondition);
  return kaleoCondition;
}
