{
  long userId=0;
  String username=httpAuthorizationHeader.getAuthParameter(HttpAuthorizationHeader.AUTH_PARAMETER_NAME_USERNAME);
  String realm=httpAuthorizationHeader.getAuthParameter(HttpAuthorizationHeader.AUTH_PARAMETER_NAME_REALM);
  String nonce=httpAuthorizationHeader.getAuthParameter(HttpAuthorizationHeader.AUTH_PARAMETER_NAME_NONCE);
  String uri=httpAuthorizationHeader.getAuthParameter(HttpAuthorizationHeader.AUTH_PARAMETER_NAME_URI);
  String response=httpAuthorizationHeader.getAuthParameter(HttpAuthorizationHeader.AUTH_PARAMETER_NAME_RESPONSE);
  if (Validator.isNull(username) || Validator.isNull(realm) || Validator.isNull(nonce)|| Validator.isNull(uri)|| Validator.isNull(response)) {
    return userId;
  }
  if (!realm.equals(Portal.PORTAL_REALM) || !uri.equals(httpServletRequest.getRequestURI())) {
    return userId;
  }
  if (!NonceUtil.verify(nonce)) {
    return userId;
  }
  long companyId=PortalInstances.getCompanyId(httpServletRequest);
  userId=UserLocalServiceUtil.authenticateForDigest(companyId,username,realm,nonce,httpServletRequest.getMethod(),uri,response);
  return userId;
}
