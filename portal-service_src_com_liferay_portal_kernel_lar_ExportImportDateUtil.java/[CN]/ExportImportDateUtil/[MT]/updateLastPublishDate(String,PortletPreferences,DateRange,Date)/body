{
  if (lastPublishDate == null) {
    lastPublishDate=new Date();
  }
  Date originalLastPublishDate=getLastPublishDate(portletPreferences);
  if (originalLastPublishDate == null) {
    originalLastPublishDate=lastPublishDate;
  }
  if (!isValidDateRange(dateRange,originalLastPublishDate)) {
    return;
  }
  try {
    portletPreferences.setValue(_LAST_PUBLISH_DATE,String.valueOf(lastPublishDate.getTime()));
    portletPreferences.store();
  }
 catch (  UnsupportedOperationException uoe) {
    if (_log.isDebugEnabled()) {
      _log.debug("Not updating the portlet setup for " + portletId + " because no setup was returned for the current "+ "page");
    }
  }
catch (  Exception e) {
    _log.error(e,e);
  }
}
