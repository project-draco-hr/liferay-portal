{
  if (dateRange != null) {
    Date startDate=dateRange.getStartDate();
    Date endDate=dateRange.getEndDate();
    Date originalLastPublishDate=getLastPublishDate(portletPreferences);
    if ((originalLastPublishDate != null) && (endDate != null) && originalLastPublishDate.before(endDate)&& (startDate != null)&& startDate.after(originalLastPublishDate)) {
      return;
    }
  }
  if (lastPublishDate == null) {
    lastPublishDate=new Date();
  }
  try {
    portletPreferences.setValue(_LAST_PUBLISH_DATE,String.valueOf(lastPublishDate.getTime()));
    portletPreferences.store();
  }
 catch (  UnsupportedOperationException uoe) {
    if (_log.isDebugEnabled()) {
      _log.debug("Not updating the portlet setup for " + portletId + " because no setup was returned for the current "+ "page");
    }
  }
catch (  Exception e) {
    _log.error(e,e);
  }
}
