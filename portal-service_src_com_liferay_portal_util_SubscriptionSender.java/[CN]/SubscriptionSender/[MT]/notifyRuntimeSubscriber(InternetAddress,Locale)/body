{
  String emailAddress=to.getAddress();
  User user=UserLocalServiceUtil.fetchUserByEmailAddress(companyId,emailAddress);
  if (user == null) {
    if (_log.isInfoEnabled()) {
      _log.info("User with email address " + emailAddress + " does not exist for company "+ companyId);
    }
    if (bulk) {
      if (_bulkAddresses == null) {
        _bulkAddresses=new ArrayList<>();
      }
      _bulkAddresses.add(to);
      return;
    }
    sendEmail(to,locale);
  }
 else {
    sendNotification(user);
  }
}
