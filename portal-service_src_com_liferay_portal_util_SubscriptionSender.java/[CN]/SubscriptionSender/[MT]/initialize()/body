{
  if (_initialized) {
    return;
  }
  _initialized=true;
  Company company=CompanyLocalServiceUtil.getCompany(companyId);
  setContextAttribute("[$COMPANY_ID$]",company.getCompanyId());
  setContextAttribute("[$COMPANY_MX$]",company.getMx());
  setContextAttribute("[$COMPANY_NAME$]",company.getName());
  setContextAttribute("[$PORTAL_URL$]",company.getVirtualHostname());
  if (groupId > 0) {
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    setContextAttribute("[$COMMUNITY_NAME$]",group.getDescriptiveName());
  }
  if ((userId > 0) && Validator.isNotNull(_contextUserPrefix)) {
    setContextAttribute("[$" + _contextUserPrefix + "_USER_ADDRESS$]",PortalUtil.getUserEmailAddress(userId));
    setContextAttribute("[$" + _contextUserPrefix + "_USER_NAME$]",PortalUtil.getUserName(userId,StringPool.BLANK));
  }
  _sentUserIds.add(userId);
  mailId=PortalUtil.getMailId(company.getMx(),_mailIdPopPortletPrefix,_mailIdIds);
}
