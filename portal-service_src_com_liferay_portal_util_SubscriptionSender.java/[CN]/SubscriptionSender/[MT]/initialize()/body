{
  if (_initialized) {
    return;
  }
  _initialized=true;
  if ((groupId == 0) && (serviceContext != null)) {
    setScopeGroupId(serviceContext.getScopeGroupId());
  }
  Company company=CompanyLocalServiceUtil.getCompany(companyId);
  setContextAttribute("[$COMPANY_ID$]",company.getCompanyId());
  setContextAttribute("[$COMPANY_MX$]",company.getMx());
  setContextAttribute("[$COMPANY_NAME$]",company.getName());
  setContextAttribute("[$PORTAL_URL$]",company.getPortalURL(groupId));
  if (groupId > 0) {
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    setContextAttribute("[$SITE_NAME$]",group.getDescriptiveName());
  }
  if ((userId > 0) && Validator.isNotNull(_contextUserPrefix)) {
    setContextAttribute("[$" + _contextUserPrefix + "_USER_ADDRESS$]",PortalUtil.getUserEmailAddress(userId));
    setContextAttribute("[$" + _contextUserPrefix + "_USER_NAME$]",PortalUtil.getUserName(userId,StringPool.BLANK));
  }
  if (addUniqueMailId) {
    mailId=PortalUtil.getMailId(company.getMx(),_mailIdPopPortletPrefix,ArrayUtil.append(_mailIdIds,PortalUUIDUtil.generate()));
  }
 else {
    mailId=PortalUtil.getMailId(company.getMx(),_mailIdPopPortletPrefix,_mailIdIds);
  }
}
