{
  for (  Map.Entry<String,EscapableObject<String>> entry : _context.entrySet()) {
    String key=entry.getKey();
    EscapableObject<String> value=entry.getValue();
    String valueString=escape ? value.getEscaped() : value.getRaw();
    content=StringUtil.replace(content,key,valueString);
  }
  if (Validator.isNotNull(portletId)) {
    String portletName=PortalUtil.getPortletTitle(portletId,locale);
    content=StringUtil.replace(content,"[$PORTLET_NAME$]",portletName);
  }
  Company company=CompanyLocalServiceUtil.getCompany(companyId);
  content=StringUtil.replace(content,new String[]{"href=\"/","src=\"/"},new String[]{"href=\"" + getPortalURL(company) + "/","src=\"" + getPortalURL(company) + "/"});
  return content;
}
