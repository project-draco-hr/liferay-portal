{
  for (  Map.Entry<String,EscapableObject<String>> entry : _context.entrySet()) {
    String key=entry.getKey();
    EscapableObject<String> value=entry.getValue();
    String valueString=null;
    if (escape) {
      valueString=value.getEscapedValue();
    }
 else {
      valueString=value.getOriginalValue();
    }
    content=StringUtil.replace(content,key,valueString);
  }
  String portletName=StringPool.BLANK;
  if (Validator.isNotNull(portletId)) {
    portletName=PortalUtil.getPortletTitle(portletId,locale);
    content=StringUtil.replace(content,"[$PORTLET_NAME$]",portletName);
  }
  String portletTitle=portletName;
  if (localizedPortletTitleMap != null) {
    if (Validator.isNotNull(localizedPortletTitleMap.get(locale))) {
      portletTitle=localizedPortletTitleMap.get(locale);
    }
 else {
      Locale defaultLocale=LocaleUtil.getDefault();
      if (Validator.isNotNull(localizedPortletTitleMap.get(defaultLocale))) {
        portletTitle=localizedPortletTitleMap.get(defaultLocale);
      }
    }
  }
  if (Validator.isNotNull(portletTitle)) {
    content=StringUtil.replace(content,"[$PORTLET_TITLE$]",portletTitle);
  }
  Company company=CompanyLocalServiceUtil.getCompany(companyId);
  content=StringUtil.replace(content,new String[]{"href=\"/","src=\"/"},new String[]{"href=\"" + company.getPortalURL(groupId) + "/","src=\"" + company.getPortalURL(groupId) + "/"});
  return content;
}
