{
  for (  Map.Entry<String,EscapableObject<String>> entry : _context.entrySet()) {
    String key=entry.getKey();
    EscapableObject<String> value=entry.getValue();
    String valueString=null;
    if (escape) {
      valueString=value.getEscapedValue();
    }
 else {
      valueString=value.getOriginalValue();
    }
    content=StringUtil.replace(content,key,valueString);
  }
  if (Validator.isNotNull(portletId)) {
    String portletName=PortalUtil.getPortletTitle(portletId,locale);
    content=StringUtil.replace(content,"[$PORTLET_NAME$]",portletName);
  }
  Company company=CompanyLocalServiceUtil.getCompany(companyId);
  content=StringUtil.replace(content,new String[]{"href=\"/","src=\"/"},new String[]{"href=\"" + getPortalURL(company) + "/","src=\"" + getPortalURL(company) + "/"});
  if (htmlFormat) {
    content=StringUtil.replace(content,StringPool.NEW_LINE,"<br />");
  }
  return content;
}
