{
  if (mimeResponse.isCommitted()) {
    StreamUtil.cleanUp(inputStream);
    return;
  }
  if (contentLength > 0) {
    if (mimeResponse instanceof ResourceResponse) {
      ResourceResponse resourceResponse=(ResourceResponse)mimeResponse;
      resourceResponse.setContentLength(contentLength);
    }
  }
  StreamUtil.transfer(inputStream,mimeResponse.getPortletOutputStream());
}
