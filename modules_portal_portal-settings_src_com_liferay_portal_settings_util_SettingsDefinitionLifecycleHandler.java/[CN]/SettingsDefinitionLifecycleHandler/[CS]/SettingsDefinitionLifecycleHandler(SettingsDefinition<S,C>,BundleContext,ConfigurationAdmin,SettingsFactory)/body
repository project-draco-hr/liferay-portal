{
  _settingsDefinition=settingsDefinition;
  _bundleContext=bundleContext;
  _configurationAdmin=configurationAdmin;
  _settingsFactory=settingsFactory;
  if (GroupServiceSettings.class.isAssignableFrom(settingsDefinition.getSettingsClass())) {
    _settingsProviderBuilder=new GroupServiceSettingsProviderBuilder(settingsDefinition,settingsFactory);
  }
 else   if (PortletInstanceSettings.class.isAssignableFrom(settingsDefinition.getSettingsClass())) {
    _settingsProviderBuilder=new PortletInstanceSettingsProviderBuilder(settingsDefinition,settingsFactory);
  }
 else {
    String className=SettingsDefinitionUtil.getSettingsClassName(settingsDefinition);
    throw new IllegalArgumentException("Unable to determine service level for class " + className);
  }
  _configurationBeanBuilder=new ConfigurationBeanBuilder<>(settingsDefinition,_getConfigurationProperties());
}
