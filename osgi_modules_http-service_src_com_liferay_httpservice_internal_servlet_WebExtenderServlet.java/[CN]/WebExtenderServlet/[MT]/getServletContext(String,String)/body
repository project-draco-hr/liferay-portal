{
  Portlet portlet=null;
  if (Validator.isNotNull(portletId)) {
    try {
      String rootPortletId=PortletConstants.getRootPortletId(portletId);
      portlet=PortletLocalServiceUtil.getPortletById(rootPortletId);
    }
 catch (    Exception e) {
      _log.debug(e,e);
    }
  }
  String servletContextName=null;
  if (portlet != null) {
    PortletApp portletApp=portlet.getPortletApp();
    servletContextName=portletApp.getServletContextName();
  }
 else   if (requestURI != null) {
    servletContextName=requestURI;
    String contextPath=PortalUtil.getPathContext();
    if (Validator.isNotNull(contextPath) && servletContextName.startsWith(contextPath)) {
      servletContextName=servletContextName.substring(contextPath.length());
    }
    String modulePath=Portal.PATH_MODULE + StringPool.SLASH;
    if (servletContextName.startsWith(modulePath)) {
      servletContextName=servletContextName.substring(modulePath.length());
    }
    if (servletContextName.startsWith(StringPool.SLASH)) {
      servletContextName=servletContextName.substring(1);
    }
    int index=servletContextName.indexOf(StringPool.SLASH);
    if (index != -1) {
      servletContextName=servletContextName.substring(0,index);
    }
  }
  return ServletContextPool.get(servletContextName);
}
