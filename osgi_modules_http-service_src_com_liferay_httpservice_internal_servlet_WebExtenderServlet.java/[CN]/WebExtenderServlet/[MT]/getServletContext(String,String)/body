{
  Portlet portlet=null;
  if (Validator.isNotNull(portletId)) {
    try {
      String rootPortletId=PortletConstants.getRootPortletId(portletId);
      portlet=PortletLocalServiceUtil.getPortletById(rootPortletId);
    }
 catch (    Exception e) {
      _log.debug(e,e);
    }
  }
  String servletContextName=null;
  if (portlet != null) {
    PortletApp portletApp=portlet.getPortletApp();
    servletContextName=portletApp.getServletContextName();
  }
 else {
    if (requestURI != null) {
      String pathContext=PortalUtil.getPathContext();
      String requestURITemp=requestURI;
      if (Validator.isNotNull(pathContext) && requestURITemp.startsWith(pathContext)) {
        requestURITemp=requestURITemp.substring(pathContext.length());
      }
      if (requestURITemp.startsWith(Portal.PATH_MODULE)) {
        requestURITemp=requestURITemp.substring(Portal.PATH_MODULE.length());
      }
      servletContextName=requestURITemp;
      if (servletContextName.startsWith(StringPool.SLASH)) {
        servletContextName=servletContextName.substring(1);
      }
      int index=servletContextName.indexOf(StringPool.SLASH);
      if (index != -1) {
        servletContextName=servletContextName.substring(0,index);
      }
    }
  }
  return ServletContextPool.get(servletContextName);
}
