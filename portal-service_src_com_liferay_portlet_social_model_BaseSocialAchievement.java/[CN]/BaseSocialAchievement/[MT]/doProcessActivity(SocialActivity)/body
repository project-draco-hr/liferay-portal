{
  if (_counterThreshold == 0) {
    return;
  }
  SocialActivityAchievement achievement=SocialActivityAchievementLocalServiceUtil.fetchUserAchievement(activity.getUserId(),activity.getGroupId(),_name);
  if (achievement != null) {
    return;
  }
  long classNameId=activity.getClassNameId();
  long classPK=activity.getClassPK();
  if (_ownerType != SocialActivityCounterConstants.TYPE_ASSET) {
    classNameId=PortalUtil.getClassNameId(User.class);
    classPK=activity.getUserId();
  }
  if (_ownerType == SocialActivityCounterConstants.TYPE_ASSET) {
    AssetEntry assetEntry=AssetEntryLocalServiceUtil.fetchEntry(activity.getClassName(),activity.getClassPK());
    if (assetEntry != null) {
      classPK=assetEntry.getUserId();
    }
  }
  SocialActivityCounter activityCounter=SocialActivityCounterLocalServiceUtil.fetchLatestActivityCounter(activity.getGroupId(),classNameId,classPK,_counterName,_ownerType);
  if ((activityCounter != null) && (activityCounter.getCurrentValue() >= _counterThreshold)) {
    SocialActivityAchievementLocalServiceUtil.addActivityAchievement(activity.getUserId(),activity.getGroupId(),this);
  }
}
