{
  if (PropsValues.SESSION_DISABLED) {
    return;
  }
  PortalSessionContext.remove(ses.getId());
  HttpSession ses=event.getSession();
  try {
    Long userIdObj=(Long)ses.getAttribute(WebKeys.USER_ID);
    if (userIdObj == null) {
      _log.warn("User id is not in the session");
    }
    if (userIdObj == null) {
      return;
    }
    long userId=userIdObj.longValue();
    if (CompanyThreadLocal.getCompanyId() == 0) {
      setCompanyId(userId);
    }
    MailSessionLock.cleanUp(ses);
    LiveUsers.signOut(ses.getId(),userId);
  }
 catch (  IllegalStateException ise) {
    _log.warn("Please upgrade to a servlet 2.4 compliant container");
  }
catch (  Exception e) {
    _log.error(e,e);
  }
  ses.removeAttribute(WebKeys.PORTLET_SESSION_TRACKER);
  ses.removeAttribute(WebKeys.REVERSE_AJAX);
  MessagingUtil.closeXMPPConnection(ses);
  try {
    EventsProcessor.process(PropsUtil.getArray(PropsUtil.SERVLET_SESSION_DESTROY_EVENTS),ses);
  }
 catch (  ActionException ae) {
    _log.error(ae,ae);
  }
}
