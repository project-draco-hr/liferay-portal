{
  if (_log.isInfoEnabled()) {
    _log.info("Checking journal content search for " + companyId);
  }
  List layouts=new ArrayList();
  List groups=groupLocalService.search(companyId,null,null,null,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  for (int i=0; i < groups.size(); i++) {
    Group group=(Group)groups.get(i);
    deleteOwnerContentSearches(group.getGroupId(),true);
    layouts.addAll(layoutLocalService.getLayouts(group.getGroupId(),true));
    deleteOwnerContentSearches(group.getGroupId(),false);
    layouts.addAll(layoutLocalService.getLayouts(group.getGroupId(),false));
  }
  for (int i=0; i < layouts.size(); i++) {
    Layout layout=(Layout)layouts.get(i);
    LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
    List portletIds=layoutTypePortlet.getPortletIds();
    for (int j=0; j < portletIds.size(); j++) {
      String portletId=(String)portletIds.get(j);
      String rootPortletId=PortletImpl.getRootPortletId(portletId);
      if (rootPortletId.equals(PortletKeys.JOURNAL_CONTENT)) {
        PortletPreferences prefs=portletPreferencesLocalService.getPreferences(layout.getCompanyId(),PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,layout.getPlid(),portletId);
        String articleId=prefs.getValue("article-id",StringPool.BLANK);
        if (Validator.isNotNull(articleId)) {
          updateContentSearch(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId(),portletId,articleId);
        }
      }
    }
  }
}
