{
  JournalContentFeed journalContentFeed=(JournalContentFeed)contentFeed;
  JournalFeed feed=journalContentFeed.getFeed();
  try {
    long userId=feed.getUserId();
    String feedId=feed.getFeedId();
    long groupId=feed.getGroupId();
    String name=feed.getName();
    String description=feed.getDescription();
    String structureId=feed.getStructureId();
    String targetLayoutFriendlyUrl=feed.getTargetLayoutFriendlyUrl();
    String contentField=feed.getContentField();
    String uuid=feed.getUuid();
    String type=feed.getType();
    String templateId=feed.getTemplateId();
    String rendererTemplateId=feed.getRendererTemplateId();
    int delta=feed.getDelta();
    String orderByCol=feed.getOrderByCol();
    String orderByType=feed.getOrderByType();
    String targetPortletId=feed.getTargetPortletId();
    String feedType=feed.getFeedType();
    double feedVersion=feed.getFeedVersion();
    User user=userPersistence.findByPrimaryKey(userId);
    feedId=feedId.trim().toUpperCase();
    Date now=new Date();
    boolean autoFeedId=journalContentFeed.getCreationAttributes().isAutoCreateId();
    validate(user.getCompanyId(),groupId,feedId,autoFeedId,name,description,structureId,targetLayoutFriendlyUrl,contentField);
    if (autoFeedId) {
      feedId=String.valueOf(counterLocalService.increment());
    }
    long id=counterLocalService.increment();
    JournalFeed newFeed=journalFeedPersistence.create(id);
    newFeed.setUuid(uuid);
    newFeed.setGroupId(groupId);
    newFeed.setCompanyId(user.getCompanyId());
    newFeed.setUserId(user.getUserId());
    newFeed.setUserName(user.getFullName());
    newFeed.setCreateDate(now);
    newFeed.setModifiedDate(now);
    newFeed.setFeedId(feedId);
    newFeed.setName(name);
    newFeed.setDescription(description);
    newFeed.setType(type);
    newFeed.setStructureId(structureId);
    newFeed.setTemplateId(templateId);
    newFeed.setRendererTemplateId(rendererTemplateId);
    newFeed.setDelta(delta);
    newFeed.setOrderByCol(orderByCol);
    newFeed.setOrderByType(orderByType);
    newFeed.setTargetLayoutFriendlyUrl(targetLayoutFriendlyUrl);
    newFeed.setTargetPortletId(targetPortletId);
    newFeed.setContentField(contentField);
    if (Validator.isNull(feedType)) {
      newFeed.setFeedType(RSSUtil.DEFAULT_TYPE);
      newFeed.setFeedVersion(RSSUtil.DEFAULT_VERSION);
    }
 else {
      newFeed.setFeedType(feedType);
      newFeed.setFeedVersion(feedVersion);
    }
    journalFeedPersistence.update(newFeed,false);
    journalContentFeed.setFeed(newFeed);
  }
 catch (  PortalException pe) {
    _log.error(pe.getMessage(),pe);
    throw new CMSException(pe.getMessage(),pe);
  }
catch (  SystemException se) {
    _log.error(se.getMessage(),se);
    throw new CMSException(se.getMessage(),se);
  }
}
