{
  long fileEntryId=ParamUtil.getLong(request,"fileEntryId");
  FileEntry fileEntry=null;
  if (fileEntryId > 0) {
    fileEntry=DLAppServiceUtil.getFileEntry(fileEntryId);
  }
  request.setAttribute(WebKeys.DOCUMENT_LIBRARY_FILE_ENTRY,fileEntry);
  String version=ParamUtil.getString(request,"version");
  if (fileEntry != null) {
    if (Validator.isNotNull(version)) {
      FileVersion fileVersion=fileEntry.getFileVersion(version);
      request.setAttribute(WebKeys.DOCUMENT_LIBRARY_FILE_VERSION,fileVersion);
      RawMetadataProcessor.generateMetadata(fileVersion);
    }
 else {
      RawMetadataProcessor.generateMetadata(fileEntry.getFileVersion());
    }
  }
}
