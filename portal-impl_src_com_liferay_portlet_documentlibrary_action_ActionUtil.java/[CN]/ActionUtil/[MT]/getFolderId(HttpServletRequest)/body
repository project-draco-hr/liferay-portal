{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  String portletId=portletDisplay.getId();
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.getPortletPreferences(request,portletId);
  long folderId=ParamUtil.getLong(request,"folderId");
  if (folderId <= 0) {
    String defaultParentFolderId=String.valueOf(DLFolderConstants.DEFAULT_PARENT_FOLDER_ID);
    folderId=GetterUtil.getLong(portletPreferences.getValue("rootFolderId",defaultParentFolderId));
  }
  return folderId;
}
