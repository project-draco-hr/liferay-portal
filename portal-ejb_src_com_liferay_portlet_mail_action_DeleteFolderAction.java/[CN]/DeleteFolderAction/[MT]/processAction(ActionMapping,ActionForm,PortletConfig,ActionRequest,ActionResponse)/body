{
  try {
    PortletPreferences prefs=req.getPreferences();
    String folderName=req.getParameter("folder_name");
    if (Validator.isNotNull(folderName)) {
      List list=ListUtil.fromArray(prefs.getValues("folder-names",new String[0]));
      list.remove(folderName);
      Collections.sort(list,new StringComparator());
      prefs.setValues("folder-names",(String[])list.toArray(new String[0]));
      MailUtil.removeFolder(req,folderName);
    }
    prefs.store();
    SessionMessages.add(req,DeleteFolderAction.class.getName());
    res.sendRedirect(ParamUtil.getString(req,"redirect"));
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    setForward(req,Constants.COMMON_ERROR);
  }
}
