{
  try {
    String namespace=GetterUtil.getString(get(TemplateConstants.NAMESPACE));
    if (Validator.isNull(namespace)) {
      throw new TemplateException("No namespace specified.");
    }
    SoyFileSet soyFileSet=getSoyFileSet(templateResources);
    SoyTofu soyTofu=soyFileSet.compileToTofu();
    Renderer renderer=soyTofu.newRenderer(namespace);
    renderer.setData(getSoyMapData());
    Locale locale=(Locale)get("locale");
    if (locale != null) {
      SoyMsgBundle soyMsgBundle=soyFileSet.extractMsgs();
      ResourceBundle languageResourceBundle=_getLanguageResourceBundle(locale);
      SoyMsgBundleBridge soyMsgBundleBridge=new SoyMsgBundleBridge(soyMsgBundle,locale,languageResourceBundle);
      renderer.setMsgBundle(soyMsgBundleBridge);
    }
    boolean renderStrict=GetterUtil.getBoolean(get(TemplateConstants.RENDER_STRICT),true);
    if (renderStrict) {
      SanitizedContent sanitizedContent=renderer.renderStrict();
      writer.write(sanitizedContent.stringValue());
    }
 else {
      writer.write(renderer.render());
    }
  }
 catch (  PrivilegedActionException pae) {
    throw pae.getException();
  }
}
