{
  User user=userPersistence.findByPrimaryKey(userId);
  String name=titleMap.get(LocaleUtil.getSiteDefault());
  Date now=new Date();
  validate(groupId,name);
  long vocabularyId=counterLocalService.increment();
  AssetVocabulary vocabulary=assetVocabularyPersistence.create(vocabularyId);
  vocabulary.setUuid(serviceContext.getUuid());
  vocabulary.setGroupId(groupId);
  vocabulary.setCompanyId(user.getCompanyId());
  vocabulary.setUserId(user.getUserId());
  vocabulary.setUserName(user.getFullName());
  vocabulary.setCreateDate(now);
  vocabulary.setModifiedDate(now);
  vocabulary.setName(name);
  if (Validator.isNotNull(title)) {
    vocabulary.setTitle(title);
  }
 else {
    vocabulary.setTitleMap(titleMap);
  }
  vocabulary.setDescriptionMap(descriptionMap);
  vocabulary.setSettings(settings);
  assetVocabularyPersistence.update(vocabulary);
  if (serviceContext.isAddGroupPermissions() || serviceContext.isAddGuestPermissions()) {
    addVocabularyResources(vocabulary,serviceContext.isAddGroupPermissions(),serviceContext.isAddGuestPermissions());
  }
 else {
    addVocabularyResources(vocabulary,serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions());
  }
  return vocabulary;
}
