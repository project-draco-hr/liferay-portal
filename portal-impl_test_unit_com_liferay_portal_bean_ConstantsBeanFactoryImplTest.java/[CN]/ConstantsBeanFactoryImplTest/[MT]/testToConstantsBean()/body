{
  System.setProperty(FinalizeManager.class.getName() + ".thread.enabled",StringPool.FALSE);
  String jvmClassPath=ClassPathUtil.getJVMClassPath(true);
  URL[] urls=null;
  try {
    urls=ClassPathUtil.getClassPathURLs(jvmClassPath);
  }
 catch (  MalformedURLException murle) {
    throw new RuntimeException(murle);
  }
  ClassLoader classLoader1=new URLClassLoader(urls,null);
  Class<?> constantsClass1=classLoader1.loadClass(Constants.class.getName());
  ConstantsBeanFactoryImpl constantsBeanImpl=new ConstantsBeanFactoryImpl();
  Object constantsBean1=constantsBeanImpl.getConstantsBean(constantsClass1);
  Class<?> constantsBeanClass1=constantsBean1.getClass();
  Assert.assertSame(classLoader1,constantsBeanClass1.getClassLoader());
  Map<Class<?>,?> constantsBeans=ConstantsBeanFactoryImpl.constantsBeans;
  Assert.assertEquals(1,constantsBeans.size());
  Assert.assertSame(constantsBean1,constantsBeanImpl.getConstantsBean(constantsClass1));
  Assert.assertEquals(1,constantsBeans.size());
  ClassLoader classLoader2=new URLClassLoader(urls,null);
  Class<?> constantsClass2=classLoader2.loadClass(Constants.class.getName());
  Object constantsBean2=constantsBeanImpl.getConstantsBean(constantsClass2);
  Assert.assertNotSame(constantsBean1,constantsBean2);
  Assert.assertNotSame(constantsBeanClass1,constantsBean2.getClass());
  Assert.assertEquals(2,constantsBeans.size());
  Assert.assertSame(constantsBean2,constantsBeanImpl.getConstantsBean(constantsClass2));
  Assert.assertEquals(2,constantsBeans.size());
  classLoader1=null;
  constantsClass1=null;
  constantsBean1=null;
  constantsBeanClass1=null;
  GCUtil.gc();
  ReflectionTestUtil.invoke(FinalizeManager.class,"_pollingCleanup",new Class<?>[0]);
  Assert.assertSame(constantsBean2,constantsBeanImpl.getConstantsBean(constantsClass2));
  Assert.assertEquals(1,constantsBeans.size());
  constantsBean2=null;
  GCUtil.gc();
  ReflectionTestUtil.invoke(FinalizeManager.class,"_pollingCleanup",new Class<?>[0]);
  Assert.assertTrue(constantsBeans.isEmpty());
}
