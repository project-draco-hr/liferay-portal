{
  if (!accessControlled.hostAllowedValidationEnabled()) {
    return;
  }
  AccessControlContext accessControlContext=AccessControlUtil.getAccessControlContext();
  if (accessControlContext == null) {
    return;
  }
  Map<String,Object> settings=accessControlContext.getSettings();
  int serviceDepthCounter=(Integer)settings.get(AccessControlContext.Settings.SERVICE_DEPTH_COUNTER.toString());
  if (serviceDepthCounter > 1) {
    return;
  }
  HttpServletRequest request=accessControlContext.getRequest();
  String hostsAllowedString=MapUtil.getString(accessControlContext.getSettings(),"hosts.allowed");
  String[] hostsAllowed=StringUtil.split(hostsAllowedString);
  Set<String> hostsAllowedSet=SetUtil.fromArray(hostsAllowed);
  if (!AccessControlUtil.isAccessAllowed(request,hostsAllowedSet)) {
    throw new SecurityException("Access denied for " + request.getRemoteAddr());
  }
}
