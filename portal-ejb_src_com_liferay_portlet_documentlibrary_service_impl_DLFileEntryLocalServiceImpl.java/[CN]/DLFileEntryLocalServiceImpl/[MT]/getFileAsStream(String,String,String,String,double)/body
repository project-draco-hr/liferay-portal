{
  if (Validator.isNotNull(userId)) {
    DLFolder folder=DLFolderUtil.findByPrimaryKey(folderId);
    DLFileRankLocalServiceUtil.updateFileRank(folder.getGroupId(),companyId,userId,folderId,name);
  }
  DLFileEntryPK pk=new DLFileEntryPK(folderId,name);
  DLFileEntry fileEntry=DLFileEntryUtil.findByPrimaryKey(pk);
  fileEntry.setReadCount(fileEntry.getReadCount() + 1);
  DLFileEntryUtil.update(fileEntry);
  if (version > 0 && (fileEntry.getVersion() != version)) {
    return DLLocalServiceUtil.getFileAsStream(companyId,folderId,name,version);
  }
 else {
    return DLLocalServiceUtil.getFileAsStream(companyId,folderId,name);
  }
}
