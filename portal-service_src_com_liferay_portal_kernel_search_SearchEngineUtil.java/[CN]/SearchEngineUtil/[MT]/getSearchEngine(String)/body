{
  PortalRuntimePermission.checkSearchEngine(searchEngineId);
  SearchEngine searchEngine=_searchEngines.get(searchEngineId);
  if (searchEngine == null) {
    if (SYSTEM_ENGINE_ID.equals(searchEngineId)) {
      waitForSystemSearchEngine();
      searchEngine=_searchEngines.get(SYSTEM_ENGINE_ID);
      if (searchEngine == null) {
        throw new IllegalStateException("Unable to find search engine " + SYSTEM_ENGINE_ID);
      }
      return searchEngine;
    }
    if (getDefaultSearchEngineId().equals(searchEngineId)) {
      throw new IllegalStateException("There is no default search engine configured with ID " + getDefaultSearchEngineId());
    }
    if (_log.isWarnEnabled()) {
      _log.warn("There is no search engine configured with ID " + searchEngineId);
    }
  }
  return searchEngine;
}
