{
  PluginPackage pluginPackage=_readPluginPackage(srcFile);
  System.out.println("\nDeploying " + srcFile.getName());
  String deployDir=null;
  String displayName=null;
  boolean overwrite=false;
  String preliminaryContext=null;
  if (srcFile.getName().startsWith(Constants.DEPLOY_TO_PREFIX)) {
    displayName=srcFile.getName().substring(Constants.DEPLOY_TO_PREFIX.length(),srcFile.getName().length() - 4);
    overwrite=true;
    preliminaryContext=displayName;
  }
  if (preliminaryContext == null) {
    preliminaryContext=getDisplayName(srcFile);
  }
  if (pluginPackage != null) {
    if (!PluginPackageUtil.isCurrentVersionSupported(pluginPackage.getLiferayVersions())) {
      throw new AutoDeployException(srcFile.getName() + " does not support this version of Liferay");
    }
    if (displayName == null) {
      displayName=pluginPackage.getRecommendedDeploymentContext();
    }
    if (Validator.isNull(displayName)) {
      displayName=getDisplayName(srcFile);
    }
    pluginPackage.setContext(displayName);
    PluginPackageUtil.updateInstallingPluginPackage(preliminaryContext,pluginPackage);
  }
  if (Validator.isNotNull(displayName)) {
    deployDir=displayName + ".war";
  }
 else {
    deployDir=srcFile.getName();
    displayName=getDisplayName(srcFile);
  }
  if (appServerType.startsWith("jboss")) {
    deployDir=jbossPrefix + deployDir;
  }
 else   if (appServerType.equals("jetty") || appServerType.equals("oc4j") || appServerType.equals("orion")|| appServerType.equals("resin")|| appServerType.equals("tomcat")) {
    if (unpackWar) {
      deployDir=deployDir.substring(0,deployDir.length() - 4);
    }
  }
  deployDir=destDir + "/" + deployDir;
  File deployDirFile=new File(deployDir);
  try {
    PluginPackage previousPluginPackage=_readPluginPackage(deployDirFile);
    if (previousPluginPackage != null) {
      System.out.println("Updating " + pluginPackage.getName() + " from version "+ previousPluginPackage.getVersion()+ " to version "+ pluginPackage.getVersion());
      if (pluginPackage.isLaterVersionThan(previousPluginPackage)) {
        overwrite=true;
      }
    }
    if (srcFile.isDirectory()) {
      deployDirectory(srcFile,deployDirFile,displayName,overwrite);
    }
 else {
      boolean deployed=deployFile(srcFile,deployDirFile,displayName,overwrite);
      if (!deployed) {
        PluginPackageUtil.endPluginPackageInstallation(pluginPackage.getContext());
      }
    }
  }
 catch (  Exception e) {
    if (pluginPackage != null) {
      PluginPackageUtil.endPluginPackageInstallation(pluginPackage.getContext());
    }
    throw e;
  }
}
