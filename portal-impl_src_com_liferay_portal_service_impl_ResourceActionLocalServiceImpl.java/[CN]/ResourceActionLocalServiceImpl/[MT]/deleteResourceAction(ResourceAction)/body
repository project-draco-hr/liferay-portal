{
  _resourceActions.remove(encodeKey(resourceAction.getName(),resourceAction.getActionId()));
  List<ResourcePermission> resourcePermissions=resourcePermissionLocalService.getResourceResourcePermissions(resourceAction.getName());
  for (  ResourcePermission resourcePermission : resourcePermissions) {
    long actionIds=resourcePermission.getActionIds();
    if ((actionIds & resourceAction.getBitwiseValue()) != 0) {
      actionIds=actionIds ^ resourceAction.getBitwiseValue();
      resourcePermission.setActionIds(actionIds);
      resourcePermissionPersistence.update(resourcePermission);
    }
  }
  List<ResourceTypePermission> resourceTypePermissions=new ArrayList<>();
  List<ResourceBlockPermission> resourceBlockPermissions=new ArrayList<>();
  for (  Company company : companyLocalService.getCompanies()) {
    long companyId=company.getCompanyId();
    for (    Role role : roleLocalService.getRoles(companyId)) {
      resourceTypePermissions.addAll(resourceTypePermissionLocalService.getGroupScopeResourceTypePermissions(companyId,resourceAction.getName(),role.getRoleId()));
    }
    resourceBlockPermissions.addAll(resourceBlockPermissionLocalService.getResourceResourceBlockPermissions(companyId,resourceAction.getName()));
  }
  for (  ResourceTypePermission resourceTypePermission : resourceTypePermissions) {
    long actionIds=resourceTypePermission.getActionIds();
    if ((actionIds & resourceAction.getBitwiseValue()) != 0) {
      actionIds=actionIds ^ resourceAction.getBitwiseValue();
      resourceTypePermission.setActionIds(actionIds);
      resourceTypePermissionPersistence.update(resourceTypePermission);
    }
  }
  for (  ResourceBlockPermission resourceBlockPermission : resourceBlockPermissions) {
    long actionIds=resourceBlockPermission.getActionIds();
    if ((actionIds & resourceAction.getBitwiseValue()) != 0) {
      actionIds=actionIds ^ resourceAction.getBitwiseValue();
      resourceBlockPermission.setActionIds(actionIds);
      resourceBlockPermissionPersistence.update(resourceBlockPermission);
    }
  }
  return resourceActionPersistence.remove(resourceAction);
}
