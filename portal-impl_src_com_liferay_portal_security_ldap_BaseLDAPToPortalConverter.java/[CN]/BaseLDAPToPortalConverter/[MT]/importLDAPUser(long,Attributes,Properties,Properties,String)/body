{
  boolean autoPassword=false;
  boolean updatePassword=true;
  if (password.equals(StringPool.BLANK)) {
    autoPassword=true;
    updatePassword=false;
  }
  long creatorUserId=0;
  boolean passwordReset=false;
  boolean autoScreenName=false;
  String screenName=LDAPUtil.getAttributeValue(attributes,userMappings,UserConverterKeys.SCREEN_NAME).toLowerCase();
  String emailAddress=LDAPUtil.getAttributeValue(attributes,userMappings,UserConverterKeys.EMAIL_ADDRESS);
  String openId=StringPool.BLANK;
  Locale locale=LocaleUtil.getDefault();
  String firstName=LDAPUtil.getAttributeValue(attributes,userMappings,UserConverterKeys.FIRST_NAME);
  String middleName=LDAPUtil.getAttributeValue(attributes,userMappings,UserConverterKeys.MIDDLE_NAME);
  String lastName=LDAPUtil.getAttributeValue(attributes,userMappings,UserConverterKeys.LAST_NAME);
  if (Validator.isNull(firstName) || Validator.isNull(lastName)) {
    String fullName=LDAPUtil.getAttributeValue(attributes,userMappings,UserConverterKeys.FULL_NAME);
    String[] names=LDAPUtil.splitFullName(fullName);
    firstName=names[0];
    middleName=names[1];
    lastName=names[2];
  }
  int prefixId=0;
  int suffixId=0;
  boolean male=true;
  int birthdayMonth=Calendar.JANUARY;
  int birthdayDay=1;
  int birthdayYear=1970;
  String jobTitle=LDAPUtil.getAttributeValue(attributes,userMappings,UserConverterKeys.JOB_TITLE);
  long[] groupIds=null;
  long[] organizationIds=null;
  long[] roleIds=null;
  List<UserGroupRole> userGroupRoles=null;
  long[] userGroupIds=null;
  boolean sendEmail=false;
  ServiceContext serviceContext=new ServiceContext();
  if (_log.isDebugEnabled()) {
    _log.debug("Screen name " + screenName + " and email address "+ emailAddress);
  }
  if (Validator.isNull(screenName) || Validator.isNull(emailAddress)) {
    if (_log.isWarnEnabled()) {
      _log.warn("Cannot add user because screen name and email address " + "are required");
    }
    return null;
  }
  User user=new UserImpl();
  user.setCompanyId(companyId);
  user.setEmailAddress(emailAddress);
  user.setFirstName(firstName);
  user.setJobTitle(jobTitle);
  user.setLanguageId(locale.getLanguage());
  user.setLastName(lastName);
  user.setMiddleName(middleName);
  user.setOpenId(openId);
  user.setPasswordUnencrypted(password);
  user.setScreenName(screenName);
  Contact contact=new ContactImpl();
  contact.setBirthday(CalendarFactoryUtil.getCalendar(birthdayYear,birthdayMonth,birthdayDay).getTime());
  contact.setMale(male);
  contact.setPrefixId(prefixId);
  contact.setSuffixId(suffixId);
  LDAPUser ldapUser=new LDAPUser();
  ldapUser.setAutoPassword(autoPassword);
  ldapUser.setAutoScreenName(autoScreenName);
  ldapUser.setContact(contact);
  ldapUser.setCreatorUserId(creatorUserId);
  ldapUser.setGroupIds(groupIds);
  ldapUser.setOrganizationIds(organizationIds);
  ldapUser.setPasswordReset(passwordReset);
  ldapUser.setRoleIds(roleIds);
  ldapUser.setSendEmail(sendEmail);
  ldapUser.setServiceContext(serviceContext);
  ldapUser.setUpdatePassword(updatePassword);
  ldapUser.setUser(user);
  ldapUser.setUserGroupIds(userGroupIds);
  ldapUser.setUserGroupRoles(userGroupRoles);
  return ldapUser;
}
