{
  NpmModule npmModule=getNpmModule(npmJSONResource.openInputStream());
  String bundleVersion=analyzer.getBundleVersion();
  if (bundleVersion == null) {
    Version version=null;
    try {
      version=new Version(npmModule.version);
    }
 catch (    IllegalArgumentException iae) {
      String sanitizedQualifier=npmModule.version.replaceAll("[^-_\\da-zA-Z]","");
      version=new Version("0.0.0." + sanitizedQualifier);
    }
    analyzer.setBundleVersion(version.toString());
  }
  Parameters parameters=new Parameters();
  Attrs attrs=new Attrs();
  String npmName=npmModule.name;
  String webContextPath=analyzer.getProperty(WEB_CONTEXT_PATH);
  if ((webContextPath == null) && (npmName != null)) {
    if (npmName.indexOf('/') == 0) {
      npmName=npmName.substring(1);
    }
    analyzer.setProperty(WEB_CONTEXT_PATH,'/' + npmName + "-"+ analyzer.getBundleVersion());
  }
  attrs.put(_OSGI_WEBRESOURCE,npmName);
  attrs.put(Constants.VERSION_ATTRIBUTE + ":Version",analyzer.getBundleVersion());
  parameters.add(_OSGI_WEBRESOURCE,attrs);
  setCapabilities(analyzer,Constants.PROVIDE_CAPABILITY,parameters);
  return npmModule;
}
