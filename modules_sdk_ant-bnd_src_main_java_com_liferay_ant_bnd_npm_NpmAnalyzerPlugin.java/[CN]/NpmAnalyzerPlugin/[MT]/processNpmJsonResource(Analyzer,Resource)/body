{
  NpmModule npmModule=getNpmModule(npmJSONResource.openInputStream());
  String bundleVersion=analyzer.getBundleVersion();
  if (bundleVersion == null) {
    Version version=null;
    try {
      version=new Version(npmModule.version);
    }
 catch (    IllegalArgumentException iae) {
      String sanitizedQualifier=npmModule.version.replaceAll("[^-_\\da-zA-Z]","");
      version=new Version("0.0.0." + sanitizedQualifier);
    }
    analyzer.setBundleVersion(version.toString());
  }
  Parameters parameters=new Parameters(){
    @Override public void mergeWith(    Parameters parameters,    boolean override){
      for (      Map.Entry<String,Attrs> entry : parameters.entrySet()) {
        Attrs existingAttrs=get(entry.getKey());
        if (existingAttrs == null) {
          Attrs tempAttrs=new Attrs();
          tempAttrs.put("____ignore____:Version","0.0.0");
          tempAttrs.remove("____ignore____");
          tempAttrs.putAll(entry.getValue());
          put(entry.getKey(),tempAttrs);
        }
 else {
          existingAttrs.mergeWith(entry.getValue(),override);
        }
      }
    }
  }
;
  Attrs attrs=new Attrs();
  String npmName=npmModule.name;
  String webContextPath=analyzer.getProperty(WEB_CONTEXT_PATH);
  if ((webContextPath == null) && (npmName != null)) {
    if (npmName.indexOf('/') == 0) {
      npmName=npmName.substring(1);
    }
    analyzer.setProperty(WEB_CONTEXT_PATH,'/' + npmName + "-"+ analyzer.getBundleVersion());
  }
  attrs.put(_OSGI_WEBRESOURCE,npmName);
  attrs.put(Constants.VERSION_ATTRIBUTE + ":Version",analyzer.getBundleVersion());
  parameters.add(_OSGI_WEBRESOURCE,attrs);
  setCapabilities(analyzer,Constants.PROVIDE_CAPABILITY,parameters);
  return npmModule;
}
