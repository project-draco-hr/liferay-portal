{
  Class<?> implClass=clazz;
  String className=clazz.getName();
  if (!className.endsWith("Impl")) {
    if (classLoader == null) {
      classLoader=ClassLoaderUtil.getContextClassLoader();
    }
    String implClassName;
    if (!clazz.isAnnotationPresent(ImplementationPath.class)) {
      _log.error("Unable find model " + className + " no ImplementationPath annotation found");
      return implClass;
    }
    ImplementationPath ip=clazz.getAnnotation(ImplementationPath.class);
    implClassName=ip.implementationPath();
    try {
      implClass=getImplClass(implClassName,classLoader);
    }
 catch (    Exception e1) {
      if (classLoader != _portalClassLoader) {
        try {
          implClass=getImplClass(implClassName,_portalClassLoader);
        }
 catch (        Exception e2) {
          _log.error("Unable find model " + implClassName,e2);
        }
      }
 else {
        _log.error("Unable find model " + implClassName,e1);
      }
    }
  }
  PortalRuntimePermission.checkDynamicQuery(implClass);
  return implClass;
}
