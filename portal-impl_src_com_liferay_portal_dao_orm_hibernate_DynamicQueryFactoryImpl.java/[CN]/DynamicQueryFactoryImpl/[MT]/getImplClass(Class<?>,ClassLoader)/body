{
  Class<?> implClass=clazz;
  String className=clazz.getName();
  if (className.endsWith("Impl")) {
    return implClass;
  }
  if (classLoader == null) {
    Thread currentThread=Thread.currentThread();
    classLoader=currentThread.getContextClassLoader();
  }
  Package pkg=clazz.getPackage();
  String implClassName=pkg.getName() + ".impl." + clazz.getSimpleName()+ "Impl";
  try {
    implClass=getImplClass(implClassName,classLoader);
  }
 catch (  Exception e1) {
    if (classLoader != _portalClassLoader) {
      try {
        implClass=getImplClass(implClassName,_portalClassLoader);
      }
 catch (      Exception e2) {
        _log.error("Unable find model " + implClassName,e2);
      }
    }
 else {
      _log.error("Unable find model " + implClassName,e1);
    }
  }
  SecurityManager sm=System.getSecurityManager();
  if (sm != null) {
    sm.checkPermission(new PortalServicePermission("hasDynamicQuery",classLoader,implClass));
  }
  return implClass;
}
