{
  Class<?> implClass=clazz;
  String className=clazz.getName();
  if (!className.endsWith("Impl")) {
    if (classLoader == null) {
      classLoader=PACLClassLoaderUtil.getContextClassLoader();
    }
    Package pkg=clazz.getPackage();
    String implClassName=pkg.getName() + ".impl." + clazz.getSimpleName()+ "Impl";
    try {
      implClass=getImplClass(implClassName,classLoader);
    }
 catch (    Exception e1) {
      if (classLoader != _portalClassLoader) {
        try {
          implClass=getImplClass(implClassName,_portalClassLoader);
        }
 catch (        Exception e2) {
          _log.error("Unable find model " + implClassName,e2);
        }
      }
 else {
        _log.error("Unable find model " + implClassName,e1);
      }
    }
  }
  SecurityManager securityManager=System.getSecurityManager();
  if (securityManager != null) {
    Permission permission=new PortalServicePermission(PACLConstants.PORTAL_SERVICE_PERMISSION_DYNAMIC_QUERY,implClass,null);
    securityManager.checkPermission(permission);
  }
  return implClass;
}
