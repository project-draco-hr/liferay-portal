{
  ImplementationClassName implementationClassName=clazz.getAnnotation(ImplementationClassName.class);
  if (implementationClassName == null) {
    String className=clazz.getName();
    if (!className.endsWith("Impl")) {
      _log.error("Unable find model for " + clazz);
    }
    PortalRuntimePermission.checkDynamicQuery(clazz);
    return clazz;
  }
  Class<?> implClass=clazz;
  String implClassName=implementationClassName.value();
  try {
    implClass=getImplClass(implClassName,classLoader);
  }
 catch (  Exception e1) {
    if (classLoader != _portalClassLoader) {
      try {
        implClass=getImplClass(implClassName,_portalClassLoader);
      }
 catch (      Exception e2) {
        _log.error("Unable find model " + implClassName,e2);
      }
    }
 else {
      _log.error("Unable find model " + implClassName,e1);
    }
  }
  PortalRuntimePermission.checkDynamicQuery(implClass);
  return implClass;
}
