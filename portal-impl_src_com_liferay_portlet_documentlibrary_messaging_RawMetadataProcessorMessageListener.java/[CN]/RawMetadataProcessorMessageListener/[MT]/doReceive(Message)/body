{
  DLFileEntry dlFileEntry=(DLFileEntry)message.getPayload();
  DLFileVersion dlFileVersion=dlFileEntry.getLatestFileVersion();
  InputStream inputStream=DLFileEntryLocalServiceUtil.getFileAsStream(dlFileEntry.getUserId(),dlFileEntry.getFileEntryId(),dlFileEntry.getVersion());
  Map<String,Fields> rawMetadataMap=RawMetadataProcessorUtil.getRawMetadataMap(inputStream);
  List<DDMStructure> ddmStructures=DDMStructureLocalServiceUtil.getClassStructures(PortalUtil.getClassNameId(DLFileEntry.class),QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setScopeGroupId(dlFileEntry.getGroupId());
  serviceContext.setUserId(dlFileEntry.getUserId());
  DLFileEntryMetadataLocalServiceUtil.updateFileEntryMetadata(dlFileEntry.getCompanyId(),ddmStructures,0L,dlFileEntry.getFileEntryId(),dlFileVersion.getFileVersionId(),rawMetadataMap,serviceContext);
}
