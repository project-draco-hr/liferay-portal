{
  String servletPackageName=ctxt.getServletPackageName();
  String servletClassName=ctxt.getServletClassName();
  String serviceMethodName=Constants.SERVICE_METHOD_NAME;
  genPreamblePackage(servletPackageName);
  genPreambleImports();
  out.printin("public final class ");
  out.print(servletClassName);
  out.print(" extends ");
  out.println(pageInfo.getExtends());
  out.printin("    implements org.apache.jasper.runtime.JspSourceDependent");
  if (!pageInfo.isThreadSafe()) {
    out.println(",");
    out.printin("                 SingleThreadModel");
  }
  out.println(" {");
  out.pushIndent();
  generateDeclarations(page);
  genPreambleStaticInitializers();
  genPreambleClassVariableDeclarations(servletClassName);
  genPreambleMethods();
  out.printin("public void ");
  out.print(serviceMethodName);
  out.println("(HttpServletRequest request, HttpServletResponse response)");
  out.println("        throws java.io.IOException, ServletException {");
  out.pushIndent();
  out.println();
  out.printil("PageContext pageContext = null;");
  if (pageInfo.isSession())   out.printil("HttpSession session = null;");
  if (pageInfo.isErrorPage()) {
    out.printil("Throwable exception = org.apache.jasper.runtime.JspRuntimeLibrary.getThrowable(request);");
    out.printil("if (exception != null) {");
    out.pushIndent();
    out.printil("response.setStatus((Integer)request.getAttribute(\"javax.servlet.error.status_code\"));");
    out.popIndent();
    out.printil("}");
  }
  out.printil("ServletContext application = null;");
  out.printil("ServletConfig config = null;");
  out.printil("JspWriter out = null;");
  out.printil("Object page = this;");
  out.printil("JspWriter _jspx_out = null;");
  out.printil("PageContext _jspx_page_context = null;");
  out.println();
  out.printil("try {");
  out.pushIndent();
  out.printin("response.setContentType(");
  out.print(quote(pageInfo.getContentType()));
  out.println(");");
  if (ctxt.getOptions().isXpoweredBy()) {
    out.printil("response.setHeader(\"X-Powered-By\", \"JSP/2.1\");");
  }
  out.printil("pageContext = _jspxFactory.getPageContext(this, request, response,");
  out.printin("\t\t\t");
  out.print(quote(pageInfo.getErrorPage()));
  out.print(", " + pageInfo.isSession());
  out.print(", " + pageInfo.getBuffer());
  out.print(", " + pageInfo.isAutoFlush());
  out.println(");");
  out.printil("_jspx_page_context = pageContext;");
  out.printil("application = pageContext.getServletContext();");
  out.printil("config = pageContext.getServletConfig();");
  if (pageInfo.isSession())   out.printil("session = pageContext.getSession();");
  out.printil("out = pageContext.getOut();");
  out.printil("_jspx_out = out;");
  out.printil("_jspx_resourceInjector = (org.glassfish.jsp.api.ResourceInjector) application.getAttribute(\"com.sun.appserv.jsp.resource.injector\");");
  out.println();
}
