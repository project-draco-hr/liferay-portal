{
class TagHandlerPoolVisitor extends Node.Visitor {
    private Vector names;
    TagHandlerPoolVisitor(    Vector v){
      names=v;
    }
    public void visit(    Node.CustomTag n) throws JasperException {
      if (!n.implementsSimpleTag()) {
        String name=createTagHandlerPoolName(n.getPrefix(),n.getLocalName(),n.getAttributes(),n.hasEmptyBody());
        n.setTagHandlerPoolName(name);
        if (!names.contains(name)) {
          names.add(name);
        }
      }
      visitBody(n);
    }
    private String createTagHandlerPoolName(    String prefix,    String shortName,    Attributes attrs,    boolean hasEmptyBody){
      String poolName=null;
      poolName="_jspx_tagPool_" + prefix + "_"+ shortName;
      if (attrs != null) {
        String[] attrNames=new String[attrs.getLength()];
        for (int i=0; i < attrNames.length; i++) {
          attrNames[i]=attrs.getQName(i);
        }
        Arrays.sort(attrNames,Collections.reverseOrder());
        for (int i=0; i < attrNames.length; i++) {
          poolName=poolName + "_" + attrNames[i];
        }
      }
      if (hasEmptyBody) {
        poolName=poolName + "_nobody";
      }
      return JspUtil.makeXmlJavaIdentifier(poolName);
    }
  }
  page.visit(new TagHandlerPoolVisitor(tagHandlerPoolNames));
}
