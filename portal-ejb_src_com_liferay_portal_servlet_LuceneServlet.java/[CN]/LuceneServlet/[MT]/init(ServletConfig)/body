{
synchronized (LuceneServlet.class) {
    super.init(sc);
    ServletContext ctx=getServletContext();
    _companyId=ctx.getInitParameter("company_id");
    if (GetterUtil.getBoolean(PropsUtil.get(PropsUtil.INDEX_ON_STARTUP))) {
      _indexer=new LuceneIndexer(_companyId);
      if (GetterUtil.getBoolean(PropsUtil.get(PropsUtil.INDEX_WITH_THREAD)) || ServerDetector.isOrion()) {
        _indexerThread=new Thread(_indexer,THREAD_NAME + "." + _companyId);
        _indexerThread.setPriority(THREAD_PRIORITY);
        _indexerThread.start();
      }
 else {
        _indexer.reIndex();
      }
    }
 else {
      Directory luceneDir=LuceneUtil.getLuceneDir(_companyId);
      IndexWriter writer=null;
      try {
        writer=new IndexWriter(luceneDir,LuceneUtil.getAnalyzer(),false);
      }
 catch (      IOException ioe1) {
        try {
          luceneDir.close();
          luceneDir=LuceneUtil.getLuceneDir(_companyId);
          writer=new IndexWriter(luceneDir,LuceneUtil.getAnalyzer(),true);
        }
 catch (        IOException ioe2) {
          ioe2.printStackTrace();
        }
      }
 finally {
        try {
          writer.close();
        }
 catch (        IOException e) {
          e.printStackTrace();
        }
      }
    }
  }
}
