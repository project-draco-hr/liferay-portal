{
  long userId=portletDataContext.getUserId(organization.getUserUuid());
  Map<Long,Long> organizationIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(Organization.class);
  long parentOrganizationId=MapUtil.getLong(organizationIds,organization.getParentOrganizationId(),organization.getParentOrganizationId());
  if ((parentOrganizationId != OrganizationConstants.DEFAULT_PARENT_ORGANIZATION_ID) && (parentOrganizationId == organization.getParentOrganizationId())) {
    String parentOrganizationPath=ExportImportPathUtil.getModelPath(portletDataContext,Organization.class.getName(),parentOrganizationId);
    Organization parentOrganization=(Organization)portletDataContext.getZipEntryAsObject(parentOrganizationPath);
    StagedModelDataHandlerUtil.importStagedModel(portletDataContext,parentOrganization);
    parentOrganizationId=MapUtil.getLong(organizationIds,organization.getParentOrganizationId(),organization.getParentOrganizationId());
  }
  ServiceContext serviceContext=portletDataContext.createServiceContext(organization,UsersAdminPortletDataHandler.NAMESPACE);
  serviceContext.setUserId(userId);
  Organization existingOrganization=OrganizationLocalServiceUtil.fetchOrganizationByUuidAndCompanyId(organization.getUuid(),portletDataContext.getCompanyId());
  if (existingOrganization == null) {
    existingOrganization=OrganizationLocalServiceUtil.fetchOrganization(portletDataContext.getCompanyId(),organization.getName());
  }
  Organization importedOrganization=null;
  if (existingOrganization == null) {
    serviceContext.setUuid(organization.getUuid());
    importedOrganization=OrganizationLocalServiceUtil.addOrganization(userId,parentOrganizationId,organization.getName(),organization.getType(),organization.getRegionId(),organization.getCountryId(),organization.getStatusId(),organization.getComments(),false,serviceContext);
  }
 else {
    importedOrganization=OrganizationLocalServiceUtil.updateOrganization(portletDataContext.getCompanyId(),existingOrganization.getOrganizationId(),parentOrganizationId,organization.getName(),organization.getType(),organization.getRegionId(),organization.getCountryId(),organization.getStatusId(),organization.getComments(),false,serviceContext);
  }
  long importedOrganizationId=importedOrganization.getOrganizationId();
  List<Address> addresses=importAddresses(portletDataContext,organization);
  List<EmailAddress> emailAddresses=importEmailAddresses(portletDataContext,organization);
  List<OrgLabor> orgLabors=importOrgLabors(portletDataContext,organization);
  List<Phone> phones=importPhones(portletDataContext,organization);
  List<Website> websites=importWebsites(portletDataContext,organization);
  UsersAdminUtil.updateAddresses(Organization.class.getName(),importedOrganizationId,addresses);
  UsersAdminUtil.updateEmailAddresses(Organization.class.getName(),importedOrganizationId,emailAddresses);
  UsersAdminUtil.updateOrgLabors(importedOrganizationId,orgLabors);
  UsersAdminUtil.updatePhones(Organization.class.getName(),importedOrganizationId,phones);
  UsersAdminUtil.updateWebsites(Organization.class.getName(),importedOrganizationId,websites);
  portletDataContext.importClassedModel(organization,importedOrganization,UsersAdminPortletDataHandler.NAMESPACE);
}
