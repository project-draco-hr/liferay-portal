{
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  articleId=StringUtil.toUpperCase(GetterUtil.getString(articleId));
  ddmTemplateKey=StringUtil.toUpperCase(GetterUtil.getString(ddmTemplateKey));
  long layoutSetId=0;
  boolean secure=false;
  if (themeDisplay != null) {
    try {
      Layout layout=themeDisplay.getLayout();
      LayoutSet layoutSet=layout.getLayoutSet();
      layoutSetId=layoutSet.getLayoutSetId();
    }
 catch (    Exception e) {
    }
    secure=themeDisplay.isSecure();
  }
  String key=encodeKey(groupId,articleId,version,ddmTemplateKey,layoutSetId,viewMode,languageId,page,secure);
  JournalArticleDisplay articleDisplay=portalCache.get(key);
  boolean lifecycleRender=isLifecycleRender(themeDisplay,xmlRequest);
  if ((articleDisplay == null) || !lifecycleRender) {
    articleDisplay=getArticleDisplay(groupId,articleId,ddmTemplateKey,viewMode,languageId,page,xmlRequest,themeDisplay);
    if ((articleDisplay != null) && articleDisplay.isCacheable() && lifecycleRender) {
      portalCache.put(key,articleDisplay);
    }
  }
  try {
    if ((articleDisplay != null) && (themeDisplay != null) && !JournalArticlePermission.contains(themeDisplay.getPermissionChecker(),groupId,articleId,ActionKeys.VIEW)) {
      articleDisplay=null;
    }
  }
 catch (  Exception e) {
  }
  if (_log.isDebugEnabled()) {
    _log.debug("getDisplay for {" + groupId + ", "+ articleId+ ", "+ ddmTemplateKey+ ", "+ viewMode+ ", "+ languageId+ ", "+ page+ "} takes "+ stopWatch.getTime()+ " ms");
  }
  return articleDisplay;
}
