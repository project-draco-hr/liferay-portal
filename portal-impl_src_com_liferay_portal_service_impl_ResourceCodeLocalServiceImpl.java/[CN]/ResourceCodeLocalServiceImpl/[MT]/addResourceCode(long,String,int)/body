{
  long codeId=counterLocalService.increment(ResourceCode.class.getName());
  ResourceCode resourceCode=resourceCodePersistence.create(codeId);
  resourceCode.setCompanyId(companyId);
  resourceCode.setName(name);
  resourceCode.setScope(scope);
  try {
    resourceCodePersistence.update(resourceCode,false);
  }
 catch (  SystemException se) {
    if (_log.isWarnEnabled()) {
      _log.warn("Add failed, fetch {companyId=" + companyId + ", name="+ name+ ", scope="+ scope+ "}");
    }
    resourceCode=resourceCodePersistence.fetchByC_N_S(companyId,name,scope);
    if (resourceCode == null) {
      throw se;
    }
  }
  return resourceCode;
}
