{
  ServletFileUpload upload=new ServletFileUpload(new LiferayFileItemFactory(UploadServletRequest.DEFAULT_TEMP_DIR));
  List items=null;
  try {
    items=upload.parseRequest(req);
  }
 catch (  FileUploadException fue) {
    throw new FCKException(fue);
  }
  Map fields=new HashMap();
  Iterator itr=items.iterator();
  while (itr.hasNext()) {
    FileItem item=(FileItem)itr.next();
    if (item.isFormField()) {
      fields.put(item.getFieldName(),item.getString());
    }
 else {
      fields.put(item.getFieldName(),item);
    }
  }
  DiskFileItem fileItem=(DiskFileItem)fields.get("NewFile");
  String fileName=StringUtil.replace(fileItem.getName(),"\\","/");
  String[] fileNameArray=StringUtil.split(fileName,"/");
  fileName=fileNameArray[fileNameArray.length - 1];
  String extension=_getExtension(fileName);
  String returnValue=null;
  try {
    returnValue=fileUpload(arg,fileName,fileItem.getStoreLocation(),extension);
  }
 catch (  FCKException fcke) {
    _writeUploadResponse("203",res);
    throw fcke;
  }
  _writeUploadResponse(returnValue,res);
}
