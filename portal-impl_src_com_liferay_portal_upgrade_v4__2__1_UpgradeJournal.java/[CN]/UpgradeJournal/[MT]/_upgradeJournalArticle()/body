{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getConnection();
    ps=con.prepareStatement(_FIND_JOURNAL_ARTICLE_TEMPLATE_DRIVEN);
    rs=ps.executeQuery();
    Document doc=null;
    SAXReader reader=new SAXReader();
    Element root=null;
    while (rs.next()) {
      String companyId=rs.getString("companyId");
      String groupId=rs.getString("groupId");
      String articleId=rs.getString("articleId");
      String version=rs.getString("version");
      String content=rs.getString("content");
      try {
        doc=reader.read(new StringReader(content));
        root=doc.getRootElement();
        _upgradeImageId(groupId,root);
        String xmlContent=_toString(doc,XML_INDENT);
        _updateContent(_UPDATE_JOURNAL_ARTICLE_CONTENT,companyId,groupId,articleId,version,xmlContent);
      }
 catch (      DocumentException de) {
        if (_log.isWarnEnabled()) {
          _log.warn("Unable to read article " + articleId);
        }
        if (_log.isDebugEnabled()) {
          _log.debug(de.getMessage() + "\n" + "Unable to read article "+ articleId+ " with content\n"+ content);
        }
      }
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
