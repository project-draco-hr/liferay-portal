{
  long classPK=ExportImportClassedModelUtil.getClassPK(classedModel);
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setCompanyId(getCompanyId());
  serviceContext.setScopeGroupId(getScopeGroupId());
  if (classedModel instanceof AuditedModel) {
    AuditedModel auditedModel=(AuditedModel)classedModel;
    serviceContext.setUserId(getUserId(auditedModel));
    serviceContext.setCreateDate(auditedModel.getCreateDate());
    serviceContext.setModifiedDate(auditedModel.getModifiedDate());
  }
  if (!MapUtil.getBoolean(_parameterMap,PortletDataHandlerKeys.PERMISSIONS)) {
    serviceContext.setAddGroupPermissions(true);
    serviceContext.setAddGuestPermissions(true);
  }
  if (isResourceMain(classedModel)) {
    long[] assetCategoryIds=getAssetCategoryIds(clazz,classPK);
    serviceContext.setAssetCategoryIds(assetCategoryIds);
    String[] assetTagNames=getAssetTagNames(clazz,classPK);
    serviceContext.setAssetTagNames(assetTagNames);
  }
  String expandoPath=null;
  if (element != null) {
    expandoPath=element.attributeValue("expando-path");
  }
 else {
    expandoPath=ExportImportPathUtil.getExpandoPath(path);
  }
  if (Validator.isNotNull(expandoPath)) {
    try {
      Map<String,Serializable> expandoBridgeAttributes=(Map<String,Serializable>)getZipEntryAsObject(expandoPath);
      if (expandoBridgeAttributes != null) {
        serviceContext.setExpandoBridgeAttributes(expandoBridgeAttributes);
      }
    }
 catch (    Exception e) {
      if (_log.isDebugEnabled()) {
        _log.debug(e,e);
      }
    }
  }
  if (classedModel instanceof WorkflowedModel) {
    WorkflowedModel workflowedModel=(WorkflowedModel)classedModel;
    if (workflowedModel.getStatus() == WorkflowConstants.STATUS_APPROVED) {
      serviceContext.setWorkflowAction(WorkflowConstants.ACTION_PUBLISH);
    }
 else     if (workflowedModel.getStatus() == WorkflowConstants.STATUS_DRAFT) {
      serviceContext.setWorkflowAction(WorkflowConstants.ACTION_SAVE_DRAFT);
    }
  }
  return serviceContext;
}
