{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String pluginId=ParamUtil.getString(actionRequest,"pluginId");
  String pluginType=ParamUtil.getString(actionRequest,"pluginType");
  String[] roles=StringUtil.split(ParamUtil.getString(actionRequest,"roles"),CharPool.NEW_LINE);
  Arrays.sort(roles);
  boolean active=ParamUtil.getBoolean(actionRequest,"active");
  if (pluginType.equals(Plugin.TYPE_PORTLET)) {
    _portletService.updatePortlet(themeDisplay.getCompanyId(),pluginId,StringPool.BLANK,active);
  }
 else {
    if (roles.length == 0) {
      PluginSetting pluginSetting=_pluginSettingLocalService.getPluginSetting(themeDisplay.getCompanyId(),pluginId,pluginType);
      roles=StringUtil.split(pluginSetting.getRoles());
    }
    _pluginSettingService.updatePluginSetting(themeDisplay.getCompanyId(),pluginId,pluginType,StringUtil.merge(roles),active);
  }
}
