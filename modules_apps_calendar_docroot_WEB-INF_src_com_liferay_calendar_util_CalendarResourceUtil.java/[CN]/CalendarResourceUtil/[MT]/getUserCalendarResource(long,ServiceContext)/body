{
  long classNameId=PortalUtil.getClassNameId(User.class);
  CalendarResource calendarResource=CalendarResourceLocalServiceUtil.fetchCalendarResource(classNameId,userId);
  if (calendarResource != null) {
    return calendarResource;
  }
  User user=UserLocalServiceUtil.getUser(userId);
  Group userGroup=null;
  String userName=user.getFullName();
  if (user.isDefaultUser()) {
    userGroup=GroupLocalServiceUtil.getGroup(serviceContext.getCompanyId(),GroupConstants.GUEST);
    userName=GroupConstants.GUEST;
  }
 else {
    userGroup=GroupLocalServiceUtil.getUserGroup(serviceContext.getCompanyId(),userId);
  }
  Map<Locale,String> nameMap=new HashMap<>();
  nameMap.put(LocaleUtil.getDefault(),userName);
  Map<Locale,String> descriptionMap=new HashMap<>();
  return CalendarResourceLocalServiceUtil.addCalendarResource(userId,userGroup.getGroupId(),PortalUtil.getClassNameId(User.class),userId,null,null,nameMap,descriptionMap,true,serviceContext);
}
