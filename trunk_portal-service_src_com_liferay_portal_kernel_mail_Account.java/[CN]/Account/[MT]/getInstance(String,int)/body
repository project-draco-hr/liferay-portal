{
  Account account=null;
  if (protocol.startsWith(PROTOCOL_IMAP)) {
    boolean secure=false;
    int defaultPort=PORT_IMAP;
    if (protocol.endsWith("s")) {
      secure=true;
      defaultPort=PORT_IMAPS;
    }
    if (port <= 0) {
      port=defaultPort;
    }
    account=new IMAPAccount(protocol,secure,port);
  }
 else   if (protocol.startsWith(PROTOCOL_POP)) {
    boolean secure=false;
    int defaultPort=PORT_POP;
    if (protocol.endsWith("s")) {
      secure=true;
      defaultPort=PORT_POPS;
    }
    if (port <= 0) {
      port=defaultPort;
    }
    account=new POPAccount(protocol,secure,port);
  }
 else {
    boolean secure=false;
    int defaultPort=PORT_SMTP;
    if (protocol.endsWith("s")) {
      secure=true;
      defaultPort=PORT_SMTPS;
    }
    if (port <= 0) {
      port=defaultPort;
    }
    account=new SMTPAccount(protocol,secure,port);
  }
  return account;
}
