{
  try {
    ServletContext servletContext=getServletContext();
    HttpServletRequest request=getServletRequest();
    HttpServletResponse response=getServletResponse();
    String page=getCustomPage(servletContext,request);
    if (Validator.isNull(page)) {
      page=getPage();
    }
    if (Validator.isNull(page)) {
      page=getEndPage();
    }
    callSetAttributes();
    Theme theme=(Theme)request.getAttribute(WebKeys.THEME);
    if (_log.isDebugEnabled() && Validator.isNotNull(page)) {
      String resourcePath=ThemeHelper.getResourcePath(servletContext,theme,page);
      _log.debug(resourcePath);
    }
    if (ThemeHelper.resourceExists(servletContext,theme,page)) {
      ThemeUtil.include(servletContext,request,response,pageContext,page,theme);
      return EVAL_PAGE;
    }
 else     if (!FileAvailabilityUtil.isAvailable(servletContext,page)) {
      return processEndTag();
    }
 else {
      _doInclude(page);
      return EVAL_PAGE;
    }
  }
 catch (  Exception e) {
    throw new JspException(e);
  }
 finally {
    _dynamicAttributes.clear();
    clearParams();
    clearProperties();
    cleanUpSetAttributes();
    if (!ServerDetector.isResin()) {
      setPage(null);
      cleanUp();
    }
  }
}
