{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  long companyId=themeDisplay.getCompanyId();
  long userId=themeDisplay.getUserId();
  long folderId=ParamUtil.getLong(req,"folderId");
  String name=ParamUtil.getString(req,"name");
  DLFileEntryPermission.check(themeDisplay.getPermissionChecker(),folderId,name,ActionKeys.VIEW);
  String titleWithExtension=ParamUtil.getString(req,"titleWithExtension");
  double sourceVersion=ParamUtil.getDouble(req,"sourceVersion");
  double targetVersion=ParamUtil.getDouble(req,"targetVersion");
  InputStream sourceIs=DLFileEntryLocalServiceUtil.getFileAsStream(companyId,userId,folderId,name,sourceVersion);
  InputStream targetIs=DLFileEntryLocalServiceUtil.getFileAsStream(companyId,userId,folderId,name,targetVersion);
  List[] diffResults=DiffUtil.diff(new InputStreamReader(sourceIs),new InputStreamReader(targetIs));
  req.setAttribute(WebKeys.SOURCE_NAME,titleWithExtension + StringPool.SPACE + sourceVersion);
  req.setAttribute(WebKeys.TARGET_NAME,titleWithExtension + StringPool.SPACE + targetVersion);
  req.setAttribute(WebKeys.DIFF_RESULTS,diffResults);
}
