{
  try {
    ObjectInputStream objectInputStream=null;
    UnsyncBufferedInputStream unsyncBufferedInputStream=new UnsyncBufferedInputStream(_process.getInputStream());
    UnsyncByteArrayOutputStream unsyncByteArrayOutputStream=new UnsyncByteArrayOutputStream();
    while (true) {
      try {
        unsyncBufferedInputStream.mark(4);
        objectInputStream=new PortalClassLoaderObjectInputStream(unsyncBufferedInputStream);
        if (unsyncByteArrayOutputStream.size() > 0) {
          if (_log.isWarnEnabled()) {
            _log.warn("Found corrupt leading log " + unsyncByteArrayOutputStream.toString());
          }
        }
        unsyncByteArrayOutputStream=null;
        break;
      }
 catch (      StreamCorruptedException sce) {
        unsyncBufferedInputStream.reset();
        unsyncByteArrayOutputStream.write(unsyncBufferedInputStream.read());
      }
    }
    while (true) {
      ProcessCallable<?> processCallable=(ProcessCallable<?>)objectInputStream.readObject();
      if (processCallable instanceof ExceptionProcessCallable) {
        return processCallable;
      }
      if (processCallable instanceof ReturnProcessCallable<?>) {
        return processCallable;
      }
      Serializable returnValue=processCallable.call();
      if (_log.isDebugEnabled()) {
        _log.debug("Invoked generic process callable " + processCallable + " with return value "+ returnValue);
      }
    }
  }
 catch (  EOFException eofe) {
    throw new ProcessException("Subprocess piping back ended prematurely",eofe);
  }
 finally {
    try {
      int exitCode=_process.waitFor();
      if (exitCode != 0) {
        throw new ProcessException("Subprocess terminated with exit code " + exitCode);
      }
    }
 catch (    InterruptedException ie) {
      _process.destroy();
      throw new ProcessException("Forcibly killed subprocess on interruption",ie);
    }
  }
}
