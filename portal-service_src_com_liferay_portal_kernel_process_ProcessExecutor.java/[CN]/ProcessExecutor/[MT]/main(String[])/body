{
  ObjectOutputStream objectOutputStream=new ObjectOutputStream(new UnsyncBufferedOutputStream(System.out));
  ProcessOutputStream outProcessOutputStream=new ProcessOutputStream(objectOutputStream,false);
  ProcessContext._setProcessOutputStream(outProcessOutputStream);
  PrintStream outPrintStream=new PrintStream(outProcessOutputStream,true);
  System.setOut(outPrintStream);
  ProcessOutputStream errProcessOutputStream=new ProcessOutputStream(objectOutputStream,true);
  PrintStream errPrintStream=new PrintStream(errProcessOutputStream,true);
  System.setErr(errPrintStream);
  try {
    ObjectInputStream objectInputStream=new ObjectInputStream(System.in);
    ProcessCallable<?> processCallable=(ProcessCallable<?>)objectInputStream.readObject();
    Serializable result=processCallable.call();
    outPrintStream.flush();
    outProcessOutputStream.writeProcessCallable(new ReturnProcessCallable<Serializable>(result));
    outProcessOutputStream.close();
  }
 catch (  ProcessException pe) {
    errPrintStream.flush();
    errProcessOutputStream.writeProcessCallable(new ExceptionProcessCallable(pe));
    errProcessOutputStream.close();
  }
}
