{
  String servletContextName=servletContext.getServletContextName();
  if (_log.isInfoEnabled()) {
    if (servletContextName == null) {
      _log.info("Reading plugin package for the root context");
    }
 else {
      _log.info("Reading plugin package for " + servletContextName);
    }
  }
  PluginPackage pluginPackage=null;
  String propertiesString=HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-plugin-package.properties"));
  if (propertiesString != null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Reading plugin package from " + "liferay-plugin-package.properties");
    }
    Properties properties=PropertiesUtil.load(propertiesString);
    String displayName=servletContextName;
    if (displayName.startsWith(StringPool.SLASH)) {
      displayName=displayName.substring(1);
    }
    pluginPackage=_readPluginPackageProperties(displayName,properties);
  }
  String xml=HttpUtil.URLtoString(servletContext.getResource("/WEB-INF/liferay-plugin-package.xml"));
  if ((pluginPackage != null) && (xml != null)) {
    if (_log.isWarnEnabled()) {
      _log.warn("Ignoring liferay-plugin-package.xml from " + servletContextName + " because it duplicates "+ "liferay-plugin-package.properties");
    }
  }
  if (pluginPackage == null) {
    if (xml != null) {
      Boolean mainServlet=(Boolean)servletContext.getAttribute(MainServlet.class.getName());
      if (((mainServlet == null) || !mainServlet) && _log.isWarnEnabled()) {
        _log.warn("Please upgrade liferay-plugin-package.xml in " + servletContextName + " to liferay-plugin-package.properties");
      }
      pluginPackage=_readPluginPackageXml(xml);
    }
  }
  if (pluginPackage == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Reading plugin package from MANIFEST.MF");
    }
    pluginPackage=_readPluginPackageServletManifest(servletContext);
  }
  pluginPackage.setContext(servletContextName);
  return pluginPackage;
}
