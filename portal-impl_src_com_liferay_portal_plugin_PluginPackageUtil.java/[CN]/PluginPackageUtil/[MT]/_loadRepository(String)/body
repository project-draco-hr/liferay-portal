{
  RemotePluginPackageRepository repository=null;
  StringMaker sm=new StringMaker();
  sm.append(repositoryURL);
  sm.append(StringPool.SLASH);
  sm.append(REPOSITORY_XML_FILENAME_PREFIX);
  sm.append(StringPool.DASH);
  sm.append(ReleaseInfo.getVersion());
  sm.append(StringPool.PERIOD);
  sm.append(REPOSITORY_XML_FILENAME_EXTENSION);
  String pluginsXmlURL=sm.toString();
  try {
    HttpImpl httpImpl=(HttpImpl)HttpUtil.getHttp();
    HostConfiguration hostConfig=httpImpl.getHostConfig(pluginsXmlURL);
    HttpClient client=httpImpl.getClient(hostConfig);
    GetMethod getFileMethod=new GetMethod(pluginsXmlURL);
    byte[] bytes=null;
    try {
      int responseCode=client.executeMethod(hostConfig,getFileMethod);
      if (responseCode != 200) {
        if (_log.isDebugEnabled()) {
          _log.debug("A repository for version " + ReleaseInfo.getVersion() + " was not found. "+ "Checking general repository");
        }
        sm=new StringMaker();
        sm.append(repositoryURL);
        sm.append(StringPool.SLASH);
        sm.append(REPOSITORY_XML_FILENAME_PREFIX);
        sm.append(StringPool.PERIOD);
        sm.append(REPOSITORY_XML_FILENAME_EXTENSION);
        pluginsXmlURL=sm.toString();
        getFileMethod=new GetMethod(pluginsXmlURL);
        responseCode=client.executeMethod(hostConfig,getFileMethod);
        if (responseCode != 200) {
          throw new PluginPackageException("Unable to download file " + pluginsXmlURL + " because of response code "+ responseCode);
        }
      }
      bytes=getFileMethod.getResponseBody();
    }
  finally {
      getFileMethod.releaseConnection();
    }
    if ((bytes != null) && (bytes.length > 0)) {
      repository=_parseRepositoryXml(new String(bytes),repositoryURL);
      _repositoryCache.put(repositoryURL,repository);
      _availableTagsCache.addAll(repository.getTags());
      _lastUpdateDate=new Date();
      _updateAvailable=null;
      return repository;
    }
 else {
      _lastUpdateDate=new Date();
      throw new PluginPackageException("Download returned 0 bytes");
    }
  }
 catch (  MalformedURLException mue) {
    _repositoryCache.remove(repositoryURL);
    throw new PluginPackageException("Invalid URL " + pluginsXmlURL,mue);
  }
catch (  IOException ioe) {
    _repositoryCache.remove(repositoryURL);
    throw new PluginPackageException("Unable to communicate with repository " + repositoryURL,ioe);
  }
catch (  DocumentException de) {
    _repositoryCache.remove(repositoryURL);
    throw new PluginPackageException("Unable to parse plugin list for repository " + repositoryURL,de);
  }
}
