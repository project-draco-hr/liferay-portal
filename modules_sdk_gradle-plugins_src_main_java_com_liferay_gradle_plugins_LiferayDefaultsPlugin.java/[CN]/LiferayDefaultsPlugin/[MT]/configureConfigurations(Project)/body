{
  ConfigurationContainer configurationContainer=project.getConfigurations();
  final LiferayExtension liferayExtension=GradleUtil.getExtension(project,LiferayExtension.class);
  Action<Configuration> action=new Action<Configuration>(){
    @Override public void execute(    Configuration configuration){
      ResolutionStrategy resolutionStrategy=configuration.getResolutionStrategy();
      resolutionStrategy.eachDependency(new Action<DependencyResolveDetails>(){
        @Override public void execute(        DependencyResolveDetails dependencyResolveDetails){
          ModuleVersionSelector moduleVersionSelector=dependencyResolveDetails.getRequested();
          String group=moduleVersionSelector.getGroup();
          if (!group.equals("com.liferay.portal")) {
            return;
          }
          String name=moduleVersionSelector.getName();
          if (name.equals("portal-service")) {
            name="com.liferay.portal.kernel";
          }
 else           if (!name.startsWith("com.liferay.")) {
            name="com.liferay." + name.replace('-','.');
          }
          String version=liferayExtension.getPortalVersion();
          if (!name.equals(moduleVersionSelector.getName())) {
            dependencyResolveDetails.useTarget(group + ":" + name+ ":"+ version);
          }
 else {
            dependencyResolveDetails.useVersion(version);
          }
        }
      }
);
    }
  }
;
  configurationContainer.all(action);
}
