{
  Gradle gradle=project.getGradle();
  File gitRepoDir=getRootDir(project,".gitrepo");
  final File portalRootDir=getRootDir(project.getRootProject(),"portal-impl");
  final boolean publishing=isPublishing(project);
  File relengDir=getRelengDir(project);
  boolean testProject=isTestProject(project);
  applyPlugins(project);
  configureMavenConf2ScopeMappings(project);
  applyConfigScripts(project);
  if (testProject || hasTests(project)) {
    GradleUtil.applyPlugin(project,WhipDefaultsPlugin.class);
    GradleUtil.applyPlugin(project,WhipPlugin.class);
    Configuration portalConfiguration=GradleUtil.getConfiguration(project,LiferayJavaPlugin.PORTAL_CONFIGURATION_NAME);
    Configuration portalTestConfiguration=addConfigurationPortalTest(project);
    addDependenciesPortalTest(project);
    addDependenciesTestCompile(project);
    configureEclipse(project,portalTestConfiguration);
    configureIdea(project,portalTestConfiguration);
    configureSourceSetTest(project,portalConfiguration,portalTestConfiguration);
    configureSourceSetTestIntegration(project,portalConfiguration,portalTestConfiguration);
  }
  final Jar jarJavadocTask=addTaskJarJavadoc(project);
  final Jar jarSourcesTask=addTaskJarSources(project,testProject);
  final Jar jarTLDDocTask=addTaskJarTLDDoc(project);
  if (relengDir != null) {
    GradleUtil.applyPlugin(project,ChangeLogBuilderPlugin.class);
    BuildChangeLogTask buildChangeLogTask=(BuildChangeLogTask)GradleUtil.getTask(project,ChangeLogBuilderPlugin.BUILD_CHANGE_LOG_TASK_NAME);
    WritePropertiesTask recordArtifactTask=addTaskRecordArtifact(project,relengDir);
    addTaskPrintArtifactPublishCommands(gitRepoDir,portalRootDir,buildChangeLogTask,recordArtifactTask,testProject);
    addTaskPrintStaleArtifact(portalRootDir,recordArtifactTask,testProject);
    configureTaskBuildChangeLog(buildChangeLogTask,relengDir);
    configureTaskProcessResources(buildChangeLogTask);
    StartParameter startParameter=gradle.getStartParameter();
    List<String> taskNames=startParameter.getTaskNames();
    if (taskNames.contains(LiferayJavaPlugin.DEPLOY_TASK_NAME)) {
      configureTaskDeploy(recordArtifactTask);
    }
  }
  final ReplaceRegexTask updateFileVersionsTask=addTaskUpdateFileVersions(project,gitRepoDir);
  configureBasePlugin(project,portalRootDir);
  configureConfigurations(project);
  configureJavaPlugin(project);
  configureProject(project);
  configureRepositories(project);
  configureSourceSetMain(project);
  configureTaskJar(project,testProject);
  configureTaskTest(project);
  configureTaskTestIntegration(project);
  configureTasksBaseline(project);
  configureTasksFindBugs(project);
  configureTasksJavaCompile(project);
  configureTasksPublishNodeModule(project);
  withPlugin(project,BundlePlugin.class,new Action<BundlePlugin>(){
    @Override public void execute(    BundlePlugin bundlePlugin){
      Configuration baselineConfiguration=null;
      if (hasBaseline(project)) {
        baselineConfiguration=addConfigurationBaseline(project);
      }
      addTaskBaseline(project,baselineConfiguration);
      addTaskCopyLibs(project);
      addTaskUpdateBundleVersion(project);
      configureBundleDefaultInstructions(project,publishing);
      configureDeployDir(project);
      configureTaskJavadoc(project);
    }
  }
);
  withPlugin(project,ServiceBuilderPlugin.class,new Action<ServiceBuilderPlugin>(){
    @Override public void execute(    ServiceBuilderPlugin serviceBuilderPlugin){
      configureLocalPortalTool(project,portalRootDir,ServiceBuilderPlugin.CONFIGURATION_NAME,ServiceBuilderDefaultsPlugin.PORTAL_TOOL_NAME,"portal-tools-service-builder");
    }
  }
);
  project.afterEvaluate(new Action<Project>(){
    @Override public void execute(    Project project){
      checkVersion(project);
      configureArtifacts(project,jarJavadocTask,jarSourcesTask,jarTLDDocTask);
      configureProjectVersion(project);
      configureTaskJarSources(jarSourcesTask);
      configureTaskUpdateFileVersions(updateFileVersionsTask,portalRootDir);
      configureTaskUploadArchives(project,updateFileVersionsTask);
      if (hasPlugin(project,BundlePlugin.class)) {
        configureProjectBndProperties(project);
      }
    }
  }
);
  TaskExecutionGraph taskExecutionGraph=gradle.getTaskGraph();
  taskExecutionGraph.whenReady(new Closure<Void>(null){
    @SuppressWarnings("unused") public void doCall(    TaskExecutionGraph taskExecutionGraph){
      Task jarTask=GradleUtil.getTask(project,JavaPlugin.JAR_TASK_NAME);
      if (hasPlugin(project,BundlePlugin.class) && taskExecutionGraph.hasTask(jarTask)) {
        configureBundleInstructions(project);
      }
    }
  }
);
}
