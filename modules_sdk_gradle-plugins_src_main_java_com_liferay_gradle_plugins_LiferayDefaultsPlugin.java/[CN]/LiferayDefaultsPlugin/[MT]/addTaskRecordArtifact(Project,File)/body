{
  final WritePropertiesTask writePropertiesTask=GradleUtil.addTask(project,RECORD_ARTIFACT_TASK_NAME,WritePropertiesTask.class);
  writePropertiesTask.property("artifact.git.id",new Callable<String>(){
    @Override public String call() throws Exception {
      return getGitResult(writePropertiesTask.getProject(),"rev-parse","HEAD");
    }
  }
);
  Configuration configuration=GradleUtil.getConfiguration(project,Dependency.ARCHIVES_CONFIGURATION);
  PublishArtifactSet publishArtifactSet=configuration.getArtifacts();
  publishArtifactSet.withType(ArchivePublishArtifact.class,new Action<ArchivePublishArtifact>(){
    @Override public void execute(    final ArchivePublishArtifact archivePublishArtifact){
      String key=archivePublishArtifact.getClassifier();
      if (Validator.isNull(key)) {
        key="artifact.url";
      }
 else {
        key="artifact." + key + ".url";
      }
      writePropertiesTask.property(key,new Callable<String>(){
        @Override public String call() throws Exception {
          return getArtifactRemoteURL(archivePublishArtifact.getArchiveTask(),false);
        }
      }
);
    }
  }
);
  writePropertiesTask.setDescription("Records the commit ID and the artifact URLs.");
  writePropertiesTask.setOutputFile(new File(destinationDir,"artifact.properties"));
  return writePropertiesTask;
}
