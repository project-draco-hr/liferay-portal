{
  Task task=project.task(UPDATE_BUNDLE_VERSION_TASK_NAME);
  Action<Task> action=new Action<Task>(){
    @Override public void execute(    Task task){
      try {
        Project project=task.getProject();
        File bndFile=project.file("bnd.bnd");
        if (!bndFile.exists()) {
          if (_logger.isInfoEnabled()) {
            _logger.info("Unable to find " + bndFile);
          }
          return;
        }
        String bndContent=new String(Files.readAllBytes(bndFile.toPath()),StandardCharsets.UTF_8);
        VersionNumber versionNumber=VersionNumber.parse(String.valueOf(project.getVersion()));
        VersionNumber nextVersionNumber=new VersionNumber(versionNumber.getMajor(),versionNumber.getMinor(),versionNumber.getMicro() + 1,versionNumber.getQualifier());
        String nextBndContent=bndContent.replace(Constants.BUNDLE_VERSION + ": " + versionNumber,Constants.BUNDLE_VERSION + ": " + nextVersionNumber);
        if (bndContent.equals(nextBndContent)) {
          if (_logger.isWarnEnabled()) {
            _logger.warn("Unable to update " + Constants.BUNDLE_VERSION);
          }
          return;
        }
        Files.write(bndFile.toPath(),nextBndContent.getBytes(StandardCharsets.UTF_8));
        if (_logger.isLifecycleEnabled()) {
          _logger.lifecycle(Constants.BUNDLE_VERSION + " of " + project+ " updated to "+ nextVersionNumber);
        }
      }
 catch (      IOException ioe) {
        throw new GradleException("Unable to update " + Constants.BUNDLE_VERSION,ioe);
      }
    }
  }
;
  task.doLast(action);
  task.setDescription("Updates the project version in the " + Constants.BUNDLE_VERSION + " header.");
  return task;
}
