{
  final Project project=recordArtifactTask.getProject();
  Task task=project.task(PRINT_ARTIFACT_PUBLISH_COMMANDS);
  task.doLast(new Action<Task>(){
    private String _getGitCommitCommand(    String message,    boolean ignored){
      return _getGitCommitCommand(message,false,ignored);
    }
    private String _getGradleCommand(    String gradleRelativePath,    String command,    boolean gradleDaemon,    String... arguments){
      StringBuilder sb=new StringBuilder();
      sb.append(gradleRelativePath);
      sb.append(' ');
      sb.append(command);
      if (gradleDaemon) {
        sb.append(" --daemon");
      }
      for (      String argument : arguments) {
        sb.append(' ');
        sb.append(argument);
      }
      return sb.toString();
    }
    private String _getGitCommitCommand(    String message,    boolean all,    boolean ignored){
      StringBuilder sb=new StringBuilder();
      if (all) {
        sb.append("(git diff-index --quiet HEAD || ");
      }
      sb.append("git commit ");
      if (all) {
        sb.append("--all ");
      }
      sb.append("--message=\"");
      if (ignored) {
        sb.append(_IGNORED_MESSAGE_PATTERN);
        sb.append(' ');
      }
      sb.append(project.getName());
      sb.append(' ');
      sb.append(project.getVersion());
      sb.append(' ');
      sb.append(message);
      sb.append('"');
      if (all) {
        sb.append(')');
      }
      return sb.toString();
    }
    private boolean _getGradleDaemon(    Task task){
      boolean gradleDaemon=true;
      String gradleDaemonString=GradleUtil.getTaskPrefixedProperty(task,"daemon");
      if (Validator.isNotNull(gradleDaemonString)) {
        gradleDaemon=Boolean.parseBoolean(gradleDaemonString);
      }
      return gradleDaemon;
    }
    private String _getGradleRelativePath(){
      File rootDir=portalRootDir;
      if (portalRootDir == null) {
        rootDir=project.getRootDir();
      }
      File gradlewFile=new File(rootDir,"gradlew");
      return project.relativePath(gradlewFile);
    }
    private List<String> _getPublishCommands(    String gradleRelativePath,    boolean gradleDaemon,    boolean excludeUpdateFileVersions){
      List<String> commands=new ArrayList<>();
      commands.add(_getGradleCommand(gradleRelativePath,BasePlugin.UPLOAD_ARCHIVES_TASK_NAME,gradleDaemon,"-P" + _SNAPSHOT_PROPERTY_NAME));
      String[] arguments;
      if (excludeUpdateFileVersions) {
        arguments=new String[]{"-x",UPDATE_FILE_VERSIONS_TASK_NAME};
      }
 else {
        arguments=new String[0];
      }
      commands.add(_getGradleCommand(gradleRelativePath,BasePlugin.UPLOAD_ARCHIVES_TASK_NAME,gradleDaemon,arguments));
      commands.add("git add " + project.relativePath("bnd.bnd"));
      commands.add(_getGitCommitCommand("prep next",true));
      commands.add("git add " + project.relativePath(recordArtifactTask.getOutputFile()));
      commands.add(_getGitCommitCommand("artifact properties",true));
      commands.add(_getGitCommitCommand("apply",true,false));
      return commands;
    }
    @Override public void execute(    Task task){
      List<String> commands=new ArrayList<>();
      boolean gradleDaemon=_getGradleDaemon(task);
      String gradleRelativePath=_getGradleRelativePath();
      commands.add("cd " + FileUtil.getAbsolutePath(project.getProjectDir()));
      if (!hasBaseline(project)) {
        commands.addAll(_getPublishCommands(gradleRelativePath,gradleDaemon,true));
      }
      commands.add(_getGradleCommand(gradleRelativePath,ChangeLogBuilderPlugin.BUILD_CHANGE_LOG_TASK_NAME,gradleDaemon));
      commands.add("git add --all .");
      commands.add(_getGitCommitCommand("change log",true));
      commands.add(_getGradleCommand(gradleRelativePath,BASELINE_TASK_NAME,gradleDaemon));
      commands.add("git add --all .");
      List<String> publishCommands=_getPublishCommands(gradleRelativePath,gradleDaemon,false);
      publishCommands.add(0,_getGitCommitCommand("packageinfo",false));
      commands.add("(git diff-index --quiet HEAD || (" + CollectionUtils.join(" && ",publishCommands) + "))");
      System.out.println();
      for (      String command : commands) {
        System.out.print(" && ");
        System.out.print(command);
      }
      if (GradleUtil.getProperty(project,"first",false)) {
        throw new GradleException();
      }
    }
  }
);
  if (gitRepoDir != null) {
    task.onlyIf(new LeafArtifactSpec(gitRepoDir));
  }
  task.setDescription("Prints the artifact publish commands if this project has been " + "changed since the last publish.");
  configureTaskEnabledIfStale(task,recordArtifactTask,testProject);
  return task;
}
