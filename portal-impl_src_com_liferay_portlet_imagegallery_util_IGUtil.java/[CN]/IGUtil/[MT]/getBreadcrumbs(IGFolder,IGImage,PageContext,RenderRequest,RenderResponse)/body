{
  if ((image != null) && (folder == null)) {
    folder=image.getFolder();
  }
  PortletURL foldersURL=renderResponse.createRenderURL();
  WindowState windowState=renderRequest.getWindowState();
  if (windowState.equals(LiferayWindowState.POP_UP)) {
    foldersURL.setWindowState(LiferayWindowState.POP_UP);
    foldersURL.setParameter("struts_action","/image_gallery/select_folder");
  }
 else {
    foldersURL.setParameter("struts_action","/image_gallery/view");
  }
  String foldersLink="<a href=\"" + foldersURL.toString() + "\">"+ LanguageUtil.get(pageContext,"folders")+ "</a>";
  if (folder == null) {
    return "<span class=\"first last\">" + foldersLink + "</span>";
  }
  String breadcrumbs=StringPool.BLANK;
  if (folder != null) {
    for (int i=0; ; i++) {
      folder=folder.toEscapedModel();
      PortletURL portletURL=renderResponse.createRenderURL();
      if (windowState.equals(LiferayWindowState.POP_UP)) {
        portletURL.setWindowState(LiferayWindowState.POP_UP);
        portletURL.setParameter("struts_action","/image_gallery/select_folder");
        portletURL.setParameter("folderId",String.valueOf(folder.getFolderId()));
      }
 else {
        portletURL.setParameter("struts_action","/image_gallery/view");
        portletURL.setParameter("folderId",String.valueOf(folder.getFolderId()));
      }
      String folderLink="<a href=\"" + portletURL.toString() + "\">"+ folder.getName()+ "</a>";
      if (i == 0) {
        if (image != null) {
          breadcrumbs+=folderLink;
        }
 else {
          breadcrumbs="<span class=\"last\">" + folderLink + "</span>";
        }
      }
 else {
        breadcrumbs=folderLink + " &raquo; " + breadcrumbs;
      }
      if (folder.isRoot()) {
        break;
      }
      folder=IGFolderLocalServiceUtil.getFolder(folder.getParentFolderId());
    }
  }
  breadcrumbs="<span class=\"first\">" + foldersLink + " &raquo; </span>"+ breadcrumbs;
  if (image != null) {
    image=image.toEscapedModel();
    PortletURL imageURL=renderResponse.createRenderURL();
    imageURL.setParameter("struts_action","/image_gallery/edit_image");
    imageURL.setParameter("imageId",String.valueOf(image.getImageId()));
    String imageLink="<span class=\"last\"><a href=\"" + imageURL.toString() + "\">"+ image.getImageId()+ "</a></span>";
    breadcrumbs=breadcrumbs + " &raquo; " + imageLink;
  }
  return breadcrumbs;
}
