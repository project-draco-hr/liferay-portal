{
  if (!_hasErrorTemplate) {
    try {
      return _processTemplate(_templateResource,writer);
    }
 catch (    Exception e) {
      throw new TemplateException("Unable to process Velocity template " + _templateResource.getTemplateId(),e);
    }
  }
  try {
    UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
    boolean result=_processTemplate(_templateResource,unsyncStringWriter);
    StringBundler sb=unsyncStringWriter.getStringBundler();
    sb.writeTo(writer);
    return result;
  }
 catch (  Exception e1) {
    put("exception",e1.getMessage());
    if (_templateResource instanceof StringTemplateResource) {
      StringTemplateResource stringTemplateResource=(StringTemplateResource)_templateResource;
      put("script",stringTemplateResource.getContent());
    }
    if (e1 instanceof ParseErrorException) {
      ParseErrorException pee=(ParseErrorException)e1;
      put("column",pee.getColumnNumber());
      put("line",pee.getLineNumber());
    }
    try {
      _processTemplate(_errorTemplateResource,writer);
      return false;
    }
 catch (    Exception e2) {
      throw new TemplateException("Unable to process Velocity template " + _errorTemplateResource.getTemplateId(),e2);
    }
  }
}
