{
  validate(name,type,shortDescription,licenseIds,images,true);
  User user=UserUtil.findByPrimaryKey(userId);
  long groupId=PortalUtil.getPortletGroupId(plid);
  Date now=new Date();
  long productEntryId=CounterLocalServiceUtil.increment(SCProductEntry.class.getName());
  SCProductEntry productEntry=SCProductEntryUtil.create(productEntryId);
  productEntry.setGroupId(groupId);
  productEntry.setCompanyId(user.getCompanyId());
  productEntry.setUserId(user.getUserId());
  productEntry.setUserName(user.getFullName());
  productEntry.setCreateDate(now);
  productEntry.setModifiedDate(now);
  productEntry.setName(name);
  productEntry.setType(type);
  productEntry.setShortDescription(shortDescription);
  productEntry.setLongDescription(longDescription);
  productEntry.setPageURL(pageURL);
  productEntry.setRepoGroupId(repoGroupId);
  productEntry.setRepoArtifactId(repoArtifactId);
  SCProductEntryUtil.update(productEntry);
  processImages(productEntry,images);
  if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
    addProductEntryResources(productEntry,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
  }
 else {
    addProductEntryResources(productEntry,communityPermissions,guestPermissions);
  }
  SCProductEntryUtil.setSCLicenses(productEntryId,licenseIds);
  try {
    Indexer.addProductEntry(productEntry.getCompanyId(),groupId,userId,user.getFullName(),productEntryId,name,type,shortDescription,longDescription,pageURL,repoGroupId,repoArtifactId);
  }
 catch (  IOException ioe) {
    _log.error("Indexing " + productEntryId,ioe);
  }
  return productEntry;
}
