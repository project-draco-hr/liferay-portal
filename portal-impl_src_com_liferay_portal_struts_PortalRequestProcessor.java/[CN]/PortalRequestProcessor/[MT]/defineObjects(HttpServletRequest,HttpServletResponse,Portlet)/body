{
  String portletId=portlet.getPortletId();
  ServletContext servletContext=(ServletContext)request.getAttribute(WebKeys.CTX);
  InvokerPortlet invokerPortlet=PortletInstanceFactoryUtil.create(portlet,servletContext);
  PortletPreferencesIds portletPreferencesIds=PortletPreferencesFactoryUtil.getPortletPreferencesIds(request,portletId);
  PortletPreferences portletPreferences=PortletPreferencesLocalServiceUtil.getPreferences(portletPreferencesIds);
  PortletConfig portletConfig=PortletConfigFactory.create(portlet,servletContext);
  PortletContext portletContext=portletConfig.getPortletContext();
  RenderRequestImpl renderRequestImpl=RenderRequestFactory.create(request,portlet,invokerPortlet,portletContext,WindowState.MAXIMIZED,PortletMode.VIEW,portletPreferences);
  RenderResponseImpl renderResponseImpl=RenderResponseFactory.create(renderRequestImpl,response,portletId,portlet.getCompanyId());
  renderRequestImpl.defineObjects(portletConfig,renderResponseImpl);
  request.setAttribute(WebKeys.PORTLET_STRUTS_EXECUTE,Boolean.TRUE);
}
