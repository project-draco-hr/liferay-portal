{
  String portletId=portlet.getPortletId();
  ServletContext servletContext=(ServletContext)request.getAttribute(WebKeys.CTX);
  InvokerPortlet invokerPortlet=PortletInstanceFactory.create(portlet,servletContext);
  PortletPreferencesIds portletPreferencesIds=PortletPreferencesFactoryUtil.getPortletPreferencesIds(request,portletId);
  PortletPreferences portletPreferences=PortletPreferencesLocalServiceUtil.getPreferences(portletPreferencesIds);
  PortletConfig portletConfig=PortletConfigFactory.create(portlet,servletContext);
  PortletContext portletContext=portletConfig.getPortletContext();
  RenderRequestImpl renderReqImpl=RenderRequestFactory.create(request,portlet,invokerPortlet,portletContext,WindowState.MAXIMIZED,PortletMode.VIEW,portletPreferences);
  RenderResponseImpl renderResImpl=RenderResponseFactory.create(renderReqImpl,response,portletId,portlet.getCompanyId());
  renderReqImpl.defineObjects(portletConfig,renderResImpl);
  request.setAttribute(WebKeys.PORTLET_STRUTS_EXECUTE,Boolean.TRUE);
}
