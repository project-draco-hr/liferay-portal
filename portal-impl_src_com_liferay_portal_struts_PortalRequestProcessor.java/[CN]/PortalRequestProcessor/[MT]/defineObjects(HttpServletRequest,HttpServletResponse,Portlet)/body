{
  String portletId=portlet.getPortletId();
  ServletContext ctx=(ServletContext)req.getAttribute(WebKeys.CTX);
  InvokerPortlet invokerPortlet=PortletInstanceFactory.create(portlet,ctx);
  PortletPreferencesIds portletPreferencesIds=PortletPreferencesFactoryUtil.getPortletPreferencesIds(req,portletId);
  PortletPreferences portletPreferences=PortletPreferencesLocalServiceUtil.getPreferences(portletPreferencesIds);
  PortletConfig portletConfig=PortletConfigFactory.create(portlet,ctx);
  PortletContext portletCtx=portletConfig.getPortletContext();
  RenderRequestImpl renderReqImpl=RenderRequestFactory.create(req,portlet,invokerPortlet,portletCtx,WindowState.MAXIMIZED,PortletMode.VIEW,portletPreferences);
  RenderResponseImpl renderResImpl=RenderResponseFactory.create(renderReqImpl,res,portletId,portlet.getCompanyId());
  renderReqImpl.defineObjects(portletConfig,renderResImpl);
  req.setAttribute(WebKeys.PORTLET_STRUTS_EXECUTE,Boolean.TRUE);
}
