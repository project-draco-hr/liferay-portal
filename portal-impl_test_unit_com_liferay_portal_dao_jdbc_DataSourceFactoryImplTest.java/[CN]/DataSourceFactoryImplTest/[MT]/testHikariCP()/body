{
  System.setProperty("portal:jdbc.default.liferay.pool.provider","hikaricp");
  InitUtil.init();
  ServerDetector.init(ServerDetector.TOMCAT_ID);
  DataSource dataSource=DataSourceFactoryUtil.initDataSource(_properties);
  Class<?> dataSourceClass=dataSource.getClass();
  Assert.assertEquals("com.zaxxer.hikari.HikariDataSource",dataSourceClass.getName());
  for (int i=0; i < _CHECKOUT_COUNT; i++) {
    Connection connection=dataSource.getConnection();
    PreparedStatement preparedStatement=connection.prepareStatement(_CONNECTION_TEST_QUERY);
    preparedStatement.execute();
  }
  MBeanServer mBeanServer=ManagementFactory.getPlatformMBeanServer();
  ObjectName poolName=new ObjectName("com.zaxxer.hikari:type=Pool (TestJDBCPool)");
  int activeConnections=(int)mBeanServer.getAttribute(poolName,"ActiveConnections");
  Assert.assertEquals(_CHECKOUT_COUNT,activeConnections);
  int idleConnections=(int)mBeanServer.getAttribute(poolName,"IdleConnections");
  int totalConnections=(int)mBeanServer.getAttribute(poolName,"TotalConnections");
  Assert.assertEquals(totalConnections,activeConnections + idleConnections);
}
