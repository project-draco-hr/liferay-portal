{
  addParameter(parameterMap,"p_p_id",_PORTLET_ID);
  addParameter(parameterMap,"p_p_lifecycle","0");
  addParameter(parameterMap,"p_p_mode",PortletMode.VIEW);
  addParameter(parameterMap,"struts_action","/wiki/view");
  int x=friendlyURLPath.indexOf(StringPool.SLASH,1);
  String wikiPath=friendlyURLPath.substring(x + 1);
  int lastSlash=wikiPath.lastIndexOf(StringPool.SLASH);
  if (lastSlash != -1) {
    String lastFragment=wikiPath.substring(lastSlash + 1);
    if (lastFragment.equalsIgnoreCase("exclusive") || lastFragment.equalsIgnoreCase("maximized") || lastFragment.equalsIgnoreCase("normal")) {
      addParameter(parameterMap,"p_p_state",lastFragment);
      wikiPath=wikiPath.substring(0,lastSlash);
    }
  }
  String firstFragment=wikiPath;
  int firstSlash=wikiPath.indexOf(StringPool.SLASH);
  if (firstSlash != -1) {
    firstFragment=wikiPath.substring(0,firstSlash);
    wikiPath=wikiPath.substring(firstSlash + 1);
  }
 else {
    wikiPath=null;
  }
  if (firstFragment.equalsIgnoreCase("tag") && (wikiPath != null)) {
    addParameter(parameterMap,"struts_action","/wiki/view_tagged_pages");
    String tag=HttpUtil.decodeURL(wikiPath);
    addParameter(parameterMap,"tag",tag);
  }
 else {
    if (Validator.isNumber(firstFragment)) {
      addParameter(parameterMap,"nodeId",firstFragment);
      addParameter(parameterMap,"nodeName",StringPool.BLANK);
    }
 else {
      addParameter(parameterMap,"nodeId",StringPool.BLANK);
      addParameter(parameterMap,"nodeName",firstFragment);
    }
    if (wikiPath != null) {
      if (wikiPath.equals("all_pages") || wikiPath.equals("draft_pages") || wikiPath.equals("orphan_pages")|| wikiPath.equals("recent_changes")) {
        addParameter(parameterMap,"struts_action","/wiki/view_" + wikiPath);
      }
 else {
        wikiPath=HttpUtil.decodeURL(wikiPath);
        addParameter(parameterMap,"title",wikiPath);
      }
    }
    addParameter(parameterMap,"tag",StringPool.BLANK);
  }
}
