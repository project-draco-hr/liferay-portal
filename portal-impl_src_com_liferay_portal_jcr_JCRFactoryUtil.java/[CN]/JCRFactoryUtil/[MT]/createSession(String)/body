{
  if (workspaceName == null) {
    workspaceName=JCRFactory.WORKSPACE_NAME;
  }
  if (!PropsValues.JCR_WRAP_SESSION) {
    return getJCRFactory().createSession(workspaceName);
  }
  Map<String,Session> sessionMap=_sessionMap.get();
  Session session=sessionMap.get(workspaceName);
  if (session == null) {
    Session jcrSession=getJCRFactory().createSession(workspaceName);
    JCRSessionInvocationHandler jcrSessionInvocationHandler=new JCRSessionInvocationHandler(jcrSession);
    Object sessionProxy=ProxyUtil.newProxyInstance(PortalClassLoaderUtil.getClassLoader(),new Class<?>[]{Map.class,Session.class},jcrSessionInvocationHandler);
    FinalizeManager.register(sessionProxy,jcrSessionInvocationHandler);
    session=(Session)sessionProxy;
    sessionMap.put(workspaceName,session);
  }
  return session;
}
