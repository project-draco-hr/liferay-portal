{
  if (workspaceName == null) {
    workspaceName=JCRFactory.WORKSPACE_NAME;
  }
  if (!PropsValues.JCR_WRAP_SESSION) {
    return getJCRFactory().createSession(workspaceName);
  }
  CloseableSessionMap closableSessionMap=_closeableSessionMaps.get();
  if (!closableSessionMap.containsKey(workspaceName)) {
    Session session=getJCRFactory().createSession(workspaceName);
    Object sessionProxy=ProxyUtil.newProxyInstance(PortalClassLoaderUtil.getClassLoader(),new Class<?>[]{Closeable.class,Map.class,Session.class},new JCRSessionInvocationHandler(session));
    closableSessionMap.put(workspaceName,(Closeable)sessionProxy);
  }
  return (Session)closableSessionMap.get(workspaceName);
}
