{
  long startTime=System.currentTimeMillis();
  Files.walkFileTree(filePath,new SimpleFileVisitor<Path>(){
    @Override public FileVisitResult preVisitDirectory(    Path filePath,    BasicFileAttributes basicFileAttributes){
      SyncFile syncFile=SyncFileService.fetchSyncFile(filePath.toString());
      if (syncFile == null) {
        String fileKey=FileUtil.getFileKey(filePath);
        syncFile=SyncFileService.fetchSyncFileByFileKey(fileKey,syncAccountId);
      }
      if (syncFile != null) {
        syncFile.setLocalSyncTime(System.currentTimeMillis());
        SyncFileService.update(syncFile);
      }
      return FileVisitResult.CONTINUE;
    }
    @Override public FileVisitResult visitFile(    Path filePath,    BasicFileAttributes basicFileAttributes){
      SyncFile syncFile=SyncFileService.fetchSyncFile(filePath.toString());
      if (syncFile == null) {
        String fileKey=FileUtil.getFileKey(filePath);
        syncFile=SyncFileService.fetchSyncFileByFileKey(fileKey,syncAccountId);
      }
      if (syncFile != null) {
        syncFile.setLocalSyncTime(System.currentTimeMillis());
        SyncFileService.update(syncFile);
      }
      return FileVisitResult.CONTINUE;
    }
  }
);
  List<SyncFile> deletedSyncFiles=SyncFileService.findSyncFiles(filePath.toString(),startTime);
  for (  SyncFile deletedSyncFile : deletedSyncFiles) {
    if (deletedSyncFile.isFolder()) {
      FileEventUtil.deleteFolder(deletedSyncFile.getSyncAccountId(),deletedSyncFile);
    }
 else {
      FileEventUtil.deleteFile(deletedSyncFile.getSyncAccountId(),deletedSyncFile);
    }
  }
}
