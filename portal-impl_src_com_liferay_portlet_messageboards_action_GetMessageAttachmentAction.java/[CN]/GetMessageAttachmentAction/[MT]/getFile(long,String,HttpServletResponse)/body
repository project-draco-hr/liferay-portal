{
  InputStream is=null;
  try {
    MBMessage message=MBMessageServiceUtil.getMessage(messageId);
    String path=message.getAttachmentsDir() + "/" + fileName;
    is=DLLocalServiceUtil.getFileAsStream(message.getCompanyId(),CompanyConstants.SYSTEM,path);
    int contentLength=(int)DLServiceUtil.getFileSize(message.getCompanyId(),CompanyConstants.SYSTEM,path);
    String contentType=MimeTypesUtil.getContentType(fileName);
    ServletResponseUtil.sendFile(response,fileName,is,contentLength,contentType);
  }
  finally {
    ServletResponseUtil.cleanUp(is);
  }
}
