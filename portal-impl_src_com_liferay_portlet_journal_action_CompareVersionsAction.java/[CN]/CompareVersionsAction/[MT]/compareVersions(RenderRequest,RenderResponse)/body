{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long groupId=ParamUtil.getLong(renderRequest,"groupId");
  String articleId=ParamUtil.getString(renderRequest,"articleId");
  String sourceArticleId=ParamUtil.getString(renderRequest,"sourceVersion");
  int index=sourceArticleId.lastIndexOf(EditArticleAction.VERSION_SEPARATOR);
  if (index != -1) {
    sourceArticleId=sourceArticleId.substring(index + EditArticleAction.VERSION_SEPARATOR.length(),sourceArticleId.length());
  }
  double sourceVersion=GetterUtil.getDouble(sourceArticleId);
  String targetArticleId=ParamUtil.getString(renderRequest,"targetVersion");
  index=targetArticleId.lastIndexOf(EditArticleAction.VERSION_SEPARATOR);
  if (index != -1) {
    targetArticleId=targetArticleId.substring(index + EditArticleAction.VERSION_SEPARATOR.length(),targetArticleId.length());
  }
  double targetVersion=GetterUtil.getDouble(targetArticleId);
  if ((sourceVersion == 0) && (targetVersion == 0)) {
    List<JournalArticle> articles=JournalArticleServiceUtil.getArticlesByArticleId(groupId,articleId,0,2,new ArticleVersionComparator(false));
    sourceVersion=articles.get(0).getVersion();
    targetVersion=articles.get(1).getVersion();
  }
  if (sourceVersion > targetVersion) {
    double tempVersion=targetVersion;
    targetVersion=sourceVersion;
    sourceVersion=tempVersion;
  }
  String languageId=getLanguageId(renderRequest,groupId,articleId,sourceVersion,targetVersion);
  String xmlRequest=PortletRequestUtil.toXML(renderRequest,renderResponse);
  String diffHtmlResults=JournalUtil.diffHtml(groupId,articleId,sourceVersion,targetVersion,languageId,xmlRequest,themeDisplay);
  renderRequest.setAttribute(WebKeys.DIFF_HTML_RESULTS,diffHtmlResults);
  renderRequest.setAttribute(WebKeys.SOURCE_VERSION,sourceVersion);
  renderRequest.setAttribute(WebKeys.TARGET_VERSION,targetVersion);
}
