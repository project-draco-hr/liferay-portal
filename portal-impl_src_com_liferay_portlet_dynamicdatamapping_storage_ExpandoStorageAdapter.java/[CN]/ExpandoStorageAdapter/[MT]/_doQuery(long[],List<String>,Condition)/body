{
  Map<Long,Fields> fieldsMap=new HashMap<Long,Fields>();
  Connection con=null;
  Statement stmt=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getConnection();
    stmt=con.createStatement();
    String sql=_toSQL(expandoRowIds,fieldNames,condition,false);
    rs=stmt.executeQuery(sql);
    while (rs.next()) {
      Long rowId=rs.getLong("rowId_");
      String data=rs.getString("data_");
      String name=rs.getString("name");
      int type=rs.getInt("type_");
      Fields fields=fieldsMap.get(rowId);
      if (fields == null) {
        fields=new Fields();
        fieldsMap.put(rowId,fields);
      }
      Serializable value=ExpandoConverterUtil.getAttributeFromString(type,data);
      fields.put(new Field(name,value));
    }
  }
  finally {
    DataAccess.cleanUp(con,stmt,rs);
  }
  return fieldsMap;
}
