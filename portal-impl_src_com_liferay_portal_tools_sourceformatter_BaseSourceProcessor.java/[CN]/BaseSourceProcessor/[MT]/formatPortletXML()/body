{
  String basedir="./";
  if (_portalSource) {
    File file=new File(basedir + "portal-web/docroot/WEB-INF/portlet-custom.xml");
    String content=_fileUtil.read(file);
    String newContent=_formatPortletXML(content);
    if ((newContent != null) && !content.equals(newContent)) {
      _fileUtil.write(file,newContent);
      _sourceFormatterHelper.printError(file.toString(),file);
    }
  }
 else {
    DirectoryScanner directoryScanner=new DirectoryScanner();
    directoryScanner.setBasedir(basedir);
    directoryScanner.setExcludes(_excludes);
    directoryScanner.setIncludes(new String[]{"**\\portlet.xml"});
    List<String> fileNames=_sourceFormatterHelper.scanForFiles(directoryScanner);
    for (    String fileName : fileNames) {
      File file=new File(basedir + fileName);
      String content=_fileUtil.read(file);
      String newContent=trimContent(content,false);
      newContent=_formatPortletXML(content);
      if ((newContent != null) && !content.equals(newContent)) {
        _fileUtil.write(file,newContent);
        fileName=StringUtil.replace(fileName,StringPool.BACK_SLASH,StringPool.SLASH);
        _sourceFormatterHelper.printError(fileName,file);
      }
    }
  }
}
