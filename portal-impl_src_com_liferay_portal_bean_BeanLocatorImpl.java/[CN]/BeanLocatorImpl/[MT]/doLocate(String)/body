{
  if (_log.isDebugEnabled()) {
    _log.debug("Locating " + name);
  }
  if (name.endsWith(VELOCITY_SUFFIX)) {
    Object bean=_velocityBeans.get(name);
    if (bean == null) {
      String originalName=name.substring(0,name.length() - VELOCITY_SUFFIX.length());
      bean=_applicationContext.getBean(originalName);
      Class<?> beanClass=bean.getClass();
      Class<?>[] interfaces=beanClass.getInterfaces();
      List<Class<?>> interfacesList=new ArrayList<Class<?>>();
      for (      Class<?> clazz : interfaces) {
        try {
          interfacesList.add(_classLoader.loadClass(clazz.getName()));
        }
 catch (        ClassNotFoundException cnfe) {
        }
      }
      bean=Proxy.newProxyInstance(_classLoader,interfacesList.toArray(new Class<?>[interfacesList.size()]),new VelocityBeanHandler(bean,_classLoader));
      _velocityBeans.put(name,bean);
    }
    return bean;
  }
 else {
    return _applicationContext.getBean(name);
  }
}
