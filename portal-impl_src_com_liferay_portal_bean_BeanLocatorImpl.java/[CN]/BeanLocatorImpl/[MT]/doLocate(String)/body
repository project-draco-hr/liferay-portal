{
  if (_log.isDebugEnabled()) {
    _log.debug("Locating " + name);
  }
  if (name.equals("portletClassLoader")) {
    SecurityManager securityManager=System.getSecurityManager();
    if (securityManager != null) {
      Permission permission=new RuntimePermission(PACLConstants.RUNTIME_PERMISSION_GET_CLASSLOADER.concat(StringPool.PERIOD).concat(_paclServletContextName));
      securityManager.checkPermission(permission);
    }
  }
  if (name.endsWith(VELOCITY_SUFFIX)) {
    Object velocityBean=_velocityBeans.get(name);
    if (velocityBean == null) {
      String originalName=name.substring(0,name.length() - VELOCITY_SUFFIX.length());
      Object bean=_applicationContext.getBean(originalName);
      velocityBean=ProxyUtil.newProxyInstance(_classLoader,getInterfaces(bean),new VelocityBeanHandler(bean,_classLoader));
      _velocityBeans.put(name,velocityBean);
    }
    return velocityBean;
  }
  Object bean=_applicationContext.getBean(name);
  if (_paclWrapPersistence && (bean != null) && (bean instanceof BasePersistence)) {
    Object paclPersistenceBean=_paclPersistenceBeans.get(name);
    if (paclPersistenceBean != null) {
      return paclPersistenceBean;
    }
    paclPersistenceBean=ProxyUtil.newProxyInstance(_classLoader,getInterfaces(bean),new PACLBeanHandler(bean));
    _paclPersistenceBeans.put(name,paclPersistenceBean);
    return paclPersistenceBean;
  }
  return bean;
}
