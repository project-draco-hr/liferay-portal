{
  ClusterMasterExecutorImpl clusterMasterExecutorImpl=createMasterExecutorImpl(true);
  MockClusterExecutor mockClusterExecutor=new MockClusterExecutor(true);
  String otherClusterNodeId=mockClusterExecutor.addClusterNode();
  clusterMasterExecutorImpl.setClusterExecutor(mockClusterExecutor);
  clusterMasterExecutorImpl.activate();
  Assert.assertTrue(clusterMasterExecutorImpl.isMaster());
  MockClusterMasterTokenTransitionListener mockClusterMasterTokenTransitionListener=new MockClusterMasterTokenTransitionListener();
  clusterMasterExecutorImpl.addClusterMasterTokenTransitionListener(mockClusterMasterTokenTransitionListener);
  _mockLockLocalService.setLock(otherClusterNodeId);
  clusterMasterExecutorImpl.getMasterClusterNodeId(true);
  Assert.assertFalse(clusterMasterExecutorImpl.isMaster());
  Assert.assertTrue(mockClusterMasterTokenTransitionListener.isMasterTokenReleasedNotified());
  _mockLockLocalService.setLock(mockClusterExecutor.getLocalClusterNodeId());
  clusterMasterExecutorImpl.getMasterClusterNodeId(true);
  Assert.assertTrue(clusterMasterExecutorImpl.isMaster());
  Assert.assertTrue(mockClusterMasterTokenTransitionListener.isMasterTokenAcquiredNotified());
}
