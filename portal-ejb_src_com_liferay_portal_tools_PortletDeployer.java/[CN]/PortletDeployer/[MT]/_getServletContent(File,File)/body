{
  StringMaker sm=new StringMaker();
  SAXReader reader=SAXReaderFactory.getInstance(false);
  Document doc=reader.read(portletXML);
  Element root=doc.getRootElement();
  Iterator itr1=root.elements("portlet").iterator();
  while (itr1.hasNext()) {
    Element portlet=(Element)itr1.next();
    String portletName=PortalUtil.getJsSafePortletName(portlet.elementText("portlet-name"));
    String portletClass=portlet.elementText("portlet-class");
    sm.append("<servlet>");
    sm.append("<servlet-name>");
    sm.append(portletName);
    sm.append("</servlet-name>");
    sm.append("<servlet-class>");
    sm.append("com.liferay.portal.kernel.servlet.PortletServlet");
    sm.append("</servlet-class>");
    sm.append("<init-param>");
    sm.append("<param-name>portlet-class</param-name>");
    sm.append("<param-value>");
    sm.append(portletClass);
    sm.append("</param-value>");
    sm.append("</init-param>");
    sm.append("<load-on-startup>0</load-on-startup>");
    sm.append("</servlet>");
    sm.append("<servlet-mapping>");
    sm.append("<servlet-name>");
    sm.append(portletName);
    sm.append("</servlet-name>");
    sm.append("<url-pattern>/");
    sm.append(portletName);
    sm.append("/*</url-pattern>");
    sm.append("</servlet-mapping>");
  }
  reader=SAXReaderFactory.getInstance(false);
  doc=reader.read(webXML);
  root=doc.getRootElement();
  itr1=root.elements("servlet").iterator();
  while (itr1.hasNext()) {
    Element servlet=(Element)itr1.next();
    String icon=servlet.elementText("icon");
    String servletName=servlet.elementText("servlet-name");
    String displayName=servlet.elementText("display-name");
    String description=servlet.elementText("description");
    String servletClass=servlet.elementText("servlet-class");
    List initParams=servlet.elements("init-param");
    String loadOnStartup=servlet.elementText("load-on-startup");
    String runAs=servlet.elementText("run-as");
    List securityRoleRefs=servlet.elements("security-role-ref");
    if ((servletClass != null) && (servletClass.equals("com.liferay.portal.servlet.SharedServletWrapper"))) {
      sm.append("<servlet>");
      if (icon != null) {
        sm.append("<icon>");
        sm.append(icon);
        sm.append("</icon>");
      }
      if (servletName != null) {
        sm.append("<servlet-name>");
        sm.append(servletName);
        sm.append("</servlet-name>");
      }
      if (displayName != null) {
        sm.append("<display-name>");
        sm.append(displayName);
        sm.append("</display-name>");
      }
      if (description != null) {
        sm.append("<description>");
        sm.append(description);
        sm.append("</description>");
      }
      Iterator itr2=initParams.iterator();
      while (itr2.hasNext()) {
        Element initParam=(Element)itr2.next();
        String paramName=initParam.elementText("param-name");
        String paramValue=initParam.elementText("param-value");
        if ((paramName != null) && (paramName.equals("servlet-class"))) {
          sm.append("<servlet-class>");
          sm.append(paramValue);
          sm.append("</servlet-class>");
        }
      }
      itr2=initParams.iterator();
      while (itr2.hasNext()) {
        Element initParam=(Element)itr2.next();
        String paramName=initParam.elementText("param-name");
        String paramValue=initParam.elementText("param-value");
        String paramDesc=initParam.elementText("description");
        if ((paramName != null) && (!paramName.equals("servlet-class"))) {
          sm.append("<init-param>");
          sm.append("<param-name>");
          sm.append(paramName);
          sm.append("</param-name>");
          if (paramValue != null) {
            sm.append("<param-value>");
            sm.append(paramValue);
            sm.append("</param-value>");
          }
          if (paramDesc != null) {
            sm.append("<description>");
            sm.append(paramDesc);
            sm.append("</description>");
          }
          sm.append("</init-param>");
        }
      }
      if (loadOnStartup != null) {
        sm.append("<load-on-startup>");
        sm.append(loadOnStartup);
        sm.append("</load-on-startup>");
      }
      if (runAs != null) {
        sm.append("<run-as>");
        sm.append(runAs);
        sm.append("</run-as>");
      }
      itr2=securityRoleRefs.iterator();
      while (itr2.hasNext()) {
        Element roleRef=(Element)itr2.next();
        String roleDesc=roleRef.elementText("description");
        String roleName=roleRef.elementText("role-name");
        String roleLink=roleRef.elementText("role-link");
        sm.append("<security-role-ref>");
        if (roleDesc != null) {
          sm.append("<description>");
          sm.append(roleDesc);
          sm.append("</description>");
        }
        if (roleName != null) {
          sm.append("<role-name>");
          sm.append(roleName);
          sm.append("</role-name>");
        }
        if (roleLink != null) {
          sm.append("<role-link>");
          sm.append(roleLink);
          sm.append("</role-link>");
        }
        sm.append("</security-role-ref>");
      }
      sm.append("</servlet>");
    }
  }
  return sm.toString();
}
