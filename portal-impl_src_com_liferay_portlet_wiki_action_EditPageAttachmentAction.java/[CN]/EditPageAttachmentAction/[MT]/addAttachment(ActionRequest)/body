{
  UploadPortletRequest uploadReq=PortalUtil.getUploadPortletRequest(req);
  long nodeId=ParamUtil.getLong(req,"nodeId");
  String title=ParamUtil.getString(req,"title");
  int numOfFiles=ParamUtil.getInteger(req,"numOfFiles",0);
  List<ObjectValuePair> files=new ArrayList<ObjectValuePair>();
  if (numOfFiles == 0) {
    File file=uploadReq.getFile("file");
    String fileName=uploadReq.getFileName("file");
    if (file != null) {
      byte[] bytes=FileUtil.getBytes(file);
      if ((bytes != null) && (bytes.length > 0)) {
        ObjectValuePair ovp=new ObjectValuePair(fileName,bytes);
        files.add(ovp);
      }
    }
  }
 else {
    for (int i=1; i <= numOfFiles; i++) {
      File file=uploadReq.getFile("file" + i);
      String fileName=uploadReq.getFileName("file" + i);
      if (file != null) {
        byte[] bytes=FileUtil.getBytes(file);
        if ((bytes != null) && (bytes.length > 0)) {
          ObjectValuePair ovp=new ObjectValuePair(fileName,bytes);
          files.add(ovp);
        }
      }
    }
  }
  WikiPageServiceUtil.addPageAttachments(nodeId,title,files);
}
