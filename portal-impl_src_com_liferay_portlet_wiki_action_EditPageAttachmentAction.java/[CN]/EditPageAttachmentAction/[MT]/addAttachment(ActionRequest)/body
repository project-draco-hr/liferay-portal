{
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  long nodeId=ParamUtil.getLong(actionRequest,"nodeId");
  String title=ParamUtil.getString(actionRequest,"title");
  int numOfFiles=ParamUtil.getInteger(actionRequest,"numOfFiles");
  List<ObjectValuePair<String,File>> files=new ArrayList<ObjectValuePair<String,File>>();
  if (numOfFiles == 0) {
    File file=uploadPortletRequest.getFile("file");
    String fileName=uploadPortletRequest.getFileName("file");
    if ((file != null) && file.exists()) {
      ObjectValuePair<String,File> ovp=new ObjectValuePair<String,File>(fileName,file);
      files.add(ovp);
    }
  }
 else {
    for (int i=1; i <= numOfFiles; i++) {
      File file=uploadPortletRequest.getFile("file" + i);
      String fileName=uploadPortletRequest.getFileName("file" + i);
      if ((file != null) && file.exists()) {
        ObjectValuePair<String,File> ovp=new ObjectValuePair<String,File>(fileName,file);
        files.add(ovp);
      }
    }
  }
  WikiPageServiceUtil.addPageAttachments(nodeId,title,files);
}
