{
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  long nodeId=ParamUtil.getLong(actionRequest,"nodeId");
  String title=ParamUtil.getString(actionRequest,"title");
  int numOfFiles=ParamUtil.getInteger(actionRequest,"numOfFiles");
  List<ObjectValuePair<String,InputStream>> inputStreamEntries=new ArrayList<ObjectValuePair<String,InputStream>>();
  try {
    if (numOfFiles == 0) {
      InputStream inputStream=uploadPortletRequest.getFileAsStream("file");
      String fileName=uploadPortletRequest.getFileName("file");
      if (inputStream != null) {
        ObjectValuePair<String,InputStream> ovp=new ObjectValuePair<String,InputStream>(fileName,inputStream);
        inputStreamEntries.add(ovp);
      }
    }
 else {
      for (int i=1; i <= numOfFiles; i++) {
        InputStream inputStream=uploadPortletRequest.getFileAsStream("file" + i);
        String fileName=uploadPortletRequest.getFileName("file" + i);
        if (inputStream != null) {
          ObjectValuePair<String,InputStream> ovp=new ObjectValuePair<String,InputStream>(fileName,inputStream);
          inputStreamEntries.add(ovp);
        }
      }
    }
    WikiPageServiceUtil.addPageAttachments(nodeId,title,inputStreamEntries);
  }
  finally {
    for (    ObjectValuePair<String,InputStream> inputStreamEntry : inputStreamEntries) {
      InputStream inputStream=inputStreamEntry.getValue();
      StreamUtil.cleanUp(inputStream);
    }
  }
}
