{
  Long messageId=mbMessageIds.get(mbMessage.getMessageId());
  if (messageId != null) {
    return messageId;
  }
  messageId=_counterLocalService.increment();
  addMBMessage(PortalUUIDUtil.generate(),messageId,mbMessage.getGroupId(),mbMessage.getCompanyId(),mbMessage.getUserId(),mbMessage.getUserName(),mbMessage.getCreateDate(),mbMessage.getModifiedDate(),_classNameLocalService.getClassNameId(CalendarBooking.class.getName()),calendarBookingId,mbMessage.getCategoryId(),threadId,mbMessage.getRootMessageId(),mbMessage.getParentMessageId(),mbMessage.getSubject(),mbMessage.getBody(),mbMessage.getFormat(),mbMessage.isAnonymous(),mbMessage.getPriority(),mbMessage.getAllowPingbacks(),mbMessage.isAnswer(),mbMessage.getStatus(),mbMessage.getStatusByUserId(),mbMessage.getStatusByUserName(),mbMessage.getStatusDate(),mbMessageIds);
  importRatings(MBDiscussion.class.getName(),mbMessage.getMessageId(),MBDiscussion.class.getName(),messageId);
  mbMessageIds.put(mbMessage.getMessageId(),messageId);
  return messageId;
}
