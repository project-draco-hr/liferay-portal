{
  FilterConfig filterConfig=getFilterConfig();
  Enumeration<String> enu=filterConfig.getInitParameterNames();
  while (enu.hasMoreElements()) {
    String name=enu.nextElement();
    if (_requestHeaderIgnoreInitParams.contains(name)) {
      continue;
    }
    String value=filterConfig.getInitParameter(name);
    if (name.equals(HttpHeaders.EXPIRES) && Validator.isNumber(value)) {
      int seconds=GetterUtil.getInteger(value);
      Calendar cal=new GregorianCalendar();
      cal.add(Calendar.SECOND,seconds);
      value=_dateFormat.format(cal.getTime());
    }
    boolean addHeader=true;
    if (StringUtil.equalsIgnoreCase(name,HttpHeaders.CACHE_CONTROL) || StringUtil.equalsIgnoreCase(name,HttpHeaders.EXPIRES)) {
      HttpSession session=request.getSession(false);
      if ((session == null) || session.isNew()) {
        String contextPath=request.getContextPath();
        if (StringUtil.equalsIgnoreCase(name,HttpHeaders.EXPIRES)) {
          addHeader=false;
        }
 else         if (PropsValues.WEB_SERVER_PROXY_LEGACY_MODE && contextPath.equals(PortalUtil.getPathContext())) {
          addHeader=false;
        }
      }
    }
    if (addHeader) {
      response.addHeader(name,value);
    }
  }
  long lastModified=getLastModified(request);
  long ifModifiedSince=request.getDateHeader(HttpHeaders.IF_MODIFIED_SINCE);
  if (lastModified > 0) {
    response.setDateHeader(HttpHeaders.LAST_MODIFIED,lastModified);
    if (lastModified <= ifModifiedSince) {
      response.setDateHeader(HttpHeaders.LAST_MODIFIED,ifModifiedSince);
      response.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
      return;
    }
  }
  processFilter(HeaderFilter.class.getName(),request,response,filterChain);
}
