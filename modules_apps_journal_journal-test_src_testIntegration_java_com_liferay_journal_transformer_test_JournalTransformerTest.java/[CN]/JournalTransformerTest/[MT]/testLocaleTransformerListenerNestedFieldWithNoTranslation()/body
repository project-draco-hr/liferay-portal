{
  Map<String,String> tokens=getTokens();
  Map<Locale,String> contents=new HashMap<>();
  contents.put(LocaleUtil.US,"Joe Bloggs");
  String xml=DDMStructureTestUtil.getSampleStructuredContent(contents,LanguageUtil.getLanguageId(LocaleUtil.US));
  Document document=UnsecureSAXReaderUtil.read(xml);
  Element rootElement=document.getRootElement();
  Attribute availableLocalesAttribute=rootElement.attribute("available-locales");
  availableLocalesAttribute.setValue("en_US,pt_BR");
  Element dynamicElement=(Element)document.selectSingleNode("//dynamic-element");
  dynamicElement.addElement("nestedElement");
  String script="$name.getData()";
  String content=JournalUtil.transform(null,tokens,Constants.VIEW,"en_US",document,null,script,TemplateConstants.LANG_TYPE_VM);
  Assert.assertEquals("Joe Bloggs",content);
  content=JournalUtil.transform(null,tokens,Constants.VIEW,"pt_BR",document,null,script,TemplateConstants.LANG_TYPE_VM);
  Assert.assertEquals("Joe Bloggs",content);
}
