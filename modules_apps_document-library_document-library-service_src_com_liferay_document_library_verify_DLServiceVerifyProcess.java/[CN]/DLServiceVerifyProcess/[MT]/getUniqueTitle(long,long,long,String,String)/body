{
  String titleExtension=StringPool.BLANK;
  String titleWithoutExtension=title;
  if (title.endsWith(StringPool.PERIOD.concat(extension))) {
    titleExtension=extension;
    titleWithoutExtension=FileUtil.stripExtension(title);
  }
  String uniqueTitle=title;
  for (int i=1; ; ) {
    String uniqueFileName=DLUtil.getSanitizedFileName(uniqueTitle,extension);
    try {
      DLFileEntryLocalServiceUtil.validateFile(groupId,folderId,fileEntryId,uniqueFileName,uniqueTitle);
      return uniqueTitle;
    }
 catch (    PortalException pe) {
      if (!(pe instanceof DuplicateFolderNameException) && !(pe instanceof DuplicateFileException)) {
        throw pe;
      }
    }
    uniqueTitle=titleWithoutExtension + StringPool.UNDERLINE + String.valueOf(i++);
    if (Validator.isNotNull(titleExtension)) {
      uniqueTitle=uniqueTitle.concat(StringPool.PERIOD.concat(titleExtension));
    }
  }
}
