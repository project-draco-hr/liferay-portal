{
  jsonObject.put("success",Boolean.FALSE);
  if (pe instanceof AntivirusScannerException || pe instanceof EntryImageNameException || pe instanceof EntryImageSizeException|| pe instanceof FileNameException) {
    String errorMessage=StringPool.BLANK;
    int errorType=0;
    ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
    if (pe instanceof AntivirusScannerException) {
      errorType=ServletResponseConstants.SC_FILE_ANTIVIRUS_EXCEPTION;
      AntivirusScannerException ase=(AntivirusScannerException)pe;
      errorMessage=themeDisplay.translate(ase.getMessageKey());
    }
 else     if (pe instanceof EntryImageNameException) {
      errorType=ServletResponseConstants.SC_FILE_EXTENSION_EXCEPTION;
    }
 else     if (pe instanceof EntryImageSizeException) {
      errorType=ServletResponseConstants.SC_FILE_SIZE_EXCEPTION;
    }
 else     if (pe instanceof FileNameException) {
      errorType=ServletResponseConstants.SC_FILE_NAME_EXCEPTION;
    }
    JSONObject errorJSONObject=JSONFactoryUtil.createJSONObject();
    errorJSONObject.put("errorType",errorType);
    errorJSONObject.put("message",errorMessage);
    jsonObject.put("error",errorJSONObject);
    try {
      JSONPortletResponseUtil.writeJSON(portletRequest,portletResponse,jsonObject);
    }
 catch (    IOException ioe) {
      throw new SystemException(ioe);
    }
  }
 else {
    throw pe;
  }
}
