{
  Collection<KaleoTaskAssignment> configuredKaleoTaskAssignments=kaleoTask.getKaleoTaskAssignments();
  Collection<KaleoTaskAssignment> kaleoTaskAssignments=new ArrayList<>();
  for (  KaleoTaskAssignment configuredKaleoTaskAssignment : configuredKaleoTaskAssignments) {
    String assigneeClassName=configuredKaleoTaskAssignment.getAssigneeClassName();
    TaskAssignmentSelector taskAssignmentSelector=_taskAssignmentSelectorTracker.getTaskAssignmentSelector(assigneeClassName);
    Collection<KaleoTaskAssignment> calculatedKaleoTaskAssignments=taskAssignmentSelector.calculateTaskAssignments(configuredKaleoTaskAssignment,executionContext);
    kaleoTaskAssignments.addAll(calculatedKaleoTaskAssignments);
  }
  if (kaleoTaskAssignments.isEmpty()) {
    Collection<KaleoTaskAssignment> organizationKaleoTaskAssignments=getOrganizationKaleoTaskAssignments(configuredKaleoTaskAssignments,executionContext);
    kaleoTaskAssignments.addAll(organizationKaleoTaskAssignments);
  }
  return _kaleoTaskInstanceTokenLocalService.addKaleoTaskInstanceToken(kaleoInstanceToken.getKaleoInstanceTokenId(),kaleoTask.getKaleoTaskId(),kaleoTask.getName(),kaleoTaskAssignments,dueDate,workflowContext,serviceContext);
}
