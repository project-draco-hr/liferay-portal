{
  try {
    Long userId=(Long)session.getAttribute(WebKeys.USER_ID);
    if (userId != null) {
      User user=UserLocalServiceUtil.getUser(userId);
      if (!user.isDefaultUser()) {
        if (_log.isDebugEnabled()) {
          _log.debug("Destroying channel " + user.getUserId());
        }
        try {
          ChannelHubManagerUtil.destroyChannel(user.getCompanyId(),user.getUserId());
        }
 catch (        UnknownChannelException e) {
          if (_log.isDebugEnabled()) {
            _log.debug("User channel already unregistered: " + userId,e);
          }
        }
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
