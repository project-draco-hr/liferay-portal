{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portlet.getPortletId());
  Set<String> allPortletModes=portlet.getAllPortletModes();
  for (  String portletMode : allPortletModes) {
    String mobileDevicesParam="portlet-setup-supported-clients-mobile-devices-" + portletMode;
    boolean mobileDevices=ParamUtil.getBoolean(req,mobileDevicesParam);
    portletSetup.setValue(mobileDevicesParam,String.valueOf(mobileDevices));
  }
  portletSetup.store();
}
