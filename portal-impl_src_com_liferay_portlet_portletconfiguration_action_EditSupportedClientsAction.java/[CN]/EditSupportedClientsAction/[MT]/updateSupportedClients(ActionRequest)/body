{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  String portletResource=ParamUtil.getString(req,"portletResource");
  PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getPortletSetup(req,portletResource);
  Portlet portlet=PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),portletResource);
  Set allPortletModes=portlet.getAllPortletModes();
  Iterator itr=allPortletModes.iterator();
  while (itr.hasNext()) {
    String portletMode=(String)itr.next();
    String mobileDevicesParam="portlet-setup-supported-clients-mobile-devices-" + portletMode;
    boolean mobileDevices=ParamUtil.getBoolean(req,mobileDevicesParam);
    portletSetup.setValue(mobileDevicesParam,String.valueOf(mobileDevices));
  }
  portletSetup.store();
}
