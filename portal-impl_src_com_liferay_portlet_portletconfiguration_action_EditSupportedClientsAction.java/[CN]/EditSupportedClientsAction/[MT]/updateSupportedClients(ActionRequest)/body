{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  String portletResource=ParamUtil.getString(req,"portletResource");
  PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getPortletSetup(layout,portletResource);
  Portlet portlet=PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),portletResource);
  Set<String> allPortletModes=portlet.getAllPortletModes();
  for (  String portletMode : allPortletModes) {
    String mobileDevicesParam="portlet-setup-supported-clients-mobile-devices-" + portletMode;
    boolean mobileDevices=ParamUtil.getBoolean(req,mobileDevicesParam);
    portletSetup.setValue(mobileDevicesParam,String.valueOf(mobileDevices));
  }
  portletSetup.store();
}
