{
  boolean undeployEnabled=PrefsPropsUtil.getBoolean(PropsKeys.HOT_UNDEPLOY_ENABLED,PropsValues.HOT_UNDEPLOY_ENABLED);
  if (!undeployEnabled) {
    return;
  }
  if (!appServerType.startsWith(ServerDetector.JBOSS_ID) && !appServerType.equals(ServerDetector.TOMCAT_ID)) {
    return;
  }
  if (!deployDir.exists()) {
    return;
  }
  File webXml=new File(deployDir + "/WEB-INF/web.xml");
  if (!webXml.exists()) {
    return;
  }
  if (_log.isInfoEnabled()) {
    _log.info("Undeploy " + deployDir);
  }
  FileUtil.delete(deployDir + "/WEB-INF/web.xml");
  DeleteTask.deleteDirectory(deployDir);
  if (ServerDetector.isJetty()) {
    FileUtil.delete(System.getProperty("jetty.home") + "/contexts/" + deployDir.getName()+ ".xml");
  }
  if (ServerDetector.isJBoss()) {
    File deployedFile=new File(deployDir.getParent(),deployDir.getName() + ".deployed");
    FileUtil.delete(deployedFile);
  }
  int undeployInterval=PrefsPropsUtil.getInteger(PropsKeys.HOT_UNDEPLOY_INTERVAL,PropsValues.HOT_UNDEPLOY_INTERVAL);
  if (_log.isInfoEnabled()) {
    _log.info("Wait " + undeployInterval + " ms to allow the plugin time to fully undeploy");
  }
  if (undeployInterval > 0) {
    Thread.sleep(undeployInterval);
  }
}
