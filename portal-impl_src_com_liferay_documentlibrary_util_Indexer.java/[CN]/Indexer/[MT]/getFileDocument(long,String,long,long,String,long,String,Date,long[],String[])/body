{
  long scopeGroupId=groupId;
  try {
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    if (group.isLayout()) {
      groupId=group.getParentGroupId();
    }
  }
 catch (  Exception e) {
  }
  if (fileEntryId <= 0) {
    _log.debug("Not indexing document " + companyId + " "+ portletId+ " "+ scopeGroupId+ " "+ repositoryId+ " "+ fileName+ " "+ fileEntryId);
    return null;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Indexing document " + companyId + " "+ portletId+ " "+ scopeGroupId+ " "+ repositoryId+ " "+ fileName+ " "+ fileEntryId);
  }
  String fileExt=StringPool.BLANK;
  int fileExtVersionPos=fileName.indexOf(DLServiceImpl.VERSION);
  if (fileExtVersionPos != -1) {
    int fileExtPos=fileName.lastIndexOf(StringPool.PERIOD,fileExtVersionPos);
    if (fileExtPos != -1) {
      fileExt=fileName.substring(fileExtPos,fileExtVersionPos);
    }
  }
 else {
    int fileExtPos=fileName.lastIndexOf(StringPool.PERIOD);
    if (fileExtPos != -1) {
      fileExt=fileName.substring(fileExtPos,fileName.length());
    }
  }
  InputStream is=null;
  try {
    Hook hook=HookFactory.getInstance();
    is=hook.getFileAsStream(companyId,repositoryId,fileName);
  }
 catch (  Exception e) {
  }
  if (is == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Document " + companyId + " "+ portletId+ " "+ scopeGroupId+ " "+ repositoryId+ " "+ fileName+ " "+ fileEntryId+ " does not have any content");
    }
    return null;
  }
  Document doc=new DocumentImpl();
  doc.addUID(portletId,repositoryId,fileName);
  doc.addModifiedDate(modifiedDate);
  doc.addKeyword(Field.COMPANY_ID,companyId);
  doc.addKeyword(Field.PORTLET_ID,portletId);
  doc.addKeyword(Field.GROUP_ID,groupId);
  doc.addKeyword(Field.SCOPE_GROUP_ID,scopeGroupId);
  try {
    doc.addFile(Field.CONTENT,is,fileExt);
  }
 catch (  IOException ioe) {
    throw new SearchException("Cannot extract text from file" + companyId + " "+ portletId+ " "+ scopeGroupId+ " "+ repositoryId+ " "+ fileName);
  }
  doc.addText(Field.PROPERTIES,properties);
  doc.addKeyword(Field.ASSET_CATEGORY_IDS,assetCategoryIds);
  doc.addKeyword(Field.ASSET_TAG_NAMES,assetTagNames);
  doc.addKeyword("repositoryId",repositoryId);
  doc.addKeyword("path",fileName);
  doc.addKeyword(Field.ENTRY_CLASS_NAME,DLFileEntry.class.getName());
  doc.addKeyword(Field.ENTRY_CLASS_PK,fileEntryId);
  ExpandoBridge expandoBridge=new ExpandoBridgeImpl(DLFileEntry.class.getName(),fileEntryId);
  ExpandoBridgeIndexerUtil.addAttributes(doc,expandoBridge);
  if (_log.isDebugEnabled()) {
    _log.debug("Document " + companyId + " "+ portletId+ " "+ scopeGroupId+ " "+ repositoryId+ " "+ fileName+ " "+ fileEntryId+ " indexed successfully");
  }
  return doc;
}
