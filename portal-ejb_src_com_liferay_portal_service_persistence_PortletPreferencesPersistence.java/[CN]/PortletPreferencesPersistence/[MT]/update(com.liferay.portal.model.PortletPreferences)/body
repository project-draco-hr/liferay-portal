{
  Session session=null;
  try {
    if (portletPreferences.isNew() || portletPreferences.isModified()) {
      session=openSession();
      if (portletPreferences.isNew()) {
        PortletPreferencesHBM portletPreferencesHBM=new PortletPreferencesHBM();
        portletPreferencesHBM.setPortletId(portletPreferences.getPortletId());
        portletPreferencesHBM.setLayoutId(portletPreferences.getLayoutId());
        portletPreferencesHBM.setOwnerId(portletPreferences.getOwnerId());
        portletPreferencesHBM.setPreferences(portletPreferences.getPreferences());
        session.save(portletPreferencesHBM);
        session.flush();
      }
 else {
        PortletPreferencesHBM portletPreferencesHBM=(PortletPreferencesHBM)session.get(PortletPreferencesHBM.class,portletPreferences.getPrimaryKey());
        if (portletPreferencesHBM != null) {
          portletPreferencesHBM.setPreferences(portletPreferences.getPreferences());
          session.flush();
        }
 else {
          portletPreferencesHBM=new PortletPreferencesHBM();
          portletPreferencesHBM.setPortletId(portletPreferences.getPortletId());
          portletPreferencesHBM.setLayoutId(portletPreferences.getLayoutId());
          portletPreferencesHBM.setOwnerId(portletPreferences.getOwnerId());
          portletPreferencesHBM.setPreferences(portletPreferences.getPreferences());
          session.save(portletPreferencesHBM);
          session.flush();
        }
      }
      portletPreferences.setNew(false);
      portletPreferences.setModified(false);
    }
    return portletPreferences;
  }
 catch (  HibernateException he) {
    throw new SystemException(he);
  }
 finally {
    closeSession(session);
  }
}
