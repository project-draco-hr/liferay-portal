{
  HttpServletRequest request=PortalUtil.getHttpServletRequest(actionRequest);
  HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
  String login=ParamUtil.getString(actionRequest,"login");
  String password=actionRequest.getParameter("password");
  boolean rememberMe=ParamUtil.getBoolean(actionRequest,"rememberMe");
  if (!themeDisplay.isSignedIn()) {
    String portletId=PortalUtil.getPortletId(actionRequest);
    PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.getStrictPortletSetup(themeDisplay.getLayout(),portletId);
    String authType=portletPreferences.getValue("authType",null);
    AuthenticatedSessionManagerUtil.login(request,response,login,password,rememberMe,authType);
  }
  String redirect=ParamUtil.getString(actionRequest,"redirect");
  if (Validator.isNotNull(redirect)) {
    redirect=PortalUtil.escapeRedirect(redirect);
    if (Validator.isNotNull(redirect) && !redirect.startsWith(Http.HTTP)) {
      redirect=getCompleteRedirectURL(request,redirect);
    }
  }
  String mainPath=themeDisplay.getPathMain();
  if (PropsValues.PORTAL_JAAS_ENABLE) {
    if (Validator.isNotNull(redirect)) {
      redirect=mainPath.concat("/portal/protected?redirect=").concat(HttpUtil.encodeURL(redirect));
    }
 else {
      redirect=mainPath.concat("/portal/protected");
    }
    actionResponse.sendRedirect(redirect);
  }
 else {
    if (Validator.isNotNull(redirect)) {
      actionResponse.sendRedirect(redirect);
    }
 else {
      boolean doActionAfterLogin=ParamUtil.getBoolean(actionRequest,"doActionAfterLogin");
      if (doActionAfterLogin) {
        return;
      }
 else {
        actionResponse.sendRedirect(mainPath);
      }
    }
  }
}
