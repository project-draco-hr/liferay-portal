{
  SimpleHTMLFormatter simpleHTMLFormatter=new SimpleHTMLFormatter(preTag,postTag);
  QueryScorer queryScorer=new QueryScorer(query,field);
  Highlighter highlighter=new Highlighter(simpleHTMLFormatter,queryScorer);
  highlighter.setTextFragmenter(new SimpleFragmenter(fragmentLength));
  TokenStream tokenStream=getAnalyzer().tokenStream(field,new UnsyncStringReader(s));
  try {
    String snippet=highlighter.getBestFragments(tokenStream,s,maxNumFragments,fragmentSuffix);
    if (Validator.isNotNull(snippet) && !StringUtil.endsWith(snippet,fragmentSuffix)) {
      snippet=snippet + fragmentSuffix;
    }
    return snippet;
  }
 catch (  InvalidTokenOffsetsException itoe) {
    throw new IOException(itoe.getMessage());
  }
}
