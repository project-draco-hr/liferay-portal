{
  HttpServletRequest request=PortalUtil.getHttpServletRequest(actionRequest);
  HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
  HttpSession session=request.getSession();
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  String languageId=ParamUtil.getString(actionRequest,"languageId");
  Locale locale=LocaleUtil.fromLanguageId(languageId);
  List<Locale> availableLocales=ListUtil.fromArray(LanguageUtil.getAvailableLocales());
  if (availableLocales.contains(locale)) {
    if (themeDisplay.isSignedIn()) {
      User user=themeDisplay.getUser();
      Contact contact=user.getContact();
      AdminUtil.updateUser(actionRequest,user.getUserId(),user.getScreenName(),user.getEmailAddress(),user.getOpenId(),languageId,user.getTimeZoneId(),user.getGreeting(),user.getComments(),contact.getSmsSn(),contact.getAimSn(),contact.getFacebookSn(),contact.getIcqSn(),contact.getJabberSn(),contact.getMsnSn(),contact.getMySpaceSn(),contact.getSkypeSn(),contact.getTwitterSn(),contact.getYmSn());
    }
    session.setAttribute(Globals.LOCALE_KEY,locale);
    LanguageUtil.updateCookie(response,locale);
  }
  String redirect=ParamUtil.getString(actionRequest,"redirect");
  if (Validator.isNull(redirect)) {
    redirect=PortalUtil.getLayoutURL(layout,themeDisplay);
    if (themeDisplay.isI18n()) {
      int pos=redirect.indexOf(StringPool.SLASH,1);
      redirect=redirect.substring(pos);
    }
  }
  actionResponse.sendRedirect(redirect);
}
