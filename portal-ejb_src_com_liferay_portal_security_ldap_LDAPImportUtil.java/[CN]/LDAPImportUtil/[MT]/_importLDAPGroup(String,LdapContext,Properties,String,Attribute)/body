{
  for (int i=0; i < attr.size(); i++) {
    String groupDN=(String)attr.get(i);
    Attributes groupAttrs=ctx.getAttributes(groupDN);
    String groupName=LDAPUtil.getAttributeValue(groupAttrs,groupMappings.getProperty("groupName"));
    String description=LDAPUtil.getAttributeValue(groupAttrs,groupMappings.getProperty("description"));
    UserGroup userGroup=null;
    try {
      userGroup=UserGroupLocalServiceUtil.getUserGroup(companyId,groupName);
    }
 catch (    NoSuchUserGroupException nsuge) {
      userGroup=UserGroupLocalServiceUtil.addUserGroup(User.getDefaultUserId(companyId),companyId,groupName,description);
    }
    if (userGroup != null) {
      if (_log.isDebugEnabled()) {
        _log.debug("Adding " + userId + " to group "+ groupName);
      }
      UserLocalServiceUtil.addUserGroupUsers(userGroup.getUserGroupId(),new String[]{userId});
    }
  }
}
