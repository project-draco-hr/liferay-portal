{
  InvokerPortlet invokerPortlet=null;
  boolean isRemote=portlet.isRemote();
  try {
    if (portletInstance == null && !isRemote) {
      portletInstance=(javax.portlet.Portlet)Class.forName(portlet.getPortletClass()).newInstance();
    }
    PortletContext portletContext=portletConfig.getPortletContext();
    if (isRemote || PropsValues.PORTLET_CONTAINER_IMPL_SUN) {
      invokerPortlet=new WindowInvoker(portlet,portletInstance,portletContext);
    }
 else {
      invokerPortlet=new InvokerPortlet(portlet,portletInstance,portletContext);
    }
    invokerPortlet.init(portletConfig);
  }
 catch (  ClassNotFoundException cnofe) {
    throw new UnavailableException(cnofe.getMessage());
  }
catch (  InstantiationException ie) {
    throw new UnavailableException(ie.getMessage());
  }
catch (  IllegalAccessException iae) {
    throw new UnavailableException(iae.getMessage());
  }
  return invokerPortlet;
}
