{
  Map<String,InvokerPortlet> portletInstances=_pool.get(portlet.getRootPortletId());
  if (portletInstances != null) {
    Iterator<Map.Entry<String,InvokerPortlet>> itr=portletInstances.entrySet().iterator();
    while (itr.hasNext()) {
      Map.Entry<String,InvokerPortlet> entry=itr.next();
      String portletId=entry.getKey();
      InvokerPortlet invokerPortletInstance=entry.getValue();
      if (PortletConstants.getInstanceId(portletId) == null) {
        invokerPortletInstance.destroy();
        break;
      }
    }
  }
  _pool.remove(portlet.getRootPortletId());
  PortletApp portletApp=portlet.getPortletApp();
  if (portletApp.isWARFile()) {
    PortletBag portletBag=PortletBagPool.get(portlet.getRootPortletId());
    if (portletBag != null) {
      portletBag.removePortletInstance();
    }
  }
  PortletConfigFactory.destroy(portlet);
  PortletContextFactory.destroy(portlet);
  PortletLocalServiceUtil.destroyPortlet(portlet);
}
