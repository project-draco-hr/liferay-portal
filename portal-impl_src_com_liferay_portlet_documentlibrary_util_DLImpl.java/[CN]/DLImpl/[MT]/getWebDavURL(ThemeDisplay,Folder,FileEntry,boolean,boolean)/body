{
  StringBundler webDavURL=new StringBundler(8);
  boolean secure=false;
  if (themeDisplay.isSecure() || PropsValues.WEBDAV_SERVLET_HTTPS_REQUIRED) {
    secure=true;
  }
  String portalURL=PortalUtil.getPortalURL(themeDisplay.getServerName(),themeDisplay.getServerPort(),secure);
  webDavURL.append(portalURL);
  webDavURL.append(themeDisplay.getPathContext());
  webDavURL.append("/webdav");
  if (manualCheckInRequired) {
    webDavURL.append(MANUAL_CHECK_IN_REQUIRED_PATH);
  }
  String fileEntryTitle=null;
  if (fileEntry != null) {
    String extension=fileEntry.getExtension();
    fileEntryTitle=HtmlUtil.unescape(fileEntry.getTitle());
    if (openDocumentUrl && isOfficeExtension(extension) && !fileEntryTitle.endsWith(StringPool.PERIOD + extension)) {
      webDavURL.append(OFFICE_EXTENSION_PATH);
      fileEntryTitle+=StringPool.PERIOD + extension;
    }
  }
  Group group=GroupLocalServiceUtil.getGroup(fileEntry.getGroupId());
  webDavURL.append(group.getFriendlyURL());
  webDavURL.append("/document_library");
  StringBuilder sb=new StringBuilder();
  if ((folder != null) && (folder.getFolderId() != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID)) {
    Folder curFolder=folder;
    while (true) {
      sb.insert(0,HttpUtil.encodeURL(curFolder.getName(),true));
      sb.insert(0,StringPool.SLASH);
      if (curFolder.getParentFolderId() == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
        break;
      }
      curFolder=DLAppLocalServiceUtil.getFolder(curFolder.getParentFolderId());
    }
  }
  if (fileEntry != null) {
    sb.append(StringPool.SLASH);
    sb.append(HttpUtil.encodeURL(fileEntryTitle,true));
  }
  webDavURL.append(sb.toString());
  return webDavURL.toString();
}
