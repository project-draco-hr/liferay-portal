{
  if (Validator.equals(serviceContext.getCommand(),Constants.ADD_WEBDAV) || Validator.equals(serviceContext.getCommand(),Constants.UPDATE_WEBDAV)) {
    return serviceContext.getPortalURL() + serviceContext.getCurrentURL();
  }
  String entryURL=GetterUtil.getString(serviceContext.getAttribute("entryURL"));
  if (Validator.isNotNull(entryURL)) {
    return entryURL;
  }
  HttpServletRequest request=serviceContext.getRequest();
  if ((request == null) || (serviceContext.getThemeDisplay() == null)) {
    return StringPool.BLANK;
  }
  long plid=serviceContext.getPlid();
  long controlPanelPlid=PortalUtil.getControlPanelPlid(serviceContext.getCompanyId());
  String portletId=PortletProviderUtil.getPortletId(FileEntry.class.getName(),PortletProvider.Action.VIEW);
  if (plid == controlPanelPlid) {
    plid=PortalUtil.getPlidFromPortletId(dlFileVersion.getGroupId(),portletId);
  }
  if (plid == LayoutConstants.DEFAULT_PLID) {
    plid=controlPanelPlid;
  }
  PortletURL portletURL=PortletURLFactoryUtil.create(request,portletId,plid,PortletRequest.RENDER_PHASE);
  portletURL.setParameter("mvcRenderCommandName","/document_library/view_file_entry");
  portletURL.setParameter("fileEntryId",String.valueOf(dlFileVersion.getFileEntryId()));
  return portletURL.toString();
}
