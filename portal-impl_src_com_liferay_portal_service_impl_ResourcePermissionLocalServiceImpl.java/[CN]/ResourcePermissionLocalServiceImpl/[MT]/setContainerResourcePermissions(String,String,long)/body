{
  List<Role> roles=rolePersistence.findByName(roleName);
  for (  Role role : roles) {
    long companyId=role.getCompanyId();
    long roleId=role.getRoleId();
    List<Group> groups=groupPersistence.findByCompanyId(companyId);
    for (    Group group : groups) {
      String primKey=Long.toString(group.getGroupId());
      long actionIdsLong=minimumBitwiseValue;
      ResourcePermission resourcePermission=resourcePermissionPersistence.fetchByC_N_S_P_R(companyId,name,ResourceConstants.SCOPE_INDIVIDUAL,primKey,roleId);
      if (resourcePermission == null) {
        long resourcePermissionId=counterLocalService.increment(ResourcePermission.class.getName());
        resourcePermission=resourcePermissionPersistence.create(resourcePermissionId);
        resourcePermission.setCompanyId(companyId);
        resourcePermission.setName(name);
        resourcePermission.setScope(ResourceConstants.SCOPE_INDIVIDUAL);
        resourcePermission.setPrimKey(primKey);
        resourcePermission.setRoleId(roleId);
        List<String> defaultActionIds=null;
        if (roleName.equals(RoleConstants.GUEST)) {
          defaultActionIds=ResourceActionsUtil.getModelResourceGuestDefaultActions(name);
        }
 else         if (roleName.equals(RoleConstants.SITE_MEMBER)) {
          defaultActionIds=ResourceActionsUtil.getModelResourceGroupDefaultActions(name);
        }
        List<ResourceAction> resourceActions=resourceActionLocalService.getResourceActions(name);
        for (        ResourceAction resourceAction : resourceActions) {
          if (defaultActionIds.contains(resourceAction.getActionId())) {
            actionIdsLong|=resourceAction.getBitwiseValue();
          }
        }
      }
      resourcePermission.setActionIds(actionIdsLong);
      resourcePermissionPersistence.update(resourcePermission,false);
    }
  }
}
