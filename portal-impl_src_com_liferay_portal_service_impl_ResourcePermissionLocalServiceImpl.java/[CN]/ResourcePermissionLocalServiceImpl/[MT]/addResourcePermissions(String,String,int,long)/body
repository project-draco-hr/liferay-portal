{
  List<Role> roles=rolePersistence.findByName(roleName);
  if (roles.isEmpty()) {
    return;
  }
  Session session=resourcePermissionPersistence.openSession();
  try {
    String sql=CustomSQLUtil.get(_UPDATE_ACTION_IDS);
    sql=StringUtil.replace(sql,"[$ROLE_ID$]",ListUtil.toString(roles,Role.ROLE_ID_ACCESSOR));
    SQLQuery sqlQuery=session.createSQLQuery(sql);
    QueryPos qPos=QueryPos.getInstance(sqlQuery);
    qPos.add(resourceActionBitwiseValue);
    qPos.add(resourceActionBitwiseValue);
    qPos.add(resourceName);
    qPos.add(scope);
    sqlQuery.executeUpdate();
    sql=CustomSQLUtil.get(_FIND_MISSING_RESOURCE_PERMISSIONS);
    sqlQuery=session.createSQLQuery(sql);
    sqlQuery.addScalar("TEMP_TABLE.companyId",Type.LONG);
    sqlQuery.addScalar("TEMP_TABLE.name",Type.STRING);
    sqlQuery.addScalar("TEMP_TABLE.scope",Type.INTEGER);
    sqlQuery.addScalar("TEMP_TABLE.primKey",Type.STRING);
    sqlQuery.addScalar("Role_.roleId",Type.LONG);
    qPos=QueryPos.getInstance(sqlQuery);
    qPos.add(resourceName);
    qPos.add(scope);
    qPos.add(roleName);
    List<Object[]> resourcePermissionArrays=sqlQuery.list(true);
    if (resourcePermissionArrays.isEmpty()) {
      return;
    }
    for (    Object[] resourcePermissionArray : resourcePermissionArrays) {
      long resourcePermissionId=counterLocalService.increment(ResourcePermission.class.getName());
      ResourcePermission resourcePermission=resourcePermissionPersistence.create(resourcePermissionId);
      resourcePermission.setCompanyId((Long)resourcePermissionArray[0]);
      resourcePermission.setName((String)resourcePermissionArray[1]);
      resourcePermission.setScope((Integer)resourcePermissionArray[2]);
      resourcePermission.setPrimKey((String)resourcePermissionArray[3]);
      resourcePermission.setRoleId((Long)resourcePermissionArray[4]);
      resourcePermission.setActionIds(resourceActionBitwiseValue);
      session.save(resourcePermission);
    }
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
 finally {
    resourcePermissionPersistence.closeSession(session);
    resourcePermissionPersistence.clearCache();
  }
}
