{
  List<Role> roles=rolePersistence.findByName(roleName);
  for (  Role role : roles) {
    List<String> primKeys=resourcePermissionFinder.findByC_N_S(role.getCompanyId(),resourceName,scope);
    for (    String primKey : primKeys) {
      List<ResourcePermission> resourcePermissions=resourcePermissionPersistence.findByC_N_S_P_R(role.getCompanyId(),resourceName,scope,primKey,role.getRoleId());
      ResourcePermission resourcePermission=null;
      if (resourcePermissions.isEmpty()) {
        long resourcePermissionId=counterLocalService.increment(ResourcePermission.class.getName());
        resourcePermission=resourcePermissionPersistence.create(resourcePermissionId);
        resourcePermission.setCompanyId(role.getCompanyId());
        resourcePermission.setName(resourceName);
        resourcePermission.setScope(scope);
        resourcePermission.setPrimKey(primKey);
        resourcePermission.setRoleId(role.getRoleId());
      }
 else {
        resourcePermission=resourcePermissions.get(0);
      }
      long actionIdsLong=resourcePermission.getActionIds();
      actionIdsLong|=resourceActionBitwiseValue;
      resourcePermission.setActionIds(actionIdsLong);
      resourcePermissionPersistence.update(resourcePermission,false);
    }
  }
}
