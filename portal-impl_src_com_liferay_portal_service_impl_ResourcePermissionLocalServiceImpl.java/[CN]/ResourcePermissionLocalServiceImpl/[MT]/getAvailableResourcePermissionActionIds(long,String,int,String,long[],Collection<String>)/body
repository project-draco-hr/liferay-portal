{
  List<ResourcePermission> resourcePermissions=resourcePermissionPersistence.findByC_N_S_P(companyId,name,scope,primKey);
  if (resourcePermissions.isEmpty()) {
    return Collections.emptyMap();
  }
  Map<Long,Set<String>> roleIdsToActionIds=new HashMap<Long,Set<String>>();
  Set<Long> roleIdsSet=SetUtil.fromArray(roleIds);
  for (  ResourcePermission resourcePermission : resourcePermissions) {
    long roleId=resourcePermission.getRoleId();
    if (!roleIdsSet.contains(roleId)) {
      continue;
    }
    Set<String> availableActionIds=roleIdsToActionIds.get(roleId);
    if (availableActionIds != null) {
      continue;
    }
    availableActionIds=new HashSet<String>();
    roleIdsToActionIds.put(roleId,availableActionIds);
    for (    String actionId : actionIds) {
      ResourceAction resourceAction=resourceActionLocalService.getResourceAction(name,actionId);
      if (hasActionId(resourcePermission,resourceAction)) {
        availableActionIds.add(actionId);
      }
    }
  }
  return roleIdsToActionIds;
}
