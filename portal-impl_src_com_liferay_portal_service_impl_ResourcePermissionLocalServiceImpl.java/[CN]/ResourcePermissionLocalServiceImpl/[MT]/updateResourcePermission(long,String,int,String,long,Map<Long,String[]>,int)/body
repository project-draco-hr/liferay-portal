{
  DB db=DBFactoryUtil.getDB();
  String dbType=db.getType();
  if (!dbType.equals(DB.TYPE_HYPERSONIC)) {
    doUpdateResourcePermission(companyId,name,scope,primKey,ownerId,roleIdsToActionIds,operator);
    return;
  }
  StringBundler sb=new StringBundler(9);
  sb.append(companyId);
  sb.append(StringPool.POUND);
  sb.append(name);
  sb.append(StringPool.POUND);
  sb.append(scope);
  sb.append(StringPool.POUND);
  sb.append(primKey);
  sb.append(StringPool.POUND);
  sb.append(StringUtil.merge(roleIdsToActionIds.keySet()));
  String groupName=getClass().getName();
  String key=sb.toString();
  Lock lock=LockRegistry.allocateLock(groupName,key);
  lock.lock();
  try {
    doUpdateResourcePermission(companyId,name,scope,primKey,ownerId,roleIdsToActionIds,operator);
  }
  finally {
    lock.unlock();
    LockRegistry.freeLock(groupName,key);
  }
}
