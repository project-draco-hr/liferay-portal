{
  Map<String,String[]> parameters=portletRequest.getParameterMap();
  String itemSelectedCallback=parameters.get(PARAMETER_ITEM_SELECTED_CALLBACK)[0];
  List<ItemSelectorCriterion> itemSelectorCriteria=getItemSelectorCriteria(parameters);
  ItemSelectorCriterion[] itemSelectorCriteriaArray=itemSelectorCriteria.toArray(new ItemSelectorCriterion[itemSelectorCriteria.size()]);
  List<ItemSelectorViewRenderer> itemSelectorViewRenderers=new ArrayList<>();
  for (int i=0; i < itemSelectorCriteria.size(); i++) {
    ItemSelectorCriterion itemSelectorCriterion=itemSelectorCriteria.get(i);
    ItemSelectorCriterionHandler<ItemSelectorCriterion> itemSelectorCriterionHandler=getItemSelectorCriterionHandler(itemSelectorCriterion.getClass());
    List<ItemSelectorView<ItemSelectorCriterion>> itemSelectorViews=itemSelectorCriterionHandler.getItemSelectorViews(itemSelectorCriterion);
    for (    ItemSelectorView<ItemSelectorCriterion> itemSelectorView : itemSelectorViews) {
      PortletURL portletURL=getItemSelectorURL(portletRequest,itemSelectedCallback,itemSelectorCriteriaArray);
      portletURL.setParameter(PARAMETER_SELECTED_TAB,itemSelectorView.getTitle(portletRequest.getLocale()));
      itemSelectorViewRenderers.add(new ItemSelectorViewRendererImpl(itemSelectorView,itemSelectorCriterion,portletURL,itemSelectedCallback));
    }
  }
  return new ItemSelectorRenderingImpl(parameters.get(PARAMETER_ITEM_SELECTED_CALLBACK)[0],parameters.get(PARAMETER_SELECTED_TAB)[0],itemSelectorViewRenderers);
}
