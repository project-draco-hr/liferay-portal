{
  List<Organization> organizations=organizationLocalService.getUserOrganizations(user.getUserId());
  for (  Organization organization : organizations) {
    if (!MembershipPolicyUtil.isMembershipAllowed(organization,user)) {
      userLocalService.unsetOrganizationUsers(organization.getOrganizationId(),new long[]{user.getUserId()});
    }
  }
  Set<Organization> mandatoryOrganizations=MembershipPolicyUtil.getMandatoryOrganizations(user);
  for (  Organization organization : mandatoryOrganizations) {
    if (!hasUserOrganization(user.getUserId(),organization.getOrganizationId())) {
      userLocalService.addOrganizationUsers(organization.getOrganizationId(),new long[]{user.getUserId()});
    }
  }
}
