{
  List<Organization> organizations=organizationLocalService.getUserOrganizations(user.getUserId());
  for (  Organization organization : organizations) {
    long organizationId=organization.getOrganizationId();
    long userId=user.getUserId();
    if (!MembershipPolicyUtil.isMembershipAllowed(organization,user)) {
      userLocalService.unsetOrganizationUsers(organizationId,new long[]{userId});
    }
  }
  Set<Organization> mandatoryOrganizations=MembershipPolicyUtil.getMandatoryOrganizations(user);
  for (  Organization organization : mandatoryOrganizations) {
    long organizationId=organization.getOrganizationId();
    long userId=user.getUserId();
    if (!hasUserOrganization(userId,organizationId)) {
      userLocalService.addOrganizationUsers(organizationId,new long[]{userId});
    }
  }
}
