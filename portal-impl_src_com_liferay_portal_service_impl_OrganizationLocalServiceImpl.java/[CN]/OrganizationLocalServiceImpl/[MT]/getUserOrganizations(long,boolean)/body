{
  if (!includeNonUser) {
    return getUserOrganizations(userId);
  }
  Set<Organization> organizations=new HashSet<Organization>();
  if (includeNonUser) {
    List<UserGroupRole> userGroupRoles=userGroupRoleLocalService.getUserGroupRoles(userId);
    for (    UserGroupRole userGroupRole : userGroupRoles) {
      Role role=userGroupRole.getRole();
      String roleName=role.getName();
      if (roleName.equals(RoleConstants.ORGANIZATION_OWNER) || roleName.equals(RoleConstants.ORGANIZATION_ADMINISTRATOR)) {
        Group organizationGroup=userGroupRole.getGroup();
        organizations.add(organizationPersistence.findByPrimaryKey(organizationGroup.getOrganizationId()));
      }
    }
  }
  organizations.addAll(getUserOrganizations(userId));
  return new ArrayList<Organization>(organizations);
}
