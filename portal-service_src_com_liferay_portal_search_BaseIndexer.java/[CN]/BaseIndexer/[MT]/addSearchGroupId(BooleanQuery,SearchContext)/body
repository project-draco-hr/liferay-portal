{
  long[] groupIds=searchContext.getGroupIds();
  if ((groupIds == null) || (groupIds.length == 0) || (groupIds[0] == 0)) {
    return;
  }
  BooleanQuery groupIdsQuery=BooleanQueryFactoryUtil.create();
  for (int i=0; i < groupIds.length; i++) {
    long groupId=groupIds[i];
    if (groupId <= 0) {
      continue;
    }
    try {
      Group group=GroupLocalServiceUtil.getGroup(groupId);
      long parentGroupId=groupId;
      if (group.isLayout() || searchContext.isScopeStrict()) {
        contextQuery.addRequiredTerm(Field.SCOPE_GROUP_ID,groupId);
      }
      if (group.isLayout()) {
        parentGroupId=group.getParentGroupId();
      }
      contextQuery.addRequiredTerm(Field.GROUP_ID,parentGroupId);
      groupIds[i]=parentGroupId;
    }
 catch (    Exception e) {
      continue;
    }
    TermQuery termQuery=TermQueryFactoryUtil.create(Field.GROUP_ID,groupId);
    groupIdsQuery.add(termQuery,BooleanClauseOccur.SHOULD);
  }
  searchContext.setGroupIds(groupIds);
  if (!groupIdsQuery.clauses().isEmpty()) {
    contextQuery.add(groupIdsQuery,BooleanClauseOccur.MUST);
  }
}
