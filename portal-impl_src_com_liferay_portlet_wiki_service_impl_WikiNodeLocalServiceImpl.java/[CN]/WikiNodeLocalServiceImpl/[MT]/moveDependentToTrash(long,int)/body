{
  List<WikiPage> pages=wikiPagePersistence.findByNodeId(nodeId);
  for (  WikiPage page : pages) {
    if (status == WorkflowConstants.STATUS_IN_TRASH) {
      if (page.getStatus() == WorkflowConstants.STATUS_APPROVED) {
        assetEntryLocalService.updateVisible(WikiPage.class.getName(),page.getResourcePrimKey(),false);
      }
      Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(WikiPage.class);
      indexer.reindex(page);
      if (WikiCacheThreadLocal.isClearCache()) {
        WikiCacheUtil.clearCache(page.getNodeId());
      }
      if (page.getStatus() == WorkflowConstants.STATUS_PENDING) {
        page.setStatus(WorkflowConstants.STATUS_DRAFT);
        wikiPagePersistence.update(page);
        workflowInstanceLinkLocalService.deleteWorkflowInstanceLink(page.getCompanyId(),page.getGroupId(),WikiPage.class.getName(),page.getResourcePrimKey());
      }
    }
 else {
      if (page.getStatus() == WorkflowConstants.STATUS_APPROVED) {
        assetEntryLocalService.updateVisible(WikiPage.class.getName(),page.getResourcePrimKey(),true);
      }
      Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(WikiPage.class);
      indexer.reindex(page);
    }
  }
}
