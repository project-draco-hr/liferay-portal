{
  User user=userPersistence.findByPrimaryKey(userId);
  long groupId=serviceContext.getScopeGroupId();
  Date now=new Date();
  validate(groupId,name);
  long nodeId=counterLocalService.increment();
  WikiNode node=wikiNodePersistence.create(nodeId);
  node.setUuid(uuid);
  node.setGroupId(groupId);
  node.setCompanyId(user.getCompanyId());
  node.setUserId(user.getUserId());
  node.setUserName(user.getFullName());
  node.setCreateDate(now);
  node.setModifiedDate(now);
  node.setName(name);
  node.setDescription(description);
  wikiNodePersistence.update(node,false);
  if (serviceContext.getAddCommunityPermissions() || serviceContext.getAddGuestPermissions()) {
    addNodeResources(node,serviceContext.getAddCommunityPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addNodeResources(node,serviceContext.getCommunityPermissions(),serviceContext.getGuestPermissions());
  }
  ExpandoBridge expandoBridge=node.getExpandoBridge();
  expandoBridge.setAttributes(serviceContext);
  return node;
}
