{
  int oldStatus=node.getStatus();
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  node.setStatus(status);
  node.setStatusByUserId(userId);
  node.setStatusByUserName(user.getFullName());
  node.setStatusDate(now);
  wikiNodePersistence.update(node);
  updateDependentStatus(node.getNodeId(),status);
  if (oldStatus == WorkflowConstants.STATUS_IN_TRASH) {
    trashEntryLocalService.deleteEntry(WikiNode.class.getName(),node.getNodeId());
  }
 else   if (status == WorkflowConstants.STATUS_IN_TRASH) {
    UnicodeProperties typeSettingsProperties=new UnicodeProperties();
    typeSettingsProperties.put("title",node.getName());
    trashEntryLocalService.addTrashEntry(userId,node.getGroupId(),WikiNode.class.getName(),node.getNodeId(),node.getUuid(),null,oldStatus,null,typeSettingsProperties);
  }
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(WikiNode.class);
  if (status == WorkflowConstants.STATUS_IN_TRASH) {
    indexer.reindex(node);
  }
 else {
    indexer.delete(node);
  }
  return node;
}
