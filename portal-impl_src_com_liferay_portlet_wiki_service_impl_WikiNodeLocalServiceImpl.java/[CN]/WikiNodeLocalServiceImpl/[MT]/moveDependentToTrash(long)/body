{
  List<WikiPage> pages=wikiPagePersistence.findByNodeId(nodeId);
  for (  WikiPage page : pages) {
    int oldStatus=page.getStatus();
    if (oldStatus == WorkflowConstants.STATUS_IN_TRASH) {
      continue;
    }
    if (oldStatus == WorkflowConstants.STATUS_APPROVED) {
      assetEntryLocalService.updateVisible(WikiPage.class.getName(),page.getResourcePrimKey(),false);
    }
    Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(WikiPage.class);
    indexer.reindex(page);
    if (WikiCacheThreadLocal.isClearCache()) {
      WikiCacheUtil.clearCache(page.getNodeId());
    }
    if (oldStatus == WorkflowConstants.STATUS_PENDING) {
      page.setStatus(WorkflowConstants.STATUS_DRAFT);
      wikiPagePersistence.update(page);
      workflowInstanceLinkLocalService.deleteWorkflowInstanceLink(page.getCompanyId(),page.getGroupId(),WikiPage.class.getName(),page.getResourcePrimKey());
    }
  }
}
