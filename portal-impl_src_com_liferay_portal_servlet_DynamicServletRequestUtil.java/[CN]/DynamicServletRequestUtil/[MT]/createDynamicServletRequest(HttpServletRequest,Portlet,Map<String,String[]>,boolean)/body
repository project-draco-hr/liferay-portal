{
  DynamicServletRequest dynamicServletRequest=null;
  if (portlet.isPrivateRequestAttributes()) {
    String portletNamespace=PortalUtil.getPortletNamespace(portlet.getPortletName());
    dynamicServletRequest=new NamespaceServletRequest(httpServletRequest,portletNamespace,portletNamespace);
  }
 else {
    dynamicServletRequest=new DynamicServletRequest(httpServletRequest);
  }
  for (  Map.Entry<String,String[]> entry : parameterMap.entrySet()) {
    String name=entry.getKey();
    String[] values=entry.getValue();
    String[] oldValues=httpServletRequest.getParameterValues(name);
    if (mergeParameters && (oldValues != null)) {
      values=ArrayUtil.append(values,oldValues);
    }
    dynamicServletRequest.setParameterValues(name,values);
  }
  return dynamicServletRequest;
}
