{
  Dictionary<String,Object> properties=new Hashtable<>();
  String contextPath=getContextPath(bundle);
  String servletContextName=getServletContextName(bundle,contextPath);
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_NAME,servletContextName);
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_PATH,contextPath);
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_SELECT,"(" + HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_NAME + "="+ servletContextName+ ")");
  properties.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_LISTENER,Boolean.TRUE.toString());
  properties.put("rtl.required",Boolean.TRUE.toString());
  BundleContext bundleContext=bundle.getBundleContext();
  CustomServletContextHelper customServletContextHelper=new CustomServletContextHelper(bundle);
  ServiceRegistration<?> serviceRegistration=bundleContext.registerService(new String[]{ServletContextHelper.class.getName(),ServletContextListener.class.getName()},customServletContextHelper,properties);
  return new ServletContextHelperRegistrationImpl((ServiceRegistration<ServletContextHelper>)serviceRegistration,customServletContextHelper);
}
