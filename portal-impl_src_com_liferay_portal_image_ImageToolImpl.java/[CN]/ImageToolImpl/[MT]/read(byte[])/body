{
  BufferedImage bufferedImage=null;
  String formatName=null;
  InputStream inputStream=new ByteArrayInputStream(bytes);
  ImageInputStream imageInputStream=ImageIO.createImageInputStream(inputStream);
  Iterator iterator=ImageIO.getImageReaders(imageInputStream);
  if (iterator.hasNext()) {
    ImageReader reader=(ImageReader)iterator.next();
    reader.setInput(imageInputStream);
    bufferedImage=reader.read(0);
    formatName=reader.getFormatName();
  }
  formatName=formatName.toLowerCase();
  String type=TYPE_JPEG;
  if (formatName.contains(TYPE_BMP)) {
    type=TYPE_BMP;
  }
 else   if (formatName.contains(TYPE_GIF)) {
    type=TYPE_GIF;
  }
 else   if (formatName.contains("jpeg") || type.equals("jpeg")) {
    type=TYPE_JPEG;
  }
 else   if (formatName.contains(TYPE_PNG)) {
    type=TYPE_PNG;
  }
 else   if (formatName.contains(TYPE_TIFF)) {
    type=TYPE_TIFF;
  }
 else {
    throw new IllegalArgumentException(type + " is not supported");
  }
  return new ImageBag(bufferedImage,type);
}
