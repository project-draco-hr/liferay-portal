{
  BufferedImage bufferedImage=getBufferedImage(renderedImage);
  if (!(bufferedImage.getColorModel() instanceof IndexColorModel)) {
    bufferedImage=convertImageType(bufferedImage,BufferedImage.TYPE_BYTE_INDEXED);
  }
  Gif89Encoder encoder=new Gif89Encoder(bufferedImage);
  encoder.encode(os);
}
