{
  if (renderedImage instanceof BufferedImage) {
    return (BufferedImage)renderedImage;
  }
  ColorModel colorModel=renderedImage.getColorModel();
  WritableRaster writableRaster=colorModel.createCompatibleWritableRaster(renderedImage.getWidth(),renderedImage.getHeight());
  Hashtable<String,Object> properties=new Hashtable<>();
  String[] keys=renderedImage.getPropertyNames();
  if (!ArrayUtil.isEmpty(keys)) {
    for (    String key : keys) {
      properties.put(key,renderedImage.getProperty(key));
    }
  }
  BufferedImage bufferedImage=new BufferedImage(colorModel,writableRaster,colorModel.isAlphaPremultiplied(),properties);
  renderedImage.copyData(writableRaster);
  return bufferedImage;
}
