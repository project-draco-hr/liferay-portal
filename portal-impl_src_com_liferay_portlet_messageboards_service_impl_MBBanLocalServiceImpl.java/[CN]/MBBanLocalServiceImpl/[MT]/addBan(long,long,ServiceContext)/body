{
  User user=userPersistence.findByPrimaryKey(userId);
  long groupId=serviceContext.getScopeGroupId();
  long banId=counterLocalService.increment();
  MBBan ban=mbBanPersistence.fetchByG_B(groupId,banUserId);
  if (ban == null) {
    Date now=new Date();
    ban=mbBanPersistence.create(banId);
    ban.setUuid(serviceContext.getUuid());
    ban.setGroupId(groupId);
    ban.setCompanyId(user.getCompanyId());
    ban.setUserId(user.getUserId());
    ban.setUserName(user.getFullName());
    ban.setBanUserId(banUserId);
    ban.setCreateDate(serviceContext.getCreateDate(now));
    ban.setModifiedDate(serviceContext.getModifiedDate(now));
  }
  mbBanPersistence.update(ban);
  return ban;
}
