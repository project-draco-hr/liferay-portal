{
  vc.put("request",req);
  vc.put("pageContext",pageContext);
  PortletConfigImpl portletConfig=(PortletConfigImpl)req.getAttribute(WebKeys.JAVAX_PORTLET_CONFIG);
  if (portletConfig != null) {
    vc.put("portletConfig",portletConfig);
  }
  PortletRequest portletRequest=(PortletRequest)req.getAttribute(WebKeys.JAVAX_PORTLET_REQUEST);
  if (portletRequest != null) {
    if (portletRequest instanceof RenderRequest) {
      vc.put("renderRequest",portletRequest);
    }
  }
  PortletResponse portletResponse=(PortletResponse)req.getAttribute(WebKeys.JAVAX_PORTLET_RESPONSE);
  if (portletResponse != null) {
    if (portletResponse instanceof RenderResponse) {
      vc.put("renderResponse",portletResponse);
    }
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay != null) {
    Theme theme=themeDisplay.getTheme();
    vc.put("themeDisplay",themeDisplay);
    vc.put("company",themeDisplay.getCompany());
    vc.put("user",themeDisplay.getUser());
    vc.put("realUser",themeDisplay.getRealUser());
    vc.put("layout",themeDisplay.getLayout());
    vc.put("layouts",themeDisplay.getLayouts());
    vc.put("plid",themeDisplay.getPlid());
    vc.put("layoutTypePortlet",themeDisplay.getLayoutTypePortlet());
    vc.put("portletGroupId",new Long(themeDisplay.getPortletGroupId()));
    vc.put("locale",themeDisplay.getLocale());
    vc.put("timeZone",themeDisplay.getTimeZone());
    vc.put("theme",theme);
    vc.put("colorScheme",themeDisplay.getColorScheme());
    vc.put("portletDisplay",themeDisplay.getPortletDisplay());
    String ctxName=GetterUtil.getString(theme.getServletContextName());
    vc.put("fullTemplatesPath",ctxName + VelocityResourceListener.SERVLET_SEPARATOR + theme.getTemplatesPath());
  }
  _insertTilesVariables(vc,pageContext,"tilesTitle","title");
  _insertTilesVariables(vc,pageContext,"tilesContent","content");
  _insertTilesVariables(vc,pageContext,"tilesSelectable","selectable");
  _insertHelperUtilities(vc);
  Map vmVariables=(Map)req.getAttribute(WebKeys.VM_VARIABLES);
  if (vmVariables != null) {
    Iterator itr=vmVariables.entrySet().iterator();
    while (itr.hasNext()) {
      Map.Entry entry=(Map.Entry)itr.next();
      String key=(String)entry.getKey();
      Object value=entry.getValue();
      if (Validator.isNotNull(key)) {
        vc.put(key,value);
      }
    }
  }
}
