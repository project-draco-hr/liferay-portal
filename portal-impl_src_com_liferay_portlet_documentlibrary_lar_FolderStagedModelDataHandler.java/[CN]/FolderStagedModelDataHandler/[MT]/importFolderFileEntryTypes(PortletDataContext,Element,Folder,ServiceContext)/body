{
  List<Long> fileEntryTypeIds=new ArrayList<Long>();
  String defaultFileEntryTypeUuid=GetterUtil.getString(folderElement.attributeValue("defaultFileEntryTypeUuid"));
  long defaultFileEntryTypeId=0;
  Element referencesElement=folderElement.element("references");
  if (referencesElement == null) {
    return;
  }
  List<Element> referencedElements=referencesElement.elements();
  for (  Element referencedElement : referencedElements) {
    String className=referencedElement.attributeValue("class-name");
    if (!className.equals(DLFileEntryType.class.getSimpleName())) {
      continue;
    }
    String referencedPath=referencedElement.attributeValue("path");
    DLFileEntryType referencedFileEntryType=(DLFileEntryType)portletDataContext.getZipEntryAsObject(referencedPath);
    String fileEntryTypeUuid=referencedFileEntryType.getUuid();
    DLFileEntryType dlFileEntryType=DLFileEntryTypeUtil.fetchByUUID_G(fileEntryTypeUuid,portletDataContext.getScopeGroupId());
    if (dlFileEntryType == null) {
      Group companyGroup=GroupLocalServiceUtil.getCompanyGroup(portletDataContext.getCompanyId());
      dlFileEntryType=DLFileEntryTypeUtil.fetchByUUID_G(fileEntryTypeUuid,companyGroup.getGroupId());
    }
    if (dlFileEntryType == null) {
      continue;
    }
    fileEntryTypeIds.add(dlFileEntryType.getFileEntryTypeId());
    if (defaultFileEntryTypeUuid.equals(dlFileEntryType.getUuid())) {
      defaultFileEntryTypeId=dlFileEntryType.getFileEntryTypeId();
    }
  }
  if (GetterUtil.getBoolean(folderElement.attributeValue("basic-document"))) {
    DLFileEntryType dlFileEntryType=DLFileEntryTypeLocalServiceUtil.fetchDLFileEntryType(0);
    fileEntryTypeIds.add(dlFileEntryType.getFileEntryTypeId());
  }
  if (!fileEntryTypeIds.isEmpty()) {
    DLFolder dlFolder=(DLFolder)folder.getModel();
    dlFolder.setDefaultFileEntryTypeId(defaultFileEntryTypeId);
    dlFolder.setOverrideFileEntryTypes(true);
    DLFolderLocalServiceUtil.updateDLFolder(dlFolder);
    DLFileEntryTypeLocalServiceUtil.updateFolderFileEntryTypes(dlFolder,fileEntryTypeIds,defaultFileEntryTypeId,serviceContext);
  }
}
