{
  if (_serverChannel != null) {
    throw new IllegalStateException("Netty fabric server was already started");
  }
  if (_log.isInfoEnabled()) {
    _log.info("Starting Netty fabric server using " + _nettyFabricServerConfig);
  }
  Files.createDirectories(_nettyFabricServerConfig.getRepositoryParentPath());
  ServerBootstrap serverBootstrap=new ServerBootstrap();
  serverBootstrap.channel(NioServerSocketChannel.class);
  serverBootstrap.handler(new LoggingHandler(LogLevel.INFO));
  serverBootstrap.childHandler(new ChildChannelInitializer());
  EventLoopGroup workerGroup=new NioEventLoopGroup(_nettyFabricServerConfig.getWorkerGroupThreadCount(),new NamedThreadFactory("Netty Fabric Server/Worker Event Loop Group",Thread.NORM_PRIORITY,null));
  serverBootstrap.group(new NioEventLoopGroup(_nettyFabricServerConfig.getBossGroupThreadCount(),new NamedThreadFactory("Netty Fabric Server/Boss Event Loop Group",Thread.NORM_PRIORITY,null)),workerGroup);
  serverBootstrap.attr(_fileServerEventExecutorGroupAttributeKey,new DefaultEventExecutorGroup(_nettyFabricServerConfig.getFileServerGroupThreadCount(),new NamedThreadFactory("Netty Fabric Server/File Server Event Executor Group",Thread.NORM_PRIORITY,null)));
  serverBootstrap.attr(_registrationEventExecutorGroupAttributeKey,new DefaultEventExecutorGroup(_nettyFabricServerConfig.getRegistrationGroupThreadCount(),new NamedThreadFactory("Netty Fabric Server/Registration Event Executor Group",Thread.NORM_PRIORITY,null)));
  serverBootstrap.attr(_rpcEventExecutorGroupAttributeKey,new DefaultEventExecutorGroup(_nettyFabricServerConfig.getRPCGroupThreadCount(),new NamedThreadFactory("Netty Fabric Server/RPC Event Executor Group",Thread.NORM_PRIORITY,null)));
  serverBootstrap.attr(_workerEventLoopGroupAttributeKey,workerGroup);
  ChannelFuture channelFuture=serverBootstrap.bind(_nettyFabricServerConfig.getNettyFabricServerHost(),_nettyFabricServerConfig.getNettyFabricServerPort());
  _serverChannel=channelFuture.channel();
  channelFuture.addListener(new PostBindChannelFutureListener());
  channelFuture.sync();
}
