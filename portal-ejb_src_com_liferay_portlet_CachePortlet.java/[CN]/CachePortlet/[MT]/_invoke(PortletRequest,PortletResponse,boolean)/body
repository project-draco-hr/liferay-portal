{
  if (_portletConfig.isWARFile()) {
    String path=StringPool.SLASH + _portletConfig.getPortletName() + "/invoke";
    RequestDispatcher rd=_portletCtx.getServletContext().getRequestDispatcher(path);
    HttpServletRequest httpReq=null;
    HttpServletResponse httpRes=null;
    if (action) {
      ActionRequestImpl reqImpl=(ActionRequestImpl)req;
      ActionResponseImpl resImpl=(ActionResponseImpl)res;
      httpReq=reqImpl.getHttpServletRequest();
      httpRes=resImpl.getHttpServletResponse();
    }
 else {
      RenderRequestImpl reqImpl=(RenderRequestImpl)req;
      RenderResponseImpl resImpl=(RenderResponseImpl)res;
      httpReq=reqImpl.getHttpServletRequest();
      httpRes=resImpl.getHttpServletResponse();
    }
    httpReq.setAttribute(WebKeys.JAVAX_PORTLET_PORTLET,_portlet);
    try {
      rd.include(httpReq,httpRes);
    }
 catch (    ServletException se) {
      Throwable cause=se.getRootCause();
      if (cause instanceof PortletException) {
        throw (PortletException)cause;
      }
      throw new PortletException(cause);
    }
  }
 else {
    if (action) {
      ActionRequest actionReq=(ActionRequest)req;
      ActionResponse actionRes=(ActionResponse)res;
      _portlet.processAction(actionReq,actionRes);
    }
 else {
      RenderRequest renderReq=(RenderRequest)req;
      RenderResponse renderRes=(RenderResponse)res;
      _portlet.render(renderReq,renderRes);
    }
  }
}
