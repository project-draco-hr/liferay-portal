{
  PortalPreferences portalPreferences=PortletPreferencesFactoryUtil.getPortalPreferences(request);
  String displayStyle=ParamUtil.getString(request,"displayStyle");
  if (Validator.isNull(displayStyle)) {
    WorkflowInstanceWebConfiguration workflowTaskWebConfiguration=(WorkflowInstanceWebConfiguration)_request.getAttribute(WorkflowInstanceWebConfiguration.class.getName());
    displayStyle=portalPreferences.getValue(PortletKeys.MY_WORKFLOW_INSTANCE,"display-style",workflowTaskWebConfiguration.defaultDisplayView());
  }
 else {
    if (ArrayUtil.contains(displayViews,displayStyle)) {
      portalPreferences.setValue(PortletKeys.MY_WORKFLOW_INSTANCE,"display-style",displayStyle);
      request.setAttribute(WebKeys.SINGLE_PAGE_APPLICATION_CLEAR_CACHE,Boolean.TRUE);
    }
  }
  if (!ArrayUtil.contains(displayViews,displayStyle)) {
    displayStyle=displayViews[0];
  }
  return displayStyle;
}
