{
  long groupId=ParamUtil.getLong(request,"groupId");
  if (groupId <= 0) {
    String path=GetterUtil.getString(request.getPathInfo());
    path=StringUtil.replace(path,StringPool.DOUBLE_SLASH,StringPool.SLASH);
    if (Validator.isNotNull(path)) {
      int pos=path.indexOf(StringPool.SLASH,1);
      if (pos == -1) {
        pos=path.length();
      }
      groupId=GetterUtil.getLong(path.substring(1,pos));
    }
  }
  if (groupId <= 0) {
    long companyId=PortalInstances.getCompanyId(request);
    Group guestGroup=GroupLocalServiceUtil.getGroup(companyId,GroupConstants.GUEST);
    groupId=guestGroup.getGroupId();
  }
  return groupId;
}
