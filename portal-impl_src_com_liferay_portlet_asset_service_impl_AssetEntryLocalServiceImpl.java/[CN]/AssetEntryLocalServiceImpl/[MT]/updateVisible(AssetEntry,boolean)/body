{
  if (visible == entry.isVisible()) {
    return assetEntryPersistence.update(entry);
  }
  entry.setVisible(visible);
  assetEntryPersistence.update(entry);
  List<AssetTag> tags=assetEntryPersistence.getAssetTags(entry.getEntryId());
  if (visible) {
    for (    AssetTag tag : tags) {
      assetTagLocalService.incrementAssetCount(tag.getTagId(),entry.getClassNameId());
    }
    socialActivityCounterLocalService.enableActivityCounters(entry.getClassNameId(),entry.getClassPK());
  }
 else {
    for (    AssetTag tag : tags) {
      assetTagLocalService.decrementAssetCount(tag.getTagId(),entry.getClassNameId());
    }
    socialActivityCounterLocalService.disableActivityCounters(entry.getClassNameId(),entry.getClassPK());
  }
  reindex(entry);
  return entry;
}
