{
  Document document=SAXReaderUtil.createDocument();
  Element rootElement=document.addElement("root");
  rootElement.addAttribute("available-locales","en_US");
  rootElement.addAttribute("default-locale","en_US");
  Element nameElement=JournalTestUtil.addDynamicElementElement(rootElement,"text","name");
  JournalTestUtil.addMetadataElement(nameElement,"en_US","name");
  Element linkElement=JournalTestUtil.addDynamicElementElement(rootElement,"text","link");
  JournalTestUtil.addMetadataElement(linkElement,"en_US","link");
  String xsd=document.asXML();
  DDMStructure ddmStructure=DDMStructureTestUtil.addStructure(JournalArticle.class.getName(),xsd);
  String xsl="$name.getData()";
  DDMTemplate ddmTemplate=DDMTemplateTestUtil.addTemplate(ddmStructure.getStructureId(),TemplateConstants.LANG_TYPE_VM,xsl);
  document=JournalTestUtil.createDocument("en_US","en_US");
  Element dynamicElementElement=JournalTestUtil.addDynamicElementElement(document.getRootElement(),"text","name");
  JournalTestUtil.addDynamicContentElement(dynamicElementElement,"en_US","Joe Bloggs");
  String xml=document.asXML();
  JournalArticle article=JournalTestUtil.addArticleWithXMLContent(xml,ddmStructure.getStructureKey(),ddmTemplate.getTemplateKey());
  Map<String,String> tokens=getTokens();
  String content=JournalUtil.transform(null,tokens,Constants.VIEW,"en_US",xml,xsl,TemplateConstants.LANG_TYPE_VM);
  Assert.assertEquals("Joe Bloggs",content);
  Element element=(Element)document.selectSingleNode("//dynamic-content");
  element.setText("[@" + article.getArticleId() + ";name@]");
  content=JournalUtil.transform(null,tokens,Constants.VIEW,"en_US",document.asXML(),xsl,TemplateConstants.LANG_TYPE_VM);
  Assert.assertEquals("Joe Bloggs",content);
}
