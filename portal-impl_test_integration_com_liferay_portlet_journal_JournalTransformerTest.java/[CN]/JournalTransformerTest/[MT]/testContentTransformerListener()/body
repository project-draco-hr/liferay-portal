{
  Document document=SAXReaderUtil.createDocument();
  Element rootElement=document.addElement("root");
  rootElement.addAttribute("available-locales","en_US");
  rootElement.addAttribute("default-locale","en_US");
  Element nameElement=JournalTestUtil.addDynamicElementElement(rootElement,"text","name");
  JournalTestUtil.addMetadataElement(nameElement,"en_US","name");
  Element linkElement=JournalTestUtil.addDynamicElementElement(rootElement,"text","link");
  JournalTestUtil.addMetadataElement(linkElement,"en_US","link");
  String xsd=document.asXML();
  _ddmStructure=DDMStructureTestUtil.addStructure(JournalArticle.class.getName(),xsd);
  String xsl="$name.getData()";
  _ddmTemplate=DDMTemplateTestUtil.addTemplate(_ddmStructure.getStructureId(),TemplateConstants.LANG_TYPE_VM,xsl);
  String xml=DDMStructureTestUtil.getSampleStructuredContent("Joe Bloggs");
  _article=JournalTestUtil.addArticleWithXMLContent(xml,_ddmStructure.getStructureKey(),_ddmTemplate.getTemplateKey());
  Map<String,String> tokens=getTokens();
  String content=JournalUtil.transform(null,tokens,Constants.VIEW,"en_US",SAXReaderUtil.read(xml),null,xsl,TemplateConstants.LANG_TYPE_VM);
  Assert.assertEquals("Joe Bloggs",content);
  document=SAXReaderUtil.read(xml);
  Element element=(Element)document.selectSingleNode("//dynamic-content");
  element.setText("[@" + _article.getArticleId() + ";name@]");
  content=JournalUtil.transform(null,tokens,Constants.VIEW,"en_US",document,null,xsl,TemplateConstants.LANG_TYPE_VM);
  Assert.assertEquals("Joe Bloggs",content);
}
