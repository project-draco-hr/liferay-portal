{
  User user=TestPropsValues.getUser();
  Group groupUser=user.getGroup();
  Group userGroupGroup=GroupLocalServiceUtil.getGroup(userGroupGroupId);
  String groupServletMapping=_PUBLIC_GROUP_SERVLET_MAPPING;
  if (layout.isPrivateLayout()) {
    groupServletMapping=_PRIVATE_GROUP_SERVLET_MAPPING;
  }
  MockHttpServletRequest mockHttpServletRequest=new MockHttpServletRequest();
  StringBundler sb=new StringBundler(5);
  sb.append(groupServletMapping);
  sb.append(groupUser.getFriendlyURL());
  sb.append(VirtualLayoutConstants.CANONICAL_URL_SEPARATOR);
  sb.append(userGroupGroup.getFriendlyURL());
  sb.append(layoutFriendlyURL);
  mockHttpServletRequest.setRequestURI(sb.toString());
  sb=new StringBundler(4);
  sb.append(groupUser.getFriendlyURL());
  sb.append(VirtualLayoutConstants.CANONICAL_URL_SEPARATOR);
  sb.append(userGroupGroup.getFriendlyURL());
  sb.append(layoutFriendlyURL);
  mockHttpServletRequest.setPathInfo(sb.toString());
  String localizedFriendlyURL=PortalUtil.getLocalizedFriendlyURL(mockHttpServletRequest,layout,locale);
  sb=new StringBundler(7);
  sb.append(StringPool.SLASH);
  sb.append(PortalUtil.getI18nPathLanguageId(locale,StringPool.BLANK));
  sb.append(groupServletMapping);
  sb.append(groupUser.getFriendlyURL());
  sb.append(VirtualLayoutConstants.CANONICAL_URL_SEPARATOR);
  sb.append(userGroupGroup.getFriendlyURL());
  sb.append(expectedLayoutFriendlyURL);
  Assert.assertEquals(sb.toString(),localizedFriendlyURL);
}
