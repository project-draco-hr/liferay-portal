{
  Map<String,String[]> parameterMap=new HashMap<String,String[]>();
  String portletId=request.getParameter("p_p_id");
  String namespace=PortalUtil.getPortletNamespace(portletId);
  Set<Map.Entry<String,String[]>> entries=request.getParameterMap().entrySet();
  for (  Map.Entry<String,String[]> mapEntry : entries) {
    String key=mapEntry.getKey();
    if (PortalUtil.isReservedParameter(key)) {
      continue;
    }
    if (key.startsWith(namespace)) {
      parameterMap.put(key.substring(namespace.length()),mapEntry.getValue());
    }
 else     if (key.startsWith(PortletQName.PUBLIC_RENDER_PARAMETER_NAMESPACE)) {
      String identifier=PortletQNameUtil.getPublicRenderParameterIdentifier(key);
      parameterMap.put(identifier,mapEntry.getValue());
    }
 else {
      parameterMap.put(key,mapEntry.getValue());
    }
  }
  return parameterMap;
}
