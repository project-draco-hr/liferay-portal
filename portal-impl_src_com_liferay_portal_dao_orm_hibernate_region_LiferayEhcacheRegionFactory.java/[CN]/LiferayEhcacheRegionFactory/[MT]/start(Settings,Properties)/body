{
  try {
    String configurationPath=null;
    if (properties != null) {
      configurationPath=(String)properties.get(NET_SF_EHCACHE_CONFIGURATION_RESOURCE_NAME);
    }
    if (Validator.isNull(configurationPath)) {
      configurationPath=_DEFAULT_CLUSTERED_EHCACHE_CONFIG_FILE;
    }
    Configuration configuration=null;
    if (Validator.isNull(configurationPath)) {
      configuration=ConfigurationFactory.parseConfiguration();
    }
 else {
      boolean usingDefault=configurationPath.equals(_DEFAULT_CLUSTERED_EHCACHE_CONFIG_FILE);
      configuration=EhcacheConfigurationUtil.getConfiguration(configurationPath,true,usingDefault);
    }
    manager=new CacheManager(configuration);
    mbeanRegistrationHelper.registerMBean(manager,properties);
  }
 catch (  net.sf.ehcache.CacheException ce) {
    throw new CacheException(ce);
  }
}
