{
  String configFile=null;
  if (properties != null) {
    configFile=(String)properties.get(NET_SF_EHCACHE_CONFIGURATION_RESOURCE_NAME);
  }
  HibernatePortalCacheManager hibernatePortalCacheManager=new HibernatePortalCacheManager();
  hibernatePortalCacheManager.setClusterAware(true);
  hibernatePortalCacheManager.setConfigFile(configFile);
  hibernatePortalCacheManager.setDefaultConfigFile(_DEFAULT_CLUSTERED_EHCACHE_CONFIG_FILE);
  hibernatePortalCacheManager.setMpiOnly(true);
  hibernatePortalCacheManager.setName(PortalCacheManagerNames.HIBERNATE);
  boolean skipUpdateCheck=GetterUtil.getBoolean(SystemProperties.get("net.sf.ehcache.skipUpdateCheck"));
  boolean tcActive=GetterUtil.getBoolean(SystemProperties.get("tc.active"));
  hibernatePortalCacheManager.setStopCacheManagerTimer(skipUpdateCheck && !tcActive);
  hibernatePortalCacheManager.afterPropertiesSet();
  manager=hibernatePortalCacheManager.getEhcacheManager();
  _hibernatePortalCacheManager=hibernatePortalCacheManager;
  mbeanRegistrationHelper.registerMBean(manager,properties);
}
