{
  String cacheName=replacementCache.getName();
  Ehcache cache=manager.getEhcache(cacheName);
  if ((cache != null) && (cache instanceof ModifiableEhcacheWrapper)) {
    if (_log.isInfoEnabled()) {
      _log.info("Reconfiguring Hibernate cache: " + cacheName);
    }
    ModifiableEhcacheWrapper modifiableEhcacheWrapper=(ModifiableEhcacheWrapper)cache;
    manager.replaceCacheWithDecoratedCache(cache,modifiableEhcacheWrapper.getWrappedCache());
    manager.removeCache(cacheName);
    manager.addCache(replacementCache);
    modifiableEhcacheWrapper.setWrappedCache(replacementCache);
    manager.replaceCacheWithDecoratedCache(replacementCache,modifiableEhcacheWrapper);
  }
 else {
    if (_log.isInfoEnabled()) {
      _log.info("Configuring Hibernate cache: " + cacheName);
    }
    if (cache != null) {
      manager.removeCache(cacheName);
    }
    cache=new ModifiableEhcacheWrapper(replacementCache);
    manager.addCache(replacementCache);
    manager.replaceCacheWithDecoratedCache(replacementCache,cache);
  }
}
