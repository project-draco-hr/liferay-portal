{
  String cacheName=replacementCache.getName();
  Ehcache ehcache=manager.getEhcache(cacheName);
  if ((ehcache != null) && (ehcache instanceof ModifiableEhcacheWrapper)) {
    if (_log.isInfoEnabled()) {
      _log.info("Reconfiguring Hibernate cache " + cacheName);
    }
    ModifiableEhcacheWrapper modifiableEhcacheWrapper=(ModifiableEhcacheWrapper)ehcache;
    manager.replaceCacheWithDecoratedCache(ehcache,modifiableEhcacheWrapper.getWrappedCache());
    manager.removeCache(cacheName);
    manager.addCache(replacementCache);
    modifiableEhcacheWrapper.setWrappedCache(replacementCache);
    manager.replaceCacheWithDecoratedCache(replacementCache,modifiableEhcacheWrapper);
  }
 else {
    if (_log.isInfoEnabled()) {
      _log.info("Configuring Hibernate cache " + cacheName);
    }
    if (ehcache != null) {
      manager.removeCache(cacheName);
    }
    ehcache=new ModifiableEhcacheWrapper(replacementCache);
    manager.addCache(replacementCache);
    manager.replaceCacheWithDecoratedCache(replacementCache,ehcache);
  }
}
