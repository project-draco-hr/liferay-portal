{
  MBCategory category=MBCategoryUtil.findByPrimaryKey(message.getCategoryId());
  MBMessage parentMessage=null;
  if (message.isReply()) {
    parentMessage=MBMessageUtil.findByPrimaryKey(message.getParentMessageId());
  }
  MBThread thread=MBThreadUtil.findByPrimaryKey(message.getThreadId());
  thread.setViewCount(thread.getViewCount() + 1);
  MBThreadUtil.update(thread);
  MBTreeWalker treeWalker=new MBTreeWalkerImpl(message,userId);
  ThreadLastPostDateComparator comparator=new ThreadLastPostDateComparator(false);
  MBThread[] prevAndNextThreads=MBThreadUtil.findByCategoryId_PrevAndNext(message.getThreadId(),message.getCategoryId(),comparator);
  MBThread previousThread=prevAndNextThreads[0];
  MBThread nextThread=prevAndNextThreads[2];
  MBThread firstThread=null;
  try {
    firstThread=MBThreadUtil.findByCategoryId_First(message.getCategoryId(),comparator);
  }
 catch (  NoSuchThreadException nste) {
  }
  MBThread lastThread=null;
  try {
    lastThread=MBThreadUtil.findByCategoryId_Last(message.getCategoryId(),comparator);
  }
 catch (  NoSuchThreadException nste) {
  }
  return new MBMessageDisplayImpl(message,parentMessage,category,thread,treeWalker,previousThread,nextThread,firstThread,lastThread,userId);
}
