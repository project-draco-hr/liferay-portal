{
  String entryURL=GetterUtil.getString(serviceContext.getAttribute("entryURL"));
  if (Validator.isNotNull(entryURL)) {
    return entryURL;
  }
  HttpServletRequest request=serviceContext.getRequest();
  if (request == null) {
    if (Validator.isNull(serviceContext.getLayoutFullURL())) {
      return StringPool.BLANK;
    }
    return serviceContext.getLayoutFullURL() + Portal.FRIENDLY_URL_SEPARATOR + "message_boards/view_message/"+ message.getMessageId();
  }
  String layoutURL=LayoutURLUtil.getLayoutURL(message.getGroupId(),PortletKeys.MESSAGE_BOARDS,serviceContext);
  if (Validator.isNotNull(layoutURL)) {
    return layoutURL + Portal.FRIENDLY_URL_SEPARATOR + "message_boards/view_message/"+ message.getMessageId();
  }
 else {
    long controlPanelPlid=PortalUtil.getControlPanelPlid(serviceContext.getCompanyId());
    PortletURL portletURL=PortletURLFactoryUtil.create(request,PortletKeys.MESSAGE_BOARDS_ADMIN,controlPanelPlid,PortletRequest.RENDER_PHASE);
    portletURL.setParameter("struts_action","/message_boards_admin/view_message");
    portletURL.setParameter("messageId",String.valueOf(message.getMessageId()));
    return portletURL.toString();
  }
}
