{
  MBCategory category=null;
  if (!message.isDiscussion()) {
    mbCategoryPersistence.findByPrimaryKey(message.getCategoryId());
  }
  MBMessage parentMessage=null;
  if (message.isReply()) {
    parentMessage=mbMessagePersistence.findByPrimaryKey(message.getParentMessageId());
  }
  MBThread thread=mbThreadPersistence.findByPrimaryKey(message.getThreadId());
  if (!message.isDiscussion() && (message.getStatus() == WorkflowConstants.STATUS_APPROVED)) {
    mbThreadLocalService.updateThread(thread.getThreadId(),thread.getViewCount() + 1);
  }
  MBThread previousThread=null;
  MBThread nextThread=null;
  if (message.getStatus() == WorkflowConstants.STATUS_APPROVED) {
    ThreadLastPostDateComparator comparator=new ThreadLastPostDateComparator(false);
    MBThread[] prevAndNextThreads=mbThreadPersistence.findByG_C_PrevAndNext(message.getThreadId(),message.getGroupId(),message.getCategoryId(),comparator);
    previousThread=prevAndNextThreads[0];
    nextThread=prevAndNextThreads[2];
  }
  return new MBMessageDisplayImpl(message,parentMessage,category,thread,previousThread,nextThread,status,threadView);
}
