{
  if (!PrefsPropsUtil.getBoolean(message.getCompanyId(),PropsKeys.DISCUSSION_EMAIL_COMMENTS_ADDED_ENABLED)) {
    return;
  }
  String contentURL=(String)serviceContext.getAttribute("redirect");
  String fromName=PrefsPropsUtil.getString(message.getCompanyId(),PropsKeys.ADMIN_EMAIL_FROM_NAME);
  String fromAddress=PrefsPropsUtil.getString(message.getCompanyId(),PropsKeys.ADMIN_EMAIL_FROM_ADDRESS);
  String subject=PrefsPropsUtil.getContent(message.getCompanyId(),PropsKeys.DISCUSSION_EMAIL_SUBJECT);
  String body=PrefsPropsUtil.getContent(message.getCompanyId(),PropsKeys.DISCUSSION_EMAIL_BODY);
  SubscriptionSender subscriptionSender=new SubscriptionSender();
  subscriptionSender.setBody(body);
  subscriptionSender.setCompanyId(message.getCompanyId());
  subscriptionSender.setContextAttributes("[$COMMENTS_BODY$]",message.getBody(),"[$CONTENT_URL$]",contentURL);
  subscriptionSender.setContextUserPrefix("COMMENTS");
  subscriptionSender.setFrom(fromAddress,fromName);
  subscriptionSender.setGroupId(message.getGroupId());
  subscriptionSender.setMailId("mb_discussion",message.getCategoryId(),message.getMessageId());
  subscriptionSender.setSubject(subject);
  subscriptionSender.setUserId(message.getUserId());
  String className=(String)serviceContext.getAttribute("className");
  long classPK=GetterUtil.getLong((String)serviceContext.getAttribute("classPK"));
  subscriptionSender.addPersistedSubscribers(className,classPK);
  subscriptionSender.flushNotificationsAsync();
}
