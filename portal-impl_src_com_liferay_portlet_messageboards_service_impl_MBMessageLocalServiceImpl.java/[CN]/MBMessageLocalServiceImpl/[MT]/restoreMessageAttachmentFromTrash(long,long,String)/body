{
  boolean dlAppHelperEnabled=DLAppHelperThreadLocal.isEnabled();
  try {
    DLAppHelperThreadLocal.setEnabled(false);
    MBMessage message=getMessage(messageId);
    Folder folder=message.addAttachmentsFolder();
    FileEntry fileEntry=PortletFileRepositoryUtil.getPortletFileEntry(message.getGroupId(),folder.getFolderId(),deletedFileName);
    RepositoryTrashUtil.restoreFileEntryFromTrash(userId,fileEntry.getRepositoryId(),fileEntry.getFileEntryId());
  }
  finally {
    DLAppHelperThreadLocal.setEnabled(dlAppHelperEnabled);
  }
}
