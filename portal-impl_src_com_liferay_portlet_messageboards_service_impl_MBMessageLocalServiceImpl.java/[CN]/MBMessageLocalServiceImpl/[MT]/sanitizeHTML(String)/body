{
  HtmlPolicyBuilder htmlPolicyBuilder=new HtmlPolicyBuilder();
  htmlPolicyBuilder.allowStandardUrlProtocols();
  Map<String,String[]> allowedContentElementAttributes=_mbDiscussionAllowedContent.getAllowedContentElementAttributes();
  for (  String allowedContentElement : allowedContentElementAttributes.keySet()) {
    String[] allowedContentAttributes=allowedContentElementAttributes.get(allowedContentElement);
    if (allowedContentAttributes != null) {
      htmlPolicyBuilder.allowAttributes(allowedContentAttributes).onElements(allowedContentElement);
    }
    htmlPolicyBuilder.allowElements(allowedContentElement);
  }
  PolicyFactory policyFactory=htmlPolicyBuilder.toFactory();
  return policyFactory.sanitize(html);
}
