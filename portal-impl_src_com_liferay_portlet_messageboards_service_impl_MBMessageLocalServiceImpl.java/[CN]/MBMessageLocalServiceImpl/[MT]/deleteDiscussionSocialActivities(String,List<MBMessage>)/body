{
  if (messages.size() == 0) {
    return;
  }
  MBMessage message=messages.get(0);
  MBDiscussion discussion=mbDiscussionPersistence.findByThreadId(message.getThreadId());
  long classNameId=PortalUtil.getClassNameId(className);
  long classPK=discussion.getClassPK();
  if (discussion.getClassNameId() != classNameId) {
    return;
  }
  Set<Long> messageIds=new HashSet<Long>();
  for (  MBMessage curMessage : messages) {
    messageIds.add(curMessage.getMessageId());
  }
  List<SocialActivity> socialActivities=socialActivityLocalService.getActivities(0,className,classPK,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  for (  SocialActivity socialActivity : socialActivities) {
    if (Validator.isNull(socialActivity.getExtraData())) {
      continue;
    }
    JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject(socialActivity.getExtraData());
    long extraDataMessageId=extraDataJSONObject.getLong("messageId");
    if (messageIds.contains(extraDataMessageId)) {
      socialActivityLocalService.deleteActivity(socialActivity.getActivityId());
    }
  }
}
