{
  MBMessage message=mbMessagePersistence.findByPrimaryKey(messageId);
  message.setCreateDate(createDate);
  message.setModifiedDate(modifiedDate);
  mbMessagePersistence.update(message,false);
  if (message.getStatus() == StatusConstants.APPROVED) {
    MBThread thread=mbThreadPersistence.findByPrimaryKey(message.getThreadId());
    if (message.isAnonymous()) {
      thread.setLastPostByUserId(0);
    }
 else {
      thread.setLastPostByUserId(message.getUserId());
    }
    thread.setLastPostDate(modifiedDate);
    mbThreadPersistence.update(thread,false);
  }
  MBCategory systemCategory=mbCategoryLocalService.getSystemCategory();
  boolean isSystemCategory=(systemCategory.getCategoryId() == message.getCategoryId());
  if (!isSystemCategory) {
    MBCategory category=mbCategoryPersistence.findByPrimaryKey(message.getCategoryId());
    if (message.getStatus() == StatusConstants.APPROVED) {
      category.setLastPostDate(modifiedDate);
      mbCategoryPersistence.update(category,false);
    }
  }
  if (!message.isDiscussion() && (message.getStatus() == StatusConstants.APPROVED)) {
    mbStatsUserLocalService.updateStatsUser(message.getGroupId(),message.getUserId(),modifiedDate);
  }
  return message;
}
