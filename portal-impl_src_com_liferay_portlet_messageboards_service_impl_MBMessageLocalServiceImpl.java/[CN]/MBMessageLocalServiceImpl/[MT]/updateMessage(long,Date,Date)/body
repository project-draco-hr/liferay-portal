{
  MBMessage message=mbMessagePersistence.findByPrimaryKey(messageId);
  message.setCreateDate(createDate);
  message.setModifiedDate(modifiedDate);
  mbMessagePersistence.update(message,false);
  MBThread thread=mbThreadPersistence.findByPrimaryKey(message.getThreadId());
  if (message.isAnonymous()) {
    thread.setLastPostByUserId(0);
  }
 else {
    thread.setLastPostByUserId(message.getUserId());
  }
  thread.setLastPostDate(modifiedDate);
  mbThreadPersistence.update(thread,false);
  if (message.getCategoryId() != MBCategoryConstants.DEFAULT_PARENT_CATEGORY_ID) {
    MBCategory category=mbCategoryPersistence.findByPrimaryKey(message.getCategoryId());
    category.setLastPostDate(modifiedDate);
    mbCategoryPersistence.update(category,false);
    if (!category.isDiscussion()) {
      mbStatsUserLocalService.updateStatsUser(message.getGroupId(),message.getUserId(),modifiedDate);
    }
  }
  return message;
}
