{
  boolean dlAppHelperEnabled=DLAppHelperThreadLocal.isEnabled();
  try {
    DLAppHelperThreadLocal.setEnabled(false);
    MBMessage message=getMessage(messageId);
    long folderId=message.getAttachmentsFolderId();
    FileEntry fileEntry=PortletFileRepositoryUtil.getPortletFileEntry(message.getGroupId(),folderId,fileName);
    RepositoryTrashUtil.moveFileEntryToTrash(userId,fileEntry.getRepositoryId(),fileEntry.getFileEntryId());
    return fileEntry.getFileEntryId();
  }
  finally {
    DLAppHelperThreadLocal.setEnabled(dlAppHelperEnabled);
  }
}
