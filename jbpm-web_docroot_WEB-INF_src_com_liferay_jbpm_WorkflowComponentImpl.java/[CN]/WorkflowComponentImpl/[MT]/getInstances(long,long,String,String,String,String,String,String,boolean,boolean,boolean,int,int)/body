{
  List instances=new ArrayList();
  if (definitionId > 0) {
    ProcessDefinition definition=graphSession.loadProcessDefinition(definitionId);
    instances=graphSession.findProcessInstances(definition.getId());
    WorkflowUtil.initInstances(instances);
  }
 else   if (instanceId > 0) {
    ProcessInstance instance=graphSession.loadProcessInstance(instanceId);
    WorkflowUtil.initInstance(instance);
    instances.add(instance);
  }
 else {
    String assignedUserId=null;
    if (retrieveUserInstances) {
      assignedUserId=userId;
    }
    instances=graphSession.findProcessInstancesBySearchTerms(definitionName,definitionVersion,startDateGT,startDateLT,endDateGT,endDateLT,hideEndedTasks,assignedUserId,andOperator,begin,end);
  }
  return instances;
}
