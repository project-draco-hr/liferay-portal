{
  PortletRequest portletReq=(PortletRequest)req.getAttribute(WebKeys.JAVAX_PORTLET_REQUEST);
  PortletResponse portletRes=(PortletResponse)req.getAttribute(WebKeys.JAVAX_PORTLET_RESPONSE);
  Portlet portlet=(Portlet)req.getAttribute(WebKeys.JAVAX_PORTLET_PORTLET);
  try {
    if (portletReq instanceof ActionRequest) {
      ActionRequest actionReq=(ActionRequest)portletReq;
      ActionResponse actionRes=(ActionResponse)portletRes;
      portlet.processAction(actionReq,actionRes);
    }
 else {
      RenderRequest renderReq=(RenderRequest)portletReq;
      RenderResponse renderRes=(RenderResponse)portletRes;
      portlet.render(renderReq,renderRes);
    }
  }
 catch (  PortletException pe) {
    _log.error(pe.getMessage());
    throw new ServletException(pe);
  }
}
