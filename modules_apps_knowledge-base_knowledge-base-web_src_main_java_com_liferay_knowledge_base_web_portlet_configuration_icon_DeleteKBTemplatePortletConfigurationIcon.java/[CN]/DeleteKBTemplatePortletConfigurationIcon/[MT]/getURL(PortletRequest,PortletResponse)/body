{
  PortletURL portletURL=PortalUtil.getControlPanelPortletURL(portletRequest,KBPortletKeys.KNOWLEDGE_BASE_ADMIN,PortletRequest.ACTION_PHASE);
  portletURL.setParameter("mvcPath","/admin/view_template.jsp");
  portletURL.setParameter(ActionRequest.ACTION_NAME,"deleteKBTemplate");
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String redirect=themeDisplay.getURLCurrent();
  KBTemplate kbTemplate=(KBTemplate)portletRequest.getAttribute(KBWebKeys.KNOWLEDGE_BASE_KB_TEMPLATE);
  long kbTemplateId=ParamUtil.getLong(portletRequest,"kbTemplateId");
  if (kbTemplate.getKbTemplateId() == kbTemplateId) {
    PortletURL homeURL=PortalUtil.getControlPanelPortletURL(portletRequest,KBPortletKeys.KNOWLEDGE_BASE_ADMIN,PortletRequest.RENDER_PHASE);
    redirect=homeURL.toString();
  }
  portletURL.setParameter("redirect",redirect);
  portletURL.setParameter("kbTemplateId",String.valueOf(kbTemplate.getKbTemplateId()));
  return portletURL.toString();
}
