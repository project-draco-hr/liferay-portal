{
  long layoutBranchId=0;
  try {
    LayoutRevision layoutRevision=LayoutRevisionLocalServiceUtil.getLayoutRevision(layoutRevisionId);
    layoutBranchId=layoutRevision.getLayoutBranchId();
    LayoutRevision lastLayoutRevision=LayoutRevisionLocalServiceUtil.getLayoutRevision(layoutSetBranchId,layoutBranchId,plid);
    if (lastLayoutRevision.getLayoutRevisionId() == layoutRevisionId) {
      deleteRecentLayoutRevisionId(portalPreferences,layoutSetBranchId,plid);
    }
 else {
      portalPreferences.setValue(Staging.class.getName(),getRecentLayoutRevisionIdKey(layoutSetBranchId,plid),String.valueOf(layoutRevisionId));
    }
  }
 catch (  PortalException pe) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to set recent layout revision ID",pe);
    }
  }
  portalPreferences.setValue(Staging.class.getName(),getRecentLayoutBranchIdKey(layoutSetBranchId,plid),String.valueOf(layoutBranchId));
}
