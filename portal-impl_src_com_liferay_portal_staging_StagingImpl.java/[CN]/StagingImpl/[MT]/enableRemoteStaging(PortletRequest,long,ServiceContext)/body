{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Group liveGroup=GroupServiceUtil.getGroup(liveGroupId);
  String remoteAddress=ParamUtil.getString(portletRequest,"remoteAddress");
  long remoteGroupId=ParamUtil.getLong(portletRequest,"remoteGroupId");
  int remotePort=ParamUtil.getInteger(portletRequest,"remotePort");
  boolean secureConnection=ParamUtil.getBoolean(portletRequest,"secureConnection");
  validate(remoteAddress,remoteGroupId,remotePort,secureConnection);
  if (liveGroup.hasStagingGroup()) {
    disableStaging(portletRequest,liveGroupId);
  }
  UnicodeProperties typeSettingsProperties=liveGroup.getTypeSettingsProperties();
  typeSettingsProperties.setProperty("remoteAddress",remoteAddress);
  typeSettingsProperties.setProperty("remoteGroupId",String.valueOf(remoteGroupId));
  typeSettingsProperties.setProperty("remotePort",String.valueOf(remotePort));
  typeSettingsProperties.setProperty("secureConnection",String.valueOf(secureConnection));
  typeSettingsProperties.setProperty("staged",Boolean.TRUE.toString());
  typeSettingsProperties.setProperty("stagedRemotely",Boolean.TRUE.toString());
  setCommonStagingOptions(portletRequest,liveGroup,typeSettingsProperties);
  LayoutSetBranchLocalServiceUtil.addLayoutSetBranch(themeDisplay.getUserId(),themeDisplay.getScopeGroupId(),false,LayoutSetBranchConstants.MASTER_BRANCH_NAME,LayoutSetBranchConstants.MASTER_BRANCH_NAME.concat(" branch of ").concat(liveGroup.getDescriptiveName()),serviceContext);
  LayoutSetBranchLocalServiceUtil.addLayoutSetBranch(themeDisplay.getUserId(),themeDisplay.getScopeGroupId(),true,LayoutSetBranchConstants.MASTER_BRANCH_NAME,LayoutSetBranchConstants.MASTER_BRANCH_NAME.concat(" branch of ").concat(liveGroup.getDescriptiveName()),serviceContext);
  GroupServiceUtil.updateGroup(liveGroup.getGroupId(),typeSettingsProperties.toString());
}
