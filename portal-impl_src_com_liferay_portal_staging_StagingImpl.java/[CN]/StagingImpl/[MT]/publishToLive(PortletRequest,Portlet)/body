{
  long plid=ParamUtil.getLong(portletRequest,"plid");
  Layout sourceLayout=LayoutLocalServiceUtil.getLayout(plid);
  Group stagingGroup=null;
  Group liveGroup=null;
  Layout targetLayout=null;
  long scopeGroupId=PortalUtil.getScopeGroupId(portletRequest);
  if (sourceLayout.hasScopeGroup() && (sourceLayout.getScopeGroup().getGroupId() == scopeGroupId)) {
    stagingGroup=sourceLayout.getScopeGroup();
    liveGroup=stagingGroup.getLiveGroup();
    targetLayout=LayoutLocalServiceUtil.getLayout(liveGroup.getClassPK());
  }
 else {
    stagingGroup=sourceLayout.getGroup();
    liveGroup=stagingGroup.getLiveGroup();
    targetLayout=LayoutLocalServiceUtil.fetchLayoutByUuidAndGroupId(sourceLayout.getUuid(),liveGroup.getGroupId(),sourceLayout.isPrivateLayout());
  }
  long sourcePlid=sourceLayout.getPlid();
  long targetPlid=LayoutConstants.DEFAULT_PLID;
  if (targetLayout != null) {
    targetPlid=targetLayout.getPlid();
  }
 else   if ((targetLayout == null) && sourceLayout.isTypeControlPanel()) {
    targetPlid=sourcePlid;
  }
  copyPortlet(portletRequest,stagingGroup.getGroupId(),liveGroup.getGroupId(),sourcePlid,targetPlid,portlet.getPortletId());
}
