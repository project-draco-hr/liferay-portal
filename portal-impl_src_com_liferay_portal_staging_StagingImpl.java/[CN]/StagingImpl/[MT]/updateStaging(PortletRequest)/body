{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long userId=permissionChecker.getUserId();
  long scopeGroupId=themeDisplay.getScopeGroupId();
  long liveGroupId=ParamUtil.getLong(portletRequest,"liveGroupId");
  if (!GroupPermissionUtil.contains(permissionChecker,liveGroupId,ActionKeys.MANAGE_STAGING)) {
    throw new PrincipalException();
  }
  int stagingType=ParamUtil.getInteger(portletRequest,"stagingType");
  boolean branchingPublic=ParamUtil.getBoolean(portletRequest,"branchingPublic",false);
  boolean branchingPrivate=ParamUtil.getBoolean(portletRequest,"branchingPrivate",false);
  boolean lockingPublic=ParamUtil.getBoolean(portletRequest,"lockingPublic",false);
  boolean lockingPrivate=ParamUtil.getBoolean(portletRequest,"lockingPrivate",false);
  ServiceContext serviceContext=ServiceContextThreadLocal.getServiceContext();
  if (stagingType == StagingConstants.TYPE_NOT_STAGED) {
    disableStaging(portletRequest,scopeGroupId,liveGroupId,serviceContext);
  }
 else   if (stagingType == StagingConstants.TYPE_LOCAL_STAGING) {
    enableLocalStaging(userId,scopeGroupId,liveGroupId,branchingPublic,branchingPrivate,lockingPublic,lockingPrivate,serviceContext);
  }
 else   if (stagingType == StagingConstants.TYPE_REMOTE_STAGING) {
    String remoteAddress=ParamUtil.getString(portletRequest,"remoteAddress");
    long remoteGroupId=ParamUtil.getLong(portletRequest,"remoteGroupId");
    int remotePort=ParamUtil.getInteger(portletRequest,"remotePort");
    boolean secureConnection=ParamUtil.getBoolean(portletRequest,"secureConnection");
    enableRemoteStaging(userId,scopeGroupId,liveGroupId,branchingPublic,branchingPrivate,lockingPublic,lockingPrivate,remoteAddress,remoteGroupId,remotePort,secureConnection,serviceContext);
  }
}
