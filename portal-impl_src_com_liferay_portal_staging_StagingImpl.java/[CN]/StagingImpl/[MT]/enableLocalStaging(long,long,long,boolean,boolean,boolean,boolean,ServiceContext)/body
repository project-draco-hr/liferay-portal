{
  Group liveGroup=GroupLocalServiceUtil.getGroup(liveGroupId);
  if (liveGroup.isStagedRemotely()) {
    disableStaging(scopeGroupId,liveGroupId,serviceContext);
  }
  UnicodeProperties typeSettingsProperties=liveGroup.getTypeSettingsProperties();
  typeSettingsProperties.setProperty("branching-private",String.valueOf(branchingPrivate));
  typeSettingsProperties.setProperty("branching-public",String.valueOf(branchingPublic));
  typeSettingsProperties.setProperty("locking-private",String.valueOf(lockingPrivate));
  typeSettingsProperties.setProperty("locking-public",String.valueOf(lockingPublic));
  typeSettingsProperties.setProperty("staged",Boolean.TRUE.toString());
  typeSettingsProperties.setProperty("stagedRemotely",String.valueOf(false));
  setCommonStagingOptions(liveGroup,typeSettingsProperties,serviceContext);
  if (!liveGroup.hasStagingGroup()) {
    serviceContext.setAttribute("staging",String.valueOf(true));
    Group stagingGroup=GroupLocalServiceUtil.addGroup(userId,liveGroup.getClassName(),liveGroup.getClassPK(),liveGroup.getGroupId(),liveGroup.getDescriptiveName(),liveGroup.getDescription(),liveGroup.getType(),liveGroup.getFriendlyURL(),liveGroup.isActive(),serviceContext);
    GroupLocalServiceUtil.updateGroup(liveGroup.getGroupId(),typeSettingsProperties.toString());
    if (liveGroup.hasPrivateLayouts()) {
      Map<String,String[]> parameterMap=getStagingParameters();
      publishLayouts(userId,liveGroup.getGroupId(),stagingGroup.getGroupId(),true,parameterMap,null,null);
    }
    if (liveGroup.hasPublicLayouts()) {
      Map<String,String[]> parameterMap=getStagingParameters();
      publishLayouts(userId,liveGroup.getGroupId(),stagingGroup.getGroupId(),false,parameterMap,null,null);
    }
    if (branchingPublic) {
      LayoutSetBranchLocalServiceUtil.addLayoutSetBranch(userId,stagingGroup.getGroupId(),false,LayoutSetBranchConstants.MASTER_BRANCH_NAME,LayoutSetBranchConstants.MASTER_BRANCH_NAME.concat(" branch of ").concat(stagingGroup.getDescriptiveName()),serviceContext);
    }
    if (branchingPrivate) {
      LayoutSetBranchLocalServiceUtil.addLayoutSetBranch(userId,stagingGroup.getGroupId(),true,LayoutSetBranchConstants.MASTER_BRANCH_NAME,LayoutSetBranchConstants.MASTER_BRANCH_NAME.concat(" branch of ").concat(stagingGroup.getDescriptiveName()),serviceContext);
    }
  }
 else {
    GroupLocalServiceUtil.updateGroup(liveGroup.getGroupId(),typeSettingsProperties.toString());
    if (!branchingPublic) {
      LayoutSetBranchLocalServiceUtil.deleteLayoutSetBranches(liveGroup.getStagingGroup().getGroupId(),true);
    }
  }
}
