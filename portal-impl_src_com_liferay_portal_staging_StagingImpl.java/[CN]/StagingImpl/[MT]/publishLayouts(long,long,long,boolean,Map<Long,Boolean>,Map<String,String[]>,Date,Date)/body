{
  List<Layout> layouts=new ArrayList<Layout>();
  for (  Map.Entry<Long,Boolean> entry : layoutIdMap.entrySet()) {
    long plid=GetterUtil.getLong(String.valueOf(entry.getKey()));
    boolean includeChildren=entry.getValue();
    Layout layout=LayoutLocalServiceUtil.getLayout(plid);
    if (!layouts.contains(layout)) {
      layouts.add(layout);
    }
    List<Layout> parentLayouts=getMissingParentLayouts(layout,targetGroupId);
    for (    Layout parentLayout : parentLayouts) {
      if (!layouts.contains(parentLayout)) {
        layouts.add(parentLayout);
      }
    }
    if (includeChildren) {
      for (      Layout childLayout : layout.getAllChildren()) {
        if (!layouts.contains(childLayout)) {
          layouts.add(childLayout);
        }
      }
    }
  }
  long[] layoutIds=getLayoutIds(layouts);
  publishLayouts(userId,sourceGroupId,targetGroupId,privateLayout,layoutIds,parameterMap,startDate,endDate);
}
