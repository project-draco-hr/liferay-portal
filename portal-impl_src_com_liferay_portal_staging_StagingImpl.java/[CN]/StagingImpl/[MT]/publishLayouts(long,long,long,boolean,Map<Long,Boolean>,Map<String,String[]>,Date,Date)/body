{
  List<Layout> layouts=new ArrayList<Layout>();
  for (  Map.Entry<Long,Boolean> entry : layoutIdMap.entrySet()) {
    long plid=GetterUtil.getLong(String.valueOf(entry.getKey()));
    boolean includeChildren=entry.getValue();
    Layout layout=LayoutLocalServiceUtil.getLayout(plid);
    if (!layouts.contains(layout)) {
      layouts.add(layout);
    }
    List<Layout> parentLayouts=getMissingParentLayouts(layout,targetGroupId);
    for (    Layout parentLayout : parentLayouts) {
      if (!layouts.contains(parentLayout)) {
        layouts.add(parentLayout);
      }
    }
    if (includeChildren) {
      List<Layout> children=layout.getAllChildren();
      for (      Layout childLayout : children) {
        if (!layouts.contains(childLayout)) {
          layouts.add(childLayout);
        }
      }
    }
  }
  long[] layoutIds=new long[layouts.size()];
  for (int i=0; i < layouts.size(); i++) {
    Layout curLayout=layouts.get(i);
    layoutIds[i]=curLayout.getLayoutId();
  }
  publishLayouts(userId,sourceGroupId,targetGroupId,privateLayout,layoutIds,parameterMap,startDate,endDate);
}
