{
  JSONArray errorMessagesJSONArray=JSONFactoryUtil.createJSONArray();
  for (  String missingReferenceDisplayName : missingReferences.keySet()) {
    MissingReference missingReference=missingReferences.get(missingReferenceDisplayName);
    JSONObject errorMessageJSONObject=JSONFactoryUtil.createJSONObject();
    Map<String,String> referrers=missingReference.getReferrers();
    if (referrers.size() == 1) {
      Set<Map.Entry<String,String>> referrerDisplayNames=referrers.entrySet();
      Iterator<Map.Entry<String,String>> iterator=referrerDisplayNames.iterator();
      Map.Entry<String,String> entry=iterator.next();
      String referrerDisplayName=entry.getKey();
      String referrerClasName=entry.getValue();
      if (referrerClasName.equals(Portlet.class.getName())) {
        referrerDisplayName=PortalUtil.getPortletTitle(referrerDisplayName,themeDisplay.getLocale());
      }
      errorMessageJSONObject.put("info",themeDisplay.translate("referenced-by-a-x-x",new String[]{ResourceActionsUtil.getModelResource(themeDisplay.getLocale(),referrerClasName),referrerDisplayName}));
    }
 else {
      errorMessageJSONObject.put("info",themeDisplay.translate("referenced-by-x-elements",referrers.size()));
    }
    errorMessageJSONObject.put("name",missingReferenceDisplayName);
    errorMessageJSONObject.put("type",ResourceActionsUtil.getModelResource(themeDisplay.getLocale(),missingReference.getClassName()));
    errorMessagesJSONArray.put(errorMessageJSONObject);
  }
  return errorMessagesJSONArray;
}
