{
  String oldPortalPreferences=portalPreferences.getValue(Staging.class.getName(),"ATTRIBUTE_MAP");
  try {
    JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
    JSONArray oldJsonArray=JSONFactoryUtil.createJSONArray(oldPortalPreferences);
    String recentLayoutBranchIdKey=getRecentLayoutBranchIdKey(layoutSetBranchId,plid);
    boolean alreadyExists=false;
    for (int i=0; i < oldJsonArray.length(); i++) {
      JSONObject jsonObject=oldJsonArray.getJSONObject(i);
      if (Validator.isNotNull(jsonObject.getString(recentLayoutBranchIdKey))) {
        alreadyExists=true;
        jsonObject.remove(recentLayoutBranchIdKey);
        jsonObject.put(recentLayoutBranchIdKey,String.valueOf(layoutBranchId));
      }
      jsonArray.put(jsonObject);
    }
    if (!alreadyExists) {
      JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
      jsonObject.put(recentLayoutBranchIdKey,String.valueOf(layoutBranchId));
      jsonArray.put(jsonObject);
    }
    portalPreferences.setValue(Staging.class.getName(),"ATTRIBUTE_MAP",jsonArray.toString());
  }
 catch (  JSONException je) {
    if (_log.isWarnEnabled()) {
      _log.warn("Staging preferences are not in JSON format. " + "Unable to set recent layout branch ID",je);
    }
  }
}
