{
  IndexSearcher indexSearcher=null;
  try {
    Map<String,List<String>> suggestions=new LinkedHashMap<String,List<String>>();
    float scoresThreshold=searchContext.getScoresThreshold();
    if (scoresThreshold == 0) {
      scoresThreshold=QueryIndexingHitsProcessor.SCORES_THRESHOLD_DEFAULT;
    }
    indexSearcher=LuceneHelperUtil.getSearcher(searchContext.getCompanyId(),true);
    List<IndexReader> indexReaders=new ArrayList<IndexReader>();
    if (indexSearcher.maxDoc() > 0) {
      ReaderUtil.gatherSubReaders(indexReaders,indexSearcher.getIndexReader());
    }
    for (    String keyword : keywords) {
      List<String> suggestionsList=Collections.emptyList();
      if (!SpellCheckerUtil.isValidWord(localizedFieldName,keyword,indexReaders)) {
        int frequency=indexSearcher.docFreq(new Term(localizedFieldName,keyword));
        String[] suggestionsArray=null;
        if (frequency > 0) {
          suggestionsArray=new String[]{keyword};
        }
 else {
          BooleanQuery suggestWordQuery=buildSpellCheckQuery(keyword,languageId);
          RelevancyChecker relevancyChecker=new StringDistanceRelevancyChecker(keyword,scoresThreshold,_stringDistance);
          suggestionsArray=search(indexSearcher,suggestWordQuery,localizedFieldName,relevancyChecker,max);
        }
        suggestionsList=Arrays.asList(suggestionsArray);
      }
      suggestions.put(keyword,suggestionsList);
    }
    return suggestions;
  }
 catch (  IOException ioe) {
    throw new SearchException("Unable to find suggestions",ioe);
  }
 finally {
    LuceneHelperUtil.closeSearcher(indexSearcher);
  }
}
