{
  Fields fields=new Fields();
  for (  Map.Entry<String,Serializable> entry : fieldsMap.entrySet()) {
    Field field=new Field();
    field.setDDMStructureId(ddmStructureId);
    field.setName(entry.getKey());
    field.addValue(locale,String.valueOf(entry.getValue()));
    if (create && !locale.equals(defaultLocale)) {
      field.addValue(defaultLocale,String.valueOf(entry.getValue()));
    }
    field.setDefaultLocale(defaultLocale);
    fields.put(field);
  }
  Field fieldsDisplayField=fields.get(_FIELDS_DISPLAY_NAME);
  if (fieldsDisplayField == null) {
    StringBundler fieldsDisplayFieldSB=new StringBundler(fieldsMap.size() * 4 - 1);
    for (    String fieldName : fields.getNames()) {
      fieldsDisplayFieldSB.append(fieldName);
      fieldsDisplayFieldSB.append(_INSTANCE_SEPARATOR);
      fieldsDisplayFieldSB.append(StringUtil.randomString());
      fieldsDisplayFieldSB.append(StringPool.COMMA);
    }
    if (fieldsDisplayFieldSB.index() > 0) {
      fieldsDisplayFieldSB.setIndex(fieldsDisplayFieldSB.index() - 1);
    }
    fieldsDisplayField=new Field(ddmStructureId,_FIELDS_DISPLAY_NAME,fieldsDisplayFieldSB.toString());
    fields.put(fieldsDisplayField);
  }
  return fields;
}
