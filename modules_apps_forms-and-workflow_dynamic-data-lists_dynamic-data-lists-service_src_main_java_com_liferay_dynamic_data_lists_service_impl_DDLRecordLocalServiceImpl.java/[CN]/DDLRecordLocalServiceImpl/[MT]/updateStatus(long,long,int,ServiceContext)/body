{
  User user=userPersistence.findByPrimaryKey(userId);
  DDLRecordVersion recordVersion=ddlRecordVersionPersistence.findByPrimaryKey(recordVersionId);
  recordVersion.setStatus(status);
  recordVersion.setStatusByUserId(user.getUserId());
  recordVersion.setStatusByUserName(user.getFullName());
  recordVersion.setStatusDate(new Date());
  ddlRecordVersionPersistence.update(recordVersion);
  DDLRecord record=ddlRecordPersistence.findByPrimaryKey(recordVersion.getRecordId());
  if (status == WorkflowConstants.STATUS_APPROVED) {
    if (DLUtil.compareVersions(record.getVersion(),recordVersion.getVersion()) <= 0) {
      record.setDDMStorageId(recordVersion.getDDMStorageId());
      record.setVersion(recordVersion.getVersion());
      record.setRecordSetId(recordVersion.getRecordSetId());
      record.setDisplayIndex(recordVersion.getDisplayIndex());
      record.setVersion(recordVersion.getVersion());
      record.setVersionUserId(recordVersion.getUserId());
      record.setVersionUserName(recordVersion.getUserName());
      ddlRecordPersistence.update(record);
    }
  }
 else {
    if (Validator.equals(record.getVersion(),recordVersion.getVersion())) {
      String newVersion=DDLRecordConstants.VERSION_DEFAULT;
      List<DDLRecordVersion> approvedRecordVersions=ddlRecordVersionPersistence.findByR_S(record.getRecordId(),WorkflowConstants.STATUS_APPROVED);
      if (!approvedRecordVersions.isEmpty()) {
        newVersion=approvedRecordVersions.get(0).getVersion();
      }
      record.setVersion(newVersion);
      ddlRecordPersistence.update(record);
    }
  }
  Locale locale=serviceContext.getLocale();
  updateAsset(userId,record,recordVersion,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames(),locale,serviceContext.getAssetPriority());
  return record;
}
