{
  Template template=getTemplate(renderRequest);
  Map<String,Object> capabilitiesContext=new HashMap<>();
  HttpServletRequest httpServletRequest=PortalUtil.getHttpServletRequest(renderRequest);
  String imageUrl=ParamUtil.getString(httpServletRequest,ImageEditorPortletKeys.IMAGE_EDITOR_URL);
  capabilitiesContext.put("tools",getImageEditorToolsContext(renderRequest));
  ThemeDisplay themeDisplay=(ThemeDisplay)httpServletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  template.put("capabilities",capabilitiesContext);
  template.put("image",imageUrl);
  template.put("pathThemeImages",themeDisplay.getPathThemeImages());
  return "ImageEditor";
}
