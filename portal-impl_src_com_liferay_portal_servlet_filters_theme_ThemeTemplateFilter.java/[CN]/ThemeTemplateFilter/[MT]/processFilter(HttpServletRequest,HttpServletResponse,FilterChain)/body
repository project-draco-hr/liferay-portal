{
  ServletContext servletContext=getFilterConfig().getServletContext();
  long companyId=PortalUtil.getCompanyId(request);
  String themeId=ParamUtil.getString(request,"themeId");
  String path=request.getRequestURI();
  if (Validator.isNotNull(themeId)) {
    Theme theme=ThemeLocalServiceUtil.getTheme(companyId,themeId,false);
    request.setAttribute(WebKeys.THEME,theme);
    request.setAttribute("path",path);
    RequestDispatcher requestDispatcher=servletContext.getRequestDispatcher(WRAPPER_PATH);
    if (requestDispatcher != null) {
      requestDispatcher.include(request,response);
    }
  }
 else {
    processFilter(ThemeTemplateFilter.class,request,response,filterChain);
  }
}
