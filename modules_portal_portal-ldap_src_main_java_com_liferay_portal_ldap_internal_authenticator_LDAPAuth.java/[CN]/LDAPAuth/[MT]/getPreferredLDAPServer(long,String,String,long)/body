{
  User user=null;
  if (userId > 0) {
    user=_userLocalService.fetchUserById(userId);
  }
 else   if (Validator.isNotNull(emailAddress)) {
    user=_userLocalService.fetchUserByEmailAddress(companyId,emailAddress);
  }
 else   if (Validator.isNotNull(screenName)) {
    user=_userLocalService.fetchUserByScreenName(companyId,screenName);
  }
 else {
    if (_log.isDebugEnabled()) {
      _log.debug("Unable to get preferred LDAP server");
    }
    return -1;
  }
  if (user == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Unable to get user " + userId);
    }
    return -1;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Using LDAP server " + user.getLdapServerId() + " to authenticate user "+ userId);
  }
  return user.getLdapServerId();
}
