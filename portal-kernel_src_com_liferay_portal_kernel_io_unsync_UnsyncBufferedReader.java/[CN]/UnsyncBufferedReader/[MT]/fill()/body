{
  int dst;
  if (markedChar <= UNMARKED) {
    dst=0;
  }
 else {
    int delta=nextChar - markedChar;
    if (delta >= readAheadLimit) {
      markedChar=INVALIDATED;
      readAheadLimit=0;
      dst=0;
    }
 else {
      if (readAheadLimit <= cb.length) {
        System.arraycopy(cb,markedChar,cb,0,delta);
        markedChar=0;
        dst=delta;
      }
 else {
        char ncb[]=new char[readAheadLimit];
        System.arraycopy(cb,markedChar,ncb,0,delta);
        cb=ncb;
        markedChar=0;
        dst=delta;
      }
      nextChar=nChars=delta;
    }
  }
  int n;
  do {
    n=in.read(cb,dst,cb.length - dst);
  }
 while (n == 0);
  if (n > 0) {
    nChars=dst + n;
    nextChar=dst;
  }
}
