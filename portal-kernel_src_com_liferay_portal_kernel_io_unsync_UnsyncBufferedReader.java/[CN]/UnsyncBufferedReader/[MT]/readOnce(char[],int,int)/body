{
  int available=firstInvalidIndex - index;
  if (available <= 0) {
    if ((markLimitIndex < 0) && (length >= buffer.length)) {
      return reader.read(chars,offset,length);
    }
 else {
      fillInBuffer();
      available=firstInvalidIndex - index;
      if (available <= 0) {
        return -1;
      }
    }
  }
  if (length > available) {
    length=available;
  }
  System.arraycopy(buffer,index,chars,offset,length);
  index+=length;
  return length;
}
