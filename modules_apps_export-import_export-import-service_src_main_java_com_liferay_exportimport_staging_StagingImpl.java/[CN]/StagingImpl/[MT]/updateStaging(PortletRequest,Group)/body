{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long userId=permissionChecker.getUserId();
  if (!GroupPermissionUtil.contains(permissionChecker,liveGroup,ActionKeys.MANAGE_STAGING)) {
    return;
  }
  int stagingType=getStagingType(portletRequest,liveGroup);
  boolean branchingPublic=getBoolean(portletRequest,liveGroup,"branchingPublic");
  boolean branchingPrivate=getBoolean(portletRequest,liveGroup,"branchingPrivate");
  boolean forceDisable=ParamUtil.getBoolean(portletRequest,"forceDisable");
  ServiceContext serviceContext=ServiceContextThreadLocal.getServiceContext();
  serviceContext.setAttribute("forceDisable",forceDisable);
  if (stagingType == StagingConstants.TYPE_NOT_STAGED) {
    if (liveGroup.hasStagingGroup() || liveGroup.isStagedRemotely()) {
      StagingLocalServiceUtil.disableStaging(portletRequest,liveGroup,serviceContext);
    }
  }
 else   if (stagingType == StagingConstants.TYPE_LOCAL_STAGING) {
    StagingLocalServiceUtil.enableLocalStaging(userId,liveGroup,branchingPublic,branchingPrivate,serviceContext);
  }
 else   if (stagingType == StagingConstants.TYPE_REMOTE_STAGING) {
    String remoteAddress=getString(portletRequest,liveGroup,"remoteAddress");
    remoteAddress=stripProtocolFromRemoteAddress(remoteAddress);
    int remotePort=getInteger(portletRequest,liveGroup,"remotePort");
    String remotePathContext=getString(portletRequest,liveGroup,"remotePathContext");
    boolean secureConnection=getBoolean(portletRequest,liveGroup,"secureConnection");
    long remoteGroupId=getLong(portletRequest,liveGroup,"remoteGroupId");
    StagingLocalServiceUtil.enableRemoteStaging(userId,liveGroup,branchingPublic,branchingPrivate,remoteAddress,remotePort,remotePathContext,secureConnection,remoteGroupId,serviceContext);
  }
}
