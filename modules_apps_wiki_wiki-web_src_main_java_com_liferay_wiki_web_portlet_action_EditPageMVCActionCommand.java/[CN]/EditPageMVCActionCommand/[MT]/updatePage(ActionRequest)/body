{
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  long nodeId=ParamUtil.getLong(actionRequest,"nodeId");
  String title=ParamUtil.getString(actionRequest,"title");
  double version=ParamUtil.getDouble(actionRequest,"version");
  String content=ParamUtil.getString(actionRequest,"content");
  String summary=ParamUtil.getString(actionRequest,"summary");
  boolean minorEdit=ParamUtil.getBoolean(actionRequest,"minorEdit");
  String format=ParamUtil.getString(actionRequest,"format");
  String parentTitle=ParamUtil.getString(actionRequest,"parentTitle");
  String redirectTitle=null;
  boolean copyPageAttachments=ParamUtil.getBoolean(actionRequest,"copyPageAttachments");
  ServiceContext serviceContext=ServiceContextFactory.getInstance(WikiPage.class.getName(),actionRequest);
  WikiPage page=null;
  if (cmd.equals(Constants.UPDATE)) {
    page=_wikiPageService.updatePage(nodeId,title,version,content,summary,minorEdit,format,parentTitle,redirectTitle,serviceContext);
  }
 else {
    page=_wikiPageService.addPage(nodeId,title,content,summary,minorEdit,format,parentTitle,redirectTitle,serviceContext);
    if (copyPageAttachments) {
      long templateNodeId=ParamUtil.getLong(actionRequest,"templateNodeId");
      String templateTitle=ParamUtil.getString(actionRequest,"templateTitle");
      _wikiPageService.copyPageAttachments(templateNodeId,templateTitle,page.getNodeId(),page.getTitle());
    }
  }
  _wikiAttachmentsHelper.addAttachments(actionRequest);
  return page;
}
