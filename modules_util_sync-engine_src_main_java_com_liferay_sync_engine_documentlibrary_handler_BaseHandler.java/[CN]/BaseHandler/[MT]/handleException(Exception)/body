{
  if (_event.isCancelled()) {
    return;
  }
  SyncAccount syncAccount=SyncAccountService.fetchSyncAccount(getSyncAccountId());
  if (!ConnectionRetryUtil.retryInProgress(getSyncAccountId()) && _logger.isDebugEnabled()) {
    _logger.debug("Handling exception {}",e.toString());
  }
  if (e instanceof HttpResponseException) {
    HttpResponseException hre=(HttpResponseException)e;
    int statusCode=hre.getStatusCode();
    if (statusCode == HttpStatus.SC_UNAUTHORIZED) {
      if (syncAccount.getUiEvent() == SyncAccount.UI_EVENT_AUTHENTICATION_EXCEPTION) {
        if (_logger.isDebugEnabled()) {
          _logger.debug("Authentication failed. Retrying in {} seconds.",syncAccount.getAuthenticationRetryInterval());
        }
        syncAccount.setState(SyncAccount.STATE_DISCONNECTED);
        SyncAccountService.update(syncAccount);
        ServerEventUtil.retryServerConnection(getSyncAccountId(),syncAccount.getAuthenticationRetryInterval(),TimeUnit.SECONDS);
      }
 else {
        syncAccount.setState(SyncAccount.STATE_DISCONNECTED);
        syncAccount.setUiEvent(SyncAccount.UI_EVENT_AUTHENTICATION_EXCEPTION);
        SyncAccountService.update(syncAccount);
        retryServerConnection(SyncAccount.UI_EVENT_AUTHENTICATION_EXCEPTION);
      }
      return;
    }
  }
  if ((e instanceof ClientProtocolException) || (e instanceof ConnectTimeoutException) || (e instanceof HttpHostConnectException)|| (e instanceof NoHttpResponseException)|| (e instanceof SocketException)|| (e instanceof SocketTimeoutException)|| (e instanceof UnknownHostException)) {
    retryServerConnection(SyncAccount.UI_EVENT_CONNECTION_EXCEPTION);
  }
 else   if (e instanceof FileNotFoundException) {
    SyncFile syncFile=(SyncFile)getParameterValue("syncFile");
    String message=e.getMessage();
    if (message.contains("The process cannot access the file")) {
      if (_logger.isTraceEnabled()) {
        _logger.trace("Retrying event {} for sync file {}",_event,syncFile);
      }
      ExecutorService executorService=SyncEngine.getExecutorService();
      executorService.execute(_event);
    }
 else     if (syncFile.getVersion() == null) {
      SyncFileService.deleteSyncFile(syncFile,false);
    }
  }
 else {
    _logger.error(e.getMessage(),e);
  }
}
