{
  try {
    MBeanServer mBeanServer=ManagementFactory.getPlatformMBeanServer();
    ObjectName objectName=new ObjectName(_BUNDLE_STATE_OBJECT_NAME);
    TabularData tabularData=(TabularData)mBeanServer.invoke(objectName,"listBundles",null,null);
    Collection<CompositeData> values=(Collection<CompositeData>)tabularData.values();
    List<Map<String,Object>> bundles=new ArrayList<>(values.size());
    for (    CompositeData compositeData : values) {
      String state=(String)compositeData.get("State");
      if (!ArrayUtil.contains(_INSTALLED_BUNDLE_STATES,state)) {
        continue;
      }
      String symbolicName=(String)compositeData.get("SymbolicName");
      if (Validator.isNull(symbolicName)) {
        continue;
      }
      Map<String,Object> bundleData=new HashMap<>();
      bundleData.put("bundleId",compositeData.get("Identifier"));
      bundleData.put("location",compositeData.get("Location"));
      bundleData.put("state",state);
      bundleData.put("symbolicName",symbolicName);
      String version=(String)compositeData.get("Version");
      bundleData.put("version",version);
      bundles.add(bundleData);
    }
    return bundles;
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
}
