{
  long classNameId=PortalUtil.getClassNameId(className);
  List<SocialEquitySetting> equitySettings=getEquitySettings(groupId,className,equityActionMapping.getActionId());
  if (equitySettings.isEmpty()) {
    SocialEquitySetting equitySetting=new SocialEquitySettingImpl();
    equitySetting.setActionId(equityActionMapping.getActionId());
    equitySetting.setType(SocialEquitySettingConstants.TYPE_INFORMATION);
    equitySettings.add(equitySetting);
    equitySetting=new SocialEquitySettingImpl();
    equitySetting.setActionId(equityActionMapping.getActionId());
    equitySetting.setType(SocialEquitySettingConstants.TYPE_PARTICIPATION);
    equitySettings.add(equitySetting);
  }
 else   if (equitySettings.size() == 1) {
    if (equitySettings.get(0).getType() == SocialEquitySettingConstants.TYPE_INFORMATION) {
      SocialEquitySetting equitySetting=new SocialEquitySettingImpl();
      equitySetting.setActionId(equityActionMapping.getActionId());
      equitySetting.setType(SocialEquitySettingConstants.TYPE_PARTICIPATION);
      equitySettings.add(equitySetting);
    }
 else {
      SocialEquitySetting equitySetting=new SocialEquitySettingImpl();
      equitySetting.setActionId(equityActionMapping.getActionId());
      equitySetting.setType(SocialEquitySettingConstants.TYPE_INFORMATION);
      equitySettings.add(equitySetting);
    }
  }
  for (  SocialEquitySetting equitySetting : equitySettings) {
    if (!equityActionMapping.equals(equitySetting)) {
      equitySetting.update(equityActionMapping);
      if (equitySetting.getPrimaryKey() == 0) {
        Group group=groupLocalService.getGroup(groupId);
        equitySetting.setEquitySettingId(counterLocalService.increment());
        equitySetting.setGroupId(groupId);
        equitySetting.setCompanyId(group.getCompanyId());
        equitySetting.setClassNameId(classNameId);
      }
      socialEquitySettingPersistence.update(equitySetting,false);
    }
  }
  String key=encodeKey(classNameId,equityActionMapping.getActionId());
  _portalCache.remove(key);
}
