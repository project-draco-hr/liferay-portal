{
  long classNameId=PortalUtil.getClassNameId(className);
  List<SocialEquitySetting> equitySettings=getEquitySettings(groupId,className,equityActionMapping.getActionId());
  if (equitySettings.isEmpty()) {
    equitySettings.add(new SocialEquitySettingImpl(equityActionMapping.getActionId(),SocialEquitySettingConstants.TYPE_INFORMATION));
    equitySettings.add(new SocialEquitySettingImpl(equityActionMapping.getActionId(),SocialEquitySettingConstants.TYPE_PARTICIPATION));
  }
 else   if (equitySettings.size() == 1) {
    if (equitySettings.get(0).getType() == SocialEquitySettingConstants.TYPE_INFORMATION) {
      equitySettings.add(new SocialEquitySettingImpl(equityActionMapping.getActionId(),SocialEquitySettingConstants.TYPE_PARTICIPATION));
    }
 else {
      equitySettings.add(new SocialEquitySettingImpl(equityActionMapping.getActionId(),SocialEquitySettingConstants.TYPE_INFORMATION));
    }
  }
  for (  SocialEquitySetting equitySetting : equitySettings) {
    if (!equityActionMapping.equals(equitySetting)) {
      equitySetting.update(equityActionMapping);
      if (equitySetting.getPrimaryKey() == 0) {
        Group group=groupLocalService.getGroup(groupId);
        equitySetting.setEquitySettingId(counterLocalService.increment());
        equitySetting.setGroupId(groupId);
        equitySetting.setCompanyId(group.getCompanyId());
        equitySetting.setClassNameId(classNameId);
      }
      socialEquitySettingPersistence.update(equitySetting,false);
    }
  }
  String key=encodeKey(classNameId,equityActionMapping.getActionId());
  _portalCache.remove(key);
}
