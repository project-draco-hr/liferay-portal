{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Callable<Group> groupCallable=new GroupCallable(actionRequest);
  try {
    Group group=TransactionHandlerUtil.invoke(_transactionAttribute,groupCallable);
    String redirect=StringPool.BLANK;
    long liveGroupId=ParamUtil.getLong(actionRequest,"liveGroupId");
    if (liveGroupId <= 0) {
      themeDisplay.setScopeGroupId(group.getGroupId());
      PortletURL siteAdministrationURL=PortalUtil.getSiteAdministrationURL(actionResponse,themeDisplay,PortletKeys.SITE_SETTINGS);
      String controlPanelURL=HttpUtil.setParameter(themeDisplay.getURLControlPanel(),"p_p_id",PortletKeys.SITES_ADMIN);
      controlPanelURL=HttpUtil.setParameter(controlPanelURL,"controlPanelCategory",themeDisplay.getControlPanelCategory());
      siteAdministrationURL.setParameter("redirect",controlPanelURL);
      redirect=siteAdministrationURL.toString();
      hideDefaultSuccessMessage(actionRequest);
      MultiSessionMessages.add(actionRequest,PortletKeys.SITE_SETTINGS + "requestProcessed");
    }
 else {
      long newRefererPlid=getRefererPlid(group,themeDisplay.getScopeGroupId(),redirect);
      redirect=HttpUtil.setParameter(redirect,"doAsGroupId",group.getGroupId());
      redirect=HttpUtil.setParameter(redirect,"refererPlid",newRefererPlid);
    }
    actionRequest.setAttribute(WebKeys.REDIRECT,redirect);
  }
 catch (  Throwable throwable) {
  }
}
