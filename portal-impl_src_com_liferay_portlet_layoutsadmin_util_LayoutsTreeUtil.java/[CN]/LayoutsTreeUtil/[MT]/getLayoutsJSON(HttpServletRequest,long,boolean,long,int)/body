{
  Layout layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,layoutId);
  long parentLayoutId=layout.getParentLayoutId();
  long includedLayoutIndex=LayoutServiceUtil.getLayoutsCount(groupId,privateLayout,parentLayoutId,layout.getPriority());
  int total=LayoutServiceUtil.getLayoutsCount(groupId,privateLayout,parentLayoutId);
  int start=(int)includedLayoutIndex - 1;
  int end=(int)includedLayoutIndex + max;
  if (end > total) {
    start=total - max;
    end=total;
    if (start < 0) {
      start=0;
    }
  }
  List<Layout> ancestorLayouts=LayoutServiceUtil.getAncestorLayouts(layout.getPlid());
  long[] ancestorLayoutsIds=new long[ancestorLayouts.size()];
  String[] ancestorLayoutsNames=new String[ancestorLayouts.size()];
  Locale locale=PortalUtil.getLocale(request);
  for (int i=0; i < ancestorLayouts.size(); i++) {
    ancestorLayoutsIds[i]=ancestorLayouts.get(i).getLayoutId();
    ancestorLayoutsNames[i]=ancestorLayouts.get(i).getName(locale);
  }
  List<Layout> layouts=LayoutServiceUtil.getLayouts(groupId,privateLayout,parentLayoutId,true,start,end);
  JSONObject jsonObject=_toJSONObject(layouts,request,groupId,total);
  jsonObject.put("ancestorIds",ancestorLayoutsIds);
  jsonObject.put("ancestorNames",ancestorLayoutsNames);
  jsonObject.put("startIndex",start);
  return jsonObject.toString();
}
