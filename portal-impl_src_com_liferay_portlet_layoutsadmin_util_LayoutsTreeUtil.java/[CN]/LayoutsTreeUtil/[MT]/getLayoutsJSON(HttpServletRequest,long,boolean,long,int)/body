{
  Layout layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,layoutId);
  long parentLayoutId=layout.getParentLayoutId();
  long includedLayoutIndex=LayoutServiceUtil.getLayoutsCount(groupId,privateLayout,parentLayoutId,layout.getPriority());
  int total=LayoutServiceUtil.getLayoutsCount(groupId,privateLayout,parentLayoutId);
  int start=(int)includedLayoutIndex - 1;
  int end=(int)includedLayoutIndex + max;
  if (end > total) {
    start=total - max;
    end=total;
    if (start < 0) {
      start=0;
    }
  }
  List<Layout> layouts=LayoutServiceUtil.getLayouts(groupId,privateLayout,parentLayoutId,true,start,end);
  JSONObject jsonObject=_toJSONObject(request,groupId,layouts,total);
  List<Layout> ancestorLayouts=LayoutServiceUtil.getAncestorLayouts(layout.getPlid());
  long[] ancestorLayoutIds=new long[ancestorLayouts.size()];
  String[] ancestorLayoutNames=new String[ancestorLayouts.size()];
  Locale locale=PortalUtil.getLocale(request);
  for (int i=0; i < ancestorLayouts.size(); i++) {
    Layout ancestorLayout=ancestorLayouts.get(i);
    ancestorLayoutIds[i]=ancestorLayout.getLayoutId();
    ancestorLayoutNames[i]=ancestorLayout.getName(locale);
  }
  jsonObject.put("ancestorLayoutIds",ancestorLayoutIds);
  jsonObject.put("ancestorLayoutNames",ancestorLayoutNames);
  jsonObject.put("start",start);
  return jsonObject.toString();
}
