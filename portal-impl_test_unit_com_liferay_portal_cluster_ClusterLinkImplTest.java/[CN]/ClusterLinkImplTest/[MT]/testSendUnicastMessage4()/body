{
  TransportationConfigurationAdvice.setChannelCount(1);
  CaptureHandler captureHandler=JDKLoggerTestUtil.configureJDKLogger(ClusterLinkImpl.class.getName(),Level.WARNING);
  ClusterLinkImpl clusterLinkImpl=null;
  try {
    clusterLinkImpl=getClusterLinkImpl();
    List<JChannel> jChannels=getJChannels(clusterLinkImpl);
    Message message=createMessage();
    JChannel jChannel=jChannels.get(0);
    jChannel.disconnect();
    List<LogRecord> logRecords=captureHandler.getLogRecords();
    clusterLinkImpl.sendUnicastMessage(new AddressImpl(new MockAddress()),message,Priority.LEVEL1);
    assertLogger(logRecords,"Unable to send unicast message " + message,IllegalStateException.class);
  }
  finally {
    captureHandler.close();
    if (clusterLinkImpl != null) {
      clusterLinkImpl.destroy();
    }
  }
}
