{
  TransportationConfigurationAdvice.setChannelCount(1);
  ClusterLinkImpl clusterLinkImpl=getClusterLinkImpl();
  try (CaptureHandler captureHandler=JDKLoggerTestUtil.configureJDKLogger(ClusterLinkImpl.class.getName(),Level.WARNING)){
    clusterLinkImpl.destroy();
    Message message=createMessage();
    List<LogRecord> logRecords=captureHandler.getLogRecords();
    clusterLinkImpl.sendUnicastMessage(new AddressImpl(new MockAddress()),message,Priority.LEVEL1);
    assertLogger(logRecords,"Unable to send unicast message " + message,IllegalStateException.class);
    clusterLinkImpl=getClusterLinkImpl();
    List<JChannel> jChannels=getJChannels(clusterLinkImpl);
    JChannel jChannel=jChannels.get(0);
    jChannel.disconnect();
    logRecords=captureHandler.resetLogLevel(Level.WARNING);
    clusterLinkImpl.sendUnicastMessage(new AddressImpl(new MockAddress()),message,Priority.LEVEL1);
    assertLogger(logRecords,"Unable to send unicast message " + message,IllegalStateException.class);
  }
  finally {
    clusterLinkImpl.destroy();
  }
}
