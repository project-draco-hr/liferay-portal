{
  TransportationConfigurationAdvice.setChannelCount(2);
  ClusterLinkImpl clusterLinkImpl=new ClusterLinkImpl();
  clusterLinkImpl.setClusterChannelFactory(new TestClusterChannelFactory());
  clusterLinkImpl.initialize();
  Assert.assertNotNull(clusterLinkImpl.getExecutorService());
  List<TestClusterChannel> clusterChannels=TestClusterChannel.getClusterChannels();
  Assert.assertEquals(2,clusterChannels.size());
  for (  TestClusterChannel clusterChannel : clusterChannels) {
    Assert.assertFalse(clusterChannel.isClosed());
    ClusterReceiver clusterReceiver=clusterChannel.getReceiver();
    CountDownLatch countDownLatch=ReflectionTestUtil.getFieldValue(clusterReceiver,"_countDownLatch");
    Assert.assertEquals(0,countDownLatch.getCount());
  }
}
