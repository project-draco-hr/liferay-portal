{
  Callable<Void> callable=new Callable<Void>(){
    public Void call() throws Exception {
      ClusterLinkImpl clusterLinkImpl1=_getClusterLinkImpl(1,true);
      ClusterLinkImpl clusterLinkImpl2=_getClusterLinkImpl(1,true);
      List<JChannel> jChannels1=_getJChannels(clusterLinkImpl1);
      List<JChannel> jChannels2=_getJChannels(clusterLinkImpl2);
      TestReceiver testReceiver1=_getTestReceiver(jChannels1,0);
      TestReceiver testReceiver2=_getTestReceiver(jChannels2,0);
      Message message=_createMessage();
      clusterLinkImpl1.sendUnicastMessage(new AddressImpl(jChannels2.get(0).getAddress()),message,Priority.LEVEL1);
      String localMessage1=testReceiver1.waitLocalMessage();
      String remoteMessage1=testReceiver1.waitRemoteMessage();
      String localMessage2=testReceiver2.waitLocalMessage();
      String remoteMessage2=testReceiver2.waitRemoteMessage();
      String messageKey=(String)message.getPayload();
      assertNull(localMessage1);
      assertNull(remoteMessage1);
      assertNull(localMessage2);
      assertEquals(messageKey,remoteMessage2);
      clusterLinkImpl1.destroy();
      clusterLinkImpl2.destroy();
      return null;
    }
  }
;
  runInNewClassLoader((Class<? extends Callable<Void>>)callable.getClass());
}
