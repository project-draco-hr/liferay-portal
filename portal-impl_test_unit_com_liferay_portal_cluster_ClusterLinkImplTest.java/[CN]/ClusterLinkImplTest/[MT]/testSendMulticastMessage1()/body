{
  Callable<Void> callable=new Callable<Void>(){
    public Void call() throws Exception {
      ObjectValuePair<ClusterLinkImpl,JChannel[]> clusterPlatform1=_getClusterLinkPlatform(1,true);
      ObjectValuePair<ClusterLinkImpl,JChannel[]> clusterPlatform2=_getClusterLinkPlatform(1,true);
      ObjectValuePair<ClusterLinkImpl,JChannel[]> clusterPlatform3=_getClusterLinkPlatform(1,true);
      TestReceiver testReceiver1=(TestReceiver)clusterPlatform1.getValue()[0].getReceiver();
      TestReceiver testReceiver2=(TestReceiver)clusterPlatform2.getValue()[0].getReceiver();
      TestReceiver testReceiver3=(TestReceiver)clusterPlatform3.getValue()[0].getReceiver();
      testReceiver1.setLocalMessageCount(1);
      testReceiver2.setRemoteMessageCount(1);
      testReceiver3.setRemoteMessageCount(1);
      Message message=_createMessage();
      try {
        clusterPlatform1.getKey().sendMulticastMessage(message,Priority.LEVEL1);
        testReceiver1.waitLocalMessage();
        testReceiver2.waitRemoteMessage();
        testReceiver3.waitRemoteMessage();
      }
 catch (      Exception e) {
        fail();
      }
      Set<String> localMessages1=testReceiver1.getReceivedLocalMessages();
      Set<String> remoteMessages1=testReceiver1.getReceivedRemoteMessages();
      Set<String> localMessages2=testReceiver2.getReceivedLocalMessages();
      Set<String> remoteMessages2=testReceiver2.getReceivedRemoteMessages();
      Set<String> localMessages3=testReceiver3.getReceivedLocalMessages();
      Set<String> remoteMessages3=testReceiver3.getReceivedRemoteMessages();
      assertEquals(1,localMessages1.size());
      assertEquals(0,remoteMessages1.size());
      assertEquals(0,localMessages2.size());
      assertEquals(1,remoteMessages2.size());
      assertEquals(0,localMessages3.size());
      assertEquals(1,remoteMessages3.size());
      String messageKey=(String)message.getPayload();
      assertTrue(localMessages1.contains(messageKey));
      assertTrue(remoteMessages2.contains(messageKey));
      assertTrue(remoteMessages3.contains(messageKey));
      clusterPlatform1.getKey().destroy();
      clusterPlatform2.getKey().destroy();
      clusterPlatform3.getKey().destroy();
      return null;
    }
  }
;
  runInNewClassLoader((Class<? extends Callable<Void>>)callable.getClass());
}
