{
  SyncAccount syncAccount=new SyncAccount();
  syncAccount.setFilePathName(filePathName);
  syncAccount.setLogin(login);
  syncAccount.setMaxConnections(maxConnections);
  syncAccount.setPassword(Encryptor.encrypt(password));
  syncAccount.setPollInterval(pollInterval);
  syncAccount.setTrustSelfSigned(trustSelfSigned);
  syncAccount.setUrl(url);
  _syncAccountPersistence.create(syncAccount);
  Path dataFilePath=Files.createDirectories(FileUtil.getFilePath(filePathName,".data"));
  if (OSDetector.isWindows()) {
    Files.setAttribute(dataFilePath,"dos:hidden",true);
  }
  SyncFileService.addSyncFile(null,null,null,filePathName,null,filePathName,0,0,syncAccount.getSyncAccountId(),SyncFile.TYPE_SYSTEM);
  if (syncSites != null) {
    for (    SyncSite syncSite : syncSites) {
      String syncSiteName=syncSite.getName();
      if (!FileUtil.isValidFileName(syncSiteName)) {
        syncSiteName=String.valueOf(syncSite.getGroupId());
      }
      syncSite.setFilePathName(FileUtil.getFilePathName(syncAccount.getFilePathName(),syncSiteName));
      syncSite.setSyncAccountId(syncAccount.getSyncAccountId());
      SyncSiteService.update(syncSite);
    }
  }
  syncUser.setSyncAccountId(syncAccount.getSyncAccountId());
  SyncUserService.update(syncUser);
  return syncAccount;
}
