{
  _user=UserTestUtil.addUser();
  UserLocalServiceUtil.setGroupUsers(_group.getGroupId(),new long[]{_user.getUserId()});
  PermissionChecker permissionChecker=_getPermissionChecker(_user);
  Portlet portlet=new PortletImpl(_user.getCompanyId(),_PORTLET_RESOURCE_NAME);
  PortletLocalServiceUtil.deployRemotePortlet(portlet,"category.hidden");
  try {
    boolean hasPermission=permissionChecker.hasPermission(_group.getGroupId(),_PORTLET_RESOURCE_NAME,_PORTLET_RESOURCE_NAME,ActionKeys.VIEW);
    Assert.assertTrue(hasPermission);
    hasPermission=permissionChecker.hasPermission(_group.getGroupId(),_PORTLET_RESOURCE_NAME,_PORTLET_RESOURCE_NAME,ActionKeys.CONFIGURATION);
    Assert.assertTrue(hasPermission);
    hasPermission=permissionChecker.hasPermission(_group.getGroupId(),_PORTLET_RESOURCE_NAME,_PORTLET_RESOURCE_NAME,ActionKeys.ACCESS_IN_CONTROL_PANEL);
    Assert.assertFalse(hasPermission);
  }
  finally {
    ResourceLocalServiceUtil.deleteResource(_user.getCompanyId(),_PORTLET_RESOURCE_NAME,ResourceConstants.SCOPE_INDIVIDUAL,_PORTLET_RESOURCE_NAME);
    PortletLocalServiceUtil.destroyRemotePortlet(portlet);
  }
}
