{
  _user=UserTestUtil.addUser();
  _role=RoleTestUtil.addRole(RandomTestUtil.randomString(),RoleConstants.TYPE_SITE);
  UserLocalServiceUtil.setRoleUsers(_role.getRoleId(),new long[]{_user.getUserId()});
  PermissionChecker permissionChecker=_getPermissionChecker(_user);
  ResourceLocalServiceUtil.addResources(permissionChecker.getCompanyId(),_group.getGroupId(),0,_ROOT_MODEL_RESOURCE_NAME,_group.getGroupId(),false,true,false);
  try {
    boolean hasPermission=permissionChecker.hasPermission(_group.getGroupId(),_ROOT_MODEL_RESOURCE_NAME,_group.getGroupId(),_ADD_SITE_TEST_ACTION);
    Assert.assertFalse(hasPermission);
    UserLocalServiceUtil.setGroupUsers(_group.getGroupId(),new long[]{_user.getUserId()});
    permissionChecker=_getPermissionChecker(_user);
    hasPermission=permissionChecker.hasPermission(_group.getGroupId(),_ROOT_MODEL_RESOURCE_NAME,_group.getGroupId(),_ADD_SITE_TEST_ACTION);
    Assert.assertTrue(hasPermission);
    hasPermission=permissionChecker.hasPermission(_group.getGroupId(),_ROOT_MODEL_RESOURCE_NAME,_group.getGroupId(),_ADD_SITE_TEST2_ACTION);
    Assert.assertFalse(hasPermission);
    ResourcePermissionLocalServiceUtil.setResourcePermissions(_user.getCompanyId(),_ROOT_MODEL_RESOURCE_NAME,ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(_group.getGroupId()),_role.getRoleId(),new String[]{_ADD_SITE_TEST2_ACTION});
    try {
      hasPermission=permissionChecker.hasPermission(_group.getGroupId(),_ROOT_MODEL_RESOURCE_NAME,_group.getGroupId(),_ADD_SITE_TEST2_ACTION);
      Assert.assertTrue(hasPermission);
    }
  finally {
      ResourcePermissionLocalServiceUtil.deleteResourcePermissions(_user.getCompanyId(),_ROOT_MODEL_RESOURCE_NAME,ResourceConstants.SCOPE_INDIVIDUAL,_group.getGroupId());
    }
  }
  finally {
    ResourceLocalServiceUtil.deleteResource(_user.getCompanyId(),_ROOT_MODEL_RESOURCE_NAME,ResourceConstants.SCOPE_INDIVIDUAL,_group.getGroupId());
  }
}
