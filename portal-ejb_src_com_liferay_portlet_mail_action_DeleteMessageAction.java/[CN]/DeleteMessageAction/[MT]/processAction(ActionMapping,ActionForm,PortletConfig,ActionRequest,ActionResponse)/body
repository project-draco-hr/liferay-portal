{
  try {
    String folderName=req.getParameter("folder_name");
    Folder folder=MailUtil.getFolder(req,folderName);
    List msgs=new ArrayList();
    String[] msgNumbers=req.getParameterValues("msg_numbers");
    if (msgNumbers != null) {
      for (int i=0; i < msgNumbers.length; i++) {
        try {
          int msgId=Integer.parseInt(msgNumbers[i]);
          msgs.add(folder.getMessage(msgId));
        }
 catch (        NumberFormatException nfe) {
        }
      }
    }
    Message[] messages=(Message[])msgs.toArray(new Message[0]);
    if (!folder.getFullName().equals(MailUtil.MAIL_BOX_STYLE + MailUtil.MAIL_TRASH_NAME)) {
      folder.copyMessages(messages,MailUtil.getFolder(req,MailUtil.MAIL_BOX_STYLE + MailUtil.MAIL_TRASH_NAME));
    }
    folder.setFlags(messages,new Flags(Flags.Flag.DELETED),true);
    folder.expunge();
    res.sendRedirect(ParamUtil.getString(req,"redirect"));
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    setForward(req,Constants.COMMON_ERROR);
  }
}
