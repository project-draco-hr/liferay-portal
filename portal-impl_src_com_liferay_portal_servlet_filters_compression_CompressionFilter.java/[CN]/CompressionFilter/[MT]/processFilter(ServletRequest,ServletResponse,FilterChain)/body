{
  HttpServletRequest httpReq=(HttpServletRequest)req;
  HttpServletResponse httpRes=(HttpServletResponse)res;
  String completeURL=HttpUtil.getCompleteURL(httpReq);
  if (isCompress(httpReq) && !isInclude(httpReq) && BrowserSniffer.acceptsGzip(httpReq)&& !isAlreadyFiltered(httpReq)) {
    if (_log.isDebugEnabled()) {
      _log.debug("Compressing " + completeURL);
    }
    httpReq.setAttribute(SKIP_FILTER,Boolean.TRUE);
    CompressionResponse compressionResponse=new CompressionResponse(httpRes);
    processFilter(CompressionFilter.class,req,compressionResponse,chain);
    compressionResponse.finishResponse();
  }
 else {
    if (_log.isDebugEnabled()) {
      _log.debug("Not compressing " + completeURL);
    }
    processFilter(CompressionFilter.class,req,res,chain);
  }
}
