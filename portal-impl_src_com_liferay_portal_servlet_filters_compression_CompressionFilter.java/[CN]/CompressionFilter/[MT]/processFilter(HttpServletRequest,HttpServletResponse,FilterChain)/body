{
  String completeURL=HttpUtil.getCompleteURL(request);
  if (isCompress(request) && !isInclude(request) && BrowserSnifferUtil.acceptsGzip(request)&& !isAlreadyFiltered(request)) {
    if (_log.isDebugEnabled()) {
      _log.debug("Compressing " + completeURL);
    }
    request.setAttribute(SKIP_FILTER,Boolean.TRUE);
    CompressionResponse compressionResponse=new CompressionResponse(response);
    processFilter(CompressionFilter.class,request,compressionResponse,filterChain);
    compressionResponse.finishResponse();
    String requestURI=request.getRequestURI();
    File realFile=new File(getFilterConfig().getServletContext().getRealPath(requestURI));
    if (realFile.exists()) {
      File tempFile=new File(SystemProperties.get(SystemProperties.TMP_DIR) + "/liferay/filter_cache" + requestURI+ ".gz");
      FileUtil.write(tempFile,compressionResponse.getOutputStream().getCompressedBytes());
    }
  }
 else {
    if (_log.isDebugEnabled()) {
      _log.debug("Not compressing " + completeURL);
    }
    processFilter(CompressionFilter.class,request,response,filterChain);
  }
}
