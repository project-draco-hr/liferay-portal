{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  long entryId=ParamUtil.getLong(req,"entryId");
  String title=ParamUtil.getString(req,"title");
  String content=ParamUtil.getString(req,"content");
  int displayDateMonth=ParamUtil.getInteger(req,"displayDateMonth");
  int displayDateDay=ParamUtil.getInteger(req,"displayDateDay");
  int displayDateYear=ParamUtil.getInteger(req,"displayDateYear");
  int displayDateHour=ParamUtil.getInteger(req,"displayDateHour");
  int displayDateMinute=ParamUtil.getInteger(req,"displayDateMinute");
  int displayDateAmPm=ParamUtil.getInteger(req,"displayDateAmPm");
  if (displayDateAmPm == Calendar.PM) {
    displayDateHour+=12;
  }
  boolean draft=ParamUtil.getBoolean(req,"draft");
  boolean allowTrackbacks=ParamUtil.getBoolean(req,"allowTrackbacks");
  String[] tagsEntries=StringUtil.split(ParamUtil.getString(req,"tagsEntries"));
  String[] trackbackUrls=StringUtil.split(ParamUtil.getString(req,"trackbackUrls"));
  boolean addCommunityPermissions=true;
  boolean addGuestPermissions=true;
  BlogsEntry entry=null;
  String oldUrlTitle=StringPool.BLANK;
  if (entryId <= 0) {
    entry=BlogsEntryServiceUtil.addEntry(layout.getPlid(),title,content,displayDateMonth,displayDateDay,displayDateYear,displayDateHour,displayDateMinute,draft,allowTrackbacks,trackbackUrls,tagsEntries,addCommunityPermissions,addGuestPermissions,themeDisplay);
    if (!draft) {
      AssetPublisherUtil.addAndStoreSelection(req,BlogsEntry.class.getName(),entry.getEntryId(),-1);
    }
  }
 else {
    entry=BlogsEntryLocalServiceUtil.getEntry(entryId);
    String tempOldUrlTitle=entry.getUrlTitle();
    boolean oldDraft=entry.isDraft();
    entry=BlogsEntryServiceUtil.updateEntry(entryId,title,content,displayDateMonth,displayDateDay,displayDateYear,displayDateHour,displayDateMinute,draft,allowTrackbacks,trackbackUrls,tagsEntries,themeDisplay);
    if (!tempOldUrlTitle.equals(entry.getUrlTitle())) {
      oldUrlTitle=tempOldUrlTitle;
    }
    if (oldDraft && !draft) {
      AssetPublisherUtil.addAndStoreSelection(req,BlogsEntry.class.getName(),entry.getEntryId(),-1);
    }
  }
  return new Object[]{entry,oldUrlTitle};
}
