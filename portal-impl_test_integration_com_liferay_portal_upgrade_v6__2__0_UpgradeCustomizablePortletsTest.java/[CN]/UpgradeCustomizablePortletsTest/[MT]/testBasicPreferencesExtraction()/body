{
  Layout layout=getLayout();
  long ownerId=1234;
  int ownerType=PortletKeys.PREFS_OWNER_TYPE_USER;
  String preferences=getPortalPreferencesString();
  preferences=StringUtil.replace(preferences,new String[]{"@plid@","@portlet_1@","@portlet_2@","@portlet_3@","@portlet_4@"},ArraysUtil.join(new String[]{String.valueOf(layout.getPlid())},_PORTLET_IDS));
  PortalPreferencesWrapper portalPreferencesWrapper=getPortalPreferences(ownerId,ownerType,preferences);
  upgradeCustomizablePreferences(portalPreferencesWrapper,ownerId,ownerType,preferences);
  Assert.assertEquals(4,_newPortletIds.size());
  Assert.assertFalse(PortletConstants.hasUserId(_newPortletIds.get(0)));
  Assert.assertTrue(PortletConstants.hasUserId(_newPortletIds.get(1)));
  Assert.assertTrue(PortletConstants.hasUserId(_newPortletIds.get(2)));
  Assert.assertTrue(PortletConstants.hasUserId(_newPortletIds.get(3)));
  Assert.assertFalse(PortletConstants.hasInstanceId(_newPortletIds.get(0)));
  Assert.assertTrue(PortletConstants.hasInstanceId(_newPortletIds.get(1)));
  Assert.assertTrue(PortletConstants.hasInstanceId(_newPortletIds.get(2)));
  Assert.assertTrue(PortletConstants.hasInstanceId(_newPortletIds.get(3)));
}
