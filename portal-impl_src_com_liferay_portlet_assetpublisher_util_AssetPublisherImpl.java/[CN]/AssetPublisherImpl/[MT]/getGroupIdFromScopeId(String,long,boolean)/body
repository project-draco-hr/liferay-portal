{
  if (scopeId.startsWith(SCOPE_ID_CHILD_GROUP_PREFIX)) {
    String scopeIdSuffix=scopeId.substring(SCOPE_ID_CHILD_GROUP_PREFIX.length());
    long childGroupId=GetterUtil.getLong(scopeIdSuffix);
    Group childGroup=GroupLocalServiceUtil.getGroup(childGroupId);
    if (!childGroup.hasAncestor(siteGroupId)) {
      throw new PrincipalException();
    }
    return childGroupId;
  }
 else   if (scopeId.startsWith(SCOPE_ID_GROUP_PREFIX)) {
    String scopeIdSuffix=scopeId.substring(SCOPE_ID_GROUP_PREFIX.length());
    if (scopeIdSuffix.equals(GroupConstants.DEFAULT)) {
      return siteGroupId;
    }
    return GetterUtil.getLong(scopeIdSuffix);
  }
 else   if (scopeId.startsWith(SCOPE_ID_LAYOUT_UUID_PREFIX)) {
    String layoutUuid=scopeId.substring(SCOPE_ID_LAYOUT_UUID_PREFIX.length());
    Layout scopeIdLayout=LayoutLocalServiceUtil.getLayoutByUuidAndGroupId(layoutUuid,siteGroupId,privateLayout);
    Group scopeIdGroup=null;
    if (scopeIdLayout.hasScopeGroup()) {
      scopeIdGroup=scopeIdLayout.getScopeGroup();
    }
 else {
      scopeIdGroup=GroupLocalServiceUtil.addGroup(PrincipalThreadLocal.getUserId(),GroupConstants.DEFAULT_PARENT_GROUP_ID,Layout.class.getName(),scopeIdLayout.getPlid(),GroupConstants.DEFAULT_LIVE_GROUP_ID,String.valueOf(scopeIdLayout.getPlid()),null,0,true,GroupConstants.DEFAULT_MEMBERSHIP_RESTRICTION,null,false,true,null);
    }
    return scopeIdGroup.getGroupId();
  }
 else   if (scopeId.startsWith(SCOPE_ID_LAYOUT_PREFIX)) {
    String scopeIdSuffix=scopeId.substring(SCOPE_ID_LAYOUT_PREFIX.length());
    long scopeIdLayoutId=GetterUtil.getLong(scopeIdSuffix);
    Layout scopeIdLayout=LayoutLocalServiceUtil.getLayout(siteGroupId,privateLayout,scopeIdLayoutId);
    Group scopeIdGroup=scopeIdLayout.getScopeGroup();
    return scopeIdGroup.getGroupId();
  }
 else   if (scopeId.startsWith(SCOPE_ID_PARENT_GROUP_PREFIX)) {
    String scopeIdSuffix=scopeId.substring(SCOPE_ID_PARENT_GROUP_PREFIX.length());
    long parentGroupId=GetterUtil.getLong(scopeIdSuffix);
    Group parentGroup=GroupLocalServiceUtil.getGroup(parentGroupId);
    if (!SitesUtil.isContentSharingWithChildrenEnabled(parentGroup)) {
      throw new PrincipalException();
    }
    Group group=GroupLocalServiceUtil.getGroup(siteGroupId);
    if (!group.hasAncestor(parentGroupId)) {
      throw new PrincipalException();
    }
    return parentGroupId;
  }
 else {
    throw new IllegalArgumentException("Invalid scope ID " + scopeId);
  }
}
