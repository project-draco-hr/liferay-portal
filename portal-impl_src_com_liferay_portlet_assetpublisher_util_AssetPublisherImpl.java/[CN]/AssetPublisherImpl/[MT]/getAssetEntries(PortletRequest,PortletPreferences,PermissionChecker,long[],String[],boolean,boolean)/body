{
  List<String> deletedAssets=new ArrayList<String>();
  List<AssetEntry> viewableResults=new ArrayList<AssetEntry>();
  for (  String assetEntryXml : assetEntryXmls) {
    Document document=SAXReaderUtil.read(assetEntryXml);
    Element rootElement=document.getRootElement();
    String assetEntryUuid=rootElement.elementText("asset-entry-uuid");
    AssetEntry assetEntry=null;
    for (    long groupId : groupIds) {
      assetEntry=AssetEntryLocalServiceUtil.fetchEntry(groupId,assetEntryUuid);
      if (assetEntry != null) {
        break;
      }
    }
    if (!assetEntry.isVisible()) {
      continue;
    }
    if (assetEntry == null) {
      if (deleteNotDisplayableAssets) {
        deletedAssets.add(assetEntryUuid);
      }
 else {
        continue;
      }
    }
    AssetRendererFactory assetRendererFactory=AssetRendererFactoryRegistryUtil.getAssetRendererFactoryByClassName(assetEntry.getClassName());
    AssetRenderer assetRenderer=assetRendererFactory.getAssetRenderer(assetEntry.getClassPK());
    if (deleteNotDisplayableAssets) {
      if (!assetRendererFactory.isActive(permissionChecker.getCompanyId())) {
        deletedAssets.add(assetEntryUuid);
        continue;
      }
    }
 else     if (!assetRenderer.isDisplayable() || (checkPermission && !assetRenderer.hasViewPermission(permissionChecker))) {
      continue;
    }
    viewableResults.add(assetEntry);
  }
  if (deleteNotDisplayableAssets) {
    AssetPublisherUtil.removeAndStoreSelection(deletedAssets,portletPreferences);
    if (!deletedAssets.isEmpty()) {
      SessionMessages.add(portletRequest,"removedSelectedAssets",deletedAssets);
    }
  }
  return new Tuple(viewableResults,deletedAssets);
}
