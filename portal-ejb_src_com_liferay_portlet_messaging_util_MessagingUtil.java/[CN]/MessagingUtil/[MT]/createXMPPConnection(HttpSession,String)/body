{
  if (isJabberEnabled()) {
    XMPPConnection con=null;
    try {
      con=new XMPPConnection(SERVER_ADDRESS,SERVER_PORT);
    }
 catch (    XMPPException e) {
      return;
    }
    try {
      con.login(userId,USER_PASSWORD,ses.getId());
    }
 catch (    XMPPException xmppe) {
      AccountManager accountManager=con.getAccountManager();
      accountManager.createAccount(userId,USER_PASSWORD);
      con.close();
      con=new XMPPConnection(SERVER_ADDRESS,SERVER_PORT);
      con.login(userId,USER_PASSWORD,ses.getId());
    }
    PacketFilter filter=new PacketTypeFilter(Message.class);
    PacketCollector collector=con.createPacketCollector(filter);
    MessageListener msgListener=new MessageListener(ses);
    con.addPacketListener(msgListener,filter);
    Roster roster=con.getRoster();
    roster.setSubscriptionMode(Roster.SUBSCRIPTION_ACCEPT_ALL);
    RosterUpdateListener rosterListener=new RosterUpdateListener(ses);
    roster.addRosterListener(rosterListener);
    JabberSession jabberSes=new JabberSession();
    jabberSes.setConnection(con);
    jabberSes.setCollector(collector);
    jabberSes.setMessageListener(msgListener);
    jabberSes.setRoster(roster);
    jabberSes.setRosterListener(rosterListener);
    ses.setAttribute(WebKeys.JABBER_XMPP_SESSION,jabberSes);
  }
}
