{
  Bundle bundle=bundleContext.getBundle();
  BundleWiring bundleWiring=bundle.adapt(BundleWiring.class);
  List<BundleCapability> bundleCapabilities=bundleWiring.getCapabilities(BundleRevision.PACKAGE_NAMESPACE);
  for (  BundleCapability bundleCapability : bundleCapabilities) {
    Map<String,Object> attributes=bundleCapability.getAttributes();
    String exportPackage=(String)attributes.get(BundleRevision.PACKAGE_NAMESPACE);
    if (clazz.equals(StringPool.STAR)) {
      continue;
    }
 else     if (clazz.endsWith(StringPool.STAR)) {
      clazz=clazz.substring(0,clazz.length() - 1);
      if (exportPackage.startsWith(clazz)) {
        BundleRevision bundleRevision=bundleCapability.getRevision();
        Bundle bundleRevisionBundle=bundleRevision.getBundle();
        BundleWiring bundleRevisionBundleWiring=bundleRevisionBundle.adapt(BundleWiring.class);
        return bundleRevisionBundleWiring.getClassLoader();
      }
    }
 else     if (clazz.equals(exportPackage)) {
      BundleRevision bundleRevision=bundleCapability.getRevision();
      Bundle bundleRevisionBundle=bundleRevision.getBundle();
      BundleWiring bundleRevisionBundleWiring=bundleRevisionBundle.adapt(BundleWiring.class);
      return bundleRevisionBundleWiring.getClassLoader();
    }
 else {
      String allowedClassPackage=clazz.substring(0,clazz.lastIndexOf("."));
      if (allowedClassPackage.equals(exportPackage)) {
        BundleRevision bundleRevision=bundleCapability.getRevision();
        Bundle bundleRevisionBundle=bundleRevision.getBundle();
        BundleWiring bundleRevisionBundleWiring=bundleRevisionBundle.adapt(BundleWiring.class);
        return bundleRevisionBundleWiring.getClassLoader();
      }
    }
  }
  return null;
}
