{
  if (className.equals(Execute.class.getName()) || className.equals(ObjectConstructor.class.getName())) {
    throw new TemplateException("Instantiating " + className + " is not allowed in the "+ "template for security reasons",environment);
  }
  String[] restrictedClassNames=GetterUtil.getStringValues(_freemarkerEngineConfiguration.restrictedClasses());
  for (  String restrictedClassName : restrictedClassNames) {
    if (restrictedClassName.equals(StringPool.STAR)) {
      throw new TemplateException("Instantiating " + className + " is not allowed in the "+ "template for security reasons",environment);
    }
 else     if (restrictedClassName.endsWith(StringPool.STAR)) {
      restrictedClassName=restrictedClassName.substring(0,restrictedClassName.length() - 1);
      if (className.startsWith(restrictedClassName)) {
        throw new TemplateException("Instantiating " + className + " is not allowed in "+ "the template for security reasons",environment);
      }
    }
 else     if (className.equals(restrictedClassName)) {
      throw new TemplateException("Instantiating " + className + " is not allowed in the "+ "template for security reasons",environment);
    }
  }
  boolean allowed=false;
  String[] allowedClasseNames=GetterUtil.getStringValues(_freemarkerEngineConfiguration.allowedClasses());
  for (  String allowedClassName : allowedClasseNames) {
    if (allowedClassName.equals(StringPool.STAR)) {
      allowed=true;
      break;
    }
 else     if (allowedClassName.endsWith(StringPool.STAR)) {
      allowedClassName=allowedClassName.substring(0,allowedClassName.length() - 1);
      if (className.startsWith(allowedClassName)) {
        allowed=true;
        break;
      }
    }
 else     if (allowedClassName.equals(className)) {
      allowed=true;
      break;
    }
  }
  if (allowed) {
    try {
      ClassLoader[] whiteListedClassLoaders=_whiteListedClassloaders.toArray(new ClassLoader[_whiteListedClassloaders.size()]);
      ClassLoader[] classLoaders=ArrayUtil.append(whiteListedClassLoaders,ClassLoaderUtil.getContextClassLoader());
      ClassLoader whiteListedAggregateClassLoader=AggregateClassLoader.getAggregateClassLoader(classLoaders);
      return Class.forName(className,true,whiteListedAggregateClassLoader);
    }
 catch (    Exception e) {
      throw new TemplateException(e,environment);
    }
  }
  throw new TemplateException("Instantiating " + className + " is not allowed in the template "+ "for security reasons",environment);
}
