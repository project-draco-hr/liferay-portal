{
  if (getCount() < _maxIdleSize) {
    SoftReference<V> softReference=new SoftReference<V>(value,_referenceQueue);
    _poolAction.onReturn(value);
    _softReferences.offer(softReference);
    if (_useWeakCounter) {
      _weakCounter.getAndIncrement();
    }
  }
 else {
    while (getCount() > _maxIdleSize) {
      if ((_softReferences.poll() != null) && _useWeakCounter) {
        _weakCounter.getAndDecrement();
      }
    }
  }
  SoftReference<? extends V> softReference=null;
  while (true) {
    softReference=(SoftReference<? extends V>)_referenceQueue.poll();
    if (softReference == null) {
      break;
    }
    if (_softReferences.remove(softReference) && _useWeakCounter) {
      _weakCounter.getAndDecrement();
    }
  }
}
