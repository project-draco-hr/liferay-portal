{
  if (Validator.isBlank(s) || Validator.isBlank(begin) || Validator.isBlank(end)|| MapUtil.isEmpty(values)) {
    return new StringBundler(s);
  }
  int size=values.size() + 1;
  for (  StringBundler valueSB : values.values()) {
    size+=valueSB.index();
  }
  StringBundler sb=new StringBundler(size);
  int pos=0;
  while (true) {
    int x=s.indexOf(begin,pos);
    int y=s.indexOf(end,x + begin.length());
    if ((x == -1) || (y == -1)) {
      sb.append(s.substring(pos));
      break;
    }
 else {
      sb.append(s.substring(pos,x));
      String oldValue=s.substring(x + begin.length(),y);
      StringBundler newValue=values.get(oldValue);
      if (newValue == null) {
        sb.append(oldValue);
      }
 else {
        sb.append(newValue);
      }
      pos=y + end.length();
    }
  }
  return sb;
}
