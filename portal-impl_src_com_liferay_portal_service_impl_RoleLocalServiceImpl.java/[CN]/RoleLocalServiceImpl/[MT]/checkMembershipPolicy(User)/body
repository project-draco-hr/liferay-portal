{
  List<Role> roles=getUserRoles(user.getUserId());
  for (  Role role : roles) {
    if (!MembershipPolicyUtil.isMembershipAllowed(role,user)) {
      unsetUserRoles(user.getUserId(),new long[]{role.getRoleId()});
    }
  }
  Set<Role> mandatoryRoles=MembershipPolicyUtil.getMandatoryRoles(user);
  for (  Role role : mandatoryRoles) {
    if (!hasUserRole(user.getUserId(),role.getRoleId())) {
      addUserRoles(user.getUserId(),new long[]{role.getRoleId()});
    }
  }
}
