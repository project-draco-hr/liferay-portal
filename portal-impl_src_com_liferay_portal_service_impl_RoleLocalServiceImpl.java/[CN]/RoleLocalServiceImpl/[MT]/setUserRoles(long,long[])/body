{
  userPersistence.setRoles(userId,roleIds);
  User user=userLocalService.getUser(userId);
  if (!user.isDefaultUser()) {
    Role role=roleLocalService.getRole(user.getCompanyId(),RoleConstants.USER);
    if (!ArrayUtil.contains(roleIds,role.getRoleId())) {
      userPersistence.addRole(userId,role.getRoleId());
    }
  }
  userLocalService.reIndex(userId);
  PermissionCacheUtil.clearCache();
}
