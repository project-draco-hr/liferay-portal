{
  Group group=groupPersistence.findByPrimaryKey(groupId);
  if (group.isLayout()) {
    group=group.getParentGroup();
  }
  List<Team> teams=teamPersistence.findByGroupId(group.getGroupId());
  if (teams.isEmpty()) {
    return Collections.emptyMap();
  }
  Set<Long> roleIds=SetUtil.fromArray(excludedRoleIds);
  Map<Team,Role> teamRoleMap=new LinkedHashMap<Team,Role>();
  for (  Team team : teams) {
    Role role=getTeamRole(team.getCompanyId(),team.getTeamId());
    if (roleIds.contains(role.getRoleId())) {
      continue;
    }
    teamRoleMap.put(team,role);
  }
  return teamRoleMap;
}
