{
  try {
    String ppInvoice=ParamUtil.getString(req,"invoice");
    ShoppingOrder order=ShoppingOrderLocalServiceUtil.getOrder(ppInvoice);
    ShoppingPreferences shoppingPrefs=ShoppingPreferences.getInstance(order.getCompanyId(),order.getGroupId());
    String ppReceiverEmail=ParamUtil.getString(req,"receiver_email");
    String payPalEmailAddress=shoppingPrefs.getPayPalEmailAddress();
    if (!payPalEmailAddress.equals(ppReceiverEmail)) {
      return false;
    }
    double ppGross=ParamUtil.getDouble(req,"mc_gross");
    double orderTotal=ShoppingUtil.calculateTotal(order);
    if (orderTotal != ppGross) {
      return false;
    }
    String ppCurrency=ParamUtil.getString(req,"mc_currency");
    String currencyId=shoppingPrefs.getCurrencyId();
    if (!currencyId.equals(ppCurrency)) {
      return false;
    }
    String ppTxnId=ParamUtil.getString(req,"txn_id");
    int ppTxnIdCount=ShoppingOrderLocalServiceUtil.getPayPalTxnIdOrderCount(ppTxnId);
    if (ppTxnIdCount > 0) {
      return false;
    }
  }
 catch (  Exception e) {
    return false;
  }
  return true;
}
