{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String factoryPid=ParamUtil.getString(renderRequest,"factoryPid");
  String pid=ParamUtil.getString(renderRequest,"pid",factoryPid);
  String viewType=ParamUtil.getString(renderRequest,"viewType");
  ConfigurationHelper configurationHelper=new ConfigurationHelper(_bundleContext,_configurationAdmin,_metaTypeService,themeDisplay.getLanguageId());
  if (path.equals("/edit_configuration.ftl")) {
    ConfigurationModel configurationModel=configurationHelper.getConfigurationModel(pid);
    if (configurationModel != null) {
      configurationModel=new ConfigurationModel(configurationModel.getObjectClassDefinition(),configurationHelper.getConfiguration(pid),configurationModel.getBundleLocation(),configurationModel.isFactory());
    }
    renderRequest.setAttribute("configurationHelper",configurationHelper);
    renderRequest.setAttribute("configurationModel",configurationModel);
    renderRequest.setAttribute("factoryPid",factoryPid);
    renderRequest.setAttribute("pid",pid);
  }
 else   if (viewType.equals("factoryInstances")) {
    ConfigurationModel factoryModel=configurationHelper.getConfigurationModel(factoryPid);
    renderRequest.setAttribute("factoryModel",factoryModel);
    List<ConfigurationModel> configurationModels=configurationHelper.getFactoryInstances(themeDisplay.getLanguageId(),factoryPid);
    renderRequest.setAttribute("configurationModelIterator",new ConfigurationModelIterator(configurationModels));
  }
 else {
    List<ConfigurationModel> configurationModels=configurationHelper.getConfigurationModels();
    renderRequest.setAttribute("configurationModelIterator",new ConfigurationModelIterator(configurationModels));
  }
  include(path,renderRequest,renderResponse,PortletRequest.RENDER_PHASE);
}
