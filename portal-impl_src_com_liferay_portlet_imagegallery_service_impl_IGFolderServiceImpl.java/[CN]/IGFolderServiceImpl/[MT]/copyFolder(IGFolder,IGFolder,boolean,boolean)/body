{
  long srcFolderId=srcFolder.getFolderId();
  long destFolderId=destFolder.getFolderId();
  long srcGroupId=srcFolder.getGroupId();
  long destGroupId=destFolder.getGroupId();
  List<IGImage> images=igImageService.getImages(srcFolderId);
  for (  IGImage image : images) {
    String name=image.getName();
    String description=image.getDescription();
    String contentType=ContentTypeUtil.getContentType(image.getImageType());
    String[] tagsEntries=null;
    File file=null;
    try {
      String fileName=SystemProperties.get(SystemProperties.TMP_DIR) + StringPool.SLASH + Time.getTimestamp()+ PwdGenerator.getPassword(PwdGenerator.KEY2,8);
      file=new File(fileName);
      Image imageObj=ImageLocalUtil.getImage(image.getLargeImageId());
      byte[] byteArray=imageObj.getTextObj();
      InputStream is=new ByteArrayInputStream(byteArray);
      FileUtil.write(file,is);
    }
 catch (    Exception e) {
      _log.error(e,e);
      continue;
    }
    igImageService.addImage(destFolderId,name,description,file,contentType,tagsEntries,addCommunityPermissions,addGuestPermissions);
  }
  List<IGFolder> srcSubFolders=getFolders(srcGroupId,srcFolderId);
  long destPlid=LayoutLocalServiceUtil.getDefaultPlid(destGroupId);
  for (  IGFolder srcSubFolder : srcSubFolders) {
    String name=srcSubFolder.getName();
    String description=srcSubFolder.getDescription();
    IGFolder destSubFolder=addFolder(destPlid,destFolderId,name,description,addCommunityPermissions,addGuestPermissions);
    copyFolder(srcSubFolder,destSubFolder,addCommunityPermissions,addGuestPermissions);
  }
}
