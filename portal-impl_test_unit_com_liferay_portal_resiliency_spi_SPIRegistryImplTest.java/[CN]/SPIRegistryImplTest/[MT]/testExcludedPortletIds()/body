{
  Assert.assertSame(_excludedPortletIds,_spiRegistryImpl.getExcludedPortletIds());
  String portlet1="portlet1";
  _spiRegistryImpl.addExcludedPortletId(portlet1);
  Assert.assertEquals(1,_excludedPortletIds.size());
  Assert.assertTrue(_excludedPortletIds.contains(portlet1));
  String portlet2="portlet2";
  SPI spi=new MockSPI();
  _portletSPIs.put(portlet2,spi);
  Assert.assertNull(_spiRegistryImpl.getPortletSPI(portlet1));
  Assert.assertSame(spi,_spiRegistryImpl.getPortletSPI(portlet2));
  _spiRegistryImpl.setSPIRegistryValidator(new MockSPIRegistryValidator());
  Assert.assertNull(_spiRegistryImpl.getPortletSPI(portlet1));
  Assert.assertSame(_spiRegistryImpl.getErrorSPI(),_spiRegistryImpl.getPortletSPI(portlet2));
  _spiRegistryImpl.setSPIRegistryValidator(null);
  _spiRegistryImpl.removeExcludedPortletId(portlet1);
  Assert.assertTrue(_excludedPortletIds.isEmpty());
}
