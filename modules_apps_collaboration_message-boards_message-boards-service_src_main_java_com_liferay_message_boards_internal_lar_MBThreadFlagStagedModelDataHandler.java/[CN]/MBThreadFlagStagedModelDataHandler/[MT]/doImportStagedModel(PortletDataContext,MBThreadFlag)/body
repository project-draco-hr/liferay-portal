{
  User user=_userLocalService.fetchUserByUuidAndCompanyId(threadFlag.getUserUuid(),portletDataContext.getCompanyId());
  if (user == null) {
    return;
  }
  Element element=portletDataContext.getImportDataStagedModelElement(threadFlag);
  long rootMessageId=GetterUtil.getLong(element.attributeValue("root-message-id"));
  String rootMessagePath=ExportImportPathUtil.getModelPath(portletDataContext,MBMessage.class.getName(),rootMessageId);
  MBMessage rootMessage=(MBMessage)portletDataContext.getZipEntryAsObject(element,rootMessagePath);
  StagedModelDataHandlerUtil.importStagedModel(portletDataContext,rootMessage);
  Map<Long,Long> threadIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(MBThread.class);
  long threadId=MapUtil.getLong(threadIds,threadFlag.getThreadId(),threadFlag.getThreadId());
  MBThread thread=_mbThreadLocalService.fetchThread(threadId);
  if (thread == null) {
    return;
  }
  ServiceContext serviceContext=portletDataContext.createServiceContext(threadFlag);
  serviceContext.setUuid(threadFlag.getUuid());
  _mbThreadFlagLocalService.addThreadFlag(user.getUserId(),thread,serviceContext);
}
