{
  long controlPanelPlid=PortalUtil.getControlPanelPlid(_company.getCompanyId());
  PortletURL url=PortletURLFactoryUtil.create(_request,PortletKeys.ASSET_BROWSER,controlPanelPlid,PortletRequest.RENDER_PHASE);
  url.setParameter("struts_action","/asset_browser/view");
  url.setParameter("eventName",getEventName());
  url.setPortletMode(PortletMode.VIEW);
  url.setWindowState(LiferayWindowState.POP_UP);
  if (_assetEntryId > 0) {
    url.setParameter("refererAssetEntryId",String.valueOf(_assetEntryId));
  }
  long groupId=_scopeGroup.getGroupId();
  if (_stagedLocally) {
    boolean stagedReferencePortlet=_scopeGroup.isStagedPortlet(assetRendererFactory.getPortletId());
    if (_stagedReferrerPortlet && !stagedReferencePortlet) {
      groupId=_scopeGroup.getLiveGroupId();
    }
  }
  url.setParameter("groupId",String.valueOf(groupId));
  url.setParameter("selectedGroupIds",StringUtil.merge(PortalUtil.getSharedContentSiteGroupIds(_company.getCompanyId(),groupId,_user.getUserId())));
  url.setParameter("typeSelection",assetRendererFactory.getClassName());
  return url;
}
