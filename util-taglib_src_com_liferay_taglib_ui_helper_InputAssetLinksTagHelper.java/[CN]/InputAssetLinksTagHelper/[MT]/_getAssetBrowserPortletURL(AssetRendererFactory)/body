{
  long controlPanelPlid=PortalUtil.getControlPanelPlid(_companyId);
  PortletURL url=PortletURLFactoryUtil.create(_request,PortletKeys.ASSET_BROWSER,controlPanelPlid,PortletRequest.RENDER_PHASE);
  url.setParameter("struts_action","/asset_browser/view");
  url.setParameter("eventName",getEventName());
  try {
    url.setPortletMode(PortletMode.VIEW);
  }
 catch (  PortletModeException e) {
    throw new PortalException(e);
  }
  try {
    url.setWindowState(LiferayWindowState.POP_UP);
  }
 catch (  WindowStateException e) {
    throw new PortalException(e);
  }
  if (_assetEntryId > 0) {
    url.setParameter("refererAssetEntryId",String.valueOf(_assetEntryId));
  }
  long groupId=_scopeGroup.getGroupId();
  if (_stagedLocally) {
    boolean stagedReferencePortlet=_scopeGroup.isStagedPortlet(factory.getPortletId());
    if (_stagedReferrerPortlet && !stagedReferencePortlet) {
      groupId=_scopeGroup.getLiveGroupId();
    }
  }
  url.setParameter("groupId",String.valueOf(groupId));
  url.setParameter("selectedGroupIds",_getSelectedGroupIdsParam(groupId));
  url.setParameter("typeSelection",factory.getClassName());
  return url;
}
