{
  for (  Element attachmentElement : attachmentElements) {
    String path=attachmentElement.attributeValue("path");
    FileEntry fileEntry=(FileEntry)portletDataContext.getZipEntryAsObject(path);
    if (fileEntryId == fileEntry.getFileEntryId()) {
      InputStream inputStream=null;
      try {
        String binPath=attachmentElement.attributeValue("bin-path");
        if (Validator.isNull(binPath) && portletDataContext.isPerformDirectBinaryImport()) {
          try {
            inputStream=FileEntryUtil.getContentStream(fileEntry);
          }
 catch (          NoSuchFileException nsfe) {
          }
        }
 else {
          inputStream=portletDataContext.getZipEntryAsInputStream(binPath);
        }
        if (inputStream == null) {
          if (_log.isWarnEnabled()) {
            _log.warn("Unable to import attachment for file entry " + fileEntry.getFileEntryId());
          }
          continue;
        }
        return new ImageSelector(FileUtil.getBytes(inputStream),fileEntry.getFileName(),fileEntry.getMimeType(),null);
      }
  finally {
        StreamUtil.cleanUp(inputStream);
      }
    }
  }
  return null;
}
