{
  if (DispatcherType.FORWARD != dispatcherType && DispatcherType.ERROR != dispatcherType && DispatcherType.ASYNC != dispatcherType) {
    throw new IllegalArgumentException("Illegal dispatcher type");
  }
  boolean isCommit=(DispatcherType.FORWARD == dispatcherType || DispatcherType.ERROR == dispatcherType);
  if (Globals.IS_SECURITY_ENABLED) {
    try {
      PrivilegedDispatch dp=new PrivilegedDispatch(request,response,dispatcherType);
      AccessController.doPrivileged(dp);
      if (isCommit && !request.isAsyncStarted()) {
        ApplicationDispatcherForward.commit(request,response,context,wrapper);
      }
    }
 catch (    PrivilegedActionException pe) {
      Exception e=pe.getException();
      if (e instanceof ServletException)       throw (ServletException)e;
      throw (IOException)e;
    }
  }
 else {
    doDispatch(request,response,dispatcherType);
    if (isCommit && !request.isAsyncStarted()) {
      ApplicationDispatcherForward.commit(request,response,context,wrapper);
    }
  }
}
