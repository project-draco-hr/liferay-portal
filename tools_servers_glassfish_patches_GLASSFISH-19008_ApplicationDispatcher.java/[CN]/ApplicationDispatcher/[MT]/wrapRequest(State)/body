{
  ServletRequest previous=null;
  ServletRequest current=state.outerRequest;
  while (current != null) {
    if ("org.apache.catalina.servlets.InvokerHttpRequest".equals(current.getClass().getName())) {
      break;
    }
    if (!(current instanceof ServletRequestWrapper)) {
      break;
    }
    if (current instanceof ApplicationHttpRequest) {
      break;
    }
    previous=current;
    current=((ServletRequestWrapper)current).getRequest();
  }
  HttpServletRequest hcurrent=(HttpServletRequest)current;
  boolean crossContext=false;
  if ((state.outerRequest instanceof ApplicationHttpRequest) || (state.outerRequest instanceof Request) || (state.outerRequest instanceof HttpServletRequest)) {
    HttpServletRequest houterRequest=(HttpServletRequest)state.outerRequest;
    Object contextPath=houterRequest.getAttribute(RequestDispatcher.INCLUDE_CONTEXT_PATH);
    if (contextPath == null) {
      contextPath=houterRequest.getContextPath();
    }
    crossContext=!(context.getPath().equals(contextPath));
  }
  crossContextFlag=Boolean.valueOf(crossContext);
  ApplicationHttpRequest wrapper=new ApplicationHttpRequest(hcurrent,context,crossContext,state.dispatcherType);
  if (previous == null) {
    state.outerRequest=wrapper;
  }
 else {
    ((ServletRequestWrapper)previous).setRequest(wrapper);
  }
  state.wrapRequest=wrapper;
  return wrapper;
}
