{
  if (languageId == null) {
    return _locale;
  }
  Locale locale=null;
  try {
    locale=_locales.get(languageId);
    if (locale == null) {
      int pos=languageId.indexOf(CharPool.UNDERLINE);
      if (pos == -1) {
        if (Arrays.binarySearch(_isoLanguages,languageId) < 0) {
          return _getDefault();
        }
        locale=new Locale(languageId);
      }
 else {
        String languageCode=languageId.substring(0,pos);
        String countryCode=languageId.substring(pos + 1,languageId.length());
        if ((Arrays.binarySearch(_isoLanguages,languageCode) < 0) || (Arrays.binarySearch(_isoCountries,countryCode) < 0)) {
          return _getDefault();
        }
        locale=new Locale(languageCode,countryCode);
      }
      _locales.put(languageId,locale);
    }
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(languageId + " is not a valid language id");
    }
  }
  if (locale == null) {
    locale=_locale;
  }
  return locale;
}
