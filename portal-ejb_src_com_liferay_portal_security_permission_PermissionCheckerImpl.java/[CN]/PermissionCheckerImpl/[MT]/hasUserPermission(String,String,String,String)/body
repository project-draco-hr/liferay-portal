{
  long start=0;
  if (_log.isDebugEnabled()) {
    start=System.currentTimeMillis();
  }
  String companyId=user.getActualCompanyId();
  if (isAdmin(companyId,groupId,name)) {
    return true;
  }
  start=logHasUserPermission(groupId,name,primKey,actionId,start,1);
  String[] resourceIds=new String[3];
  try {
    Resource resource=ResourceServiceUtil.getResource(companyId,name,ResourceImpl.TYPE_CLASS,ResourceImpl.SCOPE_INDIVIDUAL,primKey);
    resourceIds[0]=resource.getResourceId();
  }
 catch (  NoSuchResourceException nsre) {
    if (_log.isWarnEnabled()) {
      _log.warn("Resource " + companyId + " "+ name+ " "+ ResourceImpl.TYPE_CLASS+ " "+ ResourceImpl.SCOPE_INDIVIDUAL+ " "+ primKey+ " does not exist");
    }
  }
  start=logHasUserPermission(groupId,name,primKey,actionId,start,2);
  try {
    if (groupId != null) {
      Resource resource=ResourceServiceUtil.getResource(companyId,name,ResourceImpl.TYPE_CLASS,ResourceImpl.SCOPE_GROUP,groupId);
      resourceIds[1]=resource.getResourceId();
    }
  }
 catch (  NoSuchResourceException nsre) {
    if (_log.isWarnEnabled()) {
      _log.warn("Resource " + companyId + " "+ name+ " "+ ResourceImpl.TYPE_CLASS+ " "+ ResourceImpl.SCOPE_GROUP+ " "+ groupId+ " does not exist");
    }
  }
  start=logHasUserPermission(groupId,name,primKey,actionId,start,3);
  try {
    Resource resource=ResourceServiceUtil.getResource(companyId,name,ResourceImpl.TYPE_CLASS,ResourceImpl.SCOPE_COMPANY,companyId);
    resourceIds[2]=resource.getResourceId();
  }
 catch (  NoSuchResourceException nsre) {
    if (_log.isWarnEnabled()) {
      _log.warn("Resource " + companyId + " "+ name+ " "+ ResourceImpl.TYPE_CLASS+ " "+ ResourceImpl.SCOPE_COMPANY+ " "+ companyId+ " does not exist");
    }
  }
  start=logHasUserPermission(groupId,name,primKey,actionId,start,4);
  PermissionCheckerBag bag=getBag(groupId);
  boolean value=PermissionServiceUtil.hasUserPermissions(user.getUserId(),groupId,actionId,resourceIds,bag);
  start=logHasUserPermission(groupId,name,primKey,actionId,start,5);
  return value;
}
