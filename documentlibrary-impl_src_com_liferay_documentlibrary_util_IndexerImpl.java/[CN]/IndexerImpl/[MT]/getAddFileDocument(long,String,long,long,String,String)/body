{
  if (_log.isDebugEnabled()) {
    _log.debug("Indexing document " + companyId + " "+ portletId+ " "+ groupId+ " "+ repositoryId+ " "+ fileName);
  }
  String fileExt=StringPool.BLANK;
  int fileExtVersionPos=fileName.indexOf(DLServiceImpl.VERSION);
  if (fileExtVersionPos != -1) {
    int fileExtPos=fileName.lastIndexOf(StringPool.PERIOD,fileExtVersionPos);
    if (fileExtPos != -1) {
      fileExt=fileName.substring(fileExtPos,fileExtVersionPos);
    }
  }
 else {
    int fileExtPos=fileName.lastIndexOf(StringPool.PERIOD);
    if (fileExtPos != -1) {
      fileExt=fileName.substring(fileExtPos,fileName.length());
    }
  }
  InputStream is=null;
  try {
    Hook hook=HookFactory.getInstance();
    is=hook.getFileAsStream(companyId,repositoryId,fileName);
  }
 catch (  Exception e) {
  }
  if (is == null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Document " + companyId + " "+ portletId+ " "+ groupId+ " "+ repositoryId+ " "+ fileName+ " does not have any content");
    }
    return null;
  }
  Document doc=new Document();
  doc.add(LuceneFields.getKeyword(LuceneFields.UID,LuceneFields.getUID(portletId,repositoryId,fileName)));
  doc.add(LuceneFields.getKeyword(LuceneFields.COMPANY_ID,companyId));
  doc.add(LuceneFields.getKeyword(LuceneFields.PORTLET_ID,portletId));
  doc.add(LuceneFields.getKeyword(LuceneFields.GROUP_ID,groupId));
  doc.add(LuceneFields.getFile(LuceneFields.CONTENT,is,fileExt));
  if (Validator.isNotNull(properties)) {
    doc.add(LuceneFields.getText(LuceneFields.PROPERTIES,properties));
  }
  doc.add(LuceneFields.getDate(LuceneFields.MODIFIED));
  doc.add(LuceneFields.getKeyword("repositoryId",repositoryId));
  doc.add(LuceneFields.getKeyword("path",fileName));
  if (_log.isDebugEnabled()) {
    _log.debug("Document " + companyId + " "+ portletId+ " "+ groupId+ " "+ repositoryId+ " "+ fileName+ " indexed successfully");
  }
  return doc;
}
