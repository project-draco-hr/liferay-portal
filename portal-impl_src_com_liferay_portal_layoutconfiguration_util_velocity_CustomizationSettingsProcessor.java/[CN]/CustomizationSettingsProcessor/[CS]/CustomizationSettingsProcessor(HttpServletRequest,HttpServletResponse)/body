{
  JspFactory jspFactory=JspFactory.getDefaultFactory();
  ClassLoader contextClassLoader=ClassLoaderUtil.getContextClassLoader();
  try {
    ClassLoaderUtil.setContextClassLoader(PortalClassLoaderUtil.getClassLoader());
    _pageContext=jspFactory.getPageContext(new JSPSupportServlet(request.getServletContext()),request,response,null,false,0,false);
  }
  finally {
    ClassLoaderUtil.setContextClassLoader(contextClassLoader);
  }
  _writer=_pageContext.getOut();
  Layout selLayout=null;
  long selPlid=ParamUtil.getLong(request,"selPlid",LayoutConstants.DEFAULT_PLID);
  if (selPlid != LayoutConstants.DEFAULT_PLID) {
    selLayout=LayoutLocalServiceUtil.fetchLayout(selPlid);
  }
  _layoutTypeSettings=selLayout.getTypeSettingsProperties();
  if (!SitesUtil.isLayoutUpdateable(selLayout) || selLayout.isLayoutPrototypeLinkActive()) {
    _customizationEnabled=false;
  }
 else {
    _customizationEnabled=true;
  }
}
