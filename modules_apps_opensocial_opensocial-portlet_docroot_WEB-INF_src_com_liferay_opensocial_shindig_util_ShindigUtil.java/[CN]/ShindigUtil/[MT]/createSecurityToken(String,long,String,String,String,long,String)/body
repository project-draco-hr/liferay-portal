{
  String securityToken=StringPool.BLANK;
  String securityTokenType=_containerConfig.getString(ContainerConfig.DEFAULT_CONTAINER,"gadgets.securityTokenType");
  if (securityTokenType.equals("secure")) {
    String securityTokenKeyPath=_containerConfig.getString(ContainerConfig.DEFAULT_CONTAINER,"gadgets.securityTokenKeyFile");
    File securityTokenKeyFile=new File(securityTokenKeyPath);
    BlobCrypter blobCrypter=new BasicBlobCrypter(securityTokenKeyFile);
    BlobCrypterSecurityToken blobCrypterSecurityToken=new BlobCrypterSecurityToken(blobCrypter,ContainerConfig.DEFAULT_CONTAINER,domain);
    blobCrypterSecurityToken.setAppUrl(appUrl);
    blobCrypterSecurityToken.setModuleId(moduleId);
    blobCrypterSecurityToken.setOwnerId(ownerId);
    blobCrypterSecurityToken.setViewerId(String.valueOf(viewerId));
    securityToken=blobCrypterSecurityToken.encrypt();
  }
 else   if (securityTokenType.equals("insecure")) {
    BasicSecurityToken basicSecurityToken=new BasicSecurityToken(ownerId,String.valueOf(viewerId),appId,domain,appUrl,String.valueOf(moduleId),ContainerConfig.DEFAULT_CONTAINER,activeUrl,null);
    securityToken=_basicSecurityTokenCodec.encodeToken(basicSecurityToken);
  }
  securityToken=HttpUtil.encodeURL(securityToken);
  return securityToken;
}
