{
  String name=modelResourceElement.elementTextTrim("model-name");
  ModelResourceActionsBag modelResourceActionsBag=getModelResourceActionsBag(name);
  Element portletRefElement=modelResourceElement.element("portlet-ref");
  for (  Element portletNameElement : portletRefElement.elements("portlet-name")) {
    String portletName=portletNameElement.getTextTrim();
    if (servletContextName != null) {
      portletName=portletName.concat(PortletConstants.WAR_SEPARATOR).concat(servletContextName);
    }
    portletName=JS.getSafeName(portletName);
    Set<String> modelResources=_portletModelResources.get(portletName);
    if (modelResources == null) {
      modelResources=new HashSet<>();
      _portletModelResources.put(portletName,modelResources);
    }
    modelResources.add(name);
    Set<String> portletResources=modelResourceActionsBag.getResources();
    portletResources.add(portletName);
    boolean root=GetterUtil.getBoolean(modelResourceElement.elementText("root"));
    if (root) {
      _portletRootModelResource.put(portletName,name);
    }
  }
  double weight=GetterUtil.getDouble(modelResourceElement.elementTextTrim("weight"),100);
  Map<String,Double> modelResourceWeights=modelResourceActionsBag.getResourceWeights();
  modelResourceWeights.put(name,weight);
  Set<String> modelResourceActions=modelResourceActionsBag.getResourceActions();
  Set<String> supportsActions=readSupportsActions(modelResourceElement,modelResourceActions,name);
  checkModelActions(supportsActions);
  if (supportsActions.size() > 64) {
    throw new ResourceActionsException("There are more than 64 actions for resource " + name);
  }
  modelResourceActions.addAll(supportsActions);
  Set<String> modelResourceGroupDefaultActions=modelResourceActionsBag.getResourceGroupDefaultActions();
  readGroupDefaultActions(modelResourceElement,modelResourceGroupDefaultActions,name);
  Set<String> modelResourceGuestDefaultActions=modelResourceActionsBag.getResourceGuestDefaultActions();
  Set<String> guestDefaultActions=readGuestDefaultActions(modelResourceElement,modelResourceGuestDefaultActions,name);
  Set<String> modelResourceGuestUnsupportedActions=modelResourceActionsBag.getResourceGuestUnsupportedActions();
  readGuestUnsupportedActions(modelResourceElement,modelResourceGuestUnsupportedActions,name,guestDefaultActions);
  Set<String> modelResourceOwnerDefaultActions=modelResourceActionsBag.getResourceOwnerDefaultActions();
  readOwnerDefaultActions(modelResourceElement,modelResourceOwnerDefaultActions,name);
}
