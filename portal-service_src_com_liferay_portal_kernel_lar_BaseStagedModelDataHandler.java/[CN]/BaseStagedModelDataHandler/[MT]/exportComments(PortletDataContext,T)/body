{
  if (!MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.PORTLET_DATA_ALL) && !MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.COMMENTS)) {
    return;
  }
  MBDiscussion discussion=MBDiscussionLocalServiceUtil.fetchDiscussion(ExportImportClassedModelUtil.getClassName(stagedModel),ExportImportClassedModelUtil.getClassPK(stagedModel));
  if (discussion == null) {
    return;
  }
  List<MBMessage> messages=MBMessageLocalServiceUtil.getThreadMessages(discussion.getThreadId(),WorkflowConstants.STATUS_APPROVED);
  if (messages.isEmpty()) {
    return;
  }
  MBMessage firstMessage=messages.get(0);
  if ((messages.size() == 1) && firstMessage.isRoot()) {
    return;
  }
  for (  MBMessage message : messages) {
    StagedModelDataHandlerUtil.exportReferenceStagedModel(portletDataContext,stagedModel,message,PortletDataContext.REFERENCE_TYPE_WEAK);
  }
}
