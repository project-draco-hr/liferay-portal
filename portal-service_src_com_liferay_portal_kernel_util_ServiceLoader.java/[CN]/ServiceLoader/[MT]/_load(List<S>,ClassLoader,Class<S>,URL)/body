{
  if (ServerDetector.isJBoss5()) {
    url=URLUtil.normalizeURL(url);
  }
  InputStream inputStream=url.openStream();
  try {
    BufferedReader bufferedReader=new BufferedReader(new InputStreamReader(inputStream,StringPool.UTF8));
    while (true) {
      String line=bufferedReader.readLine();
      if (line == null) {
        break;
      }
      int comment=line.indexOf(CharPool.POUND);
      if (comment >= 0) {
        line=line.substring(0,comment);
      }
      String name=line.trim();
      if (name.length() == 0) {
        continue;
      }
      Class<?> serviceClass=Class.forName(name,true,classLoader);
      Class<? extends S> serviceImplClass=serviceClass.asSubclass(clazz);
      Constructor<? extends S> constructor=serviceImplClass.getConstructor();
      S service=constructor.newInstance();
      services.add(service);
    }
  }
  finally {
    inputStream.close();
  }
}
