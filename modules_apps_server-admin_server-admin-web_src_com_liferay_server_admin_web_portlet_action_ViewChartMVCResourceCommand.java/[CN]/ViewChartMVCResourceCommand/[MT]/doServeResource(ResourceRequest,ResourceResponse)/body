{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String type=ParamUtil.getString(resourceRequest,"type","max");
  long maxMemory=ParamUtil.getLong(resourceRequest,"maxMemory");
  long totalMemory=ParamUtil.getLong(resourceRequest,"totalMemory");
  long usedMemory=ParamUtil.getLong(resourceRequest,"usedMemory");
  ValueDataset valueDataset=null;
  StringBundler sb=new StringBundler(5);
  ResourceBundle resourceBundle=ResourceBundleUtil.getBundle("content.Language",themeDisplay.getLocale(),getClass());
  sb.append(ResourceBundleUtil.getString(resourceBundle,"used-memory"));
  sb.append(StringPool.SPACE);
  sb.append(StringPool.FORWARD_SLASH);
  sb.append(StringPool.SPACE);
  if (type.equals("total")) {
    valueDataset=new DefaultValueDataset((usedMemory * 100) / totalMemory);
    sb.append(ResourceBundleUtil.getString(resourceBundle,"total-memory"));
  }
 else {
    valueDataset=new DefaultValueDataset((usedMemory * 100) / maxMemory);
    sb.append(ResourceBundleUtil.getString(resourceBundle,"maximum-memory"));
  }
  MeterPlot meterPlot=getMeterPlot(themeDisplay,valueDataset);
  JFreeChart jFreeChart=getJFreeChart(sb.toString(),meterPlot);
  resourceResponse.setContentType(ContentTypes.IMAGE_PNG);
  ChartUtilities.writeChartAsPNG(resourceResponse.getPortletOutputStream(),jFreeChart,280,180);
}
