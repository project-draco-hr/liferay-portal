{
  ParserInput parserInput=getParserInput(page.getNodeId(),page.getTitle());
  String content=StringPool.BLANK;
  boolean hasUnderscore=false;
  try {
    content=page.getContent();
    DirectTagMatcher directTagMatcher=new DirectTagMatcher(page);
    String tagMatch=directTagMatcher.replaceMatches(content);
    if (tagMatch != null) {
      content=tagMatch;
      hasUnderscore=true;
    }
    ImageTagMatcher imageTagMatcher=new ImageTagMatcher();
    content=ParserUtil.parse(parserInput,parserOutput,imageTagMatcher.replaceMatches(content));
  }
 catch (  ParserException pe) {
    throw new PageContentException(pe);
  }
  if (attachmentURLPrefix != null) {
    DirectURLMatcher attachmentURLMatcher=new DirectURLMatcher(page,attachmentURLPrefix);
    String result=attachmentURLMatcher.replaceMatches(content,hasUnderscore);
    if (result != null) {
      content=result;
    }
    ImageURLMatcher imageURLMatcher=new ImageURLMatcher(attachmentURLPrefix);
    content=imageURLMatcher.replaceMatches(content);
  }
  if (editPageURL != null) {
    EditURLMatcher editURLMatcher=new EditURLMatcher(editPageURL);
    content=editURLMatcher.replaceMatches(content);
  }
  if (viewPageURL != null) {
    ViewURLMatcher viewURLMatcher=new ViewURLMatcher(viewPageURL);
    content=viewURLMatcher.replaceMatches(content);
  }
  return content;
}
