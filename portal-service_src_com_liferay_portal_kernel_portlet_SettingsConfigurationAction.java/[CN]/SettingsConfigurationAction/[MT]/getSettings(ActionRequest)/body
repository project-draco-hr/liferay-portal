{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String serviceName=ParamUtil.getString(actionRequest,"serviceName");
  String settingsScope=ParamUtil.getString(actionRequest,"settingsScope");
  if (settingsScope.equals("company")) {
    return SettingsFactoryUtil.getSettings(new CompanyServiceSettingsLocator(themeDisplay.getCompanyId(),serviceName));
  }
 else   if (settingsScope.equals("group")) {
    return SettingsFactoryUtil.getSettings(new GroupServiceSettingsLocator(themeDisplay.getSiteGroupId(),serviceName));
  }
 else   if (settingsScope.equals("portletInstance")) {
    String portletResource=ParamUtil.getString(actionRequest,"portletResource");
    return SettingsFactoryUtil.getSettings(new PortletInstanceSettingsLocator(themeDisplay.getLayout(),portletResource));
  }
  throw new IllegalArgumentException("Invalid settings scope " + settingsScope);
}
