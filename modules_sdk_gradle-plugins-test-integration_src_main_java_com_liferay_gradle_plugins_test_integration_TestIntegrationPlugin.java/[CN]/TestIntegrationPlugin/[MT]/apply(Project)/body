{
  GradleUtil.applyPlugin(project,TestIntegrationBasePlugin.class);
  final SourceSet testIntegrationSourceSet=GradleUtil.getSourceSet(project,TestIntegrationBasePlugin.TEST_INTEGRATION_SOURCE_SET_NAME);
  final Test testIntegrationTask=(Test)GradleUtil.getTask(project,TestIntegrationBasePlugin.TEST_INTEGRATION_TASK_NAME);
  final TestIntegrationTomcatExtension testIntegrationTomcatExtension=GradleUtil.addExtension(project,PLUGIN_NAME + "Tomcat",TestIntegrationTomcatExtension.class);
  SetupTestableTomcatTask setupTestableTomcatTask=addTaskSetupTestableTomcat(project,testIntegrationTomcatExtension);
  StopTestableTomcatTask stopTestableTomcatTask=addTaskStopTestableTomcat(project,testIntegrationTask,testIntegrationTomcatExtension);
  StartTestableTomcatTask startTestableTomcatTask=addTaskStartTestableTomcat(project,setupTestableTomcatTask,stopTestableTomcatTask,testIntegrationTomcatExtension);
  PluginContainer pluginContainer=project.getPlugins();
  pluginContainer.withType(WarPlugin.class,new Action<WarPlugin>(){
    @Override public void execute(    WarPlugin warPlugin){
      SetupArquillianTask setupArquillianTask=addTaskSetupArquillian(project,testIntegrationSourceSet,testIntegrationTomcatExtension);
      testIntegrationTask.dependsOn(setupArquillianTask);
    }
  }
);
  configureTaskTestIntegration(testIntegrationTask,testIntegrationSourceSet,testIntegrationTomcatExtension,startTestableTomcatTask);
}
