{
  while (!(portletResponse instanceof PortletResponseImpl)) {
    if (portletResponse instanceof PortletResponseWrapper) {
      PortletResponseWrapper portletResponseWrapper=(PortletResponseWrapper)portletResponse;
      portletResponse=portletResponseWrapper.getResponse();
    }
 else {
      throw new RuntimeException("Unable to unwrap the portlet response from " + portletResponse.getClass());
    }
  }
  return (PortletResponseImpl)portletResponse;
}
