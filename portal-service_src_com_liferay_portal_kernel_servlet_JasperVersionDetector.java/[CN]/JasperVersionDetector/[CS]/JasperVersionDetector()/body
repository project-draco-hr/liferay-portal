{
  try {
    Class<?> clazz=getClass();
    URL url=clazz.getResource("/org/apache/jasper/JasperException.class");
    if (url == null) {
      return;
    }
    String path=url.getPath();
    int pos=path.indexOf(CharPool.EXCLAMATION);
    if (pos == -1) {
      return;
    }
    URI jarFileURI=new URI(path.substring(0,pos));
    JarFile jarFile=new JarFile(new File(jarFileURI));
    Manifest manifest=jarFile.getManifest();
    Attributes attributes=manifest.getMainAttributes();
    String jasperVersion=GetterUtil.getString(attributes.getValue("Specification-Version"));
    if (Validator.isNull(jasperVersion) || !Character.isDigit(jasperVersion.charAt(0))) {
      jasperVersion=GetterUtil.getString(attributes.getValue("Implementation-Version"));
      if (Validator.isNull(jasperVersion)) {
        jasperVersion=GetterUtil.getString(attributes.getValue("Bundle-Version"));
      }
    }
    if (Validator.isNotNull(jasperVersion)) {
      _jasperVersion=jasperVersion;
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
