{
  ServiceReference<ConfigurationAdmin> serviceReference=bundleContext.getServiceReference(ConfigurationAdmin.class);
  try {
    ConfigurationAdmin configurationAdmin=bundleContext.getService(serviceReference);
    _cxfConfiguration=configurationAdmin.createFactoryConfiguration("com.liferay.portal.cxf.common.configuration." + "CXFEndpointPublisherConfiguration",null);
    Dictionary<String,Object> properties=new Hashtable<>();
    properties.put("contextPath","/soap-test");
    _cxfConfiguration.update(properties);
    _jaxWsApiConfiguration=configurationAdmin.getConfiguration("com.liferay.portal.soap.extender.configuration." + "JaxWsApiConfiguration",null);
    _jaxWsApiConfigurationProperties=_jaxWsApiConfiguration.getProperties();
    properties=new Hashtable<>();
    properties.put("contextPath","/soap-test");
    properties.put("timeout",10000);
    _jaxWsApiConfiguration.update(properties);
    _soapConfiguration=configurationAdmin.createFactoryConfiguration("com.liferay.portal.soap.extender.configuration." + "SoapExtenderConfiguration",null);
    properties=new Hashtable<>();
    properties.put("contextPaths",new String[]{"/soap-test"});
    properties.put("jaxWsHandlerFilterStrings",new String[]{"(soap.address=*)"});
    properties.put("jaxWsServiceFilterStrings",new String[]{"(jaxws=true)"});
    _soapConfiguration.update(properties);
    _filterString="(&(objectClass=" + ServletContextHelper.class.getName() + ")("+ HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_NAME+ "=soap-test))";
    if (!WaiterUtil.waitForFilter(bundleContext,_filterString,10000)) {
      _cleanUp();
      throw new TimeoutException("Service register waiting timeout");
    }
  }
  finally {
    bundleContext.ungetService(serviceReference);
  }
}
