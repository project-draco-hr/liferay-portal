{
  boolean exportPortletData=MapUtil.getBoolean(parameterMap,PortletDataHandlerKeys.PORTLET_DATA);
  boolean exportPortletDataAll=MapUtil.getBoolean(parameterMap,PortletDataHandlerKeys.PORTLET_DATA_ALL);
  if (_log.isDebugEnabled()) {
    _log.debug("Export portlet data " + exportPortletData);
    _log.debug("Export all portlet data " + exportPortletDataAll);
  }
  if (!exportPortletData) {
    return false;
  }
  PortletDataHandler portletDataHandler=_portletDataHandlerProvider.provide(companyId,portletId);
  if (portletDataHandler == null) {
    return false;
  }
  if (exportPortletDataAll || !portletDataHandler.isDataSiteLevel()) {
    return true;
  }
  return MapUtil.getBoolean(parameterMap,PortletDataHandlerKeys.PORTLET_DATA + StringPool.UNDERLINE + PortletConstants.getRootPortletId(portletId));
}
