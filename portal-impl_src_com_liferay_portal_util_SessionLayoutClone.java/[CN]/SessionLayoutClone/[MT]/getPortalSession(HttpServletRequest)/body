{
  HttpServletRequest originalRequest=request;
  while (originalRequest instanceof HttpServletRequestWrapper) {
    if (originalRequest instanceof SharedSessionServletRequest) {
      SharedSessionServletRequest sharedSessionServletRequest=(SharedSessionServletRequest)originalRequest;
      return sharedSessionServletRequest.getSharedSession();
    }
    originalRequest=(HttpServletRequest)((HttpServletRequestWrapper)originalRequest).getRequest();
  }
  return request.getSession();
}
