{
  return new ServiceReferenceMapper<K,S>(){
    @Override public void map(    ServiceReference<S> serviceReference,    Emitter<K> emitter){
      com.liferay.registry.collections.ServiceReferenceMapperFactory.create(new ServiceMapper<K,S>(){
        @Override public void map(        S service,        Emitter<K> emitter){
          emitter.emit(function.apply(service));
        }
      }
);
    }
  }
;
}
