{
  virtualHostname=StringUtil.toLowerCase(virtualHostname.trim());
  if (!active) {
    if (companyId == PortalInstances.getDefaultCompanyId()) {
      active=true;
    }
  }
  Company company=companyPersistence.findByPrimaryKey(companyId);
  validateVirtualHost(company.getWebId(),virtualHostname);
  if (PropsValues.MAIL_MX_UPDATE) {
    validateMx(mx);
    company.setMx(mx);
  }
  company.setMaxUsers(maxUsers);
  company.setActive(active);
  companyPersistence.update(company);
  updateVirtualHostname(companyId,virtualHostname);
  return company;
}
