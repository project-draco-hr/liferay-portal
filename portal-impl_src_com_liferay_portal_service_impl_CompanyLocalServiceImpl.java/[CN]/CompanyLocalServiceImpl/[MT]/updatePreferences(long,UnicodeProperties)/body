{
  PortletPreferences preferences=PrefsPropsUtil.getPreferences(companyId);
  try {
    if (properties.containsKey(PropsKeys.LOCALES)) {
      String oldLocales=preferences.getValue(PropsKeys.LOCALES,StringPool.BLANK);
      String newLocales=properties.getProperty(PropsKeys.LOCALES);
      if (!Validator.equals(oldLocales,newLocales)) {
        LanguageUtil.resetAvailableLocales(companyId);
      }
    }
    List<String> deleteKeysList=new ArrayList<String>();
    for (    Map.Entry<String,String> entry : properties.entrySet()) {
      String key=entry.getKey();
      String prefsValue=preferences.getValue(key,null);
      String propsValue=PropsUtil.get(key);
      String value=entry.getValue();
      if (value.equals(Portal.TEMP_OBFUSCATION_VALUE)) {
        continue;
      }
      if (!Validator.equals(value,propsValue)) {
        preferences.setValue(key,value);
      }
 else       if (prefsValue != null) {
        deleteKeysList.add(key);
      }
    }
    preferences.store();
    if (deleteKeysList.size() > 0) {
      String[] deleteKeys=StringUtil.split(StringUtil.merge(deleteKeysList),StringPool.COMMA);
      removePreferences(companyId,deleteKeys);
    }
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
}
