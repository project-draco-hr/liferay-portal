{
  virtualHost=getVirtualHost(virtualHost);
  Date now=new Date();
  Company company=companyPersistence.findByPrimaryKey(companyId);
  validate(company.getWebId(),virtualHost,mx);
  validate(name);
  company.setVirtualHost(virtualHost);
  if (GetterUtil.getBoolean(PropsUtil.get(PropsUtil.MAIL_MX_UPDATE))) {
    company.setMx(mx);
  }
  companyPersistence.update(company);
  Account account=null;
  try {
    account=accountPersistence.findByPrimaryKey(company.getAccountId());
  }
 catch (  NoSuchAccountException nsae) {
    long accountId=counterLocalService.increment();
    account=accountPersistence.create(accountId);
    account.setCreateDate(now);
    account.setCompanyId(companyId);
    account.setUserId(0);
    account.setUserName(StringPool.BLANK);
    company.setAccountId(accountId);
    companyPersistence.update(company);
  }
  account.setModifiedDate(now);
  account.setName(name);
  account.setLegalName(legalName);
  account.setLegalId(legalId);
  account.setLegalType(legalType);
  account.setSicCode(sicCode);
  account.setTickerSymbol(tickerSymbol);
  account.setIndustry(industry);
  account.setType(type);
  account.setSize(size);
  accountPersistence.update(account);
  return company;
}
