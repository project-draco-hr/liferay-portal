{
  long[] companyIds=PortalInstances.getCompanyIds();
  long companyId=0;
  if (companyIds.length == 1) {
    companyId=companyIds[0];
  }
 else   if (companyIds.length > 1) {
    try {
      User user=userLocalService.getUserById(userId);
      companyId=user.getCompanyId();
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to set the company id for user " + userId,e);
      }
    }
  }
  return companyId;
}
