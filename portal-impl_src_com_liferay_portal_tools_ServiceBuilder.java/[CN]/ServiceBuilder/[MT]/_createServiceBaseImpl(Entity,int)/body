{
  List referenceList=_mergeReferenceList(entity.getReferenceList());
  StringMaker sm=new StringMaker();
  sm.append("package " + _packagePath + ".service.base;");
  sm.append("import " + _packagePath + ".service."+ entity.getName()+ _getSessionTypeName(sessionType)+ "Service;");
  if (sessionType == _REMOTE) {
    sm.append("import " + _principalBeanPackage + ".PrincipalBean;");
  }
  if (entity.hasColumns()) {
    sm.append("import " + _packagePath + ".service.persistence."+ entity.getName()+ "Util;");
    sm.append("import com.liferay.portal.SystemException;");
    sm.append("import com.liferay.portal.kernel.dao.DynamicQueryInitializer;");
    sm.append("import java.util.List;");
  }
  for (int i=0; i < referenceList.size(); i++) {
    Entity tempEntity=(Entity)referenceList.get(i);
    if (entity.equals(tempEntity)) {
      if ((sessionType == _REMOTE) && tempEntity.hasLocalService()) {
        sm.append("import " + tempEntity.getPackagePath() + ".service."+ tempEntity.getName()+ "LocalService;");
        sm.append("import " + tempEntity.getPackagePath() + ".service."+ tempEntity.getName()+ "LocalServiceFactory;");
      }
    }
 else {
      if (tempEntity.hasLocalService()) {
        sm.append("import " + tempEntity.getPackagePath() + ".service."+ tempEntity.getName()+ "LocalService;");
        sm.append("import " + tempEntity.getPackagePath() + ".service."+ tempEntity.getName()+ "LocalServiceFactory;");
      }
      if (tempEntity.hasRemoteService()) {
        sm.append("import " + tempEntity.getPackagePath() + ".service."+ tempEntity.getName()+ "Service;");
        sm.append("import " + tempEntity.getPackagePath() + ".service."+ tempEntity.getName()+ "ServiceFactory;");
      }
    }
    if (tempEntity.hasColumns()) {
      sm.append("import " + tempEntity.getPackagePath() + ".service.persistence."+ tempEntity.getName()+ "Persistence;");
      sm.append("import " + tempEntity.getPackagePath() + ".service.persistence."+ tempEntity.getName()+ "Util;");
      if (tempEntity.hasFinderClass()) {
        sm.append("import " + tempEntity.getPackagePath() + ".service.persistence."+ tempEntity.getName()+ "Finder;");
        sm.append("import " + tempEntity.getPackagePath() + ".service.persistence."+ tempEntity.getName()+ "FinderUtil;");
      }
    }
  }
  sm.append("import org.springframework.beans.factory.InitializingBean;");
  if (sessionType == _REMOTE) {
    sm.append("public abstract class " + entity.getName() + "ServiceBaseImpl extends PrincipalBean implements "+ entity.getName()+ "Service, InitializingBean {");
  }
 else {
    sm.append("public abstract class " + entity.getName() + "LocalServiceBaseImpl implements "+ entity.getName()+ "LocalService, InitializingBean {");
  }
  if ((sessionType == _LOCAL) && entity.hasColumns()) {
    sm.append("public List dynamicQuery(DynamicQueryInitializer queryInitializer) throws SystemException {");
    sm.append("return " + entity.getName() + "Util.findWithDynamicQuery(queryInitializer);");
    sm.append("}");
    sm.append("public List dynamicQuery(DynamicQueryInitializer queryInitializer, int begin, int end) throws SystemException {");
    sm.append("return " + entity.getName() + "Util.findWithDynamicQuery(queryInitializer, begin, end);");
    sm.append("}");
  }
  for (int i=0; i < referenceList.size(); i++) {
    Entity tempEntity=(Entity)referenceList.get(i);
    if (entity.equals(tempEntity)) {
      if ((sessionType == _REMOTE) && tempEntity.hasLocalService()) {
        sm.append("public " + tempEntity.getName() + "LocalService get"+ tempEntity.getName()+ "LocalService() {");
        sm.append("return " + tempEntity.getVarName() + "LocalService;");
        sm.append("}");
        sm.append("public void set" + tempEntity.getName() + "LocalService("+ tempEntity.getName()+ "LocalService "+ tempEntity.getVarName()+ "LocalService) {");
        sm.append("this." + tempEntity.getVarName() + "LocalService = "+ tempEntity.getVarName()+ "LocalService;");
        sm.append("}");
      }
    }
 else {
      if (tempEntity.hasLocalService()) {
        sm.append("public " + tempEntity.getName() + "LocalService get"+ tempEntity.getName()+ "LocalService() {");
        sm.append("return " + tempEntity.getVarName() + "LocalService;");
        sm.append("}");
        sm.append("public void set" + tempEntity.getName() + "LocalService("+ tempEntity.getName()+ "LocalService "+ tempEntity.getVarName()+ "LocalService) {");
        sm.append("this." + tempEntity.getVarName() + "LocalService = "+ tempEntity.getVarName()+ "LocalService;");
        sm.append("}");
      }
      if (tempEntity.hasRemoteService()) {
        sm.append("public " + tempEntity.getName() + "Service get"+ tempEntity.getName()+ "Service() {");
        sm.append("return " + tempEntity.getVarName() + "Service;");
        sm.append("}");
        sm.append("public void set" + tempEntity.getName() + "Service("+ tempEntity.getName()+ "Service "+ tempEntity.getVarName()+ "Service) {");
        sm.append("this." + tempEntity.getVarName() + "Service = "+ tempEntity.getVarName()+ "Service;");
        sm.append("}");
      }
    }
    if (tempEntity.hasColumns()) {
      sm.append("public " + tempEntity.getName() + "Persistence get"+ tempEntity.getName()+ "Persistence() {");
      sm.append("return " + tempEntity.getVarName() + "Persistence;");
      sm.append("}");
      sm.append("public void set" + tempEntity.getName() + "Persistence("+ tempEntity.getName()+ "Persistence "+ tempEntity.getVarName()+ "Persistence) {");
      sm.append("this." + tempEntity.getVarName() + "Persistence = "+ tempEntity.getVarName()+ "Persistence;");
      sm.append("}");
      if (tempEntity.hasFinderClass()) {
        sm.append("public " + tempEntity.getName() + "Finder get"+ tempEntity.getName()+ "Finder() {");
        sm.append("return " + tempEntity.getVarName() + "Finder;");
        sm.append("}");
        sm.append("public void set" + tempEntity.getName() + "Finder("+ tempEntity.getName()+ "Finder "+ tempEntity.getVarName()+ "Finder) {");
        sm.append("this." + tempEntity.getVarName() + "Finder = "+ tempEntity.getVarName()+ "Finder;");
        sm.append("}");
      }
    }
  }
  sm.append("public void afterPropertiesSet() {");
  for (int i=0; i < referenceList.size(); i++) {
    Entity tempEntity=(Entity)referenceList.get(i);
    if (entity.equals(tempEntity)) {
      if ((sessionType == _REMOTE) && tempEntity.hasLocalService()) {
        sm.append("if (" + tempEntity.getVarName() + "LocalService == null) {");
        sm.append(tempEntity.getVarName() + "LocalService = " + tempEntity.getName()+ "LocalServiceFactory.getImpl();");
        sm.append("}");
      }
    }
 else {
      if (tempEntity.hasLocalService()) {
        sm.append("if (" + tempEntity.getVarName() + "LocalService == null) {");
        sm.append(tempEntity.getVarName() + "LocalService = " + tempEntity.getName()+ "LocalServiceFactory.getImpl();");
        sm.append("}");
      }
      if (tempEntity.hasRemoteService()) {
        sm.append("if (" + tempEntity.getVarName() + "Service == null) {");
        sm.append(tempEntity.getVarName() + "Service = " + tempEntity.getName()+ "ServiceFactory.getImpl();");
        sm.append("}");
      }
    }
    if (tempEntity.hasColumns()) {
      sm.append("if (" + tempEntity.getVarName() + "Persistence == null) {");
      sm.append(tempEntity.getVarName() + "Persistence = " + tempEntity.getName()+ "Util.getPersistence();");
      sm.append("}");
      if (tempEntity.hasFinderClass()) {
        sm.append("if (" + tempEntity.getVarName() + "Finder == null) {");
        sm.append(tempEntity.getVarName() + "Finder = " + tempEntity.getName()+ "FinderUtil.getFinder();");
        sm.append("}");
      }
    }
  }
  sm.append("}");
  for (int i=0; i < referenceList.size(); i++) {
    Entity tempEntity=(Entity)referenceList.get(i);
    if (entity.equals(tempEntity)) {
      if ((sessionType == _REMOTE) && tempEntity.hasLocalService()) {
        sm.append("protected " + tempEntity.getName() + "LocalService "+ tempEntity.getVarName()+ "LocalService;");
      }
    }
 else {
      if (tempEntity.hasLocalService()) {
        sm.append("protected " + tempEntity.getName() + "LocalService "+ tempEntity.getVarName()+ "LocalService;");
      }
      if (tempEntity.hasRemoteService()) {
        sm.append("protected " + tempEntity.getName() + "Service "+ tempEntity.getVarName()+ "Service;");
      }
    }
    if (tempEntity.hasColumns()) {
      sm.append("protected " + tempEntity.getName() + "Persistence "+ tempEntity.getVarName()+ "Persistence;");
      if (tempEntity.hasFinderClass()) {
        sm.append("protected " + tempEntity.getName() + "Finder "+ tempEntity.getVarName()+ "Finder;");
      }
    }
  }
  sm.append("}");
  File ejbFile=new File(_outputPath + "/service/base/" + entity.getName()+ _getSessionTypeName(sessionType)+ "ServiceBaseImpl.java");
  writeFile(ejbFile,sm.toString());
}
