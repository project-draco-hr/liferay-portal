{
  ThemeDisplay themeDisplay=(ThemeDisplay)_request.getAttribute(WebKeys.THEME_DISPLAY);
  GroupSearch groupSearch=new GroupSearch(_liferayPortletRequest,getPortletURL());
  GroupSearchTerms searchTerms=(GroupSearchTerms)groupSearch.getSearchTerms();
  long parentGroupId=getParentGroupId();
  Company company=themeDisplay.getCompany();
  List results=null;
  if (!searchTerms.hasSearchTerms() && isFilterManageableGroups() && (parentGroupId <= 0)) {
    int total=getAllGroups().size();
    groupSearch.setTotal(total);
    results=ListUtil.subList(getAllGroups(),groupSearch.getStart(),groupSearch.getEnd());
  }
 else   if (searchTerms.hasSearchTerms()) {
    int total=GroupLocalServiceUtil.searchCount(company.getCompanyId(),_classNameIds,searchTerms.getKeywords(),getGroupParams(themeDisplay,searchTerms,parentGroupId));
    groupSearch.setTotal(total);
    results=GroupLocalServiceUtil.search(company.getCompanyId(),_classNameIds,searchTerms.getKeywords(),getGroupParams(themeDisplay,searchTerms,parentGroupId),groupSearch.getStart(),groupSearch.getEnd(),groupSearch.getOrderByComparator());
  }
 else {
    int total=GroupLocalServiceUtil.searchCount(company.getCompanyId(),_classNameIds,getGroupId(),searchTerms.getKeywords(),getGroupParams(themeDisplay,searchTerms,parentGroupId));
    groupSearch.setTotal(total);
    results=GroupLocalServiceUtil.search(company.getCompanyId(),_classNameIds,getGroupId(),searchTerms.getKeywords(),getGroupParams(themeDisplay,searchTerms,parentGroupId),groupSearch.getStart(),groupSearch.getEnd(),groupSearch.getOrderByComparator());
  }
  groupSearch.setResults(results);
  return groupSearch;
}
