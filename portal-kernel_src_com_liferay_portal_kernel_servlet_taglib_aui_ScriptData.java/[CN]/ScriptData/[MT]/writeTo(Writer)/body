{
  writer.write("<script type=\"text/javascript\">\n// <![CDATA[\n");
  StringBundler auiModulesSB=new StringBundler(_portletDataMap.size());
  Set<String> auiModulesSet=new HashSet<>();
  StringBundler es6ModulesSB=new StringBundler(_portletDataMap.size());
  Set<String> es6ModulesSet=new HashSet<>();
  for (  PortletData portletData : _portletDataMap.values()) {
    portletData._rawSB.writeTo(writer);
    if (!portletData._auiModulesSet.isEmpty()) {
      auiModulesSB.append(portletData._auiCallbackSB);
    }
    if (!portletData._es6ModulesSet.isEmpty()) {
      es6ModulesSB.append(portletData._es6CallbackSB);
    }
    auiModulesSet.addAll(portletData._auiModulesSet);
    es6ModulesSet.addAll(portletData._es6ModulesSet);
  }
  if ((auiModulesSB.index() == 0) && (es6ModulesSB.index() == 0)) {
    writer.write("\n// ]]>\n</script>");
    return;
  }
  if (!es6ModulesSet.isEmpty()) {
    writer.write("require(");
    Iterator<String> iterator=es6ModulesSet.iterator();
    while (iterator.hasNext()) {
      writer.write(StringPool.APOSTROPHE);
      writer.write(iterator.next());
      writer.write(StringPool.APOSTROPHE);
      if (iterator.hasNext()) {
        writer.write(StringPool.COMMA_AND_SPACE);
      }
    }
    writer.write(StringPool.COMMA_AND_SPACE);
    writer.write("function(");
    iterator=es6ModulesSet.iterator();
    Set<String> variableNames=new HashSet<>(es6ModulesSet.size());
    while (iterator.hasNext()) {
      writer.write(_generateVariable(iterator.next(),variableNames));
      if (iterator.hasNext()) {
        writer.write(StringPool.COMMA_AND_SPACE);
      }
    }
    writer.write(") {\n");
    es6ModulesSB.writeTo(writer);
    writer.write("},\nfunction(error) {\nconsole.error(error);\n});");
  }
  if (!auiModulesSet.isEmpty()) {
    writer.write("AUI().use(");
    for (    String use : auiModulesSet) {
      writer.write(StringPool.APOSTROPHE);
      writer.write(use);
      writer.write(StringPool.APOSTROPHE);
      writer.write(StringPool.COMMA_AND_SPACE);
    }
    writer.write("function(A) {");
    auiModulesSB.writeTo(writer);
    writer.write("});");
  }
  writer.write("\n// ]]>\n</script>");
}
