{
  try {
    JCRFactoryUtil.prepare();
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  try {
    TemplateManagerUtil.init();
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  PortalRegisterTestUtil.registerIndexers();
  try {
    DBUpgrader.upgrade();
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  MessageBus messageBus=(MessageBus)PortalBeanLocatorUtil.locate(MessageBus.class.getName());
  MessageSender messageSender=(MessageSender)PortalBeanLocatorUtil.locate(MessageSender.class.getName());
  SynchronousMessageSender synchronousMessageSender=(SynchronousMessageSender)PortalBeanLocatorUtil.locate(SynchronousMessageSender.class.getName());
  MessageBusUtil.init(DoPrivilegedUtil.wrap(messageBus),DoPrivilegedUtil.wrap(messageSender),DoPrivilegedUtil.wrap(synchronousMessageSender));
  if (TestPropsValues.DL_FILE_ENTRY_PROCESSORS_TRIGGER_SYNCHRONOUSLY) {
    _replaceWithSynchronousDestination(DestinationNames.DOCUMENT_LIBRARY_AUDIO_PROCESSOR);
    _replaceWithSynchronousDestination(DestinationNames.DOCUMENT_LIBRARY_IMAGE_PROCESSOR);
    _replaceWithSynchronousDestination(DestinationNames.DOCUMENT_LIBRARY_PDF_PROCESSOR);
    _replaceWithSynchronousDestination(DestinationNames.DOCUMENT_LIBRARY_RAW_METADATA_PROCESSOR);
    _replaceWithSynchronousDestination(DestinationNames.DOCUMENT_LIBRARY_VIDEO_PROCESSOR);
  }
  try {
    SchedulerEngineHelperUtil.start();
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  try {
    DBUpgrader.verify();
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  _checkClassNames();
  try {
    _checkResourceActions();
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  PortalRegisterTestUtil.registerTrashHandlers();
  PortalRegisterTestUtil.registerWorkflowHandlers();
  PortalRegisterTestUtil.registerAssetRendererFactories();
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setPortalURL("http://tests:8080");
  serviceContext.setPathMain("path");
  ServiceContextThreadLocal.pushServiceContext(serviceContext);
  LocaleThreadLocal.setThemeDisplayLocale(new Locale("en","US"));
  try {
    CompanyLocalServiceUtil.checkCompany(TestPropsValues.COMPANY_WEB_ID);
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  _deleteDirectories();
  try {
    FileUtil.mkdirs(PropsValues.LUCENE_DIR + TestPropsValues.getCompanyId());
    SearchEngineUtil.initialize(TestPropsValues.getCompanyId());
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
