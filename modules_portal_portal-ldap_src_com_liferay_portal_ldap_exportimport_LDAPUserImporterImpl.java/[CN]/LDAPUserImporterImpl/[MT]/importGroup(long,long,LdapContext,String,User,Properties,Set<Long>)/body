{
  String userGroupIdKey=null;
  Long userGroupId=null;
  LDAPConfiguration ldapCompanyServiceSettings=LDAPConfigurationSettingsUtil.getLDAPConfiguration(companyId);
  if (ldapCompanyServiceSettings.importGroupCacheEnabled()) {
    StringBundler sb=new StringBundler(5);
    sb.append(ldapServerId);
    sb.append(StringPool.UNDERLINE);
    sb.append(companyId);
    sb.append(StringPool.UNDERLINE);
    sb.append(fullGroupDN);
    userGroupIdKey=sb.toString();
    userGroupId=_portalCache.get(userGroupIdKey);
  }
  if (userGroupId != null) {
    if (_log.isDebugEnabled()) {
      _log.debug("Skipping reimport of full group DN " + fullGroupDN);
    }
  }
 else {
    if (_log.isDebugEnabled()) {
      _log.debug("Importing full group DN " + fullGroupDN);
    }
    Attributes groupAttributes=null;
    try {
      groupAttributes=PortalLDAPUtil.getGroupAttributes(ldapServerId,companyId,ldapContext,fullGroupDN);
    }
 catch (    NameNotFoundException nnfe) {
      _log.error("LDAP group not found with full group DN " + fullGroupDN,nnfe);
    }
    UserGroup userGroup=importUserGroup(companyId,groupAttributes,groupMappings);
    if (userGroup == null) {
      return newUserGroupIds;
    }
    userGroupId=userGroup.getUserGroupId();
    if (ldapCompanyServiceSettings.importGroupCacheEnabled()) {
      _portalCache.put(userGroupIdKey,userGroupId);
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Adding " + user.getUserId() + " to group "+ userGroupId);
  }
  newUserGroupIds.add(userGroupId);
  return newUserGroupIds;
}
