{
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  if (!cmd.equals(Constants.UPDATE)) {
    return;
  }
  UnicodeProperties properties=PropertiesParamUtil.getProperties(actionRequest,PREFERENCES_PREFIX);
  String portletResource=ParamUtil.getString(actionRequest,"portletResource");
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getPortletSetup(actionRequest,portletResource);
  for (  Map.Entry<String,String> entry : properties.entrySet()) {
    String key=entry.getKey();
    String value=entry.getValue();
    preferences.setValue(key,value);
  }
  Map<String,String[]> processedPreferences=(Map<String,String[]>)actionRequest.getAttribute(WebKeys.PROCESSED_PREFERENCES);
  if (processedPreferences != null) {
    for (    Map.Entry<String,String[]> entry : processedPreferences.entrySet()) {
      String key=entry.getKey();
      String[] values=entry.getValue();
      preferences.setValues(key,values);
    }
  }
  if (SessionErrors.isEmpty(actionRequest)) {
    preferences.store();
    SessionMessages.add(actionRequest,portletConfig.getPortletName() + ".doConfigure");
  }
}
