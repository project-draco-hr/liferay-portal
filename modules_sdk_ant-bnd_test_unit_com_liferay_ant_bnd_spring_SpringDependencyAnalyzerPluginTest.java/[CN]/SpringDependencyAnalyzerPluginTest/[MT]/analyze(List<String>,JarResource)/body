{
  JavaArchive javaArchive=ShrinkWrap.create(JavaArchive.class);
  for (  String pkg : packages) {
    javaArchive.addPackages(true,pkg);
  }
  for (  JarResource jarResource : jarResources) {
    javaArchive.addAsResource(jarResource.getURL(),jarResource.getTarget());
  }
  Analyzer analyzer=new Analyzer();
  analyzer.setBundleSymbolicName("test.bundle");
  analyzer.setBundleVersion("1.0.0");
  analyzer.setProperty("Require-SchemaVersion","1.0.0.1");
  analyzer.setProperty("-spring-dependency",ServiceReference.class.getName());
  ZipExporter zipExporter=javaArchive.as(ZipExporter.class);
  Jar jar=new Jar("Spring Context Dependency Test",zipExporter.exportAsInputStream());
  analyzer.setJar(jar);
  analyzer.analyze();
  SpringDependencyAnalyzerPlugin springDependencyAnalyzerPlugin=new SpringDependencyAnalyzerPlugin();
  springDependencyAnalyzerPlugin.analyzeJar(analyzer);
  return jar;
}
