{
  Assert.assertNotNull(properties);
  properties.put("javax.portlet.name",portletName);
  Bundle bundle=FrameworkUtil.getBundle(getClass());
  BundleContext bundleContext=bundle.getBundleContext();
  serviceRegistration=bundleContext.registerService(new String[]{Object.class.getName(),Portlet.class.getName()},portlet,properties);
  serviceRegistrations.add(serviceRegistration);
  if (addToLayout) {
    LayoutTestUtil.addPortletToLayout(TestPropsValues.getUserId(),layout,portletName,"column-1",new HashMap<String,String[]>());
  }
}
