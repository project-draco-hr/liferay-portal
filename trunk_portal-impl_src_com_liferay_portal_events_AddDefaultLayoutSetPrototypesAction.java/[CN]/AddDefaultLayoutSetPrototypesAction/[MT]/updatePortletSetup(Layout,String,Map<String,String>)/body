{
  PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portletId);
  Iterator<Map.Entry<String,String>> itr=preferences.entrySet().iterator();
  while (itr.hasNext()) {
    Map.Entry<String,String> entry=itr.next();
    String key=entry.getKey();
    String value=entry.getValue();
    portletSetup.setValue(key,value);
  }
  portletSetup.store();
  return portletSetup;
}
