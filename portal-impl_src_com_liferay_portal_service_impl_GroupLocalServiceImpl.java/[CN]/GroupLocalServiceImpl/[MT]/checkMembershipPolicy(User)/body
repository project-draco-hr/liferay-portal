{
  MembershipPolicy membershipPolicy=MembershipPolicyFactory.getInstance();
  if (!membershipPolicy.isApplicableUser(user)) {
    return;
  }
  LinkedHashMap<String,Object> groupParams=new LinkedHashMap<String,Object>();
  groupParams.put("inherit",Boolean.FALSE);
  groupParams.put("site",Boolean.TRUE);
  groupParams.put("usersGroups",user.getUserId());
  List<Group> groups=search(user.getCompanyId(),groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  for (  Group group : groups) {
    if (!membershipPolicy.isMembershipAllowed(group,user)) {
      unsetUserGroups(user.getUserId(),new long[]{group.getGroupId()});
    }
  }
  List<Group> mandatoryGroups=membershipPolicy.getMandatoryGroups(user);
  for (  Group group : mandatoryGroups) {
    if (!hasUserGroup(user.getUserId(),group.getGroupId(),false)) {
      addUserGroups(user.getUserId(),new long[]{group.getGroupId()});
    }
  }
}
