{
  String companyIdHexString=StringUtil.toHexString(companyId);
  for (  Group group : groupFinder.findBySystem(companyId)) {
    _systemGroupsMap.put(companyIdHexString.concat(group.getName()),group);
  }
  long defaultUserId=userLocalService.getDefaultUserId(companyId);
  String[] systemGroups=PortalUtil.getSystemGroups();
  for (  String name : systemGroups) {
    String groupCacheKey=companyIdHexString.concat(name);
    Group group=_systemGroupsMap.get(groupCacheKey);
    if (group == null) {
      group=groupPersistence.fetchByC_N(companyId,name);
    }
    if (group == null) {
      String className=null;
      long classPK=0;
      int type=GroupConstants.TYPE_SITE_OPEN;
      String friendlyURL=null;
      boolean site=true;
      if (name.equals(GroupConstants.CONTROL_PANEL)) {
        type=GroupConstants.TYPE_SITE_PRIVATE;
        friendlyURL=GroupConstants.CONTROL_PANEL_FRIENDLY_URL;
        site=false;
      }
 else       if (name.equals(GroupConstants.GUEST)) {
        friendlyURL="/guest";
      }
 else       if (name.equals(GroupConstants.USER_PERSONAL_SITE)) {
        className=UserPersonalSite.class.getName();
        classPK=defaultUserId;
        type=GroupConstants.TYPE_SITE_PRIVATE;
        friendlyURL=GroupConstants.USER_PERSONAL_SITE_FRIENDLY_URL;
        site=false;
      }
      group=groupLocalService.addGroup(defaultUserId,GroupConstants.DEFAULT_PARENT_GROUP_ID,className,classPK,name,null,type,friendlyURL,site,true,null);
      if (name.equals(GroupConstants.USER_PERSONAL_SITE)) {
        initUserPersonalSitePermissions(group);
      }
    }
    if (group.isControlPanel()) {
      LayoutSet layoutSet=layoutSetLocalService.getLayoutSet(group.getGroupId(),true);
      if (layoutSet.getPageCount() == 0) {
        addControlPanelLayouts(group);
      }
    }
    if (group.getName().equals(GroupConstants.GUEST)) {
      LayoutSet layoutSet=layoutSetLocalService.getLayoutSet(group.getGroupId(),false);
      if (layoutSet.getPageCount() == 0) {
        addDefaultGuestPublicLayouts(group);
      }
    }
    _systemGroupsMap.put(groupCacheKey,group);
  }
}
