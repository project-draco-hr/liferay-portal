{
  for (  Group group : groupFinder.findBySystem()) {
    _systemGroupsMap.put(companyId + group.getName(),group);
  }
  long defaultUserId=userLocalService.getDefaultUserId(companyId);
  String[] systemGroups=PortalUtil.getSystemGroups();
  for (  String name : systemGroups) {
    Group group=_systemGroupsMap.get(companyId + name);
    try {
      if (group == null) {
        group=groupFinder.findByC_N(companyId,name);
      }
    }
 catch (    NoSuchGroupException nsge) {
      int type=GroupConstants.TYPE_COMMUNITY_OPEN;
      String friendlyURL=null;
      if (name.equals(GroupConstants.CONTROL_PANEL)) {
        type=GroupConstants.TYPE_COMMUNITY_PRIVATE;
        friendlyURL="/control_panel";
      }
 else       if (name.equals(GroupConstants.GUEST)) {
        friendlyURL="/guest";
      }
      group=groupLocalService.addGroup(defaultUserId,null,0,name,null,type,friendlyURL,true);
    }
    if (group.getName().equals(GroupConstants.CONTROL_PANEL)) {
      LayoutSet layoutSet=layoutSetLocalService.getLayoutSet(group.getGroupId(),true);
      if (layoutSet.getPageCount() == 0) {
        addControlPanelLayouts(group);
      }
    }
    if (group.getName().equals(GroupConstants.GUEST)) {
      LayoutSet layoutSet=layoutSetLocalService.getLayoutSet(group.getGroupId(),false);
      if (layoutSet.getPageCount() == 0) {
        addDefaultGuestPublicLayouts(group);
      }
    }
    _systemGroupsMap.put(companyId + name,group);
  }
}
