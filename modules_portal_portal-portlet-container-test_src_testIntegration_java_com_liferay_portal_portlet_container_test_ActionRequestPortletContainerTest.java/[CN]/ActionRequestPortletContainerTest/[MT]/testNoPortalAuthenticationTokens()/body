{
  setUpPortlet(testPortlet,new HashMapDictionary<String,Object>(),TEST_PORTLET_ID);
  HttpServletRequest httpServletRequest=PortletContainerTestUtil.getHttpServletRequest(group,layout);
  PortletURL portletURL=new PortletURLImpl(httpServletRequest,TEST_PORTLET_ID,layout.getPlid(),PortletRequest.ACTION_PHASE);
  String url=portletURL.toString();
  try (CaptureAppender captureAppender=Log4JLoggerTestUtil.configureLog4JLogger(SecurityPortletContainerWrapper.class.getName(),Level.WARN)){
    Map<String,List<String>> responseMap=PortletContainerTestUtil.request(url);
    List<LoggingEvent> loggingEvents=captureAppender.getLoggingEvents();
    Assert.assertEquals(1,loggingEvents.size());
    LoggingEvent loggingEvent=loggingEvents.get(0);
    Assert.assertEquals("User 0 is not allowed to access URL " + url.substring(0,url.indexOf('?')) + " and portlet "+ TEST_PORTLET_ID,loggingEvent.getMessage());
    Assert.assertEquals("200",PortletContainerTestUtil.getString(responseMap,"code"));
    Assert.assertFalse(map.containsKey("processAction"));
  }
 }
