{
  if (Validator.equals(operationMode,_operationMode)) {
    return;
  }
  validate(operationMode);
  ElasticsearchConnection newElasticsearchConnection=_elasticsearchConnections.get(operationMode);
  newElasticsearchConnection.connect();
  if (_operationMode != null) {
    ElasticsearchConnection oldElasticsearchConnection=_elasticsearchConnections.get(_operationMode);
    try {
      oldElasticsearchConnection.close();
    }
 catch (    Exception e) {
      if (_log.isErrorEnabled()) {
        _log.error("Unable to close " + oldElasticsearchConnection,e);
      }
    }
  }
  _operationMode=operationMode;
  for (  Long companyId : _companyIds.values()) {
    try {
      indexFactory.createIndices(getAdminClient(),companyId);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Unable to reinitialize index for company " + companyId,e);
      }
    }
  }
}
