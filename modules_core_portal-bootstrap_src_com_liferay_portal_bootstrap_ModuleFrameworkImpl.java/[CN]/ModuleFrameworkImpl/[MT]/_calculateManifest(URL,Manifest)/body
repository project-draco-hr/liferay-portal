{
  Analyzer analyzer=new Analyzer();
  Jar jar=null;
  try {
    URLConnection urlConnection=url.openConnection();
    String fileName=url.getFile();
    if (urlConnection instanceof JarURLConnection) {
      JarURLConnection jarURLConnection=(JarURLConnection)urlConnection;
      URL jarFileURL=jarURLConnection.getJarFileURL();
      fileName=jarFileURL.getFile();
    }
    File file=new File(fileName);
    if (!file.exists() || !file.canRead()) {
      return manifest;
    }
    fileName=file.getName();
    analyzer.setJar(new Jar(fileName,file));
    jar=analyzer.getJar();
    String bundleSymbolicName=fileName;
    Matcher matcher=_bundleSymbolicNamePattern.matcher(bundleSymbolicName);
    if (matcher.matches()) {
      bundleSymbolicName=matcher.group(1);
    }
    analyzer.setProperty(Analyzer.BUNDLE_SYMBOLICNAME,bundleSymbolicName);
    String exportPackage=analyzer.calculateExportsFromContents(jar);
    analyzer.setProperty(Analyzer.EXPORT_PACKAGE,exportPackage);
    analyzer.mergeManifest(manifest);
    String bundleVersion=analyzer.getProperty(Analyzer.BUNDLE_VERSION);
    if (bundleVersion != null) {
      bundleVersion=Builder.cleanupVersion(bundleVersion);
      analyzer.setProperty(Analyzer.BUNDLE_VERSION,bundleVersion);
    }
    return analyzer.calcManifest();
  }
 catch (  Exception e) {
    _log.error(e,e);
    return manifest;
  }
 finally {
    if (jar != null) {
      jar.close();
    }
    analyzer.close();
  }
}
