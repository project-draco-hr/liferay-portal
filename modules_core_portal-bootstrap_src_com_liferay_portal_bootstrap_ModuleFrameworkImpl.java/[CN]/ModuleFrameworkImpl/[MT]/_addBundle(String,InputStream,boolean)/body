{
  if (_framework == null) {
    throw new IllegalStateException("Framework not initialized!");
  }
  if (checkPermission) {
    _checkPermission();
  }
  BundleContext bundleContext=_framework.getBundleContext();
  if (inputStream != null) {
    Bundle bundle=getBundle(bundleContext,inputStream);
    if (bundle != null) {
      return bundle;
    }
  }
  try {
    return bundleContext.installBundle(location,inputStream);
  }
 catch (  BundleException be) {
    _log.error(be,be);
    throw new PortalException(be);
  }
}
