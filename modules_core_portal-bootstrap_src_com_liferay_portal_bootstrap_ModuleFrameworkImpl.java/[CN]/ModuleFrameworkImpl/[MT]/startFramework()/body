{
  List<ServiceLoaderCondition> serviceLoaderConditions=ServiceLoader.load(ServiceLoaderCondition.class);
  ServiceLoaderCondition serviceLoaderCondition=serviceLoaderConditions.get(0);
  List<FrameworkFactory> frameworkFactories=ServiceLoader.load(FrameworkFactory.class,serviceLoaderCondition);
  FrameworkFactory frameworkFactory=frameworkFactories.get(0);
  Map<String,String> properties=_buildFrameworkProperties(frameworkFactory.getClass());
  _framework=frameworkFactory.newFramework(properties);
  _framework.init();
  _framework.start();
  RegistryUtil.setRegistry(new RegistryImpl(_framework.getBundleContext()));
  ServiceTrackerMapFactoryUtil.setServiceTrackerMapFactory(new ServiceTrackerMapFactoryImpl(_framework.getBundleContext()));
  _setUpPrerequisiteFrameworkServices(_framework.getBundleContext());
  _setUpInitialBundles();
}
