{
  UnsyncBufferedReader ubr=new UnsyncBufferedReader(new StringReader("abcdefghi"),5);
  assertEquals(-1,ubr.markIndex);
  int markLimit=3;
  ubr.mark(markLimit);
  assertEquals(markLimit,ubr.markLimit);
  assertEquals(0,ubr.markIndex);
  assertEquals('a',ubr.read());
  assertEquals('b',ubr.read());
  assertEquals('c',ubr.read());
  assertEquals(3,ubr.index);
  ubr.reset();
  assertEquals(0,ubr.markIndex);
  assertEquals('a',ubr.read());
  assertEquals('b',ubr.read());
  assertEquals('c',ubr.read());
  assertEquals(3,ubr.index);
  ubr=new UnsyncBufferedReader(new StringReader("abcdefghi"),5);
  assertEquals(-1,ubr.markIndex);
  ubr.mark(markLimit);
  assertEquals(markLimit,ubr.markLimit);
  assertEquals(0,ubr.markIndex);
  assertEquals('a',ubr.read());
  assertEquals('b',ubr.read());
  assertEquals('c',ubr.read());
  assertEquals('d',ubr.read());
  assertEquals('e',ubr.read());
  assertEquals('f',ubr.read());
  assertEquals(1,ubr.index);
  assertEquals(-1,ubr.markIndex);
  ubr=new UnsyncBufferedReader(new StringReader(new String(_BUFFER)),16);
  ubr.mark(8192);
  assertEquals(0,ubr.markIndex);
  for (int i=0; i < 4097; i++) {
    assertEquals(i % 16 + 'a',ubr.read());
  }
  assertEquals(8192,ubr.buffer.length);
  assertEquals(0,ubr.markIndex);
  assertEquals(4097,ubr.index);
  ubr.mark(8192);
  assertEquals(4097,ubr.markIndex);
  for (int i=4097; i < 8193; i++) {
    assertEquals(i % 16 + 'a',ubr.read());
  }
  assertEquals(0,ubr.markIndex);
}
