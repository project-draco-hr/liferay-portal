{
  if (_projectDirPropertyName == null) {
    throw new BuildException("Attribute projectDirPropertyName must be set");
  }
  Project project=getProject();
  project.setProperty("build.revision",getBuildRevision());
  project.setProperty("build.time",getDateString(new Date()));
  project.setProperty("release.info.build.date",String.valueOf(ReleaseInfo.getBuildDate()));
  project.setProperty("release.info.build.number",String.valueOf(ReleaseInfo.getBuildNumber()));
  project.setProperty("release.info.code.name",ReleaseInfo.getCodeName());
  project.setProperty("release.info.parent.build.number",String.valueOf(ReleaseInfo.getParentBuildNumber()));
  project.setProperty("release.info.release.info",ReleaseInfo.getReleaseInfo());
  project.setProperty("release.info.server.info",ReleaseInfo.getServerInfo());
  project.setProperty("release.info.vendor",ReleaseInfo.getVendor());
  String releaseInfoVersion=project.getProperty("release.info.version");
  if (Validator.isNull(releaseInfoVersion)) {
    project.setProperty("release.info.version",ReleaseInfo.getVersion());
  }
  if (!_analyze) {
    return;
  }
  Analyzer analyzer=new Analyzer();
  analyzer.setBase(project.getBaseDir());
  File classesDir=new File(project.getBaseDir(),"classes");
  analyzer.setJar(classesDir);
  File file=new File(project.getBaseDir(),"bnd.bnd");
  if (file.exists()) {
    analyzer.setProperties(file);
  }
 else {
    analyzer.setProperty(Constants.EXPORT_PACKAGE,"*");
    analyzer.setProperty(Constants.IMPORT_PACKAGE,"*;resolution:=optional");
  }
  Manifest manifest=analyzer.calcManifest();
  Attributes attributes=manifest.getMainAttributes();
  project.setProperty("export.packages",attributes.getValue(Constants.EXPORT_PACKAGE));
  project.setProperty("import.packages",attributes.getValue(Constants.IMPORT_PACKAGE));
  analyzer.close();
}
