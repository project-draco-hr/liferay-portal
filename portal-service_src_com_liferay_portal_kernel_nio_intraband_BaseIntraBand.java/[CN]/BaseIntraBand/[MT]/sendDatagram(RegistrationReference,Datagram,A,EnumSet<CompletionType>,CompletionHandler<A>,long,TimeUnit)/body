{
  if (registrationReference == null) {
    throw new NullPointerException("RegistrationReference is null");
  }
  if (!registrationReference.isValid()) {
    throw new IllegalArgumentException("RegistrationReference is not valid");
  }
  if (datagram == null) {
    throw new NullPointerException("Datagram is null");
  }
  if (completionTypes == null) {
    throw new NullPointerException("CompletionType set is null");
  }
  if (completionTypes.isEmpty()) {
    throw new IllegalArgumentException("CompletionType set is empty");
  }
  if (completionHandler == null) {
    throw new NullPointerException("CompleteHandler is null");
  }
  if (timeUnit == null) {
    throw new NullPointerException("TimeUnit is null");
  }
  if (timeout <= 0) {
    timeout=defaultTimeout;
  }
 else {
    timeout=timeUnit.toMillis(timeout);
  }
  ensureOpen();
  datagram.setAckRequest(completionTypes.contains(CompletionType.DELIVERED));
  datagram.attachment=attachment;
  datagram.completionHandler=(CompletionHandler<Object>)completionHandler;
  datagram.completionTypes=completionTypes;
  if (datagram.getSequenceId() == 0) {
    datagram.setSequenceId(generateSequenceId());
  }
  datagram.timeout=timeout;
  if (completionTypes.contains(CompletionType.DELIVERED) || completionTypes.contains(CompletionType.REPLIED)) {
    addResponseWaitingDatagram(datagram);
  }
  doSendDatagram(registrationReference,datagram);
}
