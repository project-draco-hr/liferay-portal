{
  RenderedImage renderedImage=null;
  String type=TYPE_NOT_AVAILABLE;
  Enumeration enu=ImageCodec.getCodecs();
  while (enu.hasMoreElements()) {
    ImageCodec codec=(ImageCodec)enu.nextElement();
    if (codec.isFormatRecognized(bytes)) {
      type=codec.getFormatName();
      ImageDecoder decoder=ImageCodec.createImageDecoder(type,new ByteArrayInputStream(bytes),null);
      try {
        renderedImage=decoder.decodeAsRenderedImage();
      }
 catch (      IOException ioe) {
        if (_log.isDebugEnabled()) {
          _log.debug(type + ": " + ioe.getMessage());
        }
      }
      break;
    }
  }
  if (type.equals("jpeg")) {
    type=ImageProcessor.TYPE_JPEG;
  }
  return new ImageBag(renderedImage,type);
}
