{
  BBCodeTag tag=new BBCodeTag();
  String begTag="[" + name;
  String endTag="[/" + name + "]";
  String preTag=StringUtil.extractFirst(bbcode,begTag);
  if (preTag == null) {
    return null;
  }
  if (preTag.length() != bbcode.length()) {
    tag.setStartPos(preTag.length());
    String remainder=bbcode.substring(preTag.length() + begTag.length());
    int cb=remainder.indexOf("]");
    int end=remainder.indexOf(endTag);
    if (cb > 0 && remainder.startsWith("=")) {
      tag.setParameter(remainder.substring(1,cb));
      tag.setElement(remainder.substring(cb + 1,end));
    }
 else     if (cb == 0) {
      tag.setElement(remainder.substring(1,end));
    }
  }
  if (tag.hasElement()) {
    int length=begTag.length() + 1 + tag.getElement().length()+ endTag.length();
    if (tag.hasParameter()) {
      length+=1 + tag.getParameter().length();
    }
    tag.setEndPos(tag.getStartPos() + length);
    return tag;
  }
  return null;
}
