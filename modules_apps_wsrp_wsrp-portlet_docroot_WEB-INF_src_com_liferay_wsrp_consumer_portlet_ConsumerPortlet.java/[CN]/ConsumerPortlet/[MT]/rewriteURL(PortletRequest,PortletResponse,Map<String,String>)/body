{
  LiferayPortletResponse liferayPortletResponse=(LiferayPortletResponse)portletResponse;
  String lifecycle=parameterMap.get("wsrp-urlType");
  LiferayPortletURL liferayPortletURL=null;
  if (lifecycle.equals("blockingAction")) {
    liferayPortletURL=(LiferayPortletURL)liferayPortletResponse.createActionURL();
  }
 else   if (lifecycle.equals("render")) {
    liferayPortletURL=(LiferayPortletURL)liferayPortletResponse.createRenderURL();
  }
 else   if (lifecycle.equals("resource")) {
    liferayPortletURL=(LiferayPortletURL)liferayPortletResponse.createResourceURL();
    if (PortletPropsValues.SECURE_RESOURCE_URLS_ENABLED) {
      secureResourceURL(portletRequest,liferayPortletURL,parameterMap);
    }
  }
  for (  Map.Entry<String,String> parameter : parameterMap.entrySet()) {
    String name=parameter.getKey();
    String value=parameter.getValue();
    if (name.equals("wsrp-mode")) {
      try {
        liferayPortletURL.setPortletMode(getPortletMode(value));
      }
 catch (      Exception e) {
        liferayPortletURL.setPortletMode(PortletMode.VIEW);
      }
    }
 else     if (name.equals("wsrp-navigationalState")) {
      if (Validator.isNotNull(value)) {
        byte[] valueBytes=value.getBytes(StringPool.UTF8);
        value=Base64.toURLSafe(Base64.encode(valueBytes));
        liferayPortletURL.setParameter(name,value);
      }
    }
 else     if (name.equals("wsrp-navigationalValues")) {
      Matcher navigationalValuesMatcher=_navigationalValuesPattern.matcher(value);
      while (navigationalValuesMatcher.find()) {
        String navigationalValuesName=navigationalValuesMatcher.group(1);
        String navigationalValuesValue=navigationalValuesMatcher.group(2);
        if (Validator.isNull(navigationalValuesValue)) {
          liferayPortletURL.removePublicRenderParameter(navigationalValuesName);
        }
 else {
          liferayPortletURL.setParameter(navigationalValuesName,navigationalValuesValue,true);
        }
      }
    }
 else     if (name.equals("wsrp-resourceID")) {
      liferayPortletURL.setResourceID(value);
    }
 else     if (name.equals("wsrp-urlType")) {
    }
 else     if (name.equals("wsrp-windowState")) {
      try {
        liferayPortletURL.setWindowState(getWindowState(value));
      }
 catch (      Exception e) {
        liferayPortletURL.setWindowState(WindowState.NORMAL);
      }
    }
 else {
      liferayPortletURL.setParameter(name,value);
    }
  }
  String url=liferayPortletURL.toString();
  return url;
}
