{
  String companyId=getUser().getCompanyId();
  if (!hasAdministrator(companyId)) {
    throw new PrincipalException();
  }
  PortletPK pk=new PortletPK(portletId,companyId);
  Portlet portlet=null;
  try {
    portlet=PortletUtil.findByPrimaryKey(pk);
  }
 catch (  NoSuchPortletException nspe) {
    portlet=PortletUtil.create(pk);
  }
  portlet.setNarrow(narrow);
  portlet.setRoles(roles);
  portlet.setActive(active);
  PortletUtil.update(portlet);
  portlet=getPortletById(companyId,portletId);
  portlet.setNarrow(narrow);
  portlet.setRoles(roles);
  portlet.setActive(active);
  return portlet;
}
