{
  PortletCategory portletCategory=new PortletCategory();
  if (xml == null) {
    return portletCategory;
  }
  SAXReader reader=new SAXReader(true);
  reader.setEntityResolver(new EntityResolver());
  Document doc=reader.read(new StringReader(xml));
  Element root=doc.getRootElement();
  Set portletIds=new HashSet();
  _readLiferayDisplay(servletContextName,root,portletCategory,portletIds);
  Set undefinedPortletIds=new HashSet();
  Iterator itr=_getPortletsPool().values().iterator();
  while (itr.hasNext()) {
    Portlet portlet=(Portlet)itr.next();
    String portletId=portlet.getPortletId();
    if ((servletContextName != null) && (portlet.isWARFile()) && (portletId.startsWith(servletContextName) && (!portletIds.contains(portletId)))) {
      undefinedPortletIds.add(portletId);
    }
 else     if ((servletContextName == null) && (!portlet.isWARFile()) && (!portletIds.contains(portletId))) {
      undefinedPortletIds.add(portletId);
    }
  }
  if (undefinedPortletIds.size() > 0) {
    PortletCategory undefinedCategory=new PortletCategory("category.undefined");
    portletCategory.addCategory(undefinedCategory);
    undefinedCategory.getPortlets().addAll(undefinedPortletIds);
  }
  return portletCategory;
}
