{
  long groupId=ParamUtil.getLong(portletRequest,"groupId",themeDisplay.getScopeGroupId());
  String articleId=portletRequest.getPreferences().getValue("articleId",null);
  int status=ParamUtil.getInteger(portletRequest,"status",WorkflowConstants.STATUS_ANY);
  JournalArticle article=null;
  DDMTemplate ddmTemplate=null;
  if (Validator.isNotNull(articleId)) {
    article=JournalArticleServiceUtil.getLatestArticle(groupId,articleId,status);
    ddmTemplate=article.getDDMTemplate();
    if (Validator.isNull(ddmTemplate)) {
      ddmTemplate=DDMTemplateLocalServiceUtil.fetchTemplate(groupId,PortalUtil.getClassNameId(DDMStructure.class),article.getDDMTemplateKey(),true);
    }
  }
  return ddmTemplate;
}
