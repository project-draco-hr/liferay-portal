{
  Map<String,String> tokens=getTokens();
  long groupId=GetterUtil.getLong(tokens.get("group_id"));
  for (  Element el : root.elements()) {
    Element dynamicContent=el.element("dynamic-content");
    if (dynamicContent != null) {
      String text=dynamicContent.getText();
      text=HtmlUtil.escape(text);
      text=HtmlUtil.stripComments(text);
      text=HtmlUtil.stripHtml(text);
      text=text.trim();
      if (Validator.isNotNull(text) && (text.length() >= 7) && text.startsWith("[@")&& text.endsWith("@]")) {
        text=text.substring(2,text.length() - 2);
        int pos=text.indexOf(";");
        if (pos != -1) {
          String articleId=text.substring(0,pos);
          String elementName=text.substring(pos + 1);
          JournalArticle article=JournalArticleLocalServiceUtil.getArticle(groupId,articleId);
          dynamicContent.clearContent();
          dynamicContent.addCDATA(getDynamicContent(article.getContent(),elementName));
        }
      }
 else       if ((text != null) && text.startsWith("/image/journal/article?img_id")) {
        dynamicContent.setText("@cdn_host@@root_path@" + text);
      }
 else {
        dynamicContent.setText(text);
      }
    }
    replace(el);
  }
}
