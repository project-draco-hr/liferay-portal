{
  OutputStream os=null;
  try {
    if (!resourceResponse.isCommitted()) {
      if (contentLength > 0) {
        resourceResponse.setContentLength(contentLength);
      }
      os=new BufferedOutputStream(resourceResponse.getPortletOutputStream());
      int c=is.read();
      while (c != -1) {
        os.write(c);
        c=is.read();
      }
    }
  }
  finally {
    ServletResponseUtil.cleanUp(os,is);
  }
}
