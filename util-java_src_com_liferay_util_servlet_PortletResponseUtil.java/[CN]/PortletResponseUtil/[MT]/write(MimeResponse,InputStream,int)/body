{
  OutputStream os=null;
  try {
    if (!mimeResponse.isCommitted()) {
      if (contentLength > 0) {
        if (mimeResponse instanceof ResourceResponse) {
          ResourceResponse resourceResponse=(ResourceResponse)mimeResponse;
          resourceResponse.setContentLength(contentLength);
        }
      }
      os=new BufferedOutputStream(mimeResponse.getPortletOutputStream());
      if (!(is instanceof BufferedInputStream)) {
        is=new BufferedInputStream(is);
      }
      int c=is.read();
      while (c != -1) {
        os.write(c);
        c=is.read();
      }
    }
  }
  finally {
    ServletResponseUtil.cleanUp(os,is);
  }
}
