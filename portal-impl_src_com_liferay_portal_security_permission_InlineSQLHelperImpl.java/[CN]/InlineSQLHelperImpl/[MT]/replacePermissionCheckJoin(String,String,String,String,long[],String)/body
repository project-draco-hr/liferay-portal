{
  if (Validator.isNull(classPKField)) {
    throw new IllegalArgumentException("classPKField is null");
  }
  PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
  long checkGroupId=0;
  if (groupIds.length == 1) {
    checkGroupId=groupIds[0];
  }
  if (permissionChecker.hasPermission(checkGroupId,className,0,ActionKeys.VIEW)) {
    return sql;
  }
  String permissionJoin=StringPool.BLANK;
  if (Validator.isNotNull(bridgeJoin)) {
    permissionJoin=bridgeJoin;
  }
  permissionJoin+=CustomSQLUtil.get(JOIN_RESOURCE_PERMISSION);
  StringBundler sb=new StringBundler();
  sb.append("(InlineSQLResourcePermission.scope = ");
  sb.append(ResourceConstants.SCOPE_INDIVIDUAL);
  sb.append(" AND ");
  sb.append("InlineSQLResourcePermission.primKey = CAST_TEXT(");
  sb.append(classPKField);
  sb.append(") AND (");
  long userId=getUserId();
  boolean hasPreviousViewableGroup=false;
  for (int j=0; j < groupIds.length; j++) {
    long groupId=groupIds[j];
    if (!permissionChecker.hasPermission(groupId,className,0,ActionKeys.VIEW)) {
      if ((j > 0) && hasPreviousViewableGroup) {
        sb.append(" OR ");
      }
      hasPreviousViewableGroup=true;
      sb.append("(");
      sb.append(classPKField.substring(0,classPKField.lastIndexOf(CharPool.PERIOD)));
      sb.append(".groupId = ");
      sb.append(groupId);
      sb.append(")");
      long[] roleIds=getRoleIds(groupId);
      if (roleIds.length == 0) {
        roleIds=_NO_ROLE_IDS;
      }
      sb.append(" AND (");
      for (int i=0; i < roleIds.length; i++) {
        if (i > 0) {
          sb.append(" OR ");
        }
        sb.append("InlineSQLResourcePermission.roleId = ");
        sb.append(roleIds[i]);
      }
      if (permissionChecker.isSignedIn()) {
        sb.append(" OR ");
        if (Validator.isNotNull(userIdField)) {
          sb.append("(");
          sb.append(userIdField);
          sb.append(" = ");
          sb.append(userId);
          sb.append(")");
        }
 else {
          sb.append("(InlineSQLResourcePermission.ownerId = ");
          sb.append(userId);
          sb.append(")");
        }
      }
      sb.append(")");
    }
  }
  sb.append("))");
  permissionJoin=StringUtil.replace(permissionJoin,new String[]{"[$CLASS_NAME$]","[$COMPANY_ID$]","[$PRIM_KEYS$]"},new String[]{className,String.valueOf(permissionChecker.getCompanyId()),sb.toString()});
  int pos=sql.indexOf(_WHERE_CLAUSE);
  if (pos != -1) {
    return sql.substring(0,pos + 1).concat(permissionJoin).concat(sql.substring(pos + 1));
  }
  pos=sql.indexOf(_GROUP_BY_CLAUSE);
  if (pos != -1) {
    return sql.substring(0,pos + 1).concat(permissionJoin).concat(sql.substring(pos + 1));
  }
  pos=sql.indexOf(_ORDER_BY_CLAUSE);
  if (pos != -1) {
    return sql.substring(0,pos + 1).concat(permissionJoin).concat(sql.substring(pos + 1));
  }
  return sql.concat(StringPool.SPACE).concat(permissionJoin);
}
