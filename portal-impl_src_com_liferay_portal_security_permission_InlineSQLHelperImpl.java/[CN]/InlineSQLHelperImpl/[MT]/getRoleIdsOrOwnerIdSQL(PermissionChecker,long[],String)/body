{
  StringBundler sb=new StringBundler();
  sb.append(StringPool.OPEN_PARENTHESIS);
  sb.append("ResourcePermission.roleId IN (");
  long[] roleIds=getRoleIds(groupIds);
  if (roleIds.length == 0) {
    roleIds=_NO_ROLE_IDS;
  }
  sb.append(StringUtil.merge(roleIds));
  sb.append(StringPool.CLOSE_PARENTHESIS);
  if (permissionChecker.isSignedIn()) {
    sb.append(" OR ");
    long userId=permissionChecker.getUserId();
    if (Validator.isNotNull(userIdField)) {
      sb.append(StringPool.OPEN_PARENTHESIS);
      sb.append(userIdField);
      sb.append(" = ");
      sb.append(userId);
      sb.append(StringPool.CLOSE_PARENTHESIS);
    }
 else {
      sb.append("(ResourcePermission.ownerId = ");
      sb.append(userId);
      sb.append(StringPool.CLOSE_PARENTHESIS);
    }
  }
  sb.append(StringPool.CLOSE_PARENTHESIS);
  return sb.toString();
}
