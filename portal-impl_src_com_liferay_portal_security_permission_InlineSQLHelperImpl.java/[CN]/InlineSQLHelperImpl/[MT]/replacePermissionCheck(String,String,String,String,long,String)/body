{
  if (!isEnabled(groupId)) {
    return sql;
  }
  if (Validator.isNull(className)) {
    new IllegalArgumentException("className is null");
  }
  if (Validator.isNull(classPKField)) {
    new IllegalArgumentException("classPKField is null");
  }
  if (Validator.isNull(sql)) {
    return sql;
  }
  String permissionJoin=StringPool.BLANK;
  if (Validator.isNotNull(bridgeJoin)) {
    permissionJoin=bridgeJoin;
  }
  permissionJoin+=CustomSQLUtil.get(JOIN_RESOURCE_PERMISSION);
  StringBundler ownerSQL=new StringBundler(5);
  if (Validator.isNotNull(userIdField)) {
    ownerSQL.append(" OR (");
    ownerSQL.append(userIdField);
    ownerSQL.append(" = ");
    ownerSQL.append(String.valueOf(getUserId()));
    ownerSQL.append(")");
  }
  permissionJoin=StringUtil.replace(permissionJoin,new String[]{"[$CLASS_NAME$]","[$CLASS_PK_FIELD$]","[$OWNER_CHECK$]","[$ROLE_IDS$]"},new String[]{className,classPKField,ownerSQL.toString(),StringUtil.merge(getRoleIds(groupId))});
  int pos=sql.indexOf(_WHERE_CLAUSE);
  if (pos != -1) {
    return sql.substring(0,pos + 1).concat(permissionJoin).concat(sql.substring(pos + 1));
  }
  pos=sql.indexOf(_ORDER_BY_CLAUSE);
  if (pos != -1) {
    return sql.substring(0,pos + 1).concat(permissionJoin).concat(sql.substring(pos + 1));
  }
  return sql.concat(StringPool.SPACE).concat(permissionJoin);
}
