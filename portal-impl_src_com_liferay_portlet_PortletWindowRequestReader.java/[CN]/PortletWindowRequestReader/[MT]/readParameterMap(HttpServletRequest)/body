{
  Map<String,String[]> parsedMap=new HashMap<String,String[]>();
  Map<String,String[]> parameterMap=request.getParameterMap();
  String portletId=request.getParameter("p_p_id");
  String namespace=PortalUtil.getPortletNamespace(portletId);
  Set<Map.Entry<String,String[]>> entries=parameterMap.entrySet();
  for (  Map.Entry<String,String[]> mapEntry : entries) {
    String key=mapEntry.getKey();
    if (!PortalUtil.isReservedParameter(key)) {
      if (key.startsWith(namespace)) {
        parsedMap.put(key.substring(namespace.length()),mapEntry.getValue());
      }
 else       if (key.startsWith(QNameUtil.PUBLIC_RENDER_PARAMETER_NAMESPACE)) {
        String identifier=QNameUtil.getPublicRenderParameterIdentifier(key);
        parsedMap.put(identifier,mapEntry.getValue());
      }
 else {
        parsedMap.put(key,mapEntry.getValue());
      }
    }
  }
  return parsedMap;
}
