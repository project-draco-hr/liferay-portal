{
  if (layout.getType().equals(LayoutConstants.TYPE_URL)) {
    UnicodeProperties typeSettings=layout.getTypeSettingsProperties();
    String url=GetterUtil.getString(typeSettings.getProperty("url"));
    String friendlyURLPrivateGroupPath=PropsValues.LAYOUT_FRIENDLY_URL_PRIVATE_GROUP_SERVLET_MAPPING;
    String friendlyURLPrivateUserPath=PropsValues.LAYOUT_FRIENDLY_URL_PRIVATE_USER_SERVLET_MAPPING;
    String friendlyURLPublicPath=PropsValues.LAYOUT_FRIENDLY_URL_PUBLIC_SERVLET_MAPPING;
    if (url.startsWith(friendlyURLPrivateGroupPath) || url.startsWith(friendlyURLPrivateUserPath) || url.startsWith(friendlyURLPublicPath)) {
      int x=url.indexOf(StringPool.SLASH,1);
      if (x > 0) {
        int y=url.indexOf(StringPool.SLASH,x + 1);
        if (y > x) {
          String friendlyURL=url.substring(x,y);
          String groupFriendlyURL=layout.getGroup().getFriendlyURL();
          if (Validator.equals(friendlyURL,groupFriendlyURL)) {
            String fixedUrl=url.substring(0,x) + _SAME_COMMUNITY_FRIENDLY_URL + url.substring(y);
            typeSettings.setProperty("url",fixedUrl);
          }
        }
      }
    }
  }
}
