{
  List<Portlet> portletsList=new ArrayList<Portlet>();
  Set<String> portletIdsSet=new HashSet<String>();
  for (  Layout curLayout : layouts) {
    if (curLayout.isTypePortlet()) {
      LayoutTypePortlet curLayoutTypePortlet=(LayoutTypePortlet)curLayout.getLayoutType();
      for (      String portletId : curLayoutTypePortlet.getPortletIds()) {
        Portlet portlet=PortletLocalServiceUtil.getPortletById(curLayout.getCompanyId(),portletId);
        if (portlet == null) {
          continue;
        }
        PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
        if ((portletDataHandler != null) && !portletIdsSet.contains(portlet.getRootPortletId())) {
          portletIdsSet.add(portlet.getRootPortletId());
          portletsList.add(portlet);
        }
      }
    }
  }
  return portletsList;
}
