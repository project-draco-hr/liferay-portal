{
  PortletDataContext portletDataContext=null;
  try {
    ExportImportThreadLocal.setLayoutExportInProcess(true);
    portletDataContext=getPortletDataContext(groupId,privateLayout,parameterMap,startDate,endDate);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_LAYOUT_EXPORT_STARTED,PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext));
    File file=doExportLayoutsAsFile(portletDataContext,layoutIds);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_LAYOUT_EXPORT_FINISHED,PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext));
    return file;
  }
 catch (  Throwable t) {
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_LAYOUT_EXPORT_FAILED,PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext),t);
    throw t;
  }
 finally {
    ExportImportThreadLocal.setLayoutExportInProcess(false);
  }
}
