{
  List<Portlet> portlets=new ArrayList<Portlet>();
  Set<String> rootPortletIds=new HashSet<String>();
  for (  Layout curLayout : layouts) {
    if (!curLayout.isTypePortlet()) {
      continue;
    }
    LayoutTypePortlet curLayoutTypePortlet=(LayoutTypePortlet)curLayout.getLayoutType();
    for (    String portletId : curLayoutTypePortlet.getPortletIds()) {
      Portlet portlet=PortletLocalServiceUtil.getPortletById(curLayout.getCompanyId(),portletId);
      if ((portlet == null) || rootPortletIds.contains(portlet.getRootPortletId())) {
        continue;
      }
      PortletDataHandler portletDataHandler=portlet.getPortletDataHandlerInstance();
      PortletDataHandlerControl[] configurationControls=portletDataHandler.getExportConfigurationControls(curLayout.getCompanyId(),curLayout.getGroupId(),portlet,curLayout.getPrivateLayout());
      if ((configurationControls != null) && (configurationControls.length > 0)) {
        rootPortletIds.add(portlet.getRootPortletId());
        portlets.add(portlet);
      }
    }
  }
  return portlets;
}
