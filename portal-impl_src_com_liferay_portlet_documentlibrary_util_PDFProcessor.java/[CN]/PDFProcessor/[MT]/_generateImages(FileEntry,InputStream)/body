{
  String id=DLUtil.getTempFileId(fileEntry.getFileEntryId(),fileEntry.getVersion());
  if (PropsValues.IMAGEMAGICK_ENABLED) {
    if (fileEntry.getExtension().equals("pdf")) {
      String filePath=DocumentConversionUtil.getFilePath(id,"pdf");
      File file=new File(filePath);
      try {
        FileUtil.write(file,inputStream);
        _generateImages(fileEntry,file);
      }
  finally {
        file.delete();
      }
    }
 else {
      File file=DocumentConversionUtil.convert(id,inputStream,fileEntry.getExtension(),"pdf");
      _generateImages(fileEntry,file);
    }
  }
 else {
    boolean generatePreview=_isGeneratePreview(id);
    boolean generateThumbnail=_isGenerateThumbnail(id);
    PDDocument pdDocument=null;
    try {
      pdDocument=PDDocument.load(inputStream);
      PDDocumentCatalog pdDocumentCatalog=pdDocument.getDocumentCatalog();
      List<PDPage> pdPages=pdDocumentCatalog.getAllPages();
      for (int i=0; i < pdPages.size(); i++) {
        PDPage pdPage=pdPages.get(i);
        if (generateThumbnail && (i == 0)) {
          _generateImagesPB(pdPage,id,PropsValues.DL_FILE_ENTRY_THUMBNAIL_DPI,PropsValues.DL_FILE_ENTRY_THUMBNAIL_HEIGHT,PropsValues.DL_FILE_ENTRY_THUMBNAIL_WIDTH,true,0);
          if (_log.isInfoEnabled()) {
            _log.info("PDFBox generated a thumbnail for " + id);
          }
        }
        if (!generatePreview) {
          break;
        }
        _generateImagesPB(pdPage,id,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_DPI,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_HEIGHT,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_WIDTH,false,i + 1);
      }
      if (_log.isInfoEnabled() && generatePreview) {
        _log.info("PDFBox generated " + _getPreviewFileCount(fileEntry) + " preview pages for "+ id);
      }
    }
  finally {
      if (pdDocument != null) {
        pdDocument.close();
      }
    }
  }
}
