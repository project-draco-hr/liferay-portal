{
  boolean generatePreview=_isGeneratePreview(fileVersion);
  boolean generateThumbnail=_isGenerateThumbnail(fileVersion);
  PDDocument pdDocument=null;
  try {
    pdDocument=PDDocument.load(inputStream);
    PDDocumentCatalog pdDocumentCatalog=pdDocument.getDocumentCatalog();
    List<PDPage> pdPages=pdDocumentCatalog.getAllPages();
    for (int i=0; i < pdPages.size(); i++) {
      PDPage pdPage=pdPages.get(i);
      if (generateThumbnail && (i == 0)) {
        _generateImagesPB(fileVersion,pdPage,i);
        if (_log.isInfoEnabled()) {
          _log.info("PDFBox generated a thumbnail for " + fileVersion.getFileVersionId());
        }
      }
      if (!generatePreview) {
        break;
      }
      _generateImagesPB(fileVersion,pdPage,i + 1);
    }
    if (_log.isInfoEnabled() && generatePreview) {
      _log.info("PDFBox generated " + getPreviewFileCount(fileVersion) + " preview pages for "+ fileVersion.getFileVersionId());
    }
  }
  finally {
    if (pdDocument != null) {
      pdDocument.close();
    }
  }
}
