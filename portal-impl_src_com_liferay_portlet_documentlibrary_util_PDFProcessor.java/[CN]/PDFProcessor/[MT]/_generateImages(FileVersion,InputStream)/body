{
  String id=DLUtil.getTempFileId(fileVersion.getFileEntryId(),fileVersion.getVersion());
  if (PropsValues.IMAGEMAGICK_ENABLED) {
    if (fileVersion.getExtension().equals("pdf")) {
      String filePath=DocumentConversionUtil.getFilePath(id,"pdf");
      File file=new File(filePath);
      try {
        FileUtil.write(file,inputStream);
        _generateImages(fileVersion,file);
      }
  finally {
        FileUtil.delete(file);
      }
    }
 else {
      File file=DocumentConversionUtil.convert(id,inputStream,fileVersion.getExtension(),"pdf");
      _generateImages(fileVersion,file);
    }
  }
 else {
    long fileVersionId=fileVersion.getFileVersionId();
    boolean generatePreview=_isGeneratePreview(fileVersion);
    boolean generateThumbnail=_isGenerateThumbnail(fileVersion);
    PDDocument pdDocument=null;
    try {
      pdDocument=PDDocument.load(inputStream);
      PDDocumentCatalog pdDocumentCatalog=pdDocument.getDocumentCatalog();
      List<PDPage> pdPages=pdDocumentCatalog.getAllPages();
      for (int i=0; i < pdPages.size(); i++) {
        PDPage pdPage=pdPages.get(i);
        if (generateThumbnail && (i == 0)) {
          _generateImagesPB(fileVersion,pdPage,PropsValues.DL_FILE_ENTRY_THUMBNAIL_DPI,PropsValues.DL_FILE_ENTRY_THUMBNAIL_HEIGHT,PropsValues.DL_FILE_ENTRY_THUMBNAIL_WIDTH,true,0);
          if (_log.isInfoEnabled()) {
            _log.info("PDFBox generated a thumbnail for " + fileVersionId);
          }
        }
        if (!generatePreview) {
          break;
        }
        _generateImagesPB(fileVersion,pdPage,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_DPI,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_HEIGHT,PropsValues.DL_FILE_ENTRY_PREVIEW_DOCUMENT_WIDTH,false,i + 1);
      }
      if (_log.isInfoEnabled() && generatePreview) {
        _log.info("PDFBox generated " + getPreviewFileCount(fileVersion) + " preview pages for "+ fileVersionId);
      }
    }
  finally {
      if (pdDocument != null) {
        pdDocument.close();
      }
    }
  }
}
