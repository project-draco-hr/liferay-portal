{
  _bnd=bnd;
  _moduleName=moduleName;
  _upgradeBaseDir=upgradeBaseDir;
  _upgradeTableDir=upgradeTableDir;
  DirectoryScanner ds=new DirectoryScanner();
  ds.setBasedir(_upgradeBaseDir);
  ds.setIncludes(new String[]{"**\\upgrade\\v**\\util\\*Table.java"});
  ds.scan();
  String[] filePaths=ds.getIncludedFiles();
  for (  String filePath : filePaths) {
    filePath=StringUtil.replace(filePath,"\\","/");
    String upgradeFileVersion=filePath.replaceFirst(".*/upgrade/v(.+)/util.*","$1");
    upgradeFileVersion=upgradeFileVersion.replaceAll("_",".");
    if (upgradeFileVersion.contains("to")) {
      upgradeFileVersion=upgradeFileVersion.replaceFirst(".+\\.to\\.(.+)","$1");
    }
    String fileName=FilenameUtils.getName(filePath);
    String upgradeFileName=fileName.replaceFirst("Table","ModelImpl");
    String upgradeFilePath=_upgradeTableDir + "/" + upgradeFileVersion+ "/"+ upgradeFileName;
    if (!_fileUtil.exists(upgradeFilePath)) {
      if (!upgradeFileVersion.equals(_getModuleVersion())) {
        continue;
      }
      upgradeFilePath=_findUpgradeFilePath(upgradeFileName);
      if (upgradeFilePath == null) {
        continue;
      }
    }
    String content=_fileUtil.read(upgradeFilePath);
    String packagePath="com.liferay.portal.upgrade.v" + StringUtil.replace(upgradeFileVersion,".","_") + ".util";
    String className=fileName.replaceFirst("\\.java","");
    String author=_getAuthor(fileName);
    File indexesFile=_getIndexesFile(upgradeFileVersion);
    String[] addIndexes=_getAddIndexes(indexesFile,fileName.replaceFirst("Table\\.java",""));
    content=_getContent(packagePath,className,content,author,addIndexes);
    _fileUtil.write(filePath,content);
  }
}
