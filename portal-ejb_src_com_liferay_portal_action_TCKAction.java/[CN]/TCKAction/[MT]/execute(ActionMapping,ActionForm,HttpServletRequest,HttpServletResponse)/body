{
  try {
    if (!GetterUtil.getBoolean(PropsUtil.get(PropsUtil.TCK_URL))) {
      throw new PrincipalException();
    }
    String[] portletNames=req.getParameterValues("portletName");
    for (int i=0; i < portletNames.length; i++) {
      String[] nameAndWar=StringUtil.split(portletNames[i],"/");
      portletNames[i]=PortalUtil.getJsSafePortletName(nameAndWar[1] + PortletImpl.WAR_SEPARATOR + nameAndWar[0]);
    }
    Layout layout=LayoutLocalServiceUtil.addLayout("1","liferay.com.1",false,LayoutImpl.DEFAULT_PARENT_LAYOUT_ID,"TCKAction",StringPool.BLANK,LayoutImpl.TYPE_PORTLET,false,StringPool.BLANK);
    LayoutTypePortlet layoutType=(LayoutTypePortlet)layout.getLayoutType();
    for (int i=0; i < portletNames.length; i++) {
      layoutType.addPortletId("liferay.com.1",portletNames[i]);
    }
    LayoutLocalServiceUtil.updateLayout(layout.getLayoutId(),layout.getOwnerId(),layout.getTypeSettings());
    String mainPath=(String)req.getAttribute(WebKeys.MAIN_PATH);
    req.setAttribute(WebKeys.FORWARD_URL,mainPath + "/portal/layout?p_l_id=" + layout.getPlid());
    return mapping.findForward(Constants.COMMON_FORWARD_JSP);
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    return mapping.findForward(Constants.COMMON_ERROR);
  }
}
