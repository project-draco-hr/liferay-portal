{
  if (files.isEmpty()) {
    return null;
  }
  if (files.size() == 1) {
    return files.get(0);
  }
  AntBuilder antBuilder=project.createAntBuilder();
  jarDir.mkdirs();
  File jarFile=new File(jarDir,createTempFileName("classpath","jar"));
  jarFile.deleteOnExit();
  String manifestClasspathProperty="manifest.classpath." + jarFile.getName();
  _invokeAntMethodManifestClasspath(antBuilder,files,jarFile,manifestClasspathProperty);
  String manifestClasspath=String.valueOf(antBuilder.getProperty(manifestClasspathProperty));
  File manifestFile=new File(jarFile.getParentFile(),jarFile.getName() + ".manifest");
  try {
    _invokeAntMethodManifest(antBuilder,manifestFile,Collections.singletonMap("Class-Path",manifestClasspath));
    _invokeAntMethodJar(antBuilder,jarFile,null,false,new String[0][0],manifestFile);
  }
  finally {
    project.delete(manifestFile);
  }
  return jarFile;
}
