{
  validate();
  javax.portlet.Portlet portletInstance=getPortletInstance(portlet);
  Registry registry=RegistryUtil.getRegistry();
  Filter filter=registry.getFilter("(|(javax.portlet.name=" + portlet.getPortletId() + ")(javax.portlet.name=ALL))");
  List<ConfigurationAction> configurationActionInstances=newConfigurationActions(portlet,filter);
  List<Indexer<?>> indexerInstances=newIndexers(portlet,filter);
  List<OpenSearch> openSearchInstances=newOpenSearches(portlet,filter);
  List<SchedulerEventMessageListener> schedulerEventMessageListeners=newSchedulerEventMessageListeners(portlet,filter);
  FriendlyURLMapperTracker friendlyURLMapperTracker=newFriendlyURLMappers(portlet);
  List<URLEncoder> urlEncoderInstances=newURLEncoders(portlet,filter);
  List<PortletDataHandler> portletDataHandlerInstances=newPortletDataHandlers(portlet,filter);
  List<StagedModelDataHandler<?>> stagedModelDataHandlerInstances=newStagedModelDataHandler(portlet,filter);
  List<TemplateHandler> templateHandlerInstances=newTemplateHandlers(portlet,filter);
  List<PortletLayoutListener> portletLayoutListenerInstances=newPortletLayoutListeners(portlet,filter);
  List<PollerProcessor> pollerProcessorInstances=newPollerProcessors(portlet,filter);
  List<MessageListener> popMessageListenerInstances=newPOPMessageListeners(portlet,filter);
  List<SocialActivityInterpreter> socialActivityInterpreterInstances=newSocialActivityInterpreterInstances(portlet,filter);
  List<SocialRequestInterpreter> socialRequestInterpreterInstances=newSocialRequestInterpreterInstances(portlet,filter);
  List<UserNotificationDefinition> userNotificationDefinitionInstances=newUserNotificationDefinitionInstances(portlet,filter);
  List<UserNotificationHandler> userNotificationHandlerInstances=newUserNotificationHandlerInstances(portlet,filter);
  List<WebDAVStorage> webDAVStorageInstances=newWebDAVStorageInstances(portlet,filter);
  List<Method> xmlRpcMethodInstances=newXmlRpcMethodInstances(portlet,filter);
  List<ControlPanelEntry> controlPanelEntryInstances=newControlPanelEntryInstances(portlet,filter);
  List<AssetRendererFactory<?>> assetRendererFactoryInstances=newAssetRendererFactoryInstances(portlet,filter);
  List<AtomCollectionAdapter<?>> atomCollectionAdapterInstances=newAtomCollectionAdapterInstances(portlet,filter);
  List<CustomAttributesDisplay> customAttributesDisplayInstances=newCustomAttributesDisplayInstances(portlet,filter);
  List<PermissionPropagator> permissionPropagatorInstances=newPermissionPropagators(portlet,filter);
  List<TrashHandler> trashHandlerInstances=newTrashHandlerInstances(portlet,filter);
  List<WorkflowHandler<?>> workflowHandlerInstances=newWorkflowHandlerInstances(portlet,filter);
  List<PreferencesValidator> preferencesValidatorInstances=newPreferencesValidatorInstances(portlet,filter);
  ResourceBundleTracker resourceBundleTracker=new ResourceBundleTracker(_classLoader,portlet);
  PortletBag portletBag=new PortletBagImpl(portlet.getPortletId(),_servletContext,portletInstance,resourceBundleTracker,configurationActionInstances,indexerInstances,openSearchInstances,schedulerEventMessageListeners,friendlyURLMapperTracker,urlEncoderInstances,portletDataHandlerInstances,stagedModelDataHandlerInstances,templateHandlerInstances,portletLayoutListenerInstances,pollerProcessorInstances,popMessageListenerInstances,socialActivityInterpreterInstances,socialRequestInterpreterInstances,userNotificationDefinitionInstances,userNotificationHandlerInstances,webDAVStorageInstances,xmlRpcMethodInstances,controlPanelEntryInstances,assetRendererFactoryInstances,atomCollectionAdapterInstances,customAttributesDisplayInstances,permissionPropagatorInstances,trashHandlerInstances,workflowHandlerInstances,preferencesValidatorInstances);
  PortletBagPool.put(portlet.getRootPortletId(),portletBag);
  try {
    PortletInstanceFactoryUtil.create(portlet,_servletContext);
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  return portletBag;
}
