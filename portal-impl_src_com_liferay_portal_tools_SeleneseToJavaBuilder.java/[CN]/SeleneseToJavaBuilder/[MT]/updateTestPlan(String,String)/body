{
  oldFileName=StringUtil.replace(oldFileName,StringPool.BACK_SLASH,StringPool.SLASH);
  int x=oldFileName.lastIndexOf(StringPool.SLASH);
  int y=oldFileName.indexOf(CharPool.PERIOD);
  String oldTestName=oldFileName.substring(x + 1,y);
  String oldTestFileName=basedir + "/" + oldFileName.substring(0,y)+ ".java";
  String newTestName=StringUtil.replace(oldTestName,"Tests","TestPlan");
  String newTestFileName=StringUtil.replace(oldTestFileName,"Tests.java","TestPlan.java");
  String content=FileUtil.read(oldTestFileName);
  content=StringUtil.replace(content,".BaseTests",".BaseTestSuite");
  content=StringUtil.replace(content," BaseTests"," BaseTestSuite");
  boolean hasTestPlans=false;
  String dirName=oldFileName.substring(0,x);
  String[] subdirNames=FileUtil.listDirs(basedir + "/" + dirName);
  for (  String subdirName : subdirNames) {
    String[] subsubdirNames=FileUtil.listDirs(basedir + "/" + dirName+ "/"+ subdirName);
    if ((subsubdirNames.length > 0) && !ArraysUtil.contains(subsubdirNames,"dependencies")) {
      hasTestPlans=true;
    }
  }
  if (hasTestPlans) {
    content=StringUtil.replace(content,"Tests","TestPlan");
  }
  if ((subdirNames.length == 0) || ((subdirNames.length == 1) && subdirNames[0].equals("dependencies"))) {
    if (!FileUtil.exists(StringUtil.replace(oldTestFileName,".java",".html"))) {
      StringBundler sb=new StringBundler();
      sb.append("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n");
      sb.append("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n");
      sb.append("<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\">\n");
      sb.append("<head>\n");
      sb.append("  <meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\" />\n");
      sb.append("  <title>" + oldTestName + "</title>\n");
      sb.append("</head>\n");
      sb.append("<body>\n");
      sb.append("<table id=\"suiteTable\" cellpadding=\"1\" cellspacing=\"1\" border=\"1\" class=\"selenium\"><tbody>\n");
      sb.append("<tr><td><b>" + oldTestName + "</b></td></tr>\n");
      x=content.indexOf("testSuite.");
      y=content.lastIndexOf(".class);") + 1;
      String testSuites=content.substring(x,y);
      testSuites=StringUtil.replace(testSuites,"\n","");
      testSuites=StringUtil.replace(testSuites,"\t","");
      String[] testSuiteClassNames=StringUtil.split(testSuites,";");
      for (      String testSuiteClassName : testSuiteClassNames) {
        testSuiteClassName=testSuiteClassName.substring(testSuiteClassName.indexOf("(") + 1,testSuiteClassName.lastIndexOf("."));
        sb.append("<tr><td><a href=\"" + testSuiteClassName + ".html\">"+ testSuiteClassName+ "</a></td></tr>\n");
      }
      sb.append("</tbody></table>\n");
      sb.append("</body>\n");
      sb.append("</html>\n");
      FileUtil.write(StringUtil.replace(oldTestFileName,".java",".html"),sb.toString());
    }
    FileUtil.write(oldTestFileName,content);
  }
 else {
    content=StringUtil.replace(content,"public class " + oldTestName,"public class " + newTestName);
    FileUtil.write(newTestFileName,content);
    FileUtil.delete(oldTestFileName);
  }
}
