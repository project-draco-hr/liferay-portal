{
  DLFileEntry dlFileEntry=(DLFileEntry)fileEntry.getModel();
  dlFileEntry.setTitle(TrashUtil.getOriginalTitle(dlFileEntry.getTitle()));
  dlFileEntryPersistence.update(dlFileEntry);
  FileVersion fileVersion=new LiferayFileVersion(dlFileEntry.getLatestFileVersion(true));
  TrashEntry trashEntry=trashEntryLocalService.getEntry(DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId());
  Map<String,Serializable> workflowContext=new HashMap<String,Serializable>();
  List<TrashVersion> trashVersions=trashVersionLocalService.getVersions(trashEntry.getEntryId());
  workflowContext.put("trashVersions",(Serializable)trashVersions);
  dlFileEntryLocalService.updateStatus(userId,fileVersion.getFileVersionId(),trashEntry.getStatus(),workflowContext,new ServiceContext());
  if (!DLAppHelperThreadLocal.isEnabled()) {
    return;
  }
  dlFileShortcutLocalService.enableFileShortcuts(fileEntry.getFileEntryId());
  dlFileRankLocalService.enableFileRanks(fileEntry.getFileEntryId());
  registerDLSyncEventCallback(DLSyncConstants.EVENT_RESTORE,DLSyncConstants.TYPE_FILE,fileEntry.getFileEntryId());
  JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
  extraDataJSONObject.put("title",fileEntry.getTitle());
  socialActivityLocalService.addActivity(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId(),SocialActivityConstants.TYPE_RESTORE_FROM_TRASH,extraDataJSONObject.toString(),0);
}
