{
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(DLFileEntry.class);
  if (status == WorkflowConstants.STATUS_APPROVED) {
    for (    Object object : children) {
      if (object instanceof DLFileEntry) {
        DLFileEntry dlFileEntry=(DLFileEntry)object;
        DLFileVersion dlFileVersion=dlFileVersionLocalService.getLatestFileVersion(dlFileEntry.getFileEntryId(),false);
        if (dlFileVersion.getStatus() == WorkflowConstants.STATUS_IN_TRASH) {
          continue;
        }
        if (dlFileVersion.isApproved()) {
          assetEntryLocalService.updateVisible(DLFileEntryConstants.getClassName(),dlFileEntry.getFileEntryId(),true);
        }
        socialActivityCounterLocalService.enableActivityCounters(DLFileEntryConstants.getClassName(),dlFileEntry.getFileEntryId());
        socialActivityLocalService.addActivity(user.getUserId(),dlFileEntry.getGroupId(),DLFileEntryConstants.getClassName(),dlFileEntry.getFileEntryId(),SocialActivityConstants.TYPE_RESTORE_FROM_TRASH,StringPool.BLANK,0);
        indexer.reindex(dlFileEntry);
      }
 else       if (object instanceof DLFolder) {
        DLFolder dlFolder=(DLFolder)object;
        if (dlFolder.getStatus() == WorkflowConstants.STATUS_IN_TRASH) {
          continue;
        }
        QueryDefinition queryDefinition=new QueryDefinition(WorkflowConstants.STATUS_ANY);
        List<Object> grandChildren=dlFolderLocalService.getFoldersAndFileEntriesAndFileShortcuts(dlFolder.getGroupId(),dlFolder.getFolderId(),null,false,queryDefinition);
        updateChildrenStatuses(user,grandChildren,status);
      }
    }
  }
 else {
    for (    Object object : children) {
      if (object instanceof DLFileEntry) {
        DLFileEntry dlFileEntry=(DLFileEntry)object;
        DLFileVersion dlFileVersion=dlFileVersionLocalService.getLatestFileVersion(dlFileEntry.getFileEntryId(),false);
        assetEntryLocalService.updateVisible(DLFileEntryConstants.getClassName(),dlFileEntry.getFileEntryId(),false);
        socialActivityLocalService.addActivity(user.getUserId(),dlFileEntry.getGroupId(),DLFileEntryConstants.getClassName(),dlFileEntry.getFileEntryId(),SocialActivityConstants.TYPE_MOVE_TO_TRASH,StringPool.BLANK,0);
        if (dlFileVersion.isPending()) {
          workflowInstanceLinkLocalService.deleteWorkflowInstanceLink(dlFileVersion.getCompanyId(),dlFileVersion.getGroupId(),DLFileEntryConstants.getClassName(),dlFileVersion.getFileVersionId());
        }
        indexer.delete(dlFileEntry);
      }
 else       if (object instanceof DLFolder) {
        DLFolder dlFolder=(DLFolder)object;
        if (dlFolder.getStatus() == WorkflowConstants.STATUS_IN_TRASH) {
          continue;
        }
        QueryDefinition queryDefinition=new QueryDefinition(WorkflowConstants.STATUS_ANY);
        List<Object> grandChildren=dlFolderLocalService.getFoldersAndFileEntriesAndFileShortcuts(dlFolder.getGroupId(),dlFolder.getFolderId(),null,false,queryDefinition);
        updateChildrenStatuses(user,grandChildren,status);
      }
    }
  }
}
