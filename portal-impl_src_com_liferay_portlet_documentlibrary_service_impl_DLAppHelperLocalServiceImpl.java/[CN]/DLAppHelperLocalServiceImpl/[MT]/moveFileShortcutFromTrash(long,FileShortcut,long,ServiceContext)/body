{
  DLFileShortcut dlFileShortcut=(DLFileShortcut)fileShortcut.getModel();
  if (!dlFileShortcut.isInTrash()) {
    throw new RestoreEntryException(RestoreEntryException.INVALID_STATUS);
  }
  if (dlFileShortcut.isInTrashExplicitly()) {
    restoreFileShortcutFromTrash(userId,fileShortcut);
  }
 else {
    TrashVersion trashVersion=trashVersionLocalService.fetchVersion(DLFileShortcutConstants.getClassName(),fileShortcut.getFileShortcutId());
    int status=WorkflowConstants.STATUS_APPROVED;
    if (trashVersion != null) {
      status=trashVersion.getStatus();
    }
    dlFileShortcutLocalService.updateStatus(userId,fileShortcut.getFileShortcutId(),status,new ServiceContext());
    if (trashVersion != null) {
      trashVersionLocalService.deleteTrashVersion(trashVersion);
    }
    JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
    extraDataJSONObject.put("title",fileShortcut.getToTitle());
    SocialActivityManagerUtil.addActivity(userId,fileShortcut,SocialActivityConstants.TYPE_RESTORE_FROM_TRASH,extraDataJSONObject.toString(),0);
  }
  return dlAppService.updateFileShortcut(fileShortcut.getFileShortcutId(),newFolderId,fileShortcut.getToFileEntryId(),serviceContext);
}
