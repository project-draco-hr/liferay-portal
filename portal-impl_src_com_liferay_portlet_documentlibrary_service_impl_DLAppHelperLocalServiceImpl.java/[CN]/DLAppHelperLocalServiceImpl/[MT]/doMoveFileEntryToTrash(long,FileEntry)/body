{
  List<DLFileVersion> dlFileVersions=dlFileVersionLocalService.getFileVersions(fileEntry.getFileEntryId(),WorkflowConstants.STATUS_ANY);
  dlFileVersions=ListUtil.sort(dlFileVersions,new FileVersionVersionComparator());
  FileVersion fileVersion=new LiferayFileVersion(dlFileVersions.get(0));
  Map<String,Serializable> workflowContext=new HashMap<String,Serializable>();
  workflowContext.put("dlFileVersions",(Serializable)dlFileVersions);
  int oldStatus=fileVersion.getStatus();
  dlFileEntryLocalService.updateStatus(userId,fileVersion.getFileVersionId(),WorkflowConstants.STATUS_IN_TRASH,workflowContext,new ServiceContext());
  DLFileEntry dlFileEntry=(DLFileEntry)fileEntry.getModel();
  TrashEntry trashEntry=trashEntryLocalService.getEntry(DLFileEntryConstants.getClassName(),dlFileEntry.getFileEntryId());
  String trashTitle=TrashUtil.getTrashTitle(trashEntry.getEntryId());
  dlFileEntry.setTitle(trashTitle);
  dlFileEntryPersistence.update(dlFileEntry);
  if (!DLAppHelperThreadLocal.isEnabled()) {
    return fileEntry;
  }
  dlFileShortcutLocalService.disableFileShortcuts(fileEntry.getFileEntryId());
  dlFileRankLocalService.disableFileRanks(fileEntry.getFileEntryId());
  registerDLSyncEventCallback(DLSyncConstants.EVENT_DELETE,DLSyncConstants.TYPE_FILE,fileEntry.getFileEntryId());
  JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
  extraDataJSONObject.put("title",TrashUtil.getOriginalTitle(fileEntry.getTitle()));
  socialActivityLocalService.addActivity(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId(),SocialActivityConstants.TYPE_MOVE_TO_TRASH,extraDataJSONObject.toString(),0);
  if (oldStatus == WorkflowConstants.STATUS_PENDING) {
    workflowInstanceLinkLocalService.deleteWorkflowInstanceLink(fileVersion.getCompanyId(),fileVersion.getGroupId(),DLFileEntryConstants.getClassName(),fileVersion.getFileVersionId());
  }
  return fileEntry;
}
