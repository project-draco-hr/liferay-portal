{
  AssetEntry assetEntry=null;
  long fileEntryTypeId=0;
  LiferayFileEntry liferayFileEntry=(LiferayFileEntry)fileEntry.getLatestFileVersion().getFileEntry();
  if (liferayFileEntry != null) {
    DLFileEntry dlFileEntry=liferayFileEntry.getDLFileEntry();
    fileEntryTypeId=dlFileEntry.getFileEntryTypeId();
  }
  if (addDraftAssetEntry) {
    assetEntry=assetEntryLocalService.updateEntry(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileVersion.getFileVersionId(),fileEntry.getUuid(),fileEntryTypeId,assetCategoryIds,assetTagNames,false,null,null,null,null,mimeType,fileEntry.getTitle(),fileEntry.getDescription(),null,null,null,height,width,null,false);
  }
 else {
    assetEntry=assetEntryLocalService.updateEntry(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId(),fileEntry.getUuid(),fileEntryTypeId,assetCategoryIds,assetTagNames,visible,null,null,null,null,mimeType,fileEntry.getTitle(),fileEntry.getDescription(),null,null,null,height,width,null,false);
    List<DLFileShortcut> fileShortcuts=dlFileShortcutPersistence.findByToFileEntryId(fileEntry.getFileEntryId());
    for (    DLFileShortcut fileShortcut : fileShortcuts) {
      assetEntryLocalService.updateEntry(userId,fileShortcut.getGroupId(),DLFileShortcut.class.getName(),fileShortcut.getFileShortcutId(),fileShortcut.getUuid(),fileEntryTypeId,assetCategoryIds,assetTagNames,true,null,null,null,null,mimeType,fileEntry.getTitle(),fileEntry.getDescription(),null,null,null,height,width,null,false);
    }
  }
  assetLinkLocalService.updateLinks(userId,assetEntry.getEntryId(),assetLinkEntryIds,AssetLinkConstants.TYPE_RELATED);
  return assetEntry;
}
