{
  long folderId=folder.getFolderId();
  boolean hasLock=dlFolderService.hasFolderLock(folderId);
  Lock lock=null;
  if (!hasLock) {
    lock=dlFolderService.lockFolder(folderId);
  }
  try {
    return moveFolderFromTrashImpl(userId,folder,parentFolderId,serviceContext);
  }
  finally {
    if (!hasLock) {
      dlFolderService.unlockFolder(folder.getGroupId(),folderId,lock.getUuid());
    }
  }
}
