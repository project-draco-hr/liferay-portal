{
  DLFolder dlFolder=(DLFolder)folder.getModel();
  if (dlFolder.isInTrash()) {
    throw new TrashEntryException();
  }
  dlFolder=dlFolderLocalService.updateStatus(userId,folder.getFolderId(),WorkflowConstants.STATUS_IN_TRASH,new HashMap<String,Serializable>(),new ServiceContext());
  dlFileRankLocalService.disableFileRanksByFolderId(folder.getFolderId());
  UnicodeProperties typeSettingsProperties=new UnicodeProperties();
  typeSettingsProperties.put("title",dlFolder.getName());
  TrashEntry trashEntry=trashEntryLocalService.addTrashEntry(userId,dlFolder.getGroupId(),DLFolderConstants.getClassName(),dlFolder.getFolderId(),dlFolder.getUuid(),null,WorkflowConstants.STATUS_APPROVED,null,typeSettingsProperties);
  dlFolder.setName(TrashUtil.getTrashTitle(trashEntry.getEntryId()));
  dlFolderPersistence.update(dlFolder);
  moveDependentsToTrash(dlFolder);
  triggerRepositoryEvent(folder.getRepositoryId(),TrashRepositoryEventType.EntryTrashed.class,Folder.class,folder);
  JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
  extraDataJSONObject.put("title",folder.getName());
  SocialActivityManagerUtil.addActivity(userId,folder,SocialActivityConstants.TYPE_MOVE_TO_TRASH,extraDataJSONObject.toString(),0);
  return new LiferayFolder(dlFolder);
}
