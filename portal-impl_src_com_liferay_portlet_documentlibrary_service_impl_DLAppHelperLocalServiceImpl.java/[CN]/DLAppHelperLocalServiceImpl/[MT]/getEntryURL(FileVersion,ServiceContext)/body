{
  ThemeDisplay themeDisplay=serviceContext.getThemeDisplay();
  User user=themeDisplay.getUser();
  Group group=user.getGroup();
  long portletPlid=PortalUtil.getPlidFromPortletId(group.getGroupId(),true,PortletKeys.DOCUMENT_LIBRARY);
  PortletURL portletURL=null;
  if (portletPlid != 0) {
    portletURL=PortletURLFactoryUtil.create(serviceContext.getLiferayPortletRequest(),PortletKeys.DOCUMENT_LIBRARY,portletPlid,PortletRequest.RENDER_PHASE);
  }
 else {
    LiferayPortletResponse liferayPortletResponse=serviceContext.getLiferayPortletResponse();
    portletURL=liferayPortletResponse.createRenderURL(PortletKeys.DOCUMENT_LIBRARY);
  }
  _setPortletURLWindowState(portletURL,WindowState.NORMAL);
  portletURL.setParameter("struts_action","/document_library/view_file_entry");
  portletURL.setParameter("fileEntryId",String.valueOf(fileVersion.getFileEntryId()));
  return portletURL.toString();
}
