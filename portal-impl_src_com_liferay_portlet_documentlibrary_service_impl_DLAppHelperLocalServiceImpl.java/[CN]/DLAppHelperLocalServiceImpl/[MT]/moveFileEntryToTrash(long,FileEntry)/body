{
  DLFileEntry dlFileEntry=(DLFileEntry)fileEntry.getModel();
  dlFileEntry.setTitle(DLAppUtil.appendTrashNamespace(dlFileEntry.getTitle()));
  dlFileEntryPersistence.update(dlFileEntry,false);
  List<DLFileVersion> dlFileVersions=dlFileVersionLocalService.getFileVersions(fileEntry.getFileEntryId(),WorkflowConstants.STATUS_ANY);
  dlFileVersions=ListUtil.sort(dlFileVersions,new FileVersionVersionComparator());
  FileVersion fileVersion=new LiferayFileVersion(dlFileVersions.get(0));
  int oldStatus=fileVersion.getStatus();
  List<ObjectValuePair<Long,Integer>> fileVersionStatuses=new ArrayList<ObjectValuePair<Long,Integer>>(dlFileVersions.size());
  for (  DLFileVersion dlFileVersion : dlFileVersions) {
    ObjectValuePair<Long,Integer> fileVersionStatus=new ObjectValuePair<Long,Integer>();
    fileVersionStatus.setKey(dlFileVersion.getFileVersionId());
    int status=dlFileVersion.getStatus();
    if (status == WorkflowConstants.STATUS_PENDING) {
      status=WorkflowConstants.STATUS_DRAFT;
    }
    fileVersionStatus.setValue(status);
    fileVersionStatuses.add(fileVersionStatus);
  }
  trashEntryLocalService.addTrashEntry(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId(),oldStatus,fileVersionStatuses,null);
  dlFileEntryLocalService.updateStatus(userId,fileVersion.getFileVersionId(),WorkflowConstants.STATUS_IN_TRASH,new HashMap<String,Serializable>(),new ServiceContext());
  dlFileShortcutLocalService.disableFileShortcuts(fileEntry.getFileEntryId());
  dlFileRankLocalService.disableFileRanks(fileEntry.getFileEntryId());
  socialActivityLocalService.addActivity(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId(),SocialActivityConstants.TYPE_MOVE_TO_TRASH,StringPool.BLANK,0);
  if (oldStatus == WorkflowConstants.STATUS_PENDING) {
    workflowInstanceLinkLocalService.deleteWorkflowInstanceLink(fileVersion.getCompanyId(),fileVersion.getGroupId(),DLFileEntryConstants.getClassName(),fileVersion.getFileVersionId());
  }
  return fileEntry;
}
