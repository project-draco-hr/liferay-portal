{
  boolean hasLock=dlFileEntryLocalService.hasFileEntryLock(userId,fileEntry.getFileEntryId());
  if (!hasLock) {
    dlFileEntryLocalService.lockFileEntry(userId,fileEntry.getFileEntryId());
  }
  try {
    if (fileEntry.isCheckedOut()) {
      dlFileEntryLocalService.cancelCheckOut(userId,fileEntry.getFileEntryId());
    }
    return doMoveFileEntryToTrash(userId,fileEntry);
  }
  finally {
    if (!hasLock) {
      dlFileEntryLocalService.unlockFileEntry(fileEntry.getFileEntryId());
    }
  }
}
