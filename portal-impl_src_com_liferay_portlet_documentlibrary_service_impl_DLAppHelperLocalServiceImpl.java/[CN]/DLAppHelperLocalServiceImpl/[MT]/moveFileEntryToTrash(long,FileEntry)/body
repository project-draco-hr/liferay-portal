{
  DLFileEntry dlFileEntry=(DLFileEntry)fileEntry.getModel();
  FileVersion fileVersion=new LiferayFileVersion(dlFileEntry.getLatestFileVersion(true));
  int oldStatus=fileVersion.getStatus();
  dlFileEntryLocalService.updateStatus(userId,fileVersion.getFileVersionId(),WorkflowConstants.STATUS_IN_TRASH,new HashMap<String,Serializable>(),new ServiceContext());
  socialActivityLocalService.addActivity(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId(),SocialActivityConstants.TYPE_MOVE_TO_TRASH,StringPool.BLANK,0);
  if (oldStatus == WorkflowConstants.STATUS_PENDING) {
    workflowInstanceLinkLocalService.deleteWorkflowInstanceLink(fileVersion.getCompanyId(),fileVersion.getGroupId(),DLFileEntryConstants.getClassName(),fileVersion.getFileVersionId());
  }
  trashEntryLocalService.addTrashEntry(fileEntry.getCompanyId(),fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId(),oldStatus,null);
  return fileEntry;
}
