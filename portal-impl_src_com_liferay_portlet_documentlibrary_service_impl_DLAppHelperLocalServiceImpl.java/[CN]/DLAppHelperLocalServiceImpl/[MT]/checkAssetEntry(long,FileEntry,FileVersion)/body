{
  AssetEntry fileEntryAssetEntry=AssetEntryLocalServiceUtil.fetchEntry(DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId());
  long[] assetCategoryIds=new long[0];
  String[] assetTagNames=new String[0];
  long fileEntryTypeId=getFileEntryTypeId(fileEntry);
  if (fileEntryAssetEntry == null) {
    fileEntryAssetEntry=assetEntryLocalService.updateEntry(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId(),fileEntry.getUuid(),fileEntryTypeId,assetCategoryIds,assetTagNames,false,null,null,null,null,fileEntry.getMimeType(),fileEntry.getTitle(),fileEntry.getDescription(),null,null,null,0,0,null,false);
  }
  AssetEntry fileVersionAssetEntry=AssetEntryLocalServiceUtil.fetchEntry(DLFileEntryConstants.getClassName(),fileVersion.getFileVersionId());
  if ((fileVersionAssetEntry == null) && !fileVersion.isApproved() && !fileVersion.getVersion().equals(DLFileEntryConstants.VERSION_DEFAULT)) {
    assetCategoryIds=assetCategoryLocalService.getCategoryIds(DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId());
    assetTagNames=assetTagLocalService.getTagNames(DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId());
    fileVersionAssetEntry=assetEntryLocalService.updateEntry(userId,fileEntry.getGroupId(),DLFileEntryConstants.getClassName(),fileVersion.getFileVersionId(),fileEntry.getUuid(),fileEntryTypeId,assetCategoryIds,assetTagNames,false,null,null,null,null,fileEntry.getMimeType(),fileEntry.getTitle(),fileEntry.getDescription(),null,null,null,0,0,null,false);
    List<AssetLink> assetLinks=assetLinkLocalService.getDirectLinks(fileEntryAssetEntry.getEntryId());
    long[] assetLinkIds=StringUtil.split(ListUtil.toString(assetLinks,AssetLink.ENTRY_ID2_ACCESSOR),0L);
    assetLinkLocalService.updateLinks(userId,fileVersionAssetEntry.getEntryId(),assetLinkIds,AssetLinkConstants.TYPE_RELATED);
  }
}
