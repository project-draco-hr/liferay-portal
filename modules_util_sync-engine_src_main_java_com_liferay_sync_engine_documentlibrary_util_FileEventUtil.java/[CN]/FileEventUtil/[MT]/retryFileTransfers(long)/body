{
  List<SyncFile> deletingSyncFiles=SyncFileService.findSyncFiles(syncAccountId,SyncFile.UI_EVENT_DELETED_LOCAL,"syncFileId",true);
  for (  SyncFile deletingSyncFile : deletingSyncFiles) {
    if (!Files.notExists(Paths.get(deletingSyncFile.getFilePathName()))) {
      deletingSyncFile.setState(SyncFile.STATE_SYNCED);
      deletingSyncFile.setUiEvent(SyncFile.UI_EVENT_NONE);
      SyncFileService.update(deletingSyncFile);
      continue;
    }
    if (deletingSyncFile.isFolder()) {
      deleteFolder(syncAccountId,deletingSyncFile);
    }
 else {
      deleteFile(syncAccountId,deletingSyncFile);
    }
  }
  List<SyncFile> downloadingSyncFiles=SyncFileService.findSyncFiles(syncAccountId,SyncFile.UI_EVENT_DOWNLOADING,"size",true);
  for (  SyncFile downloadingSyncFile : downloadingSyncFiles) {
    downloadFile(syncAccountId,downloadingSyncFile);
  }
  BatchEventManager.fireBatchDownloadEvents();
  List<SyncFile> uploadingSyncFiles=SyncFileService.findSyncFiles(syncAccountId,SyncFile.UI_EVENT_UPLOADING,"size",true);
  for (  SyncFile uploadingSyncFile : uploadingSyncFiles) {
    Path filePath=Paths.get(uploadingSyncFile.getFilePathName());
    if (Files.notExists(filePath)) {
      if (uploadingSyncFile.getTypePK() == 0) {
        SyncFileService.deleteSyncFile(uploadingSyncFile,false);
      }
      continue;
    }
    if (uploadingSyncFile.isFolder()) {
      if (uploadingSyncFile.getTypePK() > 0) {
        updateFolder(filePath,uploadingSyncFile.getSyncAccountId(),uploadingSyncFile);
      }
 else {
        addFolder(uploadingSyncFile.getParentFolderId(),uploadingSyncFile.getRepositoryId(),syncAccountId,uploadingSyncFile.getName(),uploadingSyncFile);
      }
      continue;
    }
    String checksum=FileUtil.getChecksum(filePath);
    uploadingSyncFile.setChecksum(checksum);
    uploadingSyncFile.setSize(Files.size(filePath));
    SyncFileService.update(uploadingSyncFile);
    IODeltaUtil.checksums(uploadingSyncFile);
    if (uploadingSyncFile.getTypePK() > 0) {
      updateFile(filePath,syncAccountId,uploadingSyncFile,null,uploadingSyncFile.getName(),"",null,0,checksum);
    }
 else {
      addFile(filePath,uploadingSyncFile.getParentFolderId(),uploadingSyncFile.getRepositoryId(),syncAccountId,checksum,uploadingSyncFile.getName(),uploadingSyncFile.getMimeType(),uploadingSyncFile);
    }
  }
  List<SyncFile> movingSyncFiles=SyncFileService.findSyncFiles(syncAccountId,SyncFile.UI_EVENT_MOVED_LOCAL,"syncFileId",true);
  for (  SyncFile movingSyncFile : movingSyncFiles) {
    if (movingSyncFile.isFolder()) {
      moveFolder(movingSyncFile.getParentFolderId(),syncAccountId,movingSyncFile);
    }
 else {
      moveFile(movingSyncFile.getParentFolderId(),syncAccountId,movingSyncFile);
    }
  }
  BatchEventManager.fireBatchEvents();
}
