{
  if (sacpEntryPersistence.fetchByC_N(companyId,name) != null) {
    throw new DuplicateSACPEntryNameException();
  }
  User user=userLocalService.getUserById(userId);
  long sacpEntryId=counterLocalService.increment();
  SACPEntry sacpEntry=sacpEntryPersistence.create(sacpEntryId);
  sacpEntry.setUuid(serviceContext.getUuid());
  sacpEntry.setCompanyId(companyId);
  sacpEntry.setUserId(userId);
  sacpEntry.setUserName(user.getFullName());
  sacpEntry.setAllowedServices(allowedServices);
  sacpEntry.setName(name);
  sacpEntry.setTitleMap(titleMap);
  sacpEntryPersistence.update(sacpEntry,serviceContext);
  if (serviceContext.isAddGroupPermissions() || serviceContext.isAddGuestPermissions()) {
    addSACPEntryResources(sacpEntry,serviceContext.isAddGroupPermissions(),serviceContext.isAddGuestPermissions());
  }
 else {
    addSACPEntryResources(sacpEntry,serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions());
  }
  return sacpEntry;
}
