{
  if (name != null) {
    name=name.trim();
  }
  validate(name,titleMap);
  User user=userPersistence.findByPrimaryKey(userId);
  if (sacpEntryPersistence.fetchByC_N(user.getCompanyId(),name) != null) {
    throw new DuplicateSACPEntryNameException();
  }
  long sacpEntryId=counterLocalService.increment();
  SACPEntry sacpEntry=sacpEntryPersistence.create(sacpEntryId);
  sacpEntry.setUuid(serviceContext.getUuid());
  sacpEntry.setCompanyId(user.getCompanyId());
  sacpEntry.setUserId(userId);
  sacpEntry.setUserName(user.getFullName());
  sacpEntry.setAllowedServices(allowedServices);
  sacpEntry.setName(name);
  sacpEntry.setTitleMap(titleMap);
  sacpEntryPersistence.update(sacpEntry,serviceContext);
  resourceLocalService.addResources(sacpEntry.getCompanyId(),0,userId,SACPEntry.class.getName(),sacpEntry.getSacpEntryId(),false,false,false);
  return sacpEntry;
}
