{
  Indexer<JournalArticle> indexer=Mockito.mock(Indexer.class);
  Mockito.doThrow(IllegalArgumentException.class).when(indexer).getSummary((Document)Matchers.any(),Matchers.anyString(),(PortletRequest)Matchers.any(),(PortletResponse)Matchers.any());
  stub(method(IndexerRegistryUtil.class,"getIndexer",String.class)).toReturn(indexer);
  Document document=createDocument();
  try (CaptureHandler captureHandler=JDKLoggerTestUtil.configureJDKLogger(SearchResultUtil.class.getName(),Level.WARNING)){
    SearchResult searchResult=assertOneSearchResult(document);
    assertSearchResult(searchResult);
    Assert.assertNull(searchResult.getSummary());
    Mockito.verify(indexer).getSummary(document,StringPool.BLANK,null,null);
    List<LogRecord> logRecords=captureHandler.getLogRecords();
    Assert.assertEquals(1,logRecords.size());
    LogRecord logRecord=logRecords.get(0);
    Assert.assertEquals("Search index is stale and contains entry {" + document.get(Field.ENTRY_CLASS_PK) + "}",logRecord.getMessage());
  }
 }
