{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(PortletKeys.ASSET_PUBLISHER);
  AssetVocabulary assetVocabulary=AssetTestUtil.addVocabulary(TestPropsValues.getGroupId());
  AssetCategory assetCategory=AssetTestUtil.addCategory(TestPropsValues.getGroupId(),assetVocabulary.getVocabularyId());
  _portletDataContext.addReferenceElement(portlet,_portletDataContext.getExportDataRootElement(),assetCategory,PortletDataContext.REFERENCE_TYPE_DEPENDENCY,true);
  Element missingReferencesElement=_portletDataContext.getMissingReferencesElement();
  List<Element> missingReferenceElements=missingReferencesElement.elements();
  Assert.assertFalse(missingReferenceElements.isEmpty());
  Assert.assertEquals(1,missingReferenceElements.size());
  StagedModelDataHandlerUtil.exportStagedModel(_portletDataContext,assetCategory);
  missingReferenceElements=missingReferencesElement.elements();
  Assert.assertTrue(missingReferenceElements.isEmpty());
}
