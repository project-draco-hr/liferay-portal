{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  ConfigurationModelToDDMFormConverter configurationModelToDDMFormConverter=new ConfigurationModelToDDMFormConverter(configurationModel,themeDisplay.getLocale());
  DDMForm ddmForm=configurationModelToDDMFormConverter.getDDMForm();
  DDMFormFieldRenderingContext ddmFormFieldRenderingContext=new DDMFormFieldRenderingContext();
  ddmFormFieldRenderingContext.setHttpServletRequest(PortalUtil.getHttpServletRequest(portletRequest));
  ddmFormFieldRenderingContext.setHttpServletResponse(PortalUtil.getHttpServletResponse(portletResponse));
  ddmFormFieldRenderingContext.setLocale(themeDisplay.getLocale());
  ddmFormFieldRenderingContext.setPortletNamespace(portletResponse.getNamespace());
  ddmFormFieldRenderingContext.setReadOnly(false);
  String definition=DDMFormJSONSerializerUtil.serialize(ddmForm);
  if (_log.isDebugEnabled()) {
    _log.debug("DDMForm definition: " + definition);
  }
  portletRequest.setAttribute("definition",definition);
  portletRequest.setAttribute("scopeGroupId",themeDisplay.getScopeGroupId());
  portletRequest.setAttribute("plId",themeDisplay.getPlid());
  return DDMFormRendererUtil.render(ddmForm,ddmFormFieldRenderingContext);
}
