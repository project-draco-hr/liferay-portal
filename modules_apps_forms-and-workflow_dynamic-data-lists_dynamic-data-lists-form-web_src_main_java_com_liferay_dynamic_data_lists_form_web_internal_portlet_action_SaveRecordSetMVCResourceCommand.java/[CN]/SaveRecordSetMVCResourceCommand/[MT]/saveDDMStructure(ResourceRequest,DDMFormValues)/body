{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long ddmStructureId=ParamUtil.getLong(resourceRequest,"ddmStructureId");
  long groupId=ParamUtil.getLong(resourceRequest,"groupId");
  String structureKey=ParamUtil.getString(resourceRequest,"structureKey");
  String storageType=getStorageType(settingsDDMFormValues);
  String name=ParamUtil.getString(resourceRequest,"name");
  String description=ParamUtil.getString(resourceRequest,"description");
  DDMForm ddmForm=getDDMForm(resourceRequest);
  DDMFormLayout ddmFormLayout=getDDMFormLayout(resourceRequest);
  ServiceContext serviceContext=ServiceContextFactory.getInstance(DDMStructure.class.getName(),resourceRequest);
  if (ddmStructureId != 0) {
    return ddmStructureService.updateStructure(ddmStructureId,DDMStructureConstants.DEFAULT_PARENT_STRUCTURE_ID,getLocalizedMap(themeDisplay.getSiteDefaultLocale(),name),getLocalizedMap(themeDisplay.getSiteDefaultLocale(),description),ddmForm,ddmFormLayout,serviceContext);
  }
 else {
    return ddmStructureService.addStructure(groupId,DDMStructureConstants.DEFAULT_PARENT_STRUCTURE_ID,PortalUtil.getClassNameId(DDLRecordSet.class),structureKey,getLocalizedMap(themeDisplay.getSiteDefaultLocale(),name),getLocalizedMap(themeDisplay.getSiteDefaultLocale(),description),ddmForm,ddmFormLayout,storageType,DDMStructureConstants.TYPE_AUTO,serviceContext);
  }
}
