{
  Map<String,Object> response=new HashMap<>();
  try {
    DDMFormValues settingsDDMFormValues=getSettingsDDMFormValues(resourceRequest);
    DDMStructure ddmStructure=saveDDMStructure(resourceRequest,settingsDDMFormValues);
    DDLRecordSet recordSet=saveRecordSet(resourceRequest,ddmStructure.getStructureId());
    updateRecordSetSettings(resourceRequest,recordSet,settingsDDMFormValues);
    response.put("ddmStructureId",ddmStructure.getStructureId());
    response.put("recordSetId",recordSet.getRecordSetId());
  }
 catch (  Exception e) {
    String statusCode=String.valueOf(HttpServletResponse.SC_BAD_REQUEST);
    resourceResponse.setProperty(ResourceResponse.HTTP_STATUS_CODE,statusCode);
    response.put("error",e.getMessage());
  }
  JSONSerializer serializer=jsonFactory.createJSONSerializer();
  PortletResponseUtil.write(resourceResponse,serializer.serializeDeep(response));
}
