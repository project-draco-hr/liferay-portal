{
  User user=PortalUtil.getSelectedUser(actionRequest,false);
  if (user == null) {
    return;
  }
  long groupId=ParamUtil.getLong(actionRequest,"groupId");
  long[] addRoleIds=StringUtil.split(ParamUtil.getString(actionRequest,"addRoleIds"),0L);
  long[] removeRoleIds=StringUtil.split(ParamUtil.getString(actionRequest,"removeRoleIds"),0L);
  if (addRoleIds.length > 0) {
    if (!UserLocalServiceUtil.hasGroupUser(groupId,user.getUserId())) {
      ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
      ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
      long[] userIds=new long[]{user.getUserId()};
      UserServiceUtil.addGroupUsers(groupId,userIds,serviceContext);
      LiveUsers.joinGroup(themeDisplay.getCompanyId(),groupId,userIds);
    }
    UserGroupRoleServiceUtil.addUserGroupRoles(user.getUserId(),groupId,addRoleIds);
  }
  UserGroupRoleServiceUtil.deleteUserGroupRoles(user.getUserId(),groupId,removeRoleIds);
}
