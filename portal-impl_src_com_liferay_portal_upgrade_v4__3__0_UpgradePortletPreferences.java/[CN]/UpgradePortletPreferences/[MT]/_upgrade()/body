{
  DBUtil dbUtil=DBUtil.getInstance();
  dbUtil.executeSQL("delete from PortletPreferences where ownerId = '0' and " + "ownerType = " + PortletKeys.PREFS_OWNER_TYPE_COMPANY);
  ValueMapper companyIdMapper=AvailableMappersUtil.getCompanyIdMapper();
  Iterator itr=companyIdMapper.iterator();
  while (itr.hasNext()) {
    String webId=(String)itr.next();
    Long companyIdObj=(Long)companyIdMapper.getNewValue(webId);
    dbUtil.executeSQL("delete from PortletPreferences where ownerId = '" + companyIdObj.longValue() + "' and ownerType = "+ PortletKeys.PREFS_OWNER_TYPE_COMPANY);
  }
  Object[][] prefsColumns1={{"layoutId",new Integer(Types.VARCHAR)}};
  Object[][] prefsColumns2=(Object[][])PortletPreferencesImpl.TABLE_COLUMNS.clone();
  Object[][] prefsColumns=new Object[prefsColumns1.length + prefsColumns2.length][];
  ArrayUtil.combine(prefsColumns1,prefsColumns2,prefsColumns);
  PrefsOwnerIdUpgradeColumnImpl upgradeOwnerIdColumn=new PrefsOwnerIdUpgradeColumnImpl(AvailableMappersUtil.getGroupIdMapper(),AvailableMappersUtil.getUserIdMapper());
  UpgradeColumn upgradeOwnerTypeColumn=new PrefsOwnerTypeUpgradeColumnImpl(upgradeOwnerIdColumn);
  TempUpgradeColumnImpl upgradeLayoutIdColumn=new TempUpgradeColumnImpl("layoutId");
  UpgradeColumn upgradePlidColumn=new PrefsPlidUpgradeColumnImpl(upgradeOwnerIdColumn,upgradeLayoutIdColumn,AvailableMappersUtil.getLayoutPlidMapper());
  UpgradeTable upgradeTable=new DefaultUpgradeTableImpl(PortletPreferencesImpl.TABLE_NAME,prefsColumns,new PKUpgradeColumnImpl("portletPreferencesId",false),upgradeOwnerIdColumn,upgradeOwnerTypeColumn,upgradeLayoutIdColumn,upgradePlidColumn);
  upgradeTable.updateTable();
  dbUtil.executeSQL(_UPGRADE_SCHEMA);
}
