{
  String tableType="control";
  if (filterByCompanyId) {
    tableType="partitioned";
  }
  String outputFileName=exportContext.getSchemaName() + "-" + companyId+ "-"+ tableType+ ".sql";
  File outputFile=new File(exportContext.getOutputDirName(),outputFileName);
  OutputStream outputStream=null;
  if (!exportContext.isTables()) {
    outputStream=new BufferedOutputStream(new FileOutputStream(outputFile));
  }
  for (  String tableName : tableNames) {
    if (exportContext.isTables()) {
      outputFileName=exportContext.getSchemaName() + "-" + companyId+ "-"+ tableName+ ".sql";
      outputFile=new File(exportContext.getOutputDirName(),outputFileName);
      outputStream=new BufferedOutputStream(new FileOutputStream(outputFile));
    }
    if (filterByCompanyId) {
      _dbExporter.write(companyId,tableName,outputStream);
    }
 else {
      _dbExporter.write(tableName,outputStream);
    }
    outputStream.flush();
    if (exportContext.isTables()) {
      outputStream.close();
    }
  }
  if (!exportContext.isTables()) {
    outputStream.close();
  }
}
