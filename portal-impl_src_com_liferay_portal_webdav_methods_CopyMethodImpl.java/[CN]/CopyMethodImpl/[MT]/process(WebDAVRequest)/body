{
  WebDAVStorage storage=webDAVRequest.getWebDAVStorage();
  HttpServletRequest request=webDAVRequest.getHttpServletRequest();
  long companyId=webDAVRequest.getCompanyId();
  String destination=WebDAVUtil.getDestination(request,storage.getRootPath());
  StringBundler sb=null;
  if (_log.isInfoEnabled()) {
    sb=new StringBundler(8);
    sb.append("Destination is ");
    sb.append(destination);
  }
  if (!destination.equals(webDAVRequest.getPath()) && (WebDAVUtil.getGroupId(companyId,destination) == webDAVRequest.getGroupId())) {
    Resource resource=storage.getResource(webDAVRequest);
    if (resource == null) {
      return HttpServletResponse.SC_NOT_FOUND;
    }
    if (resource.isCollection()) {
      boolean overwrite=WebDAVUtil.isOverwrite(request);
      long depth=WebDAVUtil.getDepth(request);
      if (_log.isInfoEnabled()) {
        sb.append(", overwrite is ");
        sb.append(overwrite);
        sb.append(", depth is ");
        sb.append(depth);
        _log.info(sb.toString());
      }
      return storage.copyCollectionResource(webDAVRequest,resource,destination,overwrite,depth);
    }
    boolean overwrite=WebDAVUtil.isOverwrite(request);
    if (_log.isInfoEnabled()) {
      sb.append(", overwrite is ");
      sb.append(overwrite);
      _log.info(sb.toString());
    }
    return storage.copySimpleResource(webDAVRequest,resource,destination,overwrite);
  }
  return HttpServletResponse.SC_FORBIDDEN;
}
