{
  Date now=new Date();
  List<Lock> locks=lockPersistence.findByUuid_C(uuid,companyId);
  if (locks.isEmpty()) {
    StringBundler sb=new StringBundler(5);
    sb.append("{uuid=");
    sb.append(uuid);
    sb.append(", companyId=");
    sb.append(companyId);
    sb.append("}");
    throw new NoSuchLockException(sb.toString());
  }
  Lock lock=locks.get(0);
  LockListener lockListener=LockListenerRegistryUtil.getLockListener(lock.getClassName());
  String key=lock.getKey();
  if (lockListener != null) {
    lockListener.onBeforeRefresh(key);
  }
  try {
    lock.setCreateDate(now);
    if (expirationTime == 0) {
      lock.setExpirationDate(null);
    }
 else {
      lock.setExpirationDate(new Date(now.getTime() + expirationTime));
    }
    lockPersistence.update(lock);
    return lock;
  }
  finally {
    if (lockListener != null) {
      lockListener.onAfterRefresh(key);
    }
  }
}
