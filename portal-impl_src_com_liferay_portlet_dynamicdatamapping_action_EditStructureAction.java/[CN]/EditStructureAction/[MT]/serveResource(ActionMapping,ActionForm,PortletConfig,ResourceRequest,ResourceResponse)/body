{
  String cmd=ParamUtil.getString(resourceRequest,Constants.CMD);
  if (cmd.equals("fieldHTML")) {
    JspFactory factory=JspFactory.getDefaultFactory();
    Servlet servlet=getServlet();
    HttpServletRequest httpServletRequest=PortalUtil.getHttpServletRequest(resourceRequest);
    HttpServletResponse httpServletResponse=PortalUtil.getHttpServletResponse(resourceResponse);
    PageContext pageContext=factory.getPageContext(servlet,httpServletRequest,httpServletResponse,null,true,JspWriter.DEFAULT_BUFFER,true);
    String className=ParamUtil.getString(resourceRequest,"className");
    long classPK=ParamUtil.getLong(resourceRequest,"classPK");
    String fieldName=ParamUtil.getString(resourceRequest,"fieldName");
    boolean readOnly=ParamUtil.getBoolean(resourceRequest,"readOnly");
    String repeatableIndex=ParamUtil.getString(resourceRequest,"repeatableIndex");
    Locale locale=PortalUtil.getLocale(httpServletRequest);
    String xPathExpression="dynamic-element[@name=".concat(HtmlUtil.escapeXPathAttribute(fieldName)).concat("]");
    XPath xPathSelector=SAXReaderUtil.createXPath(xPathExpression);
    String xsd=DDMXSDUtil.getXSD(className,classPK);
    Document document=SAXReaderUtil.read(xsd);
    Node node=xPathSelector.selectSingleNode(document.getRootElement());
    Element fieldElement=(Element)node.asXPathResult(node.getParent());
    if (Validator.isNotNull(repeatableIndex)) {
      fieldElement.addAttribute("repeatableIndex",repeatableIndex);
    }
    String fieldHTML=DDMXSDUtil.getFieldHTML(pageContext,fieldElement,null,null,null,readOnly,locale);
    resourceResponse.setContentType(ContentTypes.TEXT_HTML);
    PortletResponseUtil.write(resourceResponse,fieldHTML);
  }
}
