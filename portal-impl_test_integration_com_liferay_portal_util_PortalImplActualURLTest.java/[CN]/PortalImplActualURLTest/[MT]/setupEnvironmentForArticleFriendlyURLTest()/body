{
  ServiceContext serviceContext=ServiceTestUtil.getServiceContext();
  _testSite=GroupLocalServiceUtil.addGroup(serviceContext.getUserId(),GroupConstants.DEFAULT_PARENT_GROUP_ID,null,0,"Test",StringPool.BLANK,GroupConstants.TYPE_SITE_OPEN,"/testsite",true,true,ServiceTestUtil.getServiceContext());
  _homePage=LayoutLocalServiceUtil.addLayout(serviceContext.getUserId(),_testSite.getGroupId(),false,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID,"home","Home",StringPool.BLANK,LayoutConstants.TYPE_PORTLET,false,"/home",ServiceTestUtil.getServiceContext());
  _testPage=LayoutLocalServiceUtil.addLayout(serviceContext.getUserId(),_testSite.getGroupId(),false,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID,"testpage","TestPage",StringPool.BLANK,LayoutConstants.TYPE_PORTLET,false,"/testpage",ServiceTestUtil.getServiceContext());
  String portletId=PortletKeys.ASSET_PUBLISHER;
  LayoutTypePortlet layoutTypePortlet=LayoutTypePortletFactoryUtil.create(_testPage);
  String columnId="column-1";
  int columnPos=0;
  portletId=layoutTypePortlet.addPortletId(serviceContext.getUserId(),portletId,columnId,columnPos);
  layoutTypePortlet.resetModes();
  layoutTypePortlet.resetStates();
  _testPage=LayoutServiceUtil.updateLayout(_testPage.getGroupId(),_testPage.isPrivateLayout(),_testPage.getLayoutId(),_testPage.getTypeSettings());
  Map<Locale,String> titleMap=new HashMap<Locale,String>();
  Locale englishLocale=new Locale("en","US");
  titleMap.put(englishLocale,"ExistingArticle");
  Map<Locale,String> descriptionMap=new HashMap<Locale,String>();
  StringBundler sb=new StringBundler();
  sb.append("<?xml version=\"1.0\"?><root available-locales=");
  sb.append("\"en_US\" default-locale=\"en_US\">");
  sb.append("<static-content language-id=\"en_US\"><![CDATA[<p>");
  sb.append("This is the test content in English");
  sb.append("</p>]]>");
  sb.append("</static-content></root>");
  _article=JournalArticleLocalServiceUtil.addArticle(serviceContext.getUserId(),_testSite.getGroupId(),0,0,0,StringPool.BLANK,true,1,titleMap,descriptionMap,sb.toString(),"general",null,null,_testPage.getUuid(),1,1,1965,0,0,0,0,0,0,0,true,0,0,0,0,0,true,false,false,null,null,null,"/existingarticle",serviceContext);
  UnicodeProperties typeSettingsProperties=_testPage.getTypeSettingsProperties();
  typeSettingsProperties.setProperty(LayoutTypePortletConstants.DEFAULT_ASSET_PUBLISHER_PORTLET_ID,portletId);
  _testPage.setTypeSettingsProperties(typeSettingsProperties);
  LayoutLocalServiceUtil.updateLayout(_testPage);
}
