{
  template.prepare(request);
  Writer writer=new UnsyncStringWriter();
  TemplateHashModel portalTaglib=FreeMarkerTaglibFactoryUtil.createTaglibFactory(request.getServletContext());
  template.put("PortalJspTagLibs",portalTaglib);
  GenericServlet genericServlet=new JSPSupportServlet(request.getServletContext());
  ServletContextHashModel servletContextHashModel=new ServletContextHashModel(genericServlet,ObjectWrapper.DEFAULT_WRAPPER);
  template.put("Application",servletContextHashModel);
  HttpRequestHashModel httpRequestHashModel=new HttpRequestHashModel(request,response,ObjectWrapper.DEFAULT_WRAPPER);
  template.put("Request",httpRequestHashModel);
  template.processTemplate(writer);
  return writer.toString();
}
