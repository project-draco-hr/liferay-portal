{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (!_PORTLET_ADD_DEFAULT_RESOURCE_CHECK_ENABLED) {
    return;
  }
  if (!themeDisplay.isLifecycleRender()) {
    return;
  }
  String portletId=ParamUtil.getString(request,"p_p_id");
  if (Validator.isNull(portletId)) {
    return;
  }
  if (!portletId.equals(PortletKeys.KNOWLEDGE_BASE_ARTICLE_DEFAULT_INSTANCE)) {
    return;
  }
  String request_p_p_auth=ParamUtil.getString(request,"p_p_auth");
  if (Validator.isNull(request_p_p_auth)) {
    return;
  }
  String actual_p_p_auth=AuthTokenUtil.getToken(request,themeDisplay.getPlid(),portletId);
  if (request_p_p_auth.equals(actual_p_p_auth)) {
    return;
  }
  String redirect=HttpUtil.setParameter(themeDisplay.getURLCurrent(),"p_p_auth",actual_p_p_auth);
  response.sendRedirect(redirect);
}
