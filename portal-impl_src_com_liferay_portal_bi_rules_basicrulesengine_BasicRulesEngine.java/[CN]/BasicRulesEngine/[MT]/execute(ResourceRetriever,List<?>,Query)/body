{
  if (Validator.isNull(facts) || facts.size() != 1 || !(facts.get(0) instanceof BasicFact)) {
    throw new RulesEngineException("Invalid facts");
  }
  BasicFact basicFact=(BasicFact)facts.get(0);
  Reader reader=new InputStreamReader(resourceRetriever.getInputStream());
  BasicRulesLexer lexer=new BasicRulesLexer(reader);
  BasicRulesParser parser=new BasicRulesParser(lexer);
  BasicRulesTreeParser tree=new BasicRulesTreeParser();
  tree.setRuleFactory(new RuleFactory());
  try {
    parser.expr();
    AST ast=parser.getAST();
    Rule rule=tree.evaluate(ast);
    boolean result=rule.evaluate(basicFact);
    basicFact.setQualified(result);
  }
 catch (  TokenStreamException ex) {
    if (_log.isDebugEnabled()) {
      _log.debug(ex);
    }
    basicFact.setQualified(false);
  }
catch (  RecognitionException ex) {
    if (_log.isDebugEnabled()) {
      _log.debug(ex);
    }
    basicFact.setQualified(false);
  }
  return facts;
}
