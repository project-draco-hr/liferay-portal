{
  MBMessage message=(MBMessage)obj;
  long companyId=message.getCompanyId();
  long groupId=getParentGroupId(message.getGroupId());
  long scopeGroupId=message.getGroupId();
  long userId=message.getUserId();
  String userName=PortalUtil.getUserName(userId,message.getUserName());
  long categoryId=message.getCategoryId();
  long threadId=message.getThreadId();
  long messageId=message.getMessageId();
  String title=message.getSubject();
  String content=processContent(messageId,message.getBody());
  boolean anonymous=message.isAnonymous();
  Date modifiedDate=message.getModifiedDate();
  long status=message.getStatus();
  String[] assetTagNames=AssetTagLocalServiceUtil.getTagNames(MBMessage.class.getName(),messageId);
  ExpandoBridge expandoBridge=message.getExpandoBridge();
  Document document=new DocumentImpl();
  document.addUID(PORTLET_ID,messageId);
  document.addModifiedDate(modifiedDate);
  document.addKeyword(Field.COMPANY_ID,companyId);
  document.addKeyword(Field.PORTLET_ID,PORTLET_ID);
  document.addKeyword(Field.GROUP_ID,groupId);
  document.addKeyword(Field.SCOPE_GROUP_ID,scopeGroupId);
  document.addKeyword(Field.USER_ID,userId);
  if (!anonymous) {
    document.addText(Field.USER_NAME,userName);
  }
  document.addKeyword(Field.TITLE,title,true);
  document.addKeyword(Field.CONTENT,content,true);
  document.addKeyword(Field.ASSET_TAG_NAMES,assetTagNames);
  document.addKeyword(Field.CATEGORY_ID,categoryId);
  document.addKeyword(Field.ENTRY_CLASS_NAME,MBMessage.class.getName());
  document.addKeyword(Field.ENTRY_CLASS_PK,messageId);
  document.addKeyword(Field.ROOT_ENTRY_CLASS_PK,message.getRootMessageId());
  document.addKeyword("threadId",threadId);
  document.addKeyword(Field.STATUS,status);
  ExpandoBridgeIndexerUtil.addAttributes(document,expandoBridge);
  return document;
}
