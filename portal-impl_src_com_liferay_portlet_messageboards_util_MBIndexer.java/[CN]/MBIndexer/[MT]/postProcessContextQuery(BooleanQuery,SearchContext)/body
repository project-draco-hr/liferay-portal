{
  long threadId=GetterUtil.getLong((String)searchContext.getAttribute("threadId"));
  if (threadId > 0) {
    contextQuery.addRequiredTerm("threadId",threadId);
  }
  long[] categoryIds=searchContext.getCategoryIds();
  if (categoryIds != null && categoryIds.length > 0) {
    if ((categoryIds.length == 1) && (categoryIds[0] == MBCategoryConstants.DEFAULT_PARENT_CATEGORY_ID)) {
      return;
    }
    BooleanQuery categoriesQuery=BooleanQueryFactoryUtil.create();
    for (    long categoryId : categoryIds) {
      try {
        MBCategoryServiceUtil.getCategory(categoryId);
      }
 catch (      Exception e) {
        continue;
      }
      categoriesQuery.addTerm(Field.CATEGORY_ID,categoryId);
    }
    contextQuery.add(categoriesQuery,BooleanClauseOccur.MUST);
  }
}
