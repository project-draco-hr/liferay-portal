{
  int buildNumber=getBuildNumber();
  StringBundler sb=new StringBundler(3);
  sb.append("select table_name, column_name, data_length from ");
  sb.append("user_tab_columns where data_type = 'VARCHAR2' and ");
  sb.append("char_used = 'B'");
  try (Connection con=DataAccess.getUpgradeOptimizedConnection();PreparedStatement ps=con.prepareStatement(sb.toString());ResultSet rs=ps.executeQuery()){
    while (rs.next()) {
      String tableName=rs.getString(1);
      if (!isPortalTableName(tableName)) {
        continue;
      }
      String columnName=rs.getString(2);
      int dataLength=rs.getInt(3);
      if (isBetweenBuildNumbers(buildNumber,ReleaseInfo.RELEASE_5_2_9_BUILD_NUMBER,ReleaseInfo.RELEASE_6_0_0_BUILD_NUMBER) || isBetweenBuildNumbers(buildNumber,ReleaseInfo.RELEASE_6_0_5_BUILD_NUMBER,ReleaseInfo.RELEASE_6_1_20_BUILD_NUMBER)) {
        if (!ArrayUtil.contains(_ORIGINAL_DATA_LENGTH_VALUES,dataLength)) {
          dataLength=dataLength / 4;
        }
      }
      try {
        runSQL(con,"alter table " + tableName + " modify "+ columnName+ " varchar2("+ dataLength+ " char)");
      }
 catch (      SQLException sqle) {
        if (sqle.getErrorCode() == 1441) {
          if (_log.isWarnEnabled()) {
            StringBundler warn=new StringBundler(6);
            warn.append("Unable to alter length of column ");
            warn.append(columnName);
            warn.append(" for table ");
            warn.append(tableName);
            warn.append(" because it contains values that are");
            warn.append(" larger than the new column length");
            _log.warn(warn.toString());
          }
        }
 else {
          throw sqle;
        }
      }
    }
  }
 }
