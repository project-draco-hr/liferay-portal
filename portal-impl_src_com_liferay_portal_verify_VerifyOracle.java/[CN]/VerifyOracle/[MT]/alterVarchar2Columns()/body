{
  int buildNumber=getBuildNumber();
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getUpgradeOptimizedConnection();
    ps=con.prepareStatement("select table_name, column_name, data_length from " + "user_tab_columns where data_type = 'VARCHAR2' and " + "char_used = 'B'");
    rs=ps.executeQuery();
    while (rs.next()) {
      String tableName=rs.getString(1);
      if (!isPortalTableName(tableName)) {
        continue;
      }
      String columnName=rs.getString(2);
      int dataLength=rs.getInt(3);
      if (isBetweenBuildNumbers(buildNumber,ReleaseInfo.RELEASE_5_2_9_BUILD_NUMBER,ReleaseInfo.RELEASE_6_0_0_BUILD_NUMBER) || isBetweenBuildNumbers(buildNumber,ReleaseInfo.RELEASE_6_0_5_BUILD_NUMBER,ReleaseInfo.RELEASE_6_1_20_BUILD_NUMBER)) {
        if (!ArrayUtil.contains(_ORIGINAL_DATA_LENGTH_VALUES,dataLength)) {
          dataLength=dataLength / 4;
        }
      }
      try {
        runSQL(con,"alter table " + tableName + " modify "+ columnName+ " varchar2("+ dataLength+ " char)");
      }
 catch (      SQLException sqle) {
        if (sqle.getErrorCode() == 1441) {
          if (_log.isWarnEnabled()) {
            StringBundler sb=new StringBundler(6);
            sb.append("Unable to alter length of column ");
            sb.append(columnName);
            sb.append(" for table ");
            sb.append(tableName);
            sb.append(" because it contains values that are ");
            sb.append("larger than the new column length");
            _log.warn(sb.toString());
          }
        }
 else {
          throw sqle;
        }
      }
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
