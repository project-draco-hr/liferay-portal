{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  TimeZone timeZone=getTimeZone(resourceRequest);
  long calendarBookingId=ParamUtil.getLong(resourceRequest,"calendarBookingId");
  CalendarBooking calendarBooking=_calendarBookingService.fetchCalendarBooking(calendarBookingId);
  long calendarId=ParamUtil.getLong(resourceRequest,"calendarId");
  Calendar calendar=_calendarService.getCalendar(calendarId);
  long[] childCalendarIds={};
  Map<Locale,String> titleMap=new HashMap<>();
  Map<Locale,String> descriptionMap=new HashMap<>();
  String location=null;
  java.util.Calendar startTimeJCalendar=getJCalendar(resourceRequest,"startTime");
  java.util.Calendar endTimeJCalendar=getJCalendar(resourceRequest,"endTime");
  boolean allDay=ParamUtil.getBoolean(resourceRequest,"allDay");
  Recurrence recurrence=RecurrenceSerializer.deserialize(ParamUtil.getString(resourceRequest,"recurrence"),timeZone);
  long[] reminders={0,0};
  String[] remindersType={"email","email"};
  int instanceIndex=ParamUtil.getInteger(resourceRequest,"instanceIndex");
  boolean updateInstance=ParamUtil.getBoolean(resourceRequest,"updateInstance");
  boolean allFollowing=ParamUtil.getBoolean(resourceRequest,"allFollowing");
  if (calendarBooking != null) {
    childCalendarIds=_calendarBookingLocalService.getChildCalendarIds(calendarBookingId,calendarId);
    titleMap=calendarBooking.getTitleMap();
    descriptionMap=calendarBooking.getDescriptionMap();
    location=calendarBooking.getLocation();
    reminders=new long[]{calendarBooking.getFirstReminder(),calendarBooking.getSecondReminder()};
    remindersType=new String[]{calendarBooking.getFirstReminderType(),calendarBooking.getSecondReminderType()};
  }
  String title=ParamUtil.getString(resourceRequest,"title");
  titleMap.put(themeDisplay.getLocale(),title);
  ServiceContext serviceContext=ServiceContextFactory.getInstance(CalendarBooking.class.getName(),resourceRequest);
  calendarBooking=updateCalendarBooking(calendarBookingId,calendar,childCalendarIds,titleMap,descriptionMap,location,startTimeJCalendar.getTimeInMillis(),endTimeJCalendar.getTimeInMillis(),allDay,recurrence,reminders,remindersType,instanceIndex,updateInstance,allFollowing,serviceContext);
  JSONObject jsonObject=CalendarUtil.toCalendarBookingJSONObject(themeDisplay,calendarBooking,timeZone);
  writeJSON(resourceRequest,resourceResponse,jsonObject);
}
