{
  InternetAddress[] auditTrail=InternetAddress.parse(PropsValues.MAIL_AUDIT_TRAIL);
  if (auditTrail.length > 0) {
    InternetAddress[] bcc=mailMessage.getBCC();
    if (bcc != null) {
      InternetAddress[] allBCC=new InternetAddress[bcc.length + auditTrail.length];
      ArrayUtil.combine(bcc,auditTrail,allBCC);
      mailMessage.setBCC(allBCC);
    }
 else {
      mailMessage.setBCC(auditTrail);
    }
  }
  if (getInternetAddress(mailMessage.getFrom()) == null) {
    return;
  }
  boolean sendMail=false;
  InternetAddress[] to=getInternetAddresses(mailMessage.getTo());
  if (to != null) {
    if (mailMessage.getTo().length > to.length) {
      mailMessage.setTo(to);
    }
    sendMail=true;
  }
 else {
    mailMessage.setTo(to);
  }
  InternetAddress[] cc=getInternetAddresses(mailMessage.getCC());
  if (cc != null) {
    if (mailMessage.getCC().length > cc.length) {
      mailMessage.setCC(cc);
    }
    sendMail=true;
  }
 else {
    mailMessage.setCC(cc);
  }
  InternetAddress[] bcc=getInternetAddresses(mailMessage.getBCC());
  if (bcc != null) {
    if (mailMessage.getBCC().length > bcc.length) {
      mailMessage.setBCC(bcc);
    }
    sendMail=true;
  }
 else {
    mailMessage.setBCC(bcc);
  }
  InternetAddress[] bulkAddresses=getInternetAddresses(mailMessage.getBulkAddresses());
  if (bulkAddresses != null) {
    if (mailMessage.getBulkAddresses().length > bulkAddresses.length) {
      mailMessage.setBulkAddresses(bulkAddresses);
    }
    sendMail=true;
  }
 else {
    mailMessage.setBulkAddresses(bulkAddresses);
  }
  if (sendMail) {
    MailEngine.send(mailMessage);
  }
}
