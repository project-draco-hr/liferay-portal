{
  DLFileEntry dlFileEntry=DLFileEntryLocalServiceUtil.getDLFileEntry(fileEntryId);
  boolean checkedOut=dlFileEntry.isCheckedOut();
  DLFileVersion dlFileVersion=DLFileVersionLocalServiceUtil.getLatestFileVersion(fileEntryId,!checkedOut);
  boolean autoCheckIn=!checkedOut && dlFileVersion.isApproved();
  int workflowAction=serviceContext.getWorkflowAction();
  if (!autoCheckIn && !checkedOut && (workflowAction == WorkflowConstants.ACTION_PUBLISH)) {
    return dlFileVersion;
  }
 else {
    return null;
  }
}
