{
  long recordId=ParamUtil.getLong(request,"recordId");
  DDLRecord record=DDLRecordLocalServiceUtil.getRecord(recordId);
  String fieldName=ParamUtil.getString(request,"fieldName");
  InputStream inputStream=null;
  try {
    UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(request);
    inputStream=uploadPortletRequest.getFileAsStream(fieldName,true);
    ServiceContext serviceContext=ServiceContextFactory.getInstance(DDLRecord.class.getName(),request);
    DDLUtil.uploadRecordFieldFile(record,fieldName,inputStream,uploadPortletRequest,serviceContext);
  }
  finally {
    StreamUtil.cleanUp(inputStream);
  }
  String fieldValue=String.valueOf(record.getFieldValue(fieldName));
  return JSONFactoryUtil.createJSONObject(fieldValue);
}
