{
  UnicodeProperties settingsProperties=new UnicodeProperties();
  boolean multiValued=ParamUtil.getBoolean(actionRequest,"multiValued");
  settingsProperties.setProperty("multiValued",String.valueOf(multiValued));
  int[] indexes=StringUtil.split(ParamUtil.getString(actionRequest,"indexes"),0);
  Set<Long> selectedClassNameIds=new HashSet<Long>();
  Set<Long> requiredClassNameIds=new HashSet<Long>();
  for (  int index : indexes) {
    long classNameId=ParamUtil.getLong(actionRequest,"classNameId" + index);
    boolean required=ParamUtil.getBoolean(actionRequest,"required" + index);
    if (classNameId == 0) {
      selectedClassNameIds.clear();
      selectedClassNameIds.add(classNameId);
      if (required) {
        requiredClassNameIds.clear();
        requiredClassNameIds.add(classNameId);
      }
      break;
    }
 else {
      selectedClassNameIds.add(classNameId);
      if (required) {
        requiredClassNameIds.add(classNameId);
      }
    }
  }
  settingsProperties.setProperty("selectedClassNameIds",StringUtil.merge(selectedClassNameIds));
  settingsProperties.setProperty("requiredClassNameIds",StringUtil.merge(requiredClassNameIds));
  return settingsProperties;
}
