{
  PluginPackage pluginPackage=null;
  String servletContextName=ctx.getServletContextName();
  String xml=Http.URLtoString(ctx.getResource("/WEB-INF/liferay-plugin-package.xml"));
  if (xml == null) {
    Attributes attributes=null;
    InputStream is=ctx.getResourceAsStream("/META-INF/MANIFEST.MF");
    if (is != null) {
      Manifest manifest=new Manifest(is);
      attributes=manifest.getMainAttributes();
    }
 else {
      attributes=new Attributes();
    }
    String artifactGroupId=attributes.getValue("Implementation-Vendor-Id");
    if (Validator.isNull(artifactGroupId)) {
      artifactGroupId=attributes.getValue("Implementation-Vendor");
    }
    if (Validator.isNull(artifactGroupId)) {
      artifactGroupId=GetterUtil.getString(attributes.getValue("Bundle-Vendor"),servletContextName);
    }
    String artifactId=attributes.getValue("Implementation-Title");
    if (Validator.isNull(artifactId)) {
      artifactId=GetterUtil.getString(attributes.getValue("Bundle-Name"),servletContextName);
    }
    String version=attributes.getValue("Implementation-Version");
    if (Validator.isNull(version)) {
      version=GetterUtil.getString(attributes.getValue("Bundle-Version"),Version.UNKNOWN);
    }
    if (version == Version.UNKNOWN && _log.isWarnEnabled()) {
      _log.warn("Plugin package on context " + servletContextName + " cannot be tracked because this WAR does not "+ "contain a liferay-plugin-package.xml file");
    }
    pluginPackage=new PluginPackageImpl(artifactGroupId + StringPool.SLASH + artifactId+ StringPool.SLASH+ version+ StringPool.SLASH+ "war");
    pluginPackage.setName(artifactId);
    String shortDescription=attributes.getValue("Bundle-Description");
    if (Validator.isNotNull(shortDescription)) {
      pluginPackage.setShortDescription(shortDescription);
    }
    String pageURL=attributes.getValue("Bundle-DocURL");
    if (Validator.isNotNull(pageURL)) {
      pluginPackage.setPageURL(pageURL);
    }
    return pluginPackage;
  }
  if (_log.isInfoEnabled()) {
    if (servletContextName == null) {
      _log.info("Reading plugin package for the root context");
    }
 else {
      _log.info("Reading plugin package for " + servletContextName);
    }
  }
  pluginPackage=PluginPackageUtil.readPluginPackageXml(xml);
  return pluginPackage;
}
