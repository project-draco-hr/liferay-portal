{
  Field implField=ReflectionUtil.getDeclaredField(Socket.class,"impl");
  SocketImpl oldSocketImpl=(SocketImpl)implField.get(socket);
  if (socketImpl == null) {
    Socket unbindSocket=new Socket();
    socketImpl=(SocketImpl)implField.get(unbindSocket);
    Field cmdsockField=ReflectionUtil.getDeclaredField(socketImpl.getClass(),"cmdsock");
    cmdsockField.set(socketImpl,new Socket(){
      @Override public synchronized void close() throws IOException {
        throw new IOException();
      }
    }
);
  }
  implField.set(socket,socketImpl);
  return oldSocketImpl;
}
