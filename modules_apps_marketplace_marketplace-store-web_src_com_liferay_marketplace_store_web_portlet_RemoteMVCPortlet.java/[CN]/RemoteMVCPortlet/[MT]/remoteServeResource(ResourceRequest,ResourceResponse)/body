{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  OAuthRequest oAuthRequest=new OAuthRequest(Verb.GET,getServerPortletURL());
  setRequestParameters(resourceRequest,resourceResponse,oAuthRequest);
  addOAuthParameter(oAuthRequest,"p_p_lifecycle","2");
  addOAuthParameter(oAuthRequest,"p_p_resource_id",resourceRequest.getResourceID());
  Response response=getResponse(themeDisplay.getUser(),oAuthRequest);
  String contentType=response.getHeader(HttpHeaders.CONTENT_TYPE);
  if (contentType.startsWith(ContentTypes.APPLICATION_OCTET_STREAM)) {
    String contentDisposition=response.getHeader(HttpHeaders.CONTENT_DISPOSITION);
    int contentLength=GetterUtil.getInteger(response.getHeader(HttpHeaders.CONTENT_LENGTH));
    PortletResponseUtil.sendFile(resourceRequest,resourceResponse,getFileName(contentDisposition),response.getStream(),contentLength,contentType,HttpHeaders.CONTENT_DISPOSITION_ATTACHMENT);
  }
 else {
    PortletResponseUtil.write(resourceResponse,response.getStream());
  }
}
