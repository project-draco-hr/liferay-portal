{
  User user=getUser();
  String cartId=user.getUserId();
  ShoppingCart cart=null;
  Date now=new Date();
  try {
    cart=ShoppingCartUtil.findByPrimaryKey(cartId);
  }
 catch (  NoSuchCartException nsce) {
    cart=ShoppingCartUtil.create(cartId);
    cart.setCompanyId(user.getCompanyId());
    cart.setUserId(user.getUserId());
    cart.setCreateDate(now);
  }
  cart.setModifiedDate(now);
  cart.setItemIds(_checkItemIds(user.getCompanyId(),itemIds));
  cart.setCouponIds(couponIds);
  cart.setAltShipping(altShipping);
  cart.setInsure(insure);
  ShoppingCartUtil.update(cart);
  return cart;
}
