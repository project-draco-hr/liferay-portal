{
  if (el.elements().size() > 0) {
    List<Element> children=el.elements();
    List<Element> originals=new ArrayList<Element>();
    List<Element> duplicates=new ArrayList<Element>();
    for (int i=0; i < children.size(); i++) {
      Element child=children.get(i);
      if (_containsObjectEqualTo(child,originals,comparator)) {
        if (_descriptor.canJoinChildren(child)) {
          Element first=_findObjectEqualTo(child,originals,comparator);
          Collection<Element> childrenToJoin=child.elements();
          _addChildren(first,childrenToJoin);
        }
        duplicates.add(child);
      }
 else {
        originals.add(child);
      }
    }
    for (    Element duplicate : duplicates) {
      duplicate.detach();
    }
    for (    Element child : originals) {
      _mergeDuplicateElements(child,comparator);
    }
  }
}
