{
  User user=userPersistence.findByPrimaryKey(serviceContext.getUserId());
  LayoutSetBranch layoutSetBranch=layoutSetBranchPersistence.findByPrimaryKey(layoutSetBranchId);
  validate(0,layoutSetBranchId,plid,name);
  long layoutBranchId=counterLocalService.increment();
  LayoutBranch layoutBranch=layoutBranchPersistence.create(layoutBranchId);
  layoutBranch.setGroupId(layoutSetBranch.getGroupId());
  layoutBranch.setCompanyId(user.getCompanyId());
  layoutBranch.setUserId(user.getUserId());
  layoutBranch.setUserName(user.getFullName());
  layoutBranch.setLayoutSetBranchId(layoutSetBranchId);
  layoutBranch.setPlid(plid);
  layoutBranch.setName(name);
  layoutBranch.setDescription(description);
  layoutBranch.setMaster(master);
  layoutBranchPersistence.update(layoutBranch);
  resourceLocalService.addResources(layoutBranch.getCompanyId(),layoutBranch.getGroupId(),layoutBranch.getUserId(),LayoutBranch.class.getName(),layoutBranch.getLayoutBranchId(),false,true,false);
  StagingUtil.setRecentLayoutBranchId(user,layoutBranch.getLayoutSetBranchId(),layoutBranch.getPlid(),layoutBranch.getLayoutBranchId());
  return layoutBranch;
}
