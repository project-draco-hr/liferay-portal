{
  User user=userLocalService.getUserById(serviceContext.getUserId());
  validate(serviceContext.getScopeGroupId(),name);
  long branchId=counterLocalService.increment();
  LayoutBranch branch=layoutBranchPersistence.create(branchId);
  Date now=new Date();
  branch.setGroupId(serviceContext.getScopeGroupId());
  branch.setCompanyId(user.getCompanyId());
  branch.setUserId(user.getUserId());
  branch.setUserName(user.getFullName());
  branch.setCreateDate(serviceContext.getCreateDate(now));
  branch.setModifiedDate(serviceContext.getModifiedDate(now));
  branch.setName(name);
  branch.setDescription(description);
  layoutBranchPersistence.update(branch,false);
  resourceLocalService.addResources(user.getCompanyId(),branch.getGroupId(),user.getUserId(),LayoutBranch.class.getName(),branch.getBranchId(),false,true,false);
  if (branch.getName().equals(LayoutBranchConstants.MASTER_BRANCH_NAME)) {
    for (    Layout layout : layoutLocalService.getLayouts(branch.getGroupId(),false)) {
    }
    for (    Layout layout : layoutLocalService.getLayouts(branch.getGroupId(),true)) {
    }
  }
  return branch;
}
