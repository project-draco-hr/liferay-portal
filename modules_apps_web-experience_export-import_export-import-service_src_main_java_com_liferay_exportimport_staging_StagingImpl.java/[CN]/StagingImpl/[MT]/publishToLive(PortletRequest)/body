{
  long groupId=ParamUtil.getLong(portletRequest,"groupId");
  Group targetGroup=getLiveGroup(groupId);
  if (!targetGroup.isStaged()) {
    return 0;
  }
  if (targetGroup.isStagedRemotely()) {
    return publishToRemote(portletRequest);
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  User user=themeDisplay.getUser();
  Group sourceGroup=targetGroup.getStagingGroup();
  long sourceGroupId=sourceGroup.getGroupId();
  long targetGroupId=targetGroup.getGroupId();
  Map<String,Serializable> publishLayoutLocalSettingsMap=null;
  long exportImportConfigurationId=ParamUtil.getLong(portletRequest,"exportImportConfigurationId");
  String name=ParamUtil.getString(portletRequest,"name");
  if (exportImportConfigurationId > 0) {
    ExportImportConfiguration exportImportConfiguration=_exportImportConfigurationLocalService.fetchExportImportConfiguration(exportImportConfigurationId);
    if (exportImportConfiguration != null) {
      publishLayoutLocalSettingsMap=exportImportConfiguration.getSettingsMap();
      Map<String,String[]> parameterMap=(Map<String,String[]>)publishLayoutLocalSettingsMap.get("parameterMap");
      parameterMap.put(PortletDataHandlerKeys.PERFORM_DIRECT_BINARY_IMPORT,new String[]{Boolean.TRUE.toString()});
      if (!Validator.isBlank(name)) {
        parameterMap.put("name",new String[]{name});
      }
    }
  }
  if (publishLayoutLocalSettingsMap == null) {
    boolean privateLayout=getPrivateLayout(portletRequest);
    long[] layoutIds=ExportImportHelperUtil.getLayoutIds(portletRequest,targetGroupId);
    Map<String,String[]> parameterMap=ExportImportConfigurationParameterMapFactory.buildParameterMap(portletRequest);
    parameterMap.put(PortletDataHandlerKeys.PERFORM_DIRECT_BINARY_IMPORT,new String[]{Boolean.TRUE.toString()});
    publishLayoutLocalSettingsMap=ExportImportConfigurationSettingsMapFactory.buildPublishLayoutLocalSettingsMap(user,sourceGroupId,targetGroupId,privateLayout,layoutIds,parameterMap);
  }
  ExportImportConfiguration exportImportConfiguration=null;
  if (Validator.isNotNull(name)) {
    exportImportConfiguration=_exportImportConfigurationLocalService.addDraftExportImportConfiguration(user.getUserId(),name,ExportImportConfigurationConstants.TYPE_PUBLISH_LAYOUT_LOCAL,publishLayoutLocalSettingsMap);
  }
 else {
    exportImportConfiguration=_exportImportConfigurationLocalService.addDraftExportImportConfiguration(user.getUserId(),ExportImportConfigurationConstants.TYPE_PUBLISH_LAYOUT_LOCAL,publishLayoutLocalSettingsMap);
  }
  return publishLayouts(user.getUserId(),exportImportConfiguration);
}
