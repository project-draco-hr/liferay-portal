{
  long groupId=ParamUtil.getLong(portletRequest,"groupId");
  Group liveGroup=getLiveGroup(groupId);
  Map<String,String[]> parameterMap=ExportImportConfigurationParameterMapFactory.buildParameterMap(portletRequest);
  if (!liveGroup.isStaged()) {
    return 0;
  }
  if (liveGroup.isStagedRemotely()) {
    publishToRemote(portletRequest);
    return 0;
  }
  Group stagingGroup=liveGroup.getStagingGroup();
  long sourceGroupId=stagingGroup.getGroupId();
  long targetGroupId=liveGroup.getGroupId();
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  boolean privateLayout=getPrivateLayout(portletRequest);
  long[] layoutIds=ExportImportHelperUtil.getLayoutIds(portletRequest,targetGroupId);
  String name=ParamUtil.getString(portletRequest,"name");
  long userId=themeDisplay.getUserId();
  parameterMap.put(PortletDataHandlerKeys.PERFORM_DIRECT_BINARY_IMPORT,new String[]{Boolean.TRUE.toString()});
  User user=_userLocalService.getUser(userId);
  Map<String,Serializable> publishLayoutLocalSettingsMap=ExportImportConfigurationSettingsMapFactory.buildPublishLayoutLocalSettingsMap(user,sourceGroupId,targetGroupId,privateLayout,layoutIds,parameterMap);
  ExportImportConfiguration exportImportConfiguration=null;
  if (Validator.isNotNull(name)) {
    exportImportConfiguration=_exportImportConfigurationLocalService.addDraftExportImportConfiguration(userId,name,ExportImportConfigurationConstants.TYPE_PUBLISH_LAYOUT_LOCAL,publishLayoutLocalSettingsMap);
  }
 else {
    exportImportConfiguration=_exportImportConfigurationLocalService.addDraftExportImportConfiguration(userId,ExportImportConfigurationConstants.TYPE_PUBLISH_LAYOUT_LOCAL,publishLayoutLocalSettingsMap);
  }
  return publishLayouts(userId,exportImportConfiguration);
}
