{
  if (!PropsValues.PORTLET_ADD_DEFAULT_RESOURCE_CHECK_ENABLED) {
    return;
  }
  long companyId=PortalUtil.getCompanyId(request);
  String portletId=liferayPortletURL.getPortletId();
  Portlet portlet=PortletLocalServiceUtil.getPortletById(companyId,portletId);
  if (portlet == null) {
    return;
  }
  if (!portlet.isAddDefaultResource()) {
    return;
  }
  if (AuthTokenWhitelistUtil.isPortletURLPortletInvocationWhitelisted(liferayPortletURL)) {
    return;
  }
  long plid=liferayPortletURL.getPlid();
  try {
    Layout layout=LayoutLocalServiceUtil.getLayout(plid);
    LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
    if (layoutTypePortlet.hasPortletId(portletId)) {
      return;
    }
  }
 catch (  Exception e) {
    if (_log.isDebugEnabled()) {
      _log.debug(e.getMessage(),e);
    }
  }
  String controlPanelMenuPortletId=PortletProviderUtil.getPortletId(PortalProductMenuApplicationType.ProductMenu.CLASS_NAME,PortletProvider.Action.VIEW);
  if (portletId.equals(controlPanelMenuPortletId)) {
    return;
  }
  liferayPortletURL.setParameter("p_p_auth",getToken(request,plid,portletId));
}
