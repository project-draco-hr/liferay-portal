{
  HttpSession session=request.getSession();
  String sessionAuthenticationToken=(String)session.getAttribute(WebKeys.AUTHENTICATION_TOKEN);
  String requestAuthenticationToken=ParamUtil.getString(request,"p_auth");
  if (!sessionAuthenticationToken.equals(requestAuthenticationToken)) {
    throw new PrincipalException("Invalid authentication token");
  }
}
