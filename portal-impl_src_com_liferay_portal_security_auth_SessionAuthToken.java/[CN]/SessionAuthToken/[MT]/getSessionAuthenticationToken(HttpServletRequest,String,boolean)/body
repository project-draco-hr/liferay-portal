{
  String tokenKey=WebKeys.AUTHENTICATION_TOKEN.concat(key);
  HttpServletRequest currentRequest=request;
  HttpSession session=null;
  String sessionAuthenticationToken=null;
  while (currentRequest instanceof HttpServletRequestWrapper) {
    HttpServletRequestWrapper httpServletRequestWrapper=(HttpServletRequestWrapper)currentRequest;
    session=currentRequest.getSession();
    sessionAuthenticationToken=(String)session.getAttribute(tokenKey);
    if (Validator.isNotNull(sessionAuthenticationToken)) {
      break;
    }
    currentRequest=(HttpServletRequest)httpServletRequestWrapper.getRequest();
  }
  if (session == null) {
    session=currentRequest.getSession();
  }
  if (createToken && Validator.isNull(sessionAuthenticationToken)) {
    sessionAuthenticationToken=PwdGenerator.getPassword(PropsValues.AUTH_TOKEN_LENGTH);
    session.setAttribute(tokenKey,sessionAuthenticationToken);
  }
  return sessionAuthenticationToken;
}
