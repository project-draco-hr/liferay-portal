{
  try {
    if (!_complete) {
      this.wait(timeout);
    }
  }
 catch (  InterruptedException ie) {
  }
  try {
    Thread.sleep(PropsValues.POLLER_NOTIFICATIONS_TIMEOUT);
  }
 catch (  InterruptedException ie) {
  }
  List<NotificationEvent> notificationEvents=null;
  try {
    notificationEvents=ChannelHubManagerUtil.getNotificationEvents(_companyId,_userId,true);
  }
 catch (  UnknownChannelException uce) {
    if (_log.isDebugEnabled()) {
      _log.debug("Unable to complete processing because user session ended",uce);
    }
    return null;
  }
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  jsonArray.put(_pollerResponseHeaderJSONObject);
  for (  NotificationEvent notificationEvent : notificationEvents) {
    jsonArray.put(notificationEvent.toJSONObject());
  }
  return jsonArray.toString();
}
