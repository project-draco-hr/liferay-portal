{
  categories=ListUtil.sort(categories,new PortletCategoryComparator(_user.getCompanyId(),_user.getLocale()));
  Iterator<PortletCategory> itr=categories.iterator();
  for (int i=0; itr.hasNext(); i++) {
    PortletCategory portletCategory=itr.next();
    if (i == 0) {
      depth++;
      if (depth > _depth) {
        _depth=depth;
      }
    }
    TreeNodeView nodeView=new TreeNodeView(++_nodeId);
    nodeView.setDepth(depth);
    if ((i + 1) == categories.size()) {
      nodeView.setLs("1");
    }
 else {
      nodeView.setLs("0");
    }
    nodeView.setName(LanguageUtil.get(_user.getLocale(),portletCategory.getName()));
    nodeView.setParentId(parentId);
    _list.add(nodeView);
    List<PortletCategory> subCategories=ListUtil.fromCollection(portletCategory.getCategories());
    _iterateCategories(subCategories,_nodeId,depth);
    _iteratePortlets(portletCategory,portletCategory.getPortletIds(),_nodeId,depth + 1);
  }
}
