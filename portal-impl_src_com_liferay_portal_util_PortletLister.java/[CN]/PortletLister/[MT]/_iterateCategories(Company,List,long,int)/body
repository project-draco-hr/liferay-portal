{
  Collections.sort(categories,new PortletCategoryComparator(company.getCompanyId(),_locale));
  Iterator itr=categories.iterator();
  for (int i=0; itr.hasNext(); i++) {
    PortletCategory portletCategory=(PortletCategory)itr.next();
    if (i == 0) {
      depth++;
      if (depth > _depth) {
        _depth=depth;
      }
    }
    TreeNodeView nodeView=new TreeNodeView(++_nodeId);
    nodeView.setDepth(depth);
    nodeView.setName(LanguageUtil.get(_locale,portletCategory.getName()));
    nodeView.setParentId(parentId);
    if ((i + 1) == categories.size()) {
      nodeView.setLs("1");
    }
 else {
      nodeView.setLs("0");
    }
    _list.add(nodeView);
    List subCategories=ListUtil.fromCollection(portletCategory.getCategories());
    _iterateCategories(company,subCategories,_nodeId,depth);
    _iteratePortlets(portletCategory.getPortletIds(),portletCategory,_nodeId,depth + 1);
  }
}
