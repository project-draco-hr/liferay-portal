{
  Bundle testBundle=FrameworkUtil.getBundle(ResourcesImporterTest.class);
  _bundleContext=testBundle.getBundleContext();
  URL warURL=ResourcesImporterTest.class.getResource("dependencies/test.war");
  warURL=new URL(warURL.toExternalForm() + "?Web-ContextPath=/test-resource-importer");
  URL bundleURL=new URL("webbundle",null,warURL.toString());
  _bundle=_bundleContext.installBundle(bundleURL.toString());
  Dictionary<String,Object> properties=new Hashtable<>();
  properties.put("destination.name","liferay/resources_importer");
  final CountDownLatch countDownLatch=new CountDownLatch(1);
  ServiceRegistration<MessageListener> serviceRegistration=_bundleContext.registerService(MessageListener.class,new MessageListener(){
    public void receive(    Message message) throws MessageListenerException {
      countDownLatch.countDown();
    }
  }
,properties);
  _bundle.start();
  countDownLatch.await(1,TimeUnit.MINUTES);
  serviceRegistration.unregister();
}
