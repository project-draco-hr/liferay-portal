{
  _jaasAuthTypeField.set(null,"screenName");
  final IntegerWrapper counter=new IntegerWrapper();
  JAASHelper jaasHelper=JAASHelper.getInstance();
  JAASHelper.setInstance(new JAASHelper(){
    @Override protected long doGetJaasUserId(    long companyId,    String name) throws PortalException {
      try {
        return super.doGetJaasUserId(companyId,name);
      }
  finally {
        counter.increment();
      }
    }
  }
);
  MainServlet mainServlet=MainServletTestCallback.getMainServlet();
  MockHttpServletRequest mockHttpServletRequest=new MockHttpServletRequest(mainServlet.getServletContext(),HttpMethods.GET,StringPool.SLASH);
  mockHttpServletRequest.setRemoteUser(String.valueOf(_user.getScreenName()));
  try {
    User user=PortalUtil.getUser(mockHttpServletRequest);
    Assert.assertEquals(1,counter.getValue());
    Assert.assertEquals(_user.getUserId(),user.getUserId());
    user=PortalUtil.getUser(mockHttpServletRequest);
    Assert.assertEquals(1,counter.getValue());
    Assert.assertEquals(_user.getUserId(),user.getUserId());
  }
  finally {
    JAASHelper.setInstance(jaasHelper);
  }
}
