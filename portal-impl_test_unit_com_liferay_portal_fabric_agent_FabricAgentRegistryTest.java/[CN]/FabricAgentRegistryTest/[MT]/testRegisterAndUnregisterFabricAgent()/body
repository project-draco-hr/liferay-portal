{
  FabricAgentRegistry fabricAgentRegistry=new FabricAgentRegistry(new LocalFabricAgent(new EmbeddedProcessExecutor()));
  RecordFabricAgentListener recordFabricAgentListener=new RecordFabricAgentListener();
  fabricAgentRegistry.registerFabricAgentListener(recordFabricAgentListener);
  FabricAgent fabricAgent1=new LocalFabricAgent(new EmbeddedProcessExecutor());
  Assert.assertTrue(fabricAgentRegistry.registerFabricAgent(fabricAgent1));
  Assert.assertSame(fabricAgent1,recordFabricAgentListener.takeRegisteredFabricAgent());
  Assert.assertNull(recordFabricAgentListener.takeUnregisteredFabricAgent());
  Assert.assertFalse(fabricAgentRegistry.registerFabricAgent(fabricAgent1));
  Assert.assertNull(recordFabricAgentListener.takeRegisteredFabricAgent());
  Assert.assertNull(recordFabricAgentListener.takeUnregisteredFabricAgent());
  List<FabricAgent> fabricAgents=fabricAgentRegistry.getFabricAgents();
  Assert.assertEquals(1,fabricAgents.size());
  Assert.assertTrue(fabricAgents.contains(fabricAgent1));
  FabricAgent fabricAgent2=new LocalFabricAgent(new EmbeddedProcessExecutor());
  Assert.assertTrue(fabricAgentRegistry.registerFabricAgent(fabricAgent2));
  Assert.assertSame(fabricAgent2,recordFabricAgentListener.takeRegisteredFabricAgent());
  Assert.assertNull(recordFabricAgentListener.takeUnregisteredFabricAgent());
  Assert.assertFalse(fabricAgentRegistry.registerFabricAgent(fabricAgent2));
  Assert.assertNull(recordFabricAgentListener.takeRegisteredFabricAgent());
  Assert.assertNull(recordFabricAgentListener.takeUnregisteredFabricAgent());
  fabricAgents=fabricAgentRegistry.getFabricAgents();
  Assert.assertEquals(2,fabricAgents.size());
  Assert.assertTrue(fabricAgents.contains(fabricAgent1));
  Assert.assertTrue(fabricAgents.contains(fabricAgent2));
  Assert.assertTrue(fabricAgentRegistry.unregisterFabricAgent(fabricAgent1));
  Assert.assertNull(recordFabricAgentListener.takeRegisteredFabricAgent());
  Assert.assertSame(fabricAgent1,recordFabricAgentListener.takeUnregisteredFabricAgent());
  Assert.assertFalse(fabricAgentRegistry.unregisterFabricAgent(fabricAgent1));
  Assert.assertNull(recordFabricAgentListener.takeRegisteredFabricAgent());
  Assert.assertNull(recordFabricAgentListener.takeUnregisteredFabricAgent());
  fabricAgents=fabricAgentRegistry.getFabricAgents();
  Assert.assertEquals(1,fabricAgents.size());
  Assert.assertTrue(fabricAgents.contains(fabricAgent2));
  Assert.assertTrue(fabricAgentRegistry.unregisterFabricAgent(fabricAgent2));
  Assert.assertNull(recordFabricAgentListener.takeRegisteredFabricAgent());
  Assert.assertSame(fabricAgent2,recordFabricAgentListener.takeUnregisteredFabricAgent());
  Assert.assertFalse(fabricAgentRegistry.unregisterFabricAgent(fabricAgent2));
  Assert.assertNull(recordFabricAgentListener.takeRegisteredFabricAgent());
  Assert.assertNull(recordFabricAgentListener.takeUnregisteredFabricAgent());
  fabricAgents=fabricAgentRegistry.getFabricAgents();
  Assert.assertTrue(fabricAgents.isEmpty());
}
