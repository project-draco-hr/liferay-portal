{
  Stack<String> xPathIdStack=(Stack<String>)_xPathIdStack.clone();
  StringBundler sb=new StringBundler();
  sb.append("<p>");
  Queue<String> xPathQueue=new LinkedList<>();
  while (xPathIdStack.size() > 1) {
    String xPath=generateXPath(xPathIdStack);
    xPathIdStack.pop();
    String commandTag=getLogElementText(xPath + "/div/span[@class='tag'][1]");
    if (!commandTag.equals("echo") && !commandTag.equals("execute") && !commandTag.equals("fail")) {
      continue;
    }
    xPathQueue.add(xPath);
  }
  while (xPathQueue.peek() != null) {
    String xPath=xPathQueue.poll();
    String command=getLogElementText(xPath + "/div/span[@class='quote'][1]");
    command=StringUtil.replace(command,"\"","");
    String commandType=getLogElementText(xPath + "/div/span[@class='attribute'][1]");
    sb.append("Failed Line: ");
    sb.append(commandType);
    sb.append(": <b>");
    sb.append(command);
    sb.append("</b> ");
    if (xPathQueue.peek() != null) {
      String parentXPath=xPathQueue.peek();
      String parentCommand=getLogElementText(parentXPath + "/div/span[@class='quote'][1]");
      parentCommand=StringUtil.replace(parentCommand,"\"","");
      String parentCommandType=getLogElementText(parentXPath + "/div/span[@class='attribute'][1]");
      int pos=parentCommand.indexOf("#");
      sb.append("(from ");
      sb.append(parentCommand.substring(0,pos));
      sb.append(".");
      sb.append(parentCommandType);
      sb.append(") ");
    }
    String lineNumber=getLogElementText(xPath + "/div/div[@class='line-number']");
    sb.append("at line ");
    sb.append(lineNumber);
    sb.append("<br />");
  }
  String testCaseCommand=getLogElementText(generateXPath(xPathIdStack) + "/div/h3");
  sb.append("in test case command <b>");
  sb.append(testCaseCommand.trim());
  sb.append("</b><br />");
  sb.append("<textarea cols=\"85\" rows=\"7\" wrap=\"off\">");
  sb.append(throwable.getMessage());
  StackTraceElement[] stackTraceElements=throwable.getStackTrace();
  for (  StackTraceElement stackTraceElement : stackTraceElements) {
    String className=stackTraceElement.getClassName();
    if (className.startsWith("com.liferay")) {
      sb.append("&#10;&#9;");
      sb.append(stackTraceElement.toString());
    }
  }
  sb.append("</textarea>");
  sb.append("</p>");
  return sb.toString();
}
