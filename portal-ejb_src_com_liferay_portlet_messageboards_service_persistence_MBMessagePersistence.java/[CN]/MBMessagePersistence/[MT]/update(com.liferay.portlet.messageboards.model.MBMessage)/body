{
  Session session=null;
  try {
    if (mbMessage.isNew() || mbMessage.isModified()) {
      session=openSession();
      if (mbMessage.isNew()) {
        MBMessageHBM mbMessageHBM=new MBMessageHBM();
        mbMessageHBM.setTopicId(mbMessage.getTopicId());
        mbMessageHBM.setMessageId(mbMessage.getMessageId());
        mbMessageHBM.setCompanyId(mbMessage.getCompanyId());
        mbMessageHBM.setUserId(mbMessage.getUserId());
        mbMessageHBM.setUserName(mbMessage.getUserName());
        mbMessageHBM.setCreateDate(mbMessage.getCreateDate());
        mbMessageHBM.setModifiedDate(mbMessage.getModifiedDate());
        mbMessageHBM.setThreadId(mbMessage.getThreadId());
        mbMessageHBM.setParentMessageId(mbMessage.getParentMessageId());
        mbMessageHBM.setSubject(mbMessage.getSubject());
        mbMessageHBM.setBody(mbMessage.getBody());
        mbMessageHBM.setAttachments(mbMessage.getAttachments());
        mbMessageHBM.setAnonymous(mbMessage.getAnonymous());
        session.save(mbMessageHBM);
        session.flush();
      }
 else {
        MBMessageHBM mbMessageHBM=(MBMessageHBM)session.get(MBMessageHBM.class,mbMessage.getPrimaryKey());
        if (mbMessageHBM != null) {
          mbMessageHBM.setCompanyId(mbMessage.getCompanyId());
          mbMessageHBM.setUserId(mbMessage.getUserId());
          mbMessageHBM.setUserName(mbMessage.getUserName());
          mbMessageHBM.setCreateDate(mbMessage.getCreateDate());
          mbMessageHBM.setModifiedDate(mbMessage.getModifiedDate());
          mbMessageHBM.setThreadId(mbMessage.getThreadId());
          mbMessageHBM.setParentMessageId(mbMessage.getParentMessageId());
          mbMessageHBM.setSubject(mbMessage.getSubject());
          mbMessageHBM.setBody(mbMessage.getBody());
          mbMessageHBM.setAttachments(mbMessage.getAttachments());
          mbMessageHBM.setAnonymous(mbMessage.getAnonymous());
          session.flush();
        }
 else {
          mbMessageHBM=new MBMessageHBM();
          mbMessageHBM.setTopicId(mbMessage.getTopicId());
          mbMessageHBM.setMessageId(mbMessage.getMessageId());
          mbMessageHBM.setCompanyId(mbMessage.getCompanyId());
          mbMessageHBM.setUserId(mbMessage.getUserId());
          mbMessageHBM.setUserName(mbMessage.getUserName());
          mbMessageHBM.setCreateDate(mbMessage.getCreateDate());
          mbMessageHBM.setModifiedDate(mbMessage.getModifiedDate());
          mbMessageHBM.setThreadId(mbMessage.getThreadId());
          mbMessageHBM.setParentMessageId(mbMessage.getParentMessageId());
          mbMessageHBM.setSubject(mbMessage.getSubject());
          mbMessageHBM.setBody(mbMessage.getBody());
          mbMessageHBM.setAttachments(mbMessage.getAttachments());
          mbMessageHBM.setAnonymous(mbMessage.getAnonymous());
          session.save(mbMessageHBM);
          session.flush();
        }
      }
      mbMessage.setNew(false);
      mbMessage.setModified(false);
    }
    return mbMessage;
  }
 catch (  HibernateException he) {
    throw new SystemException(he);
  }
 finally {
    closeSession(session);
  }
}
