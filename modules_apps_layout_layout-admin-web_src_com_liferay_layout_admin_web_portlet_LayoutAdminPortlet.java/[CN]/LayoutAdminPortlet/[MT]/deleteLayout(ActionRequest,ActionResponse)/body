{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String redirect=ParamUtil.getString(actionRequest,"redirect");
  long plid=ParamUtil.getLong(actionRequest,"plid");
  if (plid <= 0) {
    long groupId=ParamUtil.getLong(actionRequest,"groupId");
    boolean privateLayout=ParamUtil.getBoolean(actionRequest,"privateLayout");
    long layoutId=ParamUtil.getLong(actionRequest,"layoutId");
    Layout layout=layoutLocalService.getLayout(groupId,privateLayout,layoutId);
    plid=layout.getPlid();
  }
  Object[] returnValue=SitesUtil.deleteLayout(actionRequest,actionResponse);
  if (plid == themeDisplay.getRefererPlid()) {
    long newRefererPlid=(Long)returnValue[2];
    redirect=HttpUtil.setParameter(redirect,"refererPlid",newRefererPlid);
    redirect=HttpUtil.setParameter(redirect,actionResponse.getNamespace() + "selPlid",0);
  }
  actionRequest.setAttribute(WebKeys.REDIRECT,redirect);
}
