{
  MessageBusUtil.init(new DefaultMessageBus(),new DefaultMessageSender());
  SearchEngineUtil.init(new LuceneSearchEngineImpl(),new IndexWriterMessageSender());
  BookmarksEntry entry=addEntry();
  Thread.sleep(1000);
  long groupId=PortalUtil.getPortletGroupId(TestPropsValues.LAYOUT_PLID);
  String keywords="test";
  Hits hits=BookmarksFolderLocalServiceUtil.search(entry.getCompanyId(),groupId,new long[]{entry.getFolderId()},keywords,SearchEngineUtil.ALL_POS,SearchEngineUtil.ALL_POS);
  assertEquals(1,hits.getLength());
  List<Document> results=hits.toList();
  for (  Document document : results) {
    assertEquals(entry.getCompanyId(),Long.parseLong(document.get(Field.COMPANY_ID)));
    assertEquals(groupId,Long.parseLong(document.get(Field.GROUP_ID)));
    assertEquals(entry.getName(),document.get(Field.NAME));
    assertEquals(entry.getUrl(),document.get(Field.URL));
    assertEquals(entry.getComments(),document.get(Field.COMMENTS));
    assertEquals(entry.getFolderId(),Long.parseLong(document.get("folderId")));
    assertEquals(entry.getEntryId(),Long.parseLong(document.get("entryId")));
  }
  BookmarksFolderLocalServiceUtil.deleteFolder(entry.getFolderId());
  Thread.sleep(1000);
  hits=BookmarksFolderLocalServiceUtil.search(entry.getCompanyId(),groupId,new long[]{entry.getFolderId()},keywords,SearchEngineUtil.ALL_POS,SearchEngineUtil.ALL_POS);
  assertEquals(0,hits.getLength());
  addEntry();
  addEntry();
  addEntry();
  entry=addEntry();
  Thread.sleep(1000);
  hits=BookmarksFolderLocalServiceUtil.search(entry.getCompanyId(),groupId,null,keywords,1,3);
  assertEquals(4,hits.getLength());
  assertEquals(2,hits.getDocs().length);
}
