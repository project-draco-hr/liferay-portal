{
  long layoutSetPrototypeId=counterLocalService.increment();
  LayoutSetPrototype layoutSetPrototype=layoutSetPrototypePersistence.create(layoutSetPrototypeId);
  layoutSetPrototype.setCompanyId(companyId);
  layoutSetPrototype.setNameMap(nameMap);
  layoutSetPrototype.setDescription(description);
  layoutSetPrototype.setActive(active);
  layoutSetPrototypePersistence.update(layoutSetPrototype,false);
  if (userId > 0) {
    resourceLocalService.addResources(companyId,0,userId,LayoutSetPrototype.class.getName(),layoutSetPrototype.getLayoutSetPrototypeId(),false,false,false);
  }
  String friendlyURL="/template-" + layoutSetPrototype.getLayoutSetPrototypeId();
  Group group=groupLocalService.addGroup(userId,LayoutSetPrototype.class.getName(),layoutSetPrototype.getLayoutSetPrototypeId(),layoutSetPrototype.getName(LocaleUtil.getDefault()),null,0,friendlyURL,true,null);
  ServiceContext serviceContext=new ServiceContext();
  layoutLocalService.addLayout(null,userId,group.getGroupId(),true,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID,"home",null,null,LayoutConstants.TYPE_PORTLET,false,"/home",serviceContext);
  return layoutSetPrototype;
}
