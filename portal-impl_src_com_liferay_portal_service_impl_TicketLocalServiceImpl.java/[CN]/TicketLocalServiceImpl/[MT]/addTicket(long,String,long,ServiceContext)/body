{
  long ticketId=counterLocalService.increment(Ticket.class.getName());
  long classNameId=classNameLocalService.getClassNameId(className);
  Date now=new Date();
  Ticket ticket=ticketPersistence.create(ticketId);
  ticket.setCompanyId(serviceContext.getCompanyId());
  ticket.setCreateDate(now);
  if (expirationTime == 0) {
    ticket.setExpirationDate(expirationTime);
  }
 else {
    ticket.setExpirationDate(now.getTime() + expirationTime);
  }
  ticket.setClassNameId(classNameId);
  ticket.setClassPK(classPK);
  ticket.setKey(UUID.randomUUID().toString());
  ticketPersistence.update(ticket,false);
  return ticket;
}
