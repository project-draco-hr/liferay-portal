{
  if (!image.getFolderId().equals(folderId)) {
    IGFolder oldFolder=IGFolderUtil.findByPrimaryKey(image.getFolderId());
    IGFolder newFolder=IGFolderUtil.fetchByPrimaryKey(folderId);
    if ((newFolder == null) || (!oldFolder.getGroupId().equals(newFolder.getGroupId()))) {
      folderId=image.getFolderId();
    }
  }
  return IGFolderUtil.findByPrimaryKey(folderId);
}
