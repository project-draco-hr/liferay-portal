{
  try {
    IGImage image=IGImageUtil.findByPrimaryKey(new IGImagePK(companyId,imageId));
    IGFolder folder=getFolder(image,folderId);
    BufferedImage bufferedImage=null;
    byte[] bytes=null;
    if (file.exists()) {
      bufferedImage=ImageIO.read(file);
      bytes=FileUtil.getBytes(file);
    }
    validate(file,bytes);
    image.setModifiedDate(new Date());
    image.setFolderId(folder.getFolderId());
    image.setDescription(description);
    if (bufferedImage != null) {
      image.setHeight(bufferedImage.getHeight());
      image.setWidth(bufferedImage.getWidth());
      image.setSize(bytes.length);
    }
    IGImageUtil.update(image);
    if (bufferedImage != null) {
      saveImages(image.getLargeImageId(),bufferedImage,image.getSmallImageId(),file,bytes,contentType);
    }
    TagsAssetLocalServiceUtil.updateAsset(image.getUserId(),IGImage.class.getName(),image.getPrimaryKey().toString(),tagsEntries);
    return image;
  }
 catch (  IOException ioe) {
    throw new ImageSizeException(ioe);
  }
}
