{
  try {
    ImageLocalUtil.put(imageKey,bytes);
    int thumbnailMaxHeight=GetterUtil.getInteger(PropsUtil.get(PropsUtil.IG_IMAGE_THUMBNAIL_MAX_HEIGHT));
    int thumbnailMaxWidth=GetterUtil.getInteger(PropsUtil.get(PropsUtil.IG_IMAGE_THUMBNAIL_MAX_WIDTH));
    BufferedImage thumbnail=ImageUtil.scale(bufferedImage,thumbnailMaxHeight,thumbnailMaxWidth);
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    if (contentType.indexOf("gif") != -1) {
      ImageUtil.encodeGIF(thumbnail,baos);
    }
 else     if (contentType.indexOf("jpg") != -1 || contentType.indexOf("jpeg") != -1) {
      ImageIO.write(thumbnail,"jpeg",baos);
    }
 else     if (contentType.indexOf("png") != -1) {
      ImageIO.write(thumbnail,"png",baos);
    }
    ImageLocalUtil.put(thumbnailKey,baos.toByteArray());
  }
 catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
