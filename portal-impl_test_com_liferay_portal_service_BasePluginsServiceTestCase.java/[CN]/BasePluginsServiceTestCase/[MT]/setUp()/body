{
  System.setProperty("external-properties","portal-plugin-test.properties");
  if (PortletClassLoaderUtil.getClassLoader() == null) {
    PortletClassLoaderUtil.setClassLoader(Thread.currentThread().getContextClassLoader());
  }
  if (PortletBeanLocatorUtil.getBeanLocator() == null) {
    PortletBeanLocatorUtil.setBeanLocator(new BeanLocatorImpl());
  }
  super.setUp();
  PortalInstances.addCompanyId(TestPropsValues.COMPANY_ID);
  PrincipalThreadLocal.setName(TestPropsValues.USER_ID);
  User user=UserLocalServiceUtil.getUserById(TestPropsValues.USER_ID);
  _permissionChecker=PermissionCheckerFactory.create(user,true);
  PermissionThreadLocal.setPermissionChecker(_permissionChecker);
}
