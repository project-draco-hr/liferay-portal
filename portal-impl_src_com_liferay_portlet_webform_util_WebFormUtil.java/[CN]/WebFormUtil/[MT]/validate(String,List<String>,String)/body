{
  boolean validationResult=false;
  Context cx=Context.enter();
  StringBuilder sb=new StringBuilder();
  sb.append("thisFieldValue = String('" + thisFieldValue + "');\n");
  sb.append("var fieldValues = new Array();\n");
  for (int i=1; i <= fieldValues.size(); i++) {
    sb.append("fieldValues[" + i + "] = '"+ fieldValues.get(i - 1)+ "';\n");
  }
  sb.append("function validation(thisFieldValue, fieldValues) {\n");
  sb.append(validationScript);
  sb.append("};\n");
  sb.append("internalValidationResult = ");
  sb.append("validation(thisFieldValue, fieldValues);");
  String script=sb.toString();
  try {
    Scriptable scope=cx.initStandardObjects();
    Object jsFieldValues=Context.javaToJS(fieldValues,scope);
    ScriptableObject.putProperty(scope,"jsFieldValues",jsFieldValues);
    cx.evaluateString(scope,script,"Validation Script",1,null);
    Object obj=ScriptableObject.getProperty(scope,"internalValidationResult");
    if (obj instanceof Boolean) {
      validationResult=((Boolean)obj).booleanValue();
    }
 else {
      throw new Exception("The script must return a boolean value");
    }
  }
 catch (  Exception e) {
    String msg="The following script has execution errors:\n" + validationScript + "\n"+ e.getMessage();
    _log.error(msg);
    throw new Exception(msg,e);
  }
 finally {
    Context.exit();
  }
  return validationResult;
}
