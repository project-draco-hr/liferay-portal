{
  Date startDate=null;
  Date endDate=null;
  if (range.equals(RANGE_DATE_RANGE)) {
    Calendar startCalendar=getCalendar(startDateAmPm,startDateYear,startDateMonth,startDateDay,startDateHour,startDateMinute,locale,timeZone,true);
    startDate=startCalendar.getTime();
    Calendar endCalendar=getCalendar(endDateAmPm,endDateYear,endDateMonth,endDateDay,endDateHour,endDateMinute,locale,timeZone,true);
    endDate=endCalendar.getTime();
  }
 else   if (range.equals(RANGE_FROM_LAST_PUBLISH_DATE)) {
    Date lastPublishDate=null;
    if (Validator.isNotNull(portletId) && (plid > 0)) {
      Layout layout=LayoutLocalServiceUtil.getLayout(plid);
      PortletPreferences preferences=PortletPreferencesFactoryUtil.getStrictPortletSetup(layout,portletId);
      lastPublishDate=getLastPublishDate(preferences);
    }
 else {
      LayoutSet layoutSet=LayoutSetLocalServiceUtil.getLayoutSet(groupId,privateLayout);
      lastPublishDate=getLastPublishDate(layoutSet);
    }
    if (lastPublishDate != null) {
      endDate=new Date();
      startDate=lastPublishDate;
    }
  }
 else   if (range.equals(RANGE_LAST)) {
    Date now=new Date();
    startDate=new Date(now.getTime() - (rangeLast * Time.HOUR));
    endDate=now;
  }
  return new DateRange(startDate,endDate);
}
