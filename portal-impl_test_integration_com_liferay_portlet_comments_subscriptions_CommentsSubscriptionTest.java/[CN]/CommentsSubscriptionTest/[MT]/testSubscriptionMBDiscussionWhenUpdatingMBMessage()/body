{
  ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext(_group.getGroupId(),TestPropsValues.getUserId());
  BlogsEntry blogsEntry=BlogsEntryLocalServiceUtil.addEntry(TestPropsValues.getUserId(),RandomTestUtil.randomString(),RandomTestUtil.randomString(),serviceContext);
  MBTestUtil.populateNotificationsServiceContext(serviceContext,Constants.ADD);
  MBMessage message=MBMessageLocalServiceUtil.addDiscussionMessage(TestPropsValues.getUserId(),RandomTestUtil.randomString(),_group.getGroupId(),BlogsEntry.class.getName(),blogsEntry.getEntryId(),0,MBMessageConstants.DEFAULT_PARENT_MESSAGE_ID,RandomTestUtil.randomString(),RandomTestUtil.randomString(50),serviceContext);
  MBDiscussionLocalServiceUtil.subscribeDiscussion(_user.getUserId(),_group.getGroupId(),BlogsEntry.class.getName(),blogsEntry.getEntryId());
  MBTestUtil.populateNotificationsServiceContext(serviceContext,Constants.UPDATE);
  MBMessageLocalServiceUtil.updateDiscussionMessage(TestPropsValues.getUserId(),message.getMessageId(),BlogsEntry.class.getName(),blogsEntry.getEntryId(),RandomTestUtil.randomString(),RandomTestUtil.randomString(50),serviceContext);
  Assert.assertEquals(1,MailServiceTestUtil.getInboxSize());
}
