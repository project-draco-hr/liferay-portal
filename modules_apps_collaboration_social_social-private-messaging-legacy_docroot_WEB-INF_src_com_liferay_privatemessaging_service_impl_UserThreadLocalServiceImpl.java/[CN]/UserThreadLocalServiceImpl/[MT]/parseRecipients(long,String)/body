{
  User user=UserLocalServiceUtil.getUser(userId);
  String[] recipients=StringUtil.split(to);
  List<User> users=new ArrayList<>();
  for (  String recipient : recipients) {
    int x=recipient.indexOf(CharPool.LESS_THAN);
    int y=recipient.indexOf(CharPool.GREATER_THAN);
    try {
      String screenName=recipient;
      if ((x != -1) && (y != -1)) {
        screenName=recipient.substring(x + 1,y);
      }
      User recipientUser=UserLocalServiceUtil.getUserByScreenName(user.getCompanyId(),screenName);
      if (!users.contains(recipientUser)) {
        users.add(recipientUser);
      }
    }
 catch (    NoSuchUserException nsue) {
    }
  }
  return users;
}
