{
  JSONObject notificationEventJSONObject=JSONFactoryUtil.createJSONObject();
  notificationEventJSONObject.put("classPK",mbMessage.getMessageId());
  notificationEventJSONObject.put("userId",mbMessage.getUserId());
  List<UserThread> userThreads=UserThreadLocalServiceUtil.getMBThreadUserThreads(mbMessage.getThreadId());
  for (  UserThread userThread : userThreads) {
    if ((userThread.getUserId() == mbMessage.getUserId()) || ((userThread.getUserId() != mbMessage.getUserId()) && !UserNotificationManagerUtil.isDeliver(userThread.getUserId(),PortletKeys.PRIVATE_MESSAGING,0,PrivateMessagingConstants.NEW_MESSAGE,UserNotificationDeliveryConstants.TYPE_WEBSITE))) {
      continue;
    }
    UserNotificationEventLocalServiceUtil.sendUserNotificationEvents(userThread.getUserId(),PortletKeys.PRIVATE_MESSAGING,UserNotificationDeliveryConstants.TYPE_WEBSITE,notificationEventJSONObject);
  }
}
