{
  long leftPrimaryKey=1;
  long[] rightPrimaryKeys=_tableMappingImpl.getRightPrimaryKeys(leftPrimaryKey);
  Assert.assertEquals(0,rightPrimaryKeys.length);
  Assert.assertSame(rightPrimaryKeys,_tableMappingImpl.getRightPrimaryKeys(leftPrimaryKey));
  long rightPrimaryKey1=3;
  long rightPrimaryKey2=2;
  PortalCache<Long,long[]> leftToRightPortalCache=_tableMappingImpl.leftToRightPortalCache;
  leftToRightPortalCache.remove(leftPrimaryKey);
  _mappingStore.put(leftPrimaryKey,new long[]{rightPrimaryKey1,rightPrimaryKey2});
  rightPrimaryKeys=_tableMappingImpl.getRightPrimaryKeys(leftPrimaryKey);
  Assert.assertArrayEquals(new long[]{rightPrimaryKey2,rightPrimaryKey1},rightPrimaryKeys);
  leftToRightPortalCache.remove(leftPrimaryKey);
  MockGetRightPrimaryKeysSqlQuery mockGetRightPrimaryKeysByLeftPrimaryKeyMappingSqlQuery=(MockGetRightPrimaryKeysSqlQuery)_tableMappingImpl.getRightPrimaryKeysSqlQuery;
  mockGetRightPrimaryKeysByLeftPrimaryKeyMappingSqlQuery.setDatabaseError(true);
  try {
    _tableMappingImpl.getRightPrimaryKeys(leftPrimaryKey);
  }
 catch (  SystemException se) {
    Throwable cause=se.getCause();
    Assert.assertSame(RuntimeException.class,cause.getClass());
    Assert.assertEquals("Database error",cause.getMessage());
  }
 finally {
    mockGetRightPrimaryKeysByLeftPrimaryKeyMappingSqlQuery.setDatabaseError(false);
  }
}
