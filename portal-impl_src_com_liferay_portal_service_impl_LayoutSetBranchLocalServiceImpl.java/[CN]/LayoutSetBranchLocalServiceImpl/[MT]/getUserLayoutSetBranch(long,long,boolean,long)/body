{
  User user=userPersistence.findByPrimaryKey(userId);
  boolean signedIn=!user.isDefaultUser();
  PortalPreferences portalPreferences=PortletPreferencesFactoryUtil.getPortalPreferences(user.getCompanyId(),user.getUserId(),signedIn);
  if (layoutSetBranchId <= 0) {
    layoutSetBranchId=GetterUtil.getLong(portalPreferences.getValue(Staging.class.getName(),"LAYOUT_SET_BRANCH_ID"));
  }
  if (layoutSetBranchId > 0) {
    try {
      return getLayoutSetBranch(layoutSetBranchId);
    }
 catch (    NoSuchLayoutSetBranchException nslsbe) {
    }
  }
  return getMasterLayoutSetBranch(groupId,privateLayout);
}
