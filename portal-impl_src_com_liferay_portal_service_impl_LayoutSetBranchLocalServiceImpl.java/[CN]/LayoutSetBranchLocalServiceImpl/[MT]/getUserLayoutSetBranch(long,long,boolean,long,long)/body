{
  if (layoutSetBranchId <= 0) {
    User user=userPersistence.findByPrimaryKey(userId);
    if (layoutSetId <= 0) {
      LayoutSet layoutSet=layoutSetLocalService.getLayoutSet(groupId,privateLayout);
      layoutSetId=layoutSet.getLayoutSetId();
    }
    layoutSetBranchId=StagingUtil.getRecentLayoutSetBranchId(user,layoutSetId);
  }
  if (layoutSetBranchId > 0) {
    LayoutSetBranch layoutSetBranch=fetchLayoutSetBranch(layoutSetBranchId);
    if (layoutSetBranch != null) {
      return layoutSetBranch;
    }
  }
  return getMasterLayoutSetBranch(groupId,privateLayout);
}
