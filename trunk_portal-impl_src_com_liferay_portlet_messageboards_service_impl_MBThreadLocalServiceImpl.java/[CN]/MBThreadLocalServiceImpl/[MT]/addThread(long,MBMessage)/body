{
  long threadId=counterLocalService.increment();
  MBThread thread=mbThreadPersistence.create(threadId);
  thread.setGroupId(message.getGroupId());
  thread.setCompanyId(message.getCompanyId());
  thread.setCategoryId(categoryId);
  thread.setRootMessageId(message.getMessageId());
  thread.setRootMessageUserId(message.getUserId());
  thread.setStatus(message.getStatus());
  thread.setStatusByUserId(message.getStatusByUserId());
  thread.setStatusByUserName(message.getStatusByUserName());
  thread.setStatusDate(message.getStatusDate());
  thread.setMessageCount(thread.getMessageCount() + 1);
  if (message.isAnonymous()) {
    thread.setLastPostByUserId(0);
  }
 else {
    thread.setLastPostByUserId(message.getUserId());
  }
  thread.setLastPostDate(message.getCreateDate());
  if (message.getPriority() != MBThreadConstants.PRIORITY_NOT_GIVEN) {
    thread.setPriority(message.getPriority());
  }
  mbThreadPersistence.update(thread,false);
  return thread;
}
