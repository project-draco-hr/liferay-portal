{
  DDMForm ddmForm=DDMFormTestUtil.createDDMForm("Field1");
  DDMDataProviderInstance dataProviderInstance1=createDDMDataProviderInstance();
  DDMDataProviderInstance dataProviderInstance2=createDDMDataProviderInstance();
  List<String> actions=new ArrayList<>();
  actions.add("call(" + dataProviderInstance1.getUuid() + ")");
  actions.add("call(" + dataProviderInstance2.getUuid() + ")");
  DDMFormRule ddmFormRule1=new DDMFormRule("TRUE",actions);
  ddmForm.addDDMFormRule(ddmFormRule1);
  actions=new ArrayList<>();
  actions.add("call(" + dataProviderInstance1.getUuid() + ")");
  DDMFormRule ddmFormRule2=new DDMFormRule("FALSE",actions);
  ddmForm.addDDMFormRule(ddmFormRule2);
  DDMStructure structure=ddmStructureTestHelper.addStructure(ddmForm,StorageType.JSON.getValue());
  List<DDMDataProviderInstanceLink> dataProviderInstanceLinks=DDMDataProviderInstanceLinkLocalServiceUtil.getDataProviderInstanceLinks(structure.getStructureId());
  Assert.assertEquals(2,dataProviderInstanceLinks.size());
  List<DDMFormRule> ddmFormRules=ddmForm.getDDMFormRules();
  ddmFormRules.remove(ddmFormRule1);
  ddmForm.setDDMFormRules(ddmFormRules);
  ddmStructureTestHelper.updateStructure(structure.getStructureId(),ddmForm);
  dataProviderInstanceLinks=DDMDataProviderInstanceLinkLocalServiceUtil.getDataProviderInstanceLinks(structure.getStructureId());
  Assert.assertEquals(1,dataProviderInstanceLinks.size());
  DDMStructureLocalServiceUtil.deleteStructure(structure);
  dataProviderInstanceLinks=DDMDataProviderInstanceLinkLocalServiceUtil.getDataProviderInstanceLinks(structure.getStructureId());
  Assert.assertEquals(0,dataProviderInstanceLinks.size());
}
