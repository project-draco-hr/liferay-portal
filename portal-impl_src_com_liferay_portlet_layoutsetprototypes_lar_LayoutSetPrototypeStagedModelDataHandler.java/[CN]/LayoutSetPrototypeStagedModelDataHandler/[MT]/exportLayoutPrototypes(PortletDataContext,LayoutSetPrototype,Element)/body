{
  DynamicQuery dynamicQuery=LayoutLocalServiceUtil.dynamicQuery();
  Property groupIdProperty=PropertyFactoryUtil.forName("groupId");
  dynamicQuery.add(groupIdProperty.eq(layoutSetPrototype.getGroupId()));
  Conjunction conjunction=RestrictionsFactoryUtil.conjunction();
  Property layoutPrototypeUuidProperty=PropertyFactoryUtil.forName("layoutPrototypeUuid");
  conjunction.add(layoutPrototypeUuidProperty.isNotNull());
  conjunction.add(layoutPrototypeUuidProperty.ne(StringPool.BLANK));
  dynamicQuery.add(conjunction);
  List<Layout> layouts=LayoutLocalServiceUtil.dynamicQuery(dynamicQuery);
  boolean exportLayoutPrototypes=portletDataContext.getBooleanParameter("layout_set_prototypes","page-templates");
  for (  Layout layout : layouts) {
    String layoutPrototypeUuid=layout.getLayoutPrototypeUuid();
    LayoutPrototype layoutPrototype=LayoutPrototypeLocalServiceUtil.getLayoutPrototypeByUuidAndCompanyId(layoutPrototypeUuid,portletDataContext.getCompanyId());
    portletDataContext.addReferenceElement(layout,layoutSetPrototypeElement,layoutPrototype,PortletDataContext.REFERENCE_TYPE_DEPENDENCY,!exportLayoutPrototypes);
    if (exportLayoutPrototypes) {
      StagedModelDataHandlerUtil.exportStagedModel(portletDataContext,layoutPrototype);
    }
  }
}
