{
  long userId=portletDataContext.getUserId(layoutSetPrototype.getUserUuid());
  UnicodeProperties settingsProperties=layoutSetPrototype.getSettingsProperties();
  boolean layoutsUpdateable=GetterUtil.getBoolean(settingsProperties.getProperty("layoutsUpdateable"),true);
  ServiceContext serviceContext=portletDataContext.createServiceContext(layoutSetPrototype);
  serviceContext.setAttribute("addDefaultLayout",false);
  LayoutSetPrototype importedLayoutSetPrototype=null;
  if (portletDataContext.isDataStrategyMirror()) {
    LayoutSetPrototype existingLayoutSetPrototype=fetchStagedModelByUuidAndCompanyId(layoutSetPrototype.getUuid(),portletDataContext.getCompanyId());
    if (existingLayoutSetPrototype == null) {
      serviceContext.setUuid(layoutSetPrototype.getUuid());
      importedLayoutSetPrototype=LayoutSetPrototypeLocalServiceUtil.addLayoutSetPrototype(userId,portletDataContext.getCompanyId(),layoutSetPrototype.getNameMap(),layoutSetPrototype.getDescriptionMap(),layoutSetPrototype.isActive(),layoutsUpdateable,serviceContext);
    }
 else {
      importedLayoutSetPrototype=LayoutSetPrototypeLocalServiceUtil.updateLayoutSetPrototype(existingLayoutSetPrototype.getLayoutSetPrototypeId(),layoutSetPrototype.getNameMap(),layoutSetPrototype.getDescriptionMap(),layoutSetPrototype.isActive(),layoutsUpdateable,serviceContext);
    }
  }
 else {
    importedLayoutSetPrototype=LayoutSetPrototypeLocalServiceUtil.addLayoutSetPrototype(userId,portletDataContext.getCompanyId(),layoutSetPrototype.getNameMap(),layoutSetPrototype.getDescriptionMap(),layoutSetPrototype.isActive(),layoutsUpdateable,serviceContext);
  }
  importLayoutPrototypes(portletDataContext,layoutSetPrototype);
  importLayouts(portletDataContext,layoutSetPrototype,importedLayoutSetPrototype,serviceContext);
  portletDataContext.importClassedModel(layoutSetPrototype,importedLayoutSetPrototype);
}
