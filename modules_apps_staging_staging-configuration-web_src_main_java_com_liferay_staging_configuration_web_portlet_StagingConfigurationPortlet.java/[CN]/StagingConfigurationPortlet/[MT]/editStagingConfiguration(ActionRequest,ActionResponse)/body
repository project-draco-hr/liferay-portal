{
  hideDefaultSuccessMessage(actionRequest);
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long liveGroupId=ParamUtil.getLong(actionRequest,"liveGroupId");
  Group liveGroup=_groupLocalService.getGroup(liveGroupId);
  int stagingType=ParamUtil.getInteger(actionRequest,"stagingType");
  boolean branchingPublic=ParamUtil.getBoolean(actionRequest,"branchingPublic");
  boolean branchingPrivate=ParamUtil.getBoolean(actionRequest,"branchingPrivate");
  ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
  boolean forceDisable=ParamUtil.getBoolean(actionRequest,"forceDisable");
  boolean stagedGroup=true;
  if (forceDisable) {
    _groupLocalService.disableStaging(liveGroupId);
  }
 else   if (stagingType == StagingConstants.TYPE_LOCAL_STAGING) {
    stagedGroup=liveGroup.hasStagingGroup();
    _stagingLocalService.enableLocalStaging(themeDisplay.getUserId(),liveGroup,branchingPublic,branchingPrivate,serviceContext);
  }
 else   if (stagingType == StagingConstants.TYPE_REMOTE_STAGING) {
    String remoteAddress=ParamUtil.getString(actionRequest,"remoteAddress");
    int remotePort=ParamUtil.getInteger(actionRequest,"remotePort");
    String remotePathContext=ParamUtil.getString(actionRequest,"remotePathContext");
    boolean secureConnection=ParamUtil.getBoolean(actionRequest,"secureConnection");
    long remoteGroupId=ParamUtil.getLong(actionRequest,"remoteGroupId");
    stagedGroup=liveGroup.isStagedRemotely();
    _stagingLocalService.enableRemoteStaging(themeDisplay.getUserId(),liveGroup,branchingPublic,branchingPrivate,remoteAddress,remotePort,remotePathContext,secureConnection,remoteGroupId,serviceContext);
  }
 else   if (stagingType == StagingConstants.TYPE_NOT_STAGED) {
    _stagingLocalService.disableStaging(liveGroup,serviceContext);
  }
  String redirect=ParamUtil.getString(actionRequest,"redirect");
  if (!stagedGroup) {
    PortletURL portletURL=null;
    if (stagingType == StagingConstants.TYPE_LOCAL_STAGING) {
      portletURL=PortalUtil.getControlPanelPortletURL(actionRequest,liveGroup.getStagingGroup(),StagingProcessesPortletKeys.STAGING_PROCESSES,0,0,PortletRequest.RENDER_PHASE);
    }
 else     if (stagingType == StagingConstants.TYPE_REMOTE_STAGING) {
      portletURL=PortalUtil.getControlPanelPortletURL(actionRequest,liveGroup,StagingProcessesPortletKeys.STAGING_PROCESSES,0,0,PortletRequest.RENDER_PHASE);
    }
    if (portletURL != null) {
      redirect=portletURL.toString();
    }
  }
 else   if (stagingType == StagingConstants.TYPE_NOT_STAGED) {
    PortletURL portletURL=PortalUtil.getControlPanelPortletURL(actionRequest,liveGroup,StagingConfigurationPortletKeys.STAGING_CONFIGURATION,0,0,PortletRequest.RENDER_PHASE);
    portletURL.setParameter("mvcRenderCommandName","staging");
    portletURL.setPortletMode(PortletMode.VIEW);
    portletURL.setWindowState(LiferayWindowState.POP_UP);
    SessionMessages.add(actionRequest,PortalUtil.getPortletId(actionRequest) + "disableStagingOptions",true);
    if (portletURL != null) {
      redirect=portletURL.toString();
    }
  }
  actionRequest.setAttribute(WebKeys.REDIRECT,redirect);
  sendRedirect(actionRequest,actionResponse);
}
