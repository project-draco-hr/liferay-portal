{
  final AtomicInteger statusCode=new AtomicInteger();
  final AtomicReference<String> messageReference=new AtomicReference<String>();
  StubHttpServletResponse stubHttpServletResponse=new StubHttpServletResponse(){
    @Override public boolean isCommitted(){
      return false;
    }
    @Override public void setStatus(    int status,    String message){
      statusCode.set(status);
      messageReference.set(message);
    }
  }
;
  MetaInfoCacheServletResponse metaInfoCacheServletResponse=new MetaInfoCacheServletResponse(stubHttpServletResponse);
  metaInfoCacheServletResponse.setStatus(400,"Bad Page");
  assertEquals(400,metaInfoCacheServletResponse.getStatus());
  assertEquals(400,statusCode.get());
  assertEquals("Bad Page",messageReference.get());
  statusCode.set(0);
  messageReference.set(null);
  metaInfoCacheServletResponse.setStatus(404);
  assertEquals(404,metaInfoCacheServletResponse.getStatus());
  assertEquals(404,statusCode.get());
  assertNull(messageReference.get());
  statusCode.set(0);
  messageReference.set(null);
  metaInfoCacheServletResponse.flushBuffer();
  metaInfoCacheServletResponse.setStatus(500,"After commit");
  assertEquals(404,metaInfoCacheServletResponse.getStatus());
  assertEquals(0,statusCode.get());
  assertNull(messageReference.get());
}
