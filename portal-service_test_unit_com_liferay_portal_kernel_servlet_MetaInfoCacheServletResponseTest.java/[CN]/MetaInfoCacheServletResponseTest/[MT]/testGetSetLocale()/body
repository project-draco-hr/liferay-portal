{
  final AtomicReference<Locale> localeReference=new AtomicReference<Locale>();
  StubHttpServletResponse stubHttpServletResponse=new StubHttpServletResponse(){
    @Override public boolean isCommitted(){
      return false;
    }
    @Override public void setLocale(    Locale locale){
      localeReference.set(locale);
    }
  }
;
  MetaInfoCacheServletResponse metaInfoCacheServletResponse=new MetaInfoCacheServletResponse(stubHttpServletResponse);
  metaInfoCacheServletResponse.setLocale(Locale.ENGLISH);
  Assert.assertEquals(Locale.ENGLISH,metaInfoCacheServletResponse.getLocale());
  Assert.assertEquals(Locale.ENGLISH,localeReference.get());
  localeReference.set(null);
  metaInfoCacheServletResponse.flushBuffer();
  metaInfoCacheServletResponse.setLocale(Locale.FRENCH);
  Assert.assertEquals(Locale.ENGLISH,metaInfoCacheServletResponse.getLocale());
  Assert.assertNull(localeReference.get());
}
