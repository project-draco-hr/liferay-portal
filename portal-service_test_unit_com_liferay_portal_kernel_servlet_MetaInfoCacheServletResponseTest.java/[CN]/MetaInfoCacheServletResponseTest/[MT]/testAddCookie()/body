{
  Cookie cookie1=new Cookie("testCookieName1","testCookieValue1");
  Cookie cookie2=new Cookie("testCookieName2","testCookieValue2");
  final List<Cookie> cookieList=new ArrayList<Cookie>();
  StubHttpServletResponse stubHttpServletResponse=new StubHttpServletResponse(){
    @Override public void addCookie(    Cookie cookie){
      cookieList.add(cookie);
    }
  }
;
  MetaInfoCacheServletResponse metaInfoCacheServletResponse=new MetaInfoCacheServletResponse(stubHttpServletResponse);
  Map<String,Set<Header>> headers=metaInfoCacheServletResponse.getHeaders();
  assertEquals(0,headers.size());
  Collection<String> headerNames=metaInfoCacheServletResponse.getHeaderNames();
  assertEquals(0,headerNames.size());
  assertNull(metaInfoCacheServletResponse.getHeader("Set-Cookie"));
  assertEquals(0,metaInfoCacheServletResponse.getHeaders("Set-Cookie").size());
  metaInfoCacheServletResponse.addCookie(cookie1);
  assertEquals(1,headers.size());
  assertTrue(metaInfoCacheServletResponse.containsHeader("Set-Cookie"));
  Header cookieHeader1=new Header(cookie1);
  Set<Header> cookieHeaders=headers.get("Set-Cookie");
  assertEquals(1,cookieHeaders.size());
  assertTrue(cookieHeaders.contains(cookieHeader1));
  assertEquals(1,cookieList.size());
  assertEquals(cookie1,cookieList.get(0));
  Collection<String> headerStrings=metaInfoCacheServletResponse.getHeaders("Set-Cookie");
  assertEquals(1,headerStrings.size());
  assertTrue(headerStrings.contains(cookieHeader1.toString()));
  assertEquals(cookieHeader1.toString(),metaInfoCacheServletResponse.getHeader("Set-Cookie"));
  assertTrue(headerNames.contains("Set-Cookie"));
  metaInfoCacheServletResponse.addCookie(cookie2);
  assertEquals(1,headers.size());
  assertTrue(metaInfoCacheServletResponse.containsHeader("Set-Cookie"));
  Header cookieHeader2=new Header(cookie2);
  cookieHeaders=headers.get("Set-Cookie");
  assertEquals(2,cookieHeaders.size());
  assertTrue(cookieHeaders.contains(cookieHeader2));
  assertEquals(2,cookieList.size());
  assertEquals(cookie2,cookieList.get(1));
  headerStrings=metaInfoCacheServletResponse.getHeaders("Set-Cookie");
  assertEquals(2,headerStrings.size());
  assertTrue(headerStrings.contains(cookieHeader2.toString()));
}
