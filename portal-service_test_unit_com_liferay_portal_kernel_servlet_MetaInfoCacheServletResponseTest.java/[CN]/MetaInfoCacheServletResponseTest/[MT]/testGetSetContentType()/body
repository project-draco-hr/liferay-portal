{
  final AtomicReference<String> characterEncodingReference=new AtomicReference<String>();
  final AtomicReference<String> contentTypeReference=new AtomicReference<String>();
  StubHttpServletResponse stubHttpServletResponse=new StubHttpServletResponse(){
    @Override public boolean isCommitted(){
      return false;
    }
    @Override public void setCharacterEncoding(    String characterEncoding){
      characterEncodingReference.set(characterEncoding);
    }
    @Override public void setContentType(    String contentType){
      contentTypeReference.set(contentType);
    }
  }
;
  MetaInfoCacheServletResponse metaInfoCacheServletResponse=new MetaInfoCacheServletResponse(stubHttpServletResponse);
  assertNull(metaInfoCacheServletResponse.getContentType());
  metaInfoCacheServletResponse.setContentType(null);
  assertNull(metaInfoCacheServletResponse.getContentType());
  assertNull(contentTypeReference.get());
  metaInfoCacheServletResponse.setContentType(ContentTypes.TEXT_HTML_UTF8);
  assertEquals(StringPool.UTF8,metaInfoCacheServletResponse.getCharacterEncoding());
  assertEquals(StringPool.UTF8,characterEncodingReference.get());
  assertEquals(ContentTypes.TEXT_HTML_UTF8,metaInfoCacheServletResponse.getContentType());
  characterEncodingReference.set(null);
  metaInfoCacheServletResponse.setContentType(ContentTypes.TEXT_HTML);
  assertEquals(StringPool.DEFAULT_CHARSET_NAME,metaInfoCacheServletResponse.getCharacterEncoding());
  assertNull(characterEncodingReference.get());
  assertEquals(ContentTypes.TEXT_HTML,metaInfoCacheServletResponse.getContentType());
  assertEquals(ContentTypes.TEXT_HTML,contentTypeReference.get());
  metaInfoCacheServletResponse.setContentType("text/html; charset0=UTF-8");
  assertEquals(StringPool.DEFAULT_CHARSET_NAME,metaInfoCacheServletResponse.getCharacterEncoding());
  assertNull(characterEncodingReference.get());
  assertEquals(ContentTypes.TEXT_HTML,metaInfoCacheServletResponse.getContentType());
  assertEquals("text/html; charset0=UTF-8",contentTypeReference.get());
  characterEncodingReference.set(null);
  contentTypeReference.set(null);
  metaInfoCacheServletResponse.flushBuffer();
  metaInfoCacheServletResponse.setContentType(ContentTypes.TEXT_HTML_UTF8);
  assertEquals(StringPool.DEFAULT_CHARSET_NAME,metaInfoCacheServletResponse.getCharacterEncoding());
  assertEquals(ContentTypes.TEXT_HTML,metaInfoCacheServletResponse.getContentType());
  assertNull(characterEncodingReference.get());
  assertNull(contentTypeReference.get());
}
