{
  initExport();
  Map<String,List<StagedModel>> dependentStagedModelsMap=new HashMap<>();
  Layout linkedLayout=LayoutTestUtil.addLayout(stagingGroup);
  List<LayoutFriendlyURL> linkedLayoutFriendlyURLs=LayoutFriendlyURLLocalServiceUtil.getLayoutFriendlyURLs(linkedLayout.getPlid());
  addDependentStagedModel(dependentStagedModelsMap,Layout.class,linkedLayout);
  addDependentLayoutFriendlyURLs(dependentStagedModelsMap,linkedLayout);
  Layout layout=LayoutTestUtil.addTypeLinkToLayoutLayout(stagingGroup.getGroupId(),linkedLayout.getLayoutId());
  List<LayoutFriendlyURL> layoutFriendlyURLs=LayoutFriendlyURLLocalServiceUtil.getLayoutFriendlyURLs(layout.getPlid());
  addDependentLayoutFriendlyURLs(dependentStagedModelsMap,layout);
  StagedModelDataHandlerUtil.exportStagedModel(portletDataContext,layout);
  validateExport(portletDataContext,layout,dependentStagedModelsMap);
  initImport();
  ExportImportLifecycleManagerUtil.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_LAYOUT_IMPORT_STARTED,ExportImportLifecycleConstants.PROCESS_FLAG_LAYOUT_STAGING_IN_PROCESS,PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext));
  Layout exportedLayout=(Layout)readExportedStagedModel(layout);
  StagedModelDataHandlerUtil.importStagedModel(portletDataContext,exportedLayout);
  Layout exportedLinkedLayout=(Layout)readExportedStagedModel(linkedLayout);
  StagedModelDataHandlerUtil.importStagedModel(portletDataContext,exportedLinkedLayout);
  ExportImportLifecycleManagerUtil.fireExportImportLifecycleEvent(ExportImportLifecycleConstants.EVENT_LAYOUT_IMPORT_SUCCEEDED,ExportImportLifecycleConstants.PROCESS_FLAG_LAYOUT_STAGING_IN_PROCESS,PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext));
  LayoutLocalServiceUtil.getLayoutByUuidAndGroupId(linkedLayout.getUuid(),liveGroup.getGroupId(),false);
  LayoutFriendlyURL linkedLayoutFriendlyURL=linkedLayoutFriendlyURLs.get(0);
  LayoutFriendlyURLLocalServiceUtil.getLayoutFriendlyURLByUuidAndGroupId(linkedLayoutFriendlyURL.getUuid(),liveGroup.getGroupId());
  LayoutLocalServiceUtil.getLayoutByUuidAndGroupId(layout.getUuid(),liveGroup.getGroupId(),false);
  LayoutFriendlyURL layoutFriendlyURL=layoutFriendlyURLs.get(0);
  LayoutFriendlyURLLocalServiceUtil.getLayoutFriendlyURLByUuidAndGroupId(layoutFriendlyURL.getUuid(),liveGroup.getGroupId());
}
