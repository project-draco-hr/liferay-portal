{
  _group=GroupTestUtil.addGroup();
  long[] classNameIds=TemplateHandlerRegistryUtil.getClassNameIds();
  long resourceClassNameId=PortalUtil.getClassNameId("com.liferay.portlet.display.template.PortletDisplayTemplate");
  DDMTemplate ddmTemplate=DDMTemplateTestUtil.addTemplate(_group.getGroupId(),classNameIds[0],0,resourceClassNameId);
  _layout=LayoutTestUtil.addLayout(_group);
  setPortletDisplayStyle("portlet1",DISPLAY_STYLE_PREFIX_6_2 + ddmTemplate.getUuid());
  setPortletDisplayStyle("portlet2","testDisplayStyle");
  doUpgrade();
  CacheRegistryUtil.clear();
  _layout=LayoutLocalServiceUtil.getLayout(_layout.getPlid());
  Assert.assertEquals(PortletDisplayTemplateManager.DISPLAY_STYLE_PREFIX + ddmTemplate.getTemplateKey(),getPortletDisplayStyle("portlet1"));
  Assert.assertEquals("testDisplayStyle",getPortletDisplayStyle("portlet2"));
}
