{
  String portletId=portlet.getPortletId();
  if (!portlet.isAddDefaultResource()) {
    return false;
  }
  if (!_PORTLET_ADD_DEFAULT_RESOURCE_CHECK_ENABLED) {
    return true;
  }
  String namespace=PortalUtil.getPortletNamespace(portletId);
  String strutsAction=ParamUtil.getString(request,namespace + "struts_action");
  if (Validator.isNull(strutsAction)) {
    strutsAction=ParamUtil.getString(request,"struts_action");
  }
  String requestPortletAuthenticationToken=ParamUtil.getString(request,"p_p_auth");
  if (Validator.isNull(requestPortletAuthenticationToken)) {
    HttpServletRequest originalRequest=PortalUtil.getOriginalServletRequest(request);
    requestPortletAuthenticationToken=ParamUtil.getString(originalRequest,"p_p_auth");
  }
  if (AuthTokenUtil.isValidPortletInvocationToken(request,layout.getPlid(),portletId,strutsAction,requestPortletAuthenticationToken)) {
    return true;
  }
  return false;
}
