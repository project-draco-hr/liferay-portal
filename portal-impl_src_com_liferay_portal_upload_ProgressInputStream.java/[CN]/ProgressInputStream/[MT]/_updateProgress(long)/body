{
  if (bytesRead > 0) {
    _totalRead+=bytesRead;
  }
 else   if (_totalSize > 0) {
    _totalRead=_totalSize;
  }
  int percent=0;
  if (_totalSize > 0) {
    percent=(int)((_totalRead * 100) / _totalSize);
  }
  if (_log.isDebugEnabled()) {
    _log.debug(_totalRead + "/" + _totalSize+ "="+ percent);
  }
  Integer curPercent=(Integer)_portletSession.getAttribute(_getPercentAttributeName(),PortletSession.APPLICATION_SCOPE);
  if ((curPercent == null) || (percent - curPercent.intValue() >= 1)) {
    _portletSession.setAttribute(_getPercentAttributeName(),new Integer(percent),PortletSession.APPLICATION_SCOPE);
  }
}
