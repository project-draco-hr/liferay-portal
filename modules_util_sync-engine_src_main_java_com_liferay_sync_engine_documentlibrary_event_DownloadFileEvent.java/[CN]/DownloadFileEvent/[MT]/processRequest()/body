{
  SyncFile syncFile=(SyncFile)getParameterValue("syncFile");
  Path filePath=Paths.get(syncFile.getFilePathName());
  syncFile.setPreviousModifiedTime(FileUtil.getLastModifiedTime(filePath));
  syncFile.setState(SyncFile.STATE_IN_PROGRESS);
  syncFile.setUiEvent(SyncFile.UI_EVENT_DOWNLOADING);
  SyncFileService.update(syncFile);
  if ((boolean)getParameterValue("batch")) {
    BatchDownloadEvent batchDownloadEvent=BatchEventManager.getBatchDownloadEvent(syncFile);
    if (batchDownloadEvent.addEvent(this)) {
      return;
    }
  }
  StringBuilder sb=new StringBuilder();
  SyncAccount syncAccount=SyncAccountService.fetchSyncAccount(getSyncAccountId());
  sb.append(syncAccount.getUrl());
  sb.append(_URL_PATH);
  sb.append("/");
  sb.append(syncFile.getRepositoryId());
  sb.append("/");
  sb.append(syncFile.getTypeUuid());
  if ((boolean)getParameterValue("patch")) {
    sb.append("?patch=true&sourceVersionId=");
    sb.append(getParameterValue("sourceVersionId"));
    sb.append("&targetVersionId=");
    sb.append(getParameterValue("targetVersionId"));
  }
 else {
    sb.append("?version=");
    sb.append(syncFile.getVersion());
    sb.append("&versionId=");
    sb.append(syncFile.getVersionId());
  }
  HttpGet httpGet=new HttpGet(sb.toString());
  Path tempFilePath=FileUtil.getTempFilePath(syncFile);
  if (ServerInfo.supportsPartialDownloads(getSyncAccountId()) && Files.exists(tempFilePath)) {
    httpGet.setHeader("Range","bytes=" + Files.size(tempFilePath) + "-");
  }
  executeAsynchronousGet(httpGet);
}
