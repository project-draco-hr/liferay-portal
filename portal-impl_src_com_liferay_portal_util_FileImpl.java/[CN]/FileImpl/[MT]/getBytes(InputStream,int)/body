{
  ByteArrayMaker bam=null;
  if (bufferSize <= 0) {
    bam=new ByteArrayMaker();
  }
 else {
    bam=new ByteArrayMaker(bufferSize);
  }
  boolean createBuffered=false;
  try {
    if (!(is instanceof BufferedInputStream)) {
      is=new BufferedInputStream(is);
      createBuffered=true;
    }
    int c=is.read();
    while (c != -1) {
      bam.write(c);
      c=is.read();
    }
  }
  finally {
    if (createBuffered) {
      is.close();
    }
  }
  bam.close();
  return bam.toByteArray();
}
