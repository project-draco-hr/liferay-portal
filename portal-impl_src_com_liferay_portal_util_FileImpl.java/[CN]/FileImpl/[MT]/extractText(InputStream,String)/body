{
  String text=null;
  try {
    if (!is.markSupported()) {
      is=new BufferedInputStream(is);
    }
    String contentType=MimeTypesUtil.getContentType(is,fileExt);
    TextExtractor textExtractor=_textExtractors.get(contentType);
    if (textExtractor != null) {
      if (_log.isInfoEnabled()) {
        _log.info("Using text extractor " + textExtractor.getClass().getName());
      }
      Reader textReader=textExtractor.extractText(is,contentType,null);
      StringBuilder sb=new StringBuilder();
      try {
        char[] buffer=new char[1024];
        int result=-1;
        while ((result=textReader.read(buffer)) != -1) {
          sb.append(buffer,0,result);
        }
      }
  finally {
        try {
          textReader.close();
        }
 catch (        IOException ignore) {
        }
      }
      text=sb.toString();
    }
 else {
      if (contentType.equals(ContentTypes.APPLICATION_ZIP) || contentType.startsWith("application/vnd.openxmlformats-officedocument.")) {
        try {
          POITextExtractor poiTextExtractor=ExtractorFactory.createExtractor(is);
          text=poiTextExtractor.getText();
        }
 catch (        Exception e) {
          if (_log.isWarnEnabled()) {
            _log.warn(e,e);
          }
        }
      }
      if ((text == null) && _log.isInfoEnabled()) {
        _log.info("No text extractor found for extension " + fileExt);
      }
    }
  }
 catch (  Exception e) {
    _log.error(e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Extractor returned text:\n\n" + text);
  }
  if (text == null) {
    text=StringPool.BLANK;
  }
  return text;
}
