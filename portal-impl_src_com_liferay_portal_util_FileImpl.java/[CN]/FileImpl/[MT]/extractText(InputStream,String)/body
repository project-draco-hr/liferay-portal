{
  String text=null;
  try {
    if (!is.markSupported()) {
      is=new BufferedInputStream(is);
    }
    String contentType=MimeTypesUtil.getContentType(is,fileExt);
    TextExtractor textExtractor=_textExtractors.get(contentType);
    if (textExtractor != null) {
      if (_log.isInfoEnabled()) {
        _log.info("Using text extractor " + textExtractor.getClass().getName());
      }
      StringBuilder sb=new StringBuilder();
      UnsyncBufferedReader unsyncBufferedReader=new UnsyncBufferedReader(textExtractor.extractText(is,contentType,null));
      int i=0;
      while ((i=unsyncBufferedReader.read()) != -1) {
        sb.append((char)i);
      }
      unsyncBufferedReader.close();
      text=sb.toString();
    }
 else {
      if (contentType.equals(ContentTypes.APPLICATION_ZIP) || contentType.startsWith("application/vnd.openxmlformats-officedocument.")) {
        try {
          POITextExtractor extractor=ExtractorFactory.createExtractor(is);
          text=extractor.getText();
        }
 catch (        Exception e) {
        }
      }
      if ((text == null) && _log.isInfoEnabled()) {
        _log.info("No text extractor found for extension " + fileExt);
      }
    }
  }
 catch (  Exception e) {
    _log.error(e);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Extractor returned text:\n\n" + text);
  }
  if (text == null) {
    text=StringPool.BLANK;
  }
  return text;
}
