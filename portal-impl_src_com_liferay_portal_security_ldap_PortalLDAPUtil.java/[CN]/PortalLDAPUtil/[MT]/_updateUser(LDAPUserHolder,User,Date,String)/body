{
  User user=null;
  try {
    Calendar birthdayCal=CalendarFactoryUtil.getCalendar();
    birthdayCal.setTime(existingUser.getContact().getBirthday());
    int birthdayMonth=birthdayCal.get(Calendar.MONTH);
    int birthdayDay=birthdayCal.get(Calendar.DAY_OF_MONTH);
    int birthdayYear=birthdayCal.get(Calendar.YEAR);
    data.getContactData().setBirthday(birthdayCal.getTime());
    CompanyThreadLocal.setCompanyId(existingUser.getCompanyId());
    if (data.isUpdatePassword()) {
      UserLocalServiceUtil.updatePassword(existingUser.getUserId(),password,password,data.isPasswordReset(),true);
    }
    user=UserLocalServiceUtil.updateUser(existingUser.getUserId(),password,StringPool.BLANK,StringPool.BLANK,data.isPasswordReset(),data.getReminderQueryQuestion(),data.getReminderQueryAnswer(),data.getScreenName(),data.getEmailAddress(),data.getOpenId(),data.getLanguageId(),data.getTimeZoneId(),data.getGreeting(),data.getComments(),data.getFirstName(),data.getMiddleName(),data.getLastName(),data.getPrefixId(),data.getSuffixId(),data.getMale(),birthdayMonth,birthdayDay,birthdayYear,data.getSmsSn(),data.getAimSn(),data.getFacebookSn(),data.getIcqSn(),data.getJabberSn(),data.getMsnSn(),data.getMySpaceSn(),data.getSkypeSn(),data.getTwitterSn(),data.getYmSn(),data.getJobTitle(),data.getGroupIds(),data.getOrganizationIds(),data.getRoleIds(),data.getUserGroupRoles(),data.getUserGroupIds(),data.getServiceContext());
    _updateExpando(user,data);
    if (ldapUserModifiedDate != null) {
      UserLocalServiceUtil.updateModifiedDate(user.getUserId(),ldapUserModifiedDate);
    }
  }
 catch (  Exception e) {
    _log.error("Error updating user with screen name " + data.getScreenName() + " and email address "+ data.getEmailAddress(),e);
  }
  return user;
}
