{
  long companyId=user.getCompanyId();
  if (!LDAPSettingsUtil.isAuthEnabled(companyId) || !LDAPSettingsUtil.isExportEnabled(companyId)) {
    return;
  }
  if (_converter == null) {
    _converter=(LDAPConverter)Class.forName(PropsValues.LDAP_CONVERTER_IMPL).newInstance();
  }
  if (user.isDefaultUser()) {
    return;
  }
  LdapContext ctx=getContext(companyId);
  try {
    if (ctx == null) {
      return;
    }
    Binding binding=_getUser(user.getCompanyId(),user.getScreenName(),userMappings);
    Name name=new CompositeName();
    if (binding == null) {
      name=_getDNName(userMappings,user.getScreenName(),companyId);
      ctx.bind(name,new LDAPContext(_converter.createLDAPUser(name,userMappings,user)));
      binding=_getUser(user.getCompanyId(),user.getScreenName(),userMappings);
      name=new CompositeName();
    }
    name.add(getNameInNamespace(user.getCompanyId(),binding));
    Modifications mods=_converter.updateLDAPUser(name,userMappings,user,binding);
    ModificationItem[] modItems=mods.getItems();
    ctx.modifyAttributes(name,modItems);
  }
  finally {
    if (ctx != null) {
      ctx.close();
    }
  }
}
