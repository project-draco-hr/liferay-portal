{
  List<SearchResult> searchResults=new ArrayList<SearchResult>();
  SearchControls cons=new SearchControls(SearchControls.SUBTREE_SCOPE,maxResults,0,attributeIds,false,false);
  try {
    byte[] cookie=new byte[0];
    while (cookie != null) {
      if (cookie.length == 0) {
        ldapContext.setRequestControls(new Control[]{new PagedResultsControl(PropsValues.LDAP_PAGE_SIZE,Control.CRITICAL)});
      }
 else {
        ldapContext.setRequestControls(new Control[]{new PagedResultsControl(PropsValues.LDAP_PAGE_SIZE,cookie,Control.CRITICAL)});
      }
      NamingEnumeration<SearchResult> enu=ldapContext.search(baseDN,filter,cons);
      while (enu.hasMoreElements()) {
        searchResults.add(enu.nextElement());
      }
      enu.close();
      cookie=_getCookie(ldapContext.getResponseControls());
    }
  }
 catch (  OperationNotSupportedException onse) {
    ldapContext.setRequestControls(null);
    NamingEnumeration<SearchResult> enu=ldapContext.search(baseDN,filter,cons);
    while (enu.hasMoreElements()) {
      searchResults.add(enu.nextElement());
    }
    enu.close();
  }
 finally {
    ldapContext.setRequestControls(null);
  }
  return searchResults;
}
