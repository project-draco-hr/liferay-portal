{
  Properties env=new Properties();
  env.put(Context.INITIAL_CONTEXT_FACTORY,PrefsPropsUtil.getString(companyId,PropsKeys.LDAP_FACTORY_INITIAL));
  env.put(Context.PROVIDER_URL,providerURL);
  env.put(Context.SECURITY_PRINCIPAL,principal);
  env.put(Context.SECURITY_CREDENTIALS,credentials);
  env.put(Context.REFERRAL,PrefsPropsUtil.getString(companyId,PropsKeys.LDAP_REFERRAL));
  PropertiesUtil.merge(env,PropsValues.LDAP_CONNECTION);
  LogUtil.debug(_log,env);
  LdapContext ldapContext=null;
  try {
    ldapContext=new InitialLdapContext(env,null);
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn("Failed to bind to the LDAP server");
    }
    if (_log.isDebugEnabled()) {
      _log.debug(e,e);
    }
  }
  return ldapContext;
}
