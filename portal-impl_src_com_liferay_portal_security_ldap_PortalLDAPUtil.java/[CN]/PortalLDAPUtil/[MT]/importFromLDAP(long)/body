{
  if (!LDAPSettingsUtil.isImportEnabled(companyId)) {
    return;
  }
  LdapContext ctx=getContext(companyId);
  if (ctx == null) {
    return;
  }
  try {
    String importMethod=PrefsPropsUtil.getString(companyId,PropsKeys.LDAP_IMPORT_METHOD);
    if (importMethod.equals(IMPORT_BY_USER)) {
      List<SearchResult> results=_getUsers(companyId,ctx,0);
      for (      SearchResult result : results) {
        Attributes attributes=getUserAttributes(companyId,ctx,getNameInNamespace(companyId,result));
        _importLDAPUserAndGroupMembership(companyId,ctx,attributes,StringPool.BLANK,true);
      }
    }
 else     if (importMethod.equals(IMPORT_BY_GROUP)) {
      List<SearchResult> results=_getGroups(companyId,ctx,0);
      for (      SearchResult result : results) {
        Attributes attributes=_getGroupAttributes(companyId,ctx,getNameInNamespace(companyId,result),true);
        _importLDAPGroup(companyId,ctx,attributes,true);
      }
    }
  }
 catch (  Exception e) {
    _log.error("Error importing LDAP users and groups",e);
  }
 finally {
    ctx.close();
  }
}
