{
  LDAPUserHolder data=_converter.importLDAPUser(attributes,userMappings,customMappings,companyId,password);
  if (data == null) {
    return null;
  }
  User user=_findLiferayUser(data,companyId);
  if (user != null && user.isDefaultUser()) {
    return null;
  }
  Date ldapUserModifiedDate=_getLDAPUserModifiedDate(attributes);
  if (user != null) {
    if (ldapUserModifiedDate != null && ldapUserModifiedDate.equals(user.getModifiedDate()) && data.isAutoPassword()) {
      if (_log.isDebugEnabled()) {
        _log.debug("User is already syncronized, skipping user " + user.getEmailAddress());
      }
      return user;
    }
    if (Validator.isNull(data.getUserData().getScreenName())) {
      data.setAutoScreenName(true);
    }
    if (data.isAutoScreenName()) {
      ScreenNameGenerator screenNameGenerator=(ScreenNameGenerator)InstancePool.get(PropsValues.USERS_SCREEN_NAME_GENERATOR);
      data.getUserData().setScreenName(screenNameGenerator.generate(companyId,user.getUserId(),data.getUserData().getEmailAddress()));
    }
    user=_updateUser(data,user,ldapUserModifiedDate,password);
  }
 else {
    user=_createUser(data,companyId,password);
  }
  if (user == null) {
    return user;
  }
  UserIndexer.setEnabled(true);
  try {
    UserIndexer.updateUser(user);
  }
 catch (  SearchException se) {
    _log.error("Indexing " + user.getUserId(),se);
  }
  return user;
}
