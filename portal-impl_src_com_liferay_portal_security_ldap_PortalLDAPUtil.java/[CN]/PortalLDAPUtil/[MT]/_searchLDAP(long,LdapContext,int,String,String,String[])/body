{
  List<SearchResult> results=new ArrayList<SearchResult>();
  SearchControls cons=new SearchControls(SearchControls.SUBTREE_SCOPE,maxResults,0,attributeIds,false,false);
  try {
    byte[] cookie=new byte[0];
    while (cookie != null) {
      if (cookie.length == 0) {
        ctx.setRequestControls(new Control[]{new PagedResultsControl(PropsValues.LDAP_PAGE_SIZE,Control.CRITICAL)});
      }
 else {
        ctx.setRequestControls(new Control[]{new PagedResultsControl(PropsValues.LDAP_PAGE_SIZE,cookie,Control.CRITICAL)});
      }
      NamingEnumeration<SearchResult> enu=ctx.search(baseDN,filter,cons);
      while (enu.hasMoreElements()) {
        results.add(enu.nextElement());
      }
      enu.close();
      cookie=_getCookie(ctx.getResponseControls());
    }
  }
 catch (  OperationNotSupportedException onse) {
    ctx.setRequestControls(new Control[]{});
    NamingEnumeration<SearchResult> enu=ctx.search(baseDN,filter,cons);
    while (enu.hasMoreElements()) {
      results.add(enu.nextElement());
    }
    enu.close();
  }
  return results;
}
