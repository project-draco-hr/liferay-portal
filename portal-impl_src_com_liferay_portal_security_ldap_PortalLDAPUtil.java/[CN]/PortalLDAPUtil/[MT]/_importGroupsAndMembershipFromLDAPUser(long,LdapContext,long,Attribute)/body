{
  UserGroupLocalServiceUtil.clearUserUserGroups(userId);
  for (int i=0; i < attr.size(); i++) {
    String fullGroupDN=(String)attr.get(i);
    Attributes groupAttributes;
    try {
      groupAttributes=_getGroupAttributes(companyId,ctx,fullGroupDN);
    }
 catch (    NameNotFoundException nnfe) {
      _log.error("LDAP group not found with fullGroupDN " + fullGroupDN);
      _log.error(nnfe,nnfe);
      continue;
    }
    UserGroup userGroup=_importLDAPGroup(companyId,ctx,groupAttributes,false);
    if (userGroup != null) {
      if (_log.isDebugEnabled()) {
        _log.debug("Adding " + userId + " to group "+ userGroup.getUserGroupId());
      }
      UserLocalServiceUtil.addUserGroupUsers(userGroup.getUserGroupId(),new long[]{userId});
    }
  }
}
