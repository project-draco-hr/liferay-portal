{
  initExport();
  addStagedModels();
  portletDataContext.setEndDate(getEndDate());
  portletDataHandler.prepareManifestSummary(portletDataContext);
  ManifestSummary manifestSummary=portletDataContext.getManifestSummary();
  Map<String,LongWrapper> modelAdditionCounters=manifestSummary.getModelAdditionCounters();
  Map<String,LongWrapper> initialModelDeletionCounters=new HashMap<String,LongWrapper>(modelAdditionCounters);
  removeUnsupportedDeletionSystemEventStagedModelTypes(initialModelDeletionCounters);
  modelAdditionCounters.clear();
  portletDataHandler.exportData(portletDataContext,portletId,new PortletPreferencesImpl());
  deleteStagedModels();
  portletDataContext.setEndDate(getEndDate());
  portletDataHandler.prepareManifestSummary(portletDataContext);
  Map<String,LongWrapper> modelDeletionCounters=manifestSummary.getModelDeletionCounters();
  removeUnsupportedDeletionSystemEventStagedModelTypes(modelDeletionCounters);
  checkCounters(initialModelDeletionCounters,modelDeletionCounters);
  modelDeletionCounters.clear();
  DeletionSystemEventExporter deletionSystemEventExporter=new DeletionSystemEventExporter();
  deletionSystemEventExporter.exportDeletionSystemEvents(portletDataContext);
  checkDeletions(initialModelDeletionCounters);
}
