{
  initExport();
  addStagedModels();
  portletDataContext.setEndDate(getEndDate());
  portletDataHandler.prepareManifestSummary(portletDataContext);
  ManifestSummary manifestSummary=portletDataContext.getManifestSummary();
  Map<String,LongWrapper> modelAdditionCounters=manifestSummary.getModelAdditionCounters();
  Map<String,LongWrapper> initialModelAdditionCounters=new HashMap<String,LongWrapper>(modelAdditionCounters);
  modelAdditionCounters.clear();
  portletDataHandler.exportData(portletDataContext,portletId,new PortletPreferencesImpl());
  Set<String> classNames=initialModelAdditionCounters.keySet();
  Iterator<String> iterator=classNames.iterator();
  while (iterator.hasNext()) {
    String className=iterator.next();
    LongWrapper counter=initialModelAdditionCounters.get(className);
    if (counter.getValue() == 0) {
      iterator.remove();
    }
  }
  checkCounters(manifestSummary.getModelAdditionCounters(),initialModelAdditionCounters);
}
