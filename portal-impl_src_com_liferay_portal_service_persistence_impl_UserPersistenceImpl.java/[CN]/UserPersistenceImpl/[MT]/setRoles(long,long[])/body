{
  Set<Long> newRolePKsSet=SetUtil.fromArray(rolePKs);
  Set<Long> oldRolePKsSet=SetUtil.fromArray(userToRoleTableMapper.getRightPrimaryKeys(pk));
  Set<Long> removeRolePKsSet=new HashSet<Long>(oldRolePKsSet);
  removeRolePKsSet.removeAll(newRolePKsSet);
  long[] removeRolePKs=new long[removeRolePKsSet.size()];
  int i=0;
  for (  long removeRolePK : removeRolePKsSet) {
    removeRolePKs[i++]=removeRolePK;
  }
  userToRoleTableMapper.deleteTableMappings(pk,removeRolePKs);
  newRolePKsSet.removeAll(oldRolePKsSet);
  long[] newRolePKs=new long[newRolePKsSet.size()];
  i=0;
  for (  long newRolePK : newRolePKsSet) {
    newRolePKs[i++]=newRolePK;
  }
  long companyId=0;
  User user=fetchByPrimaryKey(pk);
  if (user == null) {
    companyId=companyProvider.getCompanyId();
  }
 else {
    companyId=user.getCompanyId();
  }
  userToRoleTableMapper.addTableMappings(companyId,pk,newRolePKs);
}
