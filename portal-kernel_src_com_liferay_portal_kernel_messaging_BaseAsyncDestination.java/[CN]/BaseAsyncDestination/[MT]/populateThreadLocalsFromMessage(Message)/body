{
  long companyId=message.getLong("companyId");
  if (companyId > 0) {
    CompanyThreadLocal.setCompanyId(companyId);
  }
  Boolean clusterInvoke=(Boolean)message.get("clusterInvoke");
  if (clusterInvoke != null) {
    ClusterInvokeThreadLocal.setEnabled(clusterInvoke);
  }
  Locale defaultLocale=(Locale)message.get("defaultLocale");
  if (defaultLocale != null) {
    LocaleThreadLocal.setDefaultLocale(defaultLocale);
  }
  long groupId=message.getLong("groupId");
  if (groupId > 0) {
    GroupThreadLocal.setGroupId(groupId);
  }
  PermissionChecker permissionChecker=(PermissionChecker)message.get("permissionChecker");
  String principalName=message.getString("principalName");
  if (Validator.isNotNull(principalName)) {
    PrincipalThreadLocal.setName(principalName);
  }
  if ((permissionChecker == null) && Validator.isNotNull(principalName)) {
    try {
      User user=UserLocalServiceUtil.fetchUser(PrincipalThreadLocal.getUserId());
      permissionChecker=PermissionCheckerFactoryUtil.create(user);
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
  }
  if (permissionChecker != null) {
    PermissionThreadLocal.setPermissionChecker(permissionChecker);
  }
  String principalPassword=message.getString("principalPassword");
  if (Validator.isNotNull(principalPassword)) {
    PrincipalThreadLocal.setPassword(principalPassword);
  }
  Locale siteDefaultLocale=(Locale)message.get("siteDefaultLocale");
  if (siteDefaultLocale != null) {
    LocaleThreadLocal.setSiteDefaultLocale(siteDefaultLocale);
  }
  Locale themeDisplayLocale=(Locale)message.get("themeDisplayLocale");
  if (themeDisplayLocale != null) {
    LocaleThreadLocal.setThemeDisplayLocale(themeDisplayLocale);
  }
}
