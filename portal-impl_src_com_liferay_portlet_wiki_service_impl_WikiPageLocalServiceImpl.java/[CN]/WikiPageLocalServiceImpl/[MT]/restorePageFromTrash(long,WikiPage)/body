{
  String title=page.getTitle();
  String originalTitle=TrashUtil.getOriginalTitle(title);
  List<WikiPage> redirectPages=wikiPagePersistence.findByN_R(page.getNodeId(),page.getTitle());
  for (  WikiPage redirectPage : redirectPages) {
    redirectPage.setRedirectTitle(originalTitle);
    wikiPagePersistence.update(redirectPage);
  }
  List<WikiPage> versionPages=wikiPagePersistence.findByR_N_H(page.getResourcePrimKey(),page.getNodeId(),false);
  for (  WikiPage versionPage : versionPages) {
    versionPage.setTitle(originalTitle);
    wikiPagePersistence.update(versionPage);
  }
  WikiPageResource pageResource=wikiPageResourcePersistence.fetchByPrimaryKey(page.getResourcePrimKey());
  pageResource.setTitle(originalTitle);
  wikiPageResourcePersistence.update(pageResource);
  page.setTitle(originalTitle);
  wikiPagePersistence.update(page);
  TrashEntry trashEntry=trashEntryLocalService.getEntry(WikiPage.class.getName(),page.getResourcePrimKey());
  updateStatus(userId,page,trashEntry.getStatus(),new ServiceContext());
  List<WikiPage> children=wikiPagePersistence.findByN_P(page.getNodeId(),title);
  for (  WikiPage curPage : children) {
    curPage.setParentTitle(originalTitle);
    wikiPagePersistence.update(curPage);
    if (curPage.isInTrash()) {
      restorePageFromTrash(userId,curPage);
    }
  }
  JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
  extraDataJSONObject.put("title",page.getTitle());
  extraDataJSONObject.put("version",page.getVersion());
  socialActivityLocalService.addActivity(userId,page.getGroupId(),WikiPage.class.getName(),page.getResourcePrimKey(),SocialActivityConstants.TYPE_RESTORE_FROM_TRASH,extraDataJSONObject.toString(),0);
}
