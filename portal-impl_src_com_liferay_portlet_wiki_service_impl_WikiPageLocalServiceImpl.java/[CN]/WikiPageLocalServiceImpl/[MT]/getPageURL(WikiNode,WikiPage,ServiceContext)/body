{
  HttpServletRequest request=serviceContext.getRequest();
  if (request == null) {
    return StringPool.BLANK;
  }
  String layoutFullURL=getLayoutURL(node.getGroupId(),PortletKeys.WIKI,serviceContext);
  if (Validator.isNotNull(layoutFullURL)) {
    return layoutFullURL + Portal.FRIENDLY_URL_SEPARATOR + "wiki/"+ node.getNodeId()+ StringPool.SLASH+ HttpUtil.encodeURL(page.getTitle());
  }
 else {
    long controlPanelPlid=PortalUtil.getControlPanelPlid(serviceContext.getCompanyId());
    PortletURL portletURL=PortletURLFactoryUtil.create(request,PortletKeys.WIKI_ADMIN,controlPanelPlid,PortletRequest.RENDER_PHASE);
    portletURL.setParameter("struts_action","/wiki_admin/view_page_activities");
    portletURL.setParameter("nodeId",String.valueOf(node.getNodeId()));
    portletURL.setParameter("title",page.getTitle());
    return portletURL.toString();
  }
}
