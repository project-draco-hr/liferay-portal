{
  if (previousVersionPage == null) {
    return StringPool.BLANK;
  }
  HttpServletRequest request=serviceContext.getRequest();
  if (request == null) {
    return StringPool.BLANK;
  }
  String portletId=null;
  long plid=LayoutConstants.DEFAULT_PLID;
  String strutsAction=null;
  if (serviceContext.getPlid() != LayoutConstants.DEFAULT_PLID) {
    portletId=PortletKeys.WIKI;
    plid=serviceContext.getPlid();
    strutsAction="/wiki/compare_versions";
  }
 else {
    portletId=PortletKeys.WIKI_ADMIN;
    plid=PortalUtil.getControlPanelPlid(serviceContext.getCompanyId());
    strutsAction="/wiki_admin/compare_versions";
  }
  PortletURL portletURL=PortletURLFactoryUtil.create(request,portletId,plid,PortletRequest.RENDER_PHASE);
  portletURL.setParameter("struts_action",strutsAction);
  portletURL.setParameter("nodeId",String.valueOf(node.getNodeId()));
  portletURL.setParameter("title",page.getTitle());
  portletURL.setParameter("sourceVersion",String.valueOf(previousVersionPage.getVersion()));
  portletURL.setParameter("targetVersion",String.valueOf(page.getVersion()));
  portletURL.setParameter("type","html");
  return portletURL.toString();
}
