{
  List<WikiPage> children=wikiPagePersistence.findByN_P(page.getNodeId(),page.getTitle());
  for (  WikiPage curPage : children) {
    deletePage(curPage);
  }
  try {
    Indexer.deletePage(page.getCompanyId(),page.getNodeId(),page.getTitle());
  }
 catch (  SearchException se) {
    _log.error("Deleting index " + page.getPrimaryKey(),se);
  }
  long companyId=page.getCompanyId();
  String portletId=CompanyConstants.SYSTEM_STRING;
  long repositoryId=CompanyConstants.SYSTEM;
  String dirName=page.getAttachmentsDir();
  try {
    dlService.deleteDirectory(companyId,portletId,repositoryId,dirName);
  }
 catch (  NoSuchDirectoryException nsde) {
  }
catch (  RemoteException re) {
    throw new SystemException(re);
  }
  tagsAssetLocalService.deleteAsset(WikiPage.class.getName(),page.getResourcePrimKey());
  subscriptionLocalService.deleteSubscriptions(page.getCompanyId(),WikiPage.class.getName(),page.getPageId());
  socialActivityLocalService.deleteActivities(WikiPage.class.getName(),page.getResourcePrimKey());
  mbMessageLocalService.deleteDiscussionMessages(WikiPage.class.getName(),page.getResourcePrimKey());
  resourceLocalService.deleteResource(page.getCompanyId(),WikiPage.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,page.getResourcePrimKey());
  try {
    wikiPageResourceLocalService.deletePageResource(page.getNodeId(),page.getTitle());
  }
 catch (  NoSuchPageResourceException nspre) {
  }
  wikiPagePersistence.removeByN_T(page.getNodeId(),page.getTitle());
  wikiPagePersistence.removeByN_R(page.getNodeId(),page.getTitle());
  clearReferralsCache(page);
}
