{
  WikiPage page=getPage(nodeId,title);
  Folder folder=page.addAttachmentsFolder();
  FileEntry fileEntry=PortletFileRepositoryUtil.addPortletFileEntry(page.getGroupId(),userId,WikiPage.class.getName(),page.getResourcePrimKey(),PortletKeys.WIKI,folder.getFolderId(),file,fileName,mimeType);
  if (userId == 0) {
    userId=page.getUserId();
  }
  JSONObject extraDataJSONObject=JSONFactoryUtil.createJSONObject();
  extraDataJSONObject.put("fileEntryId",fileEntry.getFileEntryId());
  extraDataJSONObject.put("title",fileEntry.getTitle());
  socialActivityLocalService.addActivity(userId,page.getGroupId(),WikiPage.class.getName(),page.getResourcePrimKey(),SocialActivityConstants.TYPE_ADD_ATTACHMENT,extraDataJSONObject.toString(),0);
}
