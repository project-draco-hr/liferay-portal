{
  boolean addDraftAssetEntry=false;
  if (!page.isApproved() && (page.getVersion() != WikiPageConstants.VERSION_DEFAULT)) {
    int approvedPagesCount=wikiPagePersistence.countByN_T_S(page.getNodeId(),page.getTitle(),WorkflowConstants.STATUS_APPROVED);
    if (approvedPagesCount > 0) {
      addDraftAssetEntry=true;
    }
  }
  AssetEntry assetEntry=null;
  if (addDraftAssetEntry) {
    assetEntry=assetEntryLocalService.updateEntry(userId,page.getGroupId(),WikiPage.class.getName(),page.getPrimaryKey(),page.getUuid(),0,assetCategoryIds,assetTagNames,false,null,null,null,null,ContentTypes.TEXT_HTML,page.getTitle(),null,null,null,null,0,0,null,false);
  }
 else {
    assetEntry=assetEntryLocalService.updateEntry(userId,page.getGroupId(),WikiPage.class.getName(),page.getResourcePrimKey(),page.getUuid(),0,assetCategoryIds,assetTagNames,page.isApproved(),null,null,null,null,ContentTypes.TEXT_HTML,page.getTitle(),null,null,null,null,0,0,null,false);
  }
  assetLinkLocalService.updateLinks(userId,assetEntry.getEntryId(),assetLinkEntryIds,AssetLinkConstants.TYPE_RELATED);
}
