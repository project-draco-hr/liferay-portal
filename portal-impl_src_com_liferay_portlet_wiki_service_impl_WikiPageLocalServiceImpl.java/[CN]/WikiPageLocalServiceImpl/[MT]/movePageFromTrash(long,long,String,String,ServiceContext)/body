{
  WikiPage page=getPage(nodeId,title);
  TrashEntry trashEntry=null;
  WikiPage trashEntryPage=page.getParentPage();
  while (trashEntry == null) {
    trashEntry=trashEntryLocalService.fetchEntry(WikiPage.class.getName(),trashEntryPage.getResourcePrimKey());
    if (trashEntry == null) {
      trashEntryPage=trashEntryPage.getParentPage();
      if (trashEntryPage == null) {
        throw new NoSuchPageException();
      }
    }
  }
  String originalTitle=TrashUtil.getOriginalTitle(page.getTitle());
  String trashTitle=page.getTitle();
  WikiPageResource pageResource=wikiPageResourcePersistence.findByPrimaryKey(page.getResourcePrimKey());
  pageResource.setTitle(originalTitle);
  wikiPageResourcePersistence.update(pageResource);
  page.setTitle(originalTitle);
  page.setStatus(WorkflowConstants.STATUS_APPROVED);
  wikiPagePersistence.update(page);
  changeParent(userId,nodeId,originalTitle,newParentTitle,serviceContext);
  page=getPage(page.getResourcePrimKey());
  TrashVersion trashVersion=trashVersionLocalService.fetchVersion(trashEntry.getEntryId(),WikiPage.class.getName(),page.getPageId());
  if (trashVersion != null) {
    trashVersionLocalService.deleteTrashVersion(trashVersion);
  }
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(WikiPage.class);
  indexer.reindex(page);
  restoreDependentChildPagesFromTrash(page,originalTitle,trashTitle,trashEntry.getEntryId());
  restoreDependentRedirectPagesFromTrash(page,originalTitle,trashTitle,trashEntry.getEntryId());
}
