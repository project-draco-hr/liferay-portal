{
  boolean visible=page.isApproved();
  if (!page.isApproved()) {
    visible=true;
  }
  boolean createDraftAssetEntry=false;
  if (!page.isApproved() && (page.getVersion() != WikiPageConstants.DEFAULT_VERSION)) {
    int approvedPagesCount=wikiPagePersistence.countByN_T_S(page.getNodeId(),page.getTitle(),WorkflowConstants.STATUS_APPROVED);
    if (approvedPagesCount > 0) {
      createDraftAssetEntry=true;
    }
  }
  if (createDraftAssetEntry) {
    assetEntryLocalService.updateEntry(userId,page.getGroupId(),WikiPage.class.getName(),page.getPrimaryKey(),assetCategoryIds,assetTagNames,false,null,null,null,null,ContentTypes.TEXT_HTML,page.getTitle(),null,null,null,0,0,null,false);
  }
 else {
    assetEntryLocalService.updateEntry(userId,page.getGroupId(),WikiPage.class.getName(),page.getResourcePrimKey(),assetCategoryIds,assetTagNames,visible,null,null,null,null,ContentTypes.TEXT_HTML,page.getTitle(),null,null,null,0,0,null,false);
  }
}
