{
  String trashTitle=page.getTitle();
  TrashVersion trashVersion=trashVersionLocalService.fetchVersion(trashEntryId,WikiPage.class.getName(),page.getPageId());
  if (trashVersion != null) {
    String originalTitle=TrashUtil.getOriginalTitle(page.getTitle());
    WikiPageResource pageResource=wikiPageResourcePersistence.findByPrimaryKey(page.getResourcePrimKey());
    pageResource.setTitle(originalTitle);
    wikiPageResourcePersistence.update(pageResource);
    page.setTitle(originalTitle);
    wikiPagePersistence.update(page);
  }
  int oldStatus=WorkflowConstants.STATUS_APPROVED;
  if (trashVersion != null) {
    oldStatus=trashVersion.getStatus();
  }
  List<WikiPage> versionPages=wikiPagePersistence.findByR_N(page.getResourcePrimKey(),page.getNodeId());
  for (  WikiPage versionPage : versionPages) {
    versionPage.setTitle(page.getTitle());
    trashVersion=trashVersionLocalService.fetchVersion(trashEntryId,WikiPage.class.getName(),versionPage.getPageId());
    int versionPageOldStatus=WorkflowConstants.STATUS_APPROVED;
    if (trashVersion != null) {
      versionPageOldStatus=trashVersion.getStatus();
    }
    versionPage.setStatus(versionPageOldStatus);
    wikiPagePersistence.update(versionPage);
    if (trashVersion != null) {
      trashVersionLocalService.deleteTrashVersion(trashVersion);
    }
  }
  if (oldStatus == WorkflowConstants.STATUS_APPROVED) {
    assetEntryLocalService.updateVisible(WikiPage.class.getName(),page.getResourcePrimKey(),true);
  }
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(WikiPage.class);
  indexer.reindex(page);
  restoreDependentChildPagesFromTrash(page,page.getTitle(),trashTitle,trashEntryId);
  restoreDependentRedirectPagesFromTrash(page,page.getTitle(),trashTitle,trashEntryId);
}
