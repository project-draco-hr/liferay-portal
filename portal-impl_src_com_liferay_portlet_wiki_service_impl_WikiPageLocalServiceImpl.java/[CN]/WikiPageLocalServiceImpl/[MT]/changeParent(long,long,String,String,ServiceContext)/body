{
  if (Validator.isNotNull(newParentTitle)) {
    WikiPage parentPage=getPage(nodeId,newParentTitle);
    if (Validator.isNotNull(parentPage.getRedirectTitle())) {
      newParentTitle=parentPage.getRedirectTitle();
    }
  }
  WikiPage page=getPage(nodeId,title);
  String originalParentTitle=page.getParentTitle();
  double version=page.getVersion();
  String content=page.getContent();
  String summary=serviceContext.translate("changed-parent-from-x",originalParentTitle);
  boolean minorEdit=false;
  String format=page.getFormat();
  String redirectTitle=page.getRedirectTitle();
  long[] assetCategoryIds=assetCategoryLocalService.getCategoryIds(WikiPage.class.getName(),page.getResourcePrimKey());
  serviceContext.setAssetCategoryIds(assetCategoryIds);
  serviceContext.setAssetLinkEntryIds(null);
  String[] assetTagNames=assetTagLocalService.getTagNames(WikiPage.class.getName(),page.getResourcePrimKey());
  serviceContext.setAssetTagNames(assetTagNames);
  updatePage(userId,nodeId,title,version,content,summary,minorEdit,format,newParentTitle,redirectTitle,serviceContext);
  List<WikiPage> oldPages=wikiPagePersistence.findByN_T_H(nodeId,title,false);
  for (  WikiPage oldPage : oldPages) {
    oldPage.setParentTitle(originalParentTitle);
    wikiPagePersistence.update(oldPage);
  }
}
