{
  List<Map<String,Object>> imageEditorToolsContexts=new ArrayList<>();
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  List<ImageEditorCapabilityDescriptor> toolImageEditorCapabilityDescriptors=_imageEditorCapabilityTracker.getImageEditorCapabilityDescriptors("tool");
  if (toolImageEditorCapabilityDescriptors == null) {
    return imageEditorToolsContexts;
  }
  List<List<ImageEditorCapabilityDescriptor>> imageEditorCapabilityDescriptorsList=getImageEditorCapabilityDescriptorsList(toolImageEditorCapabilityDescriptors);
  for (  List<ImageEditorCapabilityDescriptor> imageEditorCapabilityDescriptors : imageEditorCapabilityDescriptorsList) {
    Map<String,Object> context=new HashMap<>();
    List<Map<String,Object>> controlContexts=new ArrayList<>();
    String icon=StringPool.BLANK;
    for (    ImageEditorCapabilityDescriptor imageEditorCapabilityDescriptor : imageEditorCapabilityDescriptors) {
      Map<String,Object> controlContext=new HashMap<>();
      ImageEditorCapability imageEditorCapability=imageEditorCapabilityDescriptor.getImageEditorCapability();
      controlContext.put("label",imageEditorCapability.getLabel(themeDisplay.getLocale()));
      ServletContext servletContext=imageEditorCapability.getServletContext();
      controlContext.put("modulePath",servletContext.getContextPath());
      Map<String,Object> properties=imageEditorCapabilityDescriptor.getProperties();
      String variant=GetterUtil.getString(properties.get("com.liferay.frontend.image.editor.capability." + "controls"));
      controlContext.put("variant",variant);
      HttpServletRequest request=PortalUtil.getHttpServletRequest(renderRequest);
      imageEditorCapability.prepareContext(controlContext,request);
      controlContexts.add(controlContext);
      icon=GetterUtil.getString(properties.get("com.liferay.frontend.image.editor.capability.icon"));
    }
    context.put("controls",controlContexts);
    context.put("icon",icon);
    imageEditorToolsContexts.add(context);
  }
  return imageEditorToolsContexts;
}
