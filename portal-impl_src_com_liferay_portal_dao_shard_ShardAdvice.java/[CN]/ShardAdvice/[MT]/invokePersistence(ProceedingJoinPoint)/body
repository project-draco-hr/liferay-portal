{
  Object target=call.getTarget();
  if (target instanceof ClassNamePersistence || target instanceof CompanyPersistence || target instanceof CounterPersistence|| target instanceof ReleasePersistence|| target instanceof ShardPersistence) {
    _shardDataSourceTargetSource.setDataSource(PropsValues.SHARD_DEFAULT);
    _shardSessionFactoryTargetSource.setSessionFactory(PropsValues.SHARD_DEFAULT);
    if (_log.isDebugEnabled()) {
      _log.debug("Using default shard for " + _getSignature(call));
    }
    return call.proceed();
  }
  if (_globalCall.get() == null) {
    _setShardIdByCompany();
    String shardId=_getShardId();
    _shardDataSourceTargetSource.setDataSource(shardId);
    _shardSessionFactoryTargetSource.setSessionFactory(shardId);
    if (_log.isInfoEnabled()) {
      _log.info("Using shardId " + shardId + " for "+ _getSignature(call));
    }
    Object retVal=call.proceed();
    return retVal;
  }
 else {
    return call.proceed();
  }
}
