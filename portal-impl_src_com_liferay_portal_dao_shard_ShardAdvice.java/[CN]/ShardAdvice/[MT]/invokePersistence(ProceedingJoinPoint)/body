{
  Object target=call.getTarget();
  if (target instanceof ClassNamePersistence || target instanceof CompanyPersistence || target instanceof CounterPersistence|| target instanceof ReleasePersistence|| target instanceof ShardPersistence) {
    _shardDataSourceTargetSource.setDataSource(PropsValues.SHARD_DEFAULT_NAME);
    _shardSessionFactoryTargetSource.setSessionFactory(PropsValues.SHARD_DEFAULT_NAME);
    if (_log.isDebugEnabled()) {
      _log.debug("Using default shard for " + _getSignature(call));
    }
    return call.proceed();
  }
  if (_globalCallThreadLocal.get() == null) {
    _setShardNameByCompany();
    String shardName=_getShardName();
    _shardDataSourceTargetSource.setDataSource(shardName);
    _shardSessionFactoryTargetSource.setSessionFactory(shardName);
    if (_log.isInfoEnabled()) {
      _log.info("Using shard name " + shardName + " for "+ _getSignature(call));
    }
    return call.proceed();
  }
 else {
    return call.proceed();
  }
}
