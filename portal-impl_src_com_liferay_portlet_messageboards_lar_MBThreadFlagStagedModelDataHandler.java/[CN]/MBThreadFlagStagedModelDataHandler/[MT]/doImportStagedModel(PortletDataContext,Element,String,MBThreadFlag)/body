{
  long userId=portletDataContext.getUserId(threadFlag.getUserUuid());
  Map<Long,Long> threadIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(MBThread.class);
  long threadId=MapUtil.getLong(threadIds,threadFlag.getThreadId(),threadFlag.getThreadId());
  if (threadId == threadFlag.getThreadId()) {
    long rootMessageId=GetterUtil.getLong(element.attributeValue("root-message-id"));
    String rootMessagePath=StagedModelPathUtil.getPath(portletDataContext,MBMessage.class.getName(),rootMessageId);
    MBMessage rootMessage=(MBMessage)portletDataContext.getZipEntryAsObject(rootMessagePath);
    StagedModelDataHandlerUtil.importStagedModel(portletDataContext,element,rootMessagePath,rootMessage);
    threadId=MapUtil.getLong(threadIds,threadFlag.getThreadId(),threadFlag.getThreadId());
  }
  MBThread thread=MBThreadUtil.fetchByPrimaryKey(threadId);
  if (thread == null) {
    return;
  }
  ServiceContext serviceContext=portletDataContext.createServiceContext(element,threadFlag,MBPortletDataHandler.NAMESPACE);
  MBThreadFlagLocalServiceUtil.addThreadFlag(userId,thread,serviceContext);
}
