{
  MBThread thread=MBThreadLocalServiceUtil.getThread(threadFlag.getThreadId());
  MBMessage rootMessage=MBMessageLocalServiceUtil.getMessage(thread.getRootMessageId());
  if ((rootMessage.getStatus() != WorkflowConstants.STATUS_APPROVED) || (rootMessage.getCategoryId() == MBCategoryConstants.DISCUSSION_CATEGORY_ID)) {
    return;
  }
  Element categoriesElement=elements[0];
  Element messagesElement=elements[1];
  StagedModelDataHandlerUtil.exportStagedModel(portletDataContext,new Element[]{categoriesElement,messagesElement,threadFlagsElement},rootMessage);
  Element threadFlagsElement=elements[2];
  Element threadFlagElement=threadFlagsElement.addElement("thread-flag");
  threadFlagElement.addAttribute("root-message-id",String.valueOf(rootMessage.getMessageId()));
  portletDataContext.addClassedModel(threadFlagElement,StagedModelPathUtil.getPath(threadFlag),threadFlag,MBPortletDataHandler.NAMESPACE);
}
