{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Locale[] locales=LanguageUtil.getAvailableLocales(themeDisplay.getSiteGroupId());
  for (  Locale locale : locales) {
    String languageId=LocaleUtil.toLanguageId(locale);
    String[] ranks=StringUtil.splitLines(ParamUtil.getString(actionRequest,"ranks_" + languageId));
    Map<String,String> map=new TreeMap<String,String>(new NaturalOrderStringComparator());
    for (    String rank : ranks) {
      if (!isValidUserRank(rank)) {
        SessionErrors.add(actionRequest,"userRank");
        return;
      }
      String[] kvp=StringUtil.split(rank,CharPool.EQUAL);
      String kvpName=kvp[0];
      String kvpValue=kvp[1];
      map.put(kvpValue,kvpName);
    }
    ranks=new String[map.size()];
    int count=0;
    for (    Map.Entry<String,String> entry : map.entrySet()) {
      String kvpValue=entry.getKey();
      String kvpName=entry.getValue();
      ranks[count++]=kvpName + StringPool.EQUAL + kvpValue;
    }
    String preferenceName=LocalizationUtil.getPreferencesKey("ranks",languageId);
    setPreference(actionRequest,preferenceName,ranks);
  }
}
