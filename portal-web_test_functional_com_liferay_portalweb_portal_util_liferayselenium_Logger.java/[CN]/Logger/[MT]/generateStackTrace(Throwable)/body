{
  Stack<String> xpathIdStack=(Stack<String>)_xpathIdStack.clone();
  StringBundler sb=new StringBundler();
  sb.append("<p>");
  Queue<String> xpathQueue=new LinkedList<String>();
  while (xpathIdStack.size() > 1) {
    String xpath=generateXpath(xpathIdStack);
    xpathIdStack.pop();
    String commandTag=getLogElementText(xpath + "/div/span[@class='tag'][1]");
    if (!commandTag.equals("echo") && !commandTag.equals("execute") && !commandTag.equals("fail")) {
      continue;
    }
    xpathQueue.add(xpath);
  }
  while (xpathQueue.peek() != null) {
    String xpath=xpathQueue.poll();
    String command=getLogElementText(xpath + "/div/span[@class='quote'][1]");
    command=StringUtil.replace(command,"\"","");
    String commandType=getLogElementText(xpath + "/div/span[@class='attribute'][1]");
    sb.append("Failed Line: ");
    sb.append(commandType);
    sb.append(": <b>");
    sb.append(command);
    sb.append("</b> ");
    if (xpathQueue.peek() != null) {
      String parentXpath=xpathQueue.peek();
      String parentCommand=getLogElementText(parentXpath + "/div/span[@class='quote'][1]");
      parentCommand=StringUtil.replace(parentCommand,"\"","");
      String parentCommandType=getLogElementText(parentXpath + "/div/span[@class='attribute'][1]");
      int x=parentCommand.indexOf("#");
      sb.append("(from ");
      sb.append(parentCommand.substring(0,x));
      sb.append(".");
      sb.append(parentCommandType);
      sb.append(") ");
    }
    String lineNumber=getLogElementText(xpath + "/div/div[@class='line-number']");
    sb.append("at line ");
    sb.append(lineNumber);
    sb.append("<br />");
  }
  String testCaseCommand=getLogElementText(generateXpath(xpathIdStack) + "/div/h3");
  sb.append("in test case command <b>");
  sb.append(testCaseCommand.trim());
  sb.append("</b><br />");
  sb.append("<textarea cols=\"85\" rows=\"7\" wrap=\"off\">");
  sb.append(throwable.getMessage());
  StackTraceElement[] stackTraceElements=throwable.getStackTrace();
  for (  StackTraceElement stackTraceElement : stackTraceElements) {
    String className=stackTraceElement.getClassName();
    if (className.startsWith("com.liferay")) {
      sb.append("&#10;&#9;");
      sb.append(stackTraceElement.toString());
    }
  }
  sb.append("</textarea>");
  sb.append("</p>");
  return sb.toString();
}
