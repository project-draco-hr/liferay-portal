{
  Stack<String> ids=(Stack<String>)_xpathIdStack.clone();
  StringBundler sb=new StringBundler();
  sb.append("<p>");
  List<String> xPaths=new ArrayList<String>();
  while (ids.size() > 1) {
    String xpath=generateXpath(ids);
    ids.pop();
    String commandTag=getLogElementText(xpath + "/div/span[@class='tag'][1]");
    if (!commandTag.equals("execute") && !commandTag.equals("fail") && !commandTag.equals("echo")) {
      continue;
    }
    xPaths.add(xpath);
  }
  Stack<String> xPathsStack=new Stack<String>();
  for (int i=xPaths.size() - 1; i >= 0; i--) {
    String xpath=xPaths.get(i);
    xPathsStack.push(xpath);
  }
  while (!xPathsStack.isEmpty()) {
    String xpath=xPathsStack.pop();
    String commandType=getLogElementText(xpath + "/div/span[@class='attribute'][1]");
    String command=getLogElementText(xpath + "/div/span[@class='quote'][1]");
    command=StringUtil.replace(command,"\"","");
    String lineNumber=getLogElementText(xpath + "/div/div[@class='line-number']");
    String parentFileName="";
    if (!xPathsStack.isEmpty()) {
      String parentXpath=xPathsStack.peek();
      String parentCommandType=getLogElementText(parentXpath + "/div/span[@class='attribute'][1]");
      String parentCommand=getLogElementText(parentXpath + "/div/span[@class='quote'][1]");
      parentCommand=StringUtil.replace(parentCommand,"\"","");
      int x=parentCommand.indexOf("#");
      parentFileName=parentCommand.substring(0,x) + "." + parentCommandType;
    }
    sb.append("Failed Line: ");
    sb.append(commandType);
    sb.append(": <b>");
    sb.append(command);
    sb.append("</b> ");
    if (!parentFileName.equals("")) {
      sb.append("(from ");
      sb.append(parentFileName);
      sb.append(") ");
    }
    sb.append("at line ");
    sb.append(lineNumber);
    sb.append("<br />");
  }
  String testCaseXpath=generateXpath(ids);
  String testCaseCommand=getLogElementText(testCaseXpath + "/div/h3");
  int x=testCaseCommand.indexOf("#");
  String testCaseFileName=testCaseCommand.substring(0,x) + ".testcase";
  sb.append("in test case command <b>");
  sb.append(testCaseCommand.trim());
  sb.append("</b><br />");
  sb.append("<textarea cols=\"85\" rows=\"7\" wrap=\"off\">");
  sb.append(throwable.getMessage());
  StackTraceElement[] stackTraceElements=throwable.getStackTrace();
  for (  StackTraceElement stackTraceElement : stackTraceElements) {
    String className=stackTraceElement.getClassName();
    if (className.startsWith("com.liferay")) {
      sb.append("&#10;");
      sb.append(stackTraceElement.toString());
    }
  }
  sb.append("</textarea>");
  sb.append("</p>");
  return sb.toString();
}
