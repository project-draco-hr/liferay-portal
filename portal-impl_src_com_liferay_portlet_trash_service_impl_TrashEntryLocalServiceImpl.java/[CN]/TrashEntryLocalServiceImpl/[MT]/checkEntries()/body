{
  ActionableDynamicQuery actionableDynamicQuery=trashEntryLocalService.getActionableDynamicQuery();
  actionableDynamicQuery.setPerformActionMethod(new ActionableDynamicQuery.PerformActionMethod(){
    @Override public void performAction(    Object object) throws PortalException {
      TrashEntry entry=(TrashEntry)object;
      Group group=groupLocalService.getGroup(entry.getGroupId());
      Date date=getMaxAge(group);
      if (entry.getCreateDate().before(date) || !TrashUtil.isTrashEnabled(group.getGroupId())) {
        TrashHandler trashHandler=TrashHandlerRegistryUtil.getTrashHandler(entry.getClassName());
        trashHandler.deleteTrashEntry(entry.getClassPK());
      }
    }
  }
);
  actionableDynamicQuery.setTransactionAttribute(BaseActionableDynamicQuery.REQUIRES_NEW_TRANSACTION_ATTRIBUTE);
  actionableDynamicQuery.performActions();
}
