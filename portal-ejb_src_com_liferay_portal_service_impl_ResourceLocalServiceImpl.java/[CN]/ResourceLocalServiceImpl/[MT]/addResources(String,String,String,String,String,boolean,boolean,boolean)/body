{
  validate(companyId,name,portletActions);
  addResource(companyId,name,Resource.TYPE_CLASS,Resource.SCOPE_COMPANY,companyId);
  Group guestGroup=GroupLocalServiceUtil.getGroup(companyId,Group.GUEST);
  addResource(companyId,name,Resource.TYPE_CLASS,Resource.SCOPE_GROUP,guestGroup.getGroupId());
  if (groupId != null) {
    addResource(companyId,name,Resource.TYPE_CLASS,Resource.SCOPE_GROUP,groupId);
  }
  if (primKey != null) {
    Resource resource=addResource(companyId,name,Resource.TYPE_CLASS,Resource.SCOPE_INDIVIDUAL,primKey);
    List permissions=PermissionLocalServiceUtil.addPermissions(companyId,name,resource.getResourceId(),portletActions);
    if (userId != null) {
      UserUtil.addPermissions(userId,permissions);
    }
    if ((groupId != null) && addCommunityPermissions) {
      addCommunityPermissions(groupId,name,resource.getResourceId(),portletActions);
    }
    if (addGuestPermissions) {
      addGuestPermissions(guestGroup.getGroupId(),name,resource.getResourceId(),portletActions);
    }
  }
}
