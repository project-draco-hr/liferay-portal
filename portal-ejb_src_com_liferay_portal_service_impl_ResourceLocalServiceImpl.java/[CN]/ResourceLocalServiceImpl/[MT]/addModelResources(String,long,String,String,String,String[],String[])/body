{
  validate(companyId,name,false);
  addResource(companyId,name,ResourceImpl.SCOPE_COMPANY,companyId);
  Group guestGroup=GroupLocalServiceUtil.getGroup(companyId,GroupImpl.GUEST);
  addResource(companyId,name,ResourceImpl.SCOPE_GROUP,String.valueOf(guestGroup.getGroupId()));
  if ((groupId > 0) && (guestGroup.getGroupId() != groupId)) {
    addResource(companyId,name,ResourceImpl.SCOPE_GROUP,String.valueOf(groupId));
  }
  if (primKey != null) {
    Resource resource=addResource(companyId,name,ResourceImpl.SCOPE_INDIVIDUAL,primKey);
    List permissions=PermissionLocalServiceUtil.addPermissions(companyId,name,resource.getResourceId(),false);
    if (userId != null) {
      UserUtil.addPermissions(userId,permissions);
    }
    if ((groupId > 0) && (communityPermissions != null)) {
      addModelPermissions(groupId,resource.getResourceId(),communityPermissions);
    }
    if (guestPermissions != null) {
      if ((groupId <= 0) || (guestGroup.getGroupId() != groupId)) {
        addModelPermissions(guestGroup.getGroupId(),resource.getResourceId(),guestPermissions);
      }
    }
  }
}
