{
  String portalContextPath=PortalUtil.getPathContext();
  String contextPath=getContextPath();
  if (Validator.isNotNull(portalContextPath) && contextPath.startsWith(portalContextPath)) {
    contextPath=contextPath.substring(portalContextPath.length());
  }
  if (path.startsWith(Portal.PATH_MODULE) && path.startsWith(contextPath)) {
    path=path.substring(contextPath.length());
  }
  if (Validator.isNull(path)) {
    path=StringPool.SLASH;
  }
  if (!isValidPath(path)) {
    return null;
  }
  BundleFilterChain bundleFilterChain=getFilterChain(path);
  if (_servletsByURLPatterns.containsKey(path)) {
    bundleFilterChain.setServlet(_servletsByURLPatterns.get(path));
    return new BundleRequestDispatcher(path,false,path,this,bundleFilterChain);
  }
  String extension=FileUtil.getExtension(path).toLowerCase();
  boolean extensionMapping=false;
  if (Validator.isNotNull(extension)) {
    extension="*.".concat(extension);
    extensionMapping=true;
  }
  path=path.substring(0,path.lastIndexOf(StringPool.SLASH));
  while (path.length() != 0) {
    if (_servletsByURLPatterns.containsKey(path)) {
      bundleFilterChain.setServlet(_servletsByURLPatterns.get(path));
      return new BundleRequestDispatcher(path,false,path,this,bundleFilterChain);
    }
 else     if (_servletsByURLPatterns.containsKey(path.concat(extension))) {
      bundleFilterChain.setServlet(_servletsByURLPatterns.get(path.concat(extension)));
      return new BundleRequestDispatcher(path.concat(extension),true,path,this,bundleFilterChain);
    }
    path=path.substring(0,path.lastIndexOf(StringPool.SLASH));
  }
  if (_servletsByURLPatterns.containsKey(StringPool.SLASH.concat(extension))) {
    bundleFilterChain.setServlet(_servletsByURLPatterns.get(StringPool.SLASH.concat(extension)));
    return new BundleRequestDispatcher(StringPool.SLASH.concat(extension),extensionMapping,path,this,bundleFilterChain);
  }
  if (_servletsByURLPatterns.containsKey(StringPool.SLASH)) {
    bundleFilterChain.setServlet(_servletsByURLPatterns.get(StringPool.SLASH));
    return new BundleRequestDispatcher(StringPool.SLASH,false,path,this,bundleFilterChain);
  }
  return null;
}
