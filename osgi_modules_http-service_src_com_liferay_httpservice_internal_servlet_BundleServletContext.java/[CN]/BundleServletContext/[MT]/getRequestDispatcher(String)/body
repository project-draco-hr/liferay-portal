{
  String pathContext=PortalUtil.getPathContext();
  String contextPath=getContextPath();
  if (Validator.isNotNull(pathContext) && contextPath.startsWith(pathContext)) {
    contextPath=contextPath.substring(pathContext.length());
  }
  if (path.startsWith(Portal.PATH_MODULE) && path.startsWith(contextPath)) {
    path=path.substring(contextPath.length());
  }
  if (Validator.isNull(path)) {
    path=StringPool.SLASH;
  }
  if (!isValidPath(path)) {
    return null;
  }
  BundleFilterChain bundleFilterChain=getFilterChain(path);
  if (_servletsByURLPatterns.containsKey(path)) {
    bundleFilterChain.setServlet(_servletsByURLPatterns.get(path));
    return new BundleRequestDispatcher(path,false,path,this,bundleFilterChain);
  }
  String extensionMapping=FileUtil.getExtension(path).toLowerCase();
  boolean isExtensionMapping=false;
  if (Validator.isNotNull(extensionMapping)) {
    extensionMapping="*.".concat(extensionMapping);
    isExtensionMapping=true;
  }
  path=path.substring(0,path.lastIndexOf(StringPool.SLASH));
  while (path.length() != 0) {
    if (_servletsByURLPatterns.containsKey(path)) {
      bundleFilterChain.setServlet(_servletsByURLPatterns.get(path));
      return new BundleRequestDispatcher(path,false,path,this,bundleFilterChain);
    }
 else     if (_servletsByURLPatterns.containsKey(path.concat(extensionMapping))) {
      bundleFilterChain.setServlet(_servletsByURLPatterns.get(path.concat(extensionMapping)));
      return new BundleRequestDispatcher(path.concat(extensionMapping),true,path,this,bundleFilterChain);
    }
    path=path.substring(0,path.lastIndexOf(StringPool.SLASH));
  }
  if (_servletsByURLPatterns.containsKey(StringPool.SLASH.concat(extensionMapping))) {
    bundleFilterChain.setServlet(_servletsByURLPatterns.get(StringPool.SLASH.concat(extensionMapping)));
    return new BundleRequestDispatcher(StringPool.SLASH.concat(extensionMapping),isExtensionMapping,path,this,bundleFilterChain);
  }
  if (_servletsByURLPatterns.containsKey(StringPool.SLASH)) {
    bundleFilterChain.setServlet(_servletsByURLPatterns.get(StringPool.SLASH));
    return new BundleRequestDispatcher(StringPool.SLASH,false,path,this,bundleFilterChain);
  }
  return null;
}
