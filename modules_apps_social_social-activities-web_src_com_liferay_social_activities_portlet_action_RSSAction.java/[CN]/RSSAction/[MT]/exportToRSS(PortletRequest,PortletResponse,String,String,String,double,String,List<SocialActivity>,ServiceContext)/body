{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  SyndFeed syndFeed=new SyndFeedImpl();
  syndFeed.setDescription(GetterUtil.getString(description,title));
  List<SyndEntry> syndEntries=new ArrayList<SyndEntry>();
  syndFeed.setEntries(syndEntries);
  for (  SocialActivity socialActivity : socialActivities) {
    SocialActivityFeedEntry socialActivityFeedEntry=SocialActivityInterpreterLocalServiceUtil.interpret(StringPool.BLANK,socialActivity,serviceContext);
    if (socialActivityFeedEntry == null) {
      continue;
    }
    SyndEntry syndEntry=new SyndEntryImpl();
    SyndContent syndContent=new SyndContentImpl();
    syndContent.setType(RSSUtil.ENTRY_TYPE_DEFAULT);
    String value=null;
    if (displayStyle.equals(RSSUtil.DISPLAY_STYLE_TITLE)) {
      value=StringPool.BLANK;
    }
 else {
      value=socialActivityFeedEntry.getBody();
    }
    syndContent.setValue(value);
    syndEntry.setDescription(syndContent);
    if (Validator.isNotNull(socialActivityFeedEntry.getLink())) {
      syndEntry.setLink(socialActivityFeedEntry.getLink());
    }
    syndEntry.setPublishedDate(new Date(socialActivity.getCreateDate()));
    syndEntry.setTitle(HtmlUtil.extractText(socialActivityFeedEntry.getTitle()));
    syndEntry.setUri(syndEntry.getLink());
    syndEntries.add(syndEntry);
  }
  syndFeed.setFeedType(RSSUtil.getFeedType(format,version));
  List<SyndLink> syndLinks=new ArrayList<SyndLink>();
  syndFeed.setLinks(syndLinks);
  SyndLink selfSyndLink=new SyndLinkImpl();
  syndLinks.add(selfSyndLink);
  MimeResponse mimeResponse=(MimeResponse)portletResponse;
  ResourceURL rssURL=mimeResponse.createResourceURL();
  rssURL.setParameter(ActionRequest.ACTION_NAME,"rss");
  rssURL.setParameter("feedTitle",title);
  selfSyndLink.setHref(rssURL.toString());
  selfSyndLink.setRel("self");
  SyndLink alternateSyndLink=new SyndLinkImpl();
  syndLinks.add(alternateSyndLink);
  alternateSyndLink.setHref(PortalUtil.getLayoutFullURL(themeDisplay));
  alternateSyndLink.setRel("alternate");
  syndFeed.setPublishedDate(new Date());
  syndFeed.setTitle(title);
  syndFeed.setUri(rssURL.toString());
  return RSSUtil.export(syndFeed);
}
