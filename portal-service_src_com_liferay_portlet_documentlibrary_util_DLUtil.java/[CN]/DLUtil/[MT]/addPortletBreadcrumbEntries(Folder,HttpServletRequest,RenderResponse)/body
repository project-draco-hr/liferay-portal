{
  String strutsAction=ParamUtil.getString(request,"struts_action");
  long groupId=ParamUtil.getLong(request,"groupId");
  PortletURL portletURL=renderResponse.createRenderURL();
  if (strutsAction.equals("/journal/select_document_library") || strutsAction.equals("/document_library/select_file_entry") || strutsAction.equals("/document_library/select_folder")|| strutsAction.equals("/document_library_display/select_folder")) {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    portletURL.setWindowState(LiferayWindowState.POP_UP);
    portletURL.setParameter("struts_action",strutsAction);
    portletURL.setParameter("groupId",String.valueOf(groupId));
    PortalUtil.addPortletBreadcrumbEntry(request,themeDisplay.translate("documents-home"),portletURL.toString());
  }
 else {
    portletURL.setParameter("struts_action","/document_library/view");
  }
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getPortletPreferences(request,PortalUtil.getPortletId(request));
  long defaultFolderId=GetterUtil.getLong(preferences.getValue("rootFolderId",String.valueOf(DLFolderConstants.DEFAULT_PARENT_FOLDER_ID)));
  List<Folder> ancestorFolders=Collections.EMPTY_LIST;
  if (folder.getFolderId() != defaultFolderId) {
    ancestorFolders=folder.getAncestors();
    int indexOfRootFolder=-1;
    for (int i=0; i < ancestorFolders.size(); i++) {
      Folder ancestorFolder=ancestorFolders.get(i);
      if (defaultFolderId == ancestorFolder.getFolderId()) {
        indexOfRootFolder=i;
      }
    }
    if (indexOfRootFolder > -1) {
      ancestorFolders=ancestorFolders.subList(0,indexOfRootFolder);
    }
  }
  Collections.reverse(ancestorFolders);
  for (  Folder ancestorFolder : ancestorFolders) {
    portletURL.setParameter("folderId",String.valueOf(ancestorFolder.getFolderId()));
    PortalUtil.addPortletBreadcrumbEntry(request,ancestorFolder.getName(),portletURL.toString());
  }
  portletURL.setParameter("folderId",String.valueOf(folder.getFolderId()));
  if ((folder.getFolderId() != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) && (folder.getFolderId() != defaultFolderId)) {
    PortalUtil.addPortletBreadcrumbEntry(request,folder.getName(),portletURL.toString());
  }
}
