{
  StringBuilder sb=new StringBuilder();
  if (folder != null) {
    Folder curFolder=folder;
    while (true) {
      sb.insert(0,HttpUtil.encodeURL(curFolder.getName(),true));
      sb.insert(0,StringPool.SLASH);
      if (curFolder.getParentFolderId() == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
        break;
      }
 else {
        curFolder=DLAppLocalServiceUtil.getFolder(curFolder.getParentFolderId());
      }
    }
  }
  if (fileEntry != null) {
    sb.append(StringPool.SLASH);
    sb.append(HttpUtil.encodeURL(fileEntry.getTitle(),true));
  }
  Group group=themeDisplay.getScopeGroup();
  StringBundler webDavURL=new StringBundler(7);
  webDavURL.append(themeDisplay.getPortalURL());
  webDavURL.append(themeDisplay.getPathContext());
  webDavURL.append("/api/secure/webdav");
  if (manualCheckInRequired) {
    webDavURL.append(MANUAL_CHECKIN_REQUIRED_PATH);
  }
  webDavURL.append(group.getFriendlyURL());
  webDavURL.append("/document_library");
  webDavURL.append(sb.toString());
  return webDavURL.toString();
}
