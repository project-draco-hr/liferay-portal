{
  long preferredLDAPServerId=_ldapSettings.getPreferredLDAPServerId(companyId,screenName);
  if ((preferredLDAPServerId >= 0) && hasUser(preferredLDAPServerId,companyId,screenName,emailAddress)) {
    return preferredLDAPServerId;
  }
  List<LDAPServerConfiguration> ldapServerConfigurations=_ldapServerConfigurationProvider.getConfigurations(companyId);
  for (  LDAPServerConfiguration ldapServerConfiguration : ldapServerConfigurations) {
    if (hasUser(ldapServerConfiguration.ldapServerId(),companyId,screenName,emailAddress)) {
      return ldapServerConfiguration.ldapServerId();
    }
  }
  if (!ListUtil.isEmpty(ldapServerConfigurations)) {
    LDAPServerConfiguration ldapServerConfiguration=ldapServerConfigurations.get(0);
    return ldapServerConfiguration.ldapServerId();
  }
  return LDAPServerConfiguration.LDAP_SERVER_ID_DEFAULT;
}
