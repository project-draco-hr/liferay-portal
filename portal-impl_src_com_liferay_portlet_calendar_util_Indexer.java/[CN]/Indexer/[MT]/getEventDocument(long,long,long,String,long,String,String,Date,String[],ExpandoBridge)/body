{
  long scopeGroupId=groupId;
  try {
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    if (group.isLayout()) {
      groupId=group.getParentGroupId();
    }
  }
 catch (  Exception e) {
  }
  userName=PortalUtil.getUserName(userId,userName);
  description=HtmlUtil.extractText(description);
  Document doc=new DocumentImpl();
  doc.addUID(PORTLET_ID,eventId);
  doc.addModifiedDate(displayDate);
  doc.addKeyword(Field.COMPANY_ID,companyId);
  doc.addKeyword(Field.PORTLET_ID,PORTLET_ID);
  doc.addKeyword(Field.GROUP_ID,groupId);
  doc.addKeyword(Field.SCOPE_GROUP_ID,scopeGroupId);
  doc.addKeyword(Field.USER_ID,userId);
  doc.addText(Field.USER_NAME,userName);
  doc.addText(Field.TITLE,title);
  doc.addText(Field.DESCRIPTION,description);
  doc.addKeyword(Field.ASSET_TAG_NAMES,assetTagNames);
  doc.addKeyword(Field.ENTRY_CLASS_NAME,CalEvent.class.getName());
  doc.addKeyword(Field.ENTRY_CLASS_PK,eventId);
  ExpandoBridgeIndexerUtil.addAttributes(doc,expandoBridge);
  return doc;
}
