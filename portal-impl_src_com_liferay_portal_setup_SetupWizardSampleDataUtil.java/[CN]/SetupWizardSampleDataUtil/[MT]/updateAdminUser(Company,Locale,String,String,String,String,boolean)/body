{
  ScreenNameGenerator screenNameGenerator=ScreenNameGeneratorFactory.getInstance();
  String screenName=GetterUtil.getString(PropsValues.DEFAULT_ADMIN_EMAIL_ADDRESS_PREFIX,"test");
  try {
    screenName=screenNameGenerator.generate(0,0,adminEmailAddress);
  }
 catch (  Exception e) {
  }
  User adminUser=UserLocalServiceUtil.fetchUserByEmailAddress(company.getCompanyId(),adminEmailAddress);
  if (adminUser != null) {
    FullNameGenerator fullNameGenerator=FullNameGeneratorFactory.getInstance();
    String adminFullName=fullNameGenerator.getFullName(adminFirstName,null,adminLastName);
    String greeting=LanguageUtil.format(locale,"welcome-x",adminFullName,false);
    Contact contact=adminUser.getContact();
    Calendar birthdayCal=CalendarFactoryUtil.getCalendar();
    birthdayCal.setTime(contact.getBirthday());
    int birthdayMonth=birthdayCal.get(Calendar.MONTH);
    int birthdayDay=birthdayCal.get(Calendar.DAY_OF_MONTH);
    int birthdayYear=birthdayCal.get(Calendar.YEAR);
    adminUser=UserLocalServiceUtil.updateUser(adminUser.getUserId(),StringPool.BLANK,StringPool.BLANK,StringPool.BLANK,false,adminUser.getReminderQueryQuestion(),adminUser.getReminderQueryAnswer(),screenName,adminEmailAddress,adminUser.getFacebookId(),adminUser.getOpenId(),false,null,languageId,adminUser.getTimeZoneId(),greeting,adminUser.getComments(),adminFirstName,adminUser.getMiddleName(),adminLastName,contact.getPrefixId(),contact.getSuffixId(),contact.isMale(),birthdayMonth,birthdayDay,birthdayYear,contact.getSmsSn(),contact.getFacebookSn(),contact.getJabberSn(),contact.getSkypeSn(),contact.getTwitterSn(),contact.getJobTitle(),null,null,null,null,null,new ServiceContext());
  }
 else {
    UserLocalServiceUtil.addDefaultAdminUser(company.getCompanyId(),screenName,adminEmailAddress,locale,adminFirstName,StringPool.BLANK,adminLastName);
    adminUser=UserLocalServiceUtil.getUserByEmailAddress(company.getCompanyId(),adminEmailAddress);
    String defaultAdminEmailAddress=PropsValues.DEFAULT_ADMIN_EMAIL_ADDRESS_PREFIX + "@" + PropsValues.COMPANY_DEFAULT_WEB_ID;
    if (!adminEmailAddress.equals(defaultAdminEmailAddress)) {
      User testUser=UserLocalServiceUtil.fetchUserByEmailAddress(company.getCompanyId(),defaultAdminEmailAddress);
      if (testUser != null) {
        UserLocalServiceUtil.updateStatus(testUser.getUserId(),WorkflowConstants.STATUS_INACTIVE,new ServiceContext());
      }
    }
  }
  return UserLocalServiceUtil.updatePasswordReset(adminUser.getUserId(),resetPassword);
}
