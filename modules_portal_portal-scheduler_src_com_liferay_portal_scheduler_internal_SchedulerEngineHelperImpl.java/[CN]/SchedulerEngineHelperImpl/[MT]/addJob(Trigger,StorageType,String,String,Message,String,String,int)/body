{
  if (message == null) {
    message=new Message();
  }
  ClassLoader classLoader=null;
  if (Validator.isNull(portletId)) {
    classLoader=PortalClassLoaderUtil.getClassLoader();
  }
 else {
    Portlet portlet=_portletLocalService.getPortletById(portletId);
    PortletApp portletApp=portlet.getPortletApp();
    ServletContext servletContext=portletApp.getServletContext();
    classLoader=servletContext.getClassLoader();
  }
  if (classLoader == null) {
    throw new SchedulerException("Unable to find class loader for portlet " + portletId);
  }
  SchedulerEntry schedulerEntry=new SchedulerEntryImpl();
  schedulerEntry.setClassLoader(classLoader);
  schedulerEntry.setEventListenerClass(messageListenerClassName);
  message.put(SchedulerEngine.MESSAGE_LISTENER,schedulerEntry.getEventMessageListener());
  message.put(SchedulerEngine.PORTLET_ID,portletId);
  schedule(trigger,storageType,description,destinationName,message,exceptionsMaxSize);
}
