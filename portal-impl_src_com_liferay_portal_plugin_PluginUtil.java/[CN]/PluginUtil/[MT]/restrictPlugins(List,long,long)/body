{
  List<Plugin> visiblePlugins=new ArrayList<Plugin>(plugins.size());
  for (int i=0; i < plugins.size(); i++) {
    Plugin plugin=(Plugin)plugins.get(i);
    PluginSetting pluginSetting=PluginSettingLocalServiceUtil.getPluginSetting(companyId,plugin.getPluginId(),plugin.getPluginType());
    if (pluginSetting.isActive() && pluginSetting.hasPermission(userId)) {
      visiblePlugins.add(plugin);
    }
  }
  return visiblePlugins;
}
