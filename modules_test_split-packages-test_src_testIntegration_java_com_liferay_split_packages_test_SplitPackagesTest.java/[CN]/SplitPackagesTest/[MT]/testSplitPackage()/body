{
  Bundle frameworkBundle=(Bundle)ModuleFrameworkUtilAdapter.getFramework();
  BundleContext frameworkBundleContext=frameworkBundle.getBundleContext();
  Bundle[] frameworkBundles=frameworkBundleContext.getBundles();
  Map<Bundle,Set<ExportPackage>> bundlesMap=new HashMap<>();
  Map<ExportPackage,Set<String>> allowedSplitPackages=_getAllowedSplitPackages();
  for (  Bundle bundle : frameworkBundles) {
    Set<ExportPackage> bundleExportPackages=_getBundleExportPackages(bundle);
    if (bundleExportPackages == null) {
      continue;
    }
    for (    Map.Entry<Bundle,Set<ExportPackage>> entry : bundlesMap.entrySet()) {
      Set<ExportPackage> mapBundlePackages=new HashSet<>(entry.getValue());
      mapBundlePackages.retainAll(bundleExportPackages);
      if (!mapBundlePackages.isEmpty()) {
        _processDuplicatedPackages(entry.getKey(),mapBundlePackages,allowedSplitPackages,bundle);
      }
    }
    bundlesMap.put(bundle,bundleExportPackages);
  }
}
