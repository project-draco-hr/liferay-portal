{
  Bundle frameworkBundle=(Bundle)ModuleFrameworkUtilAdapter.getFramework();
  BundleContext frameworkBundleContext=frameworkBundle.getBundleContext();
  Bundle[] frameworkBundles=frameworkBundleContext.getBundles();
  Map<Bundle,Map<String,Packages>> bundlesMap=new HashMap<>();
  Map<String,Packages> suitableImportsMap=_createSuitableImportsMap();
  for (  Bundle bundle : frameworkBundles) {
    Map<String,Packages> bundleExportPackages=_getBundleExportPackages(bundle);
    if (bundleExportPackages == null) {
      continue;
    }
    for (    Map.Entry<Bundle,Map<String,Packages>> entry : bundlesMap.entrySet()) {
      Map<String,Packages> mapBundlePackages=new HashMap<>(entry.getValue());
      Set<String> keySet=mapBundlePackages.keySet();
      keySet.retainAll(bundleExportPackages.keySet());
      if (!mapBundlePackages.isEmpty()) {
        _processDuplicatedPackages(entry.getKey(),mapBundlePackages.values(),bundleExportPackages,suitableImportsMap,bundle.getSymbolicName());
      }
    }
    bundlesMap.put(bundle,bundleExportPackages);
  }
}
