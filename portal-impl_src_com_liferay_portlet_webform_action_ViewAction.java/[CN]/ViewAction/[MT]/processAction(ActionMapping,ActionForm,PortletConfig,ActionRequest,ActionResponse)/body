{
  PortletConfigImpl configImpl=(PortletConfigImpl)config;
  String portletId=configImpl.getPortletId();
  PortletPreferences prefs=PortletPreferencesFactory.getPortletSetup(req,portletId,true,true);
  boolean requireCaptcha=GetterUtil.getBoolean(prefs.getValue("require-captcha",StringPool.BLANK));
  if (requireCaptcha) {
    try {
      CaptchaUtil.check(req);
    }
 catch (    CaptchaTextException cte) {
      SessionErrors.add(req,CaptchaTextException.class.getName());
    }
  }
  List fieldValues=new ArrayList();
  for (int i=1; i <= 10; i++) {
    fieldValues.add(req.getParameter("field" + i));
  }
  if (validate(fieldValues,prefs)) {
    if (!sendEmail(fieldValues,prefs)) {
      SessionErrors.add(req,"emailNotSent");
    }
 else {
      SessionMessages.add(req,"emailSent");
    }
  }
 else {
    SessionErrors.add(req,"allFieldsRequired");
  }
}
