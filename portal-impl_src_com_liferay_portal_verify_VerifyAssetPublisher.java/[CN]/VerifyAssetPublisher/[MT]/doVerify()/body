{
  List<PortletPreferences> portletPreferences=PortletPreferencesLocalServiceUtil.getPortletPreferencesByPortletId("101_INSTANCE_%");
  for (  PortletPreferences portletPreference : portletPreferences) {
    try {
      long ownerId=portletPreference.getOwnerId();
      int ownerType=portletPreference.getOwnerType();
      long plid=portletPreference.getPlid();
      String portletId=portletPreference.getPortletId();
      String xml=portletPreference.getPreferences();
      Layout layout=LayoutLocalServiceUtil.getLayout(plid);
      long companyId=layout.getCompanyId();
      PortletPreferencesImpl preferences=PortletPreferencesSerializer.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
      String[] assetEntryXmls=preferences.getValues("asset-entry-xml",new String[0]);
      String[] manualEntries=preferences.getValues("manual-entries",new String[0]);
      String selectionStyle=preferences.getValue("selection-style",null);
      if (Validator.isNotNull(selectionStyle) && !selectionStyle.equals("dynamic") && Validator.isNull(assetEntryXmls)&& Validator.isNotNull(manualEntries)) {
        String newPreferences=upgradeManualEntryPreferences(preferences,manualEntries);
        PortletPreferencesLocalServiceUtil.updatePreferences(ownerId,ownerType,plid,portletId,newPreferences);
      }
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
}
