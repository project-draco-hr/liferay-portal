{
  Channel channel=_channels.get(userId);
  if (channel == null) {
synchronized (_channels) {
      channel=_channels.get(userId);
      if (channel == null) {
        if (createIfAbsent) {
          channel=createChannel(userId);
        }
 else {
          throw new UnknownChannelException("No channel exists with user id " + userId);
        }
      }
    }
  }
  return channel;
}
