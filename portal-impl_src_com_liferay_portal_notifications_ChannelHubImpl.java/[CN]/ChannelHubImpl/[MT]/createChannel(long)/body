{
  Lock writeLock=_readWriteLock.writeLock();
  try {
    writeLock.lock();
    if (_channels.containsKey(userId)) {
      throw new DuplicateChannelException("Channel already exists with user id " + userId);
    }
    Channel channel=_channel.clone(_companyId,userId);
    _channels.put(userId,channel);
    channel.init();
    return channel;
  }
  finally {
    writeLock.unlock();
  }
}
