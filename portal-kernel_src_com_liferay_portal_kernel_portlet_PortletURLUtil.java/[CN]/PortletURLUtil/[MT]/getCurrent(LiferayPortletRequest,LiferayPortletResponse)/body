{
  PortletURL portletURL=(PortletURL)liferayPortletRequest.getAttribute(WebKeys.CURRENT_PORTLET_URL);
  if (portletURL != null) {
    return portletURL;
  }
  portletURL=liferayPortletResponse.createRenderURL();
  Enumeration<String> enu=liferayPortletRequest.getParameterNames();
  while (enu.hasMoreElements()) {
    String param=enu.nextElement();
    String[] values=liferayPortletRequest.getParameterValues(param);
    boolean addParam=true;
    for (int i=0; i < values.length; i++) {
      if (values[i].length() > _CURRENT_URL_PARAMETER_THRESHOLD) {
        addParam=false;
        break;
      }
    }
    if (addParam) {
      portletURL.setParameter(param,values);
    }
  }
  liferayPortletRequest.setAttribute(WebKeys.CURRENT_PORTLET_URL,portletURL);
  return portletURL;
}
