{
  if (hasFileKey(filePath,Long.parseLong(fileKey))) {
    return;
  }
  if (OSDetector.isApple()) {
    Xattrj xattrj=getXattrj();
    if (xattrj == null) {
      return;
    }
    File file=filePath.toFile();
    if (!file.canWrite()) {
      file.setWritable(true);
    }
    xattrj.writeAttribute(file,"fileKey",fileKey);
  }
 else {
    File file=filePath.toFile();
    if (!file.canWrite()) {
      file.setWritable(true);
    }
    UserDefinedFileAttributeView userDefinedFileAttributeView=Files.getFileAttributeView(filePath,UserDefinedFileAttributeView.class);
    try {
      userDefinedFileAttributeView.write("fileKey",_CHARSET.encode(CharBuffer.wrap(fileKey)));
    }
 catch (    Exception e) {
      _logger.error(e.getMessage(),e);
    }
  }
}
