{
  try {
    StreamSource scriptSource=new StreamSource(templateResource.getReader());
    Transformer transformer=AccessController.doPrivileged(new TransformerPrivilegedExceptionAction(transformerFactory,scriptSource));
    for (    Map.Entry<String,Object> entry : _context.entrySet()) {
      transformer.setParameter(entry.getKey(),entry.getValue());
    }
    return transformer;
  }
 catch (  PrivilegedActionException pae) {
    throw new TemplateException("Unable to get Transformer for template " + templateResource.getTemplateId(),pae.getException());
  }
catch (  Exception e) {
    throw new TemplateException("Unable to get Transformer for template " + templateResource.getTemplateId(),e);
  }
}
