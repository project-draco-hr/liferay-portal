{
  List<LanguageEntry> languageEntries=new ArrayList<>();
  Map<String,Integer> counts=new HashMap<>();
  for (  Locale locale : locales) {
    Integer count=counts.get(locale.getLanguage());
    if (count == null) {
      count=new Integer(1);
    }
 else {
      count=new Integer(count.intValue() + 1);
    }
    counts.put(locale.getLanguage(),count);
  }
  Set<String> duplicateLanguages=new HashSet<>();
  for (  Locale locale : locales) {
    Integer count=counts.get(locale.getLanguage());
    if (count.intValue() != 1) {
      duplicateLanguages.add(locale.getLanguage());
    }
  }
  Locale currentLocale=null;
  if (Validator.isNotNull(_languageId)) {
    currentLocale=LocaleUtil.fromLanguageId(_languageId);
  }
 else {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    currentLocale=themeDisplay.getLocale();
  }
  for (  Locale locale : locales) {
    String url=null;
    if (!LocaleUtil.equals(locale,currentLocale)) {
      url=HttpUtil.setParameter(formAction,parameterName,LocaleUtil.toLanguageId(locale));
    }
 else     if (!displayCurrentLocale) {
      continue;
    }
    languageEntries.add(new LanguageEntry(duplicateLanguages,currentLocale,locale,url));
  }
  return languageEntries;
}
