{
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  long companyId=PortalUtil.getCompanyId(actionRequest);
  InputStream inputStream=null;
  try {
    inputStream=uploadPortletRequest.getFileAsStream("fileName");
    if (inputStream == null) {
      throw new UploadException();
    }
    Company company=CompanyServiceUtil.updateLogo(companyId,inputStream);
    ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
    themeDisplay.setCompany(company);
  }
  finally {
    StreamUtil.cleanUp(inputStream);
  }
}
