{
  StringBundler encodedContent=new StringBundler();
  Matcher commentMatcher=_wikiCommentPattern.matcher(content);
  int start=0;
  int end=0;
  String oldContent="";
  String newContent="";
  while (commentMatcher.find()) {
    end=commentMatcher.start();
    oldContent=content.substring(start,end);
    Matcher wikiLinkMatcher=_wikiLinkPattern.matcher(oldContent);
    newContent=oldContent;
    while (wikiLinkMatcher.find()) {
      String link=wikiLinkMatcher.group();
      String linkValues=wikiLinkMatcher.group(1);
      int index=linkValues.indexOf(CharPool.PIPE);
      String name=linkValues;
      String url=linkValues;
      if (index != -1) {
        name=linkValues.substring(index + 1,linkValues.length());
        url=linkValues.substring(0,index);
      }
      String newLink="[[" + _encodeJSPWikiName(url) + "|"+ name+ "]]";
      newContent=StringUtil.replace(newContent,link,newLink);
    }
    encodedContent.append(newContent);
    encodedContent.append(content.substring(commentMatcher.start(),commentMatcher.end()));
    start=commentMatcher.end();
  }
  if (start != content.length()) {
    encodedContent.append(content.substring(start));
  }
  return encodedContent.toString();
}
