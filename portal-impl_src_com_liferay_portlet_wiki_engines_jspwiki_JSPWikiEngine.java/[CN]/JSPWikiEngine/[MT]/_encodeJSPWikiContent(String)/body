{
  StringBundler encodedContent=new StringBundler();
  Matcher commentMatcher=_wikiCommentPattern.matcher(content);
  int start=0;
  int end=0;
  String oldContent=StringPool.BLANK;
  String newContent=StringPool.BLANK;
  while (commentMatcher.find()) {
    end=commentMatcher.start();
    oldContent=content.substring(start,end);
    Matcher wikiLinkMatcher=_wikiLinkPattern.matcher(oldContent);
    newContent=oldContent;
    while (wikiLinkMatcher.find()) {
      String link=wikiLinkMatcher.group();
      String linkValues=wikiLinkMatcher.group(1);
      String name=linkValues;
      String url=linkValues;
      int pos=linkValues.indexOf(CharPool.PIPE);
      if (pos != -1) {
        name=linkValues.substring(pos + 1);
        url=linkValues.substring(0,pos);
      }
      String newLink="[[" + _encodeJSPWikiName(url) + "|"+ name+ "]]";
      newContent=StringUtil.replace(newContent,link,newLink);
    }
    encodedContent.append(newContent);
    encodedContent.append(content.substring(commentMatcher.start(),commentMatcher.end()));
    start=commentMatcher.end();
  }
  if (start != content.length()) {
    encodedContent.append(content.substring(start));
  }
  return encodedContent.toString();
}
