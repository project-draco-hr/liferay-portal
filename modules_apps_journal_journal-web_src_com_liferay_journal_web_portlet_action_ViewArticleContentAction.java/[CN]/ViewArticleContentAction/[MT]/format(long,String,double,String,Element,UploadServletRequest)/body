{
  List<Element> elements=root.elements();
  for (  Element element : elements) {
    Element dynamicContent=element.element("dynamic-content");
    String elInstanceId=element.attributeValue("instance-id",StringPool.BLANK);
    String elName=element.attributeValue("name",StringPool.BLANK);
    String elType=element.attributeValue("type",StringPool.BLANK);
    String elContent=StringPool.BLANK;
    String elLanguage=StringPool.BLANK;
    if (dynamicContent != null) {
      elContent=dynamicContent.getTextTrim();
      elLanguage=dynamicContent.attributeValue("language-id",StringPool.BLANK);
      if (!elLanguage.equals(StringPool.BLANK)) {
        elLanguage="_" + elLanguage;
      }
    }
    if (elType.equals("image") && Validator.isNull(elContent)) {
      File file=uploadServletRequest.getFile("structure_image_" + elName + elLanguage);
      byte[] bytes=FileUtil.getBytes(file);
      if (ArrayUtil.isNotEmpty(bytes)) {
        long imageId=JournalArticleImageLocalServiceUtil.getArticleImageId(groupId,previewArticleId,version,elInstanceId,elName,elLanguage,true);
        String token=WebServerServletTokenUtil.getToken(imageId);
        dynamicContent.setText("/image/journal/article?img_id=" + imageId + "&t="+ token);
        ImageLocalServiceUtil.updateImage(imageId,bytes);
      }
 else {
        if (Validator.isNotNull(articleId)) {
          long imageId=JournalArticleImageLocalServiceUtil.getArticleImageId(groupId,articleId,version,elInstanceId,elName,elLanguage);
          String token=WebServerServletTokenUtil.getToken(imageId);
          dynamicContent.setText("/image/journal/article?img_id=" + imageId + "&t="+ token);
        }
      }
    }
    format(groupId,articleId,version,previewArticleId,element,uploadServletRequest);
  }
}
