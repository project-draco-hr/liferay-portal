{
  User user=userPersistence.findByPrimaryKey(userId);
  folderId=getFolderId(user.getCompanyId(),folderId);
  DLFolder folder=dlFolderPersistence.findByPrimaryKey(folderId);
  Date now=new Date();
  validate(user,toFolderId,toName);
  long fileShortcutId=counterLocalService.increment();
  DLFileShortcut fileShortcut=dlFileShortcutPersistence.create(fileShortcutId);
  fileShortcut.setUuid(uuid);
  fileShortcut.setCompanyId(user.getCompanyId());
  fileShortcut.setUserId(user.getUserId());
  fileShortcut.setUserName(user.getFullName());
  fileShortcut.setCreateDate(now);
  fileShortcut.setModifiedDate(now);
  fileShortcut.setFolderId(folderId);
  fileShortcut.setToFolderId(toFolderId);
  fileShortcut.setToName(toName);
  dlFileShortcutPersistence.update(fileShortcut,false);
  if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
    addFileShortcutResources(folder,fileShortcut,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
  }
 else {
    addFileShortcutResources(folder,fileShortcut,communityPermissions,guestPermissions);
  }
  folder.setLastPostDate(fileShortcut.getModifiedDate());
  dlFolderPersistence.update(folder,false);
  return fileShortcut;
}
