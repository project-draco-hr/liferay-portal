{
  User user=userPersistence.findByPrimaryKey(userId);
  folderId=getFolderId(user.getCompanyId(),folderId);
  DLFolder folder=dlFolderPersistence.findByPrimaryKey(folderId);
  Date now=new Date();
  validate(user,toFolderId,toName);
  long fileShortcutId=counterLocalService.increment();
  DLFileShortcut fileShortcut=dlFileShortcutPersistence.create(fileShortcutId);
  fileShortcut.setUuid(uuid);
  fileShortcut.setGroupId(folder.getGroupId());
  fileShortcut.setCompanyId(user.getCompanyId());
  fileShortcut.setUserId(user.getUserId());
  fileShortcut.setUserName(user.getFullName());
  fileShortcut.setCreateDate(now);
  fileShortcut.setModifiedDate(now);
  fileShortcut.setFolderId(folderId);
  fileShortcut.setToFolderId(toFolderId);
  fileShortcut.setToName(toName);
  dlFileShortcutPersistence.update(fileShortcut,false);
  if (serviceContext.getAddCommunityPermissions() || serviceContext.getAddGuestPermissions()) {
    addFileShortcutResources(fileShortcut,serviceContext.getAddCommunityPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addFileShortcutResources(fileShortcut,serviceContext.getCommunityPermissions(),serviceContext.getGuestPermissions());
  }
  DLFileEntry fileEntry=dlFileEntryLocalService.getFileEntry(toFolderId,toName);
  copyTagEntries(fileEntry,serviceContext);
  updateAsset(userId,fileShortcut,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames());
  folder.setLastPostDate(fileShortcut.getModifiedDate());
  dlFolderPersistence.update(folder,false);
  return fileShortcut;
}
