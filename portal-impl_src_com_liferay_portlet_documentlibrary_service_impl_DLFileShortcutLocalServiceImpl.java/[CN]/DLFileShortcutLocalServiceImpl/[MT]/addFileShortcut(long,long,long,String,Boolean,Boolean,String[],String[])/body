{
  User user=UserUtil.findByPrimaryKey(userId);
  folderId=getFolderId(user.getCompanyId(),folderId);
  DLFolder folder=DLFolderUtil.findByPrimaryKey(folderId);
  Date now=new Date();
  validate(user,toFolderId,toName);
  long fileShortcutId=CounterLocalServiceUtil.increment();
  DLFileShortcut fileShortcut=DLFileShortcutUtil.create(fileShortcutId);
  fileShortcut.setCompanyId(user.getCompanyId());
  fileShortcut.setUserId(user.getUserId());
  fileShortcut.setUserName(user.getFullName());
  fileShortcut.setCreateDate(now);
  fileShortcut.setModifiedDate(now);
  fileShortcut.setFolderId(folderId);
  fileShortcut.setToFolderId(toFolderId);
  fileShortcut.setToName(toName);
  DLFileShortcutUtil.update(fileShortcut);
  if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
    addFileShortcutResources(folder,fileShortcut,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
  }
 else {
    addFileShortcutResources(folder,fileShortcut,communityPermissions,guestPermissions);
  }
  folder.setLastPostDate(fileShortcut.getModifiedDate());
  DLFolderUtil.update(folder);
  return fileShortcut;
}
