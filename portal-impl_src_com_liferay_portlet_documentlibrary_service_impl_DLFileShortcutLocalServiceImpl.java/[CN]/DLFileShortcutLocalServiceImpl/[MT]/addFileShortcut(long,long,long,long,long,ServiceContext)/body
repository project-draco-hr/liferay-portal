{
  User user=userPersistence.findByPrimaryKey(userId);
  folderId=getFolderId(user.getCompanyId(),folderId);
  Date now=new Date();
  validate(user,toFileEntryId);
  long fileShortcutId=counterLocalService.increment();
  DLFileShortcut fileShortcut=dlFileShortcutPersistence.create(fileShortcutId);
  fileShortcut.setUuid(serviceContext.getUuid());
  fileShortcut.setGroupId(groupId);
  fileShortcut.setCompanyId(user.getCompanyId());
  fileShortcut.setUserId(user.getUserId());
  fileShortcut.setUserName(user.getFullName());
  fileShortcut.setCreateDate(serviceContext.getCreateDate(now));
  fileShortcut.setModifiedDate(serviceContext.getModifiedDate(now));
  fileShortcut.setRepositoryId(repositoryId);
  fileShortcut.setFolderId(folderId);
  fileShortcut.setToFileEntryId(toFileEntryId);
  fileShortcut.setTreePath(fileShortcut.buildTreePath());
  fileShortcut.setActive(true);
  fileShortcut.setStatus(WorkflowConstants.STATUS_APPROVED);
  fileShortcut.setStatusByUserId(userId);
  fileShortcut.setStatusByUserName(user.getFullName());
  fileShortcut.setStatusDate(now);
  dlFileShortcutPersistence.update(fileShortcut);
  if (serviceContext.isAddGroupPermissions() || serviceContext.isAddGuestPermissions()) {
    addFileShortcutResources(fileShortcut,serviceContext.isAddGroupPermissions(),serviceContext.isAddGuestPermissions());
  }
 else {
    addFileShortcutResources(fileShortcut,serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions());
  }
  if (folderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    dlFolderLocalService.updateLastPostDate(folderId,fileShortcut.getModifiedDate());
  }
  FileEntry fileEntry=dlAppLocalService.getFileEntry(toFileEntryId);
  copyAssetTags(fileEntry,serviceContext);
  updateAsset(userId,fileShortcut,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames());
  return fileShortcut;
}
