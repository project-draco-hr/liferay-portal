{
  Map<String,String[]> portletURLParameters=liferayPortletURL.getParameterMap();
  for (  Map.Entry<String,String[]> entry : portletURLParameters.entrySet()) {
    String[] values=entry.getValue();
    if (values.length > 0) {
      routeParameters.put(entry.getKey(),values[0]);
    }
  }
  String portletInstanceKey=liferayPortletURL.getPortletId();
  if (Validator.isNotNull(portletInstanceKey)) {
    routeParameters.put("p_p_id",portletInstanceKey);
    PortletInstance portletInstance=PortletInstance.fromPortletInstanceKey(portletInstanceKey);
    routeParameters.put("userIdAndInstanceId",portletInstance.getUserIdAndInstanceId());
    if (portletInstance.hasInstanceId()) {
      routeParameters.put("instanceId",portletInstance.getInstanceId());
    }
  }
  routeParameters.putAll(liferayPortletURL.getReservedParameterMap());
}
