{
  if (_configuration != null) {
    return;
  }
  _configuration=new Configuration();
  try {
    Field field=ReflectionUtil.getDeclaredField(Configuration.class,"cache");
    TemplateCache templateCache=new LiferayTemplateCache(_configuration,_freemarkerEngineConfiguration,templateResourceLoader);
    field.set(_configuration,templateCache);
  }
 catch (  Exception e) {
    throw new TemplateException("Unable to Initialize FreeMarker manager");
  }
  _configuration.setDefaultEncoding(StringPool.UTF8);
  _configuration.setLocalizedLookup(_freemarkerEngineConfiguration.localizedLookup());
  _configuration.setNewBuiltinClassResolver(_templateClassResolver);
  _configuration.setObjectWrapper(new LiferayObjectWrapper());
  try {
    _configuration.setSetting("auto_import",StringUtil.merge(_freemarkerEngineConfiguration.macroLibrary()));
    _configuration.setSetting("template_exception_handler",_freemarkerEngineConfiguration.templateExceptionHandler());
  }
 catch (  Exception e) {
    throw new TemplateException("Unable to init FreeMarker manager",e);
  }
  if (isEnableDebuggerService()) {
    DebuggerService.getBreakpoints("*");
  }
}
