{
  byte[] data=new byte[1024 * 1024];
  Random random=new Random();
  random.nextBytes(data);
  File fromFile=new File("from-file");
  fromFile.deleteOnExit();
  FileOutputStream fromFileOutputStream=new FileOutputStream(fromFile);
  fromFileOutputStream.write(data);
  fromFileOutputStream.close();
  File toFile=new File("to-file");
  toFile.deleteOnExit();
  FileInputStream fromFileInputStream=new FileInputStream(fromFile);
  byte[] buffer=new byte[data.length / 2];
  int length=0;
  while ((length+=fromFileInputStream.read(buffer,length,buffer.length - length)) < buffer.length)   ;
  FileOutputStream toFileOutputStream=new FileOutputStream(toFile);
  toFileOutputStream.write(buffer);
  FileChannel fromFileChannel=fromFileInputStream.getChannel();
  StreamUtil.transferFileChannel(fromFileChannel,toFileOutputStream.getChannel(),data.length - buffer.length);
  fromFileChannel.close();
  toFileOutputStream.close();
  RandomAccessFile toRandomAccessFile=new RandomAccessFile(toFile,"r");
  Assert.assertEquals(data.length,toRandomAccessFile.length());
  byte[] toData=new byte[data.length];
  toRandomAccessFile.readFully(toData);
  toRandomAccessFile.close();
  Assert.assertArrayEquals(data,toData);
}
