{
  List<Layout> layouts=LayoutLocalServiceUtil.getLayouts(layoutPrototype.getGroupId(),true,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
  long groupId=portletDataContext.getGroupId();
  boolean privateLayout=portletDataContext.isPrivateLayout();
  long scopeGroupId=portletDataContext.getScopeGroupId();
  try {
    portletDataContext.setGroupId(layoutPrototype.getGroupId());
    portletDataContext.setPrivateLayout(true);
    portletDataContext.setScopeGroupId(layoutPrototype.getGroupId());
    for (    Layout layout : layouts) {
      StagedModelDataHandlerUtil.exportReferenceStagedModel(portletDataContext,layoutPrototype,layout,PortletDataContext.REFERENCE_TYPE_EMBEDDED);
    }
  }
  finally {
    portletDataContext.setGroupId(groupId);
    portletDataContext.setPrivateLayout(privateLayout);
    portletDataContext.setScopeGroupId(scopeGroupId);
  }
}
