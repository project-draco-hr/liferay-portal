{
  WikiNode destinationNode=WikiTestUtil.addNode(_group.getGroupId());
  WikiPage page=WikiTestUtil.addPage(TestPropsValues.getUserId(),_group.getGroupId(),_node.getNodeId(),"DuplicatedTitlePage",true);
  WikiTestUtil.addPage(TestPropsValues.getUserId(),_group.getGroupId(),destinationNode.getNodeId(),"DuplicatedTitlePage",true);
  try {
    ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext(_group.getGroupId());
    WikiPageLocalServiceUtil.changeNode(page.getUserId(),_node.getNodeId(),"DuplicatedTitlePage",destinationNode.getNodeId(),serviceContext);
    Assert.fail("Node change should not be performed due title duplication");
  }
 catch (  NodeChangeException nce) {
    Assert.assertEquals(nce.getPageTitle(),"DuplicatedTitlePage");
    Assert.assertEquals(nce.getNodeName(),destinationNode.getName());
    Assert.assertEquals(nce.getType(),NodeChangeException.DUPLICATE_PAGE);
  }
}
