{
  List<Layout> layouts=new ArrayList<>();
  if (layoutIdMap != null) {
    for (    Map.Entry<Long,Boolean> entry : layoutIdMap.entrySet()) {
      long plid=GetterUtil.getLong(String.valueOf(entry.getKey()));
      boolean includeChildren=entry.getValue();
      Layout layout=LayoutLocalServiceUtil.getLayout(plid);
      if (!layouts.contains(layout)) {
        layouts.add(layout);
      }
      List<Layout> parentLayouts=getMissingRemoteParentLayouts(httpPrincipal,layout,remoteGroupId);
      for (      Layout parentLayout : parentLayouts) {
        if (!layouts.contains(parentLayout)) {
          layouts.add(parentLayout);
        }
      }
      if (includeChildren) {
        for (        Layout childLayout : layout.getAllChildren()) {
          if (!layouts.contains(childLayout)) {
            layouts.add(childLayout);
          }
        }
      }
    }
  }
  long[] layoutIds=ExportImportHelperUtil.getLayoutIds(layouts);
  Map<String,Serializable> settingsMap=exportImportConfiguration.getSettingsMap();
  settingsMap.remove("layoutIdMap");
  settingsMap.put("layoutIds",layoutIds);
  return ExportImportLocalServiceUtil.exportLayoutsAsFile(exportImportConfiguration);
}
