{
  Element newElement=null;
  if (timeToLive >= 0) {
    newElement=new Element(key,value,timeToLive);
  }
 else {
    newElement=new Element(key,value);
  }
  while (true) {
    Element oldElement=ehcache.get(key);
    if (oldElement == null) {
      oldElement=ehcache.putIfAbsent(newElement,quiet);
      if (oldElement == null) {
        return;
      }
    }
    V oldValue=(V)oldElement.getObjectValue();
    if ((oldValue != null) && (value.getMvccVersion() <= oldValue.getMvccVersion())) {
      return;
    }
    if (quiet) {
      boolean replicateUpdate=ClusterReplicationThreadLocal.isReplicateUpdate();
      ClusterReplicationThreadLocal.setReplicateUpdate(false);
      try {
        if (ehcache.replace(oldElement,newElement)) {
          return;
        }
      }
  finally {
        ClusterReplicationThreadLocal.setReplicateUpdate(replicateUpdate);
      }
    }
 else     if (ehcache.replace(oldElement,newElement)) {
      return;
    }
  }
}
