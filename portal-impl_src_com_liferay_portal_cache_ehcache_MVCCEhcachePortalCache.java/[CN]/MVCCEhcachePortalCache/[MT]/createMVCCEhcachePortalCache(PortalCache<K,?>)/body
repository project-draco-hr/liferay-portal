{
  if (portalCache instanceof EhcachePortalCache) {
    return new MVCCEhcachePortalCache<K,MVCCModel>((EhcachePortalCache<K,MVCCModel>)portalCache);
  }
  PortalCache<K,?> currentPortalCache=portalCache;
  while (currentPortalCache instanceof PortalCacheWrapper) {
    PortalCacheWrapper<K,MVCCModel> portalCacheWrapper=(PortalCacheWrapper<K,MVCCModel>)currentPortalCache;
    PortalCache<K,MVCCModel> nextPortalCache=portalCacheWrapper.getWrappedPortalCache();
    if (nextPortalCache instanceof EhcachePortalCache) {
      nextPortalCache=new MVCCEhcachePortalCache<K,MVCCModel>((EhcachePortalCache<K,MVCCModel>)nextPortalCache);
      portalCacheWrapper.setPortalCache(nextPortalCache);
      break;
    }
 else {
      currentPortalCache=nextPortalCache;
    }
  }
  return portalCache;
}
