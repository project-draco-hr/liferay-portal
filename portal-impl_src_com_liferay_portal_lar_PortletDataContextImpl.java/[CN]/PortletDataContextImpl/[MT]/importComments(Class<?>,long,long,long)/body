{
  Map<Long,Long> messagePKs=new HashMap<Long,Long>();
  Map<Long,Long> threadPKs=new HashMap<Long,Long>();
  List<MBMessage> messages=_commentsMap.get(getPrimaryKeyString(classObj,classPK));
  if (messages == null) {
    return;
  }
  MBDiscussion discussion=null;
  try {
    discussion=MBDiscussionLocalServiceUtil.getDiscussion(classObj.getName(),newClassPK);
  }
 catch (  NoSuchDiscussionException nsde) {
  }
  for (  MBMessage message : messages) {
    long userId=getUserId(message.getUserUuid());
    long parentMessageId=MapUtil.getLong(messagePKs,message.getParentMessageId(),message.getParentMessageId());
    long threadId=MapUtil.getLong(threadPKs,message.getThreadId(),message.getThreadId());
    if ((message.getParentMessageId() == MBMessageConstants.DEFAULT_PARENT_MESSAGE_ID) && (discussion != null)) {
      MBThread thread=MBThreadLocalServiceUtil.getThread(discussion.getThreadId());
      long rootMessageId=thread.getRootMessageId();
      messagePKs.put(message.getMessageId(),rootMessageId);
      threadPKs.put(message.getThreadId(),thread.getThreadId());
    }
 else {
      MBMessage newMessage=null;
      ServiceContext serviceContext=new ServiceContext();
      serviceContext.setScopeGroupId(groupId);
      if (getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
        MBMessage existingMessage=MBMessageUtil.fetchByUUID_G(message.getUuid(),groupId);
        if (existingMessage == null) {
          newMessage=MBMessageLocalServiceUtil.addDiscussionMessage(message.getUuid(),userId,message.getUserName(),groupId,classObj.getName(),newClassPK,threadId,parentMessageId,message.getSubject(),message.getBody(),serviceContext);
        }
 else {
          newMessage=MBMessageLocalServiceUtil.updateDiscussionMessage(userId,existingMessage.getMessageId(),message.getSubject(),message.getBody(),WorkflowConstants.ACTION_PUBLISH);
        }
      }
 else {
        newMessage=MBMessageLocalServiceUtil.addDiscussionMessage(null,userId,message.getUserName(),groupId,classObj.getName(),newClassPK,threadId,parentMessageId,message.getSubject(),message.getBody(),serviceContext);
      }
      messagePKs.put(message.getMessageId(),newMessage.getMessageId());
      threadPKs.put(message.getThreadId(),newMessage.getThreadId());
    }
    importRatingsEntries(MBMessage.class,message.getPrimaryKey(),messagePKs.get(message.getPrimaryKey()));
  }
}
