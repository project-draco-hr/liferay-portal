{
  element.addAttribute("path",path);
  if (classedModel instanceof AttachedModel) {
    AttachedModel attachedModel=(AttachedModel)classedModel;
    element.addAttribute("class-name",attachedModel.getClassName());
  }
 else   if (BeanUtil.hasProperty(classedModel,"className")) {
    String className=BeanPropertiesUtil.getStringSilent(classedModel,"className");
    if (className != null) {
      element.addAttribute("class-name",className);
    }
  }
  if (isPathProcessed(path)) {
    return;
  }
  if (classedModel instanceof AuditedModel) {
    AuditedModel auditedModel=(AuditedModel)classedModel;
    auditedModel.setUserUuid(auditedModel.getUserUuid());
  }
  if (!isResourceMain(classedModel)) {
    addZipEntry(path,classedModel);
    return;
  }
  Class<?> clazz=classedModel.getModelClass();
  long classPK=getClassPK(classedModel);
  addAssetLinks(clazz,classPK);
  addExpando(element,path,classedModel);
  addLocks(clazz,String.valueOf(classPK));
  addPermissions(clazz,classPK);
  boolean portletMetadataAll=getBooleanParameter(namespace,PortletDataHandlerKeys.PORTLET_METADATA_ALL);
  if (portletMetadataAll || getBooleanParameter(namespace,"categories")) {
    addAssetCategories(clazz,classPK);
  }
  if (portletMetadataAll || getBooleanParameter(namespace,"comments")) {
    addComments(clazz,classPK);
  }
  if (portletMetadataAll || getBooleanParameter(namespace,"ratings")) {
    addRatingsEntries(clazz,classPK);
  }
  if (portletMetadataAll || getBooleanParameter(namespace,"tags")) {
    addAssetTags(clazz,classPK);
  }
  addZipEntry(path,classedModel);
}
