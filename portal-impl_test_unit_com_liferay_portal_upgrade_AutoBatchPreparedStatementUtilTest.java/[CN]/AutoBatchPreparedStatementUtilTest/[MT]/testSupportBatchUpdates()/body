{
  PreparedStatementInvocationHandler preparedStatementInvocationHandler=new PreparedStatementInvocationHandler(true);
  PreparedStatement preparedStatement=AutoBatchPreparedStatementUtil.autoBatch((PreparedStatement)ProxyUtil.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class<?>[]{PreparedStatement.class},preparedStatementInvocationHandler));
  InvocationHandler invocationHandler=ProxyUtil.getInvocationHandler(preparedStatement);
  Assert.assertEquals(0,ReflectionTestUtil.getFieldValue(invocationHandler,"_count"));
  List<Method> methods=preparedStatementInvocationHandler.getMethods();
  Assert.assertTrue(methods.toString(),methods.isEmpty());
  int hibernateJDBCBatchSize=PropsValues.HIBERNATE_JDBC_BATCH_SIZE;
  ReflectionTestUtil.setFieldValue(PropsValues.class,"HIBERNATE_JDBC_BATCH_SIZE",2);
  try {
    Assert.assertArrayEquals(new int[0],preparedStatement.executeBatch());
    Assert.assertTrue(methods.toString(),methods.isEmpty());
    Assert.assertEquals(0,ReflectionTestUtil.getFieldValue(invocationHandler,"_count"));
    preparedStatement.addBatch();
    Assert.assertEquals(methods.toString(),1,methods.size());
    Assert.assertEquals(PreparedStatement.class.getMethod("addBatch"),methods.remove(0));
    Assert.assertEquals(1,ReflectionTestUtil.getFieldValue(invocationHandler,"_count"));
    preparedStatement.addBatch();
    Assert.assertEquals(methods.toString(),2,methods.size());
    Assert.assertEquals(PreparedStatement.class.getMethod("addBatch"),methods.remove(0));
    Assert.assertEquals(PreparedStatement.class.getMethod("executeBatch"),methods.remove(0));
    Assert.assertEquals(0,ReflectionTestUtil.getFieldValue(invocationHandler,"_count"));
    preparedStatement.addBatch();
    Assert.assertEquals(methods.toString(),1,methods.size());
    Assert.assertEquals(PreparedStatement.class.getMethod("addBatch"),methods.remove(0));
    Assert.assertEquals(1,ReflectionTestUtil.getFieldValue(invocationHandler,"_count"));
    preparedStatement.executeBatch();
    Assert.assertEquals(methods.toString(),1,methods.size());
    Assert.assertEquals(PreparedStatement.class.getMethod("executeBatch"),methods.remove(0));
    Assert.assertEquals(0,ReflectionTestUtil.getFieldValue(invocationHandler,"_count"));
    preparedStatement.execute();
    Assert.assertEquals(methods.toString(),1,methods.size());
    Assert.assertEquals(PreparedStatement.class.getMethod("execute"),methods.remove(0));
    Assert.assertEquals(0,ReflectionTestUtil.getFieldValue(invocationHandler,"_count"));
  }
  finally {
    ReflectionTestUtil.setFieldValue(PropsValues.class,"HIBERNATE_JDBC_BATCH_SIZE",hibernateJDBCBatchSize);
  }
}
