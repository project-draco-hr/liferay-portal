{
  ConnectionInvocationHandler connectionInvocationHandler=new ConnectionInvocationHandler(false);
  PreparedStatement preparedStatement=null;
  if (concurrent) {
    preparedStatement=AutoBatchPreparedStatementUtil.concurrentAutoBatch((Connection)ProxyUtil.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class<?>[]{Connection.class},connectionInvocationHandler),StringPool.BLANK);
  }
 else {
    preparedStatement=AutoBatchPreparedStatementUtil.autoBatch((PreparedStatement)ProxyUtil.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class<?>[]{PreparedStatement.class},connectionInvocationHandler.getPSInvocationHandler()));
  }
  List<Method> methods=connectionInvocationHandler.getMethods();
  Assert.assertTrue(methods.toString(),methods.isEmpty());
  preparedStatement.addBatch();
  if (concurrent) {
    Assert.assertEquals(methods.toString(),2,methods.size());
  }
 else {
    Assert.assertEquals(methods.toString(),1,methods.size());
  }
  Assert.assertEquals(PreparedStatement.class.getMethod("executeUpdate"),methods.remove(0));
  if (concurrent) {
    Assert.assertEquals(PreparedStatement.class.getMethod("close"),methods.remove(0));
  }
  Assert.assertArrayEquals(new int[0],preparedStatement.executeBatch());
  Assert.assertTrue(methods.toString(),methods.isEmpty());
  if (concurrent) {
    preparedStatement.close();
    methods=connectionInvocationHandler.getMethods();
    Assert.assertEquals(methods.toString(),1,methods.size());
    Assert.assertEquals(PreparedStatement.class.getMethod("close"),methods.remove(0));
  }
  preparedStatement.execute();
  methods=connectionInvocationHandler.getMethods();
  Assert.assertEquals(methods.toString(),1,methods.size());
  Assert.assertEquals(PreparedStatement.class.getMethod("execute"),methods.remove(0));
}
