{
  ConnectionInvocationHandler connectionInvocationHandler=new ConnectionInvocationHandler(supportBatchUpdates);
  PreparedStatement preparedStatement=AutoBatchPreparedStatementUtil.concurrentAutoBatch((Connection)ProxyUtil.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class<?>[]{Connection.class},connectionInvocationHandler),StringPool.BLANK);
  TestNoticeableFuture<Void> testNoticeableFuture=new TestNoticeableFuture<>();
  Set<Future<Void>> futures=new HashSet<>();
  futures.add(testNoticeableFuture);
  InvocationHandler invocationHandler=ProxyUtil.getInvocationHandler(preparedStatement);
  ReflectionTestUtil.setFieldValue(invocationHandler,"_futures",futures);
  preparedStatement.close();
  Assert.assertTrue(testNoticeableFuture.hasCalledGet());
}
