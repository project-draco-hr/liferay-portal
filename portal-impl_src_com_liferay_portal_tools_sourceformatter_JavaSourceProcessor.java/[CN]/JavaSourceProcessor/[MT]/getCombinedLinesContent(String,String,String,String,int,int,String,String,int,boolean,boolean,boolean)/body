{
  int previousLineStartPos=getLineStartPos(content,lineCount - 1);
  if (linePart == null) {
    String combinedLine=previousLine;
    if (extraSpace) {
      combinedLine+=StringPool.SPACE;
    }
    combinedLine+=trimmedLine;
    String nextLine=getNextLine(content,lineCount);
    if (nextLine == null) {
      return null;
    }
    if (removeTabOnNextLine) {
      return StringUtil.replaceFirst(content,previousLine + "\n" + line+ "\n"+ nextLine,combinedLine + "\n" + nextLine.substring(1),previousLineStartPos);
    }
    if (line.endsWith(StringPool.OPEN_CURLY_BRACE) && (tabDiff != 0) && !previousLine.contains(" class ")&& Validator.isNull(nextLine)) {
      return StringUtil.replaceFirst(content,previousLine + "\n" + line+ "\n",combinedLine,previousLineStartPos);
    }
    return StringUtil.replaceFirst(content,previousLine + "\n" + line,combinedLine,previousLineStartPos);
  }
  String firstLine=previousLine;
  String secondLine=line;
  if (addToPreviousLine) {
    if (extraSpace) {
      firstLine+=StringPool.SPACE;
    }
    firstLine+=linePart;
    secondLine=StringUtil.replaceFirst(line,linePart,StringPool.BLANK);
  }
 else {
    if (((linePart.length() + lineLength) <= _MAX_LINE_LENGTH) && (line.endsWith(StringPool.OPEN_CURLY_BRACE) || line.endsWith(StringPool.SEMICOLON))) {
      firstLine=StringUtil.replaceLast(firstLine,StringUtil.trim(linePart),StringPool.BLANK);
      secondLine=StringUtil.replaceLast(line,StringPool.TAB,StringPool.TAB + linePart);
    }
 else {
      processErrorMessage(fileName,"line break: " + fileName + " "+ lineCount);
      return null;
    }
  }
  firstLine=StringUtil.trimTrailing(firstLine);
  return StringUtil.replaceFirst(content,previousLine + "\n" + line,firstLine + "\n" + secondLine,previousLineStartPos);
}
