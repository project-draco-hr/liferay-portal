{
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  for (  Layout layout : layouts) {
    if (!layout.isHidden() && LayoutPermissionUtil.contains(permissionChecker,layout,ActionKeys.VIEW)) {
      String canonicalURL=PortalUtil.getCanonicalURL(null,themeDisplay,layout,true);
      if (Validator.isNotNull(themeDisplay.getDoAsUserId())) {
        canonicalURL=HttpUtil.setParameter(canonicalURL,"doAsUserId",themeDisplay.getDoAsUserId());
      }
      return canonicalURL;
    }
  }
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  String groupFriendlyURL=PortalUtil.getGroupFriendlyURL(group,GetterUtil.getBoolean(privateLayoutParam),themeDisplay);
  if (Validator.isNotNull(themeDisplay.getDoAsUserId())) {
    groupFriendlyURL=HttpUtil.setParameter(groupFriendlyURL,"doAsUserId",themeDisplay.getDoAsUserId());
  }
  return groupFriendlyURL;
}
