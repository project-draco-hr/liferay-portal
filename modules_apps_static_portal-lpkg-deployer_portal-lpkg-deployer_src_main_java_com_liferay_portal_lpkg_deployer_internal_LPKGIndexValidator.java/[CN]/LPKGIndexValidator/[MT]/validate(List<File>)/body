{
  long start=System.currentTimeMillis();
  List<URI> allIndexURIs=new ArrayList<>();
  List<URI> targetPlatformIndexURIs=_getTargetPlatformIndexURIs();
  allIndexURIs.addAll(targetPlatformIndexURIs);
  List<URI> lpkgIndexURIs=_indexLPKGFiles(lpkgFiles);
  allIndexURIs.addAll(lpkgIndexURIs);
  if (checkIntegrity(allIndexURIs)) {
    return false;
  }
  IndexValidator indexValidator=_indexValidatorFactory.create(targetPlatformIndexURIs);
  try {
    List<String> messages=indexValidator.validate(lpkgIndexURIs);
    if (!messages.isEmpty()) {
      StringBundler sb=new StringBundler((messages.size() * 3) + 1);
      sb.append("LPKG validation failed with {");
      for (      String message : messages) {
        sb.append("[");
        sb.append(message);
        sb.append("], ");
      }
      sb.setIndex(sb.index() - 1);
      sb.append("]}");
      throw new LPKGVerifyException(sb.toString());
    }
  }
  finally {
    _cleanUp(targetPlatformIndexURIs);
    _cleanUp(lpkgIndexURIs);
    if (_log.isInfoEnabled()) {
      long duration=System.currentTimeMillis() - start;
      _log.info(String.format("LPKG validation time %02d:%02ds",MILLISECONDS.toMinutes(duration),MILLISECONDS.toSeconds(duration % Time.MINUTE)));
    }
  }
  return true;
}
