{
  Map<String,Object> helperUtilities=_templateContextHelper.getHelperUtilities(restricted);
  if (restricted) {
    return new RestrictedTemplate(new FreeMarkerTemplate(templateResource,errorTemplateResource,helperUtilities,_configuration,_templateContextHelper),_templateContextHelper.getRestrictedVariables());
  }
  return new FreeMarkerTemplate(templateResource,errorTemplateResource,helperUtilities,_configuration,_templateContextHelper);
}
