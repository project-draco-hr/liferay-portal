{
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  long companyId=user.getCompanyId();
  boolean hasLayoutManagerPermission=true;
  if ((Validator.isNotNull(name)) && (Validator.isNotNull(primKey)) && (primKey.indexOf(PortletConstants.LAYOUT_SEPARATOR) != -1)) {
    hasLayoutManagerPermission=PortletPermissionUtil.hasLayoutManagerPermission(name,actionId);
  }
  if (checkAdmin && (isCompanyAdminImpl(companyId) || (isCommunityAdminImpl(groupId) && hasLayoutManagerPermission))) {
    return true;
  }
  logHasUserPermission(groupId,name,primKey,actionId,stopWatch,1);
  long[] resourceIds=getResourceIds(companyId,groupId,name,primKey,actionId);
  logHasUserPermission(groupId,name,primKey,actionId,stopWatch,2);
  PermissionCheckerBag bag=PermissionCacheUtil.getBag(user.getUserId(),groupId);
  boolean value=PermissionLocalServiceUtil.hasUserPermissions(user.getUserId(),groupId,actionId,resourceIds,bag);
  logHasUserPermission(groupId,name,primKey,actionId,stopWatch,3);
  return value;
}
