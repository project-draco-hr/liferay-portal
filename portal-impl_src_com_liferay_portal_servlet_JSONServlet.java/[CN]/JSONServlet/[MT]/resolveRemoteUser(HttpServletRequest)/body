{
  String remoteUser=request.getRemoteUser();
  if (_log.isDebugEnabled()) {
    _log.debug("Remote user " + remoteUser);
  }
  if (remoteUser != null) {
    PrincipalThreadLocal.setName(remoteUser);
    long userId=GetterUtil.getLong(remoteUser);
    User user=UserLocalServiceUtil.getUserById(userId);
    PermissionChecker permissionChecker=PermissionCheckerFactoryUtil.create(user);
    PermissionThreadLocal.setPermissionChecker(permissionChecker);
  }
}
