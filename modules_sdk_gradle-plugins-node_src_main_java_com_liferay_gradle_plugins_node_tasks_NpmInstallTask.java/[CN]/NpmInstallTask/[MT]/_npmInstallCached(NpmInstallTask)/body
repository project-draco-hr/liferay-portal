{
  Logger logger=npmInstallTask.getLogger();
  Project project=npmInstallTask.getProject();
  String digest=_getNodeModulesCacheDigest(npmInstallTask);
  File nodeModulesCacheDir=new File(npmInstallTask.getNodeModulesCacheDir(),digest);
  File nodeModulesDir=npmInstallTask.getNodeModulesDir();
  boolean nativeSync=npmInstallTask.isNodeModulesCacheNativeSync();
  if (nodeModulesCacheDir.exists()) {
    if (logger.isLifecycleEnabled()) {
      logger.lifecycle("Restoring node_modules of {} from {}",project,nodeModulesCacheDir);
    }
    FileUtil.syncDir(project,nodeModulesCacheDir,nodeModulesDir,nativeSync);
  }
 else {
    npmInstallTask._npmInstall();
    if (logger.isLifecycleEnabled()) {
      logger.lifecycle("Caching node_modules of {} in {}",project,nodeModulesCacheDir);
    }
    FileUtil.syncDir(project,nodeModulesDir,nodeModulesCacheDir,nativeSync);
  }
}
