{
  File file=null;
  try {
    long plid=ParamUtil.getLong(actionRequest,"plid");
    long groupId=ParamUtil.getLong(actionRequest,"groupId");
    String fileName=ParamUtil.getString(actionRequest,"exportFileName");
    DateRange dateRange=ExportImportHelperUtil.getDateRange(actionRequest,groupId,false,plid,portlet.getPortletId());
    file=LayoutServiceUtil.exportPortletInfoAsFile(plid,groupId,portlet.getPortletId(),actionRequest.getParameterMap(),dateRange.getStartDate(),dateRange.getEndDate());
    HttpServletRequest request=PortalUtil.getHttpServletRequest(actionRequest);
    HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
    ServletResponseUtil.sendFile(request,response,fileName,new FileInputStream(file),ContentTypes.APPLICATION_ZIP);
    setForward(actionRequest,ActionConstants.COMMON_NULL);
  }
 catch (  Exception e) {
    if (_log.isDebugEnabled()) {
      _log.debug(e,e);
    }
    SessionErrors.add(actionRequest,e.getClass(),e);
  }
 finally {
    FileUtil.delete(file);
  }
}
