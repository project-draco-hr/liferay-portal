{
  Configuration configuration=new Configuration();
  try {
    ClassLoader classLoader=PortletClassLoaderUtil.getClassLoader();
    String[] hibernateConfigs=PropsUtil.getArray(PropsKeys.HIBERNATE_CONFIGS);
    hibernateConfigs=ArrayUtil.append(hibernateConfigs,"META-INF/portlet-hbm.xml");
    for (    String hibernateConfig : hibernateConfigs) {
      try {
        InputStream is=classLoader.getResourceAsStream(hibernateConfig);
        if (is != null) {
          configuration=configuration.addInputStream(is);
          is.close();
        }
      }
 catch (      Exception e1) {
        if (_log.isWarnEnabled()) {
          _log.warn(e1);
        }
      }
    }
    configuration.setProperties(PropsUtil.getProperties());
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  return configuration;
}
