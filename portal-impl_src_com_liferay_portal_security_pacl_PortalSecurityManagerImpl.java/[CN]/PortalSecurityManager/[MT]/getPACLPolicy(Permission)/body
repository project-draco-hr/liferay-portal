{
  PACLPolicy paclPolicy=PortalSecurityManagerThreadLocal.getPACLPolicy();
  if (paclPolicy != null) {
    return paclPolicy;
  }
  if (permission instanceof PortalHookPermission) {
    PortalHookPermission portalHookPermission=(PortalHookPermission)permission;
    ClassLoader classLoader=portalHookPermission.getClassLoader();
    paclPolicy=PACLPolicyManager.getPACLPolicy(classLoader);
    if (paclPolicy == null) {
      paclPolicy=PACLPolicyManager.getDefaultPACLPolicy();
    }
    return paclPolicy;
  }
 else   if (permission instanceof PortalRuntimePermission) {
    PortalRuntimePermission portalRuntimePermission=(PortalRuntimePermission)permission;
    String name=portalRuntimePermission.getName();
    if (name.equals(PACLConstants.PORTAL_RUNTIME_PERMISSION_EXPANDO_BRIDGE)) {
      return PACLClassUtil.getPACLPolicyByReflection(true,_log.isDebugEnabled());
    }
  }
  return PACLClassUtil.getPACLPolicyByReflection(false,_log.isDebugEnabled());
}
