{
  boolean etag=ParamUtil.getBoolean(request,_ETAG,true);
  if (etag) {
    CacheResponse cacheResponse=new CacheResponse(response,StringPool.UTF8);
    processFilter(ETagFilter.class,request,cacheResponse,filterChain);
    CacheResponseData cacheResponseData=new CacheResponseData(cacheResponse.unsafeGetData(),cacheResponse.getDataLength(),cacheResponse.getContentType(),cacheResponse.getHeaders());
    if (!ETagUtil.processETag(request,response,cacheResponse.unsafeGetData(),cacheResponse.getDataLength())) {
      CacheResponseUtil.write(response,cacheResponseData);
    }
  }
 else {
    processFilter(ETagFilter.class,request,response,filterChain);
  }
}
