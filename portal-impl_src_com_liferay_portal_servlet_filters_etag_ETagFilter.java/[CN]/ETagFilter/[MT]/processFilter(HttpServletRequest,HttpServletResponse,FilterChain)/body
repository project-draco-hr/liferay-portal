{
  CacheResponseData cacheResponseData=null;
  String eTag=(String)request.getAttribute(ETAG);
  if (eTag == null) {
    CacheResponse cacheResponse=new CacheResponse(response,StringPool.UTF8);
    processFilter(ETagFilter.class,request,cacheResponse,filterChain);
    cacheResponseData=new CacheResponseData(cacheResponse.getData(),cacheResponse.getContentType(),cacheResponse.getHeaders());
    eTag=Integer.toHexString(Arrays.hashCode(cacheResponse.getData()));
  }
  if (Validator.isNotNull(eTag)) {
    response.setHeader(HttpHeaders.ETAG,eTag);
    String ifNoneMatch=request.getHeader(HttpHeaders.IF_NONE_MATCH);
    if (eTag.equals(ifNoneMatch)) {
      response.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
      return;
    }
  }
  if (cacheResponseData != null) {
    CacheResponseUtil.write(response,cacheResponseData);
  }
 else {
    processFilter(ETagFilter.class,request,response,filterChain);
  }
}
