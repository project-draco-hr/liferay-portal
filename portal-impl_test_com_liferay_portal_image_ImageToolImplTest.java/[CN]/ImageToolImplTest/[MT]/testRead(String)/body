{
  fileName="portal-impl/test/com/liferay/portal/image/dependencies/" + fileName;
  File file=new File(fileName);
  BufferedImage expectedImage=ImageIO.read(file);
  assertNotNull(expectedImage);
  DataBufferByte expectedDataBufferByte=(DataBufferByte)expectedImage.getData().getDataBuffer();
  byte[][] expectedData=expectedDataBufferByte.getBankData();
  String expectedType=FileUtil.getExtension(fileName);
  if (expectedType.equals("jpeg")) {
    expectedType=ImageTool.TYPE_JPEG;
  }
  RandomAccessFile randomAccessFile=new RandomAccessFile(file,"r");
  byte[] bytes=new byte[(int)randomAccessFile.length()];
  randomAccessFile.readFully(bytes);
  ImageBag imageBag=ImageToolUtil.read(bytes);
  RenderedImage resultImage=imageBag.getRenderedImage();
  assertNotNull(resultImage);
  DataBufferByte resultDataBufferByte=(DataBufferByte)resultImage.getData().getDataBuffer();
  byte[][] resultData=resultDataBufferByte.getBankData();
  String resultType=imageBag.getType();
  assertTrue(expectedType.equalsIgnoreCase(resultType));
  assertTrue(Arrays.deepEquals(expectedData,resultData));
}
