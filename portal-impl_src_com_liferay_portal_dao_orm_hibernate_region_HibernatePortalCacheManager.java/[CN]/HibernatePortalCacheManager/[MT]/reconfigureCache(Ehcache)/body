{
  CacheManager cacheManager=getEhcacheManager();
  String cacheName=replacementCache.getName();
  Ehcache ehcache=cacheManager.getEhcache(cacheName);
  if ((ehcache != null) && (ehcache instanceof ModifiableEhcacheWrapper)) {
    if (_log.isInfoEnabled()) {
      _log.info("Reconfiguring Hibernate cache " + cacheName);
    }
    ModifiableEhcacheWrapper modifiableEhcacheWrapper=(ModifiableEhcacheWrapper)ehcache;
    cacheManager.replaceCacheWithDecoratedCache(ehcache,modifiableEhcacheWrapper.getWrappedCache());
    cacheManager.removeCache(cacheName);
    cacheManager.addCache(replacementCache);
    modifiableEhcacheWrapper.setWrappedCache(replacementCache);
    cacheManager.replaceCacheWithDecoratedCache(replacementCache,modifiableEhcacheWrapper);
  }
 else {
    if (_log.isInfoEnabled()) {
      _log.info("Configuring Hibernate cache " + cacheName);
    }
    if (ehcache != null) {
      cacheManager.removeCache(cacheName);
    }
    ehcache=new ModifiableEhcacheWrapper(replacementCache);
    cacheManager.addCache(replacementCache);
    cacheManager.replaceCacheWithDecoratedCache(replacementCache,ehcache);
  }
}
