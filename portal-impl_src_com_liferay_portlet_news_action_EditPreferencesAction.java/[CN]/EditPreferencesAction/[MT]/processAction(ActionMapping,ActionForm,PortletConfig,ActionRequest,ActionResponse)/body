{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  if (!cmd.equals(Constants.UPDATE)) {
    return;
  }
  PortletPreferences prefs=req.getPreferences();
  String tabs1=ParamUtil.getString(req,"tabs1");
  if (tabs1.equals("news-selections")) {
    String categoryName=req.getParameter("categoryName");
    String list=req.getParameter("feeds");
    Set<Feed> selFeeds=NewsUtil.getSelFeeds(prefs);
    Iterator<Feed> itr=selFeeds.iterator();
    while (itr.hasNext()) {
      Feed feed=itr.next();
      String feedURL=feed.getFeedURL();
      int pos=list.indexOf(feedURL);
      if ((pos == -1) && (feed.getCategoryName().equals(categoryName))) {
        itr.remove();
      }
 else {
        list=StringUtil.replace(list,feedURL + StringPool.COMMA,StringPool.BLANK);
      }
    }
    Map<String,Feed> feedMap=NewsUtil.getFeedMap();
    StringTokenizer st=new StringTokenizer(list,StringPool.COMMA);
    while (st.hasMoreTokens()) {
      Feed feed=feedMap.get(st.nextToken());
      if (feed != null) {
        selFeeds.add(feed);
      }
    }
    prefs.setValues("sel-feeds",NewsUtil.getSelFeeds(selFeeds));
  }
 else   if (tabs1.equals("display-settings")) {
    String list=req.getParameter("feeds");
    int articlesPerNews=ParamUtil.get(req,"apn",4);
    prefs.setValue("articles-per-news",String.valueOf(articlesPerNews));
    Set<Feed> selFeeds=new LinkedHashSet<Feed>();
    Map<String,Feed> feedMap=NewsUtil.getFeedMap();
    StringTokenizer st=new StringTokenizer(list,StringPool.COMMA);
    while (st.hasMoreTokens()) {
      Feed feed=feedMap.get(st.nextToken());
      if (feed != null) {
        selFeeds.add(feed);
      }
    }
    prefs.setValues("sel-feeds",NewsUtil.getSelFeeds(selFeeds));
  }
  prefs.store();
  SessionMessages.add(req,config.getPortletName() + ".doEdit");
}
