{
  if (!portletDataContext.isPathNotProcessed(path)) {
    return;
  }
  template=(DDMTemplate)template.clone();
  Element templateElement=templatesElement.addElement("template");
  if (template.isSmallImage() && Validator.isNull(template.getSmallImageURL())) {
    Image smallImage=ImageUtil.fetchByPrimaryKey(template.getSmallImageId());
    if (smallImage != null) {
      String smallImagePath=getTemplateSmallImagePath(portletDataContext,template);
      templateElement.addAttribute("small-image-path",smallImagePath);
      template.setSmallImageType(smallImage.getType());
      portletDataContext.addZipEntry(smallImagePath,smallImage.getTextObj());
    }
  }
  portletDataContext.addClassedModel(templateElement,path,template,_NAMESPACE);
}
