{
  initalizeThreadLocals();
  BackgroundTask backgroundTask=BackgroundTaskLocalServiceUtil.addBackgroundTask(_user.getUserId(),_group.getGroupId(),_BACKGROUND_TASK_NAME,null,_TASK_EXECUTOR_CLASS,getTaskContextMap(),new ServiceContext());
  Assert.assertEquals(backgroundTask.getAttachmentsFileEntriesCount(),0);
  Class<?> clazz=getClass();
  URL url=clazz.getResource(_RESOURCE_NAME);
  File file=new File(url.toURI());
  BackgroundTaskLocalServiceUtil.addBackgroundTaskAttachment(_user.getUserId(),backgroundTask.getBackgroundTaskId(),RandomTestUtil.randomString(),file);
  backgroundTask=BackgroundTaskLocalServiceUtil.fetchBackgroundTask(backgroundTask.getBackgroundTaskId());
  Assert.assertEquals(backgroundTask.getAttachmentsFileEntriesCount(),1);
  assertThreadLocalValues(backgroundTask);
}
