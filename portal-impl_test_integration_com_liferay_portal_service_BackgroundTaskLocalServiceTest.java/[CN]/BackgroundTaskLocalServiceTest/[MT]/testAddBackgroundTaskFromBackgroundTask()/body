{
  initalizeThreadLocals();
  BackgroundTask backgroundTaskImpl=new BackgroundTaskImpl();
  backgroundTaskImpl.setUserId(_user.getUserId());
  backgroundTaskImpl.setGroupId(_group.getGroupId());
  backgroundTaskImpl.setName(_BACKGROUND_TASK_NAME);
  backgroundTaskImpl.setTaskExecutorClassName(_TASK_EXECUTOR_CLASS.getCanonicalName());
  Map<String,Serializable> taskContextMap=getTaskContextMap();
  backgroundTaskImpl.setTaskContextMap(taskContextMap);
  BackgroundTask backgroundTask=BackgroundTaskLocalServiceUtil.addBackgroundTask(backgroundTaskImpl);
  Assert.assertNotNull(backgroundTask);
  Assert.assertEquals(_user.getUserId(),backgroundTask.getUserId());
  Assert.assertEquals(_group.getGroupId(),backgroundTask.getGroupId());
  Assert.assertEquals(_BACKGROUND_TASK_NAME,backgroundTask.getName());
  Assert.assertEquals(_TASK_EXECUTOR_CLASS.getCanonicalName(),backgroundTask.getTaskExecutorClassName());
  AssertUtils.assertEquals(taskContextMap,backgroundTask.getTaskContextMap());
  Map<String,Serializable> threadLocalValues=(Map<String,Serializable>)backgroundTask.getTaskContextMap().get("threadLocalValues");
  assertThreadLocalValues(threadLocalValues);
}
