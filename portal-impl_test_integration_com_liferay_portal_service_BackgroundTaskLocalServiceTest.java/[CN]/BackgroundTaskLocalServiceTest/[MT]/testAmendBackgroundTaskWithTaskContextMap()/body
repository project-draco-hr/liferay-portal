{
  initalizeThreadLocals();
  ServiceContext serviceContext=new ServiceContext();
  BackgroundTask backgroundTask=BackgroundTaskLocalServiceUtil.addBackgroundTask(_user.getUserId(),_group.getGroupId(),_BACKGROUND_TASK_NAME,null,_TASK_EXECUTOR_CLASS,getTaskContextMap(),serviceContext);
  Map<String,Serializable> taskContextMap=getTaskContextMap();
  backgroundTask=BackgroundTaskLocalServiceUtil.amendBackgroundTask(backgroundTask.getBackgroundTaskId(),taskContextMap,backgroundTask.getStatus(),serviceContext);
  AssertUtils.assertEquals(backgroundTask.getTaskContextMap(),taskContextMap);
  assertThreadLocalValues(backgroundTask);
}
