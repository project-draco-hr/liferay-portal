{
  User user=userPersistence.findByPrimaryKey(userId);
  long classNameId=PortalUtil.getClassNameId(className);
  Date now=new Date();
  validate(0,user.getCompanyId(),classNameId,classPK,street1,city,zip,regionId,countryId,typeId,mailing,primary);
  long addressId=counterLocalService.increment();
  Address address=addressPersistence.create(addressId);
  address.setCompanyId(user.getCompanyId());
  address.setUserId(user.getUserId());
  address.setUserName(user.getFullName());
  address.setCreateDate(now);
  address.setModifiedDate(now);
  address.setClassNameId(classNameId);
  address.setClassPK(classPK);
  address.setStreet1(street1);
  address.setStreet2(street2);
  address.setStreet3(street3);
  address.setCity(city);
  address.setZip(zip);
  address.setRegionId(regionId);
  address.setCountryId(countryId);
  address.setTypeId(typeId);
  address.setMailing(mailing);
  address.setPrimary(primary);
  addressPersistence.update(address);
  return address;
}
