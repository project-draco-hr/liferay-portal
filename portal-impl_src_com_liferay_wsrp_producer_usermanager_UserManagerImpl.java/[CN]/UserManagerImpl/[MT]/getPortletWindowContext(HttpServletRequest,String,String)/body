{
  try {
    request.setAttribute(_IS_WSRP_REQUEST,"true");
    String portletId=(String)request.getAttribute(_PORTAL_ID);
    Portlet portlet=PortletLocalServiceUtil.getPortletById(PortalUtil.getCompanyId(request),portletId);
    PortletWindowContext portletWindowContext=PortletWindowContextFactoryUtil.create(request,portlet,PortletRequest.ACTION_PHASE);
    initializeLiferayRequest(request);
    return portletWindowContext;
  }
 catch (  Exception e) {
    throw new ProducerException(e);
  }
}
