{
  long recordVersionId=counterLocalService.increment();
  DDLRecordVersion recordVersion=ddlRecordVersionPersistence.create(recordVersionId);
  recordVersion.setGroupId(record.getGroupId());
  recordVersion.setCompanyId(record.getCompanyId());
  long versionUserId=record.getVersionUserId();
  if (versionUserId <= 0) {
    versionUserId=record.getUserId();
  }
  recordVersion.setUserId(versionUserId);
  String versionUserName=GetterUtil.getString(record.getVersionUserName(),record.getUserName());
  recordVersion.setUserName(versionUserName);
  recordVersion.setCreateDate(record.getModifiedDate());
  recordVersion.setClassNameId(record.getClassNameId());
  recordVersion.setClassPK(classPK);
  recordVersion.setRecordSetId(record.getRecordSetId());
  recordVersion.setRecordId(record.getRecordId());
  recordVersion.setVersion(version);
  recordVersion.setDisplayIndex(displayIndex);
  recordVersion.setStatus(status);
  recordVersion.setStatusByUserId(user.getUserId());
  recordVersion.setStatusByUserName(user.getFullName());
  recordVersion.setStatusDate(record.getModifiedDate());
  ddlRecordVersionPersistence.update(recordVersion,false);
  return recordVersion;
}
