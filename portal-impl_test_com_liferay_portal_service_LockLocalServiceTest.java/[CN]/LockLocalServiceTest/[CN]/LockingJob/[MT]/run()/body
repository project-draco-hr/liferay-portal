{
  int count=0;
  while (true) {
    try {
      Lock lock=LockLocalServiceUtil.lock(_testClassName,_testKey,_testOwner,false);
      if (lock.isNew()) {
        LockLocalServiceUtil.unlock(_testClassName,_testKey);
        if (++count >= _requiredSuccessCount) {
          break;
        }
      }
    }
 catch (    SystemException se) {
      Throwable cause=se.getCause();
      if (cause instanceof ORMException) {
        cause=cause.getCause();
        if (cause instanceof LockAcquisitionException) {
          continue;
        }
        DB db=DBFactoryUtil.getDB();
        if ((db instanceof PostgreSQLDB) && (cause instanceof ConstraintViolationException)) {
          continue;
        }
      }
      _systemException=se;
      break;
    }
  }
}
