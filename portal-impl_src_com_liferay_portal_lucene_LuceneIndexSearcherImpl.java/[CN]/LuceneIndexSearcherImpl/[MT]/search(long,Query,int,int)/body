{
  LuceneHitsImpl hits=new LuceneHitsImpl();
  org.apache.lucene.search.IndexSearcher searcher=null;
  try {
    searcher=LuceneUtil.getSearcher(companyId);
    hits.recordHits(searcher.search(((QueryImpl)query).getQuery()),searcher);
    if ((begin == SearchEngineUtil.ALL_POS) && (end == SearchEngineUtil.ALL_POS)) {
      hits=hits.subset(0,hits.getLength());
    }
 else {
      hits=hits.subset(begin,end);
    }
  }
 catch (  Exception e) {
    if (e instanceof BooleanQuery.TooManyClauses || e instanceof ParseException) {
      _log.error("Parsing keywords " + query.parse(),e);
      return new LuceneHitsImpl();
    }
 else {
      throw new SearchException(e);
    }
  }
 finally {
    try {
      if (searcher != null) {
        searcher.close();
        hits.setSearcher(null);
      }
    }
 catch (    IOException ioe) {
      throw new SearchException(ioe);
    }
  }
  return hits;
}
