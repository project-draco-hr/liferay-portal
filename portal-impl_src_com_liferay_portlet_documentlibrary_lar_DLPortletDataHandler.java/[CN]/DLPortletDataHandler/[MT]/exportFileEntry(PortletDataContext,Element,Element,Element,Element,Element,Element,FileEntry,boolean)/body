{
  if (checkDateRange && !portletDataContext.isWithinDateRange(fileEntry.getModifiedDate())) {
    return;
  }
  if (!fileEntry.isDefaultRepository()) {
    Repository repository=RepositoryUtil.findByPrimaryKey(fileEntry.getRepositoryId());
    exportRepository(portletDataContext,repositoriesElement,repositoryEntriesElement,repository);
    return;
  }
  FileVersion fileVersion=fileEntry.getFileVersion();
  if (!fileVersion.isApproved() && !fileVersion.isInTrash()) {
    return;
  }
  LiferayFileEntry liferayFileEntry=(LiferayFileEntry)fileEntry;
  liferayFileEntry.setCachedFileVersion(fileVersion);
  String path=getFileEntryPath(portletDataContext,fileEntry);
  if (!portletDataContext.isPathNotProcessed(path)) {
    return;
  }
  Element fileEntryElement=fileEntriesElement.addElement("file-entry");
  if (foldersElement != null) {
    exportParentFolder(portletDataContext,fileEntryTypesElement,foldersElement,repositoriesElement,repositoryEntriesElement,fileEntry.getFolderId());
  }
  if (!portletDataContext.isPerformDirectBinaryImport()) {
    InputStream is=null;
    try {
      is=FileEntryUtil.getContentStream(fileEntry);
    }
 catch (    NoSuchFileException nsfe) {
    }
    if (is == null) {
      if (_log.isWarnEnabled()) {
        _log.warn("No file found for file entry " + fileEntry.getFileEntryId());
      }
      fileEntryElement.detach();
      return;
    }
    try {
      String binPath=getFileEntryBinPath(portletDataContext,fileEntry);
      portletDataContext.addZipEntry(binPath,is);
      fileEntryElement.addAttribute("bin-path",binPath);
    }
  finally {
      try {
        is.close();
      }
 catch (      IOException ioe) {
        _log.error(ioe,ioe);
      }
    }
  }
  if (portletDataContext.getBooleanParameter(NAMESPACE,"ranks")) {
    List<DLFileRank> fileRanks=DLFileRankUtil.findByFileEntryId(fileEntry.getFileEntryId());
    for (    DLFileRank fileRank : fileRanks) {
      exportFileRank(portletDataContext,fileRanksElement,fileRank);
    }
  }
  if (portletDataContext.getBooleanParameter(NAMESPACE,"previews-and-thumbnails")) {
    DLProcessorRegistryUtil.exportGeneratedFiles(portletDataContext,fileEntry,fileEntryElement);
  }
  exportMetaData(portletDataContext,fileEntryTypesElement,fileEntryElement,fileEntry);
  portletDataContext.addClassedModel(fileEntryElement,path,fileEntry,NAMESPACE);
}
