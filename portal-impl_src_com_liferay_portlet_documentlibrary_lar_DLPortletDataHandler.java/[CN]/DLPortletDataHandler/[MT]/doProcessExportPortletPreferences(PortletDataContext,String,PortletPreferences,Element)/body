{
  long rootFolderId=GetterUtil.getLong(portletPreferences.getValue("rootFolderId",null));
  if (rootFolderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    Folder folder=DLAppLocalServiceUtil.getFolder(rootFolderId);
    Portlet portlet=PortletLocalServiceUtil.getPortletById(portletDataContext.getCompanyId(),portletId);
    portletDataContext.addReferenceElement(portlet,rootElement,folder,Folder.class,PortletDataContext.REFERENCE_TYPE_DEPENDENCY,!portletDataContext.getBooleanParameter(NAMESPACE,"folders"));
  }
  return portletPreferences;
}
