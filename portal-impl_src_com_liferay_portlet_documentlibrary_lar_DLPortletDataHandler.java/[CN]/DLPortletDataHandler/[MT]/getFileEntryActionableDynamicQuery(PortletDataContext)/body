{
  final ExportActionableDynamicQuery exportActionableDynamicQuery=DLFileEntryLocalServiceUtil.getExportActionableDynamicQuery(portletDataContext);
  final ActionableDynamicQuery.AddCriteriaMethod addCriteriaMethod=exportActionableDynamicQuery.getAddCriteriaMethod();
  exportActionableDynamicQuery.setAddCriteriaMethod(new ActionableDynamicQuery.AddCriteriaMethod(){
    @Override public void addCriteria(    DynamicQuery dynamicQuery){
      addCriteriaMethod.addCriteria(dynamicQuery);
      Property property=PropertyFactoryUtil.forName("repositoryId");
      dynamicQuery.add(property.eq(portletDataContext.getScopeGroupId()));
      DynamicQuery fileVersionDynamicQuery=DynamicQueryFactoryUtil.forClass(DLFileVersion.class,"fileVersion",PortalClassLoaderUtil.getClassLoader());
      fileVersionDynamicQuery.setProjection(ProjectionFactoryUtil.property("fileEntryId"));
      Property statusProperty=PropertyFactoryUtil.forName("status");
      StagedModelDataHandler<?> stagedModelDataHandler=StagedModelDataHandlerRegistryUtil.getStagedModelDataHandler(DLFileEntry.class.getName());
      fileVersionDynamicQuery.add(statusProperty.in(stagedModelDataHandler.getExportableStatuses()));
      fileVersionDynamicQuery.add(RestrictionsFactoryUtil.eqProperty("fileVersion.version","version"));
      fileVersionDynamicQuery.add(RestrictionsFactoryUtil.eqProperty("fileVersion.fileEntryId","fileEntryId"));
      Property fileEntryIdProperty=PropertyFactoryUtil.forName("fileEntryId");
      dynamicQuery.add(fileEntryIdProperty.in(fileVersionDynamicQuery));
    }
  }
);
  exportActionableDynamicQuery.setPerformActionMethod(new ActionableDynamicQuery.PerformActionMethod(){
    @Override public void performAction(    Object object) throws PortalException {
      DLFileEntry dlFileEntry=(DLFileEntry)object;
      if (dlFileEntry.isInTrash()) {
        return;
      }
      FileEntry fileEntry=DLAppLocalServiceUtil.getFileEntry(dlFileEntry.getFileEntryId());
      StagedModelDataHandlerUtil.exportStagedModel(portletDataContext,fileEntry);
    }
  }
);
  exportActionableDynamicQuery.setPerformCountMethod(new ActionableDynamicQuery.PerformCountMethod(){
    @Override public long performCount() throws PortalException {
      ManifestSummary manifestSummary=portletDataContext.getManifestSummary();
      long modelAdditionCount=DLFileEntryLocalServiceUtil.getFileEntriesCount(portletDataContext.getScopeGroupId(),portletDataContext.getDateRange(),portletDataContext.getScopeGroupId(),new QueryDefinition<DLFileEntry>(WorkflowConstants.STATUS_APPROVED));
      StagedModelType stagedModelType=exportActionableDynamicQuery.getStagedModelType();
      manifestSummary.addModelAdditionCount(stagedModelType.toString(),modelAdditionCount);
      long modelDeletionCount=ExportImportHelperUtil.getModelDeletionCount(portletDataContext,stagedModelType);
      manifestSummary.addModelDeletionCount(stagedModelType.toString(),modelDeletionCount);
      return modelAdditionCount;
    }
  }
);
  exportActionableDynamicQuery.setStagedModelType(new StagedModelType(DLFileEntryConstants.getClassName()));
  return exportActionableDynamicQuery;
}
