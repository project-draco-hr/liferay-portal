{
  int threadCount=5;
  DoAsUserThread[] threads=new DoAsUserThread[threadCount];
  for (int i=0; i < threads.length; i++) {
    String subject="Test Message " + i;
    threads[i]=new AddMessageThread(subject);
  }
  for (  DoAsUserThread thread : threads) {
    thread.start();
  }
  for (  DoAsUserThread thread : threads) {
    thread.join(5000);
  }
  int successCount=0;
  for (  DoAsUserThread thread : threads) {
    if (thread.isSuccess()) {
      successCount++;
    }
  }
  assertTrue("Only " + successCount + " out of "+ threadCount+ " threads added messages successfully",successCount == threadCount);
}
