{
  String authType=PrefsPropsUtil.getString(companyId,PropsKeys.COMPANY_SECURITY_AUTH_TYPE,PropsValues.COMPANY_SECURITY_AUTH_TYPE);
  User user=null;
  if (PrefsPropsUtil.getBoolean(companyId,TokenBasedPropsKeys.IMPORT_FROM_LDAP,_tokenBasedConfiguration.importFromLDAP())) {
    try {
      if (authType.equals(CompanyConstants.AUTH_TYPE_SN)) {
        user=UserImporterUtil.importUser(companyId,StringPool.BLANK,login);
      }
 else       if (authType.equals(CompanyConstants.AUTH_TYPE_EA)) {
        user=UserImporterUtil.importUser(companyId,login,StringPool.BLANK);
      }
 else {
        if (_log.isWarnEnabled()) {
          _log.warn("Incompatible setting for: " + PropsKeys.COMPANY_SECURITY_AUTH_TYPE + ". Please configure to either: "+ CompanyConstants.AUTH_TYPE_EA+ " or "+ CompanyConstants.AUTH_TYPE_SN);
        }
      }
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Cannot import from LDAP",e);
      }
    }
  }
  if (user != null) {
    return user;
  }
  if (authType.equals(CompanyConstants.AUTH_TYPE_SN)) {
    user=UserLocalServiceUtil.getUserByScreenName(companyId,login);
  }
 else   if (authType.equals(CompanyConstants.AUTH_TYPE_EA)) {
    user=UserLocalServiceUtil.getUserByEmailAddress(companyId,login);
  }
 else {
    if (_log.isWarnEnabled()) {
      _log.warn("Incompatible setting for: " + PropsKeys.COMPANY_SECURITY_AUTH_TYPE + ". Please configure to either: "+ CompanyConstants.AUTH_TYPE_EA+ " or "+ CompanyConstants.AUTH_TYPE_SN);
    }
  }
  return user;
}
