{
  ServiceContext serviceContext=flagRequest.getServiceContext();
  long companyId=serviceContext.getCompanyId();
  Company company=_companyLocalService.getCompany(serviceContext.getCompanyId());
  serviceContext.getScopeGroupId();
  Layout layout=_layoutLocalService.getLayout(serviceContext.getPlid());
  Group group=layout.getGroup();
  String groupName=group.getDescriptiveName();
  String reporterUserName=null;
  String reporterEmailAddress=flagRequest.getReporterEmailAddress();
  User reporterUser=_userLocalService.getUser(serviceContext.getUserId());
  Locale locale=LocaleUtil.getDefault();
  if (reporterUser.isDefaultUser()) {
    reporterUserName=LanguageUtil.get(locale,"anonymous");
  }
 else {
    reporterUserName=reporterUser.getFullName();
    reporterEmailAddress=reporterUser.getEmailAddress();
  }
  String reportedUserName=null;
  String reportedEmailAddress=StringPool.BLANK;
  String reportedURL=StringPool.BLANK;
  User reportedUser=_userLocalService.getUser(flagRequest.getReportedUserId());
  if (reportedUser.isDefaultUser()) {
    reportedUserName=group.getDescriptiveName();
  }
 else {
    reportedUserName=reportedUser.getFullName();
    reportedEmailAddress=reportedUser.getEmailAddress();
    reportedURL=reportedUser.getDisplayURL(serviceContext.getPortalURL(),serviceContext.getPathMain());
  }
  String contentType=LanguageUtil.get(locale,"model.resource." + flagRequest.getClassName());
  String reason=LanguageUtil.get(locale,flagRequest.getReason());
  String fromName=PrefsPropsUtil.getString(companyId,PropsKeys.FLAGS_EMAIL_FROM_NAME);
  String fromAddress=PrefsPropsUtil.getString(companyId,PropsKeys.FLAGS_EMAIL_FROM_ADDRESS);
  String subject=PrefsPropsUtil.getContent(companyId,PropsKeys.FLAGS_EMAIL_SUBJECT);
  String body=PrefsPropsUtil.getContent(companyId,PropsKeys.FLAGS_EMAIL_BODY);
  List<User> recipients=getRecipients(companyId,serviceContext.getScopeGroupId());
  for (  User recipient : recipients) {
    try {
      notify(company,groupName,reporterEmailAddress,reporterUserName,reportedEmailAddress,reportedUserName,reportedURL,flagRequest.getClassPK(),flagRequest.getContentTitle(),contentType,flagRequest.getContentURL(),reason,fromName,fromAddress,recipient.getFullName(),recipient.getEmailAddress(),subject,body,serviceContext);
    }
 catch (    IOException ioe) {
      if (_log.isWarnEnabled()) {
        _log.warn(ioe);
      }
    }
  }
}
