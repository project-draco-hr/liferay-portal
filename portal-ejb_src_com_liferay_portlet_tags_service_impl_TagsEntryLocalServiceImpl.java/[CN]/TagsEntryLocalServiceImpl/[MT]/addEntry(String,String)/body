{
  User user=UserUtil.findByPrimaryKey(userId);
  Date now=new Date();
  name=name.trim().toLowerCase();
  validate(name);
  if (hasEntry(user.getCompanyId(),name)) {
    throw new DuplicateEntryException();
  }
  long entryId=CounterLocalServiceUtil.increment(Counter.class.getName());
  TagsEntry entry=TagsEntryUtil.create(entryId);
  entry.setCompanyId(user.getCompanyId());
  entry.setUserId(user.getUserId());
  entry.setUserName(user.getFullName());
  entry.setCreateDate(now);
  entry.setModifiedDate(now);
  entry.setName(name);
  TagsEntryUtil.update(entry);
  return entry;
}
