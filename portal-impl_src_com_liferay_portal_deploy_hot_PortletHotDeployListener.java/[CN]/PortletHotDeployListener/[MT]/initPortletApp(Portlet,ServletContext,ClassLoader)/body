{
  String servletContextName=ctx.getServletContextName();
  PortletConfig portletConfig=PortletConfigFactory.create(portlet,ctx);
  PortletContext portletCtx=portletConfig.getPortletContext();
  PortletContextBag portletContextBag=new PortletContextBag(servletContextName);
  PortletContextBagPool.put(servletContextName,portletContextBag);
  PortletApp portletApp=portlet.getPortletApp();
  Map<String,String> customUserAttributes=portletApp.getCustomUserAttributes();
  for (  Map.Entry<String,String> entry : customUserAttributes.entrySet()) {
    String attrCustomClass=entry.getValue();
    CustomUserAttributes customUserAttributesInstance=(CustomUserAttributes)portletClassLoader.loadClass(attrCustomClass).newInstance();
    portletContextBag.getCustomUserAttributes().put(attrCustomClass,customUserAttributesInstance);
  }
  Set<PortletFilter> portletFilters=portletApp.getPortletFilters();
  for (  PortletFilter portletFilter : portletFilters) {
    javax.portlet.filter.PortletFilter portletFilterInstance=(javax.portlet.filter.PortletFilter)portletClassLoader.loadClass(portletFilter.getFilterClass()).newInstance();
    portletContextBag.getPortletFilters().put(portletFilter.getFilterName(),portletFilterInstance);
    PortletFilterFactory.create(portletFilter,portletCtx);
  }
  Set<PortletURLListener> portletURLListeners=portletApp.getPortletURLListeners();
  for (  PortletURLListener portletURLListener : portletURLListeners) {
    PortletURLGenerationListener portletURLListenerInstance=(PortletURLGenerationListener)portletClassLoader.loadClass(portletURLListener.getListenerClass()).newInstance();
    portletContextBag.getPortletURLListeners().put(portletURLListener.getListenerClass(),portletURLListenerInstance);
    PortletURLListenerFactory.create(portletURLListener);
  }
}
