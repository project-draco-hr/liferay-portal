{
  portletDataContext.importPortletPermissions(JournalPermission.RESOURCE_NAME);
  long previousScopeGroupId=portletDataContext.getScopeGroupId();
  Map<Long,Long> groupIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(Group.class);
  long importGroupId=GetterUtil.getLong(portletPreferences.getValue("groupId",null));
  long groupId=MapUtil.getLong(groupIds,importGroupId,importGroupId);
  portletDataContext.setScopeGroupId(groupId);
  StagedModelDataHandlerUtil.importReferenceStagedModels(portletDataContext,DDMStructure.class);
  StagedModelDataHandlerUtil.importReferenceStagedModels(portletDataContext,DDMTemplate.class);
  StagedModelDataHandlerUtil.importReferenceStagedModels(portletDataContext,JournalArticle.class);
  String articleId=portletPreferences.getValue("articleId",null);
  if (Validator.isNotNull(articleId)) {
    Map<String,String> articleIds=(Map<String,String>)portletDataContext.getNewPrimaryKeysMap(JournalArticle.class + ".articleId");
    articleId=MapUtil.getString(articleIds,articleId,articleId);
    portletPreferences.setValue("articleId",articleId);
    portletPreferences.setValue("groupId",String.valueOf(groupId));
    Layout layout=LayoutLocalServiceUtil.getLayout(portletDataContext.getPlid());
    JournalContentSearchLocalServiceUtil.updateContentSearch(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId(),portletId,articleId,true);
  }
 else {
    portletPreferences.setValue("groupId",StringPool.BLANK);
    portletPreferences.setValue("articleId",StringPool.BLANK);
  }
  String ddmTemplateKey=portletPreferences.getValue("ddmTemplateKey",null);
  if (Validator.isNotNull(ddmTemplateKey)) {
    Map<String,String> ddmTemplateKeys=(Map<String,String>)portletDataContext.getNewPrimaryKeysMap(DDMTemplate.class + ".ddmTemplateKey");
    ddmTemplateKey=MapUtil.getString(ddmTemplateKeys,ddmTemplateKey,ddmTemplateKey);
    portletPreferences.setValue("ddmTemplateKey",ddmTemplateKey);
  }
 else {
    portletPreferences.setValue("ddmTemplateKey",StringPool.BLANK);
  }
  portletDataContext.setScopeGroupId(previousScopeGroupId);
  return portletPreferences;
}
