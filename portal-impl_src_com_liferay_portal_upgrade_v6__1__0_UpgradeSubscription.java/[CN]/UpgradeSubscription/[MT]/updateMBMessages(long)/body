{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getUpgradeOptimizedConnection();
    StringBundler sb=new StringBundler(5);
    sb.append("select userId, MIN(userName) as userName, ");
    sb.append("classNameId, classPK, MIN(createDate) as createDate, ");
    sb.append("MIN(modifiedDate) as modifiedDate from MBMessage ");
    sb.append("where (companyId = " + companyId + ") and ");
    sb.append("(classNameId != 0) and (parentMessageId != 0) ");
    sb.append("group by userId, classNameId, classPK");
    String sql=sb.toString();
    ps=con.prepareStatement(sql);
    rs=ps.executeQuery();
    while (rs.next()) {
      long userId=rs.getLong("userId");
      String userName=rs.getString("userName");
      Timestamp createDate=rs.getTimestamp("createDate");
      Timestamp modifiedDate=rs.getTimestamp("modifiedDate");
      long classNameId=rs.getLong("classNameId");
      long classPK=rs.getLong("classPK");
      long subscriptionId=increment();
      String frequency="instant";
      addSubscription(subscriptionId,companyId,userId,userName,createDate,modifiedDate,classNameId,classPK,frequency);
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
