{
  if (_servletContext != null) {
    return _servletContext;
  }
  String portletId=PortalUtil.getPortletId(request);
  if (Validator.isNotNull(portletId)) {
    String rootPortletId=PortletConstants.getRootPortletId(portletId);
    PortletBag portletBag=PortletBagPool.get(rootPortletId);
    return portletBag.getServletContext();
  }
  return (ServletContext)request.getAttribute(WebKeys.CTX);
}
