{
  User user=UserUtil.findByPrimaryKey(userId);
  long classNameId=PortalUtil.getClassNameId(className);
  Date now=new Date();
  validate(className,entryNames);
  TagsAsset asset=TagsAssetUtil.fetchByC_C(classNameId,classPK);
  if (asset == null) {
    long assetId=CounterLocalServiceUtil.increment();
    asset=TagsAssetUtil.create(assetId);
    asset.setCompanyId(user.getCompanyId());
    asset.setUserId(user.getUserId());
    asset.setUserName(user.getFullName());
    asset.setCreateDate(now);
    asset.setClassNameId(classNameId);
    asset.setClassPK(classPK);
    asset.setPublishDate(publishDate);
    asset.setExpirationDate(expirationDate);
  }
  asset.setModifiedDate(now);
  asset.setStartDate(startDate);
  asset.setEndDate(endDate);
  asset.setPublishDate(publishDate);
  asset.setExpirationDate(expirationDate);
  asset.setMimeType(mimeType);
  asset.setTitle(title);
  asset.setDescription(description);
  asset.setSummary(summary);
  asset.setUrl(url);
  asset.setHeight(height);
  asset.setWidth(width);
  TagsAssetUtil.update(asset);
  if (entryNames != null) {
    List entries=new ArrayList(entryNames.length);
    for (int i=0; i < entryNames.length; i++) {
      String name=entryNames[i].trim().toLowerCase();
      TagsEntry entry=TagsEntryUtil.fetchByC_N(user.getCompanyId(),name);
      if (entry == null) {
        String defaultProperties="0:category:no category";
        TagsEntry newTagsEntry=TagsEntryLocalServiceUtil.addEntry(user.getUserId(),entryNames[i],new String[]{defaultProperties});
        entries.add(newTagsEntry);
      }
 else {
        entries.add(entry);
      }
    }
    TagsAssetUtil.setTagsEntries(asset.getAssetId(),entries);
  }
  return asset;
}
