{
  User user=UserUtil.findByPrimaryKey(userId);
  long classNameId=PortalUtil.getClassNameId(className);
  Date now=new Date();
  validate(className,entryNames);
  TagsAsset asset=TagsAssetUtil.fetchByC_C(classNameId,classPK);
  if (asset == null) {
    long assetId=CounterLocalServiceUtil.increment();
    asset=TagsAssetUtil.create(assetId);
    asset.setCompanyId(user.getCompanyId());
    asset.setUserId(user.getUserId());
    asset.setUserName(user.getFullName());
    asset.setCreateDate(now);
    asset.setPublishDate(publishDate);
    asset.setExpirationDate(expirationDate);
    asset.setClassNameId(classNameId);
    asset.setClassPK(classPK);
  }
  asset.setModifiedDate(now);
  asset.setPublishDate(publishDate);
  asset.setExpirationDate(expirationDate);
  TagsAssetUtil.update(asset);
  List entries=new ArrayList(entryNames.length);
  for (int i=0; i < entryNames.length; i++) {
    TagsEntry entry=TagsEntryUtil.fetchByC_N(user.getCompanyId(),entryNames[i]);
    if (entry != null) {
      entries.add(entry);
    }
  }
  TagsAssetUtil.setTagsEntries(asset.getAssetId(),entries);
  return asset;
}
