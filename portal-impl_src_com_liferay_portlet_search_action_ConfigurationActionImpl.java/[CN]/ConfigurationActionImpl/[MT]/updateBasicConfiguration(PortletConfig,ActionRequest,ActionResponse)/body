{
  boolean displayScopeFacet=GetterUtil.getBoolean(getParameter(actionRequest,"displayScopeFacet"));
  boolean displayAssetCategoriesFacet=GetterUtil.getBoolean(getParameter(actionRequest,"displayAssetCategoriesFacet"));
  boolean displayAssetTagsFacet=GetterUtil.getBoolean(getParameter(actionRequest,"displayAssetTagsFacet"));
  boolean displayAssetTypeFacet=GetterUtil.getBoolean(getParameter(actionRequest,"displayAssetTypeFacet"));
  boolean displayUserFacet=GetterUtil.getBoolean(getParameter(actionRequest,"displayUserFacet"));
  boolean displayModifiedRangeFacet=GetterUtil.getBoolean(getParameter(actionRequest,"displayModifiedRangeFacet"));
  String searchConfiguration=ContentUtil.get(PropsValues.SEARCH_FACET_CONFIGURATION);
  JSONObject configurationJSONObject=JSONFactoryUtil.createJSONObject(searchConfiguration);
  JSONArray oldFacetsJSONArray=configurationJSONObject.getJSONArray("facets");
  if (oldFacetsJSONArray == null) {
    if (_log.isWarnEnabled()) {
      _log.warn("The resource " + PropsValues.SEARCH_FACET_CONFIGURATION + " is missing a valid facets JSON array");
    }
  }
  JSONArray newFacetsJSONArray=JSONFactoryUtil.createJSONArray();
  for (int i=0; i < oldFacetsJSONArray.length(); i++) {
    JSONObject oldFacetJSONObject=oldFacetsJSONArray.getJSONObject(i);
    String fieldName=oldFacetJSONObject.getString("fieldName");
    if ((displayScopeFacet && fieldName.equals("groupId")) || (displayAssetCategoriesFacet && fieldName.equals("assetCategoryTitles")) || (displayAssetTagsFacet && fieldName.equals("assetTagNames"))|| (displayAssetTypeFacet && fieldName.equals("entryClassName"))|| (displayUserFacet && fieldName.equals("userId"))|| (displayModifiedRangeFacet && fieldName.equals("modified"))) {
      newFacetsJSONArray.put(oldFacetJSONObject);
    }
  }
  configurationJSONObject.put("facets",newFacetsJSONArray);
  searchConfiguration=configurationJSONObject.toString();
  setPreference(actionRequest,"searchConfiguration",searchConfiguration);
}
