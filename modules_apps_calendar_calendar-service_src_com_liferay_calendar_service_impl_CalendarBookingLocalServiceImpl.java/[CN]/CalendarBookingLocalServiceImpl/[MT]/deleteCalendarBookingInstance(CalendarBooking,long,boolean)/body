{
  Date now=new Date();
  java.util.Calendar startTimeJCalendar=JCalendarUtil.getJCalendar(startTime);
  Recurrence recurrenceObj=calendarBooking.getRecurrenceObj();
  if (allFollowing) {
    if (startTime == calendarBooking.getStartTime()) {
      calendarBookingLocalService.deleteCalendarBooking(calendarBooking);
      return;
    }
    if (recurrenceObj.getCount() > 0) {
      recurrenceObj.setCount(0);
    }
    startTimeJCalendar.add(java.util.Calendar.DATE,-1);
    recurrenceObj.setUntilJCalendar(startTimeJCalendar);
  }
 else {
    final int expandMax=2;
    final long expandStartTime=0L;
    final long expandEndTime=3155760000000L;
    final int expands=RecurrenceUtil.expandCalendarBooking(calendarBooking,expandStartTime,expandEndTime,expandMax).size();
    if (expands == expandMax) {
      recurrenceObj.addExceptionDate(startTimeJCalendar);
    }
 else {
      calendarBookingLocalService.deleteCalendarBooking(calendarBooking);
      return;
    }
  }
  String recurrence=RecurrenceSerializer.serialize(recurrenceObj);
  updateChildCalendarBookings(calendarBooking,now,recurrence);
}
