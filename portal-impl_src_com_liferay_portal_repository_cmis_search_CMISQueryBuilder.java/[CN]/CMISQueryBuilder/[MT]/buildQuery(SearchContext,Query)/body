{
  StringBundler sb=new StringBundler();
  sb.append("SELECT ");
  sb.append(PropertyIds.OBJECT_ID);
  sb.append(", SCORE() AS SCORE FROM ");
  sb.append(BaseTypeId.CMIS_DOCUMENT.value());
  CMISConjunction cmisConjunction=new CMISConjunction();
  _traverseQuery(cmisConjunction,query);
  if (!cmisConjunction.isEmpty()) {
    sb.append(" WHERE ");
    sb.append(cmisConjunction.toQueryFragment());
  }
  sb.append(" ORDER BY ");
  Sort[] sorts=searchContext.getSorts();
  if ((sorts != null) && (sorts.length > 0)) {
    for (int i=0; i < sorts.length; i++) {
      Sort sort=sorts[i];
      if (i > 0) {
        sb.append(", ");
      }
      String fieldName=sort.getFieldName();
      if (fieldName.equals(Field.CREATE_DATE)) {
        sb.append(PropertyIds.CREATION_DATE);
      }
 else       if (fieldName.equals(Field.MODIFIED_DATE)) {
        sb.append(PropertyIds.LAST_MODIFICATION_DATE);
      }
 else       if (fieldName.equals(Field.TITLE)) {
        sb.append(PropertyIds.NAME);
      }
      if (sort.isReverse()) {
        sb.append(" DESC");
      }
 else {
        sb.append(" ASC");
      }
    }
  }
 else {
    sb.append("SCORE DESC");
  }
  return sb.toString();
}
