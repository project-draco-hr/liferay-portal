{
  StringBundler sb=new StringBundler();
  sb.append("SELECT ");
  sb.append(PropertyIds.OBJECT_ID);
  QueryConfig queryConfig=searchContext.getQueryConfig();
  if (queryConfig.isScoreEnabled()) {
    sb.append(", SCORE() AS HITS");
  }
  sb.append(" FROM ");
  sb.append(BaseTypeId.CMIS_DOCUMENT.value());
  CMISConjunction cmisConjunction=new CMISConjunction();
  _traverseQuery(cmisConjunction,query);
  if (!cmisConjunction.isEmpty()) {
    sb.append(" WHERE ");
    sb.append(cmisConjunction.toQueryFragment());
  }
  Sort[] sorts=searchContext.getSorts();
  if (queryConfig.isScoreEnabled() || ((sorts != null) && sorts.length > 0)) {
    sb.append(" ORDER BY ");
  }
  if ((sorts != null) && (sorts.length > 0)) {
    int i=0;
    for (    Sort sort : sorts) {
      String fieldName=sort.getFieldName();
      if (!_supportedFields.contains(fieldName)) {
        continue;
      }
      if (i > 0) {
        sb.append(", ");
      }
      sb.append(_fieldNameMap.get(fieldName));
      if (sort.isReverse()) {
        sb.append(" DESC");
      }
 else {
        sb.append(" ASC");
      }
      i++;
    }
  }
 else   if (queryConfig.isScoreEnabled()) {
    sb.append("HITS DESC");
  }
  return sb.toString();
}
