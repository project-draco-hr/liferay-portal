{
  StringBundler sb=new StringBundler();
  sb.append("SELECT " + PropertyIds.OBJECT_ID);
  sb.append(", SCORE() AS SCORE");
  sb.append(" FROM " + BaseTypeId.CMIS_DOCUMENT.value());
  CMISConjunction criterion=new CMISConjunction();
  traverseQuery(criterion,query);
  if (!criterion.isEmpty()) {
    sb.append(" WHERE ");
    sb.append(criterion.toQueryFragment());
  }
  sb.append(" ORDER BY ");
  Sort[] sorts=searchContext.getSorts();
  if (sorts != null && sorts.length > 0) {
    for (int i=0; i < sorts.length; i++) {
      Sort sort=sorts[i];
      if (i > 0) {
        sb.append(", ");
      }
      String fieldName=sort.getFieldName();
      if (fieldName.equals(Field.TITLE)) {
        sb.append(PropertyIds.NAME);
      }
 else       if (fieldName.equals(Field.CREATE_DATE)) {
        sb.append(PropertyIds.CREATION_DATE);
      }
 else       if (fieldName.equals(Field.MODIFIED_DATE)) {
        sb.append(PropertyIds.LAST_MODIFICATION_DATE);
      }
      if (sort.isReverse()) {
        sb.append(" DESC");
      }
 else {
        sb.append(" ASC");
      }
    }
  }
 else {
    sb.append("SCORE DESC");
  }
  return sb.toString();
}
