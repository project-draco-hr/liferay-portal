{
  EhcachePortalCache ehcachePortalCache=null;
synchronized (_cacheManager) {
    if (_cacheManager.cacheExists(cacheName) && cache != null) {
      if (_log.isInfoEnabled()) {
        _log.info("Overriding existing cache " + cacheName);
      }
      _cacheManager.removeCache(cacheName);
    }
    if (cache == null) {
      if (!_cacheManager.cacheExists(cacheName)) {
        _cacheManager.addCache(cacheName);
      }
    }
 else {
      _cacheManager.addCache(cache);
    }
    Ehcache ehcache=_cacheManager.getEhcache(cacheName);
    if (ehcache == null) {
      return null;
    }
    ehcache.setStatisticsEnabled(PropsValues.EHCACHE_STATISTICS_ENABLED);
    ehcachePortalCache=_cacheRegistry.get(cacheName);
    if (ehcachePortalCache == null) {
      ehcachePortalCache=new EhcachePortalCache(ehcache);
      ehcachePortalCache.setDebug(_debug);
      _cacheRegistry.put(cacheName,ehcachePortalCache);
    }
 else {
      ehcachePortalCache.setEhcache(ehcache);
    }
  }
  return ehcachePortalCache;
}
