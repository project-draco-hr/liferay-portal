{
  EhcachePortalCache<K,V> ehcachePortalCache=null;
synchronized (_cacheManager) {
    if ((cache != null) && _cacheManager.cacheExists(name)) {
      if (_log.isInfoEnabled()) {
        _log.info("Overriding existing cache " + name);
      }
      _cacheManager.removeCache(name);
    }
    if (cache == null) {
      if (!_cacheManager.cacheExists(name)) {
        _cacheManager.addCache(name);
      }
    }
 else {
      _cacheManager.addCache(cache);
    }
    Ehcache ehcache=_cacheManager.getEhcache(name);
    if (ehcache == null) {
      return null;
    }
    ehcache.setStatisticsEnabled(PropsValues.EHCACHE_STATISTICS_ENABLED);
    ehcachePortalCache=_ehcachePortalCaches.get(name);
    if (ehcachePortalCache == null) {
      ehcachePortalCache=new EhcachePortalCache<K,V>(ehcache);
      _ehcachePortalCaches.put(name,ehcachePortalCache);
    }
 else {
      ehcachePortalCache.setEhcache(ehcache);
    }
  }
  return ehcachePortalCache;
}
