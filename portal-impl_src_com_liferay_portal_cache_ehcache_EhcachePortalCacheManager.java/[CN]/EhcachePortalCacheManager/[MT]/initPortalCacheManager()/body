{
  if (Validator.isNull(_configFile)) {
    _configFile=_defaultConfigFile;
  }
  _usingDefault=_configFile.equals(_defaultConfigFile);
  _configurationPair=EhcacheConfigurationHelperUtil.getConfiguration(EhcacheConfigurationHelperUtil.class.getResource(_configFile),clusterAware,_usingDefault);
  _cacheManager=new CacheManager(_configurationPair.getKey());
  _cacheManager.setName(getName());
  if (_stopCacheManagerTimer) {
    FailSafeTimer failSafeTimer=_cacheManager.getTimer();
    failSafeTimer.cancel();
    try {
      Field cacheManagerTimerField=ReflectionUtil.getDeclaredField(CacheManager.class,"cacheManagerTimer");
      cacheManagerTimerField.set(_cacheManager,null);
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
  }
  CacheManagerEventListenerRegistry cacheManagerEventListenerRegistry=_cacheManager.getCacheManagerEventListenerRegistry();
  cacheManagerEventListenerRegistry.registerListener(new PortalCacheManagerEventListener(aggregatedCacheManagerListener));
  if (PropsValues.EHCACHE_PORTAL_CACHE_MANAGER_JMX_ENABLED) {
    Registry registry=RegistryUtil.getRegistry();
    _serviceTracker=registry.trackServices(MBeanServer.class,new MBeanServerServiceTrackerCustomizer());
    _serviceTracker.open();
  }
}
