{
  InternetAddress from=mailMessage.getFrom();
  InternetAddress to=mailMessage.getTo()[0];
  String processedSubject=StringUtil.replace(mailMessage.getSubject(),new String[]{"[$FROM_ADDRESS$]","[$FROM_NAME$]","[$TO_ADDRESS$]","[$TO_NAME$]"},new String[]{from.getAddress(),GetterUtil.getString(from.getPersonal(),from.getAddress()),HtmlUtil.escape(to.getAddress()),HtmlUtil.escape(GetterUtil.getString(to.getPersonal(),to.getAddress()))});
  processedSubject=replaceContent(processedSubject,locale,false);
  mailMessage.setSubject(processedSubject);
  String processedBody=StringUtil.replace(mailMessage.getBody(),new String[]{"[$FROM_ADDRESS$]","[$FROM_NAME$]","[$TO_ADDRESS$]","[$TO_NAME$]"},new String[]{from.getAddress(),GetterUtil.getString(from.getPersonal(),from.getAddress()),HtmlUtil.escape(to.getAddress()),HtmlUtil.escape(GetterUtil.getString(to.getPersonal(),to.getAddress()))});
  processedBody=replaceContent(processedBody,locale,htmlFormat);
  mailMessage.setBody(processedBody);
}
