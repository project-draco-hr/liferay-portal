{
  boolean firstRequest=false;
  BufferCacheServletResponse bufferCacheServletResponse=null;
synchronized (this) {
    if (_bufferCacheServletResponse == null) {
      firstRequest=true;
      _bufferCacheServletResponse=new BufferCacheServletResponse(response);
      _throwable=null;
    }
    bufferCacheServletResponse=_bufferCacheServletResponse;
  }
  if (firstRequest) {
    try {
      filterChain.doFilter(request,_bufferCacheServletResponse);
    }
 catch (    Throwable t) {
      _throwable=t;
    }
 finally {
synchronized (this) {
        _bufferCacheServletResponse=null;
        notifyAll();
      }
    }
  }
 else {
synchronized (this) {
      while (_bufferCacheServletResponse != null) {
        try {
          wait();
        }
 catch (        InterruptedException ie) {
          Thread currentThread=Thread.currentThread();
          currentThread.interrupt();
        }
      }
    }
  }
  if (_throwable != null) {
    try {
      throw _throwable;
    }
 catch (    IOException ioe) {
      throw ioe;
    }
catch (    ServletException se) {
      throw se;
    }
catch (    RuntimeException re) {
      throw re;
    }
catch (    Error e) {
      throw e;
    }
catch (    Throwable t) {
      throw new RuntimeException(t);
    }
  }
  CacheResponseData cacheResponseData=new CacheResponseData(bufferCacheServletResponse);
  CacheResponseUtil.write(response,cacheResponseData);
}
