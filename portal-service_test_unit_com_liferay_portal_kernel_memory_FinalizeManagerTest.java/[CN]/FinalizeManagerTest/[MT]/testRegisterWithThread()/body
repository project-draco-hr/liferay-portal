{
  System.setProperty(_THREAD_ENABLED_KEY,Boolean.TRUE.toString());
  Object testObject=new Object();
  MarkFinalizeAction markFinalizeAction=new MarkFinalizeAction();
  FinalizeManager.register(testObject,markFinalizeAction);
  Assert.assertFalse(markFinalizeAction.isMarked());
  testObject=null;
  long startTime=System.currentTimeMillis();
  while ((System.currentTimeMillis() - startTime) < 100) {
    System.gc();
    Thread.sleep(1);
    if (markFinalizeAction.isMarked()) {
      break;
    }
  }
  Assert.assertTrue(markFinalizeAction.isMarked());
  Thread finalizeThread=null;
  for (  Thread thread : ThreadUtil.getThreads()) {
    String name=thread.getName();
    if (name.equals("Finalize Thread")) {
      finalizeThread=thread;
      break;
    }
  }
  Assert.assertNotNull(finalizeThread);
  startTime=System.currentTimeMillis();
  while (finalizeThread.getState() != Thread.State.WAITING) {
    if ((System.currentTimeMillis() - startTime) > 10000) {
      Assert.fail("Timeout on waiting finialize thread to enter waiting " + "state");
    }
  }
  finalizeThread.interrupt();
  while (finalizeThread.getState() != Thread.State.WAITING) {
    if ((System.currentTimeMillis() - startTime) > 10000) {
      Assert.fail("Timeout on waiting finialize thread to enter waiting " + "state");
    }
  }
}
