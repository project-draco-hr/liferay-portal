{
  boolean[] cleanUpMarker=new boolean[1];
  try {
    Runnable runnable=_runnable;
    do {
      if (runnable != null) {
        _runTask(runnable);
        runnable=null;
      }
    }
 while ((runnable=_getTask(this,cleanUpMarker)) != null);
  }
  finally {
    if (!cleanUpMarker[0]) {
      _mainLock.lock();
      try {
        _completedTaskCount+=_localCompletedTaskCount;
        _workerTasks.remove(this);
        if (--_poolSize == 0) {
          _tryTerminate();
        }
      }
  finally {
        _mainLock.unlock();
      }
    }
    _threadPoolHandler.beforeThreadEnd(_thread);
  }
}
