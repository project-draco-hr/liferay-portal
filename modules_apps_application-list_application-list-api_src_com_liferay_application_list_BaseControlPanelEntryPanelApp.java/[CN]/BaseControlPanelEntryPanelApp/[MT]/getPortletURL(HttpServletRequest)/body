{
  try {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    Group controlPanelGroup=GroupLocalServiceUtil.getGroup(themeDisplay.getCompanyId(),GroupConstants.CONTROL_PANEL);
    Layout controlPanelLayout=LayoutLocalServiceUtil.fetchFirstLayout(controlPanelGroup.getGroupId(),true,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
    VirtualLayout virtualLayout=new VirtualLayout(controlPanelLayout,themeDisplay.getScopeGroup());
    request.setAttribute(WebKeys.LAYOUT,virtualLayout);
    LiferayPortletURL portletURL=PortletURLFactoryUtil.create(request,getPortletId(),virtualLayout.getPlid(),PortletRequest.RENDER_PHASE);
    portletURL.setWindowState(WindowState.MAXIMIZED);
    return portletURL;
  }
 catch (  WindowStateException wse) {
    throw new PortalException(wse);
  }
}
