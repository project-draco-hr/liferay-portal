{
  int initialNotInTrashCount=_page.getAttachmentsFileEntriesCount();
  int initialTrashEntriesCount=_page.getDeletedAttachmentsFileEntriesCount();
  Class<?> clazz=getClass();
  String fileName=ServiceTestUtil.randomString() + ".docx";
  byte[] fileBytes=FileUtil.getBytes(clazz.getResourceAsStream("dependencies/OSX_Test.docx"));
  File file=null;
  if ((fileBytes != null) && (fileBytes.length > 0)) {
    file=FileUtil.createTempFile(fileBytes);
  }
  String mimeType=MimeTypesUtil.getContentTypeFromExtension("docx");
  WikiPageLocalServiceUtil.addPageAttachment(TestPropsValues.getUserId(),_node.getNodeId(),_page.getTitle(),fileName,file,mimeType);
  Assert.assertEquals(initialNotInTrashCount + 1,_page.getAttachmentsFileEntriesCount());
  Assert.assertEquals(initialTrashEntriesCount,_page.getDeletedAttachmentsFileEntriesCount());
  long fileEntryId=WikiPageLocalServiceUtil.movePageAttachmentToTrash(TestPropsValues.getUserId(),_page.getNodeId(),_page.getTitle(),fileName);
  FileEntry fileEntry=PortletFileRepositoryUtil.getPortletFileEntry(fileEntryId);
  Assert.assertEquals(initialNotInTrashCount,_page.getAttachmentsFileEntriesCount());
  Assert.assertEquals(initialTrashEntriesCount + 1,_page.getDeletedAttachmentsFileEntriesCount());
  if (restore) {
    WikiPageLocalServiceUtil.restorePageAttachmentFromTrash(TestPropsValues.getUserId(),_page.getNodeId(),_page.getTitle(),fileEntry.getTitle());
    Assert.assertEquals(initialNotInTrashCount + 1,_page.getAttachmentsFileEntriesCount());
    Assert.assertEquals(initialTrashEntriesCount,_page.getDeletedAttachmentsFileEntriesCount());
    WikiPageLocalServiceUtil.deletePageAttachment(_page.getNodeId(),_page.getTitle(),fileName);
  }
 else {
    WikiPageLocalServiceUtil.deletePageAttachment(_page.getNodeId(),_page.getTitle(),fileEntry.getTitle());
    Assert.assertEquals(initialNotInTrashCount,_page.getAttachmentsFileEntriesCount());
    Assert.assertEquals(initialTrashEntriesCount,_page.getDeletedAttachmentsFileEntriesCount());
  }
}
