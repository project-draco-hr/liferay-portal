{
  int initialNotInTrashCount=_wikiPage.getAttachmentsFilesCount();
  int initialTrashEntriesCount=_wikiPage.getDeletedAttachmentsFileEntriesCount();
  Class<?> clazz=getClass();
  byte[] fileBytes=FileUtil.getBytes(clazz.getResourceAsStream("dependencies/OSX_Test.docx"));
  File file=null;
  if ((fileBytes != null) && (fileBytes.length > 0)) {
    file=FileUtil.createTempFile(fileBytes);
  }
  String fileName=ServiceTestUtil.randomString() + ".txt";
  WikiPageLocalServiceUtil.addPageAttachment(TestPropsValues.getUserId(),_wikiNode.getNodeId(),_wikiPage.getTitle(),fileName,file);
  Assert.assertEquals(initialNotInTrashCount + 1,_wikiPage.getAttachmentsFilesCount());
  Assert.assertEquals(initialTrashEntriesCount,_wikiPage.getDeletedAttachmentsFileEntriesCount());
  long fileEntryId=WikiPageLocalServiceUtil.movePageAttachmentToTrash(TestPropsValues.getUserId(),_wikiPage.getNodeId(),_wikiPage.getTitle(),fileName);
  FileEntry fileEntry=PortletFileRepositoryUtil.getPortletFileEntry(fileEntryId);
  Assert.assertEquals(initialNotInTrashCount,_wikiPage.getAttachmentsFilesCount());
  Assert.assertEquals(initialTrashEntriesCount + 1,_wikiPage.getDeletedAttachmentsFileEntriesCount());
  if (restore) {
    WikiPageLocalServiceUtil.restorePageAttachmentFromTrash(TestPropsValues.getUserId(),_wikiPage.getNodeId(),_wikiPage.getTitle(),fileEntry.getTitle());
    Assert.assertEquals(initialNotInTrashCount + 1,_wikiPage.getAttachmentsFilesCount());
    Assert.assertEquals(initialTrashEntriesCount,_wikiPage.getDeletedAttachmentsFileEntriesCount());
    WikiPageLocalServiceUtil.deletePageAttachment(_wikiPage.getNodeId(),_wikiPage.getTitle(),fileName);
  }
 else {
    WikiPageLocalServiceUtil.deletePageAttachment(_wikiPage.getNodeId(),_wikiPage.getTitle(),fileEntry.getTitle());
    Assert.assertEquals(initialNotInTrashCount,_wikiPage.getAttachmentsFilesCount());
    Assert.assertEquals(initialTrashEntriesCount,_wikiPage.getDeletedAttachmentsFileEntriesCount());
  }
}
