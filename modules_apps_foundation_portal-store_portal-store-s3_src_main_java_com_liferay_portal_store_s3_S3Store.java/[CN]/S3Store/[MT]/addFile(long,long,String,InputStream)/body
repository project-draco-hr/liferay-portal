{
  if (hasFile(companyId,repositoryId,fileName)) {
    throw new DuplicateFileException(companyId,repositoryId,fileName);
  }
  try {
    String key=_s3KeyTransformer.getFileVersionKey(companyId,repositoryId,fileName,VERSION_DEFAULT);
    PutObjectRequest putObjectRequest=new PutObjectRequest(_bucketName,key,is,new ObjectMetadata());
    putObjectRequest.withStorageClass(_storageClass);
    _amazonS3.putObject(putObjectRequest);
  }
 catch (  AmazonClientException ace) {
    throw transform(ace);
  }
 finally {
    StreamUtil.cleanUp(is);
  }
}
