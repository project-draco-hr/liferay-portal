{
  String testClassName="testClassName";
  ClassName className=classNameLocalService.addClassName(testClassName);
  try {
    EntityCacheUtil.clearCache();
    className=classNamePersistence.fetchByPrimaryKey(className.getClassNameId());
    Session currentSession=classNamePersistence.getCurrentSession();
    if (!currentSession.contains(className)) {
      throw new IllegalStateException("After fetch ClassName is not cached by hibernate 1st " + "level cache");
    }
    String newTestClassName="newTestClassName";
    ClassName newClassName=new ClassNameImpl();
    newClassName.setPrimaryKey(className.getClassNameId());
    newClassName.setValue(newTestClassName);
    classNameLocalService.updateClassName(newClassName);
    if (currentSession.contains(className)) {
      throw new IllegalStateException("After launched new tx ClassName is still cached by " + "hibernate 1st level cache");
    }
    EntityCacheUtil.clearCache();
    className=classNamePersistence.fetchByPrimaryKey(className.getClassNameId());
    if (!className.getValue().equals(newTestClassName)) {
      throw new IllegalStateException("Expected " + newTestClassName + ", found "+ className.getClassName());
    }
  }
  finally {
    classNameLocalService.deleteClassName(className);
  }
}
