{
  DDMStructure structure=template.getStructure();
  List<Element> dynamicElementElements=templateElement.elements("dynamic-element");
  for (  Element dynamicElementElement : dynamicElementElements) {
    String fieldName=dynamicElementElement.attributeValue("name");
    if (!structure.hasField(fieldName)) {
      templateElement.remove(dynamicElementElement);
    }
 else {
      String mode=template.getMode();
      if (mode.equals(DDMTemplateConstants.TEMPLATE_MODE_CREATE)) {
        boolean requiredAtStructure=structure.getFieldRequired(fieldName);
        List<Element> metadataElements=dynamicElementElement.elements("meta-data");
        for (        Element metadataElement : metadataElements) {
          for (          Element metadataEntryElement : metadataElement.elements()) {
            String attributeName=metadataEntryElement.attributeValue("name");
            if (requiredAtStructure && attributeName.equals("required")) {
              metadataEntryElement.setText("true");
            }
          }
        }
      }
      syncStructureTemplatesFields(template,dynamicElementElement);
    }
  }
}
