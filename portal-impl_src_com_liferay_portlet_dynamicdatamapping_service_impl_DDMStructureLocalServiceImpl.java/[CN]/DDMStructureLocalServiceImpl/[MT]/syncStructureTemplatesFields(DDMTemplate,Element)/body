{
  DDMStructure structure=template.getStructure();
  List<Element> dynamicElementElements=templateElement.elements("dynamic-element");
  for (  Element dynamicElementElement : dynamicElementElements) {
    String dataType=dynamicElementElement.attributeValue("dataType");
    String fieldName=dynamicElementElement.attributeValue("name");
    if (Validator.isNull(dataType)) {
      continue;
    }
    if (!structure.hasField(fieldName)) {
      templateElement.remove(dynamicElementElement);
      continue;
    }
    String mode=template.getMode();
    if (mode.equals(DDMTemplateConstants.TEMPLATE_MODE_CREATE)) {
      boolean fieldRequired=structure.getFieldRequired(fieldName);
      List<Element> metadataElements=dynamicElementElement.elements("meta-data");
      for (      Element metadataElement : metadataElements) {
        for (        Element metadataEntryElement : metadataElement.elements()) {
          String attributeName=metadataEntryElement.attributeValue("name");
          if (fieldRequired && attributeName.equals("required")) {
            metadataEntryElement.setText("true");
          }
        }
      }
    }
    syncStructureTemplatesFields(template,dynamicElementElement);
  }
}
