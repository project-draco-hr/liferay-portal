{
  structureKey=structureKey.trim().toUpperCase();
  if (groupId == 0) {
    _log.error("No group id was passed for " + structureKey + ". Group id is"+ "required since 4.2.0. Please update all custom code and "+ "data that references structures without a group id.");
    List<DDMStructure> ddmStructures=ddmStructurePersistence.findByStructureKey(structureKey);
    if (!ddmStructures.isEmpty()) {
      return ddmStructures.get(0);
    }
    throw new NoSuchStructureException("No DDMStructure exists with the structure id " + structureKey);
  }
  DDMStructure structure=ddmStructurePersistence.fetchByG_S(groupId,structureKey);
  if (structure != null) {
    return structure;
  }
  if (!includeGlobalStructures) {
    throw new NoSuchStructureException("No JournalStructure exists with the structure id " + structureKey);
  }
  Group group=groupPersistence.findByPrimaryKey(groupId);
  Group companyGroup=groupLocalService.getCompanyGroup(group.getCompanyId());
  return ddmStructurePersistence.findByG_S(companyGroup.getGroupId(),structureKey);
}
