{
  DDMStructureVersion structureVersion=ddmStructureVersionLocalService.getStructureVersion(structureId,version);
  if (!structureVersion.isApproved()) {
    throw new InvalidStructureVersionException("Cannot revert from an unapproved file version");
  }
  DDMStructure structure=structureVersion.getStructure();
  serviceContext.setAttribute("majorVersion",Boolean.TRUE);
  serviceContext.setAttribute("status",WorkflowConstants.STATUS_APPROVED);
  serviceContext.setCommand(Constants.REVERT);
  ddmStructureLocalService.updateStructure(userId,structure.getGroupId(),structureVersion.getParentStructureId(),structure.getClassNameId(),structure.getStructureKey(),structureVersion.getNameMap(),structureVersion.getDescriptionMap(),structureVersion.getDDMForm(),structureVersion.getDDMFormLayout(),serviceContext);
}
