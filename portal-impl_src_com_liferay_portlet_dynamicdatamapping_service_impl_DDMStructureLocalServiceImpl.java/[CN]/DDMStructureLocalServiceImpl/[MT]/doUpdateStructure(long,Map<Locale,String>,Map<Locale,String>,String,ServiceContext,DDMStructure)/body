{
  DDMXMLUtil.validateXML(definition);
  DDMForm parentDDMForm=getParentDDMForm(parentStructureId);
  DDMForm ddmForm=DDMFormXSDDeserializerUtil.deserialize(definition);
  validate(nameMap,parentDDMForm,ddmForm);
  structure.setModifiedDate(serviceContext.getModifiedDate(null));
  structure.setParentStructureId(parentStructureId);
  DDMStructureVersion latestStructureVersion=ddmStructureVersionLocalService.getLatestStructureVersion(structure.getStructureId());
  String version=getNextVersion(latestStructureVersion.getVersion(),false);
  structure.setVersion(version);
  structure.setNameMap(nameMap);
  structure.setDescriptionMap(descriptionMap);
  structure.setDefinition(definition);
  ddmStructurePersistence.update(structure);
  syncStructureTemplatesFields(structure);
  addStructureVersion(structure,version);
  Indexer indexer=IndexerRegistryUtil.getIndexer(structure.getClassName());
  if (indexer != null) {
    List<Long> ddmStructureIds=getChildrenStructureIds(structure.getGroupId(),structure.getStructureId());
    indexer.reindexDDMStructures(ddmStructureIds);
  }
  return structure;
}
