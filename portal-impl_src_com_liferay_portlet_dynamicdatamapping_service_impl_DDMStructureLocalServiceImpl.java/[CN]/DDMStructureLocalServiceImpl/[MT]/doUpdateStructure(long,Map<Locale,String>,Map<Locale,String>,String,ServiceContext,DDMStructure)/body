{
  try {
    xsd=DDMXMLUtil.validateXML(xsd);
    xsd=DDMXMLUtil.formatXML(xsd);
  }
 catch (  Exception e) {
    throw new StructureXsdException();
  }
  String parentXsd=StringPool.BLANK;
  DDMStructure parentStructure=ddmStructurePersistence.fetchByPrimaryKey(parentStructureId);
  if (parentStructure != null) {
    parentXsd=parentStructure.getCompleteXsd();
  }
  validate(nameMap,parentXsd,xsd);
  structure.setModifiedDate(serviceContext.getModifiedDate(null));
  structure.setParentStructureId(parentStructureId);
  structure.setNameMap(nameMap);
  structure.setDescriptionMap(descriptionMap);
  structure.setXsd(xsd);
  ddmStructurePersistence.update(structure);
  syncStructureTemplatesFields(structure);
  Indexer indexer=IndexerRegistryUtil.getIndexer(structure.getClassName());
  if (indexer != null) {
    List<Long> ddmStructureIds=getChildrenStructureIds(structure.getGroupId(),structure.getStructureId());
    indexer.reindexDDMStructures(ddmStructureIds);
  }
  return structure;
}
