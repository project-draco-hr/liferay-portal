{
  String xsd=structure.getXsd();
  Document structureDocument=null;
  try {
    structureDocument=SAXReaderUtil.read(xsd);
  }
 catch (  DocumentException de) {
    if (_log.isWarnEnabled()) {
      _log.warn(de,de);
    }
    return;
  }
  Element templateElement=templateDocument.getRootElement();
  XPath structureXPath=SAXReaderUtil.createXPath("//dynamic-element[.//meta-data/entry[@name=\"required\"]=" + "\"true\"]");
  List<Node> nodes=structureXPath.selectNodes(structureDocument);
  StringBundler sb=new StringBundler(3);
  for (  Node node : nodes) {
    Element element=(Element)node;
    sb.setIndex(0);
    sb.append("//dynamic-element[@name=");
    String escapedName=HtmlUtil.escapeXPathAttribute(element.attributeValue("name"));
    sb.append(escapedName);
    sb.append("]");
    XPath templateXPath=SAXReaderUtil.createXPath(sb.toString());
    if (!templateXPath.booleanValueOf(templateDocument)) {
      templateElement.add(element.createCopy());
    }
  }
}
