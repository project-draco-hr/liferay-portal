{
  boolean isSubstringSearchAlways=false;
  if (_queryPreProcessConfiguration != null) {
    isSubstringSearchAlways=_queryPreProcessConfiguration.isSubstringSearchAlways(field);
  }
  boolean phrase=false;
  if (value.startsWith(StringPool.QUOTE) && value.endsWith(StringPool.QUOTE)) {
    phrase=true;
  }
  Query query=null;
  if (!phrase && (like || isSubstringSearchAlways)) {
    value=StringUtil.replace(value,StringPool.PERCENT,StringPool.BLANK);
    if (isSubstringSearchAlways) {
      if (value.length() == 0) {
        value=StringPool.STAR;
      }
 else {
        value=StringUtil.toLowerCase(value);
        value=StringPool.STAR + value + StringPool.STAR;
      }
    }
    query=new WildcardQueryImpl(new QueryTermImpl(field,value));
  }
 else {
    MatchQuery matchQuery=new MatchQuery(field,value);
    if (value.startsWith(StringPool.QUOTE) && value.endsWith(StringPool.QUOTE)) {
      value=value.substring(0,value.length() - 2);
      if (value.endsWith(StringPool.STAR)) {
        matchQuery.setType(MatchQuery.Type.PHRASE_PREFIX);
      }
 else {
        matchQuery.setType(MatchQuery.Type.PHRASE);
      }
    }
    query=matchQuery;
  }
  return query;
}
