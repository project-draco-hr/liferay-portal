{
  Class<?> providerClass=null;
  try {
    providerClass=Class.forName(PROVIDER_CLASS);
  }
 catch (  ClassNotFoundException cnfe) {
    if (ServerDetector.isWebSphere() && PROVIDER_CLASS.equals(SUN_PROVIDER_CLASS)) {
      if (_log.isWarnEnabled()) {
        _log.warn("WebSphere does not have " + SUN_PROVIDER_CLASS + ", using "+ IBM_PROVIDER_CLASS+ " instead");
      }
      providerClass=Class.forName(IBM_PROVIDER_CLASS);
    }
 else     if (System.getProperty("java.vm.vendor").equals("IBM Corporation")) {
      if (_log.isWarnEnabled()) {
        _log.warn("IBM JVM does not have " + SUN_PROVIDER_CLASS + ", using "+ IBM_PROVIDER_CLASS+ " instead");
      }
      providerClass=Class.forName(IBM_PROVIDER_CLASS);
    }
 else {
      throw cnfe;
    }
  }
  return (Provider)providerClass.newInstance();
}
