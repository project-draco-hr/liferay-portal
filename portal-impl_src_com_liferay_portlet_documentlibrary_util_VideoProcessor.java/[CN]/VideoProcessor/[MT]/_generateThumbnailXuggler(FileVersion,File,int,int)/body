{
  String tempFileId=DLUtil.getTempFileId(fileVersion.getFileEntryId(),fileVersion.getVersion());
  File thumbnailTempFile=getThumbnailTempFile(tempFileId);
  try {
    IMediaReader iMediaReader=ToolFactory.makeReader(file.getCanonicalPath());
    iMediaReader.setBufferedImageTypeToGenerate(BufferedImage.TYPE_3BYTE_BGR);
    CaptureFrameListener captureFrameListener=new CaptureFrameListener(thumbnailTempFile,THUMBNAIL_TYPE,height,width);
    iMediaReader.addListener(captureFrameListener);
    while (iMediaReader.readPacket() == null) {
    }
    addFileToStore(fileVersion.getCompanyId(),THUMBNAIL_PATH,getThumbnailFilePath(fileVersion),thumbnailTempFile);
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
 finally {
    FileUtil.delete(thumbnailTempFile);
  }
}
