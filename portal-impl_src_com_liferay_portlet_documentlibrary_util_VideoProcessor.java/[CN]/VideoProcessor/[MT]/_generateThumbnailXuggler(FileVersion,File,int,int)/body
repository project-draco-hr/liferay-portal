{
  StopWatch stopWatch=null;
  if (_log.isInfoEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  String tempFileId=DLUtil.getTempFileId(fileVersion.getFileEntryId(),fileVersion.getVersion());
  File thumbnailTempFile=getThumbnailTempFile(tempFileId);
  try {
    try {
      ProcessCallable<String> processCallable=new LiferayVideoThumbnailProcessCallable(file.getCanonicalPath(),thumbnailTempFile,THUMBNAIL_TYPE,height,width,PropsValues.DL_FILE_ENTRY_THUMBNAIL_VIDEO_FRAME_PERCENTAGE);
      ProcessExecutor.execute(processCallable,ClassPathUtil.getPortalClassPath());
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
    addFileToStore(fileVersion.getCompanyId(),THUMBNAIL_PATH,getThumbnailFilePath(fileVersion),thumbnailTempFile);
    if (_log.isInfoEnabled()) {
      _log.info("Xuggler generated a thumbnail for " + fileVersion.getTitle() + " in "+ stopWatch);
    }
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
 finally {
    FileUtil.delete(thumbnailTempFile);
  }
}
