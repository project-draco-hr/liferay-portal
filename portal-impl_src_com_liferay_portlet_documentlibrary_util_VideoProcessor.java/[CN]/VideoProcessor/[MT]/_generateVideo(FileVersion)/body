{
  String tempFileId=DLUtil.getTempFileId(fileVersion.getFileEntryId(),fileVersion.getVersion());
  File videoTempFile=_getVideoTempFile(tempFileId,fileVersion.getExtension());
  File previewTempFile=getPreviewTempFile(tempFileId);
  try {
    if (!PrefsPropsUtil.getBoolean(PropsKeys.XUGGLER_ENABLED,PropsValues.XUGGLER_ENABLED) || _hasVideo(fileVersion)) {
      return;
    }
    File file=null;
    if (_isGeneratePreview(fileVersion) || _isGenerateThumbnail(fileVersion)) {
      if (fileVersion instanceof LiferayFileVersion) {
        try {
          LiferayFileVersion liferayFileVersion=(LiferayFileVersion)fileVersion;
          file=liferayFileVersion.getFile(false);
        }
 catch (        UnsupportedOperationException uoe) {
        }
      }
      if (file == null) {
        InputStream inputStream=fileVersion.getContentStream(false);
        FileUtil.write(videoTempFile,inputStream);
        file=videoTempFile;
      }
    }
    if (_isGeneratePreview(fileVersion)) {
      try {
        _generateVideoXuggler(fileVersion,file,previewTempFile,PropsValues.DL_FILE_ENTRY_PREVIEW_VIDEO_HEIGHT,PropsValues.DL_FILE_ENTRY_PREVIEW_VIDEO_WIDTH);
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
    }
    if (_isGenerateThumbnail(fileVersion)) {
      try {
        _generateThumbnailXuggler(fileVersion,file,PrefsPropsUtil.getInteger(PropsKeys.DL_FILE_ENTRY_THUMBNAIL_MAX_HEIGHT),PrefsPropsUtil.getInteger(PropsKeys.DL_FILE_ENTRY_THUMBNAIL_MAX_WIDTH));
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
    }
  }
 catch (  NoSuchFileEntryException nsfee) {
  }
 finally {
    _fileVersionIds.remove(fileVersion.getFileVersionId());
    FileUtil.delete(previewTempFile);
    FileUtil.delete(videoTempFile);
  }
}
