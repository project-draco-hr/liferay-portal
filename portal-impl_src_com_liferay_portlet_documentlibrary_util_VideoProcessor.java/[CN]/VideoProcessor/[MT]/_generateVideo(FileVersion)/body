{
  String tempFileId=DLUtil.getTempFileId(fileVersion.getFileEntryId(),fileVersion.getVersion());
  File videoTempFile=_getVideoTempFile(tempFileId,fileVersion.getExtension());
  File previewTempFile=getPreviewTempFile(tempFileId);
  try {
    if (!PrefsPropsUtil.getBoolean(PropsKeys.XUGGLER_ENABLED,PropsValues.XUGGLER_ENABLED) || _hasVideo(fileVersion)) {
      return;
    }
    if (_isGeneratePreview(fileVersion)) {
      InputStream inputStream=fileVersion.getContentStream(false);
      FileUtil.write(videoTempFile,inputStream);
      try {
        _generateVideoXuggler(fileVersion,videoTempFile,previewTempFile,PropsValues.DL_FILE_ENTRY_PREVIEW_VIDEO_HEIGHT,PropsValues.DL_FILE_ENTRY_PREVIEW_VIDEO_WIDTH);
      }
 catch (      Exception e) {
        _log.error(e);
      }
      if (_log.isInfoEnabled()) {
        _log.info("Xuggler generated a preview video for " + tempFileId);
      }
    }
    if (_isGenerateThumbnail(fileVersion)) {
      try {
        _generateThumbnailXuggler(fileVersion,previewTempFile,PropsValues.DL_FILE_ENTRY_THUMBNAIL_HEIGHT,PropsValues.DL_FILE_ENTRY_THUMBNAIL_WIDTH);
      }
 catch (      Exception e) {
        _log.error(e);
      }
      if (_log.isInfoEnabled()) {
        _log.info("Xuggler generated a thumbnail for " + tempFileId);
      }
    }
  }
 catch (  NoSuchFileEntryException nsfee) {
  }
 finally {
    _fileVersionIds.remove(fileVersion.getFileVersionId());
    FileUtil.delete(previewTempFile);
    FileUtil.delete(videoTempFile);
  }
}
