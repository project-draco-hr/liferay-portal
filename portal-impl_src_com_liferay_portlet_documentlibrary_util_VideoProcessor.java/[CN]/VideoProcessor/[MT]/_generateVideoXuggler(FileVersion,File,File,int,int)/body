{
  IMediaReader iMediaReader=ToolFactory.makeReader(srcFile.getCanonicalPath());
  VideoResizer videoResizer=new VideoResizer(height,width);
  iMediaReader.addListener(videoResizer);
  AudioListener audioListener=new AudioListener();
  videoResizer.addListener(audioListener);
  IMediaWriter iMediaWriter=ToolFactory.makeWriter(destFile.getCanonicalPath(),iMediaReader);
  audioListener.addListener(iMediaWriter);
  VideoListener videoListener=new VideoListener(height,width);
  iMediaWriter.addListener(videoListener);
  try {
    while (iMediaReader.readPacket() == null) {
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  addFileToStore(fileVersion.getCompanyId(),PREVIEW_PATH,getPreviewFilePath(fileVersion),destFile);
  if (_log.isInfoEnabled()) {
    _log.info("Xuggler generated a preview video for " + fileVersion.getFileVersionId());
  }
}
