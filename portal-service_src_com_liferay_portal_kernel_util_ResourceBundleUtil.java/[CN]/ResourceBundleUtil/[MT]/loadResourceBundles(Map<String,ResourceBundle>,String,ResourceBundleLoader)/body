{
  String[] languageIdParts=("_" + languageId).split("_");
  String currentLanguageId=StringPool.BLANK;
  Deque<ResourceBundle> currentResourceBundles=new LinkedList<>();
  for (int i=0; i < languageIdParts.length; i++) {
    if (i > 1) {
      currentLanguageId+="_";
    }
    currentLanguageId+=languageIdParts[i];
    ResourceBundle resourceBundle=resourceBundleLoader.loadResourceBundle(currentLanguageId);
    if (resourceBundle != null) {
      currentResourceBundles.addFirst(resourceBundle);
    }
    if (currentResourceBundles.isEmpty()) {
      continue;
    }
    if (currentResourceBundles.size() == 1) {
      resourceBundles.put(currentLanguageId,currentResourceBundles.peek());
    }
 else {
      int size=currentResourceBundles.size();
      resourceBundles.put(currentLanguageId,new AggregateResourceBundle(currentResourceBundles.toArray(new ResourceBundle[size])));
    }
  }
}
