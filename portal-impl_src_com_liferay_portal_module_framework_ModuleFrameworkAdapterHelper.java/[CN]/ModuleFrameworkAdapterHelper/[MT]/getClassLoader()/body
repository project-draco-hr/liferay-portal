{
  if (_classLoader != null) {
    return _classLoader;
  }
  try {
    File coreDir=new File(PropsValues.LIFERAY_WEB_PORTAL_CONTEXT_TEMPDIR,"osgi");
    _initDir("com/liferay/portal/deploy/dependencies/osgi/core",coreDir.getAbsolutePath());
    _initDir("com/liferay/portal/deploy/dependencies/osgi/portal",PropsValues.MODULE_FRAMEWORK_PORTAL_DIR);
    File[] files=coreDir.listFiles();
    URL[] urls=new URL[files.length];
    for (int i=0; i < urls.length; i++) {
      urls[i]=new URL("file",null,files[i].getAbsolutePath());
    }
    _classLoader=new ModuleFrameworkClassLoader(urls,ClassLoaderUtil.getPortalClassLoader());
    return _classLoader;
  }
 catch (  Exception e) {
    _log.error("Unable to configure the class loader for the module " + "framework");
    throw new RuntimeException(e);
  }
}
