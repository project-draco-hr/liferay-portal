{
  Boolean portalResiliencyAction=(Boolean)request.getAttribute(WebKeys.PORTAL_RESILIENCY_ACTION);
  if (portalResiliencyAction != Boolean.TRUE) {
    portalResiliencyResponse=false;
    return;
  }
  portalResiliencyResponse=true;
  metaData=bufferCacheServletResponse.getMetaData();
  byteData=null;
  if (bufferCacheServletResponse.isByteMode()) {
    ByteBuffer byteBuffer=bufferCacheServletResponse.getByteBuffer();
    if (byteBuffer.remaining() > 0) {
      if (byteBuffer.hasArray()) {
        byte[] byteArray=byteBuffer.array();
        if (byteBuffer.remaining() == byteArray.length) {
          byteData=byteArray;
        }
      }
      if (byteData == null) {
        byteData=new byte[byteBuffer.remaining()];
        byteBuffer.get(byteData);
      }
    }
  }
  stringData=null;
  if (!bufferCacheServletResponse.isCharMode()) {
    return;
  }
  String content=bufferCacheServletResponse.getString();
  if (content.length() == 0) {
    return;
  }
  if (ParamUtil.get(request,"portalResiliencyPortletShowFooter",PropsValues.PORTAL_RESILIENCY_PORTLET_SHOW_FOOTER)) {
    int index=content.lastIndexOf("</div>");
    if (index > 0) {
      StringBundler sb=new StringBundler(6);
      sb.append(content.substring(0,index));
      sb.append("<div class=\"alert alert-info\"><strong>");
      sb.append("This portlet is from SPI ");
      sb.append(PortalUtil.getPortalPort(false));
      sb.append("</strong></div>");
      sb.append(content.substring(index));
      content=sb.toString();
    }
  }
  stringData=content;
}
