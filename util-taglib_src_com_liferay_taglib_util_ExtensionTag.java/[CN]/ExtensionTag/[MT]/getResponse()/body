{
  ServletResponse response=pageContext.getResponse();
  if (!(response instanceof HttpServletResponse)) {
    throw new IllegalStateException("This can only be used from HTTP");
  }
  HttpServletResponse httpServletResponse=(HttpServletResponse)response;
  return new HttpServletResponseWrapper(httpServletResponse){
    @Override public ServletOutputStream getOutputStream() throws IOException {
      return new ServletOutputStream(){
        @Override public void write(        int b) throws IOException {
          JspWriter out=pageContext.getOut();
          out.write(b);
        }
      }
;
    }
    @Override public PrintWriter getWriter() throws IOException {
      return new PrintWriter(pageContext.getOut(),true);
    }
  }
;
}
