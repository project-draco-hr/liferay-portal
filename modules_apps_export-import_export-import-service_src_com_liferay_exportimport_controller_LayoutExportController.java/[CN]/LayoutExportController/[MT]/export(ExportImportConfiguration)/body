{
  PortletDataContext portletDataContext=null;
  try {
    ExportImportThreadLocal.setLayoutExportInProcess(true);
    Map<String,Serializable> settingsMap=exportImportConfiguration.getSettingsMap();
    long[] layoutIds=GetterUtil.getLongValues(settingsMap.get("layoutIds"));
    portletDataContext=getPortletDataContext(exportImportConfiguration);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(EVENT_LAYOUT_EXPORT_STARTED,getProcessFlag(),PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext));
    File file=doExport(portletDataContext,layoutIds);
    ExportImportThreadLocal.setLayoutExportInProcess(false);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(EVENT_LAYOUT_EXPORT_SUCCEEDED,getProcessFlag(),PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext));
    return file;
  }
 catch (  Throwable t) {
    ExportImportThreadLocal.setLayoutExportInProcess(false);
    ExportImportLifecycleManager.fireExportImportLifecycleEvent(EVENT_LAYOUT_EXPORT_FAILED,getProcessFlag(),PortletDataContextFactoryUtil.clonePortletDataContext(portletDataContext),t);
    throw t;
  }
}
