{
  FilterBuilder filterBuilder=null;
  String field=termFilter.getField();
  String value=termFilter.getValue();
  if ((_queryPreProcessConfiguration != null) && _queryPreProcessConfiguration.isSubstringSearchAlways(field)) {
    WildcardQueryBuilder wildcardQueryBuilder=toCaseInsensitiveSubstringQuery(field,value);
    QueryFilterBuilder queryFilterBuilder=FilterBuilders.queryFilter(wildcardQueryBuilder);
    if (termFilter.isCached() != null) {
      queryFilterBuilder.cache(termFilter.isCached());
    }
    filterBuilder=queryFilterBuilder;
  }
 else {
    TermFilterBuilder termFilterBuilder=FilterBuilders.termFilter(field,value);
    if (termFilter.isCached() != null) {
      termFilterBuilder.cache(termFilter.isCached());
    }
    filterBuilder=termFilterBuilder;
  }
  return filterBuilder;
}
