{
  String basedir="./";
  if (_portalSource) {
    Properties properties=new Properties();
    String propertiesContent=_fileUtil.read(basedir + "portal-impl/src/portal.properties");
    PropertiesUtil.load(properties,propertiesContent);
    String[] locales=StringUtil.split(properties.getProperty(PropsKeys.LOCALES));
    Arrays.sort(locales);
    Set<String> urlPatterns=new TreeSet<String>();
    for (    String locale : locales) {
      int pos=locale.indexOf(StringPool.UNDERLINE);
      String languageCode=locale.substring(0,pos);
      urlPatterns.add(languageCode);
      urlPatterns.add(locale);
    }
    StringBundler sb=new StringBundler();
    for (    String urlPattern : urlPatterns) {
      sb.append("\t<servlet-mapping>\n");
      sb.append("\t\t<servlet-name>I18n Servlet</servlet-name>\n");
      sb.append("\t\t<url-pattern>/" + urlPattern + "/*</url-pattern>\n");
      sb.append("\t</servlet-mapping>\n");
    }
    File file=new File(basedir + "portal-web/docroot/WEB-INF/web.xml");
    String content=_fileUtil.read(file);
    String newContent=_trimContent(content);
    int x=newContent.indexOf("<servlet-mapping>");
    x=newContent.indexOf("<servlet-name>I18n Servlet</servlet-name>",x);
    x=newContent.lastIndexOf("<servlet-mapping>",x) - 1;
    int y=newContent.lastIndexOf("<servlet-name>I18n Servlet</servlet-name>");
    y=newContent.indexOf("</servlet-mapping>",y) + 19;
    newContent=newContent.substring(0,x) + sb.toString() + newContent.substring(y);
    x=newContent.indexOf("<security-constraint>");
    x=newContent.indexOf("<web-resource-name>/c/portal/protected</web-resource-name>",x);
    x=newContent.indexOf("<url-pattern>",x) - 3;
    y=newContent.indexOf("<http-method>",x);
    y=newContent.lastIndexOf("</url-pattern>",y) + 15;
    sb=new StringBundler();
    sb.append("\t\t\t<url-pattern>/c/portal/protected</url-pattern>\n");
    for (    String urlPattern : urlPatterns) {
      sb.append("\t\t\t<url-pattern>/" + urlPattern + "/c/portal/protected</url-pattern>\n");
    }
    newContent=newContent.substring(0,x) + sb.toString() + newContent.substring(y);
    if ((newContent != null) && !content.equals(newContent)) {
      _fileUtil.write(file,newContent);
      System.out.println(file);
    }
  }
 else {
    String webXML=ContentUtil.get("com/liferay/portal/deploy/dependencies/web.xml");
    DirectoryScanner directoryScanner=new DirectoryScanner();
    directoryScanner.setBasedir(basedir);
    directoryScanner.setIncludes(new String[]{"**\\web.xml"});
    List<String> fileNames=_sourceFormatterHelper.scanForFiles(directoryScanner);
    for (    String fileName : fileNames) {
      String content=_fileUtil.read(basedir + fileName);
      if (content.equals(webXML)) {
        _processErrorMessage(fileName,fileName);
      }
    }
  }
}
