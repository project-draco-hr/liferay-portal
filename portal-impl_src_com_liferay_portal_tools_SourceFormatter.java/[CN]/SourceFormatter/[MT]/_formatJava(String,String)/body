{
  StringBundler sb=new StringBundler();
  UnsyncBufferedReader unsyncBufferedReader=new UnsyncBufferedReader(new UnsyncStringReader(content));
  int lineCount=0;
  String line=null;
  String previousLine=StringPool.BLANK;
  int lineToSkipIfEmpty=0;
  String javaTermName=null;
  int javaTermType=0;
  String previousJavaTermName=null;
  int previousJavaTermType=0;
  List<String> parameterTypes=new ArrayList<String>();
  List<String> previousParameterTypes=null;
  boolean hasSameConstructorOrMethodName=false;
  boolean readParameterTypes=false;
  String ifClause=StringPool.BLANK;
  String packageName=StringPool.BLANK;
  while ((line=unsyncBufferedReader.readLine()) != null) {
    lineCount++;
    line=_trimLine(line);
    line=StringUtil.replace(line,new String[]{"* Copyright (c) 2000-2011 Liferay, Inc."},new String[]{"* Copyright (c) 2000-2012 Liferay, Inc."});
    if (line.startsWith("package ")) {
      packageName=line.substring(8,line.length() - 1);
    }
    if (line.startsWith("import ")) {
      int pos=line.lastIndexOf(StringPool.PERIOD);
      if (pos != -1) {
        String importPackageName=line.substring(7,pos);
        if (importPackageName.equals(packageName)) {
          continue;
        }
      }
    }
    if (line.contains(StringPool.TAB + "for (") && line.contains(":") && !line.contains(" :")) {
      line=StringUtil.replace(line,":"," :");
    }
    line=_replacePrimitiveWrapperInstantiation(fileName,line,lineCount);
    String trimmedLine=StringUtil.trimLeading(line);
    if (trimmedLine.startsWith(StringPool.EQUAL)) {
      _sourceFormatterHelper.printError(fileName,"equal: " + fileName + " "+ lineCount);
    }
    if (!trimmedLine.equals("{") && line.endsWith("{") && !line.endsWith(" {")) {
      line=StringUtil.replaceLast(line,"{"," {");
    }
    line=_sortExceptions(line);
    if (trimmedLine.startsWith("if (") || trimmedLine.startsWith("else if (") || trimmedLine.startsWith("while (")|| Validator.isNotNull(ifClause)) {
      if (Validator.isNull(ifClause) || ifClause.endsWith(StringPool.OPEN_PARENTHESIS)) {
        ifClause=ifClause + trimmedLine;
      }
 else {
        ifClause=ifClause + StringPool.SPACE + trimmedLine;
      }
      if (ifClause.endsWith(") {")) {
        _checkIfClause(ifClause,fileName,lineCount);
        ifClause=StringPool.BLANK;
      }
    }
    String excluded=null;
    String fileNameWithForwardSlashes=StringUtil.replace(fileName,"\\","/");
    if (line.startsWith(StringPool.TAB + "private ") || line.startsWith(StringPool.TAB + "protected ") || line.startsWith(StringPool.TAB + "public ")) {
      hasSameConstructorOrMethodName=false;
      Tuple tuple=_getJavaTermTuple(line);
      if (tuple != null) {
        javaTermName=(String)tuple.getObject(0);
        if (Validator.isNotNull(javaTermName)) {
          javaTermType=(Integer)tuple.getObject(1);
          boolean isConstructorOrMethod=_isInJavaTermTypeGroup(javaTermType,_TYPE_CONSTRUCTOR) || _isInJavaTermTypeGroup(javaTermType,_TYPE_METHOD);
          if (isConstructorOrMethod) {
            readParameterTypes=true;
          }
          if (_javaTermSortExclusions != null) {
            excluded=_javaTermSortExclusions.getProperty(fileNameWithForwardSlashes + StringPool.AT + lineCount);
            if (excluded == null) {
              excluded=_javaTermSortExclusions.getProperty(fileNameWithForwardSlashes + StringPool.AT + javaTermName);
            }
            if (excluded == null) {
              excluded=_javaTermSortExclusions.getProperty(fileNameWithForwardSlashes);
            }
          }
          if (excluded == null) {
            if (_isInJavaTermTypeGroup(javaTermType,_TYPE_VARIABLE_NOT_FINAL)) {
              char firstChar=javaTermName.charAt(0);
              if (firstChar == CharPool.UNDERLINE) {
                firstChar=javaTermName.charAt(1);
              }
              if (Character.isUpperCase(firstChar)) {
                _sourceFormatterHelper.printError(fileName,"final: " + fileName + " "+ lineCount);
              }
            }
            if (Validator.isNotNull(previousJavaTermName)) {
              if (previousJavaTermType > javaTermType) {
                _sourceFormatterHelper.printError(fileName,"order: " + fileName + " "+ lineCount);
              }
 else               if (previousJavaTermType == javaTermType) {
                if (isConstructorOrMethod && previousJavaTermName.equals(javaTermName)) {
                  hasSameConstructorOrMethodName=true;
                }
 else {
                  _compareJavaTermNames(fileName,previousJavaTermName,javaTermName,javaTermType,lineCount);
                }
              }
            }
          }
          previousJavaTermName=javaTermName;
          previousJavaTermType=javaTermType;
        }
      }
    }
    if (readParameterTypes) {
      parameterTypes=_addParameterTypes(trimmedLine,parameterTypes);
      if (trimmedLine.contains(StringPool.CLOSE_PARENTHESIS)) {
        if (hasSameConstructorOrMethodName) {
          _compareMethodParameterTypes(fileName,previousParameterTypes,parameterTypes,lineCount);
        }
        readParameterTypes=false;
        previousParameterTypes=ListUtil.copy(parameterTypes);
        parameterTypes.clear();
      }
    }
    if (!trimmedLine.contains(StringPool.DOUBLE_SLASH) && !trimmedLine.startsWith(StringPool.STAR)) {
      while (trimmedLine.contains(StringPool.TAB)) {
        line=StringUtil.replaceLast(line,StringPool.TAB,StringPool.SPACE);
        trimmedLine=StringUtil.replaceLast(trimmedLine,StringPool.TAB,StringPool.SPACE);
      }
      if (line.contains(StringPool.TAB + StringPool.SPACE) && !previousLine.endsWith("&&") && !previousLine.endsWith("||")&& !previousLine.contains(StringPool.TAB + "((")&& !previousLine.contains(StringPool.TAB + StringPool.SPACE)&& !previousLine.contains(StringPool.TAB + "implements ")&& !previousLine.contains(StringPool.TAB + "throws ")) {
        line=StringUtil.replace(line,StringPool.TAB + StringPool.SPACE,StringPool.TAB);
      }
      while (trimmedLine.contains(StringPool.DOUBLE_SPACE) && !trimmedLine.contains(StringPool.QUOTE + StringPool.DOUBLE_SPACE) && !fileName.contains("Test")) {
        line=StringUtil.replaceLast(line,StringPool.DOUBLE_SPACE,StringPool.SPACE);
        trimmedLine=StringUtil.replaceLast(trimmedLine,StringPool.DOUBLE_SPACE,StringPool.SPACE);
      }
      if (!line.contains(StringPool.QUOTE)) {
        if ((trimmedLine.startsWith("private ") || trimmedLine.startsWith("protected ") || trimmedLine.startsWith("public ")) && line.contains(" (")) {
          line=StringUtil.replace(line," (","(");
        }
        if (line.contains(" [")) {
          line=StringUtil.replace(line," [","[");
        }
        for (int x=-1; ; ) {
          int posComma=line.indexOf(StringPool.COMMA,x + 1);
          int posSemicolon=line.indexOf(StringPool.SEMICOLON,x + 1);
          if ((posComma == -1) && (posSemicolon == -1)) {
            break;
          }
          x=Math.min(posComma,posSemicolon);
          if (x == -1) {
            x=Math.max(posComma,posSemicolon);
          }
          if (line.length() > (x + 1)) {
            char nextChar=line.charAt(x + 1);
            if ((nextChar != CharPool.APOSTROPHE) && (nextChar != CharPool.CLOSE_PARENTHESIS) && (nextChar != CharPool.SPACE)&& (nextChar != CharPool.STAR)) {
              line=StringUtil.insert(line,StringPool.SPACE,x + 1);
            }
          }
          if (x > 0) {
            char previousChar=line.charAt(x - 1);
            if (previousChar == CharPool.SPACE) {
              line=line.substring(0,x - 1).concat(line.substring(x));
            }
          }
        }
      }
    }
    if ((line.contains(" && ") || line.contains(" || ")) && line.endsWith(StringPool.OPEN_PARENTHESIS)) {
      _sourceFormatterHelper.printError(fileName,"line break: " + fileName + " "+ lineCount);
    }
    if (line.contains(StringPool.COMMA) && !line.contains(StringPool.CLOSE_PARENTHESIS) && !line.contains(StringPool.GREATER_THAN)&& !line.contains(StringPool.QUOTE)&& line.endsWith(StringPool.OPEN_PARENTHESIS)) {
      _sourceFormatterHelper.printError(fileName,"line break: " + fileName + " "+ lineCount);
    }
    if (line.endsWith(" +") || line.endsWith(" -") || line.endsWith(" *")|| line.endsWith(" /")) {
      int x=line.indexOf(" = ");
      if (x != -1) {
        int y=line.indexOf(StringPool.QUOTE);
        if ((y == -1) || (x < y)) {
          _sourceFormatterHelper.printError(fileName,"line break: " + fileName + " "+ lineCount);
        }
      }
    }
    if (line.contains("    ") && !line.matches("\\s*\\*.*")) {
      if (!fileName.endsWith("StringPool.java")) {
        _sourceFormatterHelper.printError(fileName,"tab: " + fileName + " "+ lineCount);
      }
    }
    if (line.contains("  {") && !line.matches("\\s*\\*.*")) {
      _sourceFormatterHelper.printError(fileName,"{:" + fileName + " "+ lineCount);
    }
    excluded=null;
    if (_lineLengthExclusions != null) {
      excluded=_lineLengthExclusions.getProperty(fileNameWithForwardSlashes + StringPool.AT + lineCount);
      if (excluded == null) {
        excluded=_lineLengthExclusions.getProperty(fileNameWithForwardSlashes);
      }
    }
    Tuple combinedLines=null;
    int lineLength=_getLineLength(line);
    if ((excluded == null) && !line.startsWith("import ") && !line.startsWith("package ")&& !line.matches("\\s*\\*.*")) {
      if (fileName.endsWith("Table.java") && line.contains("String TABLE_SQL_CREATE = ")) {
      }
 else       if (fileName.endsWith("Table.java") && line.contains("String TABLE_SQL_DROP = ")) {
      }
 else       if (fileName.endsWith("Table.java") && line.contains(" index IX_")) {
      }
 else {
        if (lineLength > 80) {
          _sourceFormatterHelper.printError(fileName,"> 80: " + fileName + " "+ lineCount);
        }
 else {
          int lineTabCount=StringUtil.count(line,StringPool.TAB);
          int previousLineTabCount=StringUtil.count(previousLine,StringPool.TAB);
          if (previousLine.endsWith(StringPool.COMMA) && previousLine.contains(StringPool.OPEN_PARENTHESIS) && !previousLine.contains("for (")&& (lineTabCount > previousLineTabCount)) {
            _sourceFormatterHelper.printError(fileName,"line break: " + fileName + " "+ lineCount);
          }
          if (Validator.isNotNull(trimmedLine) && ((previousLine.endsWith(StringPool.COLON) && previousLine.contains(StringPool.TAB + "for ")) || (previousLine.endsWith(StringPool.OPEN_PARENTHESIS) && previousLine.contains(StringPool.TAB + "if "))) && ((previousLineTabCount + 2) != lineTabCount)) {
            _sourceFormatterHelper.printError(fileName,"line break: " + fileName + " "+ lineCount);
          }
          if (previousLine.endsWith(StringPool.PERIOD)) {
            int x=trimmedLine.indexOf(StringPool.OPEN_PARENTHESIS);
            if ((x != -1) && ((_getLineLength(previousLine) + x) < 80) && (trimmedLine.endsWith(StringPool.OPEN_PARENTHESIS) || (trimmedLine.charAt(x + 1) != CharPool.CLOSE_PARENTHESIS))) {
              _sourceFormatterHelper.printError(fileName,"line break: " + fileName + " "+ lineCount);
            }
          }
          combinedLines=_getCombinedLines(trimmedLine,previousLine,lineTabCount,previousLineTabCount);
        }
      }
    }
    if (combinedLines != null) {
      previousLine=(String)combinedLines.getObject(0);
      if (combinedLines.getSize() > 1) {
        String linePart=(String)combinedLines.getObject(1);
        boolean addToPreviousLine=(Boolean)combinedLines.getObject(2);
        if (addToPreviousLine) {
          previousLine=previousLine + linePart;
          line=StringUtil.replaceFirst(line,linePart,StringPool.BLANK);
        }
 else {
          if (((linePart.length() + lineLength) <= 80) && (line.endsWith(StringPool.OPEN_CURLY_BRACE) || line.endsWith(StringPool.SEMICOLON))) {
            previousLine=StringUtil.replaceLast(previousLine,linePart,StringPool.BLANK);
            line=StringUtil.replaceLast(line,StringPool.TAB,StringPool.TAB + linePart);
          }
 else {
            _sourceFormatterHelper.printError(fileName,"line break: " + fileName + " "+ lineCount);
          }
        }
        sb.append(previousLine);
        sb.append("\n");
        previousLine=line;
      }
 else       if (line.endsWith(StringPool.OPEN_CURLY_BRACE) && !previousLine.contains(" class ")) {
        lineToSkipIfEmpty=lineCount + 1;
      }
    }
 else {
      if ((lineCount > 1) && (Validator.isNotNull(previousLine) || (lineToSkipIfEmpty != (lineCount - 1)))) {
        sb.append(previousLine);
        if (Validator.isNotNull(previousLine) && Validator.isNotNull(trimmedLine) && !previousLine.contains("/*")) {
          String trimmedPreviousLine=StringUtil.trimLeading(previousLine);
          if ((trimmedPreviousLine.startsWith("// ") && !trimmedLine.startsWith("// ")) || (!trimmedPreviousLine.startsWith("// ") && trimmedLine.startsWith("// "))) {
            sb.append("\n");
          }
 else           if (previousLine.endsWith(StringPool.TAB + StringPool.CLOSE_CURLY_BRACE) && !trimmedLine.startsWith(StringPool.CLOSE_CURLY_BRACE) && !trimmedLine.startsWith(StringPool.CLOSE_PARENTHESIS)&& !trimmedLine.startsWith(StringPool.DOUBLE_SLASH)&& !trimmedLine.startsWith("catch ")&& !trimmedLine.startsWith("else ")&& !trimmedLine.startsWith("finally ")&& !trimmedLine.startsWith("while ")) {
            sb.append("\n");
          }
        }
        sb.append("\n");
      }
      previousLine=line;
    }
  }
  sb.append(previousLine);
  unsyncBufferedReader.close();
  String newContent=sb.toString();
  if (newContent.endsWith("\n")) {
    newContent=newContent.substring(0,newContent.length() - 1);
  }
  return newContent;
}
