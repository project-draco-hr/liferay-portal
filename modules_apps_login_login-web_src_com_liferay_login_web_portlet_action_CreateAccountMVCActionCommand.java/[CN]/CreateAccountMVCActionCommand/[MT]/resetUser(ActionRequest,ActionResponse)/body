{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String emailAddress=ParamUtil.getString(actionRequest,"emailAddress");
  User anonymousUser=UserLocalServiceUtil.getUserByEmailAddress(themeDisplay.getCompanyId(),emailAddress);
  if (anonymousUser.getStatus() != WorkflowConstants.STATUS_INCOMPLETE) {
    throw new PrincipalException.MustBeAuthenticated(anonymousUser.getUuid());
  }
  UserLocalServiceUtil.deleteUser(anonymousUser.getUserId());
  addUser(actionRequest,actionResponse);
}
