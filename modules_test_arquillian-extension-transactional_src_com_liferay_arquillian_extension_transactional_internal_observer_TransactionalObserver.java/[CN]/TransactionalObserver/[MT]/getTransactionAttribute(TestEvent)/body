{
  Method method=testEvent.getTestMethod();
  Transactional transactional=method.getAnnotation(Transactional.class);
  if (transactional == null) {
    TestClass testClass=testEvent.getTestClass();
    transactional=testClass.getAnnotation(Transactional.class);
  }
  if (transactional == null) {
    return null;
  }
  TransactionAttribute.Builder builder=new TransactionAttribute.Builder();
  builder.setPropagation(transactional.propagation());
  builder.setRollbackForClasses(PortalException.class,SystemException.class);
  return builder.build();
}
