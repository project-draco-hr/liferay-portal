{
  portletDataContext.importPermissions("com.liferay.portlet.wiki",portletDataContext.getSourceGroupId(),portletDataContext.getScopeGroupId());
  if (Validator.isNull(data)) {
    return null;
  }
  Document document=SAXReaderUtil.read(data);
  Element rootElement=document.getRootElement();
  Element nodesElement=rootElement.element("nodes");
  for (  Element nodeElement : nodesElement.elements("node")) {
    String path=nodeElement.attributeValue("path");
    if (!portletDataContext.isPathNotProcessed(path)) {
      continue;
    }
    WikiNode node=(WikiNode)portletDataContext.getZipEntryAsObject(path);
    WikiPortletDataHandlerImpl.importNode(portletDataContext,node);
  }
  Element pagesElement=rootElement.element("pages");
  JournalPortletDataHandlerImpl.importReferencedData(portletDataContext,pagesElement);
  for (  Element pageElement : pagesElement.elements("page")) {
    String path=pageElement.attributeValue("path");
    if (!portletDataContext.isPathNotProcessed(path)) {
      continue;
    }
    WikiPage page=(WikiPage)portletDataContext.getZipEntryAsObject(path);
    WikiPortletDataHandlerImpl.importPage(portletDataContext,pageElement,page);
  }
  Map<Long,Long> nodeIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(WikiNode.class);
  for (  long nodeId : nodeIds.values()) {
    WikiCacheUtil.clearCache(nodeId);
  }
  long nodeId=GetterUtil.getLong(portletPreferences.getValue("nodeId",StringPool.BLANK));
  if (nodeId > 0) {
    nodeId=MapUtil.getLong(nodeIds,nodeId,nodeId);
    portletPreferences.setValue("nodeId",String.valueOf(nodeId));
  }
  return portletPreferences;
}
