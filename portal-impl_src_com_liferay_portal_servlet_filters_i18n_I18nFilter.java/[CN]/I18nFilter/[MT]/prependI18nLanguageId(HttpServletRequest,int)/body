{
  User user=(User)request.getAttribute(WebKeys.USER);
  String userLanguageId=null;
  if (user != null) {
    userLanguageId=user.getLanguageId();
  }
  String requestedLanguageId=getRequestedLanguageId(request,userLanguageId);
  String defaultLanguageId=getDefaultLanguageId(request);
  if (Validator.isNull(requestedLanguageId)) {
    requestedLanguageId=defaultLanguageId;
  }
  if (prependFriendlyUrlStyle == 1) {
    return prependIfRequestedLocaleDiffersFromDefaultLocale(defaultLanguageId,requestedLanguageId);
  }
 else   if (prependFriendlyUrlStyle == 2) {
    return requestedLanguageId;
  }
 else   if (prependFriendlyUrlStyle == 3) {
    if (user != null) {
      if (userLanguageId.equals(requestedLanguageId)) {
        return null;
      }
      return requestedLanguageId;
    }
 else {
      return prependIfRequestedLocaleDiffersFromDefaultLocale(defaultLanguageId,requestedLanguageId);
    }
  }
  return null;
}
