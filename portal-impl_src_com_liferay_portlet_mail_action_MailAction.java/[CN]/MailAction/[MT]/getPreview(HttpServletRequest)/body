{
  StopWatch stopWatch=null;
  if (_log.isInfoEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  JSONObject jsonObj=new JSONObject();
  String folderId=ParamUtil.getString(req,"folderId");
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  MailUtil.setFolder(req,folderId);
  Set envelopes=MailUtil.getEnvelopes(req,getComparator(req));
  JSONArray jsonEnvelopes=_convertEnvelopes(envelopes,themeDisplay);
  jsonObj.put("folderId",folderId);
  jsonObj.put("headers",jsonEnvelopes);
  if (_log.isInfoEnabled()) {
    _log.info("Total time to get preview " + stopWatch.getTime() + "ms");
  }
  return jsonObj.toString();
}
