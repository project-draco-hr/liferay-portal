{
  PrettyDateFormat dateFormat=new PrettyDateFormat(themeDisplay.getCompanyId(),themeDisplay.getLocale(),themeDisplay.getTimeZone());
  JSONArray jsonEnvelopes=new JSONArray();
  Iterator itr=envelopes.iterator();
  while (itr.hasNext()) {
    MailEnvelope mailEnvelope=(MailEnvelope)itr.next();
    JSONObject jsonEnvelope=new JSONObject();
    String recipient=GetterUtil.getString(mailEnvelope.getRecipient(),StringPool.NBSP);
    String subject=GetterUtil.getString(mailEnvelope.getSubject(),StringPool.NBSP);
    JSONUtil.put(jsonEnvelope,"id",mailEnvelope.getMessageId());
    JSONUtil.put(jsonEnvelope,"folderId",mailEnvelope.getFolderName());
    JSONUtil.put(jsonEnvelope,"email",recipient);
    JSONUtil.put(jsonEnvelope,"subject",subject);
    JSONUtil.put(jsonEnvelope,"date",dateFormat.format(mailEnvelope.getDate()));
    JSONUtil.put(jsonEnvelope,"size",TextFormatter.formatKB(mailEnvelope.getSize(),themeDisplay.getLocale()) + "k");
    JSONUtil.put(jsonEnvelope,"read",mailEnvelope.isRead());
    JSONUtil.put(jsonEnvelope,"replied",mailEnvelope.isAnswered());
    JSONUtil.put(jsonEnvelope,"flagged",mailEnvelope.isFlagged());
    jsonEnvelopes.put(jsonEnvelope);
  }
  return jsonEnvelopes;
}
