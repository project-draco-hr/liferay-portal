{
  PrettyDateFormat dateFormat=new PrettyDateFormat(themeDisplay.getCompanyId(),themeDisplay.getLocale(),themeDisplay.getTimeZone());
  JSONArray jsonEnvelopes=new JSONArray();
  Iterator itr=envelopes.iterator();
  while (itr.hasNext()) {
    MailEnvelope mailEnvelope=(MailEnvelope)itr.next();
    JSONObject jsonEnvelope=new JSONObject();
    String recipient=GetterUtil.getString(mailEnvelope.getRecipient(),StringPool.NBSP);
    String subject=GetterUtil.getString(mailEnvelope.getSubject(),StringPool.NBSP);
    jsonEnvelope.put("id",mailEnvelope.getMessageId());
    jsonEnvelope.put("folderId",mailEnvelope.getFolderName());
    jsonEnvelope.put("email",recipient);
    jsonEnvelope.put("subject",subject);
    jsonEnvelope.put("date",dateFormat.format(mailEnvelope.getDate()));
    jsonEnvelope.put("size",TextFormatter.formatKB(mailEnvelope.getSize(),themeDisplay.getLocale()) + "k");
    jsonEnvelope.put("read",mailEnvelope.isRead());
    jsonEnvelope.put("replied",mailEnvelope.isAnswered());
    jsonEnvelope.put("flagged",mailEnvelope.isFlagged());
    jsonEnvelopes.put(jsonEnvelope);
  }
  return jsonEnvelopes;
}
