{
  JSONObject jsonObj=new JSONObject();
  HttpSession ses=req.getSession();
  MailDisplayTerms displayTerms=new MailDisplayTerms(req);
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  Set envelopes=MailUtil.search(req,displayTerms,getComparator(req));
  ses.setAttribute(WebKeys.MAIL_SEARCH_RESULTS,envelopes);
  JSONArray jsonEnvelopes=_convertEnvelopes(envelopes,themeDisplay);
  jsonObj.put("headers",jsonEnvelopes);
  return jsonObj.toString();
}
