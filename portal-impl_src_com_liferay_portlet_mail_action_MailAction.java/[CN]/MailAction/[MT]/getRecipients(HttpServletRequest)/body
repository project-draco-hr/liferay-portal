{
  long userId=PortalUtil.getUserId(req);
  String data=ParamUtil.getString(req,"data");
  PortletPreferences prefs=PortalUtil.getPreferences(req);
  List finders=RecipientFinderLocator.getInstances();
  SortedSet recipients=new TreeSet();
  for (int i=0; i < finders.size(); i++) {
    RecipientFinder finder=(RecipientFinder)finders.get(i);
    boolean enabled=GetterUtil.getBoolean(prefs.getValue(finder.getClass().getName(),StringPool.BLANK),true);
    if (enabled) {
      recipients.addAll(finder.getRecipients(userId,data,new HashMap()));
    }
  }
  String[] recipientsArray=(String[])ListUtil.fromCollection(recipients).toArray(new String[0]);
  JSONArray jsonArray=Autocomplete.arrayToJson(recipientsArray,50);
  return jsonArray.toString();
}
