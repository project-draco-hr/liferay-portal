{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  int start=(startPage * itemsPerPage) - itemsPerPage;
  int end=startPage * itemsPerPage;
  List<User> results=UserLocalServiceUtil.search(themeDisplay.getCompanyId(),keywords,Boolean.TRUE,null,start,end,new ContactLastNameComparator(true));
  int total=UserLocalServiceUtil.searchCount(themeDisplay.getCompanyId(),keywords,Boolean.TRUE,null);
  Object[] values=addSearchResults(keywords,startPage,itemsPerPage,total,start,"Liferay Directory Search: " + keywords,SEARCH_PATH,themeDisplay);
  Document doc=(Document)values[0];
  Element root=(Element)values[1];
  for (  User user : results) {
    String portletId=PortletKeys.DIRECTORY;
    PortletURL portletURL=getPortletURL(request,portletId);
    String title=user.getFullName();
    String url=portletURL.toString();
    Date modifedDate=user.getModifiedDate();
    String content=user.getFullName() + " &lt;" + user.getEmailAddress()+ "&gt;";
    double score=1.0;
    addSearchResult(root,title,url,modifedDate,content,score);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Return\n" + doc.asXML());
  }
  return doc.asXML();
}
