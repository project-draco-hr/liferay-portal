{
  logHasUserPermission(groupId,name,primKey,actionId,stopWatch,1);
  if (ResourceBlockLocalServiceUtil.isSupported(name)) {
    ResourceBlockIdsBag resourceBlockIdsBag=getResourceBlockIdsBag(companyId,groupId,name,roleIds);
    boolean value=ResourceBlockLocalServiceUtil.hasPermission(name,GetterUtil.getLong(primKey),actionId,resourceBlockIdsBag);
    logHasUserPermission(groupId,name,primKey,actionId,stopWatch,2);
    return value;
  }
  List<Resource> resources=getResources(companyId,groupId,name,primKey,actionId);
  resources=fixMissingResources(companyId,groupId,name,primKey,actionId,resources);
  logHasUserPermission(groupId,name,primKey,actionId,stopWatch,3);
  boolean value=ResourceLocalServiceUtil.hasUserPermissions(user.getUserId(),groupId,resources,actionId,roleIds);
  logHasUserPermission(groupId,name,primKey,actionId,stopWatch,4);
  return value;
}
