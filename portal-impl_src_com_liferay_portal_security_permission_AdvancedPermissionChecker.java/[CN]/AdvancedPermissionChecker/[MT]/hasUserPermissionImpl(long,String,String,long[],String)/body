{
  StopWatch stopWatch=new StopWatch();
  stopWatch.start();
  long companyId=user.getCompanyId();
  if (groupId > 0) {
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    companyId=group.getCompanyId();
  }
  primKey=fixLegacyPrimaryKey(companyId,name,primKey);
  try {
    boolean hasPermission=doCheckPermission(companyId,groupId,name,primKey,roleIds,actionId,stopWatch);
    if (hasPermission) {
      return true;
    }
  }
 catch (  NoSuchResourcePermissionException nsrpe) {
    throw new IllegalArgumentException("Someone may be trying to circumvent the permission checker: " + nsrpe.getMessage(),nsrpe);
  }
  if (isOmniadmin()) {
    return true;
  }
  if (name.equals(Organization.class.getName())) {
    if (isOrganizationAdminImpl(GetterUtil.getLong(primKey))) {
      return true;
    }
  }
  if (isCompanyAdminImpl(companyId)) {
    return true;
  }
  if (isGroupAdminImpl(groupId)) {
    boolean hasLayoutManagerPermission=true;
    if (Validator.isNotNull(name) && Validator.isNotNull(primKey) && primKey.contains(PortletConstants.LAYOUT_SEPARATOR)) {
      hasLayoutManagerPermission=PortletPermissionUtil.hasLayoutManagerPermission(name,actionId);
    }
    if (hasLayoutManagerPermission) {
      return true;
    }
  }
  return false;
}
