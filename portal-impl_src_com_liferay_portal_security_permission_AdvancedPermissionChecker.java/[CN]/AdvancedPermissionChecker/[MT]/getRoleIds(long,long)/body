{
  PermissionCheckerBag bag=null;
  try {
    bag=getUserBag(userId,groupId);
  }
 catch (  Exception e) {
  }
  if (bag != null) {
    if (checkGuest) {
      Set<Long> roleIds=SetUtil.fromArray(bag.getRoleIds());
      try {
        PermissionCheckerBag guestBag=getGuestUserBag();
        if (guestBag != null) {
          roleIds.addAll(SetUtil.fromArray(guestBag.getRoleIds()));
        }
      }
 catch (      Exception e) {
      }
      return ArrayUtil.toArray(roleIds.toArray(new Long[roleIds.size()]));
    }
 else {
      return bag.getRoleIds();
    }
  }
  return PermissionChecker.DEFAULT_ROLE_IDS;
}
