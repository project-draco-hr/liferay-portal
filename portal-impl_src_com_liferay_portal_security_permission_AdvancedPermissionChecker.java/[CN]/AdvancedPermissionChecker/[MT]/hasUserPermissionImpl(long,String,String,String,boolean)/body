{
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  long companyId=user.getCompanyId();
  if (groupId > 0) {
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    companyId=group.getCompanyId();
  }
  boolean hasLayoutManagerPermission=true;
  if (Validator.isNotNull(name) && Validator.isNotNull(primKey) && primKey.contains(PortletConstants.LAYOUT_SEPARATOR)) {
    hasLayoutManagerPermission=PortletPermissionUtil.hasLayoutManagerPermission(name,actionId);
  }
  if (checkAdmin) {
    if (isCompanyAdminImpl(companyId)) {
      return true;
    }
    if (name.equals(Organization.class.getName())) {
      long organizationId=GetterUtil.getInteger(primKey);
      if (isOrganizationAdminImpl(organizationId)) {
        return true;
      }
    }
 else     if (isGroupAdminImpl(groupId) && hasLayoutManagerPermission) {
      return true;
    }
  }
  return doCheckPermission(companyId,groupId,name,primKey,actionId,stopWatch);
}
