{
  Group guestGroup=GroupLocalServiceUtil.getGroup(getCompanyId(),GroupConstants.GUEST);
  long[] roleIds=PermissionCacheUtil.getUserGroupRoleIds(defaultUserId,guestGroup.getGroupId());
  if (roleIds != null) {
    return roleIds;
  }
  try {
    List<Role> roles=RoleLocalServiceUtil.getUserRelatedRoles(defaultUserId,Collections.singletonList(guestGroup));
    roleIds=ListUtil.toLongArray(roles,Role.ROLE_ID_ACCESSOR);
    Arrays.sort(roleIds);
    PermissionCacheUtil.putUserGroupRoleIds(defaultUserId,guestGroup.getGroupId(),roleIds);
  }
 catch (  Exception e) {
    PermissionCacheUtil.removeUserGroupRoleIds(defaultUserId,guestGroup.getGroupId());
    throw e;
  }
  return roleIds;
}
