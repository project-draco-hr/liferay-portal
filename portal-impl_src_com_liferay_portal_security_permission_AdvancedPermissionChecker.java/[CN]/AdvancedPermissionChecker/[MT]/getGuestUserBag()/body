{
  Group guestGroup=GroupLocalServiceUtil.getGroup(getCompanyId(),GroupConstants.GUEST);
  PermissionCheckerBag bag=PermissionCacheUtil.getBag(defaultUserId,guestGroup.getGroupId());
  if (bag == null) {
    try {
      List<Group> groups=new ArrayList<Group>();
      groups.add(guestGroup);
      List<Role> roles=RoleLocalServiceUtil.getUserRelatedRoles(defaultUserId,groups);
      bag=new PermissionCheckerBagImpl(defaultUserId,Collections.<Group>emptyList(),Collections.<Organization>emptyList(),Collections.<Group>emptyList(),Collections.<Group>emptyList(),Collections.<Group>emptyList(),roles);
    }
  finally {
      if (bag == null) {
        bag=new PermissionCheckerBagImpl(defaultUserId,Collections.<Group>emptyList(),Collections.<Organization>emptyList(),Collections.<Group>emptyList(),Collections.<Group>emptyList(),Collections.<Group>emptyList(),Collections.<Role>emptyList());
      }
      PermissionCacheUtil.putBag(defaultUserId,guestGroup.getGroupId(),bag);
    }
  }
  return bag;
}
