{
  Group guestGroup=GroupLocalServiceUtil.getGroup(getCompanyId(),GroupConstants.GUEST);
  PermissionCheckerBag bag=PermissionCacheUtil.getBag(defaultUserId,guestGroup.getGroupId());
  if (bag != null) {
    return bag;
  }
  try {
    List<Group> groups=new ArrayList<>();
    groups.add(guestGroup);
    List<Role> roles=RoleLocalServiceUtil.getUserRelatedRoles(defaultUserId,groups);
    bag=new PermissionCheckerBagImpl(defaultUserId,SetUtil.fromList(roles));
    PermissionCacheUtil.putBag(defaultUserId,guestGroup.getGroupId(),bag);
  }
 catch (  Exception e) {
    PermissionCacheUtil.removeBag(defaultUserId,guestGroup.getGroupId());
    throw e;
  }
  return bag;
}
