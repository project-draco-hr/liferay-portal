{
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  Group group=null;
  try {
    if (groupId > 0) {
      group=GroupLocalServiceUtil.getGroup(groupId);
      if (group.isStagingGroup()) {
        if (primKey.equals(String.valueOf(groupId))) {
          primKey=String.valueOf(group.getLiveGroupId());
        }
        groupId=group.getLiveGroupId();
        group=group.getLiveGroup();
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  Boolean value=PermissionCacheUtil.getPermission(user.getUserId(),groupId,name,primKey,actionId);
  if (value == null) {
    value=Boolean.valueOf(hasPermissionImpl(groupId,name,primKey,actionId));
    PermissionCacheUtil.putPermission(user.getUserId(),groupId,name,primKey,actionId,value);
    if (_log.isDebugEnabled()) {
      _log.debug("Checking permission for " + groupId + " "+ name+ " "+ primKey+ " "+ actionId+ " takes "+ stopWatch.getTime()+ " ms");
    }
  }
  return value.booleanValue();
}
