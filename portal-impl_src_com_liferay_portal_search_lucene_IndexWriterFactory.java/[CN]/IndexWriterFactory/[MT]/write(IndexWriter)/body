{
  if (SearchEngineUtil.isIndexReadOnly()) {
    return;
  }
  boolean writerFound=false;
synchronized (this) {
    if (!_writerLookup.isEmpty()) {
      for (      IndexWriterData writerData : _writerLookup.values()) {
        if (writerData.getWriter() == writer) {
          writerFound=true;
          decrement(writerData);
          break;
        }
      }
    }
  }
  if (!writerFound) {
    try {
      _optimizeCount++;
      if ((_OPTIMIZE_INTERVAL == 0) || (_optimizeCount >= _OPTIMIZE_INTERVAL)) {
        writer.optimize();
        _optimizeCount=0;
      }
    }
  finally {
      writer.close();
    }
  }
}
