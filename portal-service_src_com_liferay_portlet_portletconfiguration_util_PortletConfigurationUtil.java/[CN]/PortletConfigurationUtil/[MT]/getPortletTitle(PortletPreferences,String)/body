{
  String useCustomTitle=GetterUtil.getString(portletSetup.getValue("portletSetupUseCustomTitle",StringPool.BLANK));
  if (!useCustomTitle.equals("true")) {
    return null;
  }
  String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getDefault());
  String defaultPortletTitle=portletSetup.getValue("portletSetupTitle" + defaultLanguageId,StringPool.BLANK);
  String portletTitle=portletSetup.getValue("portletSetupTitle" + languageId,defaultPortletTitle);
  if (Validator.isNull(portletTitle)) {
    String oldPortletTitle=portletSetup.getValue("portletSetupTitle",null);
    if (Validator.isNull(useCustomTitle) && Validator.isNotNull(oldPortletTitle)) {
      portletTitle=oldPortletTitle;
      try {
        portletSetup.setValue("portletSetupTitle" + defaultLanguageId,portletTitle);
        portletSetup.setValue("portletSetupUseCustomTitle","true");
        portletSetup.store();
      }
 catch (      Exception e) {
        _log.error(e);
      }
    }
  }
  return portletTitle;
}
