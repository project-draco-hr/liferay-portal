{
  String useCustomTitle=GetterUtil.getString(portletSetup.getValue("portlet-setup-use-custom-title",StringPool.BLANK));
  if (useCustomTitle.equals("false")) {
    return StringPool.BLANK;
  }
  String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getDefault());
  String defaultPortletTitle=portletSetup.getValue("portlet-setup-title-" + defaultLanguageId,StringPool.BLANK);
  String portletTitle=portletSetup.getValue("portlet-setup-title-" + languageId,defaultPortletTitle);
  if (Validator.isNull(portletTitle)) {
    String oldPortletTitle=portletSetup.getValue("portlet-setup-title",null);
    if (Validator.isNull(useCustomTitle) && Validator.isNotNull(oldPortletTitle)) {
      portletTitle=oldPortletTitle;
      try {
        portletSetup.setValue("portlet-setup-title-" + defaultLanguageId,portletTitle);
        portletSetup.setValue("portlet-setup-use-custom-title","true");
        portletSetup.store();
      }
 catch (      Exception e) {
        _log.error(e);
      }
    }
  }
  return portletTitle;
}
