{
  String useCustomTitle=GetterUtil.getString(portletSetup.getValue("portletSetupUseCustomTitle",StringPool.BLANK));
  if (!useCustomTitle.equals("true")) {
    return null;
  }
  String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getDefault());
  String defaultPortletTitle=portletSetup.getValue("portletSetupTitle_" + defaultLanguageId,StringPool.BLANK);
  String portletTitle=portletSetup.getValue("portletSetupTitle_" + languageId,defaultPortletTitle);
  if (Validator.isNotNull(portletTitle)) {
    return portletTitle;
  }
  String oldPortletTitle=portletSetup.getValue("portletSetupTitle",null);
  if (Validator.isNull(useCustomTitle) && Validator.isNotNull(oldPortletTitle)) {
    portletTitle=oldPortletTitle;
    try {
      portletSetup.setValue("portletSetupTitle_" + defaultLanguageId,portletTitle);
      portletSetup.setValue("portletSetupUseCustomTitle",Boolean.TRUE.toString());
      portletSetup.store();
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
  return portletTitle;
}
