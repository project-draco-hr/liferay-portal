{
  if (!isUseCustomTitle(portletSetup)) {
    return null;
  }
  String portletTitle=portletSetup.getValue("portletSetupTitle_" + languageId,null);
  if (Validator.isNotNull(portletTitle)) {
    return portletTitle;
  }
  String oldPortletTitle=portletSetup.getValue("portletSetupTitle",null);
  if (!isUseCustomTitle(portletSetup) && Validator.isNotNull(oldPortletTitle)) {
    portletTitle=oldPortletTitle;
    try {
      String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getSiteDefault());
      portletSetup.setValue("portletSetupTitle_" + defaultLanguageId,portletTitle);
      portletSetup.setValue("portletSetupUseCustomTitle",Boolean.TRUE.toString());
      portletSetup.store();
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
  return portletTitle;
}
