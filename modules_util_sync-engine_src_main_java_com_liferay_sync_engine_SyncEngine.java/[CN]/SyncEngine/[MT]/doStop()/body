{
  SyncEngineUtil.fireSyncEngineStateChanged(SyncEngineUtil.SYNC_ENGINE_STATE_STOPPING);
  _logger.info("Stopping Sync engine");
  for (  long syncAccountId : _syncAccountTasks.keySet()) {
    cancelSyncAccountTasks(syncAccountId);
  }
  if (_threadPoolExecutor != null) {
    _threadPoolExecutor.shutdownNow();
  }
  _localEventsScheduledExecutorService.shutdownNow();
  _remoteEventsScheduledExecutorService.shutdownNow();
  FileLockRetryUtil.shutdown();
  LoggerUtil.shutdown();
  SyncAccountPersistence syncAccountPersistence=SyncAccountService.getSyncAccountPersistence();
  ConnectionSource connectionSource=syncAccountPersistence.getConnectionSource();
  connectionSource.closeQuietly();
  SyncEngineUtil.fireSyncEngineStateChanged(SyncEngineUtil.SYNC_ENGINE_STATE_STOPPED);
  _running=false;
}
