{
  try (LoggingTimer loggingTimer=new LoggingTimer();PreparedStatement ps=connection.prepareStatement("select * from DLFileEntry");ResultSet rs=ps.executeQuery()){
    while (rs.next()) {
      long companyId=rs.getLong("companyId");
      long groupId=rs.getLong("groupId");
      long folderId=rs.getLong("folderId");
      String name=rs.getString("name");
      long repositoryId=folderId;
      if (repositoryId == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
        repositoryId=groupId;
      }
      String newName=DLFileEntryNameUpgradeColumnImpl.getNewName(name);
      if (!newName.equals(name)) {
        try {
          DLStoreUtil.updateFile(companyId,repositoryId,name,newName);
        }
 catch (        Exception e) {
          if (_log.isWarnEnabled()) {
            _log.warn("Unable to update file for " + name,e);
          }
        }
      }
    }
  }
 }
