{
  try {
    long companyId=0;
    long groupId=0;
    boolean privateLayout=false;
    Layout layout=LayoutUtil.fetchByPrimaryKey(portletPreferences.getPlid());
    if (layout != null) {
      companyId=layout.getCompanyId();
      groupId=layout.getGroupId();
      privateLayout=layout.isPrivateLayout();
    }
 else {
      LayoutRevision layoutRevision=LayoutRevisionUtil.fetchByPrimaryKey(portletPreferences.getPlid());
      if (layoutRevision != null) {
        companyId=layoutRevision.getCompanyId();
        groupId=layoutRevision.getGroupId();
        privateLayout=layoutRevision.isPrivateLayout();
      }
    }
    if (!privateLayout) {
      CacheUtil.clearCache();
    }
    if ((companyId > 0) && (groupId > 0)) {
      Object[] finderArgs=new Object[]{companyId,groupId,portletPreferences.getOwnerId(),portletPreferences.getOwnerType(),portletPreferences.getPortletId(),privateLayout};
      FinderCacheUtil.removeResult(PortletPreferencesFinderImpl.FINDER_PATH_FIND_PLIDS_BY_C_G_O_O_P_P,finderArgs);
      FinderCacheUtil.removeResult(PortletPreferencesFinderImpl.FINDER_PATH_FIND_PORTLET_PREFERENCES_BY_C_G_O_O_P_P,finderArgs);
    }
  }
 catch (  Exception e) {
    _log.error("Clearing cache for " + portletPreferences + " has failed.",e);
  }
}
