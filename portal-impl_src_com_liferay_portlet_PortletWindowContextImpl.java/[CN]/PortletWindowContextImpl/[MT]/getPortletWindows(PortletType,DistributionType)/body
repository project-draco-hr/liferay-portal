{
  List<EntityID> portletList=new ArrayList();
  try {
    List<Portlet> portlets=null;
    if (DistributionType.ALL_PORTLETS.equals(distributionType)) {
      portlets=getAllPortletWindows(portletType);
    }
 else     if (DistributionType.ALL_PORTLETS_ON_PAGE.equals(distributionType)) {
      portlets=getAvailablePortletWindows(portletType);
    }
 else     if (DistributionType.VISIBLE_PORTLETS_ON_PAGE.equals(distributionType)) {
      portlets=getVisiblePortletWindows(portletType);
    }
    if (portlets != null) {
      for (      Portlet portletModel : portlets) {
        EntityID entityID=WindowInvokerUtil.getEntityID(portletModel,portletModel.getPortletId());
        if (entityID != null)         portletList.add(entityID);
      }
    }
  }
 catch (  PortletWindowContextException pre) {
    _log.error(pre);
  }
  return portletList;
}
