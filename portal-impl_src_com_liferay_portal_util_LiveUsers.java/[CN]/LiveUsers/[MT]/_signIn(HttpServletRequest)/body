{
  HttpSession session=request.getSession();
  long companyId=CompanyThreadLocal.getCompanyId();
  long userId=GetterUtil.getLong(request.getRemoteUser());
  _updateGroupStatus(userId,true);
  Map<String,UserTracker> sessionUsers=_getSessionUsers();
  List<UserTracker> userTrackers=_getUserTrackers(userId);
  if (!PropsValues.AUTH_SIMULTANEOUS_LOGINS) {
    if (userTrackers != null) {
      for (      UserTracker userTracker : userTrackers) {
        userTracker.getHttpSession().setAttribute(WebKeys.STALE_SESSION,Boolean.TRUE);
      }
    }
  }
  UserTracker userTracker=sessionUsers.get(session.getId());
  if ((userTracker == null) && (PropsValues.SESSION_TRACKER_MEMORY_ENABLED)) {
    userTracker=UserTrackerUtil.create(0);
    userTracker.setCompanyId(companyId);
    userTracker.setUserId(userId);
    userTracker.setModifiedDate(new Date());
    userTracker.setHttpSession(session);
    userTracker.setRemoteAddr(request.getRemoteAddr());
    userTracker.setRemoteHost(request.getRemoteHost());
    userTracker.setUserAgent(request.getHeader(HttpHeaders.USER_AGENT));
    sessionUsers.put(session.getId(),userTracker);
    _addUserTracker(userId,userTracker);
  }
}
