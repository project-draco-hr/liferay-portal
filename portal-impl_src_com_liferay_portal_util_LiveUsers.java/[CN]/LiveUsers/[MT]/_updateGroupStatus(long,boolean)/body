{
  long companyId=CompanyThreadLocal.getCompanyId();
  Map<Long,Set<Long>> liveUsers=_getLiveUsers();
  LinkedHashMap<String,Object> groupParams=new LinkedHashMap<String,Object>();
  groupParams.put("usersGroups",userId);
  List<Group> communities=GroupLocalServiceUtil.search(companyId,null,null,groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  for (  Group community : communities) {
    Set<Long> groupUsers=_getGroupUsers(liveUsers,community.getGroupId());
    if (signedIn) {
      groupUsers.add(userId);
    }
 else {
      groupUsers.remove(userId);
    }
  }
  return liveUsers;
}
