{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long ldapServerId=ParamUtil.getLong(actionRequest,"ldapServerId");
  UnicodeProperties properties=PropertiesParamUtil.getProperties(actionRequest,"settings--");
  validateLDAPServerName(themeDisplay.getCompanyId(),ldapServerId,properties);
  String filter=ParamUtil.getString(actionRequest,"importUserSearchFilter");
  if (!LDAPUtil.validateFilter(filter)) {
    throw new LDAPFilterValidationException("Invalid filter syntax");
  }
  if (ldapServerId <= 0) {
    properties=addLDAPServer(themeDisplay.getCompanyId(),properties);
  }
  CompanyServiceUtil.updatePreferences(themeDisplay.getCompanyId(),properties);
}
