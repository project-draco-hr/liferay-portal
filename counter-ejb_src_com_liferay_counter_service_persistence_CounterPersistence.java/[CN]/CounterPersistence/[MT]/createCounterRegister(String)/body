{
  long rangeMin=0;
  long rangeMax=0;
  Session session=null;
  try {
    session=openSession();
    Counter counter=(Counter)session.get(Counter.class,name,LockMode.UPGRADE);
    if (counter == null) {
      rangeMin=_DEFAULT_CURRENT_ID;
      rangeMax=rangeMin + _COUNTER_INCREMENT;
      counter=new Counter();
      counter.setName(name);
    }
 else {
      rangeMin=counter.getCurrentId();
      rangeMax=rangeMin + _COUNTER_INCREMENT;
    }
    counter.setCurrentId(rangeMax);
    session.save(counter);
    session.flush();
  }
  finally {
    closeSession(session);
  }
  CounterRegister register=new CounterRegister(name,rangeMin,rangeMax,_COUNTER_INCREMENT);
  return register;
}
