{
  Counter counter=null;
  Session session=null;
  try {
    session=openSession();
    counter=(Counter)session.get(Counter.class,name);
    if (counter == null) {
      counter=new Counter();
      counter.setName(name);
      counter.setCurrentId(_DEFAULT_CURRENT_ID);
      session=openSession();
      session.save(counter);
      session.flush();
    }
  }
  finally {
    closeSession(session);
  }
  CounterRegister register=new CounterRegister(name,counter.getCurrentId(),_COUNTER_INCREMENT);
  return register;
}
