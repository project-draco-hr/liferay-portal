{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  JSONObject jo=new JSONObject();
  if ("getChats".equals(cmd)) {
    jo=getUpdates(req);
  }
 else   if ("getRosterChats".equals(cmd)) {
    jo=getChatMessages(req);
    JSONArray jRoster=getRosterEntries(req).getJSONArray("roster");
    jo.put("roster",jRoster);
    jo.put("status","success");
  }
 else   if ("sendChat".equals(cmd)) {
    jo=sendMessage(req);
  }
 else   if ("unload".equals(cmd)) {
    release(req);
  }
  return jo.toString();
}
