{
  JSONObject jo=new JSONObject();
  JSONArray ja=new JSONArray();
  PacketCollector collector=MessagingUtil.getCollector(req.getSession());
  Message message=MessagingUtil.getNextMessage(collector);
  while (message != null) {
    JSONObject jMsg=new JSONObject();
    jMsg.put("body",message.getBody());
    jMsg.put("category",message.getProperty("category"));
    jMsg.put("toId",message.getProperty("toId"));
    jMsg.put("toName",message.getProperty("toName"));
    jMsg.put("fromId",message.getProperty("fromId"));
    jMsg.put("fromName",message.getProperty("fromName"));
    ja.put(jMsg);
    message=MessagingUtil.getNextMessage(collector);
  }
  jo.put("chat",ja);
  return jo;
}
