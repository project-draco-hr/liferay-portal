{
  if (parentCategoryId.equals(ShoppingCategory.DEFAULT_PARENT_CATEGORY_ID)) {
    return parentCategoryId;
  }
  if (category.getCategoryId().equals(parentCategoryId)) {
    return category.getParentCategoryId();
  }
 else {
    ShoppingCategory parentCategory=ShoppingCategoryUtil.fetchByPrimaryKey(parentCategoryId);
    if ((parentCategory == null) || (!category.getGroupId().equals(parentCategory.getGroupId()))) {
      return category.getParentCategoryId();
    }
    List subcategoryIds=new ArrayList();
    getSubcategoryIds(subcategoryIds,category.getGroupId(),category.getCategoryId());
    if (subcategoryIds.contains(parentCategoryId)) {
      return category.getParentCategoryId();
    }
    return parentCategoryId;
  }
}
