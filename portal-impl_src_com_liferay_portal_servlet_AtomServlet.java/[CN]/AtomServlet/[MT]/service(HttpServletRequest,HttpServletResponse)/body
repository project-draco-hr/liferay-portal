{
  boolean remoteAccess=AccessControlThreadLocal.isRemoteAccess();
  try {
    AccessControlContext accessControlContext=AccessControlUtil.getAccessControlContext();
    AuthVerifierResult verificationResult=accessControlContext.getVerificationResult();
    long userId=verificationResult.getUserId();
    User user=UserLocalServiceUtil.getUser(userId);
    AtomUtil.saveUserInRequest(request,user);
    AccessControlThreadLocal.setRemoteAccess(true);
    super.service(request,response);
  }
 catch (  Exception e) {
    throw new ServletException(e);
  }
 finally {
    AccessControlThreadLocal.setRemoteAccess(remoteAccess);
  }
}
