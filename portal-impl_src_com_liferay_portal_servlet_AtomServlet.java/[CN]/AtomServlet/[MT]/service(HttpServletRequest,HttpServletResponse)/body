{
  boolean remoteAccess=AccessControlThreadLocal.isRemoteAccess();
  try {
    AccessControlContext accessControlContext=AccessControlUtil.getAccessControlContext();
    AuthVerifierResult authVerifierResult=accessControlContext.getAuthVerifierResult();
    User user=UserLocalServiceUtil.getUser(authVerifierResult.getUserId());
    AtomUtil.saveUserInRequest(request,user);
    AccessControlThreadLocal.setRemoteAccess(true);
    super.service(request,response);
  }
 catch (  Exception e) {
    throw new ServletException(e);
  }
 finally {
    AccessControlThreadLocal.setRemoteAccess(remoteAccess);
  }
}
