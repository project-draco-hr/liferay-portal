{
  String resourcePath=name.replace('.','/') + ".class";
  InputStream inputStream=getResourceAsStream(resourcePath);
  byte[] data=null;
  try {
    if (inputStream == null) {
      data=_urlWeavingAdaptor.removeGeneratedClassDate(name);
    }
 else {
      UnsyncByteArrayOutputStream unsyncByteArrayOutputStream=new UnsyncByteArrayOutputStream();
      StreamUtil.transfer(inputStream,unsyncByteArrayOutputStream,true);
      data=unsyncByteArrayOutputStream.toByteArray();
    }
    if (data == null) {
      throw new ClassNotFoundException(name);
    }
    byte[] oldData=data;
    data=_urlWeavingAdaptor.weaveClass(name,data,false);
    if (Arrays.equals(oldData,data)) {
      return _generateClass(name,data);
    }
    if (_dumpDir != null) {
      File dumpFile=new File(_dumpDir,resourcePath);
      File dumpDir=dumpFile.getParentFile();
      dumpDir.mkdirs();
      FileOutputStream fileOutputStream=new FileOutputStream(dumpFile);
      fileOutputStream.write(data);
      fileOutputStream.close();
      if (_log.isInfoEnabled()) {
        _log.info("Woven class " + name + " result in "+ dumpFile.getCanonicalPath());
      }
    }
 else {
      if (_log.isInfoEnabled()) {
        _log.info("Woven class " + name);
      }
    }
    return _generateClass(name,data);
  }
 catch (  IOException ioe) {
    throw new ClassNotFoundException(name,ioe);
  }
}
