{
  JSONObject computerJSONObject=null;
  JSONObject queueJSONObject=null;
  try {
    computerJSONObject=JenkinsResultsParserUtil.toJSONObject(JenkinsResultsParserUtil.getLocalURL(url + "/computer/api/json?pretty&tree=computer" + "[displayName,idle,offline]"),false,5000);
    queueJSONObject=JenkinsResultsParserUtil.toJSONObject(JenkinsResultsParserUtil.getLocalURL(url + "/queue/api/json"),false,5000);
  }
 catch (  Exception e) {
    System.out.println("Unable to read " + url);
    return null;
  }
  int idleCount=0;
  JSONArray computersJSONArray=computerJSONObject.getJSONArray("computer");
  for (int i=0; i < computersJSONArray.length(); i++) {
    JSONObject computer=computersJSONArray.getJSONObject(i);
    if (computer.getBoolean("idle") && !computer.getBoolean("offline")) {
      String displayName=computer.getString("displayName");
      if (!displayName.equals("master")) {
        idleCount++;
      }
    }
  }
  int queueCount=0;
  if (queueJSONObject.has("items")) {
    JSONArray itemsJSONArray=queueJSONObject.getJSONArray("items");
    for (int i=0; i < itemsJSONArray.length(); i++) {
      JSONObject item=itemsJSONArray.getJSONObject(i);
      if (item.has("why")) {
        String why=item.getString("why");
        if (why.endsWith("is offline")) {
          continue;
        }
        queueCount++;
      }
    }
  }
  int availableSlaveCount=idleCount - queueCount;
  if (recentJobCount != null) {
    availableSlaveCount-=recentJobCount;
  }
  StringBuilder sb=new StringBuilder();
  sb.append("{available=");
  sb.append(availableSlaveCount);
  sb.append(", idle=");
  sb.append(idleCount);
  sb.append(", queue=");
  sb.append(queueCount);
  sb.append(", recentJobs=");
  sb.append(recentJobCount);
  sb.append(", url=");
  sb.append(url);
  sb.append("}");
  System.out.println(sb.toString());
  return availableSlaveCount;
}
