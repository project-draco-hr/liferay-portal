{
  String companyId=PortalUtil.getCompanyId(req);
  if (!RoleLocalServiceUtil.hasUserRole(req.getRemoteUser(),companyId,RoleImpl.ADMINISTRATOR)) {
    SessionErrors.add(req,PrincipalException.class.getName());
    setForward(req,"portlet.admin.error");
    return;
  }
  PortletPreferences prefs=PrefsPropsUtil.getPreferences(companyId);
  String cmd=ParamUtil.getString(req,Constants.CMD);
  if (cmd.equals("updateDefaultGroupsAndRoles")) {
    updateDefaultGroupsAndRoles(req,prefs);
  }
 else   if (cmd.equals("updateEmails")) {
    updateEmails(req,prefs);
  }
 else   if (cmd.equals("updateLdap")) {
    updateLdap(req,prefs);
  }
 else   if (cmd.equals("updateMailHostNames")) {
    updateMailHostNames(req,prefs);
  }
 else   if (cmd.equals("updateReservedUsers")) {
    updateReservedUsers(req,prefs);
  }
 else   if (cmd.equals("updateSecurity")) {
    updateSecurity(req);
  }
  if (SessionErrors.isEmpty(req)) {
    if (!cmd.equals("updateLdap") && !cmd.equals("updateSecurity")) {
      prefs.store();
    }
    sendRedirect(req,res);
  }
 else {
    setForward(req,"portlet.admin.view");
  }
}
