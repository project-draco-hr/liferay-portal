{
  BundlePortletApp bundlePortletApp=serviceRegistrations.getBundlePortletApp();
  if (bundlePortletApp != null) {
    return bundlePortletApp;
  }
  com.liferay.portal.kernel.model.Portlet portalPortletModel=_portletLocalService.getPortletById(CompanyConstants.SYSTEM,PortletKeys.PORTAL);
  ServletContextHelperRegistration servletContextHelperRegistration=getServletContextHelperRegistration(bundle,serviceRegistrations);
  ServletContext servletContext=servletContextHelperRegistration.getServletContext();
  bundlePortletApp=new BundlePortletApp(bundle,portalPortletModel,servletContext.getServletContextName(),servletContext.getContextPath());
  bundlePortletApp.setServletContext(servletContext);
  serviceRegistrations.setBundlePortletApp(bundlePortletApp);
  serviceRegistrations.doConfiguration(classLoader);
  return bundlePortletApp;
}
