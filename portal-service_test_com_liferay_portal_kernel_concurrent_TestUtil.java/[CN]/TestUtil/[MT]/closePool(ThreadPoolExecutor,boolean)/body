{
  try {
    if (forciblely) {
      threadPoolExecutor.shutdownNow();
    }
 else {
      threadPoolExecutor.shutdown();
    }
    if (!threadPoolExecutor.awaitTermination(LONG_WAIT,TimeUnit.MILLISECONDS)) {
      throw new IllegalStateException("Failed to terminate ThreadPoolExecutor.");
    }
    if (!threadPoolExecutor.isTerminated()) {
      throw new IllegalStateException("awaitTermination failed to transfer ThreadPoolExecutor to " + "terminated state.");
    }
  }
 catch (  InterruptedException ie) {
    throw new RuntimeException("Failed to close ThreadPoolExecutor");
  }
}
