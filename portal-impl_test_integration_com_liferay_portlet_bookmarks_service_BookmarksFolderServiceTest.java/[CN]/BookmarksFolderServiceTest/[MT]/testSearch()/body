{
  FileUtil.deltree(PropsValues.LUCENE_DIR + TestPropsValues.getCompanyId());
  FileUtil.mkdirs(PropsValues.LUCENE_DIR + TestPropsValues.getCompanyId());
  LuceneHelperUtil.startup(TestPropsValues.getCompanyId());
  BookmarksEntry entry=addEntry();
  Thread.sleep(1000 * _FACTOR_DELAY);
  long companyId=entry.getCompanyId();
  long groupId=entry.getFolder().getGroupId();
  long folderId=entry.getFolderId();
  String keywords="test";
  SearchContext searchContext=new SearchContext();
  searchContext.setCompanyId(companyId);
  searchContext.setFolderIds(new long[]{folderId});
  searchContext.setGroupIds(new long[]{groupId});
  searchContext.setKeywords(keywords);
  QueryConfig queryConfig=new QueryConfig();
  queryConfig.setHighlightEnabled(false);
  queryConfig.setScoreEnabled(false);
  searchContext.setQueryConfig(queryConfig);
  Indexer indexer=IndexerRegistryUtil.getIndexer(BookmarksEntry.class);
  Hits hits=indexer.search(searchContext);
  Assert.assertEquals(1,hits.getLength());
  List<Document> results=hits.toList();
  for (  Document doc : results) {
    Assert.assertEquals(companyId,GetterUtil.getLong(doc.get(Field.COMPANY_ID)));
    Assert.assertEquals(groupId,GetterUtil.getLong(doc.get(Field.GROUP_ID)));
    AssertUtils.assertEqualsIgnoreCase(entry.getName(),doc.get(Field.TITLE));
    Assert.assertEquals(entry.getUrl(),doc.get(Field.URL));
    AssertUtils.assertEqualsIgnoreCase(entry.getDescription(),doc.get(Field.DESCRIPTION));
    Assert.assertEquals(folderId,GetterUtil.getLong(doc.get("folderId")));
    Assert.assertEquals(entry.getEntryId(),GetterUtil.getLong(doc.get(Field.ENTRY_CLASS_PK)));
  }
  BookmarksFolderLocalServiceUtil.deleteFolder(folderId);
  Thread.sleep(1000 * _FACTOR_DELAY);
  hits=indexer.search(searchContext);
  Query query=hits.getQuery();
  Assert.assertEquals(query.toString(),0,hits.getLength());
  addEntry();
  addEntry();
  addEntry();
  addEntry();
  Thread.sleep(1000 * _FACTOR_DELAY);
  searchContext.setEnd(3);
  searchContext.setFolderIds(null);
  searchContext.setStart(1);
  hits=indexer.search(searchContext);
  Assert.assertEquals(4,hits.getLength());
  Assert.assertEquals(2,hits.getDocs().length);
}
