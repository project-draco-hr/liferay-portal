{
  boolean exportThemeSettings=MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.THEME_REFERENCE);
  if (_log.isDebugEnabled()) {
    _log.debug("Export theme settings " + exportThemeSettings);
  }
  if (!exportThemeSettings) {
    return;
  }
  StagedTheme stagedTheme=ModelAdapterUtil.adapt(layoutSetBranch.getTheme(),Theme.class,StagedTheme.class);
  if (!portletDataContext.isPerformDirectBinaryImport()) {
    Element layoutSetBranchElement=portletDataContext.getExportDataElement(layoutSetBranch);
    portletDataContext.addReferenceElement(layoutSetBranch,layoutSetBranchElement,stagedTheme,PortletDataContext.REFERENCE_TYPE_DEPENDENCY,true);
  }
  exportThemeSettings(portletDataContext,stagedTheme.getThemeId(),layoutSetBranch.getColorSchemeId(),layoutSetBranch.getCss());
}
