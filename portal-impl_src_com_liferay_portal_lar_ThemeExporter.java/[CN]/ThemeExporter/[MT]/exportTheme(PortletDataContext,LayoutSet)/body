{
  boolean exportThemeSettings=MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.THEME_REFERENCE);
  if (_log.isDebugEnabled()) {
    _log.debug("Export theme settings " + exportThemeSettings);
  }
  if (!exportThemeSettings) {
    return;
  }
  StagedTheme stagedTheme=ModelAdapterUtil.adapt(layoutSet.getTheme(),Theme.class,StagedTheme.class);
  if (!portletDataContext.isPerformDirectBinaryImport()) {
    Element layoutSetElement=portletDataContext.getExportDataElement(layoutSet);
    portletDataContext.addReferenceElement(layoutSet,layoutSetElement,stagedTheme,PortletDataContext.REFERENCE_TYPE_DEPENDENCY,true);
  }
  exportThemeSettings(portletDataContext,stagedTheme.getThemeId(),layoutSet.getColorSchemeId(),layoutSet.getCss());
}
