{
  PrintStream oldOutPrintStream=System.out;
  ByteArrayOutputStream outByteArrayOutputStream=new ByteArrayOutputStream();
  PrintStream newOutPrintStream=new PrintStream(outByteArrayOutputStream,true);
  System.setOut(newOutPrintStream);
  PrintStream oldErrPrintStream=System.err;
  ByteArrayOutputStream errByteArrayOutputStream=new ByteArrayOutputStream();
  PrintStream newErrPrintStream=new PrintStream(errByteArrayOutputStream,true);
  System.setErr(newErrPrintStream);
  File signalFile=new File("signal");
  signalFile.delete();
  try {
    String logMessage="Log Message";
    final LoggingProcessCallable loggingProcessCallable=new LoggingProcessCallable(logMessage,signalFile);
    final AtomicReference<Exception> exceptionAtomicReference=new AtomicReference<Exception>();
    Thread launchThread=new Thread(){
      @Override public void run(){
        try {
          ProcessExecutor.execute(loggingProcessCallable,_classPath);
        }
 catch (        ProcessException pe) {
          exceptionAtomicReference.set(pe);
        }
      }
    }
;
    launchThread.start();
    boolean result=signalFile.createNewFile();
    assertTrue(result);
    _waitForSignalFile(signalFile,false);
    String outByteArrayOutputStreamString=outByteArrayOutputStream.toString();
    assertTrue(outByteArrayOutputStreamString.contains(logMessage));
    String errByteArrayOutputStreamString=errByteArrayOutputStream.toString();
    assertTrue(errByteArrayOutputStreamString.contains(logMessage));
    result=signalFile.createNewFile();
    assertTrue(result);
    launchThread.join();
    Exception e=exceptionAtomicReference.get();
    if (e != null) {
      throw e;
    }
  }
  finally {
    System.setOut(oldOutPrintStream);
    System.setErr(oldErrPrintStream);
    signalFile.delete();
  }
}
