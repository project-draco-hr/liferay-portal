{
  Session session=_sessions.get(syncAccountId);
  if (session != null) {
    if (ServerInfo.supportsDeviceRegistration(syncAccountId)) {
      SyncAccount syncAccount=SyncAccountService.fetchSyncAccount(syncAccountId);
      session.addHeader("Sync-UUID",syncAccount.getUuid());
    }
    return session;
  }
  try {
    SyncAccount syncAccount=SyncAccountService.fetchSyncAccount(syncAccountId);
    URL url=new URL(syncAccount.getUrl());
    if (syncAccount.isOAuthEnabled()) {
      session=new Session(url,syncAccount.getOAuthConsumerKey(),syncAccount.getOAuthConsumerSecret(),syncAccount.getOAuthToken(),Encryptor.decrypt(syncAccount.getOAuthTokenSecret()),syncAccount.isTrustSelfSigned(),syncAccount.getMaxConnections());
    }
 else {
      session=new Session(url,syncAccount.getLogin(),Encryptor.decrypt(syncAccount.getPassword()),syncAccount.isTrustSelfSigned(),syncAccount.getMaxConnections());
    }
    session.addHeader("Sync-UUID",syncAccount.getUuid());
    session.startTrackTransferRate();
    _sessions.put(syncAccountId,session);
    return session;
  }
 catch (  Exception e) {
    _logger.error(e.getMessage(),e);
    return null;
  }
}
