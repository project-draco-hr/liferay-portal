{
  ServiceTrackerMap<String,List<TrackedOne>> serviceTrackerMap=ServiceTrackerMapFactory.multiValueMap(_bundleContext,TrackedOne.class,null,new PropertyServiceReferenceMapper<String,TrackedOne>("target"),new DefaultServiceTrackerCustomizer<TrackedOne>(_bundleContext),new PropertyServiceReferenceComparator<TrackedOne>("service.ranking"),new ServiceTrackerMapListener<String,TrackedOne,List<TrackedOne>>(){
    @Override public void update(    ServiceTrackerMap<String,List<TrackedOne>> map,    String key,    TrackedOne service,    List<TrackedOne> content){
      try {
        content.add(new TrackedOne("spurious"));
      }
 catch (      Exception e) {
      }
    }
  }
);
  serviceTrackerMap.open();
  ServiceRegistration<TrackedOne> serviceRegistration=null;
  try {
    serviceRegistration=registerService(new TrackedOne(),"aTarget");
    List<TrackedOne> trackedOnes=serviceTrackerMap.getService("aTarget");
    Assert.assertEquals(1,trackedOnes.size());
  }
  finally {
    if (serviceRegistration != null) {
      serviceRegistration.unregister();
    }
    serviceTrackerMap.close();
  }
}
