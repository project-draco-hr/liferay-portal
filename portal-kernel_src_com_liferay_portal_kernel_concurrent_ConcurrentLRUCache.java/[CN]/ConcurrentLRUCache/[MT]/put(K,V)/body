{
  if (key == null) {
    throw new NullPointerException("key is null");
  }
  _putCount.getAndIncrement();
  _writeLock.lock();
  try {
    Entry<K,V> currentEntry=_lastEntry._previousEntry;
    while (currentEntry != _headEntry) {
      if (currentEntry._key.equals(key)) {
        currentEntry._value=value;
        if (currentEntry._nextEntry != _lastEntry) {
          detachEntry(currentEntry);
          insertEntryBefore(_lastEntry,currentEntry);
        }
        return;
      }
      currentEntry=currentEntry._previousEntry;
    }
    while (_size.get() >= _maxSize) {
      removeHeadEntry();
    }
    insertEntryBefore(_lastEntry,new Entry<K,V>(key,value));
    _size.getAndIncrement();
  }
  finally {
    _writeLock.unlock();
  }
}
