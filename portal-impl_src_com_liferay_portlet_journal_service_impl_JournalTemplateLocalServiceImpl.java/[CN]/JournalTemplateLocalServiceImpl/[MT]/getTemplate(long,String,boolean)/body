{
  templateId=GetterUtil.getString(templateId).toUpperCase();
  if (groupId == 0) {
    _log.error("No group id was passed for " + templateId + ". Group id is "+ "required since 4.2.0. Please update all custom code and "+ "data that references templates without a group id.");
    List<JournalTemplate> templates=journalTemplatePersistence.findByTemplateId(templateId);
    if (!templates.isEmpty()) {
      return templates.get(0);
    }
    throw new NoSuchTemplateException("No JournalTemplate exists with the template id " + templateId);
  }
  JournalTemplate template=journalTemplatePersistence.fetchByG_T(groupId,templateId);
  if (template != null) {
    return template;
  }
  if (!includeGlobalTemplates) {
    throw new NoSuchTemplateException("No JournalTemplate exists with the template id " + templateId);
  }
  Group group=groupPersistence.findByPrimaryKey(groupId);
  Group companyGroup=groupLocalService.getCompanyGroup(group.getCompanyId());
  return journalTemplatePersistence.findByG_T(companyGroup.getGroupId(),templateId);
}
