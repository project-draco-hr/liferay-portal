{
  _request=request;
  _fileVersion=fileVersion;
  _themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  _companyId=_themeDisplay.getCompanyId();
  if (fileVersion != null) {
    _fileEntry=fileVersion.getFileEntry();
  }
  _fileEntryDisplayContextHelper=new FileEntryDisplayContextHelper(request,_fileEntry);
  _fileVersionDisplayContextHelper=new FileVersionDisplayContextHelper(request,fileVersion);
  long fileEntryTypeId=ParamUtil.getLong(request,"fileEntryTypeId",-1);
  if ((_fileEntryTypeId == -1) && (_fileEntry != null) && (_fileEntry.getModel() instanceof DLFileEntry)) {
    DLFileEntry dlFileEntry=(DLFileEntry)_fileEntry.getModel();
    fileEntryTypeId=dlFileEntry.getFileEntryTypeId();
  }
  _fileEntryTypeId=fileEntryTypeId;
  _folderId=BeanParamUtil.getLong(_fileEntry,request,"folderId");
  PortletRequest portletRequest=(PortletRequest)_request.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  _liferayPortletRequest=PortalUtil.getLiferayPortletRequest(portletRequest);
  PortletResponse portletResponse=(PortletResponse)_request.getAttribute(JavaConstants.JAVAX_PORTLET_RESPONSE);
  _liferayPortletResponse=PortalUtil.getLiferayPortletResponse(portletResponse);
  _portletDisplay=_themeDisplay.getPortletDisplay();
  _scopeGroupId=_themeDisplay.getScopeGroupId();
  _dlPortletInstanceSettings=DLPortletInstanceSettings.getInstance(_themeDisplay.getLayout(),_portletDisplay.getId());
}
