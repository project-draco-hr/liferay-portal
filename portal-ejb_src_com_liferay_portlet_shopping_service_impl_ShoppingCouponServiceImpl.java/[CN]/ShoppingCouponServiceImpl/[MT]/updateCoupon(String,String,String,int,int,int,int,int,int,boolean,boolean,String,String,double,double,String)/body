{
  couponId=couponId.trim().toUpperCase();
  _validate(name,description,limitCategories,limitSkus);
  if (!ShoppingCategoryServiceUtil.hasAdmin()) {
    throw new PrincipalException();
  }
  User user=getUser();
  ShoppingCoupon coupon=ShoppingCouponUtil.findByPrimaryKey(couponId);
  Date startDate=PortalUtil.getDate(startMonth,startDay,startYear,0,0,user.getTimeZone(),new CouponStartDateException());
  Date endDate=null;
  if (!neverExpires) {
    endDate=PortalUtil.getDate(endMonth,endDay,endYear,23,59,user.getTimeZone(),new CouponEndDateException());
  }
  if ((endDate != null) && (startDate.after(endDate))) {
    throw new CouponDateException();
  }
  coupon.setModifiedDate(new Date());
  coupon.setName(name);
  coupon.setDescription(description);
  coupon.setStartDate(startDate);
  coupon.setEndDate(endDate);
  coupon.setActive(active);
  coupon.setLimitCategories(limitCategories);
  coupon.setLimitSkus(limitSkus);
  coupon.setMinOrder(minOrder);
  coupon.setDiscount(discount);
  coupon.setDiscountType(discountType);
  ShoppingCouponUtil.update(coupon);
  return coupon;
}
