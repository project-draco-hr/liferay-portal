{
  if (Validator.isNull(name)) {
    throw new CouponNameException();
  }
 else   if (Validator.isNull(description)) {
    throw new CouponDescriptionException();
  }
  String companyId=getUser().getCompanyId();
  if (Validator.isNotNull(limitCategories)) {
    String[] categoryIds=StringUtil.split(limitCategories);
    List invalidCategoryIds=new ArrayList();
    for (int i=0; i < categoryIds.length; i++) {
      try {
        ShoppingCategory category=ShoppingCategoryUtil.findByPrimaryKey(categoryIds[i]);
        if (!category.getCompanyId().equals(companyId)) {
          invalidCategoryIds.add(categoryIds[i]);
        }
      }
 catch (      NoSuchCategoryException nsce) {
        invalidCategoryIds.add(categoryIds[i]);
      }
    }
    if (invalidCategoryIds.size() > 0) {
      CouponLimitCategoriesException clce=new CouponLimitCategoriesException();
      clce.setCategoryIds(invalidCategoryIds);
      throw clce;
    }
  }
  if (Validator.isNotNull(limitSkus)) {
    String[] skus=StringUtil.split(limitSkus);
    List invalidSkus=new ArrayList();
    for (int i=0; i < skus.length; i++) {
      try {
        ShoppingItem item=ShoppingItemUtil.findByC_S(companyId,skus[i]);
      }
 catch (      NoSuchItemException nsie) {
        invalidSkus.add(skus[i]);
      }
    }
    if (invalidSkus.size() > 0) {
      CouponLimitSKUsException clskue=new CouponLimitSKUsException();
      clskue.setSkus(invalidSkus);
      throw clskue;
    }
  }
}
