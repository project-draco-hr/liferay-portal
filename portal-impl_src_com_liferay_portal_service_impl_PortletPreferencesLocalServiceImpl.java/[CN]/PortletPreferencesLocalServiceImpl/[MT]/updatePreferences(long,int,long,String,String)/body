{
  if (_log.isDebugEnabled()) {
    _log.debug("update portletPreferences {ownerId=" + ownerId + ", ownerType="+ ownerType+ ", plid="+ plid+ ", portletId="+ portletId+ ", xml="+ xml+ "}");
  }
  PortletPreferences portletPreferences=portletPreferencesPersistence.fetchByO_O_P_P(ownerId,ownerType,plid,portletId);
  if (portletPreferences == null) {
    long portletPreferencesId=counterLocalService.increment();
    portletPreferences=portletPreferencesPersistence.create(portletPreferencesId);
    portletPreferences.setOwnerId(ownerId);
    portletPreferences.setOwnerType(ownerType);
    portletPreferences.setPlid(plid);
    portletPreferences.setPortletId(portletId);
  }
  portletPreferences.setPreferences(xml);
  portletPreferencesPersistence.update(portletPreferences);
  return portletPreferences;
}
