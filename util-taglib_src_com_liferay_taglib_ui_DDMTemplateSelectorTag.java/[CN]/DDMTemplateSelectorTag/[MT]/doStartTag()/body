{
  if (_displayStyleGroupId == 0) {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    _displayStyleGroupId=themeDisplay.getScopeGroupId();
  }
  _portletDisplayDDMTemplate=PortletDisplayTemplateUtil.getPortletDisplayTemplateDDMTemplate(_displayStyleGroupId,PortalUtil.getClassNameId(_className),_displayStyle);
  if (_portletDisplayDDMTemplate == null) {
    _portletDisplayDDMTemplate=PortletDisplayTemplateUtil.getDefaultPortletDisplayTemplateDDMTemplate(_displayStyleGroupId,PortalUtil.getClassNameId(_className));
  }
  if (Validator.isNull(_displayStyle)) {
    _displayStyle=_defaultDisplayStyle;
  }
  if (Validator.isNull(_displayStyle) && (_portletDisplayDDMTemplate != null)) {
    _displayStyle=PortletDisplayTemplate.DISPLAY_STYLE_PREFIX + _portletDisplayDDMTemplate.getTemplateKey();
  }
  return super.doStartTag();
}
