{
  ThemeDisplay themeDisplay=new ThemeDisplay();
  Company company=CompanyLocalServiceUtil.getCompany(companyId);
  themeDisplay.setCompany(company);
  long plid=TestPropsValues.getPlid();
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  themeDisplay.setLayout(layout);
  themeDisplay.setPlid(plid);
  HttpServletRequest request=new MockHttpServletRequest();
  request.setAttribute(WebKeys.COMPANY_ID,companyId);
  request.setAttribute(WebKeys.CURRENT_URL,"http://localhost:80/web/guest/home");
  request.setAttribute(WebKeys.USER,TestPropsValues.getUser());
  themeDisplay.setRequest(request);
  themeDisplay.setScopeGroupId(layout.getGroupId());
  themeDisplay.setSecure(false);
  themeDisplay.setServerPort(8080);
  themeDisplay.setSiteGroupId(layout.getGroupId());
  themeDisplay.setUser(TestPropsValues.getUser());
  themeDisplay.setWidget(false);
  request.setAttribute(WebKeys.THEME_DISPLAY,themeDisplay);
  return themeDisplay;
}
