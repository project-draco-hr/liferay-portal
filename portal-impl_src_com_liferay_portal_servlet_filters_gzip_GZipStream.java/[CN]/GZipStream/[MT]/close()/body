{
  if (_closed) {
    throw new IOException();
  }
  _gzipOutputStream.finish();
  int contentLength=_unsyncByteArrayOutputStream.size();
  _response.setContentLength(contentLength);
  _response.addHeader(HttpHeaders.CONTENT_ENCODING,_GZIP);
  try {
    flushOutToOutputStream();
  }
 catch (  IllegalStateException ise) {
    flushOutToWriter();
  }
  _closed=true;
}
