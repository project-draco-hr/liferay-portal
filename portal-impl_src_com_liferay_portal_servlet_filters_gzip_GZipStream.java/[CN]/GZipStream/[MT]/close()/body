{
  if (_closed) {
    throw new IOException();
  }
  _gzipOutputStream.finish();
  byte[] compressedBytes=_bufferedOutput.toByteArray();
  _response.setContentLength(compressedBytes.length);
  _response.addHeader(HttpHeaders.CONTENT_ENCODING,_GZIP);
  _output.write(compressedBytes);
  _output.flush();
  _output.close();
  _closed=true;
}
