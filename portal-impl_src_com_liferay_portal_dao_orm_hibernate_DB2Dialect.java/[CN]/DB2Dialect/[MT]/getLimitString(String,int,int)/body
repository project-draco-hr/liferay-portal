{
  boolean hasOffset=false;
  if ((offset > 0) || forceLimitUsage()) {
    hasOffset=true;
  }
  StringBundler sb=null;
  if (hasOffset) {
    sb=new StringBundler(11);
  }
 else {
    sb=new StringBundler(5);
  }
  if (!hasOffset) {
    addQueryForLimitedRows(sb,sql,limit);
    addOptimizeForLimitedRows(sb,limit);
    return sb.toString();
  }
  sb.append("SELECT outerQuery.* FROM (");
  sb.append("SELECT innerQuery.*, ROW_NUMBER() OVER() AS rowNumber_ ");
  sb.append("FROM (");
  addQueryForLimitedRows(sb,sql,limit);
  sb.append(") AS innerQuery");
  sb.append(") AS outerQuery WHERE rowNumber_ > ");
  sb.append(offset);
  addOptimizeForLimitedRows(sb,limit);
  return sb.toString();
}
