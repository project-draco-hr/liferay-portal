{
  HttpSession ses=event.getSession();
  ses.removeAttribute(WebKeys.PORTLET_SESSION_TRACKER);
  ses.removeAttribute(WebKeys.REVERSE_AJAX);
  MessagingUtil.closeXMPPConnection(ses);
  PortalSessionContext.remove(ses.getId());
  try {
    String companyId=(String)ses.getAttribute(WebKeys.COMPANY_ID);
    String userId=(String)ses.getAttribute(WebKeys.USER_ID);
    if (companyId == null) {
      _log.warn("Company id is not in the session");
    }
    if (userId == null) {
      _log.warn("User id is not in the session");
    }
    if ((companyId == null) || (userId == null)) {
      return;
    }
    MailSessionLock.cleanUp(ses);
    LiveUsers.signOut(ses.getId(),userId);
  }
 catch (  IllegalStateException ise) {
    _log.warn("Please upgrade to a servlet 2.4 compliant container");
  }
catch (  Exception e) {
    _log.error(e,e);
  }
  try {
    EventsProcessor.process(PropsUtil.getArray(PropsUtil.SERVLET_SESSION_DESTROY_EVENTS),ses);
  }
 catch (  ActionException ae) {
    _log.error(ae,ae);
  }
}
