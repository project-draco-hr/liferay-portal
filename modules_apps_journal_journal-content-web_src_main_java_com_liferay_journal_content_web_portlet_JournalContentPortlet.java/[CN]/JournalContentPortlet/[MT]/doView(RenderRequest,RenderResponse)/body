{
  PortletPreferences portletPreferences=renderRequest.getPreferences();
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long articleGroupId=PrefsParamUtil.getLong(portletPreferences,renderRequest,"groupId",themeDisplay.getScopeGroupId());
  String articleId=PrefsParamUtil.getString(portletPreferences,renderRequest,"articleId");
  String ddmTemplateKey=PrefsParamUtil.getString(portletPreferences,renderRequest,"ddmTemplateKey");
  JournalArticle article=null;
  JournalArticleDisplay articleDisplay=null;
  if ((articleGroupId > 0) && Validator.isNotNull(articleId)) {
    String viewMode=ParamUtil.getString(renderRequest,"viewMode");
    String languageId=LanguageUtil.getLanguageId(renderRequest);
    int page=ParamUtil.getInteger(renderRequest,"page",1);
    article=_journalArticleLocalService.fetchLatestArticle(articleGroupId,articleId,WorkflowConstants.STATUS_APPROVED);
    try {
      if (article == null) {
        article=_journalArticleLocalService.getLatestArticle(articleGroupId,articleId,WorkflowConstants.STATUS_ANY);
      }
      double version=article.getVersion();
      if (Validator.isNull(ddmTemplateKey)) {
        ddmTemplateKey=article.getDDMTemplateKey();
      }
      articleDisplay=JournalContentUtil.getDisplay(articleGroupId,articleId,version,ddmTemplateKey,viewMode,languageId,page,new PortletRequestModel(renderRequest,renderResponse),themeDisplay);
    }
 catch (    Exception e) {
      renderRequest.removeAttribute(WebKeys.JOURNAL_ARTICLE);
      articleDisplay=JournalContentUtil.getDisplay(articleGroupId,articleId,ddmTemplateKey,viewMode,languageId,page,new PortletRequestModel(renderRequest,renderResponse),themeDisplay);
    }
  }
  if (article != null) {
    renderRequest.setAttribute(WebKeys.JOURNAL_ARTICLE,article);
  }
  if (articleDisplay != null) {
    renderRequest.setAttribute(WebKeys.JOURNAL_ARTICLE_DISPLAY,articleDisplay);
  }
 else {
    renderRequest.removeAttribute(WebKeys.JOURNAL_ARTICLE_DISPLAY);
  }
  super.doView(renderRequest,renderResponse);
}
