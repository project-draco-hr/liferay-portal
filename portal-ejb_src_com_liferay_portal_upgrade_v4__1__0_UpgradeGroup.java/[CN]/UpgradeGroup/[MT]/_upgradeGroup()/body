{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getConnection(Constants.DATA_SOURCE);
    ps=con.prepareStatement(_UPGRADE_GROUP);
    rs=ps.executeQuery();
    while (rs.next()) {
      String roleId=rs.getString("roleId");
      String companyId=rs.getString("companyId");
      String groupId=rs.getString("classPK");
      List users=UserLocalServiceUtil.getRoleUsers(roleId);
      for (int i=0; i < users.size(); i++) {
        User user=(User)users.get(i);
        Resource resource=ResourceLocalServiceUtil.addResource(companyId,Group.class.getName(),Resource.TYPE_CLASS,Resource.SCOPE_INDIVIDUAL,groupId);
        PermissionLocalServiceUtil.addUserPermissions(user.getUserId(),new String[]{ActionKeys.ADMINISTRATE},resource.getResourceId());
      }
      RoleLocalServiceUtil.deleteRole(roleId);
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
