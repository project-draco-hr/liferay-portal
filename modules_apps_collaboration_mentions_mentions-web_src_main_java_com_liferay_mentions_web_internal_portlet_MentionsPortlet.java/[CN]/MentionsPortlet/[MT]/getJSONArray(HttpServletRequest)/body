{
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  SocialInteractionsConfiguration socialInteractionsConfiguration=SocialInteractionsConfigurationUtil.getSocialInteractionsConfiguration(themeDisplay.getCompanyId(),MentionsPortletKeys.MENTIONS);
  String query=ParamUtil.getString(request,"query");
  List<User> users=_mentionsUserFinder.getUsers(themeDisplay.getCompanyId(),themeDisplay.getUserId(),query,socialInteractionsConfiguration);
  for (  User user : users) {
    if (user.isDefaultUser() || (themeDisplay.getUserId() == user.getUserId())) {
      continue;
    }
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    jsonObject.put("fullName",user.getFullName());
    String mention="@" + user.getScreenName();
    String profileURL=user.getDisplayURL(themeDisplay);
    if (Validator.isNotNull(profileURL)) {
      mention="<a href=\"" + profileURL + "\">@"+ user.getScreenName()+ "</a>";
    }
    jsonObject.put("mention",mention);
    jsonObject.put("portraitURL",user.getPortraitURL(themeDisplay));
    jsonObject.put("screenName",user.getScreenName());
    jsonArray.put(jsonObject);
  }
  return jsonArray;
}
