{
  int beginIndex=currentIndex + openTag.length + 1;
  int endIndex=KMPSearch.search(oldByteArray,beginIndex,_MARKER_SCRIPT_CLOSE,_MARKER_SCRIPT_CLOSE_NEXTS);
  if (endIndex == -1) {
    _log.error("Missing </script>");
    return currentIndex + 1;
  }
  int newBeginIndex=endIndex + _MARKER_SCRIPT_CLOSE.length;
  newBeginIndex+=countContinuousWhiteSpace(oldByteArray,newBeginIndex);
  String content=new String(oldByteArray,beginIndex,endIndex - beginIndex);
  if (Validator.isNull(content)) {
    return newBeginIndex;
  }
  String minifiedContent=content;
  if (PropsValues.MINIFIER_INLINE_CONTENT_CACHE_SIZE > 0) {
    String key=String.valueOf(content.hashCode());
    minifiedContent=_minifierCache.get(key);
    if (minifiedContent == null) {
      minifiedContent=MinifierUtil.minifyJavaScript(content);
      boolean skipCache=false;
      for (      String skipJavaScript : PropsValues.MINIFIER_INLINE_CONTENT_CACHE_SKIP_JAVASCRIPT) {
        if (minifiedContent.contains(skipJavaScript)) {
          skipCache=true;
          break;
        }
      }
      if (!skipCache) {
        _minifierCache.put(key,minifiedContent);
      }
    }
  }
  if (Validator.isNull(minifiedContent)) {
    return newBeginIndex;
  }
  ByteBuffer contentByteBuffer=CharsetEncoderUtil.encode(StringPool.UTF8,minifiedContent);
  newBytes.write(_SCRIPT_TYPE_JAVASCRIPT);
  newBytes.write(_CDATA_OPEN);
  newBytes.write(contentByteBuffer.array(),0,contentByteBuffer.limit());
  newBytes.write(_CDATA_CLOSE);
  newBytes.write(_MARKER_SCRIPT_CLOSE);
  return newBeginIndex;
}
