{
  int count=countContinuousWhiteSpace(oldByteArray,0);
  for (int i=count; i < length; i++) {
    byte b=oldByteArray[i];
    if (b == CharPool.LESS_THAN) {
      if (hasMarker(oldByteArray,i,_MARKER_PRE_OPEN)) {
        i=processPre(oldByteArray,outputStream,i) - 1;
        continue;
      }
 else       if (hasMarker(oldByteArray,i,_MARKER_TEXTAREA_OPEN)) {
        i=processTextArea(oldByteArray,outputStream,i) - 1;
        continue;
      }
 else       if (hasMarker(oldByteArray,i,_MARKER_JS_OPEN)) {
        i=processJavaScript(oldByteArray,outputStream,i,_MARKER_JS_OPEN) - 1;
        continue;
      }
 else       if (hasMarker(oldByteArray,i,_MARKER_SCRIPT_OPEN)) {
        i=processJavaScript(oldByteArray,outputStream,i,_MARKER_SCRIPT_OPEN) - 1;
        continue;
      }
 else       if (hasMarker(oldByteArray,i,_MARKER_STYLE_OPEN)) {
        i=processCSS(oldByteArray,outputStream,i) - 1;
        continue;
      }
    }
 else     if (b == CharPool.GREATER_THAN) {
      outputStream.write(b);
      int spaceCount=countContinuousWhiteSpace(oldByteArray,i + 1);
      if (spaceCount > 0) {
        i=i + spaceCount;
        outputStream.write(CharPool.SPACE);
      }
      continue;
    }
    int spaceCount=countContinuousWhiteSpace(oldByteArray,i);
    if (spaceCount > 0) {
      outputStream.write(CharPool.SPACE);
      i=i + spaceCount - 1;
    }
 else {
      outputStream.write(b);
    }
  }
  outputStream.flush();
}
