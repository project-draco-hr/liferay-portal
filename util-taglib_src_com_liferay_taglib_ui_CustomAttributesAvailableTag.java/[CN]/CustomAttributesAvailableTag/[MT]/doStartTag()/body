{
  try {
    HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    long companyId=_companyId;
    if (companyId == 0) {
      companyId=themeDisplay.getCompanyId();
    }
    ExpandoBridge expandoBridge=null;
    if (_classPK == 0) {
      expandoBridge=ExpandoBridgeFactoryUtil.getExpandoBridge(companyId,_className);
    }
 else {
      expandoBridge=ExpandoBridgeFactoryUtil.getExpandoBridge(companyId,_className,_classPK);
    }
    List<String> attributes=CustomAttributesTagUtil.getUnignoredAttributes(expandoBridge.getAttributeNames(),_ignore);
    if (attributes.isEmpty()) {
      return SKIP_BODY;
    }
    if (_classPK == 0) {
      return EVAL_BODY_INCLUDE;
    }
    PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
    for (    String attributeName : attributes) {
      Serializable value=expandoBridge.getAttribute(attributeName);
      if (Validator.isNull(value)) {
        continue;
      }
      UnicodeProperties properties=expandoBridge.getAttributeProperties(attributeName);
      boolean propertyHidden=GetterUtil.getBoolean(properties.get(ExpandoColumnConstants.PROPERTY_HIDDEN));
      boolean propertyVisibleWithUpdatePermission=GetterUtil.getBoolean(properties.get(ExpandoColumnConstants.PROPERTY_VISIBLE_WITH_UPDATE_PERMISSION));
      if (_editable && propertyVisibleWithUpdatePermission) {
        if (ExpandoColumnPermissionUtil.contains(permissionChecker,companyId,_className,ExpandoTableConstants.DEFAULT_TABLE_NAME,attributeName,ActionKeys.UPDATE)) {
          propertyHidden=false;
        }
 else {
          propertyHidden=true;
        }
      }
      if (!propertyHidden && ExpandoColumnPermissionUtil.contains(permissionChecker,companyId,_className,ExpandoTableConstants.DEFAULT_TABLE_NAME,attributeName,ActionKeys.VIEW)) {
        return EVAL_BODY_INCLUDE;
      }
    }
    return SKIP_BODY;
  }
 catch (  Exception e) {
    throw new JspException(e);
  }
 finally {
    if (!ServerDetector.isResin()) {
      _className=null;
      _classPK=0;
      _companyId=0;
      _editable=false;
      _ignore=null;
    }
  }
}
