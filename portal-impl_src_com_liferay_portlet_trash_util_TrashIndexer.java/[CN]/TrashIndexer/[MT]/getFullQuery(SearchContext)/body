{
  try {
    BooleanFilter fullQueryBooleanFilter=new BooleanFilter();
    fullQueryBooleanFilter.addRequiredTerm(Field.COMPANY_ID,searchContext.getCompanyId());
    List<TrashHandler> trashHandlers=TrashHandlerRegistryUtil.getTrashHandlers();
    for (    TrashHandler trashHandler : trashHandlers) {
      Filter filter=trashHandler.getExcludeFilter(searchContext);
      if (filter != null) {
        fullQueryBooleanFilter.add(filter,BooleanClauseOccur.MUST_NOT);
      }
      processTrashHandlerExcludeQuery(searchContext,fullQueryBooleanFilter,trashHandler);
    }
    long[] groupIds=searchContext.getGroupIds();
    if (ArrayUtil.isNotEmpty(groupIds)) {
      TermsFilter groupTermsFilter=new TermsFilter(Field.GROUP_ID);
      groupTermsFilter.addValues(ArrayUtil.toStringArray(groupIds));
      fullQueryBooleanFilter.add(groupTermsFilter,BooleanClauseOccur.MUST);
    }
    fullQueryBooleanFilter.addRequiredTerm(Field.STATUS,WorkflowConstants.STATUS_IN_TRASH);
    BooleanQuery fullQuery=createFullQuery(fullQueryBooleanFilter,searchContext);
    return fullQuery;
  }
 catch (  SearchException se) {
    throw se;
  }
catch (  Exception e) {
    throw new SearchException(e);
  }
}
