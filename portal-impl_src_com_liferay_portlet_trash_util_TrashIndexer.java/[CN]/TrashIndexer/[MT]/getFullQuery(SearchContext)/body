{
  try {
    BooleanFilter queryBooleanFilter=new BooleanFilter();
    queryBooleanFilter.addRequiredTerm(Field.COMPANY_ID,searchContext.getCompanyId());
    List<TrashHandler> trashHandlers=TrashHandlerRegistryUtil.getTrashHandlers();
    for (    TrashHandler trashHandler : trashHandlers) {
      Query query=trashHandler.getExcludeQuery(searchContext);
      if (query != null) {
        queryBooleanFilter.add(new QueryFilter(query),BooleanClauseOccur.MUST_NOT);
      }
    }
    BooleanFilter groupBooleanFilter=new BooleanFilter();
    for (    long groupId : searchContext.getGroupIds()) {
      groupBooleanFilter.addTerm(Field.GROUP_ID,String.valueOf(groupId),BooleanClauseOccur.SHOULD);
    }
    if (groupBooleanFilter.hasClauses()) {
      queryBooleanFilter.add(groupBooleanFilter,BooleanClauseOccur.MUST);
    }
    queryBooleanFilter.addRequiredTerm(Field.STATUS,WorkflowConstants.STATUS_IN_TRASH);
    BooleanQuery fullQuery=createFullQuery(queryBooleanFilter,searchContext);
    return fullQuery;
  }
 catch (  SearchException se) {
    throw se;
  }
catch (  Exception e) {
    throw new SearchException(e);
  }
}
