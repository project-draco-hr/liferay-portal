{
  boolean isNew=user.isNew();
  UserModelImpl userModelImpl=(UserModelImpl)user;
  if (Validator.isNull(user.getUuid())) {
    String uuid=PortalUUIDUtil.generate();
    user.setUuid(uuid);
  }
  Session session=null;
  try {
    session=openSession();
    BatchSessionUtil.update(session,user,merge);
    user.setNew(false);
  }
 catch (  Exception e) {
    throw processException(e);
  }
 finally {
    closeSession(session);
  }
  FinderCacheUtil.clearCache(FINDER_CLASS_NAME_LIST);
  EntityCacheUtil.putResult(UserModelImpl.ENTITY_CACHE_ENABLED,UserImpl.class,user.getPrimaryKey(),user);
  if (!isNew && (user.getContactId() != userModelImpl.getOriginalContactId())) {
    FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_CONTACTID,new Object[]{new Long(userModelImpl.getOriginalContactId())});
  }
  if (isNew || (user.getContactId() != userModelImpl.getOriginalContactId())) {
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_CONTACTID,new Object[]{new Long(user.getContactId())},user);
  }
  if (!isNew && (!Validator.equals(user.getOpenId(),userModelImpl.getOriginalOpenId()))) {
    FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_OPENID,new Object[]{userModelImpl.getOriginalOpenId()});
  }
  if (isNew || (!user.getOpenId().equals(userModelImpl.getOriginalOpenId()))) {
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_OPENID,new Object[]{user.getOpenId()},user);
  }
  if (!isNew && (user.getPortraitId() != userModelImpl.getOriginalPortraitId())) {
    FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_PORTRAITID,new Object[]{new Long(userModelImpl.getOriginalPortraitId())});
  }
  if (isNew || (user.getPortraitId() != userModelImpl.getOriginalPortraitId())) {
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_PORTRAITID,new Object[]{new Long(user.getPortraitId())},user);
  }
  if (!isNew && ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || (user.getUserId() != userModelImpl.getOriginalUserId()))) {
    FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_U,new Object[]{new Long(userModelImpl.getOriginalCompanyId()),new Long(userModelImpl.getOriginalUserId())});
  }
  if (isNew || ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || (user.getUserId() != userModelImpl.getOriginalUserId()))) {
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_U,new Object[]{new Long(user.getCompanyId()),new Long(user.getUserId())},user);
  }
  if (!isNew && ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || (user.getDefaultUser() != userModelImpl.getOriginalDefaultUser()))) {
    FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_DU,new Object[]{new Long(userModelImpl.getOriginalCompanyId()),Boolean.valueOf(userModelImpl.getOriginalDefaultUser())});
  }
  if (isNew || ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || (user.getDefaultUser() != userModelImpl.getOriginalDefaultUser()))) {
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_DU,new Object[]{new Long(user.getCompanyId()),Boolean.valueOf(user.getDefaultUser())},user);
  }
  if (!isNew && ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || !Validator.equals(user.getScreenName(),userModelImpl.getOriginalScreenName()))) {
    FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_SN,new Object[]{new Long(userModelImpl.getOriginalCompanyId()),userModelImpl.getOriginalScreenName()});
  }
  if (isNew || ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || !user.getScreenName().equals(userModelImpl.getOriginalScreenName()))) {
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_SN,new Object[]{new Long(user.getCompanyId()),user.getScreenName()},user);
  }
  if (!isNew && ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || !Validator.equals(user.getEmailAddress(),userModelImpl.getOriginalEmailAddress()))) {
    FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_EA,new Object[]{new Long(userModelImpl.getOriginalCompanyId()),userModelImpl.getOriginalEmailAddress()});
  }
  if (isNew || ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || !user.getEmailAddress().equals(userModelImpl.getOriginalEmailAddress()))) {
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_EA,new Object[]{new Long(user.getCompanyId()),user.getEmailAddress()},user);
  }
  return user;
}
