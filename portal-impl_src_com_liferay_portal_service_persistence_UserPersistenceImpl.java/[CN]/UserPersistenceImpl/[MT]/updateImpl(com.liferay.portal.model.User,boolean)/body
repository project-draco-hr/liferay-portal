{
  user=toUnwrappedModel(user);
  boolean isNew=user.isNew();
  UserModelImpl userModelImpl=(UserModelImpl)user;
  if (Validator.isNull(user.getUuid())) {
    String uuid=PortalUUIDUtil.generate();
    user.setUuid(uuid);
  }
  Session session=null;
  try {
    session=openSession();
    BatchSessionUtil.update(session,user,merge);
    user.setNew(false);
  }
 catch (  Exception e) {
    throw processException(e);
  }
 finally {
    closeSession(session);
  }
  FinderCacheUtil.clearCache(FINDER_CLASS_NAME_LIST_WITH_PAGINATION);
  if (isNew) {
    FinderCacheUtil.clearCache(FINDER_CLASS_NAME_LIST_WITHOUT_PAGINATION);
  }
 else {
    if (!Validator.equals(user.getUuid(),userModelImpl.getOriginalUuid())) {
      FinderCacheUtil.removeResult(FINDER_PATH_WITHOUT_PAGINATION_FIND_BY_UUID,new Object[]{userModelImpl.getOriginalUuid()});
    }
    if (user.getCompanyId() != userModelImpl.getOriginalCompanyId()) {
      FinderCacheUtil.removeResult(FINDER_PATH_WITHOUT_PAGINATION_FIND_BY_COMPANYID,new Object[]{Long.valueOf(userModelImpl.getOriginalCompanyId())});
    }
    if (!Validator.equals(user.getEmailAddress(),userModelImpl.getOriginalEmailAddress())) {
      FinderCacheUtil.removeResult(FINDER_PATH_WITHOUT_PAGINATION_FIND_BY_EMAILADDRESS,new Object[]{userModelImpl.getOriginalEmailAddress()});
    }
    if ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || (user.getStatus() != userModelImpl.getOriginalStatus())) {
      FinderCacheUtil.removeResult(FINDER_PATH_WITHOUT_PAGINATION_FIND_BY_C_S,new Object[]{Long.valueOf(userModelImpl.getOriginalCompanyId()),Integer.valueOf(userModelImpl.getOriginalStatus())});
    }
  }
  EntityCacheUtil.putResult(UserModelImpl.ENTITY_CACHE_ENABLED,UserImpl.class,user.getPrimaryKey(),user);
  if (isNew) {
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_CONTACTID,new Object[]{Long.valueOf(user.getContactId())},user);
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_PORTRAITID,new Object[]{Long.valueOf(user.getPortraitId())},user);
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_U,new Object[]{Long.valueOf(user.getCompanyId()),Long.valueOf(user.getUserId())},user);
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_DU,new Object[]{Long.valueOf(user.getCompanyId()),Boolean.valueOf(user.getDefaultUser())},user);
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_SN,new Object[]{Long.valueOf(user.getCompanyId()),user.getScreenName()},user);
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_EA,new Object[]{Long.valueOf(user.getCompanyId()),user.getEmailAddress()},user);
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_FID,new Object[]{Long.valueOf(user.getCompanyId()),Long.valueOf(user.getFacebookId())},user);
    FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_O,new Object[]{Long.valueOf(user.getCompanyId()),user.getOpenId()},user);
  }
 else {
    if (user.getContactId() != userModelImpl.getOriginalContactId()) {
      FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_CONTACTID,new Object[]{Long.valueOf(userModelImpl.getOriginalContactId())});
      FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_CONTACTID,new Object[]{Long.valueOf(user.getContactId())},user);
    }
    if (user.getPortraitId() != userModelImpl.getOriginalPortraitId()) {
      FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_PORTRAITID,new Object[]{Long.valueOf(userModelImpl.getOriginalPortraitId())});
      FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_PORTRAITID,new Object[]{Long.valueOf(user.getPortraitId())},user);
    }
    if ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || (user.getUserId() != userModelImpl.getOriginalUserId())) {
      FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_U,new Object[]{Long.valueOf(userModelImpl.getOriginalCompanyId()),Long.valueOf(userModelImpl.getOriginalUserId())});
      FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_U,new Object[]{Long.valueOf(user.getCompanyId()),Long.valueOf(user.getUserId())},user);
    }
    if ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || (user.getDefaultUser() != userModelImpl.getOriginalDefaultUser())) {
      FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_DU,new Object[]{Long.valueOf(userModelImpl.getOriginalCompanyId()),Boolean.valueOf(userModelImpl.getOriginalDefaultUser())});
      FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_DU,new Object[]{Long.valueOf(user.getCompanyId()),Boolean.valueOf(user.getDefaultUser())},user);
    }
    if ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || !Validator.equals(user.getScreenName(),userModelImpl.getOriginalScreenName())) {
      FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_SN,new Object[]{Long.valueOf(userModelImpl.getOriginalCompanyId()),userModelImpl.getOriginalScreenName()});
      FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_SN,new Object[]{Long.valueOf(user.getCompanyId()),user.getScreenName()},user);
    }
    if ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || !Validator.equals(user.getEmailAddress(),userModelImpl.getOriginalEmailAddress())) {
      FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_EA,new Object[]{Long.valueOf(userModelImpl.getOriginalCompanyId()),userModelImpl.getOriginalEmailAddress()});
      FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_EA,new Object[]{Long.valueOf(user.getCompanyId()),user.getEmailAddress()},user);
    }
    if ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || (user.getFacebookId() != userModelImpl.getOriginalFacebookId())) {
      FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_FID,new Object[]{Long.valueOf(userModelImpl.getOriginalCompanyId()),Long.valueOf(userModelImpl.getOriginalFacebookId())});
      FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_FID,new Object[]{Long.valueOf(user.getCompanyId()),Long.valueOf(user.getFacebookId())},user);
    }
    if ((user.getCompanyId() != userModelImpl.getOriginalCompanyId()) || !Validator.equals(user.getOpenId(),userModelImpl.getOriginalOpenId())) {
      FinderCacheUtil.removeResult(FINDER_PATH_FETCH_BY_C_O,new Object[]{Long.valueOf(userModelImpl.getOriginalCompanyId()),userModelImpl.getOriginalOpenId()});
      FinderCacheUtil.putResult(FINDER_PATH_FETCH_BY_C_O,new Object[]{Long.valueOf(user.getCompanyId()),user.getOpenId()},user);
    }
  }
  return user;
}
