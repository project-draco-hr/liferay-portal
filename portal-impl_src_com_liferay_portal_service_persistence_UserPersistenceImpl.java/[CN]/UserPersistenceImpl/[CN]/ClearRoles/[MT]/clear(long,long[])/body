{
  ModelListener<com.liferay.portal.model.Role>[] roleListeners=rolePersistence.getListeners();
  List<com.liferay.portal.model.Role> oldRoles=null;
  List<com.liferay.portal.model.Role> roles=null;
  if ((listeners.length > 0) || (roleListeners.length > 0)) {
    oldRoles=getRoles(userId);
    roles=new ArrayList<com.liferay.portal.model.Role>();
    for (    com.liferay.portal.model.Role role : oldRoles) {
      if (!ArrayUtil.contains(rolePKs,role.getPrimaryKey())) {
        roles.add(role);
      }
    }
    for (    com.liferay.portal.model.Role role : roles) {
      for (      ModelListener<User> listener : listeners) {
        listener.onBeforeRemoveAssociation(userId,com.liferay.portal.model.Role.class.getName(),role.getPrimaryKey());
      }
      for (      ModelListener<com.liferay.portal.model.Role> listener : roleListeners) {
        listener.onBeforeRemoveAssociation(role.getPrimaryKey(),User.class.getName(),userId);
      }
    }
  }
  for (  com.liferay.portal.model.Role role : roles) {
    _sqlUpdateRole.update(new Object[]{new Long(userId),new Long(role.getPrimaryKey())});
  }
  if ((listeners.length > 0) || (roleListeners.length > 0)) {
    for (    com.liferay.portal.model.Role role : roles) {
      for (      ModelListener<User> listener : listeners) {
        listener.onAfterRemoveAssociation(userId,com.liferay.portal.model.Role.class.getName(),role.getPrimaryKey());
      }
      for (      ModelListener<com.liferay.portal.model.Role> listener : roleListeners) {
        listener.onAfterRemoveAssociation(role.getPrimaryKey(),User.class.getName(),userId);
      }
    }
  }
}
