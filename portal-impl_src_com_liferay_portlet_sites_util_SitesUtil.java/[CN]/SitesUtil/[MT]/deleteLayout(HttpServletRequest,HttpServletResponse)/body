{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long plid=ParamUtil.getLong(request,"plid");
  long groupId=ParamUtil.getLong(request,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(request,"privateLayout");
  long layoutId=ParamUtil.getLong(request,"layoutId");
  Layout layout=null;
  if (plid <= 0) {
    layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,layoutId);
  }
 else {
    layout=LayoutLocalServiceUtil.getLayout(plid);
    groupId=layout.getGroupId();
    privateLayout=layout.isPrivateLayout();
    layoutId=layout.getLayoutId();
  }
  Group group=layout.getGroup();
  String oldFriendlyURL=layout.getFriendlyURL();
  if (group.isStagingGroup() && !GroupPermissionUtil.contains(permissionChecker,groupId,ActionKeys.MANAGE_STAGING) && !GroupPermissionUtil.contains(permissionChecker,groupId,ActionKeys.PUBLISH_STAGING)) {
    throw new PrincipalException();
  }
  if (LayoutPermissionUtil.contains(permissionChecker,layout,ActionKeys.DELETE)) {
    LayoutSettings layoutSettings=LayoutSettings.getInstance(layout);
    EventsProcessorUtil.process(PropsKeys.LAYOUT_CONFIGURATION_ACTION_DELETE,layoutSettings.getConfigurationActionDelete(),request,response);
  }
  LayoutSet layoutSet=layout.getLayoutSet();
  Group layoutSetGroup=layoutSet.getGroup();
  ServiceContext serviceContext=ServiceContextFactory.getInstance(request);
  if (layoutSetGroup.isLayoutSetPrototype()) {
    LayoutSetPrototype layoutSetPrototype=LayoutSetPrototypeLocalServiceUtil.getLayoutSetPrototype(layoutSetGroup.getClassPK());
    List<LayoutSet> linkedLayoutSets=LayoutSetLocalServiceUtil.getLayoutSetsByLayoutSetPrototypeUuid(layoutSetPrototype.getUuid());
    for (    LayoutSet linkedLayoutSet : linkedLayoutSets) {
      Layout linkedLayout=LayoutLocalServiceUtil.fetchLayoutByUuidAndGroupId(layout.getUuid(),linkedLayoutSet.getGroupId());
      if ((linkedLayout != null) && (!isLayoutUpdateable(linkedLayout) || isLayoutToBeUpdatedFromSourcePrototype(linkedLayout))) {
        LayoutServiceUtil.deleteLayout(linkedLayout.getPlid(),serviceContext);
      }
    }
  }
  LayoutServiceUtil.deleteLayout(groupId,privateLayout,layoutId,serviceContext);
  long newPlid=layout.getParentPlid();
  if (newPlid <= 0) {
    Layout firstLayout=LayoutLocalServiceUtil.fetchFirstLayout(layoutSet.getGroupId(),layoutSet.getPrivateLayout(),LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
    if (firstLayout != null) {
      newPlid=firstLayout.getPlid();
    }
  }
  return new Object[]{group,oldFriendlyURL,newPlid};
}
