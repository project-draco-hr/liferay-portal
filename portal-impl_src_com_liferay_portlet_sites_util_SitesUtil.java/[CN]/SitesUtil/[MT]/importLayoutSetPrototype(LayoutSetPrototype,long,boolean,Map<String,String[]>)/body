{
  File file=null;
  File cacheFile=new File(_TEMP_DIR.concat(layoutSetPrototype.getUuid()).concat(".lar"));
  if (cacheFile.exists()) {
    Date modifiedDate=layoutSetPrototype.getModifiedDate();
    if (cacheFile.lastModified() >= modifiedDate.getTime()) {
      if (_log.isDebugEnabled()) {
        _log.debug("Using cached layout set prototype LAR file " + cacheFile.getAbsolutePath());
      }
      file=cacheFile;
    }
  }
  boolean newFile=false;
  if (file == null) {
    Group layoutSetPrototypeGroup=layoutSetPrototype.getGroup();
    file=LayoutLocalServiceUtil.exportLayoutsAsFile(layoutSetPrototypeGroup.getGroupId(),true,null,parameterMap,null,null);
    newFile=true;
  }
  long userId=UserLocalServiceUtil.getDefaultUserId(layoutSetPrototype.getCompanyId());
  LayoutLocalServiceUtil.importLayouts(userId,groupId,privateLayout,parameterMap,file);
  if (newFile) {
    try {
      FileUtil.copyFile(file,cacheFile);
      if (_log.isDebugEnabled()) {
        _log.debug("Copied " + file.getAbsolutePath() + " to "+ cacheFile.getAbsolutePath());
      }
    }
 catch (    Exception e) {
      _log.error("Unable to copy file " + file.getAbsolutePath() + " to "+ cacheFile.getAbsolutePath(),e);
    }
  }
}
