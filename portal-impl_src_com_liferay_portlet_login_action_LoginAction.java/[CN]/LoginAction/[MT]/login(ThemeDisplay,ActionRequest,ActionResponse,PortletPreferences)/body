{
  HttpServletRequest request=PortalUtil.getHttpServletRequest(actionRequest);
  HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
  String login=ParamUtil.getString(actionRequest,"login");
  String password=actionRequest.getParameter("password");
  boolean rememberMe=ParamUtil.getBoolean(actionRequest,"rememberMe");
  String authType=preferences.getValue("authType",null);
  LoginUtil.login(request,response,login,password,rememberMe,authType);
  if (PropsValues.PORTAL_JAAS_ENABLE) {
    actionResponse.sendRedirect(themeDisplay.getPathMain() + "/portal/protected");
  }
 else {
    String redirect=ParamUtil.getString(actionRequest,"redirect");
    if (Validator.isNotNull(redirect)) {
      HttpSession session=request.getSession();
      Boolean httpsInitial=(Boolean)session.getAttribute(WebKeys.HTTPS_INITIAL);
      String portalURL=null;
      if ((PropsValues.COMPANY_SECURITY_AUTH_REQUIRES_HTTPS) && (!PropsValues.SESSION_ENABLE_PHISHING_PROTECTION) && (httpsInitial != null)&& (!httpsInitial.booleanValue())) {
        portalURL=PortalUtil.getPortalURL(request,false);
      }
 else {
        portalURL=PortalUtil.getPortalURL(request);
      }
      redirect=PortalUtil.escapeRedirect(redirect);
      redirect=portalURL.concat(redirect);
      actionResponse.sendRedirect(redirect);
    }
 else {
      boolean doActionAfterLogin=ParamUtil.getBoolean(actionRequest,"doActionAfterLogin");
      if (doActionAfterLogin) {
        return;
      }
 else {
        actionResponse.sendRedirect(themeDisplay.getPathMain());
      }
    }
  }
}
