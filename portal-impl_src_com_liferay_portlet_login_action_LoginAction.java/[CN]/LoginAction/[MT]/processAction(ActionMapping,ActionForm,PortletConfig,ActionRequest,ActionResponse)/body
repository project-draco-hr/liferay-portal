{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PortletConfigImpl portletConfigImpl=(PortletConfigImpl)portletConfig;
  String portletId=portletConfigImpl.getPortletId();
  PortletPreferences preferences=PortletPreferencesFactoryUtil.getPortletSetup(actionRequest,portletId);
  if (actionRequest.getRemoteUser() != null) {
    actionResponse.sendRedirect(themeDisplay.getPathMain());
    return;
  }
  try {
    login(themeDisplay,actionRequest,actionResponse,preferences);
  }
 catch (  Exception e) {
    if (e instanceof AuthException) {
      Throwable cause=e.getCause();
      if (cause instanceof PasswordExpiredException || cause instanceof UserLockoutException) {
        SessionErrors.add(actionRequest,cause.getClass().getName());
      }
 else {
        SessionErrors.add(actionRequest,e.getClass().getName());
      }
    }
 else     if (e instanceof CookieNotSupportedException || e instanceof NoSuchUserException || e instanceof PasswordExpiredException|| e instanceof UserEmailAddressException|| e instanceof UserIdException|| e instanceof UserLockoutException|| e instanceof UserPasswordException|| e instanceof UserScreenNameException) {
      SessionErrors.add(actionRequest,e.getClass().getName());
    }
 else {
      PortalUtil.sendError(e,actionRequest,actionResponse);
    }
  }
}
