{
  String resourceBundleClassName=_portlet.getResourceBundle();
  if (resourceBundleClassName == null) {
    String poolId=_portlet.getPortletId();
    ResourceBundle bundle=_bundlePool.get(poolId);
    if (bundle == null) {
      StringMaker sm=new StringMaker();
      try {
        PortletInfo portletInfo=_portlet.getPortletInfo();
        sm.append(JavaConstants.JAVAX_PORTLET_TITLE);
        sm.append("=");
        sm.append(portletInfo.getTitle());
        sm.append("\n");
        sm.append(JavaConstants.JAVAX_PORTLET_SHORT_TITLE);
        sm.append("=");
        sm.append(portletInfo.getShortTitle());
        sm.append("\n");
        sm.append(JavaConstants.JAVAX_PORTLET_KEYWORDS);
        sm.append("=");
        sm.append(portletInfo.getKeywords());
        sm.append("\n");
        bundle=new PropertyResourceBundle(new ByteArrayInputStream(sm.toString().getBytes()));
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
      _bundlePool.put(poolId,bundle);
    }
    return bundle;
  }
 else {
    String poolId=_portlet.getPortletId() + "." + locale.toString();
    ResourceBundle bundle=_bundlePool.get(poolId);
    if (bundle == null) {
      if (!_portletApp.isWARFile() && resourceBundleClassName.equals(StrutsResourceBundle.class.getName())) {
        long companyId=PortalInstances.getDefaultCompanyId();
        bundle=StrutsResourceBundle.getBundle(_portletName,companyId,locale);
      }
 else {
        PortletBag portletBag=PortletBagPool.get(_portlet.getRootPortletId());
        bundle=portletBag.getResourceBundle(locale);
      }
      bundle=new PortletResourceBundle(bundle,_portlet.getPortletInfo());
      _bundlePool.put(poolId,bundle);
    }
    return bundle;
  }
}
