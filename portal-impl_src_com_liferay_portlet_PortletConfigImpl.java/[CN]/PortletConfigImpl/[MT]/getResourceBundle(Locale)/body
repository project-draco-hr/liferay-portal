{
  String resourceBundleClassName=_portlet.getResourceBundle();
  if (Validator.isNull(resourceBundleClassName)) {
    String resourceBundleId=_portlet.getPortletId();
    ResourceBundle resourceBundle=_resourceBundles.get(resourceBundleId);
    if (resourceBundle == null) {
      StringBundler sb=new StringBundler(16);
      try {
        PortletInfo portletInfo=_portlet.getPortletInfo();
        sb.append(JavaConstants.JAVAX_PORTLET_TITLE);
        sb.append(StringPool.EQUAL);
        sb.append(portletInfo.getTitle());
        sb.append(StringPool.NEW_LINE);
        sb.append(JavaConstants.JAVAX_PORTLET_SHORT_TITLE);
        sb.append(StringPool.EQUAL);
        sb.append(portletInfo.getShortTitle());
        sb.append(StringPool.NEW_LINE);
        sb.append(JavaConstants.JAVAX_PORTLET_KEYWORDS);
        sb.append(StringPool.EQUAL);
        sb.append(portletInfo.getKeywords());
        sb.append(StringPool.NEW_LINE);
        sb.append(JavaConstants.JAVAX_PORTLET_DESCRIPTION);
        sb.append(StringPool.EQUAL);
        sb.append(portletInfo.getDescription());
        sb.append(StringPool.NEW_LINE);
        resourceBundle=new PropertyResourceBundle(sb.toString(),StringPool.UTF8);
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
      _resourceBundles.put(resourceBundleId,resourceBundle);
    }
    return resourceBundle;
  }
 else {
    StringBundler sb=new StringBundler(4);
    sb.append(_portlet.getPortletId());
    sb.append(locale.getLanguage());
    sb.append(locale.getCountry());
    sb.append(locale.getVariant());
    String resourceBundleId=sb.toString();
    ResourceBundle resourceBundle=_resourceBundles.get(resourceBundleId);
    if (resourceBundle == null) {
      if (!_portletApp.isWARFile() && resourceBundleClassName.equals(StrutsResourceBundle.class.getName())) {
        resourceBundle=new StrutsResourceBundle(_portletName,locale);
      }
 else {
        PortletBag portletBag=PortletBagPool.get(_portlet.getRootPortletId());
        resourceBundle=portletBag.getResourceBundle(locale);
      }
      resourceBundle=new PortletResourceBundle(resourceBundle,_portlet.getPortletInfo());
      _resourceBundles.put(resourceBundleId,resourceBundle);
    }
    return resourceBundle;
  }
}
