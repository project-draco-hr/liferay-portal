{
  String resourceBundleClassName=_portlet.getResourceBundle();
  ResourceBundle resourceBundle=null;
  if (Validator.isNull(resourceBundleClassName)) {
    String resourceBundleId=_portlet.getPortletId();
    resourceBundle=_resourceBundles.get(resourceBundleId);
    if (resourceBundle == null) {
      resourceBundle=new PortletResourceBundle(_portlet.getPortletInfo());
      _resourceBundles.put(resourceBundleId,resourceBundle);
    }
    return resourceBundle;
  }
  StringBundler sb=new StringBundler(4);
  sb.append(_portlet.getPortletId());
  sb.append(locale.getLanguage());
  sb.append(locale.getCountry());
  sb.append(locale.getVariant());
  if (resourceBundle == null) {
    if (!_portletApp.isWARFile() && resourceBundleClassName.equals(StrutsResourceBundle.class.getName())) {
      String resourceBundleId=sb.toString();
      resourceBundle=_resourceBundles.get(resourceBundleId);
      if (resourceBundle == null) {
        resourceBundle=new StrutsResourceBundle(_portletName,locale);
      }
      _resourceBundles.put(resourceBundleId,resourceBundle);
    }
 else {
      PortletBag portletBag=PortletBagPool.get(_portlet.getRootPortletId());
      resourceBundle=portletBag.getResourceBundle(locale);
    }
    resourceBundle=new PortletResourceBundle(resourceBundle,_portlet.getPortletInfo());
  }
  return resourceBundle;
}
