{
  User user=userPersistence.findByPrimaryKey(userId);
  long groupId=serviceContext.getScopeGroupId();
  Date now=new Date();
  validate(name);
  long frameworkVersionId=counterLocalService.increment();
  SCFrameworkVersion frameworkVersion=scFrameworkVersionPersistence.create(frameworkVersionId);
  frameworkVersion.setGroupId(groupId);
  frameworkVersion.setCompanyId(user.getCompanyId());
  frameworkVersion.setUserId(user.getUserId());
  frameworkVersion.setUserName(user.getFullName());
  frameworkVersion.setCreateDate(now);
  frameworkVersion.setModifiedDate(now);
  frameworkVersion.setName(name);
  frameworkVersion.setUrl(url);
  frameworkVersion.setActive(active);
  frameworkVersion.setPriority(priority);
  scFrameworkVersionPersistence.update(frameworkVersion,false);
  if (serviceContext.getAddCommunityPermissions() || serviceContext.getAddGuestPermissions()) {
    addFrameworkVersionResources(frameworkVersion,serviceContext.getAddCommunityPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addFrameworkVersionResources(frameworkVersion,serviceContext.getCommunityPermissions(),serviceContext.getGuestPermissions());
  }
  return frameworkVersion;
}
