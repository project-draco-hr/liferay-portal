{
  User user=userPersistence.findByPrimaryKey(userId);
  long groupId=serviceContext.getScopeGroupId();
  validate(name);
  long frameworkVersionId=counterLocalService.increment();
  SCFrameworkVersion frameworkVersion=scFrameworkVersionPersistence.create(frameworkVersionId);
  frameworkVersion.setGroupId(groupId);
  frameworkVersion.setCompanyId(user.getCompanyId());
  frameworkVersion.setUserId(user.getUserId());
  frameworkVersion.setUserName(user.getFullName());
  frameworkVersion.setName(name);
  frameworkVersion.setUrl(url);
  frameworkVersion.setActive(active);
  frameworkVersion.setPriority(priority);
  scFrameworkVersionPersistence.update(frameworkVersion);
  if (serviceContext.isAddGroupPermissions() || serviceContext.isAddGuestPermissions()) {
    addFrameworkVersionResources(frameworkVersion,serviceContext.isAddGroupPermissions(),serviceContext.isAddGuestPermissions());
  }
 else {
    addFrameworkVersionResources(frameworkVersion,serviceContext.getGroupPermissions(),serviceContext.getGuestPermissions());
  }
  return frameworkVersion;
}
