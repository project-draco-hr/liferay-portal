{
  if (actionId.equals(ActionKeys.ADD_FOLDER)) {
    actionId=ActionKeys.ADD_SUBFOLDER;
  }
  long folderId=folder.getFolderId();
  if (PropsValues.PERMISSIONS_VIEW_DYNAMIC_INHERITANCE) {
    long originalFolderId=folderId;
    try {
      while (folderId != BookmarksFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
        folder=BookmarksFolderLocalServiceUtil.getFolder(folderId);
        if (!permissionChecker.hasOwnerPermission(folder.getCompanyId(),BookmarksFolder.class.getName(),folder.getFolderId(),folder.getUserId(),actionId) && !permissionChecker.hasPermission(folder.getGroupId(),BookmarksFolder.class.getName(),folder.getFolderId(),actionId)) {
          return false;
        }
        folderId=folder.getParentFolderId();
      }
    }
 catch (    NoSuchFolderException nsfe) {
      if (!folder.isInTrash()) {
        throw nsfe;
      }
    }
    if (actionId.equals(ActionKeys.VIEW)) {
      return true;
    }
    folderId=originalFolderId;
  }
  try {
    while (folderId != BookmarksFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      folder=BookmarksFolderLocalServiceUtil.getFolder(folderId);
      if (permissionChecker.hasOwnerPermission(folder.getCompanyId(),BookmarksFolder.class.getName(),folder.getFolderId(),folder.getUserId(),actionId) || permissionChecker.hasPermission(folder.getGroupId(),BookmarksFolder.class.getName(),folder.getFolderId(),actionId)) {
        return true;
      }
      folderId=folder.getParentFolderId();
    }
  }
 catch (  NoSuchFolderException nsfe) {
    if (!folder.isInTrash()) {
      throw nsfe;
    }
  }
  return false;
}
