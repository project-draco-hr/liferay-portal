{
  if (actionId.equals(ActionKeys.ADD_FOLDER)) {
    actionId=ActionKeys.ADD_SUBFOLDER;
  }
  long folderId=folder.getFolderId();
  if (actionId.equals(ActionKeys.VIEW)) {
    while (folderId != BookmarksFolderImpl.DEFAULT_PARENT_FOLDER_ID) {
      folder=BookmarksFolderLocalServiceUtil.getFolder(folderId);
      folderId=folder.getParentFolderId();
      if (!permissionChecker.hasOwnerPermission(folder.getCompanyId(),BookmarksFolder.class.getName(),folder.getFolderId(),folder.getUserId(),actionId) && !permissionChecker.hasPermission(folder.getGroupId(),BookmarksFolder.class.getName(),folder.getFolderId(),actionId)) {
        return false;
      }
    }
    return true;
  }
 else {
    while (folderId != BookmarksFolderImpl.DEFAULT_PARENT_FOLDER_ID) {
      if (permissionChecker.hasOwnerPermission(folder.getCompanyId(),BookmarksFolder.class.getName(),folder.getFolderId(),folder.getUserId(),actionId)) {
        return true;
      }
      if (permissionChecker.hasPermission(folder.getGroupId(),BookmarksFolder.class.getName(),folder.getFolderId(),actionId)) {
        return true;
      }
      if (actionId.equals(ActionKeys.VIEW)) {
        break;
      }
      folder=BookmarksFolderLocalServiceUtil.getFolder(folderId);
      folderId=folder.getParentFolderId();
    }
    return false;
  }
}
