{
  if (actionId.equals(ActionKeys.ADD_FOLDER)) {
    actionId=ActionKeys.ADD_SUBFOLDER;
  }
  long folderId=folder.getFolderId();
  if (actionId.equals(ActionKeys.VIEW)) {
    while (folderId != BookmarksFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      try {
        folder=BookmarksFolderLocalServiceUtil.getFolder(folderId);
        folderId=folder.getParentFolderId();
        if (!permissionChecker.hasOwnerPermission(folder.getCompanyId(),BookmarksFolder.class.getName(),folder.getFolderId(),folder.getUserId(),actionId) && !permissionChecker.hasPermission(folder.getGroupId(),BookmarksFolder.class.getName(),folder.getFolderId(),actionId)) {
          return false;
        }
        if (!PropsValues.PERMISSIONS_VIEW_DYNAMIC_INHERITANCE) {
          break;
        }
      }
 catch (      NoSuchFolderException nsfe) {
        if (!folder.isInTrash()) {
          throw nsfe;
        }
      }
    }
    return true;
  }
 else {
    while (folderId != BookmarksFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      folder=BookmarksFolderLocalServiceUtil.getFolder(folderId);
      folderId=folder.getParentFolderId();
      if (permissionChecker.hasOwnerPermission(folder.getCompanyId(),BookmarksFolder.class.getName(),folder.getFolderId(),folder.getUserId(),actionId)) {
        return true;
      }
      if (permissionChecker.hasPermission(folder.getGroupId(),BookmarksFolder.class.getName(),folder.getFolderId(),actionId)) {
        return true;
      }
      if (actionId.equals(ActionKeys.VIEW)) {
        break;
      }
    }
    return false;
  }
}
