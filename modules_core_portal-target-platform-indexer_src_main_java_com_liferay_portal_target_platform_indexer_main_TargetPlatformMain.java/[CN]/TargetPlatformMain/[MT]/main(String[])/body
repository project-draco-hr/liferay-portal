{
  String moduleFrameworkBaseDir=System.getProperty("module.framework.base.dir");
  if (moduleFrameworkBaseDir == null) {
    System.err.println("== -Dmodule.framework.base.dir must point to a valid path");
    return;
  }
  String moduleFrameworkModulesDir=System.getProperty("module.framework.modules.dir");
  if (moduleFrameworkModulesDir == null) {
    moduleFrameworkModulesDir=moduleFrameworkBaseDir + "/modules/";
  }
  String moduleFrameworkPortalDir=System.getProperty("module.framework.portal.dir");
  if (moduleFrameworkPortalDir == null) {
    moduleFrameworkPortalDir=moduleFrameworkBaseDir + "/portal/";
  }
  Path tempPath=Files.createTempDirectory(null);
  File targetPlatformDir=new File(moduleFrameworkBaseDir,DIR_NAME_TARGET_PLATFORM);
  if (!targetPlatformDir.exists() && !targetPlatformDir.mkdirs()) {
    System.err.printf("== Unable to create directory %s\n",targetPlatformDir);
    return;
  }
  TargetPlatformMain targetPlatformMain=new TargetPlatformMain(moduleFrameworkBaseDir,moduleFrameworkModulesDir,moduleFrameworkPortalDir);
  try {
    File indexFile=targetPlatformMain.index(targetPlatformDir);
    System.out.println("== Wrote index file " + indexFile);
  }
  finally {
    PathUtil.deltree(tempPath);
  }
}
