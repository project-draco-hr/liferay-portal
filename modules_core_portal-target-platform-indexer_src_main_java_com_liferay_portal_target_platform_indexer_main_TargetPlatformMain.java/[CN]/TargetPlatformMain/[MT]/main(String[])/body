{
  FastDateFormatFactoryUtil fastDateFormatFactoryUtil=new FastDateFormatFactoryUtil();
  fastDateFormatFactoryUtil.setFastDateFormatFactory(new FastDateFormatFactoryImpl());
  FileUtil fileUtil=new FileUtil();
  fileUtil.setFile(new FileImpl());
  Path tempPath=Files.createTempDirectory(null);
  File tempDir=tempPath.toFile();
  com.liferay.portal.util.PropsUtil.set(PropsKeys.MODULE_FRAMEWORK_STATE_DIR,tempDir.getCanonicalPath());
  PropsUtil.setProps(new PropsImpl());
  String[] moduleFrameworkInitialBundles=PropsUtil.getArray(PropsKeys.MODULE_FRAMEWORK_INITIAL_BUNDLES);
  for (int i=0; i < moduleFrameworkInitialBundles.length; i++) {
    if (moduleFrameworkInitialBundles[i].endsWith("@start")) {
      moduleFrameworkInitialBundles[i]=moduleFrameworkInitialBundles[i].substring(0,moduleFrameworkInitialBundles[i].length() - 6);
    }
  }
  com.liferay.portal.util.PropsUtil.set(PropsKeys.MODULE_FRAMEWORK_INITIAL_BUNDLES,StringUtil.merge(moduleFrameworkInitialBundles));
  String bsn="com.liferay.target.platform";
  String version=ReleaseInfo.getVersion();
  File targetPlatformDir=new File(PropsValues.MODULE_FRAMEWORK_BASE_DIR,DIR_NAME_TARGET_PLATFORM);
  if (!targetPlatformDir.exists() && !targetPlatformDir.mkdirs()) {
    System.err.printf("== Cannot create directory %s\n",targetPlatformDir);
    return;
  }
  TargetPlatformMain targetPlatformIndexer=new TargetPlatformMain(bsn,version);
  try {
    File indexFile=targetPlatformIndexer.index(targetPlatformDir);
    System.out.println("== Wrote index file " + indexFile);
  }
  finally {
    PathUtil.deltree(tempPath);
  }
}
