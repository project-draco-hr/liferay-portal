{
  boolean hasLock=hasFileEntryLock(userId,fileEntryId);
  if (!hasLock) {
    lockFileEntry(userId,fileEntryId);
  }
  try {
    return moveFileEntryImpl(userId,fileEntryId,newFolderId,serviceContext);
  }
  finally {
    if (!isFileEntryCheckedOut(fileEntryId)) {
      unlockFileEntry(fileEntryId);
    }
  }
}
