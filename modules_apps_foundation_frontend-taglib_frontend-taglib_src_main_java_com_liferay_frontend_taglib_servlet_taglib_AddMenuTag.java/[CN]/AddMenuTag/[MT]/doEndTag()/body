{
  List<AddMenuItem> addMenuItems=(List<AddMenuItem>)request.getAttribute("liferay-frontend:add-menu:addMenuItems");
  if (ListUtil.isEmpty(addMenuItems)) {
    return SKIP_BODY;
  }
  _menuItemsCount=addMenuItems.size();
  List<MenuItemGroup> menuItemGroups=new ArrayList<>();
  if (_menuItemsCount == 1) {
    List<MenuItem> menuItems=new ArrayList<>();
    menuItems.addAll(getAddMenuItems());
    MenuItemGroup menuItem=new MenuItemGroup(AddMenuKeys.getAddMenuTypeLabel(AddMenuKeys.AddMenuType.DEFAULT),menuItems);
    menuItemGroups.add(menuItem);
    _menuItemGroups=menuItemGroups;
  }
 else {
    List<MenuItem> primaryMenuItems=new ArrayList<>();
    List<MenuItem> favoriteMenuItems=new ArrayList<>();
    List<MenuItem> recentMenuItems=new ArrayList<>();
    List<MenuItem> defaultMenuItems=new ArrayList<>();
    for (    AddMenuItem addMenuItem : getAddMenuItems()) {
      if (Objects.equals(AddMenuKeys.AddMenuType.DEFAULT,addMenuItem.getType())) {
        defaultMenuItems.add(addMenuItem);
      }
 else       if (Objects.equals(AddMenuKeys.AddMenuType.FAVORITE,addMenuItem.getType())) {
        favoriteMenuItems.add(addMenuItem);
      }
 else       if (Objects.equals(AddMenuKeys.AddMenuType.PRIMARY,addMenuItem.getType())) {
        primaryMenuItems.add(addMenuItem);
      }
 else       if (Objects.equals(AddMenuKeys.AddMenuType.RECENT,addMenuItem.getType())) {
        recentMenuItems.add(addMenuItem);
      }
    }
    boolean showDivider=false;
    if (!primaryMenuItems.isEmpty() && (!defaultMenuItems.isEmpty() || !favoriteMenuItems.isEmpty() || !recentMenuItems.isEmpty())) {
      showDivider=true;
    }
    menuItemGroups.add(new MenuItemGroup(primaryMenuItems,showDivider));
    showDivider=false;
    if ((primaryMenuItems.size() > 0) && !favoriteMenuItems.isEmpty() && (!recentMenuItems.isEmpty() || !defaultMenuItems.isEmpty())) {
      showDivider=true;
    }
    MenuItemGroup favoriteMenuItem=new MenuItemGroup(AddMenuKeys.getAddMenuTypeLabel(AddMenuKeys.AddMenuType.FAVORITE),favoriteMenuItems,showDivider);
    menuItemGroups.add(favoriteMenuItem);
    menuItemGroups.add(new MenuItemGroup(recentMenuItems));
    menuItemGroups.add(new MenuItemGroup(defaultMenuItems));
    _menuItemGroups=menuItemGroups;
    _numMenuItems=_maxItems;
    if (primaryMenuItems.size() > 0) {
      _numMenuItems+=primaryMenuItems.size();
      _menuItemsCount-=primaryMenuItems.size();
    }
  }
  return super.doEndTag();
}
