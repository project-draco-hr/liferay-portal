{
  String language=getDDMTemplateLanguage(fileName);
  fileName=FileUtil.stripExtension(fileName);
  String name=getName(fileName);
  String script=StringUtil.read(inputStream);
  setServiceContext(fileName);
  DDMStructure ddmStructure=_ddmStructureLocalService.getStructure(groupId,PortalUtil.getClassNameId(JournalArticle.class),ddmStructureKey);
  DDMTemplate ddmTemplate=_ddmTemplateLocalService.fetchTemplate(groupId,PortalUtil.getClassNameId(DDMStructure.class),getKey(fileName));
  if (ddmTemplate != null) {
    if (!developerModeEnabled) {
      if (_log.isInfoEnabled()) {
        _log.info("DDM template with name " + name + " and version "+ version+ " already exists");
      }
      return;
    }
    if (!updateModeEnabled) {
      _ddmTemplateLocalService.deleteTemplate(ddmTemplate);
    }
  }
  try {
    if (!updateModeEnabled || (ddmTemplate == null)) {
      ddmTemplate=_ddmTemplateLocalService.addTemplate(userId,groupId,PortalUtil.getClassNameId(DDMStructure.class),ddmStructure.getStructureId(),PortalUtil.getClassNameId(JournalArticle.class),getKey(fileName),getMap(name),null,DDMTemplateConstants.TEMPLATE_TYPE_DISPLAY,null,language,replaceFileEntryURL(script),false,false,null,null,serviceContext);
    }
 else {
      ddmTemplate=_ddmTemplateLocalService.updateTemplate(userId,ddmTemplate.getTemplateId(),PortalUtil.getClassNameId(DDMStructure.class),getMap(name),null,DDMTemplateConstants.TEMPLATE_TYPE_DISPLAY,null,language,replaceFileEntryURL(script),false,false,null,null,serviceContext);
    }
  }
 catch (  PortalException pe) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to import DDM template " + fileName,pe);
    }
    throw pe;
  }
  addJournalArticles(ddmStructureKey,ddmTemplate.getTemplateKey(),_JOURNAL_ARTICLES_DIR_NAME + fileName);
}
