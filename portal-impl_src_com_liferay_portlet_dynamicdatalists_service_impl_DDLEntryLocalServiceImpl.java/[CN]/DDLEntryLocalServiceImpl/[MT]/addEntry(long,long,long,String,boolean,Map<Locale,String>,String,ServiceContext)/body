{
  User user=userPersistence.findByPrimaryKey(userId);
  entryKey=entryKey.trim().toUpperCase();
  if (autoEntryKey) {
    entryKey=String.valueOf(counterLocalService.increment());
  }
  Date now=new Date();
  validate(groupId,ddmStructureId,entryKey,autoEntryKey,nameMap);
  long entryId=counterLocalService.increment();
  DDLEntry entry=ddlEntryPersistence.create(entryId);
  entry.setUuid(serviceContext.getUuid());
  entry.setGroupId(groupId);
  entry.setCompanyId(user.getCompanyId());
  entry.setUserId(user.getUserId());
  entry.setUserName(user.getFullName());
  entry.setCreateDate(serviceContext.getCreateDate(now));
  entry.setModifiedDate(serviceContext.getModifiedDate(now));
  entry.setDDMStructureId(ddmStructureId);
  entry.setEntryKey(entryKey);
  entry.setNameMap(nameMap);
  entry.setDescription(description);
  ddlEntryPersistence.update(entry,false);
  if (serviceContext.getAddCommunityPermissions() || serviceContext.getAddGuestPermissions()) {
    addEntryResources(entry,serviceContext.getAddCommunityPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addEntryResources(entry,serviceContext.getCommunityPermissions(),serviceContext.getGuestPermissions());
  }
  return entry;
}
