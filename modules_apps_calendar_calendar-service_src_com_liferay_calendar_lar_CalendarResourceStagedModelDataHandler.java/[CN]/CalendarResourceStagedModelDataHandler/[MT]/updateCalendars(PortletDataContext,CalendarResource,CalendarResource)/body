{
  Map<Long,Long> calendarIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(Calendar.class);
  List<Element> referenceElements=portletDataContext.getReferenceElements(calendarResource,Calendar.class);
  for (  Element referenceElement : referenceElements) {
    long calendarId=GetterUtil.getLong(referenceElement.attributeValue("class-pk"));
    Calendar calendar=CalendarLocalServiceUtil.fetchCalendar(MapUtil.getLong(calendarIds,calendarId));
    if (calendar != null) {
      calendar.setCalendarResourceId(importedCalendarResource.getCalendarResourceId());
      CalendarLocalServiceUtil.updateCalendar(calendar);
    }
  }
}
