{
  long rightCategoryId=leftCategoryId + 1;
  QueryPos qPos=QueryPos.getInstance(selectQuery);
  qPos.add(groupId);
  qPos.add(parentCategoryId);
  List<Long> categoryIds=selectQuery.list();
  for (  long categoryId : categoryIds) {
    rightCategoryId=rebuildTree(session,selectQuery,updateQuery,groupId,categoryId,rightCategoryId);
  }
  if (parentCategoryId > 0) {
    qPos=QueryPos.getInstance(updateQuery);
    qPos.add(leftCategoryId);
    qPos.add(rightCategoryId);
    qPos.add(parentCategoryId);
    updateQuery.executeUpdate();
  }
  return rightCategoryId + 1;
}
