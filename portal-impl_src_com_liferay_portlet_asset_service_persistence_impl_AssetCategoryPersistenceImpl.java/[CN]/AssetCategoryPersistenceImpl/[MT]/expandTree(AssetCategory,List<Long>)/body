{
  if (!rebuildTreeEnabled) {
    return;
  }
  long groupId=assetCategory.getGroupId();
  long lastRightCategoryId=getLastRightCategoryId(groupId,assetCategory.getParentCategoryId());
  long leftCategoryId=2;
  long rightCategoryId=3;
  if (lastRightCategoryId > 0) {
    leftCategoryId=lastRightCategoryId + 1;
    long childrenDistance=assetCategory.getRightCategoryId() - assetCategory.getLeftCategoryId();
    if (childrenDistance > 1) {
      rightCategoryId=leftCategoryId + childrenDistance;
      updateChildrenTree(groupId,childrenCategoryIds,leftCategoryId - assetCategory.getLeftCategoryId());
      expandNoChildrenLeftCategoryId(groupId,lastRightCategoryId,childrenCategoryIds,childrenDistance + 1);
      expandNoChildrenRightCategoryId(groupId,lastRightCategoryId,childrenCategoryIds,childrenDistance + 1);
    }
 else {
      rightCategoryId=lastRightCategoryId + 2;
      expandTreeLeftCategoryId.expand(groupId,lastRightCategoryId);
      expandTreeRightCategoryId.expand(groupId,lastRightCategoryId);
    }
    if (_HIBERNATE_CACHE_USE_SECOND_LEVEL_CACHE) {
      CacheRegistryUtil.clear(AssetCategoryImpl.class.getName());
    }
    EntityCacheUtil.clearCache(AssetCategoryImpl.class);
    FinderCacheUtil.clearCache(FINDER_CLASS_NAME_ENTITY);
    FinderCacheUtil.clearCache(FINDER_CLASS_NAME_LIST_WITHOUT_PAGINATION);
    if (_SPRING_HIBERNATE_SESSION_DELEGATED) {
      Session session=getCurrentSession();
      session.clear();
    }
  }
  assetCategory.setLeftCategoryId(leftCategoryId);
  assetCategory.setRightCategoryId(rightCategoryId);
}
