{
  if (!rebuildTreeEnabled) {
    return;
  }
  if (force || (countOrphanTreeNodes(groupId) > 0)) {
    Session session=null;
    try {
      session=openSession();
      if (session.isDirty()) {
        session.flush();
      }
      SQLQuery selectQuery=session.createSQLQuery("SELECT categoryId FROM AssetCategory WHERE groupId = ? AND parentCategoryId = ? ORDER BY categoryId ASC");
      selectQuery.addScalar("categoryId",com.liferay.portal.kernel.dao.orm.Type.LONG);
      SQLQuery updateQuery=session.createSQLQuery("UPDATE AssetCategory SET leftCategoryId = ?, rightCategoryId = ? WHERE categoryId = ?");
      rebuildTree(session,selectQuery,updateQuery,groupId,0,0);
    }
 catch (    Exception e) {
      throw processException(e);
    }
 finally {
      closeSession(session);
    }
    clearCache();
  }
}
