{
  if (actionId.equals(ActionKeys.IMPERSONATE) && PortalUtil.isOmniadmin(userId) && !permissionChecker.isOmniadmin()) {
    return false;
  }
  try {
    User user=null;
    if (userId != ResourceConstants.PRIMKEY_DNE) {
      user=UserLocalServiceUtil.getUserById(userId);
      Contact contact=user.getContact();
      if ((((PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 5) || (PropsValues.PERMISSIONS_USER_CHECK_ALGORITHM == 6)) && (permissionChecker.hasOwnerPermission(permissionChecker.getCompanyId(),User.class.getName(),userId,contact.getUserId(),actionId))) || (permissionChecker.getUserId() == userId)) {
        return true;
      }
    }
    if (permissionChecker.hasPermission(0,User.class.getName(),userId,actionId)) {
      return true;
    }
    if (user != null) {
      if (organizationIds == null) {
        organizationIds=user.getOrganizationIds();
      }
      for (      long organizationId : organizationIds) {
        if (OrganizationPermissionUtil.contains(permissionChecker,organizationId,ActionKeys.MANAGE_USERS)) {
          return true;
        }
      }
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  return false;
}
