{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String portletResourceNamespace=ParamUtil.getString(portletRequest,DDMConstants.PORTLET_RESOURCE_NAMESPACE);
  long classNameId=ParamUtil.getLong(portletRequest,DDMConstants.CLASS_NAME_ID);
  long classPK=ParamUtil.getLong(portletRequest,DDMConstants.CLASS_PK);
  String structureAvailableFields=ParamUtil.getString(portletRequest,DDMConstants.STRUCTURE_AVAILABLE_FIELDS);
  PortletURLImpl portletURL=new PortletURLImpl(portletRequest,PortletKeys.DYNAMIC_DATA_MAPPING,themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  portletURL.setParameter(DDMConstants.MVC_PATH,"/edit_template.jsp");
  portletURL.setParameter(DDMConstants.REDIRECT,redirect,false);
  portletURL.setParameter(DDMConstants.PORTLET_RESOURCE_NAMESPACE,portletResourceNamespace,false);
  portletURL.setParameter(DDMConstants.TEMPLATE_ID,String.valueOf(template.getTemplateId()),false);
  portletURL.setParameter(DDMConstants.GROUP_ID,String.valueOf(template.getGroupId()),false);
  portletURL.setParameter(DDMConstants.CLASS_NAME_ID,String.valueOf(classNameId),false);
  portletURL.setParameter(DDMConstants.CLASS_PK,String.valueOf(classPK),false);
  portletURL.setParameter(DDMConstants.TYPE,template.getType(),false);
  portletURL.setParameter(DDMConstants.STRUCTURE_AVAILABLE_FIELDS,structureAvailableFields,false);
  portletURL.setWindowState(portletRequest.getWindowState());
  return portletURL.toString();
}
