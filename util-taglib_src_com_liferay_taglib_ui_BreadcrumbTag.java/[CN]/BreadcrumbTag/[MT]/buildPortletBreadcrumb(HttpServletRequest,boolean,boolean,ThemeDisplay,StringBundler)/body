{
  List<BreadcrumbEntry> breadcrumbEntries=PortalUtil.getPortletBreadcrumbs(request);
  if (breadcrumbEntries == null) {
    return;
  }
  for (int i=0; i < breadcrumbEntries.size(); i++) {
    BreadcrumbEntry breadcrumbEntry=breadcrumbEntries.get(i);
    Map<String,Object> data=breadcrumbEntry.getData();
    String breadcrumbTitle=breadcrumbEntry.getTitle();
    String breadcrumbURL=breadcrumbEntry.getURL();
    if (!showCurrentGroup) {
      String siteGroupName=themeDisplay.getSiteGroupName();
      if (siteGroupName.equals(breadcrumbTitle)) {
        continue;
      }
    }
    if (!showCurrentPortlet) {
      PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
      String portletTitle=PortalUtil.getPortletTitle(portletDisplay.getId(),themeDisplay.getUser());
      if (portletTitle.equals(breadcrumbTitle)) {
        continue;
      }
    }
    if (!CookieKeys.hasSessionId(request) && Validator.isNotNull(breadcrumbURL)) {
      HttpSession session=request.getSession();
      breadcrumbURL=PortalUtil.getURLWithSessionId(breadcrumbURL,session.getId());
    }
    sb.append("<li>");
    if (i < (breadcrumbEntries.size() - 1)) {
      if (Validator.isNotNull(breadcrumbURL)) {
        sb.append("<a href=\"");
        sb.append(HtmlUtil.escape(breadcrumbURL));
        sb.append("\"");
        sb.append(AUIUtil.buildData(data));
        sb.append(">");
      }
      sb.append(HtmlUtil.escape(breadcrumbTitle));
      if (Validator.isNotNull(breadcrumbURL)) {
        sb.append("</a>");
      }
      sb.append("<span class=\"divider\">/</span>");
    }
 else {
      sb.append(HtmlUtil.escape(breadcrumbTitle));
    }
    sb.append("</li>");
  }
}
