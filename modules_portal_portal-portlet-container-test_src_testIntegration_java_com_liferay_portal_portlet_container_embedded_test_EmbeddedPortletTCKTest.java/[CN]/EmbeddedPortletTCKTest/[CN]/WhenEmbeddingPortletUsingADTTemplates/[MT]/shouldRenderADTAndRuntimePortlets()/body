{
  TestPortlet adtPortlet=new TestPortlet(map){
    @Override public void render(    RenderRequest renderRequest,    RenderResponse renderResponse) throws IOException, PortletException {
      map.put("render",Boolean.TRUE.toString());
      PortletContext portletContext=getPortletContext();
      PortletRequestDispatcher portletRequestDispatcher=portletContext.getRequestDispatcher("/view.jsp");
      portletRequestDispatcher.include(renderRequest,renderResponse);
    }
  }
;
  properties.put("com.liferay.portlet.instanceable",Boolean.FALSE.toString());
  setUpPortlet(adtPortlet,properties,TEST_PORTLET_ID);
  properties.put("javax.portlet.name",TEST_PORTLET_ID);
  registerService(TemplateHandler.class,new TestEmbeddedPortletDisplayTemplateHandler(),properties);
  HttpServletRequest httpServletRequest=getHttpServletRequest();
  PortletURL portletURL=new PortletURLImpl(httpServletRequest,TEST_PORTLET_ID,layout.getPlid(),PortletRequest.RENDER_PHASE);
  TestPortlet testRuntimePortlet=new TestPortlet(map){
    @Override public void render(    RenderRequest renderRequest,    RenderResponse renderResponse) throws IOException, PortletException {
      map.put("runtime",Boolean.TRUE.toString());
    }
  }
;
  String testRuntimePortletId="testRuntimePortletId";
  setUpPortlet(testRuntimePortlet,properties,testRuntimePortletId,false);
  portletURL.setParameter("testRuntimePortletId",testRuntimePortletId);
  Map<String,List<String>> responseMap=request(portletURL.toString());
  Assert.assertEquals("200",getString(responseMap,"code"));
  Assert.assertTrue(map.containsKey("render"));
  Assert.assertTrue(map.containsKey("runtime"));
}
