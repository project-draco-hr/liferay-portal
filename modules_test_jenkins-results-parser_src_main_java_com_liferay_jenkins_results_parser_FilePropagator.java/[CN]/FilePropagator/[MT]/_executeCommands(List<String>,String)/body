{
  File shellFile=_writeShellFile(commands,targetSlave);
  try {
    FileSystem fileSystem=FileSystems.getDefault();
    System.out.println("Executing commands:\n" + new String(Files.readAllBytes(fileSystem.getPath(shellFile.getAbsolutePath()))));
    String errorText=null;
    Integer exitCode=null;
    Process process=null;
    long start=System.currentTimeMillis();
    while (exitCode == null) {
      try {
        process=Runtime.getRuntime().exec("./" + shellFile.getName());
      }
 catch (      IOException ioe) {
        if (ioe.getMessage().contains("Text file busy") && (System.currentTimeMillis() - start) < 2000) {
          JenkinsResultsParserUtil.sleep(100);
          continue;
        }
        throw ioe;
      }
      errorText=_readInputStream(process.getErrorStream());
      if (errorText.contains("No buffer space available") || errorText.contains("Temporary failure in name resolution")) {
        System.out.println(errorText + "\nRetry in 1 minute.");
        JenkinsResultsParserUtil.sleep(1000 * 60);
        continue;
      }
      try {
        exitCode=process.waitFor();
      }
 catch (      InterruptedException ie) {
        throw new RuntimeException(ie);
      }
      process.destroy();
    }
    errorText=errorText.trim();
    if (!errorText.isEmpty()) {
      System.out.println(errorText);
    }
    return exitCode;
  }
  finally {
    if (shellFile.exists()) {
      shellFile.delete();
    }
  }
}
