{
  ExecutorService executorService=Executors.newFixedThreadPool(threadCount);
  System.out.println("File Propagation starting with " + threadCount + " threads.");
  try {
    long start=System.currentTimeMillis();
    while (!_targetSlaves.isEmpty() || !_busySlaves.isEmpty()) {
synchronized (this) {
        for (        String sourceSlave : _sourceSlaves) {
          if (_targetSlaves.isEmpty()) {
            break;
          }
          String targetSlave=_targetSlaves.remove(0);
          executorService.execute(new FilePropagatorThread(this,sourceSlave,targetSlave));
          _busySlaves.add(sourceSlave);
          _busySlaves.add(targetSlave);
        }
        _sourceSlaves.removeAll(_busySlaves);
      }
      StringBuffer sb=new StringBuffer();
      sb.append("Busy slaves:");
      sb.append(Integer.toString(_busySlaves.size()));
      sb.append("\nSource slaves:");
      sb.append(Integer.toString(_sourceSlaves.size()));
      sb.append("\nTarget slaves:");
      sb.append(Integer.toString(_targetSlaves.size()));
      sb.append("\nTotal duration: ");
      sb.append(Long.toString((System.currentTimeMillis() - start)));
      sb.append("\nAverage thread duration: ");
      sb.append(Long.toString(getAverageThreadDuration()));
      sb.append("ms\n");
      System.out.println(sb.toString());
      JenkinsResultsParserUtil.sleep(5000);
    }
    StringBuffer sb=new StringBuffer();
    sb.append("File Propagation complete.\nTotal duration: ");
    sb.append(Long.toString(System.currentTimeMillis() - start));
    sb.append("ms\n");
    sb.append("Average thread duration: ");
    sb.append(Long.toString(getAverageThreadDuration()));
    sb.append("ms\n");
    sb.append(Integer.toString(_errorSlaves.size()));
    sb.append(" failures occurred.\n");
    if (_errorSlaves.size() > 0) {
      sb.append("Slaves that failed to respond:\n");
      sb.append(_errorSlaves.toString());
    }
    System.out.println(sb.toString());
  }
  finally {
    executorService.shutdown();
  }
}
