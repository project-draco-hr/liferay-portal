{
  Registry registry=RegistryUtil.getRegistry();
  AtomicInteger addingState=new AtomicInteger(0);
  AtomicInteger midifiedState=new AtomicInteger(0);
  AtomicInteger removedState=new AtomicInteger(0);
  ServiceTracker<Foo,Foo> serviceTracker=registry.trackServices(Foo.class,new FooServiceTracker(addingState,midifiedState,removedState));
  serviceTracker.open();
  ServiceRegistration<Foo> serviceRegistration=registry.registerService(Foo.class,new Foo(){
  }
);
  Assert.assertEquals(1,addingState.get());
  serviceRegistration.setProperties(Collections.<String,Object>emptyMap());
  Assert.assertEquals(1,midifiedState.get());
  serviceRegistration.unregister();
  Assert.assertEquals(1,removedState.get());
}
