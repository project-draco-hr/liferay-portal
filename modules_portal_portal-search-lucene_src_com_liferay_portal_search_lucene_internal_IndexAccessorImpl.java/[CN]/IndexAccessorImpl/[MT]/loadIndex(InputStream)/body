{
  File tempFile=FileUtil.createTempFile();
  try (Directory tempDirectory=FSDirectory.open(tempFile)){
    IndexCommitSerializationUtil.deserializeIndex(inputStream,tempDirectory);
    _deleteDirectory();
    try (IndexReader indexReader=IndexReader.open(tempDirectory,false)){
      if (indexReader.numDocs() > 0) {
        try (IndexSearcher indexSearcher=new IndexSearcher(indexReader)){
          TopDocs topDocs=indexSearcher.search(new MatchAllDocsQuery(),indexReader.numDocs());
          ScoreDoc[] scoreDocs=topDocs.scoreDocs;
          for (          ScoreDoc scoreDoc : scoreDocs) {
            Document document=indexSearcher.doc(scoreDoc.doc);
            addDocument(document);
          }
        }
 catch (        IllegalArgumentException iae) {
          if (_log.isDebugEnabled()) {
            _log.debug(iae.getMessage());
          }
        }
      }
      indexReader.flush();
    }
   }
   FileUtil.deltree(tempFile);
}
