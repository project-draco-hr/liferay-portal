{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long plid=ParamUtil.getLong(req,"plid");
  long groupId=ParamUtil.getLong(req,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(req,"privateLayout");
  long layoutId=ParamUtil.getLong(req,"layoutId");
  long parentLayoutId=ParamUtil.getLong(req,"parentLayoutId");
  Layout layout=null;
  if (plid > 0) {
    layout=LayoutLocalServiceUtil.getLayout(plid);
  }
 else   if (layoutId > 0) {
    layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,layoutId);
  }
 else   if (parentLayoutId > 0) {
    layout=LayoutLocalServiceUtil.getLayout(groupId,privateLayout,parentLayoutId);
  }
  if (layout != null) {
    if (!LayoutPermissionUtil.contains(permissionChecker,layout,ActionKeys.UPDATE)) {
      return null;
    }
  }
 else {
    if (!GroupPermissionUtil.contains(permissionChecker,groupId,ActionKeys.MANAGE_LAYOUTS)) {
      return null;
    }
  }
  String cmd=ParamUtil.getString(req,Constants.CMD);
  JSONObject jsonObj=new JSONObject();
  if (cmd.equals("add")) {
    String[] array=addPage(themeDisplay,req,res);
    jsonObj.put("layoutId",array[0]);
    jsonObj.put("url",array[1]);
  }
 else   if (cmd.equals("delete")) {
    CommunitiesUtil.deleteLayout(req,res);
  }
 else   if (cmd.equals("display_order")) {
    updateDisplayOrder(req);
  }
 else   if (cmd.equals("name")) {
    updateName(req);
  }
 else   if (cmd.equals("parent_layout_id")) {
    updateParentLayoutId(req);
  }
 else   if (cmd.equals("priority")) {
    updatePriority(req);
  }
  return jsonObj.toString();
}
