{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  long groupId=ParamUtil.getLong(req,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(req,"privateLayout");
  long parentLayoutId=ParamUtil.getLong(req,"parentLayoutId");
  if (!LayoutPermissionUtil.contains(permissionChecker,groupId,privateLayout,parentLayoutId,ActionKeys.UPDATE)) {
    return null;
  }
  String cmd=ParamUtil.getString(req,Constants.CMD);
  JSONObject jsonObj=new JSONObject();
  if (cmd.equals("add")) {
    String[] array=addPage(themeDisplay,req,res);
    jsonObj.put("layoutId",array[0]);
    jsonObj.put("url",array[1]);
  }
 else   if (cmd.equals("delete")) {
    CommunitiesUtil.deleteLayout(req,res);
  }
 else   if (cmd.equals("display_order")) {
    updateDisplayOrder(req);
  }
 else   if (cmd.equals("name")) {
    updateName(req);
  }
 else   if (cmd.equals("parent_layout_id")) {
    updateParentLayoutId(req);
  }
 else   if (cmd.equals("priority")) {
    updatePriority(req);
  }
  return jsonObj.toString();
}
