{
  Store store=null;
  Folder inboxFolder=null;
  Message[] messages=null;
  try {
    store=getStore();
    inboxFolder=getInboxFolder(store);
    messages=inboxFolder.getMessages();
    notifyMessageListeners(messages);
  }
  finally {
    if (inboxFolder != null) {
      if (messages != null) {
        if (_log.isDebugEnabled()) {
          _log.debug("Deleting messages");
        }
        inboxFolder.setFlags(messages,new Flags(Flags.Flag.DELETED),true);
      }
      inboxFolder.close(true);
    }
    if (store != null) {
      store.close();
    }
  }
}
