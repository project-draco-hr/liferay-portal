{
  Calendar cal=Calendar.getInstance();
  cal.add(Calendar.MINUTE,1);
  Date expiration=cal.getTime();
  while (!_fileEntries.isEmpty()) {
    Date now=new Date();
    if (now.after(expiration)) {
      break;
    }
    FileEntry fileEntry=_fileEntries.remove(0);
    try {
      if (fileEntry.getExtension().equals("pdf")) {
        InputStream is=DLRepositoryLocalServiceUtil.getFileAsStream(fileEntry.getUserId(),fileEntry.getFileEntryId(),fileEntry.getVersion());
        _generateThumbnail(fileEntry,is);
      }
 else       if (PrefsPropsUtil.getBoolean(PropsKeys.OPENOFFICE_SERVER_ENABLED,PropsValues.OPENOFFICE_SERVER_ENABLED)) {
        InputStream is=DLRepositoryLocalServiceUtil.getFileAsStream(fileEntry.getUserId(),fileEntry.getFileEntryId(),fileEntry.getVersion());
        String id=DLUtil.getTempFileId(fileEntry.getFileEntryId(),fileEntry.getVersion());
        File file=DocumentConversionUtil.convertToFile(id,is,fileEntry.getExtension(),"pdf");
        _generateThumbnail(fileEntry,file);
      }
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
}
