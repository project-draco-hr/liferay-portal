{
  Calendar cal=Calendar.getInstance();
  cal.add(Calendar.MINUTE,1);
  Date expiration=cal.getTime();
  while (!_fileEntries.isEmpty()) {
    Date now=new Date();
    if (now.after(expiration)) {
      break;
    }
    FileEntry fileEntry=_fileEntries.remove(0);
    try {
      String extension=fileEntry.getExtension();
      if (extension.equals("pdf")) {
        InputStream inputStream=DLRepositoryLocalServiceUtil.getFileAsStream(fileEntry.getUserId(),fileEntry.getFileEntryId(),fileEntry.getVersion());
        _generateThumbnail(fileEntry,inputStream);
      }
 else       if (PrefsPropsUtil.getBoolean(PropsKeys.OPENOFFICE_SERVER_ENABLED,PropsValues.OPENOFFICE_SERVER_ENABLED)) {
        InputStream inputStream=DLRepositoryLocalServiceUtil.getFileAsStream(fileEntry.getUserId(),fileEntry.getFileEntryId(),fileEntry.getVersion());
        String id=DLUtil.getTempFileId(fileEntry.getFileEntryId(),fileEntry.getVersion());
        File file=DocumentConversionUtil.convert(id,inputStream,fileEntry.getExtension(),"pdf");
        _generateThumbnail(fileEntry,file);
      }
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
}
