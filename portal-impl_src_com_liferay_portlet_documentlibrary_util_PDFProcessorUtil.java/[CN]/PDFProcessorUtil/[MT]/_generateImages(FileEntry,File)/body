{
  if (PropsValues.IMAGEMAGICK_ENABLED) {
    String id=DLUtil.getTempFileId(fileEntry.getFileEntryId(),fileEntry.getVersion());
    if (_isGeneratePreview(id)) {
      _generateImagesIM(file,id,PropsValues.DL_FILE_ENTRY_PREVIEW_DEPTH,PropsValues.DL_FILE_ENTRY_PREVIEW_DPI,PropsValues.DL_FILE_ENTRY_PREVIEW_HEIGHT,PropsValues.DL_FILE_ENTRY_PREVIEW_WIDTH,false);
      File singlePagePreviewFile=_getPreviewFile(id,-1);
      if (singlePagePreviewFile.exists()) {
        singlePagePreviewFile.renameTo(_getPreviewFile(id,1));
      }
      if (_log.isInfoEnabled()) {
        _log.info("ImageMagick generated " + _getPreviewFileCount(fileEntry) + " preview pages for "+ id);
      }
    }
    if (_isGenerateThumbnail(id)) {
      _generateImagesIM(file,id,PropsValues.DL_FILE_ENTRY_THUMBNAIL_DEPTH,PropsValues.DL_FILE_ENTRY_THUMBNAIL_DPI,PropsValues.DL_FILE_ENTRY_THUMBNAIL_HEIGHT,PropsValues.DL_FILE_ENTRY_THUMBNAIL_WIDTH,true);
      if (_log.isInfoEnabled()) {
        _log.info("ImageMagick generated a thumbnail for " + id);
      }
    }
  }
 else {
    _generateImages(fileEntry,new FileInputStream(file));
  }
}
