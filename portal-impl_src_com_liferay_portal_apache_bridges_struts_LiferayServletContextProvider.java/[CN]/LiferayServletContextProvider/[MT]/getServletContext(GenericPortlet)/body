{
  PortletContext portletContext=portlet.getPortletContext();
  ServletContext servletContext=HttpServletUtil.getServletContext(portletContext);
  if (servletContext == null) {
    PortletContextImpl portletContextImpl=(PortletContextImpl)portlet.getPortletContext();
    servletContext=portletContextImpl.getServletContext();
  }
  return getServletContext(servletContext);
}
