{
  HttpServletRequest request=null;
  if (portletRequest instanceof ActionRequestImpl) {
    request=PortalUtil.getHttpServletRequest(portletRequest);
    String contentType=request.getHeader(HttpHeaders.CONTENT_TYPE);
    if ((contentType != null) && (contentType.startsWith(ContentTypes.MULTIPART_FORM_DATA))) {
      request=new UploadServletRequestImpl(request);
      request=new LiferayStrutsRequestImpl(request);
    }
 else {
      request=new LiferayStrutsRequestImpl((ActionRequestImpl)portletRequest);
    }
  }
 else {
    request=new LiferayStrutsRequestImpl((RenderRequestImpl)portletRequest);
  }
  return request;
}
