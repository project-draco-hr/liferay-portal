{
  HttpServletRequest httpReq=null;
  if (req instanceof ActionRequestImpl) {
    httpReq=PortalUtil.getHttpServletRequest(req);
    String contentType=httpReq.getHeader(HttpHeaders.CONTENT_TYPE);
    if ((contentType != null) && (contentType.startsWith(ContentTypes.MULTIPART_FORM_DATA))) {
      httpReq=new UploadServletRequestImpl(httpReq);
      httpReq=new LiferayStrutsRequestImpl(httpReq);
    }
 else {
      httpReq=new LiferayStrutsRequestImpl((ActionRequestImpl)req);
    }
  }
 else {
    httpReq=new LiferayStrutsRequestImpl((RenderRequestImpl)req);
  }
  return httpReq;
}
