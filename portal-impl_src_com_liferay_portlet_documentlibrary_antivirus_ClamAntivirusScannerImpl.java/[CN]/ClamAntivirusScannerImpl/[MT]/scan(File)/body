{
  String filePath=file.getAbsolutePath();
  ProcessBuilder processBuilder=new ProcessBuilder("clamscan","--stdout","--no-summary",filePath);
  processBuilder.redirectErrorStream(true);
  Process process=null;
  try {
    process=processBuilder.start();
    InputStream inputStream=process.getInputStream();
    String scanResult=StringUtil.read(inputStream);
    process.waitFor();
    int exitValue=process.exitValue();
    if (exitValue != 0) {
      throw new AntivirusScannerException("Unable to scan file due to inability to execute " + "antivirus process");
    }
    if (scanResult.contains("FOUND")) {
      throw new AntivirusScannerException("Virus detected in " + filePath);
    }
  }
 catch (  IOException ioe) {
    throw new SystemException("Unable to scan file",ioe);
  }
catch (  InterruptedException ie) {
    throw new SystemException("Unable to scan file",ie);
  }
 finally {
    if (process != null) {
      process.destroy();
    }
  }
}
