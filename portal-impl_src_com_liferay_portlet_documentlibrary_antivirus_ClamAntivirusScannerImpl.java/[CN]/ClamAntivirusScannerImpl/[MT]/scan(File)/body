{
  Process process=null;
  try {
    ProcessBuilder processBuilder=new ProcessBuilder("clamscan","--stdout","--no-summary",file.getAbsolutePath());
    processBuilder.redirectErrorStream(true);
    process=processBuilder.start();
    process.waitFor();
    int exitValue=process.exitValue();
    if (exitValue == 1) {
      throw new AntivirusScannerException("Virus detected in " + file.getAbsolutePath(),AntivirusScannerException.VIRUS_DETECTED);
    }
 else     if (exitValue >= 2) {
      throw new AntivirusScannerException(AntivirusScannerException.PROCESS_FAILURE);
    }
  }
 catch (  AntivirusScannerException ase) {
    throw ase;
  }
catch (  Exception e) {
    throw new AntivirusScannerException(AntivirusScannerException.PROCESS_FAILURE);
  }
 finally {
    if (process != null) {
      process.destroy();
    }
  }
}
