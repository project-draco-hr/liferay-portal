{
  ProcessBuilder processBuilder=new ProcessBuilder("clamscan","--stdout","--no-summary",file.getAbsolutePath());
  processBuilder.redirectErrorStream(true);
  Process process=null;
  try {
    process=processBuilder.start();
    process.waitFor();
    int exitValue=process.exitValue();
    if (exitValue == 1) {
      throw new AntivirusScannerException("Virus detected in " + file.getAbsolutePath());
    }
 else     if (exitValue >= 2) {
      throw new AntivirusScannerException("Unable to scan file due to inability to execute " + "antivirus process");
    }
  }
 catch (  IOException ioe) {
    throw new SystemException("Unable to scan file",ioe);
  }
catch (  InterruptedException ie) {
    throw new SystemException("Unable to scan file",ie);
  }
 finally {
    if (process != null) {
      process.destroy();
    }
  }
}
