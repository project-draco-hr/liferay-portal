{
  AccessControlUtil.initAccessControlContext(request,response);
  AuthVerifierResult.State state=AccessControlUtil.verifyRequest();
  AccessControlContext accessControlContext=AccessControlUtil.getAccessControlContext();
  AuthVerifierResult authVerifierResult=accessControlContext.getAuthVerifierResult();
  if (_log.isDebugEnabled()) {
    _log.debug("Auth verifier result " + authVerifierResult);
  }
  if (state == AuthVerifierResult.State.INVALID_CREDENTIALS) {
    if (_log.isDebugEnabled()) {
      _log.debug("Result state doesn't allow us to continue.");
    }
  }
 else   if (state == AuthVerifierResult.State.NOT_APPLICABLE) {
  }
 else   if (state == AuthVerifierResult.State.SUCCESS) {
    long userId=authVerifierResult.getUserId();
    AccessControlUtil.initContextUser(userId);
    ProtectedServletRequest protectedServletRequest=new ProtectedServletRequest(request,String.valueOf(userId));
    accessControlContext.setRequest(protectedServletRequest);
    processFilter(getClass(),protectedServletRequest,response,filterChain);
  }
 else {
    _log.error("Unimplemented state " + state);
  }
}
