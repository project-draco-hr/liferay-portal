{
  int pos=masterXml.indexOf("<!DOCTYPE");
  String masterDoctype="";
  if (pos >= 0) {
    masterDoctype=masterXml.substring(pos,masterXml.indexOf(">",pos) + 1);
    masterXml=StringUtil.replace(masterXml,masterDoctype,"");
  }
  pos=slaveXml.indexOf("<!DOCTYPE");
  String slaveDoctype="";
  if (pos >= 0) {
    slaveDoctype=slaveXml.substring(pos,slaveXml.indexOf(">",pos) + 1);
    slaveXml=StringUtil.replace(slaveXml,slaveDoctype,"");
  }
  String doctype=null;
  if (Validator.isNotNull(masterDoctype)) {
    doctype=masterDoctype;
  }
 else {
    doctype=slaveDoctype;
  }
  SAXReader reader=new SAXReader();
  Document masterDoc=reader.read(new StringReader(masterXml));
  Document slaveDoc=reader.read(new StringReader(slaveXml));
  XMLDescriptor descriptor=null;
  if (_descriptorClassName.equals(_AUTO_DESCRIPTOR)) {
    descriptor=XMLTypeDetector.determineType(doctype,masterDoc);
  }
 else {
    descriptor=(XMLDescriptor)Class.forName(_descriptorClassName).newInstance();
  }
  XMLMerger merger=new XMLMerger(descriptor);
  Document mergedDoc=merger.merge(masterDoc,slaveDoc);
  return _documentToString(mergedDoc,doctype);
}
