{
  XMLSecurityTest xmlReaderTest=new XMLSecurityTest(){
    @Override public void run(    String xml) throws Exception {
      XMLReader xmlReader=_secureXMLFactoryProvider.newXMLReader();
      if (xmlReader instanceof StripDoctypeXMLReader) {
        xmlReader=((StripDoctypeXMLReader)xmlReader).getXmlReader();
      }
      xmlReader.setContentHandler(new DefaultHandler(){
        @Override public void characters(        char[] ch,        int start,        int length){
          _contentLenght+=length;
          if (_contentLenght > (1024 * 1024 * 10)) {
            throw new OutOfMemoryError();
          }
        }
        private int _contentLenght;
      }
);
      xmlReader.parse(new InputSource(new StringReader(xml)));
    }
  }
;
  runXMLSecurityTest(xmlReaderTest,_xmlBombBillionLaughsXML,OutOfMemoryError.class,"Billion Laughs XML attack does not work.",SAXParseException.class,"Vulnerable to Billion Laughs XML attack.");
  runXMLSecurityTest(xmlReaderTest,_xmlBombQuadraticBlowupXML,OutOfMemoryError.class,"Quadratic Blowup XML attack does not work.",SAXParseException.class,"Vulnerable to Quadratic Blowup XML attack.");
  runXMLSecurityTest(xmlReaderTest,_xxeGeneralEntitiesXML1,ConnectException.class,"General Entities XXE attack using SYSTEM entity does not work.",SAXParseException.class,"Vulnerable to General Entities XXE attack using SYSTEM entity.");
  runXMLSecurityTest(xmlReaderTest,_xxeGeneralEntitiesXML2,ConnectException.class,"General Entities XXE attack using PUBLIC entity does not work.",SAXParseException.class,"Vulnerable to General Entities XXE attack using PUBLIC entity.");
  runXMLSecurityTest(xmlReaderTest,_xxeParameterEntitiesXML1,ConnectException.class,"Parameter Entities XXE using SYSTEM entity does not work.",SAXParseException.class,"Vulnerable to Parameter Entities XXE using SYSTEM entity.");
  runXMLSecurityTest(xmlReaderTest,_xxeParameterEntitiesXML2,ConnectException.class,"Parameter Entities XXE attack using PUBLIC entity does not work.",SAXParseException.class,"Vulnerable to Parameter Entities XXE attack using PUBLIC entity.");
}
