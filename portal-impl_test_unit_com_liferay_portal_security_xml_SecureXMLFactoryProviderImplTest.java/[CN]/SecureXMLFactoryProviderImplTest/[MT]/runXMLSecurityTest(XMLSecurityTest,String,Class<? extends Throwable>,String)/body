{
  try {
    xmlSecurityTest.run(xml);
    if (expectedException != null) {
      Assert.fail(failMessage);
    }
  }
 catch (  Throwable e) {
    if (expectedException == null) {
      throw e;
    }
    Throwable cause=e;
    while (cause.getCause() != null) {
      cause=cause.getCause();
    }
    if (!cause.getClass().isAssignableFrom(expectedException)) {
      throw e;
    }
  }
}
