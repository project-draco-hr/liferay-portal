{
  try {
    xmlSecurityTest.run(xml);
    if (expectedException != null) {
      Assert.fail(failMessage);
    }
  }
 catch (  Throwable t) {
    if (expectedException == null) {
      throw t;
    }
    Throwable cause=t;
    while (cause.getCause() != null) {
      cause=cause.getCause();
    }
    Class<?> causeClass=cause.getClass();
    if (!causeClass.isAssignableFrom(expectedException)) {
      throw t;
    }
  }
}
