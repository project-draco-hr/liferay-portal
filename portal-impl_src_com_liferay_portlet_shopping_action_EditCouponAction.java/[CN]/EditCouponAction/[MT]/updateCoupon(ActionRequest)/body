{
  Layout layout=(Layout)actionRequest.getAttribute(WebKeys.LAYOUT);
  long couponId=ParamUtil.getLong(actionRequest,"couponId");
  String code=ParamUtil.getString(actionRequest,"code");
  boolean autoCode=ParamUtil.getBoolean(actionRequest,"autoCode");
  String name=ParamUtil.getString(actionRequest,"name");
  String description=ParamUtil.getString(actionRequest,"description");
  int startDateMonth=ParamUtil.getInteger(actionRequest,"startDateMonth");
  int startDateDay=ParamUtil.getInteger(actionRequest,"startDateDay");
  int startDateYear=ParamUtil.getInteger(actionRequest,"startDateYear");
  int startDateHour=ParamUtil.getInteger(actionRequest,"startDateHour");
  int startDateMinute=ParamUtil.getInteger(actionRequest,"startDateMinute");
  int startDateAmPm=ParamUtil.getInteger(actionRequest,"startDateAmPm");
  if (startDateAmPm == Calendar.PM) {
    startDateHour+=12;
  }
  int endDateMonth=ParamUtil.getInteger(actionRequest,"endDateMonth");
  int endDateDay=ParamUtil.getInteger(actionRequest,"endDateDay");
  int endDateYear=ParamUtil.getInteger(actionRequest,"endDateYear");
  int endDateHour=ParamUtil.getInteger(actionRequest,"endDateHour");
  int endDateMinute=ParamUtil.getInteger(actionRequest,"endDateMinute");
  int endDateAmPm=ParamUtil.getInteger(actionRequest,"endDateAmPm");
  boolean neverExpire=ParamUtil.getBoolean(actionRequest,"neverExpire");
  if (endDateAmPm == Calendar.PM) {
    endDateHour+=12;
  }
  boolean active=ParamUtil.getBoolean(actionRequest,"active");
  String limitCategories=ParamUtil.getString(actionRequest,"limitCategories");
  String limitSkus=ParamUtil.getString(actionRequest,"limitSkus");
  double minOrder=ParamUtil.getDouble(actionRequest,"minOrder",-1.0);
  double discount=ParamUtil.getDouble(actionRequest,"discount",-1.0);
  String discountType=ParamUtil.getString(actionRequest,"discountType");
  ServiceContext serviceContext=ServiceContextFactory.getInstance(ShoppingCoupon.class.getName(),actionRequest);
  if (couponId <= 0) {
    ShoppingCouponServiceUtil.addCoupon(code,autoCode,name,description,startDateMonth,startDateDay,startDateYear,startDateHour,startDateMinute,endDateMonth,endDateDay,endDateYear,endDateHour,endDateMinute,neverExpire,active,limitCategories,limitSkus,minOrder,discount,discountType,serviceContext);
  }
 else {
    ShoppingCouponServiceUtil.updateCoupon(couponId,name,description,startDateMonth,startDateDay,startDateYear,startDateHour,startDateMinute,endDateMonth,endDateDay,endDateYear,endDateHour,endDateMinute,neverExpire,active,limitCategories,limitSkus,minOrder,discount,discountType,serviceContext);
  }
}
