{
  Layout layout=(Layout)req.getAttribute(WebKeys.LAYOUT);
  long couponId=ParamUtil.getLong(req,"couponId");
  String code=ParamUtil.getString(req,"code");
  boolean autoCode=ParamUtil.getBoolean(req,"autoCode");
  String name=ParamUtil.getString(req,"name");
  String description=ParamUtil.getString(req,"description");
  int startDateMonth=ParamUtil.getInteger(req,"startDateMonth");
  int startDateDay=ParamUtil.getInteger(req,"startDateDay");
  int startDateYear=ParamUtil.getInteger(req,"startDateYear");
  int startDateHour=ParamUtil.getInteger(req,"startDateHour");
  int startDateMinute=ParamUtil.getInteger(req,"startDateMinute");
  int startDateAmPm=ParamUtil.getInteger(req,"startDateAmPm");
  if (startDateAmPm == Calendar.PM) {
    startDateHour+=12;
  }
  int endDateMonth=ParamUtil.getInteger(req,"endDateMonth");
  int endDateDay=ParamUtil.getInteger(req,"endDateDay");
  int endDateYear=ParamUtil.getInteger(req,"endDateYear");
  int endDateHour=ParamUtil.getInteger(req,"endDateHour");
  int endDateMinute=ParamUtil.getInteger(req,"endDateMinute");
  int endDateAmPm=ParamUtil.getInteger(req,"endDateAmPm");
  boolean neverExpire=ParamUtil.getBoolean(req,"neverExpire");
  if (endDateAmPm == Calendar.PM) {
    endDateHour+=12;
  }
  boolean active=ParamUtil.getBoolean(req,"active");
  String limitCategories=ParamUtil.getString(req,"limitCategories");
  String limitSkus=ParamUtil.getString(req,"limitSkus");
  double minOrder=ParamUtil.getDouble(req,"minOrder");
  double discount=ParamUtil.getDouble(req,"discount");
  String discountType=ParamUtil.getString(req,"discountType");
  if (couponId <= 0) {
    ShoppingCouponServiceUtil.addCoupon(layout.getPlid(),code,autoCode,name,description,startDateMonth,startDateDay,startDateYear,startDateHour,startDateMinute,endDateMonth,endDateDay,endDateYear,endDateHour,endDateMinute,neverExpire,active,limitCategories,limitSkus,minOrder,discount,discountType);
  }
 else {
    ShoppingCouponServiceUtil.updateCoupon(layout.getPlid(),couponId,name,description,startDateMonth,startDateDay,startDateYear,startDateHour,startDateMinute,endDateMonth,endDateDay,endDateYear,endDateHour,endDateMinute,neverExpire,active,limitCategories,limitSkus,minOrder,discount,discountType);
  }
}
