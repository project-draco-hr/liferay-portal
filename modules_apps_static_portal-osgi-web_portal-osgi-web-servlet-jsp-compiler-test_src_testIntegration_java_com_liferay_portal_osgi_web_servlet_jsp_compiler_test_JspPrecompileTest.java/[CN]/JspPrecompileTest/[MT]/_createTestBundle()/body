{
  try (UnsyncByteArrayOutputStream unsyncByteArrayOutputStream=new UnsyncByteArrayOutputStream()){
    try (JarOutputStream jarOutputStream=new JarOutputStream(unsyncByteArrayOutputStream)){
      Manifest manifest=new Manifest();
      Attributes attributes=manifest.getMainAttributes();
      attributes.putValue(Constants.BUNDLE_ACTIVATOR,JspPrecompileBundleActivator.class.getName());
      attributes.putValue(Constants.BUNDLE_MANIFESTVERSION,"2");
      Package pkg=JspPrecompileTest.class.getPackage();
      attributes.putValue(Constants.BUNDLE_SYMBOLICNAME,pkg.getName() + ".bundle");
      attributes.putValue(Constants.BUNDLE_VERSION,"1.0.0");
      attributes.putValue(Constants.IMPORT_PACKAGE,_buildImportPackage(BundleActivator.class,HttpServletRequest.class,MVCPortlet.class,PortalUtil.class,Portlet.class));
      attributes.putValue("Manifest-Version","2");
      jarOutputStream.putNextEntry(new ZipEntry(JarFile.MANIFEST_NAME));
      manifest.write(jarOutputStream);
      jarOutputStream.closeEntry();
      _writeClasses(jarOutputStream,JspPrecompileBundleActivator.class,JspPrecompilePortlet.class);
      ClassLoader classLoader=JspPrecompileTest.class.getClassLoader();
      String path="META-INF/resources/".concat(_RUNTIME_COMPILE_JSP);
      jarOutputStream.putNextEntry(new ZipEntry(path));
      try (InputStream inputStream=classLoader.getResourceAsStream(path);OutputStream outputStream=StreamUtil.uncloseable(jarOutputStream)){
        StreamUtil.transfer(inputStream,outputStream);
      }
       jarOutputStream.closeEntry();
      String tempDir=System.getProperty("java.io.tmpdir");
      File file=new File(tempDir + StringPool.SLASH + _PRECOMPILE_JSP);
      try {
        file.createNewFile();
        jarOutputStream.putNextEntry(new ZipEntry("META-INF/resources/".concat(_PRECOMPILE_JSP)));
        try (FileInputStream fileInputStream=new FileInputStream(file)){
          StreamUtil.transfer(fileInputStream,jarOutputStream,false);
        }
         jarOutputStream.closeEntry();
      }
  finally {
        file.delete();
      }
    }
     return new UnsyncByteArrayInputStream(unsyncByteArrayOutputStream.unsafeGetByteArray(),0,unsyncByteArrayOutputStream.size());
  }
 }
