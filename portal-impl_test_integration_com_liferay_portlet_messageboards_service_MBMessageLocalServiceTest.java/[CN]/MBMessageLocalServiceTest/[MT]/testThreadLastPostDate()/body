{
  Date date=new Date();
  MBMessage parentMessage=addMessage(null,false,date);
  MBMessage firstReplyMessage=addMessage(parentMessage,false,new Date(date.getTime() + Time.SECOND));
  MBMessage secondReplyMessage=addMessage(parentMessage,false,new Date(date.getTime() + Time.SECOND * 2));
  DateFormat dateFormat=DateFormatFactoryUtil.getSimpleDateFormat(PropsValues.INDEX_DATE_FORMAT_PATTERN);
  MBThread mbThread=parentMessage.getThread();
  Assert.assertEquals(dateFormat.format(mbThread.getLastPostDate()),dateFormat.format(secondReplyMessage.getModifiedDate()));
  MBMessageLocalServiceUtil.deleteMessage(secondReplyMessage.getMessageId());
  mbThread=parentMessage.getThread();
  Assert.assertEquals(dateFormat.format(mbThread.getLastPostDate()),dateFormat.format(firstReplyMessage.getModifiedDate()));
}
