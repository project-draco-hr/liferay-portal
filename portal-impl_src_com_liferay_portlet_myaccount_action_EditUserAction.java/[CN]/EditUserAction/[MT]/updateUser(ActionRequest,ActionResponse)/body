{
  String currentPassword=actionRequest.getParameter("password0");
  String newPassword=actionRequest.getParameter("password1");
  User user=PortalUtil.getSelectedUser(actionRequest);
  if (Validator.isNotNull(currentPassword)) {
    if (Validator.isNull(newPassword)) {
      throw new UserPasswordException.MustBeLonger(user.getUserId());
    }
    Company company=PortalUtil.getCompany(actionRequest);
    String authType=company.getAuthType();
    String login=null;
    if (authType.equals(CompanyConstants.AUTH_TYPE_EA)) {
      login=user.getEmailAddress();
    }
 else     if (authType.equals(CompanyConstants.AUTH_TYPE_ID)) {
      login=String.valueOf(user.getUserId());
    }
 else     if (authType.equals(CompanyConstants.AUTH_TYPE_SN)) {
      login=user.getScreenName();
    }
    boolean validPassword=PwdAuthenticator.authenticate(login,currentPassword,user.getPassword());
    if (!validPassword) {
      throw new UserPasswordException.MustBeValid(user.getUserId());
    }
  }
 else   if (Validator.isNotNull(newPassword)) {
    throw new UserPasswordException.MustBeValid(user.getUserId());
  }
  return super.updateUser(actionRequest,actionResponse);
}
