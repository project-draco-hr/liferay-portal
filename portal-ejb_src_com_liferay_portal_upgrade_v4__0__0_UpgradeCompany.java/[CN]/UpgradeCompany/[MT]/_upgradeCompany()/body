{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=HibernateUtil.getConnection();
    ps=con.prepareStatement(_UPGRADE_COMPANY);
    rs=ps.executeQuery();
    while (rs.next()) {
      String companyId=rs.getString("companyId");
      String portalURL=rs.getString("portalURL");
      String homeURL=rs.getString("homeURL");
      String mx=rs.getString("mx");
      String name=rs.getString("name");
      String type=rs.getString("type_");
      String size=rs.getString("size_");
      String street1=rs.getString("street");
      String street2=StringPool.BLANK;
      String street3=StringPool.BLANK;
      String city=rs.getString("city");
      String zip=rs.getString("zip");
      String regionId=RegionImpl.DEFAULT_REGION_ID;
      String countryId=CountryImpl.DEFAULT_COUNTRY_ID;
      String emailAddress=rs.getString("emailAddress");
      _log.info("Upgrading company " + companyId);
      Company company=CompanyLocalServiceUtil.updateCompany(companyId,portalURL,homeURL,mx,name,null,null,null,null,null,null,type,size);
      Account account=company.getAccount();
      AddressLocalServiceUtil.addAddress(account.getUserId(),Account.class.getName(),account.getAccountId(),street1,street2,street3,city,zip,regionId,countryId,ListTypeImpl.ACCOUNT_ADDRESS_DEFAULT,true,true);
      EmailAddressLocalServiceUtil.addEmailAddress(account.getUserId(),Account.class.getName(),account.getAccountId(),emailAddress,ListTypeImpl.ACCOUNT_EMAIL_ADDRESS_DEFAULT,true);
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
