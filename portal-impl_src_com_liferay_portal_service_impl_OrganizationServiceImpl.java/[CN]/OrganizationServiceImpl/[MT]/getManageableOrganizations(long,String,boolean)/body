{
  PermissionChecker permissionChecker=getPermissionChecker();
  if (permissionChecker.isCompanyAdmin()) {
    return organizationLocalService.search(permissionChecker.getCompanyId(),0,null,null,null,null,null,0,PropsValues.CONTROL_PANEL_NAVIGATION_MAX_ORGANIZATIONS);
  }
  if (Validator.isNull(actionId)) {
    return organizationLocalService.getManageableOrganizations(userId);
  }
  List<Organization> manageableOrganizations=new UniqueList<Organization>();
  List<Organization> userOrganizations=userPersistence.getOrganizations(userId);
  for (  Organization userOrganization : userOrganizations) {
    if (OrganizationPermissionUtil.contains(permissionChecker,userOrganization.getOrganizationId(),actionId)) {
      manageableOrganizations.add(userOrganization);
    }
    if (recurse && OrganizationPermissionUtil.contains(permissionChecker,userOrganization.getOrganizationId(),ActionKeys.MANAGE_SUBORGANIZATIONS)) {
      manageableOrganizations.addAll(userOrganization.getDescendants());
    }
  }
  return manageableOrganizations;
}
