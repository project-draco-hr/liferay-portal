{
  DDMStructure ddmStructure=getDDMStructure(recordSetId);
  List<DDMFormField> ddmFormFields=getDDMFormFields(ddmStructure);
  Document document=SAXReaderUtil.createDocument();
  Element rootElement=document.addElement("root");
  List<DDLRecord> records=DDLRecordLocalServiceUtil.getRecords(recordSetId,status,start,end,orderByComparator);
  for (  DDLRecord record : records) {
    Element fieldsElement=rootElement.addElement("fields");
    DDLRecordVersion recordVersion=record.getRecordVersion();
    DDMFormValues ddmFormValues=StorageEngineUtil.getDDMFormValues(recordVersion.getDDMStorageId());
    Fields fields=DDMFormValuesToFieldsConverterUtil.convert(ddmStructure,ddmFormValues);
    for (    DDMFormField ddmFormField : ddmFormFields) {
      LocalizedValue label=ddmFormField.getLabel();
      String name=ddmFormField.getName();
      String value=StringPool.BLANK;
      if (fields.contains(name)) {
        Field field=fields.get(name);
        value=field.getRenderedValue(getLocale());
      }
      addFieldElement(fieldsElement,label.getString(getLocale()),value);
    }
    addFieldElement(fieldsElement,LanguageUtil.get(getLocale(),"status"),getStatusMessage(recordVersion.getStatus()));
  }
  String xml=document.asXML();
  return xml.getBytes();
}
