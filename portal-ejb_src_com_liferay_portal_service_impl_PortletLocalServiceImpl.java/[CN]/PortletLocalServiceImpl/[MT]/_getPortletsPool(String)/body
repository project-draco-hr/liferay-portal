{
  String scpId=PortletServiceImpl.class.getName() + ".companyPortletsPool";
  Map companyPortletsPool=(Map)SimpleCachePool.get(scpId);
  if (companyPortletsPool == null) {
    companyPortletsPool=CollectionFactory.getSyncHashMap();
    SimpleCachePool.put(scpId,companyPortletsPool);
  }
  Map portletsPool=(Map)companyPortletsPool.get(companyId);
  if (portletsPool == null) {
    portletsPool=CollectionFactory.getSyncHashMap();
    Map parentPortletsPool=_getPortletsPool();
    if (parentPortletsPool == null) {
      return portletsPool;
    }
    Iterator itr=parentPortletsPool.values().iterator();
    while (itr.hasNext()) {
      Portlet portlet=(Portlet)((Portlet)itr.next()).clone();
      portlet.setCompanyId(companyId);
      portletsPool.put(portlet.getPortletId(),portlet);
    }
    itr=PortletUtil.findByCompanyId(companyId).iterator();
    while (itr.hasNext()) {
      Portlet portlet=(Portlet)itr.next();
      Portlet portletModel=(Portlet)portletsPool.get(portlet.getPortletId());
      if (portletModel != null) {
        portletModel.setRoles(portlet.getRoles());
        portletModel.setActive(portlet.getActive());
      }
    }
    companyPortletsPool.put(companyId,portletsPool);
  }
  return portletsPool;
}
