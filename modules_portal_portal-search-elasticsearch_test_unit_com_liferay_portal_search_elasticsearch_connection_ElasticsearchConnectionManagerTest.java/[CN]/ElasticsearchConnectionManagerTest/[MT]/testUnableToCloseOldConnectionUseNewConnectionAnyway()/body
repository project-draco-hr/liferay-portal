{
  modify(OperationMode.EMBEDDED);
  resetMockConnections();
  Mockito.doThrow(IllegalStateException.class).when(_embeddedElasticsearchConnection).close();
  modify(OperationMode.REMOTE);
  Assert.assertSame(_remoteElasticsearchConnection,_elasticsearchConnectionManager.getElasticsearchConnection());
  verifyCloseNotConnect(_embeddedElasticsearchConnection);
  verifyConnectNotClose(_remoteElasticsearchConnection);
}
