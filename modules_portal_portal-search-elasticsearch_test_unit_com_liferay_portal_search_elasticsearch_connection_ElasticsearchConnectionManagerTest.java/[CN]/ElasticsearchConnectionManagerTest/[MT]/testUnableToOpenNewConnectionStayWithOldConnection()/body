{
  modify(OperationMode.EMBEDDED);
  resetMockConnections();
  Mockito.doThrow(IllegalStateException.class).when(_remoteElasticsearchConnection).connect();
  try {
    modify(OperationMode.REMOTE);
    Assert.fail("Changed operation mode although connect failed");
  }
 catch (  IllegalStateException ise) {
  }
  Assert.assertSame(_embeddedElasticsearchConnection,_elasticsearchConnectionManager.getElasticsearchConnection());
  verifyConnectNotClose(_remoteElasticsearchConnection);
  verifyNeitherCloseNorConnect(_embeddedElasticsearchConnection);
}
