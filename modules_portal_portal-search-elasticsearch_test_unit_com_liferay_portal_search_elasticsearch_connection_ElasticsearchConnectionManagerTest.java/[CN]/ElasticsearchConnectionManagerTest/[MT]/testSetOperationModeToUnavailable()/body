{
  _elasticsearchConnectionManager.unsetElasticsearchConnection(_remoteElasticsearchConnection);
  verifyCloseNotConnect(_remoteElasticsearchConnection);
  verifyNeitherCloseNorConnect(_embeddedElasticsearchConnection);
  resetMockConnections();
  try {
    modify(OperationMode.REMOTE);
    Assert.fail("Allowed setting an unavailable operation mode");
  }
 catch (  MissingOperationModeException mome) {
    String message=mome.getMessage();
    Assert.assertTrue(message.contains(String.valueOf(OperationMode.REMOTE)));
  }
  verifyNeitherCloseNorConnect(_embeddedElasticsearchConnection);
  verifyNeitherCloseNorConnect(_remoteElasticsearchConnection);
}
