{
  String sqlPath=_portalRoot + "/sql";
  File sqlFile=new File(sqlPath + "/indexes.sql");
  Set indexSQLs=new TreeSet();
  BufferedReader br=new BufferedReader(new FileReader(sqlFile));
  while (true) {
    String indexSQL=br.readLine();
    if (indexSQL == null) {
      break;
    }
    if (Validator.isNotNull(indexSQL)) {
      indexSQLs.add(indexSQL);
    }
  }
  br.close();
  String content=FileUtil.read(sqlFile);
  for (int i=0; i < _ejbList.size(); i++) {
    Entity entity=(Entity)_ejbList.get(i);
    List finderList=entity.getFinderList();
    for (int j=0; j < finderList.size(); j++) {
      EntityFinder finder=(EntityFinder)finderList.get(j);
      if (finder.isDBIndex()) {
        StringBuffer sb=new StringBuffer();
        String indexName=entity.getName() + "_ix_" + finder.getName();
        if (indexName.length() > 30) {
          indexName=indexName.substring(0,30);
        }
        sb.append("create index " + indexName + " on "+ entity.getTable()+ " (");
        List finderColsList=finder.getColumns();
        for (int k=0; k < finderColsList.size(); k++) {
          EntityColumn col=(EntityColumn)finderColsList.get(k);
          sb.append(col.getDBName());
          if ((k + 1) != finderColsList.size()) {
            sb.append(", ");
          }
        }
        sb.append(");");
        String indexSQL=sb.toString();
        if (!indexSQLs.contains(indexSQL)) {
          indexSQLs.add(indexSQL);
        }
      }
    }
  }
  StringBuffer sb=new StringBuffer();
  String prevEntityName=null;
  Iterator itr=indexSQLs.iterator();
  while (itr.hasNext()) {
    String indexSQL=(String)itr.next();
    int pos=indexSQL.indexOf("_ix_");
    String entityName=indexSQL.substring(0,pos);
    if ((prevEntityName != null) && (!prevEntityName.equals(entityName))) {
      sb.append("\n");
    }
    sb.append(indexSQL);
    if (itr.hasNext()) {
      sb.append("\n");
    }
    prevEntityName=entityName;
  }
  FileUtil.write(sqlFile,sb.toString(),true);
}
