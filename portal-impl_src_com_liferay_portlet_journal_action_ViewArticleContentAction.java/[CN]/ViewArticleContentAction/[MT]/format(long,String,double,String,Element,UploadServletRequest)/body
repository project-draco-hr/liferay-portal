{
  Iterator itr=root.elements().iterator();
  while (itr.hasNext()) {
    Element el=(Element)itr.next();
    Element dynamicContent=el.element("dynamic-content");
    String elName=el.attributeValue("name",StringPool.BLANK);
    String elType=el.attributeValue("type",StringPool.BLANK);
    String elLanguage="";
    if (dynamicContent != null) {
      elLanguage=dynamicContent.attributeValue("language-id",StringPool.BLANK);
      if (!elLanguage.equals(StringPool.BLANK)) {
        elLanguage="_" + elLanguage;
      }
    }
    if (elType.equals("image")) {
      File file=req.getFile("structure_image_" + elName + elLanguage);
      byte[] bytes=FileUtil.getBytes(file);
      if ((bytes != null) && (bytes.length > 0)) {
        long imageId=JournalArticleImageLocalServiceUtil.getArticleImageId(groupId,previewArticleId,version,elName,elLanguage,true);
        dynamicContent.setText("/image/journal/article?img_id=" + imageId + "&t="+ ImageServletToken.getToken(imageId));
        ImageLocalUtil.updateImage(imageId,bytes);
      }
 else {
        if (Validator.isNotNull(articleId)) {
          long imageId=JournalArticleImageLocalServiceUtil.getArticleImageId(groupId,articleId,version,elName,elLanguage);
          dynamicContent.setText("/image/journal/article?img_id=" + imageId + "&t="+ ImageServletToken.getToken(imageId));
        }
      }
    }
    format(groupId,articleId,version,previewArticleId,el,req);
  }
}
