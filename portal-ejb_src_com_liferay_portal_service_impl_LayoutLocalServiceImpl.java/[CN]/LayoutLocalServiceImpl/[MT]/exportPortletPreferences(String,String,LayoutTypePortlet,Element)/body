{
  Iterator itr=PortletPreferencesLocalServiceUtil.getPortletPreferencesByLayout(ownerId,layoutId).iterator();
  while (itr.hasNext()) {
    PortletPreferences portletPreferences=(PortletPreferences)itr.next();
    String portletId=portletPreferences.getPortletId();
    if ((layoutTypePortlet == null) || (layoutTypePortlet.hasPortletId(portletId))) {
      Element el=parentEl.addElement("portlet-preferences");
      el.addAttribute("portlet-id",portletId);
      el.addAttribute("layout-id",layoutId);
      el.addAttribute("owner-id",ownerId);
      el.addElement("preferences").addCDATA(portletPreferences.getPreferences());
    }
  }
}
