{
  Element el=parentEl.addElement(elName);
  try {
    Resource resource=ResourceLocalServiceUtil.getResource(companyId,resourceName,scope,resourcePrimKey);
    Map resourceRoles=RoleLocalServiceUtil.getResourceRoles(resource.getResourceId());
    Iterator itr=resourceRoles.entrySet().iterator();
    while (itr.hasNext()) {
      Map.Entry entry=(Map.Entry)itr.next();
      String roleName=entry.getKey().toString();
      if (hasRole(roles,roleName)) {
        Element roleEl=el.addElement("role");
        roleEl.addAttribute("name",roleName);
        List actions=(List)entry.getValue();
        for (int i=0; i < actions.size(); i++) {
          String action=(String)actions.get(i);
          Element actionKeyEl=roleEl.addElement("action-key");
          actionKeyEl.addText(action);
          actionKeyEl.addAttribute("scope",scope);
        }
      }
    }
  }
 catch (  NoSuchResourceException nsre) {
    if (_log.isWarnEnabled()) {
      _log.warn(nsre);
    }
  }
  return el;
}
