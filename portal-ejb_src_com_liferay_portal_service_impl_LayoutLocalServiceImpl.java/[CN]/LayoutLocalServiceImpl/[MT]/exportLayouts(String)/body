{
  ZipWriter zipWriter=new ZipWriter();
  int buildNumber=ReleaseInfo.getBuildNumber();
  LayoutSet layoutSet=LayoutSetLocalServiceUtil.getLayoutSet(ownerId);
  Document doc=DocumentHelper.createDocument();
  Element root=doc.addElement("root");
  Element header=root.addElement("header");
  header.addAttribute("build-number",Integer.toString(buildNumber));
  header.addAttribute("owner-id",ownerId);
  header.addAttribute("export-date",Time.getRFC822());
  header.addAttribute("theme-id",layoutSet.getThemeId());
  header.addAttribute("color-scheme-id",layoutSet.getColorSchemeId());
  Iterator itr=getLayouts(ownerId).iterator();
  while (itr.hasNext()) {
    Layout layout=(Layout)itr.next();
    Element el=root.addElement("layout");
    el.addAttribute("layout-id",layout.getLayoutId());
    el.addElement("parent-layout-id").addText(layout.getParentLayoutId());
    el.addElement("name").addCDATA(layout.getName());
    el.addElement("type").addText(layout.getType());
    el.addElement("type-settings").addCDATA(layout.getTypeSettings());
    el.addElement("hidden").addText(Boolean.toString(layout.getHidden()));
    el.addElement("friendly-url").addText(layout.getFriendlyURL());
    el.addElement("theme-id").addText(layout.getThemeId());
    el.addElement("color-scheme-id").addText(layout.getColorSchemeId());
    el.addElement("priority").addText(Integer.toString(layout.getPriority()));
  }
  itr=PortletPreferencesLocalServiceUtil.getPortletPreferences(ownerId).iterator();
  while (itr.hasNext()) {
    PortletPreferences prefs=(PortletPreferences)itr.next();
    Element el=root.addElement("portlet-preferences");
    el.addAttribute("portlet-id",prefs.getPortletId());
    el.addAttribute("layout-id",prefs.getLayoutId());
    el.addElement("preferences").addCDATA(prefs.getPreferences());
  }
  String fileName="layouts.xml";
  try {
    zipWriter.addEntry(fileName,XMLFormatter.toString(doc));
    return zipWriter.finish();
  }
 catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
