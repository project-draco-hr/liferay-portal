{
  friendlyURL=friendlyURL.toLowerCase();
  boolean firstLayout=false;
  if (parentLayoutId.equals(LayoutImpl.DEFAULT_PARENT_LAYOUT_ID)) {
    List layouts=LayoutUtil.findByO_P(ownerId,parentLayoutId);
    if (layouts.size() == 0) {
      firstLayout=true;
    }
 else {
      String firstLayoutId=((Layout)layouts.get(0)).getLayoutId();
      if (firstLayoutId.equals(layoutId)) {
        firstLayout=true;
      }
    }
  }
  if (firstLayout) {
    validateFirstLayout(type,hidden);
  }
  if (Validator.isNull(name)) {
    throw new LayoutNameException();
  }
  if (!PortalUtil.isLayoutParentable(type)) {
    if (LayoutUtil.countByO_P(ownerId,layoutId) > 0) {
      throw new LayoutTypeException(LayoutTypeException.NOT_PARENTABLE);
    }
  }
  if (Validator.isNotNull(friendlyURL)) {
    int exceptionType=LayoutImpl.validateFriendlyURL(friendlyURL);
    if (exceptionType != -1) {
      throw new LayoutFriendlyURLException(exceptionType);
    }
    try {
      Layout layout=LayoutUtil.findByO_F(ownerId,friendlyURL);
      if (!layout.getLayoutId().equals(layoutId)) {
        throw new LayoutFriendlyURLException(LayoutFriendlyURLException.DUPLICATE);
      }
    }
 catch (    NoSuchLayoutException nsle) {
    }
    LayoutImpl.validateFriendlyURLKeyword(friendlyURL);
    Map friendlyURLMappers=PortletLocalServiceUtil.getFriendlyURLMappers();
    Iterator itr=friendlyURLMappers.entrySet().iterator();
    while (itr.hasNext()) {
      Map.Entry entry=(Map.Entry)itr.next();
      String className=(String)entry.getValue();
      FriendlyURLMapper friendlyURLMapper=(FriendlyURLMapper)InstancePool.get(className);
      if (friendlyURL.indexOf(friendlyURLMapper.getMapping()) != -1) {
        LayoutFriendlyURLException lfurle=new LayoutFriendlyURLException(LayoutFriendlyURLException.KEYWORD_CONFLICT);
        lfurle.setKeywordConflict(friendlyURLMapper.getMapping());
        throw lfurle;
      }
    }
  }
}
