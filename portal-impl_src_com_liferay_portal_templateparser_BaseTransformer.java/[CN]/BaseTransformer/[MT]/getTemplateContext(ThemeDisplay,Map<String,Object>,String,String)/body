{
  long companyId=0;
  long companyGroupId=0;
  long groupId=0;
  if (themeDisplay != null) {
    companyId=themeDisplay.getCompanyId();
    companyGroupId=themeDisplay.getCompanyGroupId();
    groupId=themeDisplay.getScopeGroupId();
  }
  String templateId=String.valueOf(contextObjects.get("template_id"));
  templateId=getTemplateId(templateId,companyId,companyGroupId,groupId);
  TemplateResource templateResource=new StringTemplateResource(templateId,script);
  TemplateResource errorTemplateResource=getErrorTemplateResource(langType);
  TemplateContextType templateContextType=getTemplateContextType(langType);
  return TemplateManagerUtil.getTemplate(langType,templateResource,errorTemplateResource,templateContextType);
}
