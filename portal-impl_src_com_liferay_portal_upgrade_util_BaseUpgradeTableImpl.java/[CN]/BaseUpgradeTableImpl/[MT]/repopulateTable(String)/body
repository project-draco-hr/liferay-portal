{
  Connection con=null;
  PreparedStatement ps=null;
  String insertSQL=getInsertSQL();
  BufferedReader br=new BufferedReader(new FileReader(tempFileName));
  String line=null;
  try {
    con=DataAccess.getConnection();
    boolean useBatch=con.getMetaData().supportsBatchUpdates();
    if (!useBatch) {
      if (_log.isInfoEnabled()) {
        _log.info("Database does not support batch updates");
      }
    }
    int count=0;
    while ((line=br.readLine()) != null) {
      String[] values=StringUtil.split(line);
      if (values.length != _columns.length) {
        throw new UpgradeException("Columns differ between temp file and schema. " + "Attempted to insert row " + line + ".");
      }
      if (count == 0) {
        ps=con.prepareStatement(insertSQL);
      }
      for (int i=0; i < _insertionOrder.length; i++) {
        int pos=_insertionOrder[i];
        setColumn(ps,i,(Integer)_columns[pos][1],values[pos]);
      }
      if (useBatch) {
        ps.addBatch();
        if (count == _BATCH_SIZE) {
          repopulateTableRows(ps,true);
          count=0;
        }
 else {
          count++;
        }
      }
 else {
        repopulateTableRows(ps,false);
      }
    }
    if (useBatch) {
      if (count != 0) {
        repopulateTableRows(ps,true);
      }
    }
  }
  finally {
    DataAccess.cleanUp(con,ps);
    br.close();
  }
  if (_log.isInfoEnabled()) {
    _log.info(_tableName + " table repopulated with data");
  }
}
