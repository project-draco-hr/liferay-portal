{
  NtlmPasswordAuthentication auth=new NtlmPasswordAuthentication(null,_serviceAccount.getAccount(),_serviceAccount.getPassword());
  String endpoint="ncacn_np:" + _domainController + "[\\PIPE\\NETLOGON]";
  _handle=DcerpcHandle.getHandle(endpoint,auth);
  _handle.bind();
  byte[] clientChallenge=new byte[8];
  _secureRandom.nextBytes(clientChallenge);
  NetrServerReqChallenge msg=new NetrServerReqChallenge(_domainControllerName,_serviceAccount.getComputerName(),clientChallenge,new byte[8]);
  _handle.sendrecv(msg);
  MD4 md4=new MD4();
  md4.update(_serviceAccount.getPassword().getBytes("UTF-16LE"));
  byte[] sessionKey=computeSessionKey(md4.digest(),clientChallenge,msg.getServerChallenge());
  byte[] clientCredential=computeNetlogonCredential(clientChallenge,sessionKey);
  NetrServerAuthenticate3 msg2=new NetrServerAuthenticate3(_domainControllerName,_serviceAccount.getAccountName(),2,_serviceAccount.getComputerName(),clientCredential,new byte[8],0xFFFFFFFF);
  _handle.sendrecv(msg2);
  byte[] serverCredential=computeNetlogonCredential(msg.getServerChallenge(),sessionKey);
  if (!Arrays.equals(serverCredential,msg2.getServerCredential())) {
    _log.error("Session Key negotiation failed.");
    return;
  }
  _clientCredential=clientCredential;
  _sessionKey=sessionKey;
}
