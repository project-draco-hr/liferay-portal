{
  String contextPath=PortalUtil.getPathContext();
  String[] modulePaths=request.getParameterValues("m");
  if ((modulePaths == null) || (modulePaths.length == 0)) {
    response.sendError(HttpServletResponse.SC_BAD_REQUEST);
    return;
  }
  Set<String> modulePathSet=new HashSet<String>(modulePaths.length);
  for (  String path : modulePaths) {
    modulePathSet.add(path);
  }
  modulePaths=modulePathSet.toArray(new String[modulePathSet.size()]);
  Arrays.sort(modulePaths);
  String modulePathsString=null;
  byte[][] bytesArray=null;
  if (!PropsValues.COMBO_CHECK_TIMESTAMP) {
    modulePathsString=Arrays.toString(modulePaths);
    bytesArray=(byte[][])_byteArraysCache.get(modulePathsString);
  }
  String firstModulePath=modulePaths[0];
  String extension=FileUtil.getExtension(firstModulePath);
  if (bytesArray == null) {
    String p=ParamUtil.getString(request,"p");
    String minifierType=ParamUtil.getString(request,"minifierType");
    if (Validator.isNull(minifierType)) {
      minifierType="js";
      if (extension.equalsIgnoreCase(_CSS_EXTENSION)) {
        minifierType="css";
      }
    }
    if (!minifierType.equals("js") && !minifierType.equals("css")) {
      minifierType="js";
    }
    int length=modulePaths.length;
    bytesArray=new byte[length][];
    for (    String modulePath : modulePaths) {
      if (!validateModuleExtension(modulePath)) {
        response.setStatus(HttpServletResponse.SC_NOT_FOUND);
        response.setHeader(HttpHeaders.CACHE_CONTROL,HttpHeaders.CACHE_CONTROL_NO_CACHE_VALUE);
        return;
      }
      byte[] bytes=new byte[0];
      if (Validator.isNotNull(modulePath)) {
        modulePath=StringUtil.replaceFirst(p.concat(modulePath),contextPath,StringPool.BLANK);
        if (getFile(modulePath) == null) {
          response.setStatus(HttpServletResponse.SC_NOT_FOUND);
          response.setHeader(HttpHeaders.CACHE_CONTROL,HttpHeaders.CACHE_CONTROL_NO_CACHE_VALUE);
          return;
        }
        bytes=getFileContent(request,response,modulePath,minifierType);
      }
      bytesArray[--length]=bytes;
    }
    if ((modulePathsString != null) && !PropsValues.COMBO_CHECK_TIMESTAMP) {
      _byteArraysCache.put(modulePathsString,bytesArray);
    }
  }
  String contentType=ContentTypes.TEXT_JAVASCRIPT;
  if (extension.equalsIgnoreCase(_CSS_EXTENSION)) {
    contentType=ContentTypes.TEXT_CSS;
  }
  response.setContentType(contentType);
  ServletResponseUtil.write(response,bytesArray);
}
