{
  String languageId=LanguageUtil.getLanguageId(request);
  Locale locale=LocaleUtil.fromLanguageId(languageId);
  PortletApp portletApp=PortletLocalServiceUtil.getPortletApp(contextPath);
  Portlet portlet=null;
  if ((portletApp != null) && portletApp.isWARFile()) {
    List<Portlet> portlets=portletApp.getPortlets();
    if (!portlets.isEmpty()) {
      portlet=portlets.get(0);
    }
  }
  ResourceBundle resourceBundle=LanguageResources.getResourceBundle(locale);
  if (portlet != null) {
    PortletConfig portletConfig=PortletConfigFactoryUtil.create(portlet,getServletContext());
    if (portletConfig != null) {
      resourceBundle=new AggregateResourceBundle(portletConfig.getResourceBundle(locale),resourceBundle);
    }
  }
  return LanguageUtil.process(resourceBundle,locale,stringFileContent);
}
