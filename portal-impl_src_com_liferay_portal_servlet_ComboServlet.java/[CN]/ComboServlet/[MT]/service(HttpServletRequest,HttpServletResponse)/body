{
  Map<String,String[]> parameterMap=request.getParameterMap();
  int totalParameters=parameterMap.size();
  if (totalParameters == 0) {
    response.sendError(HttpServletResponse.SC_BAD_REQUEST);
    return;
  }
  String content=null;
  String cacheFileName=getCacheFileName(request);
  File cacheDataFile=new File(cacheFileName);
  if (cacheDataFile.exists()) {
    content=FileUtil.read(cacheDataFile);
  }
 else {
    _sb=new StringBundler(totalParameters);
    for (    String modulePath : parameterMap.keySet()) {
      File file=getFile(request,modulePath);
      if (file != null) {
        String moduleContent=FileUtil.read(file);
        _sb.append(moduleContent);
      }
    }
    content=_sb.toString();
    if (Validator.isNotNull(content)) {
      FileUtil.write(cacheDataFile,content);
    }
  }
  String contentType=ContentTypes.TEXT_JAVASCRIPT;
  String firstModuleName=(String)request.getParameterNames().nextElement();
  String extension=FileUtil.getExtension(firstModuleName);
  if ((extension != null) && extension.equalsIgnoreCase(_CSS_EXTENSION)) {
    contentType=ContentTypes.TEXT_CSS;
  }
  response.setContentType(contentType);
  PrintWriter pw=response.getWriter();
  pw.write(content);
  pw.close();
}
