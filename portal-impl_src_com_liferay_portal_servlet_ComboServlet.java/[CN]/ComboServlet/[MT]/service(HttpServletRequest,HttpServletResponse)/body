{
  Map<String,String[]> parameterMap=request.getParameterMap();
  if (parameterMap.size() == 0) {
    response.sendError(HttpServletResponse.SC_BAD_REQUEST);
    return;
  }
  String content=null;
  File cacheFile=getCacheFile(request);
  if (cacheFile.exists()) {
    content=FileUtil.read(cacheFile);
  }
 else {
    StringBundler sb=new StringBundler(parameterMap.size());
    for (    String modulePath : parameterMap.keySet()) {
      File file=getFile(modulePath);
      if (file != null) {
        String moduleContent=FileUtil.read(file);
        sb.append(moduleContent);
      }
    }
    content=sb.toString();
    if (Validator.isNotNull(content)) {
      FileUtil.write(cacheFile,content);
    }
  }
  String contentType=ContentTypes.TEXT_JAVASCRIPT;
  String firstModulePath=(String)request.getParameterNames().nextElement();
  String extension=FileUtil.getExtension(firstModulePath);
  if (extension.equalsIgnoreCase(_CSS_EXTENSION)) {
    contentType=ContentTypes.TEXT_CSS;
  }
  response.setContentType(contentType);
  ServletResponseUtil.write(response,content);
}
