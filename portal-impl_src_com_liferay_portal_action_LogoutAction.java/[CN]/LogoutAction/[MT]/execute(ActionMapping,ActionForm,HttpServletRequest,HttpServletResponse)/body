{
  try {
    HttpSession session=request.getSession();
    EventsProcessor.process(PropsKeys.LOGOUT_EVENTS_PRE,PropsValues.LOGOUT_EVENTS_PRE,request,response);
    String domain=CookieKeys.getDomain(request);
    Cookie companyIdCookie=new Cookie(CookieKeys.COMPANY_ID,StringPool.BLANK);
    if (Validator.isNotNull(domain)) {
      companyIdCookie.setDomain(domain);
    }
    companyIdCookie.setMaxAge(0);
    companyIdCookie.setPath(StringPool.SLASH);
    Cookie idCookie=new Cookie(CookieKeys.ID,StringPool.BLANK);
    if (Validator.isNotNull(domain)) {
      idCookie.setDomain(domain);
    }
    idCookie.setMaxAge(0);
    idCookie.setPath(StringPool.SLASH);
    Cookie passwordCookie=new Cookie(CookieKeys.PASSWORD,StringPool.BLANK);
    if (Validator.isNotNull(domain)) {
      passwordCookie.setDomain(domain);
    }
    passwordCookie.setMaxAge(0);
    passwordCookie.setPath(StringPool.SLASH);
    CookieKeys.addCookie(response,companyIdCookie);
    CookieKeys.addCookie(response,idCookie);
    CookieKeys.addCookie(response,passwordCookie);
    String userId=(String)session.getAttribute("j_username");
    String scheme=request.getScheme();
    String serverName=request.getServerName();
    Integer serverPort=request.getServerPort();
    String presenceResource="/ruon-web/resources/presence/status/";
    URL restURL=new URL(scheme + "://" + serverName+ ":"+ serverPort.toString()+ presenceResource+ userId+ "/offline");
    if (((HttpURLConnection)restURL.openConnection()).getResponseCode() == HttpURLConnection.HTTP_OK) {
      HttpUtil.submit(restURL.toString(),true);
    }
    try {
      session.invalidate();
    }
 catch (    Exception e) {
    }
    EventsProcessor.process(PropsKeys.LOGOUT_EVENTS_POST,PropsValues.LOGOUT_EVENTS_POST,request,response);
    return mapping.findForward(ActionConstants.COMMON_REFERER);
  }
 catch (  Exception e) {
    PortalUtil.sendError(e,request,response);
    return null;
  }
}
