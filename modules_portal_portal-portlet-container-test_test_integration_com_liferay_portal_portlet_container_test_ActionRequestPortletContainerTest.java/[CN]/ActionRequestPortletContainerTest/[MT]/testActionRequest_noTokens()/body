{
  setUpPortlet(testPortlet,properties,TEST_PORTLET_ID);
  HttpServletRequest request=getHttpServletRequest();
  PortletURL portletURL=new PortletURLImpl(request,TEST_PORTLET_ID,layout.getPlid(),PortletRequest.ACTION_PHASE);
  String url=portletURL.toString();
  try (CaptureAppender captureAppender=Log4JLoggerTestUtil.configureLog4JLogger(SecurityPortletContainerWrapper.class.getName(),Level.WARN)){
    Map<String,List<String>> responseMap=request(url);
    List<LoggingEvent> loggingEvents=captureAppender.getLoggingEvents();
    Assert.assertEquals(1,loggingEvents.size());
    LoggingEvent loggingEvent=loggingEvents.get(0);
    String rootUrl=url.substring(0,url.indexOf('?'));
    Assert.assertEquals("User 0 is not allowed to access URL " + rootUrl + " and portlet "+ TEST_PORTLET_ID,loggingEvent.getMessage());
    Assert.assertEquals("200",getString(responseMap,"code"));
    Assert.assertFalse(map.containsKey("processAction"));
  }
 }
