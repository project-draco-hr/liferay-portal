{
  String MN="createRewriteURL()";
  if (logger.isLogging(Logger.TRACE_HIGH)) {
    logger.entry(Logger.TRACE_HIGH,MN,new Object[]{urlType,portletMode,navigationalState,interactionState,windowState,url,rewriteResource,token,secureURL});
  }
  StringBuffer resultURL=new StringBuffer();
  resultURL.append(Constants.REWRITE_START);
  resultURL.append(Constants.PARAMS_START);
  if (urlType != null) {
    resultURL.append(appendNameValuePair(Constants.URL_TYPE,urlType));
  }
 else {
  }
  if (portletMode != null && portletMode.length() > 0) {
    resultURL.append(Constants.NEXT_PARAM_AMP);
    resultURL.append(appendNameValuePair(Constants.PORTLET_MODE,portletMode));
  }
  if (navigationalState != null && navigationalState.length() > 0) {
    resultURL.append(Constants.NEXT_PARAM_AMP);
    resultURL.append(appendNameValuePair(Constants.NAVIGATIONAL_STATE,navigationalState));
  }
  if (interactionState != null && interactionState.length() > 0) {
    resultURL.append(Constants.NEXT_PARAM_AMP);
    resultURL.append(appendNameValuePair(Constants.INTERACTION_STATE,interactionState));
  }
  if (windowState != null && windowState.length() > 0) {
    resultURL.append(Constants.NEXT_PARAM_AMP);
    resultURL.append(appendNameValuePair(Constants.WINDOW_STATE,windowState));
  }
  if (url != null && url.length() > 0) {
    resultURL.append(Constants.NEXT_PARAM_AMP);
    String fileEncoding=System.getProperty("file.encoding","UTF-8");
    try {
      resultURL.append(appendNameValuePair(Constants.URL,URLEncoder.encode(url,fileEncoding)));
    }
 catch (    Exception e) {
      logger.text(Logger.ERROR,MN,e,"Encoding not supported.");
    }
  }
  if (rewriteResource != null && rewriteResource.length() > 0) {
    resultURL.append(Constants.NEXT_PARAM_AMP);
    resultURL.append(appendNameValuePair(Constants.REWRITE_RESOURCE,rewriteResource));
  }
  if (secureURL != null && secureURL.length() > 0) {
    resultURL.append(Constants.NEXT_PARAM_AMP);
    resultURL.append(appendNameValuePair(Constants.SECURE_URL,secureURL));
  }
  resultURL.append(Constants.REWRITE_END);
  if (logger.isLogging(Logger.TRACE_HIGH)) {
    logger.exit(Logger.TRACE_HIGH,MN);
  }
  String result=resultURL.toString();
  if (logger.isLogging(Logger.TRACE_HIGH)) {
    logger.exit(Logger.TRACE_HIGH,MN,result);
  }
  return result;
}
