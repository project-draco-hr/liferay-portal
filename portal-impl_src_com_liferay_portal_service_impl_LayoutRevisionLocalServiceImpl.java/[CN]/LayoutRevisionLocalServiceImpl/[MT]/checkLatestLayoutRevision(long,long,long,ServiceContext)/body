{
  LayoutBranch layoutBranch=layoutBranchPersistence.findByPrimaryKey(layoutBranchId);
  LayoutRevision layoutRevision=null;
  if (layoutRevisionId > 0) {
    layoutRevision=layoutRevisionPersistence.fetchByPrimaryKey(layoutRevisionId);
  }
  List<LayoutRevision> layoutRevisions=null;
  if (layoutRevision == null) {
    layoutRevisions=layoutRevisionPersistence.findByL_P(layoutBranchId,plid,0,1);
    if (!layoutRevisions.isEmpty()) {
      layoutRevision=layoutRevisions.get(0);
    }
  }
  if (layoutRevision != null) {
    return layoutRevision;
  }
  Layout layout=layoutPersistence.findByPrimaryKey(plid);
  layoutRevision=addLayoutRevision(layoutBranch.getUserId(),layoutBranch.getLayoutBranchId(),LayoutRevisionConstants.DEFAULT_PARENT_LAYOUT_REVISION_ID,false,plid,layout.getName(),layout.getTitle(),layout.getDescription(),layout.getTypeSettings(),layout.isIconImage(),layout.getIconImageId(),layout.getThemeId(),layout.getColorSchemeId(),layout.getWapThemeId(),layout.getWapColorSchemeId(),layout.getCss(),serviceContext);
  if (layoutBranch.isMaster()) {
    return layoutRevision;
  }
  layoutBranch=layoutBranchLocalService.getMasterLayoutBranch(layoutBranch.getGroupId());
  layoutRevisions=layoutRevisionPersistence.findByL_P(layoutBranch.getLayoutBranchId(),plid,0,1);
  if (layoutRevisions.isEmpty()) {
    addLayoutRevision(layoutBranch.getUserId(),layoutBranch.getLayoutBranchId(),LayoutRevisionConstants.DEFAULT_PARENT_LAYOUT_REVISION_ID,false,plid,layout.getName(),layout.getTitle(),layout.getDescription(),layout.getTypeSettings(),layout.isIconImage(),layout.getIconImageId(),layout.getThemeId(),layout.getColorSchemeId(),layout.getWapThemeId(),layout.getWapColorSchemeId(),layout.getCss(),serviceContext);
  }
  return layoutRevision;
}
