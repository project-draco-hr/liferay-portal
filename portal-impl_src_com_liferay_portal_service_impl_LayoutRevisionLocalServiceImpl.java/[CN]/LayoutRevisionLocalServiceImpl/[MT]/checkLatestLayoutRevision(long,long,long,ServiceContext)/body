{
  LayoutSetBranch layoutSetBranch=layoutSetBranchPersistence.findByPrimaryKey(layoutSetBranchId);
  LayoutRevision layoutRevision=null;
  if (layoutRevisionId > 0) {
    layoutRevision=layoutRevisionPersistence.fetchByPrimaryKey(layoutRevisionId);
  }
  List<LayoutRevision> layoutRevisions=null;
  if (layoutRevision == null) {
    layoutRevisions=layoutRevisionPersistence.findByL_P(layoutSetBranchId,plid,0,1);
    if (!layoutRevisions.isEmpty()) {
      layoutRevision=layoutRevisions.get(0);
    }
  }
  if (layoutRevision != null) {
    return layoutRevision;
  }
  Layout layout=layoutPersistence.findByPrimaryKey(plid);
  layoutRevision=addLayoutRevision(layoutSetBranch.getUserId(),layoutSetBranch.getLayoutSetBranchId(),LayoutRevisionConstants.DEFAULT_PARENT_LAYOUT_REVISION_ID,false,plid,layout.getName(),layout.getTitle(),layout.getDescription(),layout.getTypeSettings(),layout.isIconImage(),layout.getIconImageId(),layout.getThemeId(),layout.getColorSchemeId(),layout.getWapThemeId(),layout.getWapColorSchemeId(),layout.getCss(),serviceContext);
  if (layoutSetBranch.isMaster()) {
    return layoutRevision;
  }
  layoutSetBranch=layoutSetBranchLocalService.getMasterLayoutSetBranch(layoutSetBranch.getGroupId(),layoutSetBranch.getPrivateLayout());
  layoutRevisions=layoutRevisionPersistence.findByL_P(layoutSetBranch.getLayoutSetBranchId(),plid,0,1);
  if (layoutRevisions.isEmpty()) {
    addLayoutRevision(layoutSetBranch.getUserId(),layoutSetBranch.getLayoutSetBranchId(),LayoutRevisionConstants.DEFAULT_PARENT_LAYOUT_REVISION_ID,false,plid,layout.getName(),layout.getTitle(),layout.getDescription(),layout.getTypeSettings(),layout.isIconImage(),layout.getIconImageId(),layout.getThemeId(),layout.getColorSchemeId(),layout.getWapThemeId(),layout.getWapColorSchemeId(),layout.getCss(),serviceContext);
  }
  return layoutRevision;
}
