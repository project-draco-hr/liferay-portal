{
  long parentLayoutRevisionId=layoutRevision.getParentLayoutRevisionId();
  boolean fork=false;
  while (parentLayoutRevisionId != LayoutRevisionConstants.DEFAULT_PARENT_LAYOUT_REVISION_ID) {
    LayoutRevision parentLayoutRevision=layoutRevisionPersistence.findByPrimaryKey(parentLayoutRevisionId);
    if (parentLayoutRevision.isMajor()) {
      break;
    }
    parentLayoutRevisionId=parentLayoutRevision.getParentLayoutRevisionId();
    if (parentLayoutRevision.getChildren().size() > 1) {
      fork=true;
    }
    if (!fork) {
      layoutRevisionLocalService.deleteLayoutRevision(parentLayoutRevision);
    }
  }
  layoutRevision.setParentLayoutRevisionId(parentLayoutRevisionId);
  layoutRevision.setMajor(true);
  layoutRevisionPersistence.update(layoutRevision);
  return layoutRevision;
}
