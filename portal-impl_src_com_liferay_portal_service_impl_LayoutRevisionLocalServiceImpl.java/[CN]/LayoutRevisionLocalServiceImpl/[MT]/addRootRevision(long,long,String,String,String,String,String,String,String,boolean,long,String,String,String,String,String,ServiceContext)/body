{
  User user=userPersistence.findByPrimaryKey(userId);
  LayoutRevision oldLayoutRevision=layoutRevisionPersistence.findByPrimaryKey(layoutRevisionId);
  Date now=new Date();
  LayoutRevision layoutRevision=null;
  long newLayoutRevisionId=counterLocalService.increment();
  layoutRevision=layoutRevisionPersistence.create(newLayoutRevisionId);
  layoutRevision.setGroupId(oldLayoutRevision.getGroupId());
  layoutRevision.setCompanyId(oldLayoutRevision.getCompanyId());
  layoutRevision.setUserId(user.getUserId());
  layoutRevision.setUserName(user.getFullName());
  layoutRevision.setCreateDate(serviceContext.getCreateDate(now));
  layoutRevision.setModifiedDate(serviceContext.getModifiedDate(now));
  layoutRevision.setLayoutSetBranchId(oldLayoutRevision.getLayoutSetBranchId());
  layoutRevision.setParentLayoutRevisionId(LayoutRevisionConstants.DEFAULT_PARENT_LAYOUT_REVISION_ID);
  layoutRevision.setMajor(true);
  layoutRevision.setHead(false);
  layoutRevision.setVariationName(variationName);
  layoutRevision.setPlid(oldLayoutRevision.getPlid());
  layoutRevision.setPrivateLayout(oldLayoutRevision.isPrivateLayout());
  layoutRevision.setName(name);
  layoutRevision.setTitle(title);
  layoutRevision.setDescription(description);
  layoutRevision.setKeywords(keywords);
  layoutRevision.setRobots(robots);
  layoutRevision.setTypeSettings(typeSettings);
  if (iconImage) {
    layoutRevision.setIconImage(iconImage);
    layoutRevision.setIconImageId(iconImageId);
  }
  layoutRevision.setThemeId(themeId);
  layoutRevision.setColorSchemeId(colorSchemeId);
  layoutRevision.setWapThemeId(wapThemeId);
  layoutRevision.setWapColorSchemeId(wapColorSchemeId);
  layoutRevision.setCss(css);
  layoutRevision.setStatus(WorkflowConstants.STATUS_DRAFT);
  layoutRevision.setStatusDate(serviceContext.getModifiedDate(now));
  layoutRevisionPersistence.update(layoutRevision,false);
  copyPortletPreferences(layoutRevision,layoutRevision.getParentLayoutRevisionId(),serviceContext);
  StagingUtil.setRecentLayoutRevisionId(user,layoutRevision.getLayoutSetBranchId(),layoutRevision.getPlid(),layoutRevision.getLayoutRevisionId());
  updateMajor(layoutRevision);
  return layoutRevision;
}
