{
  PermissionChecker permissionChecker=getPermissionChecker();
  if (alert) {
    AnnouncementsEntryPermission.check(permissionChecker,plid,PortletKeys.ALERTS,ActionKeys.ADD_ENTRY);
  }
 else {
    AnnouncementsEntryPermission.check(permissionChecker,plid,PortletKeys.ANNOUNCEMENTS,ActionKeys.ADD_ENTRY);
  }
  if (classNameId == 0) {
    if (!permissionChecker.isOmniadmin()) {
      throw new PrincipalException();
    }
  }
 else {
    String className=PortalUtil.getClassName(classNameId);
    if (className.equals(Group.class.getName()) && !GroupPermissionUtil.contains(permissionChecker,classPK,ActionKeys.MANAGE_ANNOUNCEMENTS)) {
      throw new PrincipalException();
    }
    if (className.equals(Organization.class.getName()) && !OrganizationPermissionUtil.contains(permissionChecker,classPK,ActionKeys.MANAGE_ANNOUNCEMENTS)) {
      throw new PrincipalException();
    }
    if (className.equals(Role.class.getName())) {
      Role role=roleLocalService.getRole(classPK);
      if (role.isTeam()) {
        Team team=teamLocalService.getTeam(role.getClassPK());
        if (!GroupPermissionUtil.contains(permissionChecker,team.getGroupId(),ActionKeys.MANAGE_ANNOUNCEMENTS) || !RolePermissionUtil.contains(permissionChecker,team.getGroupId(),classPK,ActionKeys.MANAGE_ANNOUNCEMENTS)) {
          throw new PrincipalException();
        }
      }
 else       if (!RolePermissionUtil.contains(permissionChecker,classPK,ActionKeys.MANAGE_ANNOUNCEMENTS)) {
        throw new PrincipalException();
      }
    }
    if (className.equals(UserGroup.class.getName()) && !UserGroupPermissionUtil.contains(permissionChecker,classPK,ActionKeys.MANAGE_ANNOUNCEMENTS)) {
      throw new PrincipalException();
    }
  }
  return announcementsEntryLocalService.addEntry(getUserId(),classNameId,classPK,title,content,url,type,displayDateMonth,displayDateDay,displayDateYear,displayDateHour,displayDateMinute,displayImmediately,expirationDateMonth,expirationDateDay,expirationDateYear,expirationDateHour,expirationDateMinute,priority,alert);
}
