{
  try {
    Template template=TemplateManagerUtil.getTemplate(TemplateManager.VELOCITY,_templateResource,TemplateContextType.STANDARD);
    template.put("companyId",companyId);
    template.put("contextLine",Diff.CONTEXT_LINE);
    template.put("diffUtil",new DiffUtil());
    template.put("languageUtil",LanguageUtil.getLanguage());
    template.put("locale",locale);
    String sourceContent=StringPool.BLANK;
    String targetContent=StringPool.BLANK;
    if (latestPage != null) {
      sourceContent=WikiUtil.convert(latestPage,null,null,null);
    }
    if (page != null) {
      targetContent=WikiUtil.convert(page,null,null,null);
    }
    List<DiffResult>[] diffResults=DiffUtil.diff(new UnsyncStringReader(sourceContent),new UnsyncStringReader(targetContent));
    template.put("sourceResults",diffResults[0]);
    template.put("targetResults",diffResults[1]);
    UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
    template.processTemplate(unsyncStringWriter);
    return unsyncStringWriter.toString();
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
}
