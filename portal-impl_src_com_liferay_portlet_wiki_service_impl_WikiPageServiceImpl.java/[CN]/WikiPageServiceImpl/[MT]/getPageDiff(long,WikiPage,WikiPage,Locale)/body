{
  String sourceContent=WikiUtil.processContent(latestPage.getContent());
  String targetContent=WikiUtil.processContent(page.getContent());
  sourceContent=HtmlUtil.escape(sourceContent);
  targetContent=HtmlUtil.escape(targetContent);
  List<DiffResult>[] diffResults=DiffUtil.diff(new UnsyncStringReader(sourceContent),new UnsyncStringReader(targetContent));
  String velocityTemplateId="com/liferay/portlet/wiki/dependencies/rss.vm";
  String velocityTemplateContent=ContentUtil.get(velocityTemplateId);
  VelocityContext velocityContext=VelocityEngineUtil.getWrappedStandardToolsContext();
  velocityContext.put("companyId",companyId);
  velocityContext.put("contextLine",Diff.CONTEXT_LINE);
  velocityContext.put("diffUtil",new DiffUtil());
  velocityContext.put("languageUtil",LanguageUtil.getLanguage());
  velocityContext.put("locale",locale);
  velocityContext.put("sourceResults",diffResults[0]);
  velocityContext.put("targetResults",diffResults[1]);
  try {
    UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter(true);
    VelocityEngineUtil.mergeTemplate(velocityTemplateId,velocityTemplateContent,velocityContext,unsyncStringWriter);
    return unsyncStringWriter.toString();
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
}
