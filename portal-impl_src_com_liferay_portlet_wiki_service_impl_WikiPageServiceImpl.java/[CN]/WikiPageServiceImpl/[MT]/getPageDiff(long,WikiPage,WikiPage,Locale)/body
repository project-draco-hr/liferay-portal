{
  String sourceContent=WikiUtil.processContent(lastPageVersion.getContent());
  String targetContent=WikiUtil.processContent(page.getContent());
  sourceContent=Html.escape(sourceContent);
  targetContent=Html.escape(targetContent);
  List[] diffResults=DiffUtil.diff(new StringReader(sourceContent),new StringReader(targetContent));
  ClassLoader classLoader=getClass().getClassLoader();
  InputStream is=classLoader.getResourceAsStream("com/liferay/portlet/wiki/dependencies/rss.vm");
  String template=StringUtil.read(is);
  is.close();
  Map<String,Object> variables=new HashMap<String,Object>();
  variables.put("languageUtil",LanguageUtil.getLanguage());
  variables.put("locale",locale);
  variables.put("contextLine",DiffUtil.CONTEXT_LINE);
  variables.put("diffUtil",new DiffUtil());
  variables.put("companyId",companyId);
  variables.put("sourceResults",diffResults[0]);
  variables.put("targetResults",diffResults[1]);
  return VelocityUtil.evaluate(template,variables);
}
