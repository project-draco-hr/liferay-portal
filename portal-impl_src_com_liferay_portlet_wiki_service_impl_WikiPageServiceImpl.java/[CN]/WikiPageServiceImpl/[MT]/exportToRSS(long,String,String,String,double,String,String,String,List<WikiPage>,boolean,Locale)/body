{
  SyndFeed syndFeed=new SyndFeedImpl();
  syndFeed.setFeedType(RSSUtil.getFeedType(type,version));
  syndFeed.setTitle(name);
  syndFeed.setLink(feedURL);
  syndFeed.setDescription(description);
  List<SyndEntry> syndEntries=new ArrayList<SyndEntry>();
  syndFeed.setEntries(syndEntries);
  WikiPage latestPage=null;
  StringBundler link=new StringBundler(7);
  for (  WikiPage page : pages) {
    String author=HtmlUtil.escape(PortalUtil.getUserName(page.getUserId(),page.getUserName()));
    String title=page.getTitle() + StringPool.SPACE + page.getVersion();
    if (page.isMinorEdit()) {
      title+=StringPool.SPACE + StringPool.OPEN_PARENTHESIS + LanguageUtil.get(locale,"minor-edit")+ StringPool.CLOSE_PARENTHESIS;
    }
    link.setIndex(0);
    link.append(entryURL);
    link.append(StringPool.AMPERSAND);
    link.append(HttpUtil.encodeURL(page.getTitle()));
    SyndEntry syndEntry=new SyndEntryImpl();
    syndEntry.setAuthor(author);
    syndEntry.setTitle(title);
    syndEntry.setPublishedDate(page.getCreateDate());
    syndEntry.setUpdatedDate(page.getModifiedDate());
    SyndContent syndContent=new SyndContentImpl();
    syndContent.setType(RSSUtil.ENTRY_TYPE_DEFAULT);
    if (diff) {
      if (latestPage != null) {
        link.append(StringPool.QUESTION);
        link.append(PortalUtil.getPortletNamespace(PortletKeys.WIKI));
        link.append("version=");
        link.append(page.getVersion());
        String value=getPageDiff(companyId,latestPage,page,locale);
        syndContent.setValue(value);
        syndEntry.setDescription(syndContent);
        syndEntries.add(syndEntry);
      }
    }
 else {
      String value=null;
      if (displayStyle.equals(RSSUtil.DISPLAY_STYLE_ABSTRACT)) {
        value=StringUtil.shorten(HtmlUtil.extractText(page.getContent()),_RSS_ABSTRACT_LENGTH,StringPool.BLANK);
      }
 else       if (displayStyle.equals(RSSUtil.DISPLAY_STYLE_TITLE)) {
        value=StringPool.BLANK;
      }
 else {
        value=page.getContent();
      }
      syndContent.setValue(value);
      syndEntry.setDescription(syndContent);
      syndEntries.add(syndEntry);
    }
    syndEntry.setLink(link.toString());
    syndEntry.setUri(syndEntry.getLink());
    latestPage=page;
  }
  try {
    return RSSUtil.export(syndFeed);
  }
 catch (  FeedException fe) {
    throw new SystemException(fe);
  }
}
