{
  Map<String,Object> context=_getContext();
  context.put("entities",_ejbList);
  String content=_processTemplate(_tplSpringXml,context);
  File xmlFile=new File(_springFileName);
  if (!xmlFile.exists()) {
    String xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" + "\n" + "<beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd\">\n"+ "</beans>";
    FileUtil.write(xmlFile,xml);
  }
  String oldContent=FileUtil.read(xmlFile);
  String newContent=_fixSpringXML(oldContent);
  int x=oldContent.indexOf("<beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd\">\n");
  int y=oldContent.lastIndexOf("</beans>");
  int firstSession=newContent.indexOf("<bean id=\"" + _packagePath + ".service.",x);
  int lastSession=newContent.lastIndexOf("<bean id=\"" + _packagePath + ".service.",y);
  if (firstSession == -1 || firstSession > y) {
    x=newContent.indexOf("</beans>");
    newContent=newContent.substring(0,x) + content + newContent.substring(x,newContent.length());
  }
 else {
    firstSession=newContent.lastIndexOf("<bean",firstSession) - 1;
    lastSession=newContent.indexOf("</bean>",lastSession) + 8;
    newContent=newContent.substring(0,firstSession) + content + newContent.substring(lastSession,newContent.length());
  }
  newContent=_formatXML(newContent);
  if (!oldContent.equals(newContent)) {
    FileUtil.write(xmlFile,newContent);
  }
}
