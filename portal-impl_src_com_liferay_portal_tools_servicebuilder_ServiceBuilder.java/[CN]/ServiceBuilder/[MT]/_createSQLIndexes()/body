{
  if (!FileUtil.exists(_sqlDir)) {
    return;
  }
  File sqlFile=new File(_sqlDir + "/" + _sqlIndexesFileName);
  if (!sqlFile.exists()) {
    FileUtil.write(sqlFile,"");
  }
  Map<String,String> indexSQLs=new TreeMap<String,String>();
  BufferedReader br=new BufferedReader(new FileReader(sqlFile));
  while (true) {
    String indexSQL=br.readLine();
    if (indexSQL == null) {
      break;
    }
    if (Validator.isNotNull(indexSQL.trim())) {
      int pos=indexSQL.indexOf(" on ");
      String indexSpec=indexSQL.substring(pos + 4);
      indexSQLs.put(indexSpec,indexSQL);
    }
  }
  br.close();
  File propsFile=new File(_sqlDir + "/" + _sqlIndexesPropertiesFileName);
  if (!propsFile.exists()) {
    FileUtil.write(propsFile,"");
  }
  Map<String,String> indexProps=new TreeMap<String,String>();
  br=new BufferedReader(new FileReader(propsFile));
  while (true) {
    String indexMapping=br.readLine();
    if (indexMapping == null) {
      break;
    }
    if (Validator.isNotNull(indexMapping.trim())) {
      String[] splitIndexMapping=indexMapping.split("\\=");
      indexProps.put(splitIndexMapping[1],splitIndexMapping[0]);
    }
  }
  br.close();
  for (int i=0; i < _ejbList.size(); i++) {
    Entity entity=_ejbList.get(i);
    if (!entity.isDefaultDataSource()) {
      continue;
    }
    List<EntityFinder> finderList=entity.getFinderList();
    for (int j=0; j < finderList.size(); j++) {
      EntityFinder finder=finderList.get(j);
      if (finder.isDBIndex()) {
        StringBuilder sb=new StringBuilder();
        sb.append(entity.getTable() + " (");
        List<EntityColumn> finderColsList=finder.getColumns();
        for (int k=0; k < finderColsList.size(); k++) {
          EntityColumn col=finderColsList.get(k);
          sb.append(col.getDBName());
          if ((k + 1) != finderColsList.size()) {
            sb.append(", ");
          }
        }
        sb.append(");");
        String indexSpec=sb.toString();
        String indexHash=Integer.toHexString(indexSpec.hashCode()).toUpperCase();
        String indexName="IX_" + indexHash;
        sb=new StringBuilder();
        sb.append("create ");
        if (!finder.isCollection()) {
          sb.append("unique ");
        }
        sb.append("index " + indexName + " on ");
        sb.append(indexSpec);
        indexSQLs.put(indexSpec,sb.toString());
        String finderName=entity.getTable() + StringPool.PERIOD + finder.getName();
        indexProps.put(finderName,indexName);
      }
    }
  }
  for (  Map.Entry<String,EntityMapping> entry : _entityMappings.entrySet()) {
    EntityMapping entityMapping=entry.getValue();
    _getCreateMappingTableIndex(entityMapping,indexSQLs,indexProps);
  }
  StringBuilder sb=new StringBuilder();
  Iterator<String> itr=indexSQLs.values().iterator();
  String prevEntityName=null;
  while (itr.hasNext()) {
    String indexSQL=itr.next();
    int pos=indexSQL.indexOf(" on ");
    String indexSQLSuffix=indexSQL.substring(pos + 4);
    String entityName=indexSQLSuffix.split(" ")[0];
    if ((prevEntityName != null) && (!prevEntityName.equals(entityName))) {
      sb.append("\n");
    }
    sb.append(indexSQL);
    if (itr.hasNext()) {
      sb.append("\n");
    }
    prevEntityName=entityName;
  }
  FileUtil.write(sqlFile,sb.toString(),true);
  sb=new StringBuilder();
  itr=indexProps.keySet().iterator();
  prevEntityName=null;
  while (itr.hasNext()) {
    String finderName=itr.next();
    String indexName=indexProps.get(finderName);
    String entityName=finderName.split("\\.")[0];
    if ((prevEntityName != null) && (!prevEntityName.equals(entityName))) {
      sb.append("\n");
    }
    sb.append(indexName + StringPool.EQUAL + finderName);
    if (itr.hasNext()) {
      sb.append("\n");
    }
    prevEntityName=entityName;
  }
  FileUtil.write(propsFile,sb.toString(),true);
}
