{
  Map<String,Object> context=_getContext();
  context.put("entities",_ejbList);
  String content=_processTemplate(_tplOrmXml,context);
  File xmlFile=new File(_ormFileName);
  if (!xmlFile.exists()) {
    String xml="<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" + "<entity-mappings xmlns=\"http://java.sun.com/xml/ns/persistence/orm\"\n" + "	xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n"+ "	xsi:schemaLocation=\"http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_1_0.xsd\"\n"+ "	version=\"1.0\">\n"+ "	<persistence-unit-metadata>\n"+ "		<xml-mapping-metadata-complete/>\n"+ "		<persistence-unit-defaults>\n"+ "			<access>PROPERTY</access>\n"+ "		</persistence-unit-defaults>\n"+ "	</persistence-unit-metadata>\n"+ "</entity-mappings>";
    FileUtil.write(xmlFile,xml);
  }
  String oldContent=FileUtil.read(xmlFile);
  String newContent=oldContent;
  int firstEntity=newContent.indexOf("<entity class=\"" + _packagePath + ".model.impl.");
  int lastEntity=newContent.lastIndexOf("<entity class=\"" + _packagePath + ".model.impl.");
  if (firstEntity == -1) {
    int x=newContent.indexOf("</entity-mappings>");
    if (x != -1) {
      newContent=newContent.substring(0,x) + content + newContent.substring(x,newContent.length());
    }
  }
 else {
    firstEntity=newContent.lastIndexOf("<entity",firstEntity) - 1;
    lastEntity=newContent.indexOf("</entity>",lastEntity) + 9;
    newContent=newContent.substring(0,firstEntity) + content + newContent.substring(lastEntity,newContent.length());
  }
  newContent=_formatXml(newContent);
  if (!oldContent.equals(newContent)) {
    FileUtil.write(xmlFile,newContent);
  }
}
