{
  StringBuilder content=new StringBuilder();
  if (_ejbList.size() > 0) {
    content.append(_processTemplate(_tplJsonJs));
  }
  for (int i=0; i < _ejbList.size(); i++) {
    Entity entity=_ejbList.get(i);
    if (entity.hasRemoteService()) {
      JavaClass javaClass=_getJavaClass(_serviceOutputPath + "/service/" + entity.getName()+ "Service.java");
      JavaMethod[] methods=_getMethods(javaClass);
      Set<String> jsonMethods=new LinkedHashSet<String>();
      for (      JavaMethod method : methods) {
        String methodName=method.getName();
        String returnValue=getReturnType(method);
        boolean hasBadParameter=false;
        for (        JavaParameter parameter : method.getParameters()) {
          String paramValue=getParameterType(parameter);
          if (_badJSONReturnOrParameterTypes.contains(paramValue)) {
            hasBadParameter=true;
          }
        }
        if ((method.isPublic()) && (!_badJSONReturnOrParameterTypes.contains(returnValue)) && (!hasBadParameter)) {
          jsonMethods.add(methodName);
        }
      }
      if (jsonMethods.size() > 0) {
        Map<String,Object> context=_getContext();
        context.put("entity",entity);
        context.put("methods",jsonMethods);
        content.append("\n\n");
        content.append(_processTemplate(_tplJsonJsMethod,context));
      }
    }
  }
  File jsonFile=new File(_jsonFileName);
  if (!jsonFile.exists()) {
    FileUtil.write(jsonFile,"");
  }
  String oldContent=FileUtil.read(jsonFile);
  String newContent=new String(oldContent);
  int oldBegin=oldContent.indexOf("Liferay.Service.register(\"Liferay.Service." + _portletShortName);
  int oldEnd=oldContent.lastIndexOf("Liferay.Service." + _portletShortName);
  oldEnd=oldContent.indexOf(");",oldEnd);
  int newBegin=newContent.indexOf("Liferay.Service.register(\"Liferay.Service." + _portletShortName);
  int newEnd=newContent.lastIndexOf("Liferay.Service." + _portletShortName);
  newEnd=newContent.indexOf(");",newEnd);
  if (newBegin == -1) {
    newContent=oldContent + "\n\n" + content.toString().trim();
  }
 else {
    newContent=newContent.substring(0,oldBegin) + content.toString().trim() + newContent.substring(oldEnd + 2,newContent.length());
  }
  newContent=newContent.trim();
  if (!oldContent.equals(newContent)) {
    FileUtil.write(jsonFile,newContent);
  }
}
