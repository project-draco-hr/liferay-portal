{
  Map<String,Object> context=_getContext();
  context.put("entities",_ejbList);
  String content=_processTemplate(_tplHbmXml,context);
  File xmlFile=new File(_hbmFileName);
  if (!xmlFile.exists()) {
    String xml="<?xml version=\"1.0\"?>\n" + "<!DOCTYPE hibernate-mapping PUBLIC \"-//Hibernate/Hibernate Mapping DTD 3.0//EN\" \"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd\">\n" + "\n"+ "<hibernate-mapping default-lazy=\"false\" auto-import=\"false\">\n"+ "</hibernate-mapping>";
    FileUtil.write(xmlFile,xml);
  }
  String oldContent=FileUtil.read(xmlFile);
  String newContent=_fixHBMXML(oldContent);
  int firstClass=newContent.indexOf("<class name=\"" + _packagePath + ".model.impl.");
  int lastClass=newContent.lastIndexOf("<class name=\"" + _packagePath + ".model.impl.");
  if (firstClass == -1) {
    int x=newContent.indexOf("</hibernate-mapping>");
    newContent=newContent.substring(0,x) + content + newContent.substring(x,newContent.length());
  }
 else {
    firstClass=newContent.lastIndexOf("<class",firstClass) - 1;
    lastClass=newContent.indexOf("</class>",lastClass) + 9;
    newContent=newContent.substring(0,firstClass) + content + newContent.substring(lastClass,newContent.length());
  }
  newContent=_formatXML(newContent);
  if (!oldContent.equals(newContent)) {
    FileUtil.write(xmlFile,newContent);
  }
}
