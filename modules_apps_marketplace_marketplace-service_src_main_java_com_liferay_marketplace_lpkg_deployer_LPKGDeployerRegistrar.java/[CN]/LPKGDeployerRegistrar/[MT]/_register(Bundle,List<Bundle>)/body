{
  URL url=lpkgBundle.getEntry("liferay-marketplace.properties");
  Properties properties=PropertiesUtil.load(url.openStream(),StringPool.ISO_8859_1);
  long remoteAppId=GetterUtil.getLong(properties.getProperty("remote-app-id"));
  String version=properties.getProperty("version");
  if ((remoteAppId <= 0) || Validator.isNull(version)) {
    return;
  }
  String title=properties.getProperty("title");
  String description=properties.getProperty("description");
  String category=properties.getProperty("category");
  String iconURL=properties.getProperty("icon-url");
  boolean required=GetterUtil.getBoolean(properties.getProperty("required"));
  App app=_appLocalService.updateApp(0,remoteAppId,title,description,category,iconURL,version,required,null);
  _moduleLocalService.deleteModules(app.getAppId());
  if (!bundles.isEmpty()) {
    for (    Bundle bundle : bundles) {
      Dictionary<String,String> headers=bundle.getHeaders();
      String contextName=ContextUtil.getContextName(GetterUtil.getString(headers.get("Web-ContextPath")));
      _moduleLocalService.addModule(app.getUserId(),app.getAppId(),bundle.getSymbolicName(),String.valueOf(bundle.getVersion()),contextName);
    }
  }
 else {
    String[] bundleStrings=StringUtil.split(properties.getProperty("bundles"));
    for (    String bundleString : bundleStrings) {
      String[] bundleStringParts=StringUtil.split(bundleString,CharPool.POUND);
      String bundleSymbolicName=bundleStringParts[0];
      String bundleVersion=bundleStringParts[1];
      String contextName=bundleStringParts[2];
      _moduleLocalService.addModule(0,app.getAppId(),bundleSymbolicName,bundleVersion,contextName);
    }
    String[] contextNames=StringUtil.split(properties.getProperty("context-names"));
    for (    String contextName : contextNames) {
      _moduleLocalService.addModule(0,app.getAppId(),StringPool.BLANK,StringPool.BLANK,contextName);
    }
  }
}
