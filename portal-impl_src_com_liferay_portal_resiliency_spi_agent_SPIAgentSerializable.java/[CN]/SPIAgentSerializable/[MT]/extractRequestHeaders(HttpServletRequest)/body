{
  Map<String,List<String>> headers=new HashMap<String,List<String>>();
  Enumeration<String> nameEnumeration=request.getHeaderNames();
  while (nameEnumeration.hasMoreElements()) {
    String headerName=nameEnumeration.nextElement();
    if (HttpHeaders.ACCEPT_ENCODING.equalsIgnoreCase(headerName)) {
      continue;
    }
    if (HttpHeaders.COOKIE.equalsIgnoreCase(headerName)) {
      continue;
    }
    Enumeration<String> valueEnumeration=request.getHeaders(headerName);
    if (valueEnumeration != null) {
      List<String> values=new ArrayList<String>();
      while (valueEnumeration.hasMoreElements()) {
        values.add(valueEnumeration.nextElement());
      }
      if (values.isEmpty()) {
        values=Collections.emptyList();
      }
      headers.put(headerName.toLowerCase(),values);
    }
  }
  if (headers.isEmpty()) {
    headers=Collections.emptyMap();
  }
  return headers;
}
