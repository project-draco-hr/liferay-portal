{
  if (SearchEngineUtil.isIndexReadOnly()) {
    return;
  }
synchronized (this) {
    IndexWriter indexWriter=null;
    try {
      indexWriter=new IndexWriter(LuceneHelperUtil.getLuceneDir(companyId),LuceneHelperUtil.getAnalyzer(),IndexWriter.MaxFieldLength.LIMITED);
      if (document != null) {
        indexWriter.setMergeFactor(PropsValues.LUCENE_MERGE_FACTOR);
        indexWriter.addDocument(document);
        _optimizeCount++;
        if ((PropsValues.LUCENE_OPTIMIZE_INTERVAL == 0) || (_optimizeCount >= PropsValues.LUCENE_OPTIMIZE_INTERVAL)) {
          indexWriter.optimize();
          _optimizeCount=0;
        }
      }
    }
  finally {
      if (indexWriter != null) {
        indexWriter.close();
      }
    }
  }
}
