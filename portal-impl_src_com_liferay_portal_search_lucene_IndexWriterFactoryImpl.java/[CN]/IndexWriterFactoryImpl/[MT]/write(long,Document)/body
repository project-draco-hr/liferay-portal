{
  if (SearchEngineUtil.isIndexReadOnly()) {
    return;
  }
synchronized (this) {
    IndexWriter writer=null;
    try {
      writer=new IndexWriter(LuceneUtil.getLuceneDir(companyId),LuceneUtil.getAnalyzer(),IndexWriter.MaxFieldLength.LIMITED);
      if (doc != null) {
        writer.setMergeFactor(_MERGE_FACTOR);
        writer.addDocument(doc);
        _optimizeCount++;
        if ((_OPTIMIZE_INTERVAL == 0) || (_optimizeCount >= _OPTIMIZE_INTERVAL)) {
          writer.optimize();
          _optimizeCount=0;
        }
      }
    }
  finally {
      if (writer != null) {
        writer.close();
      }
    }
  }
}
