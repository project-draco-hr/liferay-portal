{
  if (hasFile(companyId,repositoryId,fileName)) {
    throw new DuplicateFileException(companyId,repositoryId,fileName);
  }
  try {
    ObjectMetadata objectMetadata=constructMetadata(fileName);
    String objectKey=_s3KeyTransformer.getFileVersionKey(companyId,repositoryId,fileName,VERSION_DEFAULT);
    PutObjectRequest putObjectRequest=new PutObjectRequest(_bucketName,objectKey,is,objectMetadata);
    putObjectRequest.withStorageClass(_storageClass);
    _amazonS3.putObject(putObjectRequest);
  }
 catch (  AmazonClientException ae) {
    throw convertAWSException(ae);
  }
 finally {
    StreamUtil.cleanUp(is);
  }
}
