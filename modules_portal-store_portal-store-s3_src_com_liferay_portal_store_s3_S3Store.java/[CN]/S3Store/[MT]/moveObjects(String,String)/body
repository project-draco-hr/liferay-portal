{
  ObjectListing objectListing=_amazonS3.listObjects(_bucketName,newPrefix);
  List<S3ObjectSummary> newS3ObjectSummaries=objectListing.getObjectSummaries();
  if (!newS3ObjectSummaries.isEmpty()) {
    throw new DuplicateFileException("Duplicate S3 object found when moving files from " + oldPrefix + " to "+ newPrefix);
  }
  List<S3ObjectSummary> oldS3ObjectSummaries=getS3ObjectSummaries(oldPrefix);
  for (  S3ObjectSummary s3ObjectSummary : oldS3ObjectSummaries) {
    String oldKey=s3ObjectSummary.getKey();
    String newKey=_s3KeyTransformer.moveKey(oldKey,oldPrefix,newPrefix);
    CopyObjectRequest copyObjectRequest=new CopyObjectRequest(_bucketName,oldKey,_bucketName,newKey);
    _amazonS3.copyObject(copyObjectRequest);
  }
  for (  S3ObjectSummary objectSummary : oldS3ObjectSummaries) {
    String oldKey=objectSummary.getKey();
    DeleteObjectRequest deleteObjectRequest=new DeleteObjectRequest(_bucketName,oldKey);
    _amazonS3.deleteObject(deleteObjectRequest);
  }
}
