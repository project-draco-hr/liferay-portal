{
  Message message=new Message();
  String destinationName="destinationName";
  message.setDestinationName(destinationName);
  boolean synchronizedBridge=false;
  MessageRoutingBag messageRoutingBag=new MessageRoutingBag(message,synchronizedBridge);
  String routingId1="routingId1";
  String routingId2="routingId2";
  messageRoutingBag.appendRoutingId(routingId1);
  messageRoutingBag.appendRoutingId(routingId2);
  boolean routingDowncast=true;
  messageRoutingBag.setRoutingDowncast(routingDowncast);
  byte[] data=messageRoutingBag.toByteArray();
  MessageRoutingBag newMessageRoutingBag=MessageRoutingBag.fromByteArray(data);
  Assert.assertEquals(destinationName,newMessageRoutingBag.getDestinationName());
  Field messageField=ReflectionUtil.getDeclaredField(MessageRoutingBag.class,"_message");
  Assert.assertNull(messageField.get(newMessageRoutingBag));
  Assert.assertNotNull(newMessageRoutingBag.getMessageData());
  Assert.assertEquals(routingDowncast,newMessageRoutingBag.isRoutingDowncast());
  Field routingTraceField=ReflectionUtil.getDeclaredField(MessageRoutingBag.class,"_routingTrace");
  List<String> routingTrace=(List<String>)routingTraceField.get(newMessageRoutingBag);
  Assert.assertEquals(2,routingTrace.size());
  Assert.assertEquals(routingId1,routingTrace.get(0));
  Assert.assertEquals(routingId2,routingTrace.get(1));
  Assert.assertTrue(newMessageRoutingBag.isVisited(routingId1));
  Assert.assertTrue(newMessageRoutingBag.isVisited(routingId2));
  Assert.assertFalse(newMessageRoutingBag.isVisited("routingId3"));
  Assert.assertEquals(synchronizedBridge,newMessageRoutingBag.isSynchronizedBridge());
  Message newMessage=newMessageRoutingBag.getMessage();
  Assert.assertNotNull(newMessage);
  Field messageDataField=ReflectionUtil.getDeclaredField(MessageRoutingBag.class,"_messageData");
  Assert.assertNull(messageDataField.get(newMessageRoutingBag));
  Assert.assertSame(newMessage,newMessageRoutingBag.getMessage());
}
