{
  if (params.isEmpty()) {
    return StringUtil.replace(sql,new String[]{"[$JOIN$]","[$WHERE$]"},new String[]{StringPool.BLANK,StringPool.BLANK});
  }
  StringBundler sb=new StringBundler(params.size() + 1);
  sb.append(sql);
  for (  String key : params.keySet()) {
    sb.append(key);
  }
  String cacheKey=sb.toString();
  String resultSQL=_replaceJoinAndWhereSQLCache.get(cacheKey);
  if (resultSQL == null) {
    sql=StringUtil.replace(sql,"[$JOIN$]",getJoin(params));
    resultSQL=StringUtil.replace(sql,"[$WHERE$]",getWhere(params));
    _replaceJoinAndWhereSQLCache.put(cacheKey,resultSQL);
  }
  return resultSQL;
}
