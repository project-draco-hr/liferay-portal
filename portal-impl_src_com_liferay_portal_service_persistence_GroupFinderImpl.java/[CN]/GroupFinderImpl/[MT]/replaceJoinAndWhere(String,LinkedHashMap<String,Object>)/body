{
  if (params.isEmpty()) {
    return StringUtil.replace(sql,new String[]{"[$JOIN$]","[$WHERE$]"},new String[]{StringPool.BLANK,StringPool.BLANK});
  }
  String cacheKey=_getCacheKey(sql,params);
  String resultSQL=_replaceJoinAndWhereSQLCache.get(cacheKey);
  if (resultSQL == null) {
    sql=StringUtil.replace(sql,"[$JOIN$]",getJoin(params));
    resultSQL=StringUtil.replace(sql,"[$WHERE$]",getWhere(params));
    _replaceJoinAndWhereSQLCache.put(cacheKey,resultSQL);
  }
  return resultSQL;
}
