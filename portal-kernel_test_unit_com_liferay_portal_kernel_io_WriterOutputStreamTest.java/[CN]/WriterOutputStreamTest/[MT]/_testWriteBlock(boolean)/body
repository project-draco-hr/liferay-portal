{
  final AtomicBoolean flushed=new AtomicBoolean();
  UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter(){
    @Override public void flush(){
      flushed.set(true);
    }
  }
;
  WriterOutputStream writerOutputStream=new WriterOutputStream(unsyncStringWriter,"US-ASCII",2,autoFlush);
  writerOutputStream.write(new byte[]{(byte)'a',(byte)'b',(byte)'c',(byte)'d',(byte)'e',(byte)'f',(byte)'g'},1,5);
  Assert.assertFalse(flushed.get());
  if (!autoFlush) {
    writerOutputStream.flush();
    Assert.assertTrue(flushed.get());
    flushed.set(false);
  }
  Assert.assertEquals("bcdef",unsyncStringWriter.toString());
  unsyncStringWriter.reset();
  writerOutputStream=new WriterOutputStream(unsyncStringWriter,"US-ASCII",4,autoFlush);
  writerOutputStream.write(new byte[]{(byte)'a',(byte)'b',(byte)'c',(byte)'d',(byte)'e',(byte)'f',(byte)'g'},1,5);
  Assert.assertFalse(flushed.get());
  if (!autoFlush) {
    writerOutputStream.flush();
    Assert.assertTrue(flushed.get());
    flushed.set(false);
  }
  Assert.assertEquals("bcdef",unsyncStringWriter.toString());
  unsyncStringWriter.reset();
  writerOutputStream=new WriterOutputStream(unsyncStringWriter,"US-ASCII",autoFlush);
  writerOutputStream.write(new byte[]{(byte)'a',(byte)'b',(byte)'c'});
  Assert.assertFalse(flushed.get());
  if (!autoFlush) {
    writerOutputStream.flush();
    Assert.assertTrue(flushed.get());
    flushed.set(false);
  }
  Assert.assertEquals("abc",unsyncStringWriter.toString());
}
