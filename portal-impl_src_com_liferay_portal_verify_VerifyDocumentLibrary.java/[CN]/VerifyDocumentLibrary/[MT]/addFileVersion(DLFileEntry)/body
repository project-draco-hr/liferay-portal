{
  long fileVersionId=CounterLocalServiceUtil.increment();
  DLFileVersion dlFileVersion=DLFileVersionLocalServiceUtil.createDLFileVersion(fileVersionId);
  dlFileVersion.setGroupId(dlFileEntry.getGroupId());
  dlFileVersion.setCompanyId(dlFileEntry.getCompanyId());
  long versionUserId=dlFileEntry.getVersionUserId();
  if (versionUserId <= 0) {
    versionUserId=dlFileEntry.getUserId();
  }
  dlFileVersion.setUserId(versionUserId);
  String versionUserName=GetterUtil.getString(dlFileEntry.getVersionUserName(),dlFileEntry.getUserName());
  dlFileVersion.setUserName(versionUserName);
  Date now=new Date();
  dlFileVersion.setCreateDate(dlFileEntry.getModifiedDate());
  dlFileVersion.setModifiedDate(dlFileEntry.getModifiedDate());
  dlFileVersion.setRepositoryId(dlFileEntry.getRepositoryId());
  dlFileVersion.setFolderId(dlFileEntry.getFolderId());
  dlFileVersion.setFileEntryId(dlFileEntry.getFileEntryId());
  dlFileVersion.setExtension(dlFileEntry.getExtension());
  dlFileVersion.setMimeType(dlFileEntry.getMimeType());
  dlFileVersion.setTitle(dlFileEntry.getTitle());
  dlFileVersion.setDescription(dlFileEntry.getDescription());
  dlFileVersion.setExtraSettings(dlFileEntry.getExtraSettings());
  dlFileVersion.setFileEntryTypeId(dlFileEntry.getFileEntryTypeId());
  dlFileVersion.setVersion(dlFileEntry.getVersion());
  dlFileVersion.setSize(dlFileEntry.getSize());
  dlFileVersion.setStatus(WorkflowConstants.STATUS_APPROVED);
  dlFileVersion.setStatusByUserId(versionUserId);
  dlFileVersion.setStatusByUserName(versionUserName);
  dlFileVersion.setStatusDate(now);
  DLFileVersionLocalServiceUtil.updateDLFileVersion(dlFileVersion);
}
