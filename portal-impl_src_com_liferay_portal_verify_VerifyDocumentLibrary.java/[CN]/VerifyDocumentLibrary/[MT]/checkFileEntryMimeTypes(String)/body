{
  ActionableDynamicQuery actionableDynamicQuery=new DLFileEntryActionableDynamicQuery(){
    @Override protected void performAction(    Object object) throws PortalException, SystemException {
      DLFileEntry dlFileEntry=(DLFileEntry)object;
      InputStream inputStream=null;
      try {
        inputStream=DLFileEntryLocalServiceUtil.getFileAsStream(dlFileEntry.getUserId(),dlFileEntry.getFileEntryId(),dlFileEntry.getVersion(),false);
      }
 catch (      Exception e) {
        if (_log.isWarnEnabled()) {
          _log.warn("Unable to find file entry " + dlFileEntry.getName(),e);
        }
        return;
      }
      String title=DLUtil.getTitleWithExtension(dlFileEntry.getTitle(),dlFileEntry.getExtension());
      String mimeType=null;
      try {
        mimeType=MimeTypesUtil.getContentType(inputStream,title);
      }
  finally {
        StreamUtil.cleanUp(inputStream);
      }
      if (mimeType.equals(originalMimeType)) {
        return;
      }
      dlFileEntry.setMimeType(mimeType);
      DLFileEntryLocalServiceUtil.updateDLFileEntry(dlFileEntry);
      DLFileVersion dlFileVersion=dlFileEntry.getFileVersion();
      dlFileVersion.setMimeType(mimeType);
      DLFileVersionLocalServiceUtil.updateDLFileVersion(dlFileVersion);
    }
  }
;
  actionableDynamicQuery.performActions();
}
