{
  ActionableDynamicQuery actionableDynamicQuery=new DLFileEntryActionableDynamicQuery(){
    @Override protected void performAction(    Object object) throws PortalException, SystemException {
      DLFileEntry dlFileEntry=(DLFileEntry)object;
      InputStream inputStream=null;
      try {
        inputStream=DLFileEntryLocalServiceUtil.getFileAsStream(dlFileEntry.getUserId(),dlFileEntry.getFileEntryId(),dlFileEntry.getVersion(),false);
      }
 catch (      Exception e) {
        _log.warn("File entry " + dlFileEntry.getName() + "not found: "+ e.getMessage());
        return;
      }
      String title=DLUtil.getTitleWithExtension(dlFileEntry.getTitle(),dlFileEntry.getExtension());
      String mimeType=MimeTypesUtil.getContentType(inputStream,title);
      if (mimeType.equals(originalMimeType)) {
        return;
      }
      dlFileEntry.setMimeType(mimeType);
      DLFileEntryLocalServiceUtil.updateDLFileEntry(dlFileEntry);
      DLFileVersion dlFileVersion=dlFileEntry.getFileVersion();
      dlFileVersion.setMimeType(mimeType);
      DLFileVersionLocalServiceUtil.updateDLFileVersion(dlFileVersion);
    }
  }
;
  actionableDynamicQuery.performActions();
}
