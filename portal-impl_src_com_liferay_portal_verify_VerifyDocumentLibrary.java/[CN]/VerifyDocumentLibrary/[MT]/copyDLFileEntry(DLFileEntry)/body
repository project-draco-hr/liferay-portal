{
  long companyId=dlFileEntry.getCompanyId();
  long dataRepositoryId=dlFileEntry.getDataRepositoryId();
  String name=dlFileEntry.getName();
  String version=dlFileEntry.getVersion();
  if (DLStoreUtil.hasFile(companyId,dataRepositoryId,name,version)) {
    return;
  }
  DLFileVersionVersionComparator comparator=new DLFileVersionVersionComparator();
  List<DLFileVersion> dlFileVersions=dlFileEntry.getFileVersions(WorkflowConstants.STATUS_APPROVED);
  if (dlFileVersions.isEmpty()) {
    dlFileVersions=dlFileEntry.getFileVersions(WorkflowConstants.STATUS_ANY);
  }
  if (dlFileVersions.isEmpty()) {
    DLStoreUtil.addFile(companyId,dataRepositoryId,name,new byte[0]);
    return;
  }
  dlFileVersions=ListUtil.copy(dlFileVersions);
  Collections.sort(dlFileVersions,comparator);
  DLFileVersion dlFileVersion=dlFileVersions.get(0);
  DLStoreUtil.copyFileVersion(companyId,dataRepositoryId,name,dlFileVersion.getVersion(),version);
}
