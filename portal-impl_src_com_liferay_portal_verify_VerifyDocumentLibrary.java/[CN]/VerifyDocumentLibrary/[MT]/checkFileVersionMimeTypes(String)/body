{
  List<DLFileVersion> dlFileVersions=DLFileVersionLocalServiceUtil.getFileVersionsByMimeType(originalMimeType);
  if (_log.isDebugEnabled()) {
    _log.debug("Processing " + dlFileVersions.size() + " file versions with "+ originalMimeType);
  }
  for (  DLFileVersion dlFileVersion : dlFileVersions) {
    InputStream inputStream=DLFileEntryLocalServiceUtil.getFileAsStream(dlFileVersion.getUserId(),dlFileVersion.getFileEntryId(),dlFileVersion.getVersion(),false);
    String title=DLUtil.getTitleWithExtension(dlFileVersion.getTitle(),dlFileVersion.getExtension());
    String mimeType=MimeTypesUtil.getContentType(inputStream,title);
    if (mimeType.equals(originalMimeType)) {
      continue;
    }
    dlFileVersion.setMimeType(mimeType);
    dlFileVersion.setMimeType(mimeType);
    DLFileVersionLocalServiceUtil.updateDLFileVersion(dlFileVersion);
  }
}
