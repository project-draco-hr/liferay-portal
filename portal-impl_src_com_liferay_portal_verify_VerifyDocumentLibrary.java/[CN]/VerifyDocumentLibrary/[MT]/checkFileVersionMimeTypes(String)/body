{
  ActionableDynamicQuery actionableDynamicQuery=new DLFileVersionActionableDynamicQuery(){
    @Override protected void performAction(    Object object) throws PortalException, SystemException {
      DLFileVersion dlFileVersion=(DLFileVersion)object;
      InputStream inputStream=null;
      try {
        inputStream=DLFileEntryLocalServiceUtil.getFileAsStream(dlFileVersion.getUserId(),dlFileVersion.getFileEntryId(),dlFileVersion.getVersion(),false);
      }
 catch (      Exception e) {
        DLFileEntry fileEntry=dlFileVersion.getFileEntry();
        _log.warn("File version " + dlFileVersion.getVersion() + " of "+ "file entry "+ fileEntry.getName()+ " not found",e);
        return;
      }
      String title=DLUtil.getTitleWithExtension(dlFileVersion.getTitle(),dlFileVersion.getExtension());
      String mimeType=MimeTypesUtil.getContentType(inputStream,title);
      if (mimeType.equals(originalMimeType)) {
        return;
      }
      dlFileVersion.setMimeType(mimeType);
      DLFileVersionLocalServiceUtil.updateDLFileVersion(dlFileVersion);
    }
  }
;
  actionableDynamicQuery.performActions();
}
