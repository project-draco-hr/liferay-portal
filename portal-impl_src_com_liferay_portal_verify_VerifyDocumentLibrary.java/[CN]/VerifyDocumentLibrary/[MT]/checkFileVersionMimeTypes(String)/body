{
  ActionableDynamicQuery actionableDynamicQuery=new DLFileVersionActionableDynamicQuery(){
    @Override protected void performAction(    Object object) throws PortalException, SystemException {
      DLFileVersion dlFileVersion=(DLFileVersion)object;
      InputStream inputStream=null;
      try {
        inputStream=DLFileEntryLocalServiceUtil.getFileAsStream(dlFileVersion.getUserId(),dlFileVersion.getFileEntryId(),dlFileVersion.getVersion(),false);
      }
 catch (      Exception e) {
        DLFileEntry fileEntry=dlFileVersion.getFileEntry();
        if (_log.isWarnEnabled()) {
          _log.warn("Unable to find file version " + dlFileVersion.getVersion() + " for file "+ "entry "+ fileEntry.getName(),e);
        }
        return;
      }
      String title=DLUtil.getTitleWithExtension(dlFileVersion.getTitle(),dlFileVersion.getExtension());
      try {
        mimeType=MimeTypesUtil.getContentType(inputStream,title);
      }
  finally {
        StreamUtil.cleanUp(inputStream);
      }
      if (mimeType.equals(originalMimeType)) {
        return;
      }
      dlFileVersion.setMimeType(mimeType);
      DLFileVersionLocalServiceUtil.updateDLFileVersion(dlFileVersion);
    }
  }
;
  actionableDynamicQuery.performActions();
}
