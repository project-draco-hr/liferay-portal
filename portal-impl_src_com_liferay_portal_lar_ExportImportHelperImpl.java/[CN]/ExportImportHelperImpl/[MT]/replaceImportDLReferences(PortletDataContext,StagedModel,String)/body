{
  List<Element> referenceElements=portletDataContext.getReferenceElements(entityStagedModel,DLFileEntry.class);
  for (  Element referenceElement : referenceElements) {
    long classPK=GetterUtil.getLong(referenceElement.attributeValue("class-pk"));
    Element referenceDataElement=portletDataContext.getReferenceDataElement(entityStagedModel,DLFileEntry.class,classPK);
    String path=null;
    if (referenceDataElement != null) {
      path=referenceDataElement.attributeValue("path");
    }
    long groupId=GetterUtil.getLong(referenceElement.attributeValue("group-id"));
    if (Validator.isNull(path)) {
      String className=referenceElement.attributeValue("class-name");
      path=ExportImportPathUtil.getModelPath(groupId,className,classPK);
    }
    if (!content.contains("[$dl-reference=" + path + "$]")) {
      continue;
    }
    StagedModelDataHandlerUtil.importReferenceStagedModel(portletDataContext,entityStagedModel,DLFileEntry.class,classPK);
    String uuid=referenceElement.attributeValue("uuid");
    Map<Long,Long> groupIds=(Map<Long,Long>)portletDataContext.getNewPrimaryKeysMap(Group.class);
    long importGroupId=MapUtil.getLong(groupIds,groupId,portletDataContext.getScopeGroupId());
    FileEntry importedFileEntry=null;
    try {
      importedFileEntry=DLAppLocalServiceUtil.getFileEntryByUuidAndGroupId(uuid,importGroupId);
    }
 catch (    NoSuchModelException nsme) {
      if (_log.isDebugEnabled()) {
        _log.debug(nsme,nsme);
      }
 else       if (_log.isWarnEnabled()) {
        _log.warn(nsme.getMessage());
      }
      continue;
    }
    String url=DLUtil.getPreviewURL(importedFileEntry,importedFileEntry.getFileVersion(),null,StringPool.BLANK,false,false);
    content=StringUtil.replace(content,"[$dl-reference=" + path + "$]",url);
  }
  return content;
}
