{
  List<String> oldLinksToLayout=new ArrayList<String>();
  List<String> newLinksToLayout=new ArrayList<String>();
  Matcher matcher=_importLinksToLayoutPattern.matcher(content);
  while (matcher.find()) {
    long oldGroupId=GetterUtil.getLong(matcher.group(7));
    long newGroupId=oldGroupId;
    long oldLayoutId=GetterUtil.getLong(matcher.group(1));
    long newLayoutId=oldLayoutId;
    String type=matcher.group(2);
    boolean privateLayout=type.startsWith("private");
    String layoutUuid=matcher.group(4);
    String friendlyURL=matcher.group(5);
    try {
      Layout layout=LayoutLocalServiceUtil.fetchLayoutByUuidAndGroupId(layoutUuid,portletDataContext.getScopeGroupId(),privateLayout);
      if (layout == null) {
        layout=LayoutLocalServiceUtil.fetchLayoutByFriendlyURL(portletDataContext.getScopeGroupId(),privateLayout,friendlyURL);
      }
      if (layout == null) {
        if (_log.isWarnEnabled()) {
          StringBundler sb=new StringBundler(9);
          sb.append("Unable to get layout with UUID ");
          sb.append(layoutUuid);
          sb.append(", friendly URL ");
          sb.append(friendlyURL);
          sb.append(", or ");
          sb.append("layoutId ");
          sb.append(oldLayoutId);
          sb.append(" in group ");
          sb.append(portletDataContext.getScopeGroupId());
          _log.warn(sb.toString());
        }
      }
 else {
        newGroupId=layout.getGroupId();
        newLayoutId=layout.getLayoutId();
      }
    }
 catch (    SystemException se) {
      if (_log.isDebugEnabled() || _log.isWarnEnabled()) {
        String message="Unable to get layout in group " + portletDataContext.getScopeGroupId();
        if (_log.isDebugEnabled()) {
          _log.debug(message,se);
        }
 else {
          _log.warn(message);
        }
      }
    }
    String oldLinkToLayout=matcher.group(0);
    StringBundler sb=new StringBundler(4);
    sb.append(StringPool.AT);
    sb.append(layoutUuid);
    sb.append(StringPool.AT);
    sb.append(friendlyURL);
    String newLinkToLayout=StringUtil.replaceFirst(oldLinkToLayout,new String[]{sb.toString(),String.valueOf(oldLayoutId)},new String[]{StringPool.BLANK,String.valueOf(newLayoutId)});
    if ((oldGroupId != 0) && (oldGroupId != newGroupId)) {
      newLinkToLayout=StringUtil.replaceLast(newLinkToLayout,String.valueOf(oldGroupId),String.valueOf(newGroupId));
    }
    oldLinksToLayout.add(oldLinkToLayout);
    newLinksToLayout.add(newLinkToLayout);
  }
  content=StringUtil.replace(content,ArrayUtil.toStringArray(oldLinksToLayout.toArray()),ArrayUtil.toStringArray(newLinksToLayout.toArray()));
  return content;
}
