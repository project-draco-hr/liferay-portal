{
  this.project.log("Testing " + project.getPropertiesFile());
  ProjectTester tester=project.getProjectTester();
  tester.setContinuous(_continuous);
  if (_dir != null) {
    tester.setCwd(_dir);
  }
  String testerDir=project.getProperty("tester.dir","test-reports");
  File reportDir=new File(project.getBase(),testerDir);
  tester.setReportDir(reportDir);
  tester.prepare();
  if (report(project)) {
    throw new BuildException("Failed to initialise for testing.");
  }
  int errors=tester.test();
  if (errors == 0) {
    this.project.log("All tests passed");
  }
 else {
    if (errors > 0) {
      this.project.log(errors + " Error(s)",org.apache.tools.ant.Project.MSG_ERR);
    }
 else {
      this.project.log("Error " + errors,org.apache.tools.ant.Project.MSG_ERR);
    }
    throw new BuildException("Tests failed");
  }
  if (report(project)) {
    throw new BuildException("Tests failed");
  }
}
