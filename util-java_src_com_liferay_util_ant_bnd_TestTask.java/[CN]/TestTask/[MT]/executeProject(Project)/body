{
  this.project.log("Testing " + project.getPropertiesFile());
  ProjectTester projectTester=project.getProjectTester();
  projectTester.setContinuous(_continuous);
  if (_dir != null) {
    projectTester.setCwd(_dir);
  }
  String testerDir=project.getProperty("tester.dir","test-reports");
  File reportDir=new File(project.getBase(),testerDir);
  projectTester.setReportDir(reportDir);
  projectTester.prepare();
  if (report(project)) {
    throw new BuildException("Unable to initialise for testing");
  }
  int errors=projectTester.test();
  if (errors == 0) {
    this.project.log("All tests passed");
  }
 else {
    if (errors == 1) {
      this.project.log(errors + " Error",org.apache.tools.ant.Project.MSG_ERR);
    }
 else {
      this.project.log(errors + " Errors",org.apache.tools.ant.Project.MSG_ERR);
    }
    throw new BuildException("Tests failed");
  }
  if (report(project)) {
    throw new BuildException("Tests failed");
  }
}
