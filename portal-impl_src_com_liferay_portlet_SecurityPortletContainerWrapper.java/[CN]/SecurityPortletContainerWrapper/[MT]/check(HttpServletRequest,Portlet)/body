{
  if (portlet == null) {
    return;
  }
  if (!isValidPortletId(portlet.getPortletId())) {
    if (_log.isWarnEnabled()) {
      _log.warn("Invalid portlet ID " + portlet.getPortletId());
    }
    throw new PrincipalException("Invalid portlet ID " + portlet.getPortletId());
  }
  if (portlet.isUndeployedPortlet()) {
    return;
  }
  Layout layout=(Layout)request.getAttribute(WebKeys.LAYOUT);
  LayoutType layoutType=layout.getLayoutType();
  LayoutTypeAccessPolicy layoutTypeAccessPolicy=layoutType.getLayoutTypeAccessPolicy();
  layoutTypeAccessPolicy.checkAccessAllowedToPortlet(request,layout,portlet);
}
