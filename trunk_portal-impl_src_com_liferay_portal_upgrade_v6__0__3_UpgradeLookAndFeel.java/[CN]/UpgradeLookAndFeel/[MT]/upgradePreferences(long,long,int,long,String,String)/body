{
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
  long linkToLayoutId=GetterUtil.getLong(portletPreferences.getValue("portlet-setup-link-to-layout-id",null));
  if (linkToLayoutId <= 0) {
    linkToLayoutId=GetterUtil.getLong(portletPreferences.getValue("portlet-setup-link-to-plid",null));
  }
  if (linkToLayoutId > 0) {
    String uuid=getLayoutUuid(plid,linkToLayoutId);
    if (uuid != null) {
      portletPreferences.setValue("portlet-setup-link-to-layout-uuid",uuid);
    }
    portletPreferences.reset("portlet-setup-link-to-layout-id");
    portletPreferences.reset("portlet-setup-link-to-plid");
  }
  return PortletPreferencesFactoryUtil.toXML(portletPreferences);
}
