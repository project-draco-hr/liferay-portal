{
  DynamicServletRequest dynamicRequest;
  if (portletRequestImpl.isPrivateRequestAttributes()) {
    String portletNamespace=PortalUtil.getPortletNamespace(portletRequestImpl.getPortletName());
    dynamicRequest=new NamespaceServletRequest(request,portletNamespace,portletNamespace);
  }
 else {
    dynamicRequest=new DynamicServletRequest(request);
  }
  for (  Map.Entry<String,String[]> entry : queryParams.entrySet()) {
    String name=entry.getKey();
    String[] values=entry.getValue();
    String[] oldValues=dynamicRequest.getParameterValues(name);
    if (oldValues != null) {
      values=ArrayUtil.append(values,oldValues);
    }
    dynamicRequest.setParameterValues(name,values);
  }
  return dynamicRequest;
}
