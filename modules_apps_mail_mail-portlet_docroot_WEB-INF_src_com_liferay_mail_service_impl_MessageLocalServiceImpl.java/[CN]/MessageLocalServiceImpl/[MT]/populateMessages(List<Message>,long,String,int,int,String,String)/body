{
  DynamicQuery countDynamicQuery=DynamicQueryFactoryUtil.forClass(Message.class,getClassLoader());
  countDynamicQuery.add(RestrictionsFactoryUtil.eq("folderId",folderId));
  DynamicQuery messageDynamicQuery=DynamicQueryFactoryUtil.forClass(Message.class,getClassLoader());
  messageDynamicQuery.add(RestrictionsFactoryUtil.eq("folderId",folderId));
  if (Validator.isNotNull(keywords)) {
    String value="%" + keywords + "%";
    Disjunction disjunction=RestrictionsFactoryUtil.disjunction();
    disjunction.add(RestrictionsFactoryUtil.ilike("subject",value));
    disjunction.add(RestrictionsFactoryUtil.ilike("body",value));
    countDynamicQuery.add(disjunction);
    messageDynamicQuery.add(disjunction);
  }
  if (orderByType.equals("desc")) {
    messageDynamicQuery.addOrder(OrderFactoryUtil.desc(orderByField));
  }
 else {
    messageDynamicQuery.addOrder(OrderFactoryUtil.asc(orderByField));
  }
  int start=messagesPerPage * (pageNumber - 1);
  int end=messagesPerPage * pageNumber;
  messages.addAll(messagePersistence.<Message>findWithDynamicQuery(messageDynamicQuery,start,end));
  return (int)dynamicQueryCount(countDynamicQuery);
}
