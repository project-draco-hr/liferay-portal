{
  if (map.isEmpty()) {
    return StringPool.OPEN_CURLY_BRACE + StringPool.CLOSE_CURLY_BRACE;
  }
  StringBundler sb=new StringBundler(map.size() * 4 + 1);
  sb.append(StringPool.OPEN_CURLY_BRACE);
  for (  Map.Entry<?,?> entry : map.entrySet()) {
    Object key=entry.getKey();
    Object value=entry.getValue();
    String keyString=String.valueOf(key);
    if (hidePasswordFields && keyString.toLowerCase().contains("password")) {
      value="HIDDEN";
    }
    sb.append(keyString);
    sb.append(StringPool.EQUAL);
    if (value instanceof Map<?,?>) {
      sb.append(MapUtil.toString((Map<?,?>)value));
    }
 else     if (value instanceof String[]) {
      String valueString=StringUtil.merge((String[])value,StringPool.COMMA_AND_SPACE);
      sb.append(StringPool.OPEN_BRACKET.concat(valueString).concat(StringPool.CLOSE_BRACKET));
    }
 else {
      sb.append(value);
    }
    sb.append(StringPool.COMMA_AND_SPACE);
  }
  sb.setStringAt(StringPool.CLOSE_CURLY_BRACE,sb.index() - 1);
  return sb.toString();
}
