{
  String servletContextName=ParamUtil.getString(request,"servletContextName");
  String currentServletContextName=getServletContext().getServletContextName();
  if (Validator.isNotNull(servletContextName) && (Validator.isNull(currentServletContextName) || (!servletContextName.equals(currentServletContextName)))) {
    BeanLocator beanLocator=PortletBeanLocatorUtil.getBeanLocator(servletContextName);
    ServletContext servletContext=beanLocator.getServletContext();
    if (servletContext != null) {
      RequestDispatcher requestDispatcher=servletContext.getRequestDispatcher("/json");
      if (requestDispatcher != null) {
        requestDispatcher.forward(request,response);
        return null;
      }
    }
  }
  String callback=ParamUtil.getString(request,"callback");
  String instance=ParamUtil.getString(request,"inst");
  String json=null;
  try {
    json=getJSON(mapping,form,request,response);
    if (Validator.isNotNull(callback)) {
      json=callback + "(" + json+ ");";
    }
 else     if (Validator.isNotNull(instance)) {
      json="var " + instance + "="+ json+ ";";
    }
  }
 catch (  Exception e) {
    PortalUtil.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR,e,request,response);
    return null;
  }
  if (Validator.isNotNull(json)) {
    response.setContentType(ContentTypes.TEXT_JAVASCRIPT);
    response.setHeader(HttpHeaders.CACHE_CONTROL,"no-cache");
    PrintWriter printWriter=response.getWriter();
    printWriter.write(json);
    printWriter.close();
  }
  return null;
}
