{
  BundleContextWrapper wrappedBundleContext=wrapContext();
  ServiceTrackerMap<TrackedOne,TrackedOne> serviceTrackerMap=ServiceTrackerMapFactory.singleValueMap(wrappedBundleContext,TrackedOne.class,null,new ServiceReferenceMapper<TrackedOne,TrackedOne>(){
    @Override public void map(    ServiceReference<TrackedOne> serviceReference,    Emitter<TrackedOne> emitter){
    }
  }
);
  serviceTrackerMap.open();
  ServiceRegistration<TrackedOne> serviceRegistration1=registerService(new TrackedOne());
  ServiceRegistration<TrackedOne> serviceRegistration2=registerService(new TrackedOne());
  Map<ServiceReference<?>,AtomicInteger> serviceReferenceCountsMap=wrappedBundleContext.getServiceReferenceCountsMap();
  Collection<AtomicInteger> serviceReferenceCounts=serviceReferenceCountsMap.values();
  Assert.assertEquals(0,serviceReferenceCounts.size());
  serviceRegistration1.unregister();
  serviceRegistration2.unregister();
  Assert.assertEquals(0,serviceReferenceCounts.size());
  serviceTrackerMap.close();
}
