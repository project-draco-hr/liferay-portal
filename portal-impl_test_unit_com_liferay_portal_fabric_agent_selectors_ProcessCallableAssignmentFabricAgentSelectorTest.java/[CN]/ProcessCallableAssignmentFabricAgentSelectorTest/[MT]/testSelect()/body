{
  FabricAgentSelector fabricAgentSelector=new ProcessCallableAssignmentFabricAgentSelector();
  FabricAgent fabricAgent1=createFabricAgent(Collections.<String,String>singletonMap(ProcessCallableAssignmentFabricAgentSelector.PROCESS_CALLABLE_ASSIGNMENT_EXPRESSION_KEY,".*ReturnProcessCallable"));
  FabricAgent fabricAgent2=createFabricAgent(Collections.<String,String>singletonMap(ProcessCallableAssignmentFabricAgentSelector.PROCESS_CALLABLE_ASSIGNMENT_EXPRESSION_KEY,".*LoggingProcessCallable"));
  FabricAgent fabricAgent3=createFabricAgent(Collections.<String,String>emptyMap());
  Collection<FabricAgent> fabricAgents=fabricAgentSelector.select(new ArrayList<FabricAgent>(Arrays.asList(fabricAgent1,fabricAgent2,fabricAgent3)),new ReturnProcessCallable<String>(null));
  Assert.assertEquals(1,fabricAgents.size());
  Iterator<FabricAgent> iterator=fabricAgents.iterator();
  Assert.assertSame(fabricAgent1,iterator.next());
  fabricAgents=fabricAgentSelector.select(new ArrayList<FabricAgent>(Arrays.asList(fabricAgent1,fabricAgent2)),new LoggingProcessCallable(null));
  Assert.assertEquals(1,fabricAgents.size());
  iterator=fabricAgents.iterator();
  Assert.assertSame(fabricAgent2,iterator.next());
  fabricAgents=fabricAgentSelector.select(new ArrayList<FabricAgent>(Arrays.asList(fabricAgent1,fabricAgent2)),new ExceptionProcessCallable(null));
  Assert.assertTrue(fabricAgents.isEmpty());
}
