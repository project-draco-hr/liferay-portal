{
  if (_log.isDebugEnabled()) {
    _log.debug("Creating JGroups peer provider");
  }
  String clusterName=properties.getProperty("clusterName");
  if (clusterName == null) {
    clusterName=_DEFAULT_CLUSTER_NAME;
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Cluster name " + clusterName);
  }
  String channelProperties=properties.getProperty("channelProperties");
  if (channelProperties != null) {
    channelProperties=channelProperties.replaceAll(StringPool.SPACE,StringPool.BLANK);
    if (Validator.isNull(channelProperties)) {
      channelProperties=null;
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Channel properties " + channelProperties);
  }
  if (!_initialized) {
    if (OSDetector.isUnix() && IPDetector.isSupportsV6() && !IPDetector.isPrefersV4()&& _log.isWarnEnabled()) {
      StringBundler sb=new StringBundler(4);
      sb.append("You are on an Unix server with IPv6 enabled. JGroups ");
      sb.append("may not work with IPv6. If you see a multicast ");
      sb.append("error, try adding java.net.preferIPv4Stack=true ");
      sb.append("as a JVM startup parameter.");
      _log.warn(sb.toString());
    }
    _initialized=true;
  }
  return new JGroupsManager(cacheManager,clusterName,channelProperties);
}
