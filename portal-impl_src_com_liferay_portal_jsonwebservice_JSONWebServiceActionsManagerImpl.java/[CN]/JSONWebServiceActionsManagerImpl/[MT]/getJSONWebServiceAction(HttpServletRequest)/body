{
  HttpSession session=request.getSession();
  ServletContext servletContext=session.getServletContext();
  String servletContextPath=ContextPathUtil.getContextPath(servletContext);
  String path=GetterUtil.getString(request.getPathInfo());
  String method=GetterUtil.getString(request.getMethod());
  if (_log.isDebugEnabled()) {
    _log.debug("Request JSON web service action with path " + path + " and method "+ method+ " for /"+ servletContextPath);
  }
  String parameterPath=null;
  JSONRPCRequest jsonRPCRequest=null;
  int parameterPathIndex=_getParameterPathIndex(path);
  if (parameterPathIndex != -1) {
    parameterPath=path.substring(parameterPathIndex);
    path=path.substring(0,parameterPathIndex);
  }
 else {
    if (method.equals(HttpMethods.POST) && !PortalUtil.isMultipartRequest(request)) {
      jsonRPCRequest=JSONRPCRequest.detectJSONRPCRequest(request);
      if (jsonRPCRequest != null) {
        path+=StringPool.SLASH + jsonRPCRequest.getMethod();
        method=null;
      }
    }
  }
  JSONWebServiceActionParameters jsonWebServiceActionParameters=new JSONWebServiceActionParameters();
  jsonWebServiceActionParameters.collectAll(request,parameterPath,jsonRPCRequest,null);
  int slashIndex=path.indexOf('/',1);
  if (slashIndex != -1) {
    int dotIndex=path.lastIndexOf('.',slashIndex);
    if (dotIndex != -1) {
      servletContextPath=path.substring(0,dotIndex);
      path='/' + path.substring(dotIndex + 1);
    }
  }
  int jsonWebServiceActionConfigIndex=_getJSONWebServiceActionConfigIndex(servletContextPath,path,method,jsonWebServiceActionParameters.getParameterNames());
  if (jsonWebServiceActionConfigIndex == -1) {
    throw new RuntimeException("No JSON web service action associated with path " + path + " and method "+ method+ " for /"+ servletContextPath);
  }
  JSONWebServiceActionConfig jsonWebServiceActionConfig=_jsonWebServiceActionConfigs.get(jsonWebServiceActionConfigIndex);
  return new JSONWebServiceActionImpl(jsonWebServiceActionConfig,jsonWebServiceActionParameters);
}
