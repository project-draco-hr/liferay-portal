{
  HttpServletRequest request=serviceContext.getRequest();
  if (!(request instanceof UploadRequest)) {
    return;
  }
  UploadRequest uploadRequest=(UploadRequest)request;
  Fields fields=StorageEngineUtil.getFields(storageId);
  List<String> fieldNames=getFieldNames(fieldNamespace,fieldName,serviceContext);
  List<Serializable> fieldValues=new ArrayList<Serializable>(fieldNames.size());
  for (  String fieldNameValue : fieldNames) {
    InputStream inputStream=null;
    try {
      String fileName=uploadRequest.getFileName(fieldNameValue);
      inputStream=uploadRequest.getFileAsStream(fieldNameValue,true);
      if (Validator.isNull(fileName) && (inputStream == null)) {
        Field field=fields.get(fieldName);
        if (field != null) {
          Locale locale=PortalUtil.getLocale(request);
          Serializable fieldValue=field.getValue(locale);
          JSONObject fileJSONObject=JSONFactoryUtil.createJSONObject(String.valueOf(fieldValue));
          fileName=fileJSONObject.getString("name");
          String filePath=fileJSONObject.getString("path");
          inputStream=DLStoreUtil.getFileAsStream(serviceContext.getCompanyId(),CompanyConstants.SYSTEM,filePath);
        }
      }
      if (inputStream != null) {
        String filePath=storeFieldFile(baseModel,fieldName,inputStream,serviceContext);
        JSONObject recordFileJSONObject=JSONFactoryUtil.createJSONObject();
        recordFileJSONObject.put("name",fileName);
        recordFileJSONObject.put("path",filePath);
        recordFileJSONObject.put("className",baseModel.getModelClassName());
        recordFileJSONObject.put("classPK",String.valueOf(baseModel.getPrimaryKeyObj()));
        String fieldValue=recordFileJSONObject.toString();
        fieldValues.add(fieldValue);
      }
 else       if (fields.contains(fieldName)) {
        continue;
      }
    }
  finally {
      StreamUtil.cleanUp(inputStream);
    }
  }
  Field field=new Field(structureId,fieldName,fieldValues,serviceContext.getLocale());
  fields.put(field);
  StorageEngineUtil.update(storageId,fields,true,serviceContext);
}
