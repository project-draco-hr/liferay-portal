{
  DDMStructure ddmStructure=getDDMStructure(ddmStructureId,ddmTemplateId);
  Set<String> fieldNames=ddmStructure.getFieldNames();
  Fields fields=new Fields();
  for (  String fieldName : fieldNames) {
    List<Serializable> fieldValues=getFieldValues(ddmStructure,fieldName,fieldNamespace,serviceContext);
    if ((fieldValues == null) || fieldValues.isEmpty()) {
      continue;
    }
    Field field=new Field();
    field.setDDMStructureId(ddmStructureId);
    field.setName(fieldName);
    String languageId=GetterUtil.getString(serviceContext.getAttribute("languageId"),serviceContext.getLanguageId());
    Locale locale=LocaleUtil.fromLanguageId(languageId);
    String defaultLanguageId=GetterUtil.getString(serviceContext.getAttribute("defaultLanguageId"));
    Locale defaultLocale=LocaleUtil.fromLanguageId(defaultLanguageId);
    if (ddmStructure.isFieldPrivate(fieldName)) {
      locale=LocaleUtil.getDefault();
      defaultLocale=LocaleUtil.getDefault();
    }
    field.setValues(locale,fieldValues);
    field.setDefaultLocale(defaultLocale);
    fields.put(field);
  }
  return fields;
}
