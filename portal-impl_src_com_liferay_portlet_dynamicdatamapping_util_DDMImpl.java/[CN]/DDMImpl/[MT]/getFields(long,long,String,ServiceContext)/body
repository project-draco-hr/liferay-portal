{
  DDMStructure ddmStructure=DDMStructureLocalServiceUtil.getStructure(ddmStructureId);
  try {
    DDMTemplate ddmTemplate=DDMTemplateLocalServiceUtil.getTemplate(ddmTemplateId);
    ddmStructure.setXsd(ddmTemplate.getScript());
  }
 catch (  NoSuchTemplateException nste) {
  }
  Set<String> fieldNames=ddmStructure.getFieldNames();
  Fields fields=new Fields();
  for (  String fieldName : fieldNames) {
    Field field=new Field();
    field.setName(fieldName);
    String fieldDataType=ddmStructure.getFieldDataType(fieldName);
    String fieldType=ddmStructure.getFieldType(fieldName);
    String fieldValue=(String)serviceContext.getAttribute(fieldNamespace + fieldName);
    if (fieldDataType.equals(FieldConstants.DATE)) {
      int fieldValueMonth=GetterUtil.getInteger(serviceContext.getAttribute(fieldNamespace + fieldName + "Month"));
      int fieldValueYear=GetterUtil.getInteger(serviceContext.getAttribute(fieldNamespace + fieldName + "Year"));
      int fieldValueDay=GetterUtil.getInteger(serviceContext.getAttribute(fieldNamespace + fieldName + "Day"));
      Date fieldValueDate=PortalUtil.getDate(fieldValueMonth,fieldValueDay,fieldValueYear);
      fieldValue=String.valueOf(fieldValueDate.getTime());
    }
    if (fieldValue == null || fieldDataType.equals(FieldConstants.FILE_UPLOAD)) {
      continue;
    }
    if (fieldType.equals(DDMImpl.TYPE_RADIO) || fieldType.equals(DDMImpl.TYPE_SELECT)) {
      Object value=serviceContext.getAttribute(fieldNamespace + fieldName);
      String[] fieldValues={};
      if (value instanceof String) {
        fieldValues=new String[]{String.valueOf(value)};
      }
 else       if (value instanceof String[]) {
        fieldValues=(String[])value;
      }
      fieldValue=JSONFactoryUtil.serialize(fieldValues);
    }
    Serializable fieldValueSerializable=FieldConstants.getSerializable(fieldDataType,GetterUtil.getString(fieldValue));
    field.setValue(fieldValueSerializable);
    fields.put(field);
  }
  return fields;
}
