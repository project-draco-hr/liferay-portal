{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String name=ParamUtil.getString(actionRequest,"name");
  String tempFileName=ParamUtil.getString(actionRequest,"tempFileName");
  Map<Locale,String> titleMap=LocalizationUtil.getLocalizationMap(actionRequest,"title");
  int version=ParamUtil.getInteger(actionRequest,"version");
  if (Validator.isNull(tempFileName)) {
    throw new WorkflowDefinitionFileException();
  }
  FileEntry tempFileEntry=TempFileEntryUtil.getTempFileEntry(themeDisplay.getScopeGroupId(),themeDisplay.getUserId(),UploadWorkflowDefinitionFileMVCActionCommand.TEMP_FOLDER_NAME,tempFileName);
  if (tempFileEntry == null) {
    WorkflowDefinitionManagerUtil.updateTitle(themeDisplay.getCompanyId(),themeDisplay.getUserId(),name,version,getTitle(titleMap));
  }
 else {
    WorkflowDefinitionManagerUtil.deployWorkflowDefinition(themeDisplay.getCompanyId(),themeDisplay.getUserId(),getTitle(titleMap),getFileBytes(tempFileEntry));
  }
  sendRedirect(actionRequest,actionResponse);
}
