{
  if (writer == null) {
    throw new IOException("Writer closed");
  }
  if (len >= bufferSize) {
    if (count > 0) {
      writer.write(buffer,0,count);
      count=0;
    }
    writer.write(cbuf,off,len);
    return;
  }
  if (count > 0 && len > bufferSize - count) {
    writer.write(buffer,0,count);
    count=0;
  }
  System.arraycopy(cbuf,off,buffer,count,len);
  count+=len;
}
