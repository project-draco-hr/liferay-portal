{
  List<Group> groups=GroupLocalServiceUtil.getNullFriendlyURLGroups();
  for (  Group group : groups) {
    String friendlyURL=StringPool.SLASH + group.getGroupId();
    User user=null;
    if (group.isCompany() && !group.isCompanyStagingGroup()) {
      friendlyURL=GroupConstants.GLOBAL_FRIENDLY_URL;
    }
 else     if (group.isUser()) {
      user=UserLocalServiceUtil.getUserById(group.getClassPK());
      friendlyURL=StringPool.SLASH + user.getScreenName();
    }
 else     if (group.getClassPK() > 0) {
      friendlyURL=StringPool.SLASH + group.getClassPK();
    }
    try {
      GroupLocalServiceUtil.updateFriendlyURL(group.getGroupId(),friendlyURL);
    }
 catch (    GroupFriendlyURLException gfurle) {
      if (user != null) {
        long userId=user.getUserId();
        String screenName=user.getScreenName();
        if (_log.isWarnEnabled()) {
          _log.warn("Updating user screen name " + screenName + " to "+ userId+ " because it is generating an "+ "invalid friendly URL: "+ friendlyURL);
        }
        UserLocalServiceUtil.updateScreenName(userId,String.valueOf(userId));
      }
 else {
        _log.error("Invalid Friendly URL " + friendlyURL);
        throw gfurle;
      }
    }
  }
}
