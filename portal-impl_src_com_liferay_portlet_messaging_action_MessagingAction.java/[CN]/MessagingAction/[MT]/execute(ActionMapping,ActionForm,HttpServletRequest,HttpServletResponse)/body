{
  String ajaxId=req.getHeader("Ajax-ID");
  String cmd=ParamUtil.getString(req,"cmd");
  String json=null;
  res.setHeader(HttpHeaders.CACHE_CONTROL,"no-cache");
  if (cmd.equals("chatbox")) {
    return mapping.findForward("portlet.messaging.chatbox");
  }
 else {
    if (ajaxId != null && !ajaxId.equals("")) {
      res.setHeader("Ajax-ID",ajaxId);
    }
    try {
      json=getJSON(mapping,form,req,res);
    }
 catch (    Exception e) {
      PortalUtil.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR,e,req,res);
      return null;
    }
    if (Validator.isNotNull(json)) {
      res.setContentType(ContentTypes.TEXT_JAVASCRIPT);
      PrintWriter pw=res.getWriter();
      pw.write(json);
      pw.close();
    }
    return null;
  }
}
