{
  LDAPImportConfiguration ldapImportConfiguration=_ldapImportConfigurationProvider.getConfiguration(companyId);
  if (!ldapImportConfiguration.importCreateRolePerGroup()) {
    return;
  }
  Role role=null;
  try {
    role=_roleLocalService.getRole(companyId,ldapGroup.getGroupName());
  }
 catch (  NoSuchRoleException nsre) {
    User defaultUser=_userLocalService.getDefaultUser(companyId);
    Map<Locale,String> descriptionMap=new HashMap<>();
    descriptionMap.put(LocaleUtil.getDefault(),"Autogenerated role from LDAP import");
    role=_roleLocalService.addRole(defaultUser.getUserId(),null,0,ldapGroup.getGroupName(),null,descriptionMap,RoleConstants.TYPE_REGULAR,null,null);
    if (_log.isDebugEnabled()) {
      _log.debug("Imported autogenerated role from LDAP: " + role);
    }
  }
  Group group=userGroup.getGroup();
  if (_groupLocalService.hasRoleGroup(role.getRoleId(),group.getGroupId())) {
    return;
  }
  _groupLocalService.addRoleGroups(role.getRoleId(),new long[]{group.getGroupId()});
}
