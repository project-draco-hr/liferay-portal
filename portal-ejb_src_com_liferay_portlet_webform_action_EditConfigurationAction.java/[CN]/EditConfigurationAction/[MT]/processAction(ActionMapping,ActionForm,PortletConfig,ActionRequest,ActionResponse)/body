{
  String portletResource=ParamUtil.getString(req,"portletResource");
  PortletPreferences prefs=PortletPreferencesFactory.getPortletSetup(req,portletResource,true,true);
  int maxNumOfFields=GetterUtil.getInteger(config.getInitParameter("max-num-of-fields"),10);
  updateForm(req,prefs,maxNumOfFields);
  if (SessionErrors.isEmpty(req)) {
    prefs.store();
    SessionMessages.add(req,config.getPortletName() + ".doConfigure");
  }
}
