{
  Entry versioningFolderEntry=getVersioningFolderEntry(companyId,repositoryId,fileName,true);
  Link link=versioningFolderEntry.getLink(_cmisConstants.LINK_DESCENDANTS);
  String url=link.getHref().toString();
  String title=String.valueOf(versionNumber);
  Entry fileEntry=CMISUtil.getEntry(url,title,_cmisConstants.BASE_TYPE_DOCUMENT);
  if (fileEntry != null) {
    throw new DuplicateFileException();
  }
  fileEntry=CMISUtil.createDocument(url,title,is);
  if (sourceFileName == null) {
    Indexer.addFile(companyId,portletId,groupId,repositoryId,fileName,fileEntryId,properties,modifiedDate,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames());
  }
 else {
    Indexer.updateFile(companyId,portletId,groupId,repositoryId,fileName,fileEntryId,properties,modifiedDate,serviceContext.getAssetCategoryIds(),serviceContext.getAssetTagNames());
  }
}
