{
  Entry versioningFolderEntry=getVersioningFolderEntry(companyId,repositoryId,fileName,true);
  Link link=versioningFolderEntry.getLink(_cmisConstants.LINK_DESCENDANTS);
  String url=link.getHref().toString();
  String title=String.valueOf(versionNumber);
  Entry fileEntry=CMISUtil.getEntry(url,title,_cmisConstants.BASE_TYPE_DOCUMENT);
  if (fileEntry != null) {
    throw new DuplicateFileException();
  }
  fileEntry=CMISUtil.createDocument(url,title,is);
  Indexer indexer=IndexerRegistryUtil.getIndexer(FileModel.class);
  FileModel fileModel=new FileModel();
  fileModel.setAssetCategoryIds(serviceContext.getAssetCategoryIds());
  fileModel.setAssetTagNames(serviceContext.getAssetTagNames());
  fileModel.setCompanyId(companyId);
  fileModel.setFileEntryId(fileEntryId);
  fileModel.setFileName(fileName);
  fileModel.setGroupId(groupId);
  fileModel.setModifiedDate(modifiedDate);
  fileModel.setPortletId(portletId);
  fileModel.setProperties(properties);
  fileModel.setRepositoryId(repositoryId);
  indexer.reindex(fileModel);
}
