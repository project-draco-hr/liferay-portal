{
  try {
    Entry versioningFolder=getVersioningFolder(companyId,repositoryId,fileName);
    Entry newVersioningFolder=getVersioningFolder(companyId,newRepositoryId,fileName);
    List<String> folderList=CMISUtil.getFolderList(versioningFolder);
    for (    String title : folderList) {
      Entry document=CMISUtil.getDocument(versioningFolder,title);
      InputStream is=CMISUtil.getInputStream(document);
      CMISUtil.createDocument(newVersioningFolder,title,is);
    }
    CMISUtil.delete(versioningFolder);
    try {
      Indexer.deleteFile(companyId,portletId,repositoryId,fileName);
    }
 catch (    SearchException se) {
    }
    Indexer.addFile(companyId,portletId,groupId,newRepositoryId,fileName);
  }
 catch (  SearchException se) {
    throw new SystemException();
  }
}
