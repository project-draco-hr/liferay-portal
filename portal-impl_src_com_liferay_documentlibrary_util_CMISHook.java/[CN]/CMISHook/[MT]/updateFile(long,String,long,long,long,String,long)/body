{
  Entry oldVersioningFolderEntry=getVersioningFolderEntry(companyId,repositoryId,fileName,true);
  Entry newVersioningFolderEntry=getVersioningFolderEntry(companyId,newRepositoryId,fileName,true);
  List<String> fileNames=CMISUtil.getFolders(oldVersioningFolderEntry);
  for (  String curFileName : fileNames) {
    Entry entry=CMISUtil.getDocument(oldVersioningFolderEntry,curFileName);
    InputStream is=CMISUtil.getInputStream(entry);
    CMISUtil.createDocument(newVersioningFolderEntry,curFileName,is);
  }
  CMISUtil.delete(oldVersioningFolderEntry);
  Indexer indexer=IndexerRegistryUtil.getIndexer(FileModel.class);
  FileModel fileModel=new FileModel();
  fileModel.setCompanyId(companyId);
  fileModel.setFileName(fileName);
  fileModel.setPortletId(portletId);
  fileModel.setRepositoryId(repositoryId);
  indexer.delete(fileModel);
  fileModel.setRepositoryId(newRepositoryId);
  fileModel.setGroupId(groupId);
  indexer.reindex(fileModel);
}
