{
  try {
    Entry oldVersioningFolderEntry=getVersioningFolderEntry(companyId,repositoryId,fileName,true);
    Entry newVersioningFolderEntry=getVersioningFolderEntry(companyId,repositoryId,newFileName,true);
    List<String> fileNames=CMISUtil.getFolders(oldVersioningFolderEntry);
    for (    String curFileName : fileNames) {
      Entry entry=CMISUtil.getDocument(oldVersioningFolderEntry,curFileName);
      InputStream is=CMISUtil.getInputStream(entry);
      CMISUtil.createDocument(newVersioningFolderEntry,curFileName,is);
    }
    CMISUtil.delete(oldVersioningFolderEntry);
    if (reIndex) {
      try {
        DLIndexerUtil.deleteFile(companyId,portletId,repositoryId,fileName);
      }
 catch (      SearchException se) {
      }
      DLIndexerUtil.addFile(companyId,portletId,groupId,repositoryId,newFileName);
    }
  }
 catch (  SearchException se) {
    throw new SystemException();
  }
}
