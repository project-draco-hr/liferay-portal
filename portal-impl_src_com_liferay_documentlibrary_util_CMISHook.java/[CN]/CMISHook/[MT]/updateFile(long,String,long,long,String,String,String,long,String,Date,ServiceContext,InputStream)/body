{
  Folder versioningFolder=getVersioningFolder(companyId,repositoryId,fileName,true);
  String title=String.valueOf(versionNumber);
  Document document=getDocument(versioningFolder,title);
  if (document != null) {
    throw new DuplicateFileException();
  }
  createDocument(versioningFolder,title,is,serviceContext);
  Indexer indexer=IndexerRegistryUtil.getIndexer(FileModel.class);
  FileModel fileModel=new FileModel();
  fileModel.setAssetCategoryIds(serviceContext.getAssetCategoryIds());
  fileModel.setAssetTagNames(serviceContext.getAssetTagNames());
  fileModel.setCompanyId(companyId);
  fileModel.setFileEntryId(fileEntryId);
  fileModel.setFileName(fileName);
  fileModel.setGroupId(groupId);
  fileModel.setModifiedDate(modifiedDate);
  fileModel.setPortletId(portletId);
  fileModel.setProperties(properties);
  fileModel.setRepositoryId(repositoryId);
  indexer.reindex(fileModel);
}
