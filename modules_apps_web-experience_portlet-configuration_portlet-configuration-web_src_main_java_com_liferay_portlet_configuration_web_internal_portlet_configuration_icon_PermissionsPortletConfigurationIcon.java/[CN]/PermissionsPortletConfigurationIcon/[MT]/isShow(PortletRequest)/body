{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  String rootPortletId=portletDisplay.getRootPortletId();
  if (Validator.isNotNull(portletDisplay.getPortletResource())) {
    String portletResource=portletDisplay.getPortletResource();
    Portlet portlet=_portletLocalService.getPortletById(themeDisplay.getCompanyId(),portletResource);
    rootPortletId=portlet.getRootPortletId();
  }
  boolean showPermissionsIcon=false;
  Layout layout=themeDisplay.getLayout();
  Group group=themeDisplay.getScopeGroup();
  if (!group.hasStagingGroup() || _STAGING_LIVE_GROUP_LOCKING_ENABLED) {
    try {
      if (PortletPermissionUtil.contains(themeDisplay.getPermissionChecker(),layout,rootPortletId,ActionKeys.PERMISSIONS)) {
        showPermissionsIcon=true;
      }
    }
 catch (    PortalException pe) {
      showPermissionsIcon=false;
    }
  }
  if (layout.isLayoutPrototypeLinkActive()) {
    showPermissionsIcon=false;
  }
  if (group.isControlPanel()) {
    showPermissionsIcon=false;
  }
  return showPermissionsIcon;
}
