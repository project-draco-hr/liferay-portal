{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  String rootPortletId=portletDisplay.getRootPortletId();
  if (Validator.isNotNull(portletDisplay.getPortletResource())) {
    String portletResource=portletDisplay.getPortletResource();
    Portlet portlet=_portletLocalService.getPortletById(themeDisplay.getCompanyId(),portletResource);
    rootPortletId=portlet.getRootPortletId();
  }
  boolean showPermissionsIcon=false;
  Layout layout=themeDisplay.getLayout();
  try {
    Group group=layout.getGroup();
    if (layout instanceof VirtualLayout) {
      VirtualLayout virtualLayout=(VirtualLayout)layout;
      Layout sourceLayout=virtualLayout.getSourceLayout();
      group=sourceLayout.getGroup();
    }
    if (!group.hasStagingGroup() || _STAGING_LIVE_GROUP_LOCKING_ENABLED) {
      if (PortletPermissionUtil.contains(themeDisplay.getPermissionChecker(),layout,rootPortletId,ActionKeys.PERMISSIONS)) {
        showPermissionsIcon=true;
      }
    }
    if (layout.isLayoutPrototypeLinkActive()) {
      showPermissionsIcon=false;
    }
    if (group.isControlPanel()) {
      showPermissionsIcon=false;
    }
  }
 catch (  PortalException pe) {
    showPermissionsIcon=false;
  }
  return showPermissionsIcon;
}
