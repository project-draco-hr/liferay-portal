{
  if (name == null) {
    throw new IllegalArgumentException();
  }
  if (name.equals(RenderRequest.USER_INFO)) {
    if (_req.getRemoteUser() != null) {
      LinkedHashMap userInfo=new LinkedHashMap();
      try {
        User user=PortalUtil.getUser(_req);
        UserAttributes userAttributes=new UserAttributes(user);
        userInfo.put(UserAttributes.LIFERAY_COMPANY_ID,userAttributes.getValue(UserAttributes.LIFERAY_COMPANY_ID));
        userInfo.put(UserAttributes.LIFERAY_USER_ID,userAttributes.getValue(UserAttributes.LIFERAY_USER_ID));
        Iterator itr=_portlet.getUserAttributes().iterator();
        while (itr.hasNext()) {
          String attrName=(String)itr.next();
          String attrValue=userAttributes.getValue(attrName);
          if (attrValue != null) {
            userInfo.put(attrName,attrValue);
          }
        }
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
      Map unmodifiableUserInfo=Collections.unmodifiableMap((Map)userInfo.clone());
      Map cuaInstances=CollectionFactory.getHashMap();
      Iterator itr=_portlet.getCustomUserAttributes().entrySet().iterator();
      while (itr.hasNext()) {
        Map.Entry entry=(Map.Entry)itr.next();
        String attrName=(String)entry.getKey();
        String attrCustomClass=(String)entry.getValue();
        CustomUserAttributes cua=(CustomUserAttributes)cuaInstances.get(attrCustomClass);
        if (cua == null) {
          if (_portlet.isWARFile()) {
            PortletContextWrapper pcw=(PortletContextWrapper)PortletContextPool.get(_portlet.getRootPortletId());
            cua=(CustomUserAttributes)pcw.getCustomUserAttributes().get(attrCustomClass);
            cua=(CustomUserAttributes)cua.clone();
          }
 else {
            try {
              cua=(CustomUserAttributes)Class.forName(attrCustomClass).newInstance();
            }
 catch (            Exception e) {
              e.printStackTrace();
            }
          }
          cuaInstances.put(attrCustomClass,cua);
        }
        if (cua != null) {
          String attrValue=cua.getValue(attrName,unmodifiableUserInfo);
          if (attrValue != null) {
            userInfo.put(attrName,attrValue);
          }
        }
      }
      return userInfo;
    }
  }
  return _req.getAttribute(name);
}
