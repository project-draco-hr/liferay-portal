{
  MBMessageDisplay messageDisplay=_mbMessageLocalService.getDiscussionMessageDisplay(userId,groupId,className,classPK,WorkflowConstants.STATUS_APPROVED);
  MBThread thread=messageDisplay.getThread();
  List<MBMessage> messages=_mbMessageLocalService.getThreadMessages(thread.getThreadId(),WorkflowConstants.STATUS_APPROVED);
  for (  MBMessage message : messages) {
    String messageBody=message.getBody();
    if (messageBody.equals(body)) {
      throw new DuplicateCommentException();
    }
  }
  ServiceContext serviceContext=serviceContextFunction.apply(MBMessage.class.getName());
  MBMessage mbMessage=_mbMessageLocalService.addDiscussionMessage(userId,StringPool.BLANK,groupId,className,classPK,thread.getThreadId(),thread.getRootMessageId(),StringPool.BLANK,body,serviceContext);
  return mbMessage.getMessageId();
}
