{
  String strutsAction=ParamUtil.getString(req,"struts_action");
  boolean selectCategory=strutsAction.equals("/message_boards/select_category");
  if ((message != null) && (category == null)) {
    category=message.getCategory();
  }
  PortletURL categoriesURL=res.createRenderURL();
  if (selectCategory) {
    categoriesURL.setWindowState(LiferayWindowState.POP_UP);
    categoriesURL.setParameter("struts_action","/message_boards/select_category");
  }
 else {
    categoriesURL.setWindowState(WindowState.MAXIMIZED);
    categoriesURL.setParameter("struts_action","/message_boards/view");
    categoriesURL.setParameter("categoryId",String.valueOf(MBCategoryImpl.DEFAULT_PARENT_CATEGORY_ID));
  }
  String categoriesLink="<a href=\"" + categoriesURL.toString() + "\">"+ LanguageUtil.get(pageContext,"categories")+ "</a>";
  if (category == null) {
    return categoriesLink;
  }
  String breadcrumbs=StringPool.BLANK;
  if (category != null) {
    for (int i=0; ; i++) {
      category=category.toEscapedModel();
      PortletURL portletURL=res.createRenderURL();
      if (selectCategory) {
        portletURL.setWindowState(LiferayWindowState.POP_UP);
        portletURL.setParameter("struts_action","/message_boards/select_category");
        portletURL.setParameter("categoryId",String.valueOf(category.getCategoryId()));
      }
 else {
        portletURL.setWindowState(WindowState.MAXIMIZED);
        portletURL.setParameter("struts_action","/message_boards/view");
        portletURL.setParameter("categoryId",String.valueOf(category.getCategoryId()));
      }
      String categoryLink="<a href=\"" + portletURL.toString() + "\">"+ category.getName()+ "</a>";
      if (i == 0) {
        breadcrumbs=categoryLink;
      }
 else {
        breadcrumbs=categoryLink + " &raquo; " + breadcrumbs;
      }
      if (category.isRoot()) {
        break;
      }
      category=MBCategoryLocalServiceUtil.getCategory(category.getParentCategoryId());
    }
  }
  breadcrumbs=categoriesLink + " &raquo; " + breadcrumbs;
  if (message != null) {
    message=message.toEscapedModel();
    PortletURL messageURL=res.createRenderURL();
    messageURL.setWindowState(WindowState.MAXIMIZED);
    messageURL.setParameter("struts_action","/message_boards/view_message");
    messageURL.setParameter("messageId",String.valueOf(message.getMessageId()));
    String messageLink="<a href=\"" + messageURL.toString() + "\">"+ message.getSubject()+ "</a>";
    breadcrumbs=breadcrumbs + " &raquo; " + messageLink;
  }
  return breadcrumbs;
}
