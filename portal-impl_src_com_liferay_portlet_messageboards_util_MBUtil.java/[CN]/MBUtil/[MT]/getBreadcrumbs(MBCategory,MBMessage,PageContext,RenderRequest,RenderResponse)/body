{
  String strutsAction=ParamUtil.getString(renderRequest,"struts_action");
  boolean selectCategory=strutsAction.equals("/message_boards/select_category");
  if ((message != null) && (category == null)) {
    category=message.getCategory();
  }
  PortletURL categoriesURL=renderResponse.createRenderURL();
  if (selectCategory) {
    categoriesURL.setWindowState(LiferayWindowState.POP_UP);
    categoriesURL.setParameter("struts_action","/message_boards/select_category");
  }
 else {
    categoriesURL.setParameter("struts_action","/message_boards/view");
    categoriesURL.setParameter("mbCategoryId",String.valueOf(MBCategoryImpl.DEFAULT_PARENT_CATEGORY_ID));
  }
  String categoriesLink="<a href=\"" + categoriesURL.toString() + "\">"+ LanguageUtil.get(pageContext,"categories")+ "</a>";
  if (category == null) {
    return "<span class=\"first last\">" + categoriesLink + "</span>";
  }
  String breadcrumbs=StringPool.BLANK;
  for (int i=0; ; i++) {
    category=category.toEscapedModel();
    PortletURL portletURL=renderResponse.createRenderURL();
    if (selectCategory) {
      portletURL.setWindowState(LiferayWindowState.POP_UP);
      portletURL.setParameter("struts_action","/message_boards/select_category");
      portletURL.setParameter("mbCategoryId",String.valueOf(category.getCategoryId()));
    }
 else {
      portletURL.setParameter("struts_action","/message_boards/view");
      portletURL.setParameter("mbCategoryId",String.valueOf(category.getCategoryId()));
    }
    String categoryLink="<a href=\"" + portletURL.toString() + "\">"+ category.getName()+ "</a>";
    if (i == 0) {
      if (message != null) {
        breadcrumbs+=categoryLink;
      }
 else {
        breadcrumbs="<span class=\"last\">" + categoryLink + "</span>";
      }
    }
 else {
      breadcrumbs=categoryLink + " &raquo; " + breadcrumbs;
    }
    if (category.isRoot()) {
      break;
    }
    category=MBCategoryLocalServiceUtil.getCategory(category.getParentCategoryId());
  }
  breadcrumbs="<span class=\"first\">" + categoriesLink + " &raquo; </span>"+ breadcrumbs;
  if (message != null) {
    message=message.toEscapedModel();
    PortletURL messageURL=renderResponse.createRenderURL();
    messageURL.setParameter("struts_action","/message_boards/view_message");
    messageURL.setParameter("messageId",String.valueOf(message.getMessageId()));
    String messageLink="<span class=\"last\"><a href=\"" + messageURL.toString() + "\">"+ message.getSubject()+ "</a></span>";
    breadcrumbs=breadcrumbs + " &raquo; " + messageLink;
  }
  return breadcrumbs;
}
