{
  MBMessage parentMessage=MBMessageLocalServiceUtil.getMBMessage(parentMessageId);
  Role guestRole=RoleLocalServiceUtil.getRole(companyId,RoleConstants.GUEST);
  Role defaultGroupRole=RoleLocalServiceUtil.getDefaultGroupRole(groupId);
  long[] roleIds=new long[]{guestRole.getRoleId(),defaultGroupRole.getRoleId()};
  List<String> actionIds=ResourceActionsUtil.getModelResourceActions(MBMessage.class.getName());
  Map<Long,Set<String>> roleIdsToActionIds=ResourcePermissionLocalServiceUtil.getAvailableResourcePermissionActionIds(companyId,MBMessage.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,String.valueOf(parentMessage.getMessageId()),roleIds,actionIds);
  Set<String> guestActionIds=roleIdsToActionIds.get(guestRole.getRoleId());
  Set<String> defaultGroupActionIds=roleIdsToActionIds.get(defaultGroupRole.getRoleId());
  if (guestActionIds == null) {
    serviceContext.setGuestPermissions(new String[]{});
  }
 else {
    serviceContext.setGuestPermissions(guestActionIds.toArray(new String[guestActionIds.size()]));
  }
  if (defaultGroupActionIds == null) {
    serviceContext.setGroupPermissions(new String[]{});
  }
 else {
    serviceContext.setGroupPermissions(defaultGroupActionIds.toArray(new String[defaultGroupActionIds.size()]));
  }
}
