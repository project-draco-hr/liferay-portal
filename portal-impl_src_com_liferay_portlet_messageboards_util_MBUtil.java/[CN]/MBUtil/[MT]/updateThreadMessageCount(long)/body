{
  Callable<Void> callable=new Callable<Void>(){
    @Override public Void call() throws Exception {
      MBThread thread=MBThreadLocalServiceUtil.fetchThread(threadId);
      if (thread == null) {
        return null;
      }
      int messageCount=MBMessageLocalServiceUtil.getThreadMessagesCount(threadId,WorkflowConstants.STATUS_APPROVED);
      thread.setMessageCount(messageCount);
      MBThreadLocalServiceUtil.updateMBThread(thread);
      return null;
    }
  }
;
  TransactionCommitCallbackRegistryUtil.registerCallback(callable);
}
