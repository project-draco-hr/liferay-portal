{
  String rank=StringPool.BLANK;
  String[] ranks=LocalizationUtil.getPrefsValues(prefs,"ranks",languageId);
  for (int i=0; i < ranks.length; i++) {
    String[] kvp=StringUtil.split(ranks[i],StringPool.EQUAL);
    String kvpName=kvp[0];
    String kvpValue=kvp[1];
    kvp=StringUtil.split(kvpValue,StringPool.COLON);
    if (kvp.length > 1) {
      if ("group".equals(kvp[0])) {
        Group group=GroupLocalServiceUtil.getGroup(user.getGroupId());
        UserGroup userGroup=UserGroupLocalServiceUtil.getUserGroup(group.getCompanyId(),kvp[1]);
        if (UserLocalServiceUtil.hasUserGroupUser(userGroup.getUserGroupId(),user.getUserId())) {
          rank=kvpName;
          break;
        }
      }
 else       if ("role".equals(kvp[0])) {
        Group group=GroupLocalServiceUtil.getGroup(user.getGroupId());
        if (RoleLocalServiceUtil.hasUserRole(user.getUserId(),group.getCompanyId(),kvp[1],true)) {
          rank=kvpName;
          break;
        }
      }
    }
 else {
      int kvpPosts=GetterUtil.getInteger(kvpValue);
      if (user.getMessageCount() >= kvpPosts) {
        rank=kvpName;
      }
    }
  }
  return rank;
}
