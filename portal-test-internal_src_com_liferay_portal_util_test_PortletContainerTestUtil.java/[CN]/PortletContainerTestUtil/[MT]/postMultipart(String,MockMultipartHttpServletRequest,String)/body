{
  if (mockMultipartHttpServletRequest.getInputStream() == null) {
    throw new IllegalStateException("An inputStream must be present on the mock request.");
  }
  String[] cookies=mockMultipartHttpServletRequest.getParameterValues("Cookie");
  if ((cookies == null) || (cookies.length == 0)) {
    throw new IllegalStateException("Valid cookies must be present on the mock request.");
  }
  PostMethod postMethod=new PostMethod(url);
  for (  String cookie : cookies) {
    postMethod.addRequestHeader(new Header("Cookie",cookie));
  }
  byte[] bytes=FileUtil.getBytes(mockMultipartHttpServletRequest.getInputStream());
  Part[] parts={new FilePart(fileNameParameter,new ByteArrayPartSource(fileNameParameter,bytes))};
  MultipartRequestEntity multipartRequestEntity=new MultipartRequestEntity(parts,postMethod.getParams());
  postMethod.setRequestEntity(multipartRequestEntity);
  HttpClient client=new HttpClient();
  client.executeMethod(postMethod);
  StatusLine statusLine=postMethod.getStatusLine();
  return new Response(statusLine.getStatusCode(),postMethod.getResponseBodyAsString(),null);
}
