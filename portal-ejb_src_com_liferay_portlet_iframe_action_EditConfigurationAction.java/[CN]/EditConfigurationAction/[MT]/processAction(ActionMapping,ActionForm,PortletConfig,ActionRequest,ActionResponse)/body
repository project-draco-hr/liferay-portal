{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  if (!cmd.equals(Constants.UPDATE)) {
    return;
  }
  String src=ParamUtil.getString(req,"src");
  if (!src.startsWith("/") && !StringUtil.startsWith(src,"http://") && !StringUtil.startsWith(src,"https://")&& !StringUtil.startsWith(src,"mhtml://")) {
    src=Http.getProtocol(req) + "://" + src;
  }
  boolean auth=ParamUtil.getBoolean(req,"auth");
  String authType=ParamUtil.getString(req,"authType");
  String formMethod=ParamUtil.getString(req,"formMethod");
  String userName=ParamUtil.getString(req,"userName");
  String password=ParamUtil.getString(req,"password");
  String hiddenVariables=ParamUtil.getString(req,"hiddenVariables");
  String[] htmlAttributes=StringUtil.split(ParamUtil.getString(req,"htmlAttributes"),"\n");
  String portletResource=ParamUtil.getString(req,"portletResource");
  PortletPreferences prefs=PortletPreferencesFactory.getPortletSetup(req,portletResource,true,true);
  prefs.setValue("src",src);
  prefs.setValue("auth",String.valueOf(auth));
  prefs.setValue("auth-type",authType);
  prefs.setValue("form-method",formMethod);
  prefs.setValue("user-name",userName);
  prefs.setValue("password",password);
  prefs.setValue("hidden-variables",hiddenVariables);
  for (int i=0; i < htmlAttributes.length; i++) {
    int pos=htmlAttributes[i].indexOf("=");
    if (pos != -1) {
      String key=htmlAttributes[i].substring(0,pos);
      String value=htmlAttributes[i].substring(pos + 1,htmlAttributes[i].length());
      prefs.setValue(key,value);
    }
  }
  prefs.store();
  SessionMessages.add(req,config.getPortletName() + ".doConfigure");
}
