{
  validate(name);
  User user=userPersistence.findByPrimaryKey(userId);
  long groupId=PortalUtil.getPortletGroupId(plid);
  parentCategoryId=getParentCategoryId(groupId,parentCategoryId);
  Date now=new Date();
  long categoryId=counterLocalService.increment();
  MBCategory category=mbCategoryPersistence.create(categoryId);
  category.setUuid(uuid);
  category.setGroupId(groupId);
  category.setCompanyId(user.getCompanyId());
  category.setUserId(user.getUserId());
  category.setUserName(user.getFullName());
  category.setCreateDate(now);
  category.setModifiedDate(now);
  category.setParentCategoryId(parentCategoryId);
  category.setName(name);
  category.setDescription(description);
  mbCategoryPersistence.update(category,false);
  if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
    addCategoryResources(category,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
  }
 else {
    addCategoryResources(category,communityPermissions,guestPermissions);
  }
  if (Validator.isNotNull(mailingListAddress) || Validator.isNotNull(mailAddress)) {
    mbMailingLocalService.addMailing(userId,groupId,category.getCategoryId(),mailingListAddress,mailAddress,mailInProtocol,mailInServerName,mailInUseSSL,mailInServerPort,mailInUserName,mailInPassword,mailInReadInterval,mailOutConfigured,mailOutServerName,mailOutUseSSL,mailOutServerPort,mailOutUserName,mailOutPassword);
  }
  return category;
}
