{
  if ((categoryId == MBCategoryConstants.DEFAULT_PARENT_CATEGORY_ID) || (categoryId == MBCategoryConstants.DISCUSSION_CATEGORY_ID)) {
    return null;
  }
  MBCategory category=mbCategoryPersistence.findByPrimaryKey(categoryId);
  parentCategoryId=getParentCategoryId(category,parentCategoryId);
  if (mergeWithParentCategory && (categoryId != parentCategoryId) && (parentCategoryId != MBCategoryConstants.DEFAULT_PARENT_CATEGORY_ID)&& (parentCategoryId != MBCategoryConstants.DISCUSSION_CATEGORY_ID)) {
    mergeCategories(category,parentCategoryId);
    return category;
  }
  validate(name);
  category.setModifiedDate(serviceContext.getModifiedDate(null));
  category.setParentCategoryId(parentCategoryId);
  category.setName(name);
  category.setDescription(description);
  mbCategoryPersistence.update(category,false);
  MBMailingList mailingList=mbMailingListPersistence.fetchByG_C(category.getGroupId(),category.getCategoryId());
  if (mailingList != null) {
    mbMailingListLocalService.updateMailingList(mailingList.getMailingListId(),emailAddress,inProtocol,inServerName,inServerPort,inUseSSL,inUserName,inPassword,inReadInterval,outEmailAddress,outCustom,outServerName,outServerPort,outUseSSL,outUserName,outPassword,mailingListActive,serviceContext);
  }
 else {
    mbMailingListLocalService.addMailingList(category.getUserId(),category.getGroupId(),category.getCategoryId(),emailAddress,inProtocol,inServerName,inServerPort,inUseSSL,inUserName,inPassword,inReadInterval,outEmailAddress,outCustom,outServerName,outServerPort,outUseSSL,outUserName,outPassword,mailingListActive,serviceContext);
  }
  ExpandoBridge expandoBridge=category.getExpandoBridge();
  expandoBridge.setAttributes(serviceContext);
  return category;
}
