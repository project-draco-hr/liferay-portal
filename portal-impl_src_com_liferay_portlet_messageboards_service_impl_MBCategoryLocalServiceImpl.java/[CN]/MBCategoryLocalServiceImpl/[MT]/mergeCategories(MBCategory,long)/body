{
  List<MBCategory> categories=mbCategoryPersistence.findByG_P(fromCategory.getGroupId(),fromCategory.getCategoryId());
  for (  MBCategory category : categories) {
    mergeCategories(category,toCategoryId);
  }
  List<MBThread> threads=mbThreadPersistence.findByG_C(fromCategory.getGroupId(),fromCategory.getCategoryId());
  for (  MBThread thread : threads) {
    thread.setCategoryId(toCategoryId);
    mbThreadPersistence.update(thread,false);
    List<MBMessage> messages=mbMessagePersistence.findByThreadId(thread.getThreadId());
    for (    MBMessage message : messages) {
      message.setCategoryId(toCategoryId);
      mbMessagePersistence.update(message,false);
      mbMessageLocalService.reindex(message);
    }
  }
  deleteCategory(fromCategory);
}
