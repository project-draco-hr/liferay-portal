{
  List<MBCategory> categories=mbCategoryPersistence.findByG_P(fromCategory.getGroupId(),fromCategory.getCategoryId());
  for (  MBCategory category : categories) {
    mergeCategories(category,toCategoryId);
  }
  List<MBThread> threads=mbThreadPersistence.findByCategoryId(fromCategory.getCategoryId());
  for (  MBThread thread : threads) {
    thread.setCategoryId(toCategoryId);
    mbThreadPersistence.update(thread,false);
    List<MBMessage> messages=mbMessagePersistence.findByThreadId(thread.getThreadId());
    for (    MBMessage message : messages) {
      message.setCategoryId(toCategoryId);
      mbMessagePersistence.update(message,false);
      try {
        if (!fromCategory.isDiscussion()) {
          String[] tagsEntries=tagsEntryLocalService.getEntryNames(MBMessage.class.getName(),message.getMessageId());
          Indexer.updateMessage(message.getCompanyId(),fromCategory.getGroupId(),message.getUserName(),toCategoryId,message.getThreadId(),message.getMessageId(),message.getSubject(),message.getBody(),tagsEntries);
        }
      }
 catch (      SearchException se) {
        _log.error("Indexing " + message.getMessageId(),se);
      }
    }
  }
  deleteCategory(fromCategory);
}
