{
  MBCategory category=mbCategoryPersistence.findByPrimaryKey(categoryId);
  TrashEntry trashEntry=category.getTrashEntry();
  if (trashEntry.getClassName().equals(MBCategory.class.getName()) && (trashEntry.getClassPK() == categoryId)) {
    restoreCategoryFromTrash(userId,categoryId);
  }
 else {
    TrashVersion trashVersion=trashVersionLocalService.fetchVersion(trashEntry.getEntryId(),MBCategory.class.getName(),category.getCategoryId());
    int status=WorkflowConstants.STATUS_APPROVED;
    if (trashVersion != null) {
      status=trashVersion.getStatus();
    }
    updateStatus(userId,categoryId,status);
    User user=userPersistence.findByPrimaryKey(userId);
    List<Object> categoriesAndThreads=getCategoriesAndThreads(category.getGroupId(),categoryId);
    restoreDependentFromTrash(user,categoriesAndThreads,trashEntry.getEntryId());
    if (trashVersion != null) {
      trashVersionLocalService.deleteTrashVersion(trashVersion);
    }
  }
  return moveCategory(categoryId,newCategoryId,false);
}
