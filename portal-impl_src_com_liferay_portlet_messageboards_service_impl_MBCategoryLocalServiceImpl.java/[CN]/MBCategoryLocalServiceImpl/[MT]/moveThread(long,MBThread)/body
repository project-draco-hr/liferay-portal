{
  long oldCategoryId=thread.getCategoryId();
  MBCategory category=mbCategoryPersistence.findByPrimaryKey(categoryId);
  Iterator itr=mbMessagePersistence.findByC_T(oldCategoryId,thread.getThreadId()).iterator();
  while (itr.hasNext()) {
    MBMessage curMessage=(MBMessage)itr.next();
    curMessage.setCategoryId(category.getCategoryId());
    mbMessagePersistence.update(curMessage);
    try {
      if (!category.isDiscussion()) {
        Indexer.updateMessage(curMessage.getCompanyId(),category.getGroupId(),curMessage.getUserName(),category.getCategoryId(),curMessage.getThreadId(),curMessage.getMessageId(),curMessage.getSubject(),curMessage.getBody(),curMessage.getTagsEntries());
      }
    }
 catch (    IOException ioe) {
      _log.error("Indexing " + curMessage.getMessageId(),ioe);
    }
  }
  thread.setCategoryId(category.getCategoryId());
  mbThreadPersistence.update(thread);
}
