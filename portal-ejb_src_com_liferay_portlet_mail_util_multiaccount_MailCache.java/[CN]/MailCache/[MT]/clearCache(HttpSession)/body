{
  Long userIdObj=(Long)ses.getAttribute(WebKeys.USER_ID);
  if (_log.isDebugEnabled()) {
    _log.debug("Clearing the mail cache for user " + userIdObj);
  }
  Collection accounts=getUserAccounts(userIdObj.longValue());
  if (accounts != null) {
    if (_log.isDebugEnabled()) {
      _log.debug("User has " + accounts.size() + " accounts that might "+ "need to be closed");
    }
    Iterator itr=accounts.iterator();
    while (itr.hasNext()) {
      MailAccount account=(MailAccount)itr.next();
      String accountPrefix=account.getName();
      Store store=getStore(ses,accountPrefix);
      if (store != null) {
        store.close();
      }
      removeStore(ses,accountPrefix);
    }
    removeUserAccounts(userIdObj.longValue());
  }
}
