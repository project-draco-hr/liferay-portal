{
  if (configurationURL == null) {
    return null;
  }
  Configuration configuration=ConfigurationFactory.parseConfiguration(configurationURL);
  if (clusterAware) {
    boolean enableClusterLinkReplication=false;
    if (PropsValues.CLUSTER_LINK_ENABLED && PropsValues.EHCACHE_CLUSTER_LINK_REPLICATION_ENABLED) {
      enableClusterLinkReplication=true;
    }
    if (usingDefault || enableClusterLinkReplication) {
      if ((enableClusterLinkReplication) || (usingDefault && !PropsValues.CLUSTER_LINK_ENABLED)) {
        configuration.getCacheManagerPeerListenerFactoryConfigurations().clear();
        configuration.getCacheManagerPeerProviderFactoryConfiguration().clear();
      }
      List<CacheConfiguration> cacheConfigurations=_getAllCacheConfigurations(configuration);
      for (      CacheConfiguration cacheConfiguration : cacheConfigurations) {
        if (!PropsValues.EHCACHE_BOOTSTRAP_CACHE_LOADER_ENABLED) {
          cacheConfiguration.addBootstrapCacheLoaderFactory(null);
        }
        if (enableClusterLinkReplication || (usingDefault && !PropsValues.CLUSTER_LINK_ENABLED) || (!usingDefault && _isUsingLiferayCacheEventListenerFactory(cacheConfiguration))) {
          String cacheEventListenerProperties=_clearCacheEventListenerConfigurations(cacheConfiguration);
          if (enableClusterLinkReplication) {
            _enableClusterLinkReplication(cacheConfiguration,cacheEventListenerProperties);
          }
        }
      }
      return configuration;
    }
  }
  return configuration;
}
