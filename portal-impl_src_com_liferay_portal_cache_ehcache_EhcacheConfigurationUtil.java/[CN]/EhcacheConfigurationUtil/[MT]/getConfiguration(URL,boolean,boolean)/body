{
  if (configurationURL == null) {
    return null;
  }
  Configuration configuration=ConfigurationFactory.parseConfiguration(configurationURL);
  if (!clusterAware) {
    return configuration;
  }
  if (PropsValues.CLUSTER_LINK_ENABLED && PropsValues.EHCACHE_CLUSTER_LINK_REPLICATION_ENABLED) {
    List<CacheConfiguration> cacheConfigurations=_getAllCacheConfigurations(configuration);
    _setBootstrapCacheLoaderConfigurations(cacheConfigurations);
    Map<CacheConfiguration,String> cacheEventListenerProperties=_clearEhcacheReplicatorConfigurations(configuration,cacheConfigurations);
    for (    Map.Entry<CacheConfiguration,String> entry : cacheEventListenerProperties.entrySet()) {
      _enableClusterLinkReplication(entry.getKey(),entry.getValue());
    }
  }
 else   if (usingDefault) {
    List<CacheConfiguration> cacheConfigurations=_getAllCacheConfigurations(configuration);
    _setBootstrapCacheLoaderConfigurations(cacheConfigurations);
    if (!PropsValues.CLUSTER_LINK_ENABLED) {
      _clearEhcacheReplicatorConfigurations(configuration,cacheConfigurations);
    }
  }
  return configuration;
}
