{
  long fileEntryTypeId=GetterUtil.getLong(portletPreferences.getValue(_DL_CLASSTYPE,"0"));
  if (fileEntryTypeId > 0) {
    Connection con=null;
    PreparedStatement ps=null;
    ResultSet rs=null;
    try {
      long classNameId=PortalUtil.getClassNameId(DLFileEntryType.class);
      con=DataAccess.getUpgradeOptimizedConnection();
      ps=con.prepareStatement("select structureId from DDMStructureLink " + "where classNameId = ? and classPK = ?");
      ps.setLong(1,classNameId);
      ps.setLong(2,fileEntryTypeId);
      rs=ps.executeQuery();
      String selectedFieldName=GetterUtil.getString(portletPreferences.getValue(_DDM_STRUCTURE_FIELD_NAME,null));
      while (rs.next()) {
        long structureId=rs.getLong("structureId");
        JSONObject ddmStructureJSON=getStructureJSON(structureId);
        if (isDateField(ddmStructureJSON,selectedFieldName)) {
          transformDateFieldValue(portletPreferences);
          break;
        }
      }
    }
  finally {
      DataAccess.cleanUp(con,ps,rs);
    }
  }
}
