{
  RestrictPortletServletRequest restrictPortletServletRequest=null;
  if (request instanceof RestrictPortletServletRequest) {
    restrictPortletServletRequest=(RestrictPortletServletRequest)request;
    Map<String,Object> attributes=restrictPortletServletRequest.getAttributes();
    if (attributes.containsKey(WebKeys.RENDER_PORTLET)) {
      restrictPortletServletRequest=new RestrictPortletServletRequest(request);
    }
  }
 else {
    restrictPortletServletRequest=new RestrictPortletServletRequest(request);
  }
  try {
    _portletContainer.render(request,response,portlet);
  }
 catch (  Exception e) {
    throw new PortletContainerException(e);
  }
 finally {
    restrictPortletServletRequest.removeAttribute(WebKeys.RENDER_PATH);
    restrictPortletServletRequest.removeAttribute(WebKeys.RENDER_PORTLET_COLUMN_COUNT);
    restrictPortletServletRequest.removeAttribute(WebKeys.RENDER_PORTLET_COLUMN_ID);
    restrictPortletServletRequest.removeAttribute(WebKeys.RENDER_PORTLET_COLUMN_POS);
    Object lock=request.getAttribute(WebKeys.PARALLEL_RENDERING_MERGE_LOCK);
    if (lock == null) {
      restrictPortletServletRequest.mergeSharedAttributes();
    }
  }
}
