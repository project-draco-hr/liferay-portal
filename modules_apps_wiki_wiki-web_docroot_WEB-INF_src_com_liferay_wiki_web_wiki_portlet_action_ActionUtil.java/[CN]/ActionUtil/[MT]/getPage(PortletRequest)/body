{
  HttpServletRequest request=PortalUtil.getHttpServletRequest(portletRequest);
  long nodeId=ParamUtil.getLong(request,"nodeId");
  String title=ParamUtil.getString(request,"title");
  double version=ParamUtil.getDouble(request,"version");
  WikiNode node=null;
  try {
    if (nodeId > 0) {
      node=WikiNodeServiceUtil.getNode(nodeId);
    }
  }
 catch (  NoSuchNodeException nsne) {
  }
  if (node == null) {
    node=(WikiNode)request.getAttribute(WikiWebKeys.WIKI_NODE);
    if (node != null) {
      nodeId=node.getNodeId();
    }
  }
  WikiWebComponentProvider wikiWebComponentProvider=WikiWebComponentProvider.getWikiWebComponentProvider();
  WikiGroupServiceConfiguration wikiGroupServiceConfiguration=wikiWebComponentProvider.getWikiGroupServiceConfiguration();
  if (Validator.isNull(title)) {
    title=wikiGroupServiceConfiguration.frontPageName();
  }
  WikiPage page=null;
  try {
    page=WikiPageServiceUtil.getPage(nodeId,title,version);
  }
 catch (  NoSuchPageException nspe) {
    if (title.equals(wikiGroupServiceConfiguration.frontPageName()) && (version == 0)) {
      page=getFirstVisiblePage(nodeId,portletRequest);
    }
 else {
      throw nspe;
    }
  }
  request.setAttribute(WikiWebKeys.WIKI_PAGE,page);
}
