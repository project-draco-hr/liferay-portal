{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  WikiWebSettingsProvider wikiWebSettingsProvider=WikiWebSettingsProvider.getWikiWebSettingsProvider();
  WikiGroupServiceConfiguration wikiGroupServiceConfiguration=wikiWebSettingsProvider.getWikiGroupServiceConfiguration();
  WikiPage page=WikiPageLocalServiceUtil.fetchPage(nodeId,wikiGroupServiceConfiguration.frontPageName(),0);
  if (page == null) {
    ServiceContext serviceContext=ServiceContextFactory.getInstance(WikiPage.class.getName(),portletRequest);
    Layout layout=themeDisplay.getLayout();
    serviceContext.setAddGroupPermissions(true);
    if (layout.isPublicLayout()) {
      serviceContext.setAddGuestPermissions(true);
    }
 else {
      serviceContext.setAddGuestPermissions(false);
    }
    boolean workflowEnabled=WorkflowThreadLocal.isEnabled();
    try {
      WorkflowThreadLocal.setEnabled(false);
      page=WikiPageLocalServiceUtil.addPage(themeDisplay.getDefaultUserId(),nodeId,wikiGroupServiceConfiguration.frontPageName(),null,WikiPageConstants.NEW,true,serviceContext);
    }
  finally {
      WorkflowThreadLocal.setEnabled(workflowEnabled);
    }
  }
  return page;
}
