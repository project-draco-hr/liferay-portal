{
  long appPackageId=ParamUtil.getLong(actionRequest,"appPackageId");
  boolean unlicensed=ParamUtil.getBoolean(actionRequest,"unlicensed");
  File file=null;
  try {
    file=FileUtil.createTempFile();
    downloadApp(actionRequest,actionResponse,appPackageId,unlicensed,file);
    App app=_appService.updateApp(file);
    JSONObject jsonObject=getAppJSONObject(app.getRemoteAppId());
    jsonObject.put("cmd","downloadApp");
    jsonObject.put("message","success");
    writeJSON(actionRequest,actionResponse,jsonObject);
  }
  finally {
    if (file != null) {
      file.delete();
    }
  }
}
