{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  OAuthRequest oAuthRequest=new OAuthRequest(Verb.GET,getServerPortletURL());
  setBaseRequestParameters(portletRequest,portletResponse,oAuthRequest);
  String serverNamespace=getServerNamespace();
  addOAuthParameter(oAuthRequest,serverNamespace.concat("appPackageId"),String.valueOf(appPackageId));
  addOAuthParameter(oAuthRequest,"p_p_lifecycle","2");
  if (unlicensed) {
    addOAuthParameter(oAuthRequest,"p_p_resource_id","serveUnlicensedApp");
  }
 else {
    addOAuthParameter(oAuthRequest,"p_p_resource_id","serveApp");
  }
  Response response=getResponse(themeDisplay.getUser(),oAuthRequest);
  FileUtil.write(file,response.getStream());
}
