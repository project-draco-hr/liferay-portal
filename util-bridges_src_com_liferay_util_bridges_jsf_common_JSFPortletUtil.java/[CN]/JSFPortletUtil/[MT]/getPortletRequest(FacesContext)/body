{
  Object request=facesContext.getExternalContext().getRequest();
  if (request == null) {
    return null;
  }
  if (request instanceof PortletRequest) {
    return (PortletRequest)request;
  }
 else   if (request instanceof HttpServletRequest) {
    HttpServletRequest httpServletRequest=(HttpServletRequest)request;
    Object portletArtifactHack=httpServletRequest.getAttribute("com.icesoft.faces.portletHack");
    if (portletArtifactHack == null) {
      return null;
    }
    try {
      Class portletArtifactHackClass=portletArtifactHack.getClass();
      Method method=portletArtifactHackClass.getMethod("getPortletRequest",null);
      if (method != null) {
        Object value=method.invoke(portletArtifactHack,null);
        if ((value != null) && (value instanceof PortletRequest)) {
          return (PortletRequest)value;
        }
      }
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
  return null;
}
