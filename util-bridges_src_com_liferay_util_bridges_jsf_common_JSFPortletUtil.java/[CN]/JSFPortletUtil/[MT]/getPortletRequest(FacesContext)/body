{
  PortletRequest portletRequest=null;
  Object request=facesContext.getExternalContext().getRequest();
  if (request instanceof PortletRequest) {
    portletRequest=(PortletRequest)request;
  }
 else   if (request instanceof ServletEnvironmentRequest) {
    ServletEnvironmentRequest servletEnvironmentRequest=(ServletEnvironmentRequest)request;
    PortletArtifactHack portletArtifactHack=(PortletArtifactHack)servletEnvironmentRequest.getAttribute(PortletArtifactHack.PORTLET_HACK_KEY);
    if (portletArtifactHack != null) {
      portletRequest=portletArtifactHack.getPortletRequest();
    }
  }
  return portletRequest;
}
