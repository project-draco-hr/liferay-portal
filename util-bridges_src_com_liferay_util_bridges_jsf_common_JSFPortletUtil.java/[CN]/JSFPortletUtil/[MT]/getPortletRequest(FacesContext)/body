{
  PortletRequest returnValue=null;
  Object request=facesContext.getExternalContext().getRequest();
  if (request instanceof PortletRequest) {
    returnValue=(PortletRequest)request;
  }
 else   if (request instanceof ServletEnvironmentRequest) {
    ServletEnvironmentRequest servletEnvironmentRequest=(ServletEnvironmentRequest)request;
    PortletArtifactHack portletArtifactHack=(PortletArtifactHack)servletEnvironmentRequest.getAttribute(PortletArtifactHack.PORTLET_HACK_KEY);
    if (portletArtifactHack != null) {
      returnValue=portletArtifactHack.getPortletRequest();
    }
  }
  return returnValue;
}
