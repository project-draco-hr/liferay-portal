{
  PortletRequest portletRequest=null;
  Object request=facesContext.getExternalContext().getRequest();
  if (request != null) {
    if (request instanceof PortletRequest) {
      portletRequest=(PortletRequest)request;
    }
 else     if (request instanceof HttpServletRequest) {
      HttpServletRequest httpServletRequest=(HttpServletRequest)request;
      Object portletArtifactHack=httpServletRequest.getAttribute("com.icesoft.faces.portletHack");
      if (portletArtifactHack != null) {
        try {
          Method method=portletArtifactHack.getClass().getMethod("getPortletRequest",(Class[])null);
          if (method != null) {
            Object value=method.invoke(portletArtifactHack,(Object[])null);
            if ((value != null) && (value instanceof PortletRequest)) {
              portletRequest=(PortletRequest)value;
            }
          }
        }
 catch (        Exception e) {
          _log.error(e,e);
        }
      }
    }
  }
  return portletRequest;
}
