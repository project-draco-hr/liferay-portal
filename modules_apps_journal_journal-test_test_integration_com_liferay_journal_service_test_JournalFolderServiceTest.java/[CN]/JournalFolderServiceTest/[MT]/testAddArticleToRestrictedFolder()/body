{
  JournalFolder folder=JournalTestUtil.addFolder(_group.getGroupId(),JournalFolderConstants.DEFAULT_PARENT_FOLDER_ID,"Test 1");
  DDMStructure ddmStructure1=DDMStructureTestUtil.addStructure(_group.getGroupId(),JournalArticle.class.getName());
  long[] ddmStructureIds=new long[]{ddmStructure1.getStructureId()};
  ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext(_group.getGroupId());
  JournalFolderLocalServiceUtil.updateFolder(TestPropsValues.getUserId(),serviceContext.getScopeGroupId(),folder.getFolderId(),folder.getParentFolderId(),folder.getName(),folder.getDescription(),ddmStructureIds,JournalFolderConstants.RESTRICTION_TYPE_DDM_STRUCTURES_AND_WORKFLOW,false,serviceContext);
  List<DDMStructure> ddmStructures=JournalFolderLocalServiceUtil.getDDMStructures(PortalUtil.getCurrentAndAncestorSiteGroupIds(_group.getGroupId()),folder.getFolderId(),JournalFolderConstants.RESTRICTION_TYPE_DDM_STRUCTURES_AND_WORKFLOW);
  Assert.assertFalse(ddmStructures.isEmpty());
  String xml=DDMStructureTestUtil.getSampleStructuredContent("Test Article");
  DDMStructure ddmStructure2=DDMStructureTestUtil.addStructure(_group.getGroupId(),JournalArticle.class.getName());
  DDMTemplate ddmTemplate2=DDMTemplateTestUtil.addTemplate(_group.getGroupId(),ddmStructure2.getStructureId(),PortalUtil.getClassNameId(JournalArticle.class),LocaleUtil.getDefault());
  try {
    JournalTestUtil.addArticleWithXMLContent(_group.getGroupId(),folder.getFolderId(),JournalArticleConstants.CLASSNAME_ID_DEFAULT,xml,ddmStructure2.getStructureKey(),ddmTemplate2.getTemplateKey());
    Assert.fail();
  }
 catch (  InvalidDDMStructureException iddmse) {
  }
  JournalFolder subfolder=JournalTestUtil.addFolder(_group.getGroupId(),folder.getFolderId(),"Test 1.1");
  try {
    JournalTestUtil.addArticleWithXMLContent(_group.getGroupId(),subfolder.getFolderId(),JournalArticleConstants.CLASSNAME_ID_DEFAULT,xml,ddmStructure2.getStructureKey(),ddmTemplate2.getTemplateKey());
    Assert.fail();
  }
 catch (  InvalidDDMStructureException iddmse) {
  }
  JournalFolderLocalServiceUtil.deleteFolder(folder.getFolderId());
  ddmStructures=JournalFolderLocalServiceUtil.getDDMStructures(PortalUtil.getCurrentAndAncestorSiteGroupIds(_group.getGroupId()),folder.getFolderId(),JournalFolderConstants.RESTRICTION_TYPE_DDM_STRUCTURES_AND_WORKFLOW);
  Assert.assertTrue(ddmStructures.isEmpty());
}
