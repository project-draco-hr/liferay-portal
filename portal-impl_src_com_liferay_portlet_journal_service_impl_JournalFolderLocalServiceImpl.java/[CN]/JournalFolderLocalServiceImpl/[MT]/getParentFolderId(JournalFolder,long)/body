{
  if (parentFolderId == JournalFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    return parentFolderId;
  }
  if (folder.getFolderId() == parentFolderId) {
    return folder.getParentFolderId();
  }
  JournalFolder parentFolder=journalFolderPersistence.fetchByPrimaryKey(parentFolderId);
  if ((parentFolder == null) || (folder.getGroupId() != parentFolder.getGroupId())) {
    return folder.getParentFolderId();
  }
  List<Long> subfolderIds=new ArrayList<>();
  getSubfolderIds(subfolderIds,folder.getGroupId(),folder.getFolderId());
  if (subfolderIds.contains(parentFolderId)) {
    return folder.getParentFolderId();
  }
  return parentFolderId;
}
