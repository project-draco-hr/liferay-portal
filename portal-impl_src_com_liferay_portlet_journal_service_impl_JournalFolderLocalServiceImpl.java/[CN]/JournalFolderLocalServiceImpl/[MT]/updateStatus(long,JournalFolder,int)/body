{
  User user=userPersistence.findByPrimaryKey(userId);
  int oldStatus=folder.getStatus();
  folder.setStatus(status);
  folder.setStatusByUserId(userId);
  folder.setStatusByUserName(user.getFullName());
  folder.setStatusDate(new Date());
  journalFolderPersistence.update(folder);
  List<Object> foldersAndEntries=journalFolderLocalService.getFoldersAndArticles(folder.getGroupId(),folder.getFolderId());
  updateDependentStatus(foldersAndEntries,status);
  if (status == WorkflowConstants.STATUS_APPROVED) {
    assetEntryLocalService.updateVisible(JournalFolder.class.getName(),folder.getFolderId(),true);
  }
 else   if (status == WorkflowConstants.STATUS_IN_TRASH) {
    assetEntryLocalService.updateVisible(JournalFolder.class.getName(),folder.getFolderId(),false);
  }
  if (oldStatus == WorkflowConstants.STATUS_IN_TRASH) {
    trashEntryLocalService.deleteEntry(JournalFolder.class.getName(),folder.getFolderId());
  }
 else   if (status == WorkflowConstants.STATUS_IN_TRASH) {
    UnicodeProperties typeSettingsProperties=new UnicodeProperties();
    typeSettingsProperties.put("title",folder.getName());
    trashEntryLocalService.addTrashEntry(userId,folder.getGroupId(),JournalFolder.class.getName(),folder.getFolderId(),oldStatus,null,typeSettingsProperties);
  }
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(JournalFolder.class);
  indexer.reindex(folder);
  return folder;
}
