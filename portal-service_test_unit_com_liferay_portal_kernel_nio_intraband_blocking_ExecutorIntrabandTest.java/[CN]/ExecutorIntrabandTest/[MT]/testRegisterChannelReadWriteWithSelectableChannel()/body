{
  Pipe pipe=Pipe.open();
  SourceChannel sourceChannel=pipe.source();
  SinkChannel sinkChannel=pipe.sink();
  sourceChannel.configureBlocking(true);
  sinkChannel.configureBlocking(true);
  try {
    FutureRegistrationReference futureRegistrationReference=(FutureRegistrationReference)_executorIntraband.registerChannel(sourceChannel,sinkChannel);
    Assert.assertSame(_executorIntraband,futureRegistrationReference.getIntraband());
    Assert.assertTrue(futureRegistrationReference.isValid());
    futureRegistrationReference.writeFuture.cancel(true);
    Assert.assertFalse(futureRegistrationReference.isValid());
    futureRegistrationReference.cancelRegistration();
    Assert.assertFalse(futureRegistrationReference.isValid());
  }
  finally {
    sourceChannel.close();
    sinkChannel.close();
  }
}
