{
  String xml=null;
  Document document=SAXReaderUtil.createDocument();
  Element requestElement=document.addElement("request");
  DocUtil.add(requestElement,"container-type","portlet");
  DocUtil.add(requestElement,"container-namespace",portletRequest.getContextPath());
  DocUtil.add(requestElement,"content-type",portletRequest.getResponseContentType());
  DocUtil.add(requestElement,"server-name",portletRequest.getServerName());
  DocUtil.add(requestElement,"server-port",portletRequest.getServerPort());
  DocUtil.add(requestElement,"secure",portletRequest.isSecure());
  DocUtil.add(requestElement,"auth-type",portletRequest.getAuthType());
  DocUtil.add(requestElement,"remote-user",portletRequest.getRemoteUser());
  DocUtil.add(requestElement,"context-path",portletRequest.getContextPath());
  DocUtil.add(requestElement,"locale",portletRequest.getLocale());
  DocUtil.add(requestElement,"portlet-mode",portletRequest.getPortletMode());
  DocUtil.add(requestElement,"portlet-session-id",portletRequest.getRequestedSessionId());
  DocUtil.add(requestElement,"scheme",portletRequest.getScheme());
  DocUtil.add(requestElement,"window-state",portletRequest.getWindowState());
  if (portletRequest instanceof ActionRequest) {
    DocUtil.add(requestElement,"lifecycle",RenderRequest.ACTION_PHASE);
  }
 else   if (portletRequest instanceof RenderRequest) {
    DocUtil.add(requestElement,"lifecycle",RenderRequest.RENDER_PHASE);
  }
 else   if (portletRequest instanceof ResourceRequest) {
    DocUtil.add(requestElement,"lifecycle",RenderRequest.RESOURCE_PHASE);
  }
  if (portletResponse instanceof MimeResponse) {
    _mimeResponseToXML((MimeResponse)portletResponse,requestElement);
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay != null) {
    Element themeDisplayElement=requestElement.addElement("theme-display");
    _themeDisplayToXML(themeDisplay,themeDisplayElement);
  }
  Element parametersElement=requestElement.addElement("parameters");
  Enumeration<String> enu=portletRequest.getParameterNames();
  while (enu.hasMoreElements()) {
    String name=enu.nextElement();
    Element parameterElement=parametersElement.addElement("parameter");
    DocUtil.add(parameterElement,"name",name);
    String[] values=portletRequest.getParameterValues(name);
    for (int i=0; i < values.length; i++) {
      DocUtil.add(parameterElement,"value",values[i]);
    }
  }
  Element attributesElement=requestElement.addElement("attributes");
  enu=portletRequest.getAttributeNames();
  while (enu.hasMoreElements()) {
    String name=enu.nextElement();
    if (!_isValidAttributeName(name)) {
      continue;
    }
    Object value=portletRequest.getAttribute(name);
    if (!_isValidAttributeValue(value)) {
      continue;
    }
    Element attributeElement=attributesElement.addElement("attribute");
    DocUtil.add(attributeElement,"name",name);
    DocUtil.add(attributeElement,"value",String.valueOf(value));
  }
  Element portletSessionElement=requestElement.addElement("portlet-session");
  attributesElement=portletSessionElement.addElement("portlet-attributes");
  PortletSession portletSession=portletRequest.getPortletSession();
  try {
    enu=portletSession.getAttributeNames(PortletSession.PORTLET_SCOPE);
    while (enu.hasMoreElements()) {
      String name=enu.nextElement();
      if (!_isValidAttributeName(name)) {
        continue;
      }
      Object value=portletSession.getAttribute(name,PortletSession.PORTLET_SCOPE);
      if (!_isValidAttributeValue(value)) {
        continue;
      }
      Element attributeElement=attributesElement.addElement("attribute");
      DocUtil.add(attributeElement,"name",name);
      DocUtil.add(attributeElement,"value",String.valueOf(value));
    }
    attributesElement=portletSessionElement.addElement("application-attributes");
    enu=portletSession.getAttributeNames(PortletSession.APPLICATION_SCOPE);
    while (enu.hasMoreElements()) {
      String name=enu.nextElement();
      if (!_isValidAttributeName(name)) {
        continue;
      }
      Object value=portletSession.getAttribute(name,PortletSession.APPLICATION_SCOPE);
      if (!_isValidAttributeValue(value)) {
        continue;
      }
      Element attributeElement=attributesElement.addElement("attribute");
      DocUtil.add(attributeElement,"name",name);
      DocUtil.add(attributeElement,"value",String.valueOf(value));
    }
  }
 catch (  IllegalStateException ise) {
    if (_log.isWarnEnabled()) {
      _log.warn(ise.getMessage());
    }
  }
  try {
    xml=document.formattedString();
  }
 catch (  IOException ioe) {
  }
  return xml;
}
