{
  String tempFileId=DLUtil.getTempFileId(fileVersion.getFileEntryId(),fileVersion.getVersion());
  File videoTempFile=_getVideoTempFile(tempFileId,fileVersion.getExtension());
  File[] previewTempFiles=new File[_PREVIEW_TYPES.length];
  for (int i=0; i < _PREVIEW_TYPES.length; i++) {
    previewTempFiles[i]=getPreviewTempFile(tempFileId,_PREVIEW_TYPES[i]);
  }
  try {
    if (!PrefsPropsUtil.getBoolean(PropsKeys.XUGGLER_ENABLED,PropsValues.XUGGLER_ENABLED) || _hasVideo(fileVersion)) {
      return;
    }
    File file=null;
    if (!_hasPreviews(fileVersion) || !hasThumbnails(fileVersion)) {
      if (fileVersion instanceof LiferayFileVersion) {
        try {
          LiferayFileVersion liferayFileVersion=(LiferayFileVersion)fileVersion;
          file=liferayFileVersion.getFile(false);
        }
 catch (        UnsupportedOperationException uoe) {
        }
      }
      if (file == null) {
        InputStream inputStream=fileVersion.getContentStream(false);
        FileUtil.write(videoTempFile,inputStream);
        file=videoTempFile;
      }
    }
    if (!_hasPreviews(fileVersion)) {
      try {
        _generateVideoXuggler(fileVersion,file,previewTempFiles,PropsValues.DL_FILE_ENTRY_PREVIEW_VIDEO_HEIGHT,PropsValues.DL_FILE_ENTRY_PREVIEW_VIDEO_WIDTH);
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
    }
    if (!hasThumbnails(fileVersion)) {
      try {
        _generateThumbnailXuggler(fileVersion,file,PropsValues.DL_FILE_ENTRY_PREVIEW_VIDEO_HEIGHT,PropsValues.DL_FILE_ENTRY_PREVIEW_VIDEO_WIDTH);
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
    }
  }
 catch (  NoSuchFileEntryException nsfee) {
  }
 finally {
    _fileVersionIds.remove(fileVersion.getFileVersionId());
    for (int i=0; i < previewTempFiles.length; i++) {
      FileUtil.delete(previewTempFiles[i]);
    }
    FileUtil.delete(videoTempFile);
  }
}
