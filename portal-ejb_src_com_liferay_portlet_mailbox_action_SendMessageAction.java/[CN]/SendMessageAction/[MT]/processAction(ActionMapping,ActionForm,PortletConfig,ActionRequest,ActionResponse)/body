{
  String cmd=ParamUtil.getString(req,Constants.CMD);
  try {
    if (cmd.equals(Constants.SEND)) {
      User user=PortalUtil.getUser(req);
      Address from=new InternetAddress(user.getEmailAddress(),user.getFullName());
      String tos=ParamUtil.getString(req,"tos");
      String ccs=ParamUtil.getString(req,"ccs");
      String bccs=ParamUtil.getString(req,"bccs");
      String subject=ParamUtil.getString(req,"subject");
      String body=ParamUtil.getString(req,"body");
      Map attachments=ActionUtil.getAttachments(PortalUtil.getUploadPortletRequest(req));
      HttpSession ses=((ActionRequestImpl)req).getHttpServletRequest().getSession();
      ActionUtil.completeMessage(from,tos,ccs,bccs,subject,body,attachments,ses,true,0L);
      setForward(req,"portlet.mailbox.view");
    }
 else {
      if (Validator.isNotNull(cmd)) {
      }
    }
  }
 catch (  Exception e) {
    _log.error(StackTraceUtil.getStackTrace(e));
  }
}
