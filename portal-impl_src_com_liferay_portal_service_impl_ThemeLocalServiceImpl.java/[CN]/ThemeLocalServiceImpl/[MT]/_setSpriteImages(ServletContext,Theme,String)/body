{
  if (!resourcePath.startsWith(StringPool.SLASH)) {
    resourcePath=StringPool.SLASH.concat(resourcePath);
  }
  Set<String> resourcePaths=servletContext.getResourcePaths(resourcePath);
  if (resourcePaths == null) {
    return;
  }
  List<URL> imageURLs=new ArrayList<URL>(resourcePaths.size());
  for (  String curResourcePath : resourcePaths) {
    if (curResourcePath.endsWith(StringPool.SLASH)) {
      _setSpriteImages(servletContext,theme,curResourcePath);
    }
 else     if (curResourcePath.endsWith(".png")) {
      URL resource=servletContext.getResource(curResourcePath);
      if (resource != null) {
        imageURLs.add(resource);
      }
 else {
        if (ServerDetector.isTomcat()) {
          if (_log.isInfoEnabled()) {
            _log.info(ServletContextUtil.LOG_INFO_SPRITES);
          }
        }
 else {
          _log.error("Real path for " + curResourcePath + " is null");
        }
      }
    }
  }
  String spriteFileName=resourcePath.concat(PropsValues.SPRITE_FILE_NAME);
  String spritePropertiesFileName=resourcePath.concat(PropsValues.SPRITE_PROPERTIES_FILE_NAME);
  URL spritePropertiesRootURL=servletContext.getResource(StringPool.SLASH);
  Properties spriteProperties=SpriteProcessorUtil.generate(servletContext,imageURLs,spriteFileName,spritePropertiesFileName,spritePropertiesRootURL,16,16,10240);
  if (spriteProperties == null) {
    return;
  }
  String contextPath=ContextPathUtil.getContextPath(servletContext);
  spriteFileName=contextPath.concat(SpriteProcessor.PATH).concat(spriteFileName);
  theme.setSpriteImages(spriteFileName,spriteProperties);
}
