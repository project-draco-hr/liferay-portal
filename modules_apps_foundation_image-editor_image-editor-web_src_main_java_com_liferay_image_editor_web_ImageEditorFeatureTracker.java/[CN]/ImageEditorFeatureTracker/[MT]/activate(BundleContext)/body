{
  String filter="(com.liferay.image.editor.tool.type=tool)";
  _featuresPropertiesMap=new HashMap<>();
  _featuresServicesMap=ServiceTrackerMapFactory.openSingleValueMap(bundleContext,ImageEditorFeature.class,filter,new ServiceReferenceMapper<String,ImageEditorFeature>(){
    @Override public void map(    ServiceReference<ImageEditorFeature> serviceReference,    Emitter<String> emitter){
      String[] propertyKeys=serviceReference.getPropertyKeys();
      Map<String,Object> properties=new HashMap<>();
      for (      String propertyKey : propertyKeys) {
        properties.put(propertyKey,serviceReference.getProperty(propertyKey));
      }
      String featureName=GetterUtil.getString(serviceReference.getProperty("com.liferay.image.editor.tool.name"));
      _featuresPropertiesMap.put(featureName,properties);
      emitter.emit(featureName);
    }
  }
);
}
