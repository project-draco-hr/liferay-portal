{
  boolean insideUnformattedTextTag=false;
  for (int i=startLine; i <= endLine; i++) {
    String line=_jspSourceProcessor.getLine(content,i);
    if (Validator.isNull(line)) {
      continue;
    }
    String trimmedLine=StringUtil.trimLeading(line);
    if (insideUnformattedTextTag) {
      if (trimmedLine.matches(".*</(pre|textarea)>")) {
        insideUnformattedTextTag=false;
        if (trimmedLine.matches(".+</(pre|textarea)>")) {
          continue;
        }
      }
 else {
        continue;
      }
    }
    int lineStartPos=_jspSourceProcessor.getLineStartPos(content,i);
    if (diff < 0) {
      content=content.substring(0,lineStartPos) + "\t" + content.substring(lineStartPos);
    }
 else {
      content=content.substring(0,lineStartPos) + content.substring(lineStartPos + 1);
    }
    if (!insideUnformattedTextTag && trimmedLine.matches("<(pre|textarea).*")) {
      insideUnformattedTextTag=true;
    }
  }
  return content;
}
