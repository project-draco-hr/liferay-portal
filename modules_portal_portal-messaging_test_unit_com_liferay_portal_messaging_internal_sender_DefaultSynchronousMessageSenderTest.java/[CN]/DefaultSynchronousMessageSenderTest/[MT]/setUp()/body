{
  _messageBus=Mockito.mock(MessageBus.class);
  SynchronousDestination synchronousDestination=new SynchronousDestination();
  synchronousDestination.setName(DestinationNames.MESSAGE_BUS_DEFAULT_RESPONSE);
  _messageBus.addDestination(synchronousDestination);
  _defaultSynchronousMessageSender=new DefaultSynchronousMessageSender();
  _defaultSynchronousMessageSender.setPortalUUID(new PortalUUIDImpl());
  _defaultSynchronousMessageSender.setTimeout(10000);
  EntityCacheUtil entityCacheUtil=new EntityCacheUtil();
  entityCacheUtil.setEntityCache(new EntityCacheImpl());
  FinderCacheUtil finderCacheUtil=new FinderCacheUtil();
  finderCacheUtil.setFinderCache(new FinderCacheImpl());
  RegistryUtil.setRegistry(new BasicRegistryImpl());
  Registry registry=RegistryUtil.getRegistry();
  registry.registerService(MessageBus.class,_messageBus);
  _portalExecutorManager=Mockito.mock(PortalExecutorManager.class);
  Mockito.when(_portalExecutorManager.getPortalExecutor(Mockito.anyString())).thenReturn(new ThreadPoolExecutor(1,1));
  registry.registerService(PortalExecutorManager.class,_portalExecutorManager);
  synchronousDestination.open();
}
