{
  Map<Long,Fields> fieldsMap=new HashMap<Long,Fields>();
  Connection connection=null;
  Statement statement=null;
  ResultSet resultSet=null;
  try {
    connection=DataAccess.getConnection();
    statement=connection.createStatement();
    String sql=_toSQL(expandoRowIds,fieldNames,condition,false);
    resultSet=statement.executeQuery(sql);
    while (resultSet.next()) {
      long rowId=resultSet.getLong("rowId_");
      String name=resultSet.getString("name");
      int type=resultSet.getInt("type_");
      String data=resultSet.getString("data_");
      Fields fields=fieldsMap.get(rowId);
      if (fields == null) {
        fields=new Fields();
        fieldsMap.put(rowId,fields);
      }
      Serializable value=ExpandoConverterUtil.getAttributeFromString(type,data);
      Field field=new Field(name,value);
      fields.put(field);
    }
  }
  finally {
    DataAccess.cleanUp(connection,statement,resultSet);
  }
  return fieldsMap;
}
