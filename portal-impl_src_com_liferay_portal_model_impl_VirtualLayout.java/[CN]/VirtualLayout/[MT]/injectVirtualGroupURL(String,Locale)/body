{
  if (_sourceLayout.isTypeURL()) {
    return layoutURL;
  }
  try {
    Group group=_sourceLayout.getGroup();
    StringBundler sb=new StringBundler(5);
    int pos=-1;
    if (_targetGroup.isUser() && isPrivateLayout()) {
      pos=layoutURL.indexOf(PropsValues.LAYOUT_FRIENDLY_URL_PRIVATE_GROUP_SERVLET_MAPPING);
      sb.append(layoutURL.substring(0,pos));
      sb.append(PropsValues.LAYOUT_FRIENDLY_URL_PRIVATE_USER_SERVLET_MAPPING);
    }
 else {
      pos=layoutURL.indexOf(group.getFriendlyURL());
      sb.append(layoutURL.substring(0,pos));
    }
    sb.append(_targetGroup.getFriendlyURL());
    sb.append(getFriendlyURL(locale));
    pos=layoutURL.indexOf(StringPool.QUESTION);
    if (pos > 0) {
      sb.append(layoutURL.substring(pos));
    }
    return sb.toString();
  }
 catch (  Exception e) {
    throw new IllegalStateException(e);
  }
}
