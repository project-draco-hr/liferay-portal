{
  Map<Long,Long> imagePKs=(Map<Long,Long>)context.getNewPrimaryKeysMap(IGImage.class);
  List<Element> igReferenceEls=parentEl.elements("ig-reference");
  for (  Element igReferenceEl : igReferenceEls) {
    String igReferencePath=igReferenceEl.attributeValue("path");
    IGImage image=(IGImage)context.getZipEntryAsObject(igReferencePath);
    if (image == null) {
      continue;
    }
    long imageId=MapUtil.getLong(imagePKs,image.getImageId(),image.getImageId());
    image=IGImageUtil.fetchByPrimaryKey(imageId);
    if (image == null) {
      continue;
    }
    String igReference="[$ig-reference=" + igReferencePath + "$]";
    StringBundler sb=new StringBundler(6);
    sb.append("/image/image_gallery?uuid=");
    sb.append(image.getUuid());
    sb.append("&groupId=");
    sb.append(context.getScopeGroupId());
    sb.append("&t=");
    sb.append(System.currentTimeMillis());
    content=StringUtil.replace(content,igReference,sb.toString());
  }
  return content;
}
