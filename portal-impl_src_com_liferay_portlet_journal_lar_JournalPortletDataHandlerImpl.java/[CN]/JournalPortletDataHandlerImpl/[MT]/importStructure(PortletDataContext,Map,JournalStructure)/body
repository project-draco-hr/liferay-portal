{
  long userId=context.getUserId(structure.getUserUuid());
  long plid=context.getPlid();
  String structureId=structure.getStructureId();
  boolean autoStructureId=false;
  if ((Validator.isNumber(structureId)) || (JournalStructureUtil.fetchByG_S(context.getGroupId(),structureId) != null)) {
    autoStructureId=true;
  }
  JournalCreationStrategy creationStrategy=JournalCreationStrategyFactory.getInstance();
  long authorId=creationStrategy.getAuthorUserId(context.getCompanyId(),context.getGroupId(),structure);
  if (authorId != JournalCreationStrategy.USE_DEFAULT_USER_ID_STRATEGY) {
    userId=authorId;
  }
  boolean addCommunityPermissions=creationStrategy.addCommunityPermissions(context.getCompanyId(),context.getGroupId(),structure);
  boolean addGuestPermissions=creationStrategy.addGuestPermissions(context.getCompanyId(),context.getGroupId(),structure);
  JournalStructure existingStructure=null;
  if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
    existingStructure=JournalStructureUtil.fetchByUUID_G(structure.getUuid(),context.getGroupId());
    if (existingStructure == null) {
      existingStructure=JournalStructureLocalServiceUtil.addStructure(structure.getUuid(),userId,structureId,autoStructureId,plid,structure.getName(),structure.getDescription(),structure.getXsd(),addCommunityPermissions,addGuestPermissions);
    }
 else {
      existingStructure=JournalStructureLocalServiceUtil.updateStructure(existingStructure.getGroupId(),existingStructure.getStructureId(),structure.getName(),structure.getDescription(),structure.getXsd());
    }
  }
 else {
    existingStructure=JournalStructureLocalServiceUtil.addStructure(userId,structureId,autoStructureId,plid,structure.getName(),structure.getDescription(),structure.getXsd(),addCommunityPermissions,addGuestPermissions);
  }
  structurePKs.put(structure.getStructureId(),existingStructure.getStructureId());
  if (!structureId.equals(existingStructure.getStructureId())) {
    if (_log.isWarnEnabled()) {
      _log.warn("A structure with the ID " + structureId + " already "+ "exists. The new generated ID is "+ existingStructure.getStructureId());
    }
  }
}
