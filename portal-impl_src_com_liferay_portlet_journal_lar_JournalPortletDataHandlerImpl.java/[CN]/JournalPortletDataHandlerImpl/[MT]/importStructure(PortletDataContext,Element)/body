{
  String path=structureElement.attributeValue("path");
  if (!portletDataContext.isPathNotProcessed(path)) {
    return;
  }
  JournalStructure structure=(JournalStructure)portletDataContext.getZipEntryAsObject(path);
  long userId=portletDataContext.getUserId(structure.getUserUuid());
  JournalCreationStrategy creationStrategy=JournalCreationStrategyFactory.getInstance();
  long authorId=creationStrategy.getAuthorUserId(portletDataContext,structure);
  if (authorId != JournalCreationStrategy.USE_DEFAULT_USER_ID_STRATEGY) {
    userId=authorId;
  }
  String structureId=structure.getStructureId();
  boolean autoStructureId=false;
  if ((Validator.isNumber(structureId)) || (JournalStructureUtil.fetchByG_S(portletDataContext.getScopeGroupId(),structureId) != null)) {
    autoStructureId=true;
  }
  Map<String,String> structureIds=(Map<String,String>)portletDataContext.getNewPrimaryKeysMap(JournalStructure.class);
  String parentStructureId=MapUtil.getString(structureIds,structure.getParentStructureId(),structure.getParentStructureId());
  Document document=structureElement.getDocument();
  Element rootElement=document.getRootElement();
  Element parentStructureElement=(Element)rootElement.selectSingleNode("./structures/structure[@structure-id='" + parentStructureId + "']");
  String parentStructureUuid=GetterUtil.getString(structureElement.attributeValue("parent-structure-uuid"));
  if ((parentStructureElement != null) && Validator.isNotNull(parentStructureId)) {
    importStructure(portletDataContext,parentStructureElement);
    parentStructureId=structureIds.get(parentStructureId);
  }
 else   if (Validator.isNotNull(parentStructureUuid)) {
    JournalStructure parentStructure=JournalStructureLocalServiceUtil.getJournalStructureByUuidAndGroupId(parentStructureUuid,portletDataContext.getGroupId());
    parentStructureId=parentStructure.getStructureId();
  }
  boolean addCommunityPermissions=creationStrategy.addCommunityPermissions(portletDataContext,structure);
  boolean addGuestPermissions=creationStrategy.addGuestPermissions(portletDataContext,structure);
  ServiceContext serviceContext=portletDataContext.createServiceContext(structureElement,structure,_NAMESPACE);
  serviceContext.setAddCommunityPermissions(addCommunityPermissions);
  serviceContext.setAddGuestPermissions(addGuestPermissions);
  JournalStructure importedStructure=null;
  if (portletDataContext.isDataStrategyMirror()) {
    JournalStructure existingStructure=JournalStructureUtil.fetchByUUID_G(structure.getUuid(),portletDataContext.getScopeGroupId());
    if (existingStructure == null) {
      serviceContext.setUuid(structure.getUuid());
      importedStructure=JournalStructureLocalServiceUtil.addStructure(userId,portletDataContext.getScopeGroupId(),structureId,autoStructureId,parentStructureId,structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
    }
 else {
      importedStructure=JournalStructureLocalServiceUtil.updateStructure(existingStructure.getGroupId(),existingStructure.getStructureId(),parentStructureId,structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
    }
  }
 else {
    importedStructure=JournalStructureLocalServiceUtil.addStructure(userId,portletDataContext.getScopeGroupId(),structureId,autoStructureId,parentStructureId,structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
  }
  portletDataContext.importClassedModel(structure,importedStructure,_NAMESPACE);
  if (!structureId.equals(importedStructure.getStructureId())) {
    if (_log.isWarnEnabled()) {
      _log.warn("A structure with the ID " + structureId + " already "+ "exists. The new generated ID is "+ importedStructure.getStructureId());
    }
  }
}
