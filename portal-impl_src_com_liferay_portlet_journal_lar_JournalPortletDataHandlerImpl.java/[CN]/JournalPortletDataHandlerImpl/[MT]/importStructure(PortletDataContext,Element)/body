{
  String path=structureElement.attributeValue("path");
  if (!context.isPathNotProcessed(path)) {
    return;
  }
  JournalStructure structure=(JournalStructure)context.getZipEntryAsObject(path);
  long userId=context.getUserId(structure.getUserUuid());
  String structureId=structure.getStructureId();
  boolean autoStructureId=false;
  if ((Validator.isNumber(structureId)) || (JournalStructureUtil.fetchByG_S(context.getScopeGroupId(),structureId) != null)) {
    autoStructureId=true;
  }
  JournalCreationStrategy creationStrategy=JournalCreationStrategyFactory.getInstance();
  long authorId=creationStrategy.getAuthorUserId(context,structure);
  if (authorId != JournalCreationStrategy.USE_DEFAULT_USER_ID_STRATEGY) {
    userId=authorId;
  }
  boolean addCommunityPermissions=creationStrategy.addCommunityPermissions(context,structure);
  boolean addGuestPermissions=creationStrategy.addGuestPermissions(context,structure);
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddCommunityPermissions(addCommunityPermissions);
  serviceContext.setAddGuestPermissions(addGuestPermissions);
  serviceContext.setCreateDate(structure.getCreateDate());
  serviceContext.setModifiedDate(structure.getModifiedDate());
  JournalStructure existingStructure=null;
  if (context.isDataStrategyMirror()) {
    existingStructure=JournalStructureUtil.fetchByUUID_G(structure.getUuid(),context.getScopeGroupId());
    if (existingStructure == null) {
      serviceContext.setUuid(structure.getUuid());
      existingStructure=JournalStructureLocalServiceUtil.addStructure(userId,context.getScopeGroupId(),structureId,autoStructureId,structure.getParentStructureId(),structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
    }
 else {
      existingStructure=JournalStructureLocalServiceUtil.updateStructure(existingStructure.getGroupId(),existingStructure.getStructureId(),structure.getParentStructureId(),structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
    }
  }
 else {
    existingStructure=JournalStructureLocalServiceUtil.addStructure(userId,context.getScopeGroupId(),structureId,autoStructureId,structure.getParentStructureId(),structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
  }
  Map<String,String> structureIds=(Map<String,String>)context.getNewPrimaryKeysMap(JournalStructure.class);
  structureIds.put(structureId,existingStructure.getStructureId());
  context.importPermissions(JournalStructure.class,structure.getId(),existingStructure.getId());
  if (!structureId.equals(existingStructure.getStructureId())) {
    if (_log.isWarnEnabled()) {
      _log.warn("A structure with the ID " + structureId + " already "+ "exists. The new generated ID is "+ existingStructure.getStructureId());
    }
  }
}
