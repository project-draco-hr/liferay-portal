{
  if (!context.isPathNotProcessed(path)) {
    return;
  }
  JournalStructure structure=(JournalStructure)context.getZipEntryAsObject(path);
  long userId=context.getUserId(structure.getUserUuid());
  long groupId=context.getGroupId();
  String structureId=structure.getStructureId();
  boolean autoStructureId=false;
  if ((Validator.isNumber(structureId)) || (JournalStructureUtil.fetchByG_S(groupId,structureId) != null)) {
    autoStructureId=true;
  }
  JournalCreationStrategy creationStrategy=JournalCreationStrategyFactory.getInstance();
  long authorId=creationStrategy.getAuthorUserId(context,structure);
  if (authorId != JournalCreationStrategy.USE_DEFAULT_USER_ID_STRATEGY) {
    userId=authorId;
  }
  boolean addCommunityPermissions=creationStrategy.addCommunityPermissions(context,structure);
  boolean addGuestPermissions=creationStrategy.addGuestPermissions(context,structure);
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddCommunityPermissions(addCommunityPermissions);
  serviceContext.setAddGuestPermissions(addGuestPermissions);
  JournalStructure existingStructure=null;
  if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
    existingStructure=JournalStructureUtil.fetchByUUID_G(structure.getUuid(),groupId);
    if (existingStructure == null) {
      existingStructure=JournalStructureLocalServiceUtil.addStructure(structure.getUuid(),userId,groupId,structureId,autoStructureId,structure.getParentStructureId(),structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
    }
 else {
      existingStructure=JournalStructureLocalServiceUtil.updateStructure(existingStructure.getGroupId(),existingStructure.getStructureId(),structure.getParentStructureId(),structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
    }
  }
 else {
    existingStructure=JournalStructureLocalServiceUtil.addStructure(userId,groupId,structureId,autoStructureId,structure.getParentStructureId(),structure.getName(),structure.getDescription(),structure.getXsd(),serviceContext);
  }
  structureIds.put(structureId,existingStructure.getStructureId());
  if (!structureId.equals(existingStructure.getStructureId())) {
    if (_log.isWarnEnabled()) {
      _log.warn("A structure with the ID " + structureId + " already "+ "exists. The new generated ID is "+ existingStructure.getStructureId());
    }
  }
}
