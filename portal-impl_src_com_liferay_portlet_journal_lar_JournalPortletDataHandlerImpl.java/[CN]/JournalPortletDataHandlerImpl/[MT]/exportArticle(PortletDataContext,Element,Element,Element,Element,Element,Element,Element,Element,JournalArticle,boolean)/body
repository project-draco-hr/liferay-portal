{
  if (checkDateRange && !portletDataContext.isWithinDateRange(article.getModifiedDate())) {
    return;
  }
  if ((article.getStatus() != WorkflowConstants.STATUS_APPROVED) && (article.getStatus() != WorkflowConstants.STATUS_EXPIRED)) {
    return;
  }
  String path=getArticlePath(portletDataContext,article);
  if (!portletDataContext.isPathNotProcessed(path)) {
    return;
  }
  article=(JournalArticle)article.clone();
  Element articleElement=(Element)articlesElement.selectSingleNode("//article[@path='".concat(path).concat("']"));
  if (articleElement == null) {
    articleElement=articlesElement.addElement("article");
  }
  articleElement.addAttribute("path",path);
  articleElement.addAttribute("article-resource-uuid",article.getArticleResourceUuid());
  article.setUserUuid(article.getUserUuid());
  Group companyGroup=GroupLocalServiceUtil.getCompanyGroup(article.getCompanyId());
  if (Validator.isNotNull(article.getStructureId())) {
    JournalStructure structure=null;
    try {
      structure=JournalStructureLocalServiceUtil.getStructure(article.getGroupId(),article.getStructureId());
    }
 catch (    NoSuchStructureException nsse) {
      structure=JournalStructureLocalServiceUtil.getStructure(companyGroup.getGroupId(),article.getStructureId());
    }
    articleElement.addAttribute("structure-uuid",structure.getUuid());
    if (structure.getGroupId() == companyGroup.getGroupId()) {
      exportStructure(portletDataContext,structuresElement,structure);
    }
  }
  if (Validator.isNotNull(article.getTemplateId())) {
    JournalTemplate template=null;
    try {
      template=JournalTemplateLocalServiceUtil.getTemplate(portletDataContext.getScopeGroupId(),article.getTemplateId());
    }
 catch (    NoSuchTemplateException nste) {
      template=JournalTemplateLocalServiceUtil.getTemplate(companyGroup.getGroupId(),article.getTemplateId());
    }
    articleElement.addAttribute("template-uuid",template.getUuid());
    if (template.getGroupId() == companyGroup.getGroupId()) {
      exportTemplate(portletDataContext,templatesElement,dlFoldersElement,dlFileEntriesElement,dlFileRanksElement,igFoldersElement,igImagesElement,template,checkDateRange);
    }
  }
  Image smallImage=ImageUtil.fetchByPrimaryKey(article.getSmallImageId());
  if (article.isSmallImage() && (smallImage != null)) {
    String smallImagePath=getArticleSmallImagePath(portletDataContext,article);
    articleElement.addAttribute("small-image-path",smallImagePath);
    article.setSmallImageType(smallImage.getType());
    portletDataContext.addZipEntry(smallImagePath,smallImage.getTextObj());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"images")) {
    String imagePath=getArticleImagePath(portletDataContext,article);
    articleElement.addAttribute("image-path",imagePath);
    List<JournalArticleImage> articleImages=JournalArticleImageUtil.findByG_A_V(article.getGroupId(),article.getArticleId(),article.getVersion());
    for (    JournalArticleImage articleImage : articleImages) {
      Image image=null;
      try {
        image=ImageUtil.findByPrimaryKey(articleImage.getArticleImageId());
      }
 catch (      NoSuchImageException nsie) {
        continue;
      }
      String articleImagePath=getArticleImagePath(portletDataContext,article,articleImage,image);
      if (!portletDataContext.isPathNotProcessed(articleImagePath)) {
        continue;
      }
      portletDataContext.addZipEntry(articleImagePath,image.getTextObj());
    }
  }
  article.setStatusByUserUuid(article.getStatusByUserUuid());
  portletDataContext.addPermissions(JournalArticle.class,article.getResourcePrimKey());
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"categories")) {
    portletDataContext.addAssetCategories(JournalArticle.class,article.getResourcePrimKey());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"comments")) {
    portletDataContext.addComments(JournalArticle.class,article.getResourcePrimKey());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"ratings")) {
    portletDataContext.addRatingsEntries(JournalArticle.class,article.getResourcePrimKey());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"tags")) {
    portletDataContext.addAssetTags(JournalArticle.class,article.getResourcePrimKey());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"embedded-assets")) {
    String content=article.getContent();
    content=exportDLFileEntries(portletDataContext,dlFoldersElement,dlFileEntriesElement,dlFileRanksElement,articleElement,content,checkDateRange);
    content=exportIGImages(portletDataContext,igFoldersElement,igImagesElement,articleElement,content,checkDateRange);
    content=exportLayoutFriendlyURLs(portletDataContext,content);
    content=exportLinksToLayout(portletDataContext,content);
    article.setContent(content);
  }
  portletDataContext.addZipEntry(path,article);
}
