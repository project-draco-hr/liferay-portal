{
  String path=feedElement.attributeValue("path");
  if (!portletDataContext.isPathNotProcessed(path)) {
    return;
  }
  JournalFeed feed=(JournalFeed)portletDataContext.getZipEntryAsObject(path);
  long userId=portletDataContext.getUserId(feed.getUserUuid());
  JournalCreationStrategy creationStrategy=JournalCreationStrategyFactory.getInstance();
  long authorId=creationStrategy.getAuthorUserId(portletDataContext,feed);
  if (authorId != JournalCreationStrategy.USE_DEFAULT_USER_ID_STRATEGY) {
    userId=authorId;
  }
  Group group=GroupLocalServiceUtil.getGroup(portletDataContext.getScopeGroupId());
  String newGroupFriendlyURL=group.getFriendlyURL().substring(1);
  String[] friendlyUrlParts=StringUtil.split(feed.getTargetLayoutFriendlyUrl(),'/');
  String oldGroupFriendlyURL=friendlyUrlParts[2];
  if (oldGroupFriendlyURL.equals("@data_handler_group_friendly_url@")) {
    feed.setTargetLayoutFriendlyUrl(StringUtil.replace(feed.getTargetLayoutFriendlyUrl(),"@data_handler_group_friendly_url@",newGroupFriendlyURL));
  }
  String feedId=feed.getFeedId();
  boolean autoFeedId=false;
  if ((Validator.isNumber(feedId)) || (JournalFeedUtil.fetchByG_F(portletDataContext.getScopeGroupId(),feedId) != null)) {
    autoFeedId=true;
  }
  Map<String,String> structureIds=(Map<String,String>)portletDataContext.getNewPrimaryKeysMap(JournalStructure.class + ".structureId");
  String parentStructureId=MapUtil.getString(structureIds,feed.getStructureId(),feed.getStructureId());
  Map<String,String> templateIds=(Map<String,String>)portletDataContext.getNewPrimaryKeysMap(JournalTemplate.class + ".templateId");
  String parentTemplateId=MapUtil.getString(templateIds,feed.getTemplateId(),feed.getTemplateId());
  String parentRenderTemplateId=MapUtil.getString(templateIds,feed.getRendererTemplateId(),feed.getRendererTemplateId());
  boolean addGroupPermissions=creationStrategy.addGroupPermissions(portletDataContext,feed);
  boolean addGuestPermissions=creationStrategy.addGuestPermissions(portletDataContext,feed);
  ServiceContext serviceContext=portletDataContext.createServiceContext(feedElement,feed,_NAMESPACE);
  serviceContext.setAddGroupPermissions(addGroupPermissions);
  serviceContext.setAddGuestPermissions(addGuestPermissions);
  JournalFeed importedFeed=null;
  try {
    if (portletDataContext.isDataStrategyMirror()) {
      JournalFeed existingFeed=JournalFeedUtil.fetchByUUID_G(feed.getUuid(),portletDataContext.getScopeGroupId());
      if (existingFeed == null) {
        serviceContext.setUuid(feed.getUuid());
        importedFeed=JournalFeedLocalServiceUtil.addFeed(userId,portletDataContext.getScopeGroupId(),feedId,autoFeedId,feed.getName(),feed.getDescription(),feed.getType(),parentStructureId,parentTemplateId,parentRenderTemplateId,feed.getDelta(),feed.getOrderByCol(),feed.getOrderByType(),feed.getTargetLayoutFriendlyUrl(),feed.getTargetPortletId(),feed.getContentField(),feed.getFeedType(),feed.getFeedVersion(),serviceContext);
      }
 else {
        importedFeed=JournalFeedLocalServiceUtil.updateFeed(existingFeed.getGroupId(),existingFeed.getFeedId(),feed.getName(),feed.getDescription(),feed.getType(),parentStructureId,parentTemplateId,parentRenderTemplateId,feed.getDelta(),feed.getOrderByCol(),feed.getOrderByType(),feed.getTargetLayoutFriendlyUrl(),feed.getTargetPortletId(),feed.getContentField(),feed.getFeedType(),feed.getFeedVersion(),serviceContext);
      }
    }
 else {
      importedFeed=JournalFeedLocalServiceUtil.addFeed(userId,portletDataContext.getScopeGroupId(),feedId,autoFeedId,feed.getName(),feed.getDescription(),feed.getType(),parentStructureId,parentTemplateId,parentRenderTemplateId,feed.getDelta(),feed.getOrderByCol(),feed.getOrderByType(),feed.getTargetLayoutFriendlyUrl(),feed.getTargetPortletId(),feed.getContentField(),feed.getFeedType(),feed.getFeedVersion(),serviceContext);
    }
    portletDataContext.importClassedModel(feed,importedFeed,_NAMESPACE);
    if (!feedId.equals(importedFeed.getFeedId())) {
      if (_log.isWarnEnabled()) {
        _log.warn("A feed with the ID " + feedId + " already "+ "exists. The new generated ID is "+ importedFeed.getFeedId());
      }
    }
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn("A feed with the ID " + feedId + " cannot be imported "+ "because of missing Layout with friendly URL:"+ feed.getTargetLayoutFriendlyUrl());
    }
  }
}
