{
  if (!context.isWithinDateRange(article.getModifiedDate())) {
    return;
  }
  String path=getArticlePath(context,article);
  Element articleEl=articlesEl.addElement("article");
  articleEl.addAttribute("path",path);
  if (!context.isPathNotProcessed(path)) {
    return;
  }
  if (article.isSmallImage()) {
    Image smallImage=ImageUtil.fetchByPrimaryKey(article.getSmallImageId());
    article.setSmallImageType(smallImage.getType());
    context.addZipEntry(getArticleSmallImagePath(context,article),smallImage.getTextObj());
  }
  if (context.getBooleanParameter(_NAMESPACE,"images")) {
    List<JournalArticleImage> articleImages=JournalArticleImageUtil.findByG_A_V(context.getGroupId(),article.getArticleId(),article.getVersion());
    for (    JournalArticleImage articleImage : articleImages) {
      try {
        Image image=ImageUtil.findByPrimaryKey(articleImage.getArticleImageId());
        String imagePath=getArticleImagePath(context,article,articleImage,image);
        context.addZipEntry(imagePath,image.getTextObj());
      }
 catch (      NoSuchImageException nsie) {
      }
    }
  }
  if (context.getBooleanParameter(_NAMESPACE,"comments")) {
    context.addComments(JournalArticle.class,article.getResourcePrimKey());
  }
  if (context.getBooleanParameter(_NAMESPACE,"ratings")) {
    context.addRatingsEntries(JournalArticle.class,article.getResourcePrimKey());
  }
  if (context.getBooleanParameter(_NAMESPACE,"tags")) {
    context.addTagsEntries(JournalArticle.class,article.getResourcePrimKey());
  }
  try {
    SAXReader reader=new SAXReader();
    Document doc=reader.read(new StringReader(article.getContent()));
    Element root=doc.getRootElement();
    if (context.getBooleanParameter(_NAMESPACE,"embedded-assets")) {
      List<Element> contentEls=root.elements("static-content");
      for (      Element contentEl : contentEls) {
        String text=contentEl.getText();
        text=exportDLFileEntries(context,dlFoldersEl,dlFileEntriesEl,dlFileRanks,text);
        text=exportIGImages(context,igFoldersEl,igImagesEl,text);
        contentEl.setText(text);
      }
      XPath xpathSelector=DocumentHelper.createXPath("//dynamic-content");
      contentEls=xpathSelector.selectNodes(doc);
      for (      Element contentEl : contentEls) {
        String text=contentEl.getText();
        text=exportDLFileEntries(context,dlFoldersEl,dlFileEntriesEl,dlFileRanks,text);
        text=exportIGImages(context,igFoldersEl,igImagesEl,text);
        contentEl.setText(text);
      }
    }
    article.setContent(XMLFormatter.toString(doc));
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(e,e);
    }
  }
  article.setUserUuid(article.getUserUuid());
  article.setApprovedByUserUuid(article.getApprovedByUserUuid());
  context.addZipEntry(path,article);
}
