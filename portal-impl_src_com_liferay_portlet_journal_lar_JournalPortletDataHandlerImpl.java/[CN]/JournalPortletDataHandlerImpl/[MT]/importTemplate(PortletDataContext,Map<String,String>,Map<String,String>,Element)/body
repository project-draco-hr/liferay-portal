{
  String path=el.attributeValue("path");
  if (context.isPathNotProcessed(path)) {
    JournalTemplate template=(JournalTemplate)context.getZipEntryAsObject(path);
    long userId=context.getUserId(template.getUserUuid());
    long plid=context.getPlid();
    String templateId=template.getTemplateId();
    boolean autoTemplateId=false;
    if ((Validator.isNumber(templateId)) || (JournalTemplateUtil.fetchByG_T(context.getGroupId(),templateId) != null)) {
      autoTemplateId=true;
    }
    String parentStructureId=MapUtil.getString(structureIds,template.getStructureId(),template.getStructureId());
    boolean formatXsl=false;
    JournalCreationStrategy creationStrategy=JournalCreationStrategyFactory.getInstance();
    long authorId=creationStrategy.getAuthorUserId(context,template);
    if (authorId != JournalCreationStrategy.USE_DEFAULT_USER_ID_STRATEGY) {
      userId=authorId;
    }
    boolean addCommunityPermissions=creationStrategy.addCommunityPermissions(context,template);
    boolean addGuestPermissions=creationStrategy.addGuestPermissions(context,template);
    File smallFile=null;
    if (template.isSmallImage()) {
      byte[] byteArray=context.getZipEntryAsByteArray(getSmallImagePath(context,template));
      smallFile=File.createTempFile(String.valueOf(template.getSmallImageId()),StringPool.PERIOD + template.getSmallImageType());
      FileUtil.write(smallFile,byteArray);
    }
    JournalTemplate existingTemplate=null;
    if (context.getDataStrategy().equals(PortletDataHandlerKeys.DATA_STRATEGY_MIRROR)) {
      existingTemplate=JournalTemplateUtil.fetchByUUID_G(template.getUuid(),context.getGroupId());
      if (existingTemplate == null) {
        existingTemplate=JournalTemplateLocalServiceUtil.addTemplate(template.getUuid(),userId,templateId,autoTemplateId,plid,parentStructureId,template.getName(),template.getDescription(),template.getXsl(),formatXsl,template.getLangType(),template.getCacheable(),template.isSmallImage(),template.getSmallImageURL(),smallFile,addCommunityPermissions,addGuestPermissions);
      }
 else {
        existingTemplate=JournalTemplateLocalServiceUtil.updateTemplate(existingTemplate.getGroupId(),existingTemplate.getTemplateId(),existingTemplate.getStructureId(),template.getName(),template.getDescription(),template.getXsl(),formatXsl,template.getLangType(),template.getCacheable(),template.isSmallImage(),template.getSmallImageURL(),smallFile);
      }
    }
 else {
      existingTemplate=JournalTemplateLocalServiceUtil.addTemplate(userId,templateId,autoTemplateId,plid,parentStructureId,template.getName(),template.getDescription(),template.getXsl(),formatXsl,template.getLangType(),template.getCacheable(),template.isSmallImage(),template.getSmallImageURL(),smallFile,addCommunityPermissions,addGuestPermissions);
    }
    templateIds.put(templateId,existingTemplate.getTemplateId());
    if (!templateId.equals(existingTemplate.getTemplateId())) {
      if (_log.isWarnEnabled()) {
        _log.warn("A template with the ID " + templateId + " already "+ "exists. The new generated ID is "+ existingTemplate.getTemplateId());
      }
    }
  }
}
