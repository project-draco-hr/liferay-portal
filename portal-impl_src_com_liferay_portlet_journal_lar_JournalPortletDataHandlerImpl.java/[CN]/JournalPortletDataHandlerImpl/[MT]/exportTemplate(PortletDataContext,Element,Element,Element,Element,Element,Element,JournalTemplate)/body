{
  String path=getTemplatePath(context,template);
  if (!context.isPathNotProcessed(path)) {
    return;
  }
  template=(JournalTemplate)template.clone();
  Element templateElement=templatesElement.addElement("template");
  templateElement.addAttribute("path",path);
  if (template.isSmallImage()) {
    String smallImagePath=getTemplateSmallImagePath(context,template);
    templateElement.addAttribute("small-image-path",smallImagePath);
    Image smallImage=ImageUtil.fetchByPrimaryKey(template.getSmallImageId());
    template.setSmallImageType(smallImage.getType());
    context.addZipEntry(smallImagePath,smallImage.getTextObj());
  }
  if (context.getBooleanParameter(_NAMESPACE,"embedded-assets")) {
    String content=template.getXsl();
    content=exportDLFileEntries(context,dlFoldersElement,dlFileEntriesElement,dlFileRanksElement,templateElement,content);
    content=exportIGImages(context,igFoldersElement,igImagesElement,templateElement,content);
    content=exportLayoutFriendlyURLs(context,content);
    content=StringUtil.replace(content,StringPool.AMPERSAND_ENCODED,StringPool.AMPERSAND);
    template.setXsl(content);
  }
  template.setUserUuid(template.getUserUuid());
  context.addPermissions(JournalTemplate.class,template.getId());
  context.addZipEntry(path,template);
}
