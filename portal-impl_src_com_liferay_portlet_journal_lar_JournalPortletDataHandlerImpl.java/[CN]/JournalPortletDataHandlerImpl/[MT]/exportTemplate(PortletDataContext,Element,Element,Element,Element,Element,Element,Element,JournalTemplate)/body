{
  String path=getTemplatePath(portletDataContext,template);
  if (!portletDataContext.isPathNotProcessed(path)) {
    return;
  }
  template=(JournalTemplate)template.clone();
  Element templateElement=templatesElement.addElement("template");
  if (template.isSmallImage()) {
    String smallImagePath=getTemplateSmallImagePath(portletDataContext,template);
    templateElement.addAttribute("small-image-path",smallImagePath);
    Image smallImage=ImageUtil.fetchByPrimaryKey(template.getSmallImageId());
    template.setSmallImageType(smallImage.getType());
    portletDataContext.addZipEntry(smallImagePath,smallImage.getTextObj());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"embedded-assets")) {
    String content=DDMPortletDataHandlerImpl.exportReferencedContent(portletDataContext,dlFileEntryTypesElement,dlFoldersElement,dlFileEntriesElement,dlFileRanksElement,dlRepositoriesElement,dlRepositoryEntriesElement,templateElement,template.getXsl());
    template.setXsl(content);
  }
  portletDataContext.addClassedModel(templateElement,path,template,_NAMESPACE);
}
