{
  if (markLimitIndex < 0) {
    index=firstInvalidIndex=0;
    int number=reader.read(buffer);
    if (number > 0) {
      firstInvalidIndex=number;
    }
    return;
  }
  if (index >= markLimitIndex) {
    markLimitIndex=-1;
    index=firstInvalidIndex=0;
  }
 else   if (index == buffer.length) {
    int newBufferSize=buffer.length * 2;
    if (newBufferSize > markLimitIndex) {
      newBufferSize=markLimitIndex;
    }
    char[] newBuffer=new char[newBufferSize];
    System.arraycopy(buffer,0,newBuffer,0,buffer.length);
    buffer=newBuffer;
  }
  firstInvalidIndex=index;
  int number=reader.read(buffer,index,buffer.length - index);
  if (number > 0) {
    firstInvalidIndex+=number;
  }
}
