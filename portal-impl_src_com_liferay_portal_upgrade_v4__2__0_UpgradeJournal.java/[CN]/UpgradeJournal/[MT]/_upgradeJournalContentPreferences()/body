{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getConnection();
    ps=con.prepareStatement(_FIND_PORTLET_PREFERENCES);
    ps.setString(1,"56_INSTANCE_%");
    rs=ps.executeQuery();
    while (rs.next()) {
      String portletId=rs.getString("portletId");
      String layoutId=rs.getString("layoutId");
      String ownerId=rs.getString("ownerId");
      String preferences=rs.getString("preferences");
      String companyId=rs.getString("companyId");
      PortletPreferences portletPreferences=PortletPreferencesSerializer.fromDefaultXML(preferences);
      String groupId=portletPreferences.getValue("group-id",StringPool.BLANK);
      String[] articleIds=portletPreferences.getValues("article-id",new String[0]);
      if ((Validator.isNull(groupId)) && (articleIds != null) && (articleIds.length > 0)) {
        String articleId=articleIds[0];
        groupId=_findGroupId(_FIND_JOURNAL_ARTICLE_GROUP,companyId,articleId);
        String primaryKey=StringPool.OPEN_CURLY_BRACE + portletId + StringPool.COMMA+ layoutId+ StringPool.COMMA+ ownerId+ StringPool.CLOSE_CURLY_BRACE;
        if (groupId != null) {
          _log.info("Upgrading portlet preferences " + primaryKey);
          int beginIndex="<portlet-preferences>".length();
          StringBuilder sb=new StringBuilder(preferences.substring(0,beginIndex) + "<preference><name>group-id</name><value>" + groupId+ "</value></preference>"+ preferences.substring(beginIndex));
          ps=con.prepareStatement(_UPDATE_PORTLET_PREFERENCES);
          ps.setString(1,sb.toString());
          ps.setString(2,portletId);
          ps.setString(3,layoutId);
          ps.setString(4,ownerId);
          ps.executeUpdate();
        }
 else {
          _log.warn("No group id found for joural content with " + "portletpreferences id " + primaryKey + " and article id "+ articleId);
        }
      }
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
