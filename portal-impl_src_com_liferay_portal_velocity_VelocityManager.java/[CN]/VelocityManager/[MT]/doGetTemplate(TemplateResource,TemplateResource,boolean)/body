{
  Map<String,Object> helperUtilities=_templateContextHelper.getHelperUtilities(restricted);
  VelocityContext velocityContext=getVelocityContext(helperUtilities);
  Template template=new VelocityTemplate(templateResource,errorTemplateResource,velocityContext,_velocityEngine,_templateContextHelper);
  if (restricted) {
    template=new RestrictedTemplate(template,_templateContextHelper.getRestrictedVariables());
  }
  return template;
}
