{
  PortletURL portletURL=super.getPortletURL(request);
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  String privateLayout=ParamUtil.getString(request,"privateLayout");
  if (Validator.isNotNull(privateLayout)) {
    portletURL.setParameter("privateLayout",privateLayout);
  }
 else   if (!layout.isTypeControlPanel()) {
    portletURL.setParameter("privateLayout",String.valueOf(layout.isPrivateLayout()));
  }
  return portletURL;
}
