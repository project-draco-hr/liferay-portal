{
  InputStream inputStream=null;
  try {
    UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
    ServiceContext serviceContext=ServiceContextFactory.getInstance(CalEvent.class.getName(),actionRequest);
    String fileName=uploadPortletRequest.getFileName("file");
    validate(fileName);
    inputStream=uploadPortletRequest.getFileAsStream("file");
    CalEventServiceUtil.importICal4j(serviceContext.getScopeGroupId(),inputStream);
    sendRedirect(actionRequest,actionResponse);
  }
 catch (  Exception e) {
    if (!(e instanceof ImportEventsException)) {
      _log.error(e,e);
    }
    SessionErrors.add(actionRequest,e.getClass().getName());
    setForward(actionRequest,"portlet.calendar.error");
  }
 finally {
    StreamUtil.cleanUp(inputStream);
  }
}
