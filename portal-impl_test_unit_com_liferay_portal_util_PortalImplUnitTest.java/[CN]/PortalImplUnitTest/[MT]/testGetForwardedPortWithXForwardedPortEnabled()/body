{
  boolean webServerForwardedPortEnabled=PropsValues.WEB_SERVER_FORWARDED_PORT_ENABLED;
  try {
    setPropsValuesValue("WEB_SERVER_FORWARDED_PORT_ENABLED",true);
    MockHttpServletRequest mockHttpServletRequest=new MockHttpServletRequest();
    mockHttpServletRequest.addHeader("X-Forwarded-Port","8081");
    mockHttpServletRequest.setServerPort(8080);
    Assert.assertEquals(8081,_portalImpl.getForwardedPort(mockHttpServletRequest));
  }
  finally {
    setPropsValuesValue("WEB_SERVER_FORWARDED_PORT_ENABLED",webServerForwardedPortEnabled);
  }
}
