{
  MockHttpServletRequest mockHttpServletRequest=new MockHttpServletRequest();
  mockHttpServletRequest.addHeader("X-Forwarded-Custom-Port",8081);
  mockHttpServletRequest.setServerPort(8080);
  boolean originalForwardedPort=PropsValues.WEB_SERVER_FORWARDED_PORT_ENABLED;
  String originalForwardedPortHeader=PropsValues.WEB_SERVER_FORWARDED_PORT_HEADER;
  try {
    setPropsValuesValue("WEB_SERVER_FORWARDED_PORT_ENABLED",false);
    setPropsValuesValue("WEB_SERVER_FORWARDED_PORT_HEADER","X-Forwarded-Custom-Port");
    int newServerPort=_portalImpl.getForwardedPort(mockHttpServletRequest);
    Assert.assertEquals(8080,newServerPort);
  }
  finally {
    setPropsValuesValue("WEB_SERVER_FORWARDED_PORT_ENABLED",originalForwardedPort);
    setPropsValuesValue("WEB_SERVER_FORWARDED_PORT_HEADER",originalForwardedPortHeader);
  }
}
