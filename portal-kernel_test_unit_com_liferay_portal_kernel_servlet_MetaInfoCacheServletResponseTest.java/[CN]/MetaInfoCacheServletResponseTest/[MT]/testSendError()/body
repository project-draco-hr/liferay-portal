{
  final AtomicReference<String> messageReference=new AtomicReference<>();
  final AtomicInteger statusReference=new AtomicInteger();
  StubHttpServletResponse stubHttpServletResponse=new StubHttpServletResponse(){
    @Override public boolean isCommitted(){
      return false;
    }
    @Override public void resetBuffer(){
    }
    @Override public void sendError(    int status){
      statusReference.set(status);
    }
    @Override public void sendError(    int status,    String message){
      statusReference.set(status);
      messageReference.set(message);
    }
  }
;
  MetaInfoCacheServletResponse metaInfoCacheServletResponse=new MetaInfoCacheServletResponse(stubHttpServletResponse);
  metaInfoCacheServletResponse.sendError(400,"Bad Page");
  Assert.assertEquals("Bad Page",messageReference.get());
  Assert.assertTrue(metaInfoCacheServletResponse.isCommitted());
  Assert.assertEquals(400,metaInfoCacheServletResponse.getStatus());
  Assert.assertEquals(400,statusReference.get());
  messageReference.set(null);
  statusReference.set(0);
  metaInfoCacheServletResponse=new MetaInfoCacheServletResponse(stubHttpServletResponse);
  metaInfoCacheServletResponse.sendError(404);
  Assert.assertNull(messageReference.get());
  Assert.assertTrue(metaInfoCacheServletResponse.isCommitted());
  Assert.assertEquals(404,metaInfoCacheServletResponse.getStatus());
  Assert.assertEquals(404,statusReference.get());
  messageReference.set(null);
  statusReference.set(0);
  metaInfoCacheServletResponse=new MetaInfoCacheServletResponse(stubHttpServletResponse);
  metaInfoCacheServletResponse.flushBuffer();
  try {
    metaInfoCacheServletResponse.sendError(500,"After commit");
    Assert.fail();
  }
 catch (  IllegalStateException ise) {
  }
  metaInfoCacheServletResponse=new MetaInfoCacheServletResponse(stubHttpServletResponse);
  metaInfoCacheServletResponse.flushBuffer();
  try {
    metaInfoCacheServletResponse.sendError(500);
    Assert.fail();
  }
 catch (  IllegalStateException ise) {
  }
}
