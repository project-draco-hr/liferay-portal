{
  modify(OperationMode.EMBEDDED);
  resetMockConnections();
  Mockito.doThrow(IllegalStateException.class).when(_remoteElasticsearchConnection).connect();
  try {
    modify(OperationMode.REMOTE);
    Assert.fail();
  }
 catch (  IllegalStateException ise) {
  }
  Assert.assertSame(_embeddedElasticsearchConnection,_elasticsearchConnectionManager.getElasticsearchConnection());
  verifyConnectNeverClose(_remoteElasticsearchConnection);
  verifyNeverCloseNeverConnect(_embeddedElasticsearchConnection);
}
