{
  try {
    if (_log.isDebugEnabled()) {
      _log.debug("Running " + req.getRemoteUser());
    }
    HttpSession ses=req.getSession();
    long companyId=PortalUtil.getCompanyId(req);
    long userId=PortalUtil.getUserId(req);
    if (PropsValues.REVERSE_AJAX_ENABLED) {
      ses.setAttribute(WebKeys.REVERSE_AJAX,new ReverseAjax());
    }
    MessagingUtil.createXMPPConnection(ses,userId);
    LiveUsers.signIn(req);
    ses.removeAttribute(Globals.LOCALE_KEY);
  }
 catch (  Exception e) {
    throw new ActionException(e);
  }
}
