{
  LiferayPortletURL liferayViewPageURL=(LiferayPortletURL)viewPageURL;
  LiferayPortletURL liferayEditPageURL=(LiferayPortletURL)editPageURL;
  WikiEngine wikiEngine=fetchWikiEngine(page.getFormat());
  if (wikiEngine == null) {
    throw new WikiFormatException();
  }
  String content=wikiEngine.convert(page,viewPageURL,editPageURL,attachmentURLPrefix);
  String editPageURLString=StringPool.BLANK;
  if (editPageURL != null) {
    liferayEditPageURL.setParameter("title","__REPLACEMENT__",false);
    editPageURLString=editPageURL.toString();
    editPageURLString=StringUtil.replace(editPageURLString,"__REPLACEMENT__","$1");
  }
  Matcher matcher=_editPageURLPattern.matcher(content);
  content=_convertURLs(editPageURLString,matcher);
  String viewPageURLString=StringPool.BLANK;
  if (viewPageURL != null) {
    liferayViewPageURL.setParameter("title","__REPLACEMENT__",false);
    viewPageURLString=viewPageURL.toString();
    viewPageURLString=StringUtil.replace(viewPageURLString,"__REPLACEMENT__","$1");
  }
  matcher=_viewPageURLPattern.matcher(content);
  content=_convertURLs(viewPageURLString,matcher);
  content=_replaceAttachments(content,page.getTitle(),attachmentURLPrefix);
  return content;
}
