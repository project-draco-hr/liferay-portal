{
  ThreadPoolExecutor threadPoolExecutor=new ThreadPoolExecutor(1,2,TestUtil.KEEPALIVE_TIME,TimeUnit.MILLISECONDS,true,3);
  try {
    Assert.assertEquals(0,threadPoolExecutor.getActiveCount());
    Assert.assertEquals(0,threadPoolExecutor.getPoolSize());
    for (int i=0; i < 10; i++) {
      MarkerBlockingJob markerBlockingJob=new MarkerBlockingJob();
      threadPoolExecutor.execute(markerBlockingJob);
      markerBlockingJob.waitUntilEnded();
      Thread.sleep(TestUtil.KEEPALIVE_WAIT);
      Assert.assertTrue(markerBlockingJob.isEnded());
      Assert.assertEquals(0,threadPoolExecutor.getActiveCount());
      Assert.assertEquals(0,threadPoolExecutor.getPoolSize());
      Assert.assertEquals(i + 1,threadPoolExecutor.getCompletedTaskCount());
    }
  }
  finally {
    TestUtil.closePool(threadPoolExecutor);
  }
}
