{
  DDMStructure ddmStructure=DDMStructureLocalServiceUtil.getStructure(ddmStructureId);
  try {
    DDMTemplate ddmTemplate=DDMTemplateLocalServiceUtil.getTemplate(ddmTemplateId);
    ddmStructure.setXsd(ddmTemplate.getScript());
  }
 catch (  NoSuchTemplateException nste) {
  }
  Set<String> fieldNames=ddmStructure.getFieldNames();
  Fields fields=new Fields();
  for (  String fieldName : fieldNames) {
    Field field=new Field();
    field.setName(fieldName);
    String fieldDataType=ddmStructure.getFieldDataType(fieldName);
    String fieldType=ddmStructure.getFieldType(fieldName);
    String fieldValue=uploadPortletRequest.getParameter(fieldName);
    if (fieldDataType.equals(FieldConstants.FILE_UPLOAD)) {
      continue;
    }
    if (fieldType.equals("radio") || fieldType.equals("select")) {
      String[] fieldValues=ParamUtil.getParameterValues(uploadPortletRequest,fieldName);
      fieldValue=JSONFactoryUtil.serialize(fieldValues);
    }
    if (fieldValue != null) {
      Serializable fieldValueSerializable=FieldConstants.getSerializable(fieldDataType,GetterUtil.getString(fieldValue));
      field.setValue(fieldValueSerializable);
      fields.put(field);
    }
  }
  return fields;
}
