{
  _themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  _companyId=_themeDisplay.getCompanyId();
  long fileEntryTypeId=ParamUtil.getLong(request,"fileEntryTypeId",-1);
  if ((_fileEntryTypeId == -1) && (_fileEntry != null) && (_fileEntry.getModel() instanceof DLFileEntry)) {
    DLFileEntry dlFileEntry=(DLFileEntry)_fileEntry.getModel();
    fileEntryTypeId=dlFileEntry.getFileEntryTypeId();
  }
  _fileEntryTypeId=fileEntryTypeId;
  _folderId=BeanParamUtil.getLong(_fileEntry,request,"folderId");
  _scopeGroupId=_themeDisplay.getScopeGroupId();
  PortletDisplay portletDisplay=_themeDisplay.getPortletDisplay();
  try {
    _dlPortletInstanceSettings=DLPortletInstanceSettings.getInstance(_themeDisplay.getLayout(),portletDisplay.getId());
  }
 catch (  PortalException pe) {
    throw new SystemException(pe);
  }
  _fileEntryDisplayContextHelper=new FileEntryDisplayContextHelper(request,_fileEntry);
  _fileVersionDisplayContextHelper=new FileVersionDisplayContextHelper(request,_fileVersion);
}
