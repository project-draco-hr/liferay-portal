{
  if (!PropsValues.DL_FILE_ENTRY_TYPE_IG_IMAGE_AUTO_CREATE_ON_UPGRADE) {
    return xml;
  }
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
  String[] classNameIds=portletPreferences.getValues("classNameIds",null);
  if ((classNameIds != null) && (classNameIds.length > 0)) {
    long dlFileEntryClassNameId=PortalUtil.getClassNameId(DLFileEntry.class.getName());
    long igImageClassNameId=PortalUtil.getClassNameId("com.liferay.portlet.imagegallery.model.IGImage");
    List<String> classNameIdsList=ListUtil.fromArray(classNameIds);
    int index=classNameIdsList.indexOf(String.valueOf(igImageClassNameId));
    if (index >= 0) {
      classNameIdsList.remove(index);
      if (!classNameIdsList.contains(String.valueOf(dlFileEntryClassNameId))) {
        classNameIdsList.add(index,String.valueOf(dlFileEntryClassNameId));
      }
    }
    portletPreferences.setValues("classNameIds",classNameIdsList.toArray(new String[classNameIdsList.size()]));
    long fileEntryTypeId=getIGImageFileEntryType(companyId);
    portletPreferences.setValue("anyClassTypeDLFileEntryAssetRendererFactory",String.valueOf(fileEntryTypeId));
    portletPreferences.setValue("classTypeIds",String.valueOf(fileEntryTypeId));
  }
  return PortletPreferencesFactoryUtil.toXML(portletPreferences);
}
