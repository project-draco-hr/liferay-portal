{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  String name=ParamUtil.getString(req,"name");
  if (Validator.isNull(name)) {
    throw new PortletItemNameException();
  }
  PortletPreferences setup=PortletPreferencesFactoryUtil.getPortletSetup(req,portlet.getPortletId());
  PortletPreferencesServiceUtil.savePreferences(themeDisplay.getUserId(),themeDisplay.getLayout().getGroupId(),portlet.getRootPortletId(),name,setup);
}
