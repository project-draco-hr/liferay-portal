{
  boolean workflowEnabled=WorkflowThreadLocal.isEnabled();
  try {
    WorkflowThreadLocal.setEnabled(true);
    serviceContext=(ServiceContext)serviceContext.clone();
    serviceContext.setWorkflowAction(WorkflowConstants.ACTION_SAVE_DRAFT);
    WikiPage copy=WikiPageLocalServiceUtil.addPage(page.getUserId(),page.getNodeId(),ServiceTestUtil.randomString(),page.getContent(),"Summary",true,serviceContext);
    if (approved) {
      copy=WikiPageLocalServiceUtil.updateStatus(page.getUserId(),copy.getResourcePrimKey(),WorkflowConstants.STATUS_APPROVED,serviceContext);
    }
    WikiPageLocalServiceUtil.copyPageAttachments(page.getUserId(),page.getNodeId(),page.getTitle(),copy.getTitle());
    return copy;
  }
  finally {
    WorkflowThreadLocal.setEnabled(workflowEnabled);
  }
}
