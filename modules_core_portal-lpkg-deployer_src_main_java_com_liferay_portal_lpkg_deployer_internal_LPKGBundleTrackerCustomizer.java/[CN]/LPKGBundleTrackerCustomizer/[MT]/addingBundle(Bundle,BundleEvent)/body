{
  URL url=bundle.getEntry("liferay-marketplace.properties");
  if (url == null) {
    return null;
  }
  List<Bundle> bundles=new ArrayList<>();
  try {
    Enumeration<URL> enumeration=bundle.findEntries("/","*.jar",false);
    if (enumeration != null) {
      while (enumeration.hasMoreElements()) {
        url=enumeration.nextElement();
        Bundle newBundle=_bundleContext.installBundle(url.getPath(),url.openStream());
        BundleStartLevel bundleStartLevel=newBundle.adapt(BundleStartLevel.class);
        bundleStartLevel.setStartLevel(PropsValues.MODULE_FRAMEWORK_DYNAMIC_INSTALL_START_LEVEL);
        bundles.add(newBundle);
      }
    }
    enumeration=bundle.findEntries("/","*.war",false);
    if (enumeration == null) {
      return bundles;
    }
    while (enumeration.hasMoreElements()) {
      url=enumeration.nextElement();
      Bundle newBundle=_bundleContext.installBundle(url.getPath(),_toWARWrapperBundle(bundle,url));
      BundleStartLevel bundleStartLevel=newBundle.adapt(BundleStartLevel.class);
      bundleStartLevel.setStartLevel(PropsValues.MODULE_FRAMEWORK_DYNAMIC_INSTALL_START_LEVEL);
      bundles.add(newBundle);
    }
  }
 catch (  Exception e) {
    _log.error("Rollback bundle installation for " + bundles,e);
    for (    Bundle newBundle : bundles) {
      try {
        newBundle.uninstall();
      }
 catch (      BundleException be) {
        _log.error("Unable to uninstall bundle " + newBundle,be);
      }
    }
    return null;
  }
  return bundles;
}
