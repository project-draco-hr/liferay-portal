{
  if (SearchEngineUtil.isIndexReadOnly()) {
    return;
  }
  if (_log.isInfoEnabled()) {
    _log.info("Reindexing Lucene started");
  }
  if (delay < 0) {
    delay=0;
  }
  try {
    if (delay > 0) {
      Thread.sleep(Time.SECOND * delay);
    }
  }
 catch (  InterruptedException ie) {
  }
  StopWatch stopWatch=new StopWatch();
  stopWatch.start();
  try {
    SearchEngineUtil.removeCompany(_companyId);
    SearchEngineUtil.initialize(_companyId);
    List<Indexer<?>> indexers=IndexerRegistryUtil.getIndexers();
    Set<String> searchEngineIds=new HashSet<>();
    for (    Indexer<?> indexer : indexers) {
      String searchEngineId=indexer.getSearchEngineId();
      if (searchEngineIds.add(searchEngineId)) {
        SearchEngineUtil.deleteEntityDocuments(searchEngineId,_companyId,indexer.getClassName(),true);
      }
      reindex(indexer);
    }
    if (_log.isInfoEnabled()) {
      _log.info("Reindexing Lucene completed in " + (stopWatch.getTime() / Time.SECOND) + " seconds");
    }
  }
 catch (  Exception e) {
    _log.error("Error encountered while reindexing",e);
    if (_log.isInfoEnabled()) {
      _log.info("Reindexing Lucene failed");
    }
  }
  _finished=true;
}
