{
  LiferayPortletURL liferayViewPageURL=(LiferayPortletURL)viewPageURL;
  LiferayPortletURL liferayEditPageURL=(LiferayPortletURL)editPageURL;
  WikiEngine engine=_getEngine(page.getFormat());
  String content=engine.convert(page,editPageURL);
  String editPageURLString=StringPool.BLANK;
  if (editPageURL != null) {
    liferayEditPageURL.setParameter("title","__REPLACEMENT__",false);
    editPageURLString=editPageURL.toString();
    editPageURLString=StringUtil.replace(editPageURLString,"__REPLACEMENT__","$1");
  }
  Matcher matcher=_editPageURLPattern.matcher(content);
  content=matcher.replaceAll(editPageURLString);
  String viewPageURLString=StringPool.BLANK;
  if (viewPageURL != null) {
    liferayViewPageURL.setParameter("title","__REPLACEMENT__",false);
    viewPageURLString=viewPageURL.toString();
    viewPageURLString=StringUtil.replace(viewPageURLString,"__REPLACEMENT__","$1");
  }
  matcher=_viewPageURLPattern.matcher(content);
  content=matcher.replaceAll(viewPageURLString);
  content=_replaceAttachments(content,page.getTitle(),attachmentURLPrefix);
  return content;
}
