{
  LiferayPortletURL liferayViewPageURL=(LiferayPortletURL)viewPageURL;
  LiferayPortletURL liferayEditPageURL=(LiferayPortletURL)editPageURL;
  WikiEngine engine=_getEngine(page.getFormat());
  String content=engine.convert(page,editPageURL);
  liferayEditPageURL.setParameter("title","__REPLACEMENT__",false);
  String editPageURLString=editPageURL.toString();
  editPageURLString=StringUtil.replace(editPageURLString,"__REPLACEMENT__","$1");
  Matcher matcher=_EDIT_PAGE_URL_PATTERN.matcher(content);
  content=matcher.replaceAll(editPageURLString);
  liferayViewPageURL.setParameter("title","$1",false);
  matcher=_VIEW_PAGE_URL_PATTERN.matcher(content);
  content=matcher.replaceAll(liferayViewPageURL.toString());
  content=_replaceAttachments(content,page.getTitle(),attachmentURLPrefix);
  return content;
}
