{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long groupId=themeDisplay.getScopeGroupId();
  List<WikiNode> allNodes=WikiNodeLocalServiceUtil.getNodes(groupId);
  List<String> allNodesNames=WikiUtil.getNodesNames(allNodes);
  boolean needOrder=false;
  String[] visibleNodes=null;
  PortletPreferences preferences=portletRequest.getPreferences();
  String visibleNodesPreference=preferences.getValue("visible-nodes",null);
  if (visibleNodesPreference == null) {
    visibleNodes=allNodesNames.toArray(new String[allNodesNames.size()]);
  }
 else {
    visibleNodes=StringUtil.split(visibleNodesPreference);
    needOrder=true;
  }
  String[] hiddenNodes=StringUtil.split(preferences.getValue("hidden-nodes",null));
  return getNodes(allNodes,visibleNodes,hiddenNodes,themeDisplay.getPermissionChecker(),needOrder,true);
}
