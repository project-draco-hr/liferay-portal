{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long groupId=themeDisplay.getScopeGroupId();
  String allNodes=ListUtil.toString(WikiNodeLocalServiceUtil.getNodes(groupId),"name");
  PortletPreferences preferences=portletRequest.getPreferences();
  String[] visibleNodes=StringUtil.split(preferences.getValue("visible-nodes",allNodes));
  String[] hiddenNodes=StringUtil.split(preferences.getValue("hidden-nodes",StringPool.BLANK));
  return getNodes(groupId,visibleNodes,hiddenNodes,themeDisplay.getPermissionChecker());
}
