{
  WikiEngine engine=_engines.get(format);
  if (engine != null) {
    return engine;
  }
synchronized (_engines) {
    engine=_engines.get(format);
    if (engine != null) {
      return engine;
    }
    try {
      String engineClass=PropsUtil.get(PropsKeys.WIKI_FORMATS_ENGINE,new Filter(format));
      if (engineClass == null) {
        throw new WikiFormatException(format);
      }
      ClassLoader classLoader=_getClassLoader();
      Class<?> clazz=classLoader.loadClass(engineClass);
      engine=(WikiEngine)clazz.newInstance();
      engine.setMainConfiguration(_readConfigurationFile(PropsKeys.WIKI_FORMATS_CONFIGURATION_MAIN,format));
      engine.setInterWikiConfiguration(_readConfigurationFile(PropsKeys.WIKI_FORMATS_CONFIGURATION_INTERWIKI,format));
      _engines.put(format,engine);
      return engine;
    }
 catch (    Exception e) {
      throw new WikiFormatException(e);
    }
  }
}
