{
  long companyId=PortalUtil.getCompanyId(req);
  long userId=PortalUtil.getUserId(req);
  if (!RoleLocalServiceUtil.hasUserRole(userId,companyId,RoleImpl.ADMINISTRATOR,true)) {
    SessionErrors.add(req,PrincipalException.class.getName());
    setForward(req,"portlet.enterprise_admin.error");
    return;
  }
  PortletPreferences prefs=PrefsPropsUtil.getPreferences(companyId);
  String cmd=ParamUtil.getString(req,Constants.CMD);
  if (cmd.equals("updateCAS")) {
    updateCAS(req,companyId,prefs);
  }
 else   if (cmd.equals("updateDefaultGroupsAndRoles")) {
    updateDefaultGroupsAndRoles(req,prefs);
  }
 else   if (cmd.equals("updateEmails")) {
    updateEmails(req,prefs);
  }
 else   if (cmd.equals("updateLdap")) {
    updateLdap(req,companyId,prefs);
  }
 else   if (cmd.equals("updateMailHostNames")) {
    updateMailHostNames(req,prefs);
  }
 else   if (cmd.equals("updateNtlm")) {
    updateNtlm(req,companyId,prefs);
  }
 else   if (cmd.equals("updateOpenId")) {
    updateOpenId(req,prefs);
  }
 else   if (cmd.equals("updateOpenSSO")) {
    updateOpenSSO(req,companyId,prefs);
  }
 else   if (cmd.equals("updateReservedUsers")) {
    updateReservedUsers(req,prefs);
  }
 else   if (cmd.equals("updateSecurity")) {
    updateSecurity(req);
  }
  if (SessionErrors.isEmpty(req)) {
    if (!cmd.equals("updateLdap") && !cmd.equals("updateSecurity")) {
      prefs.store();
    }
    sendRedirect(req,res);
  }
 else {
    setForward(req,"portlet.enterprise_admin.view");
  }
}
