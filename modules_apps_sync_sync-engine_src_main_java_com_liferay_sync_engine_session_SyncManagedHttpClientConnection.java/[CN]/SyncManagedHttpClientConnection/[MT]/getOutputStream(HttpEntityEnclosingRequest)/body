{
  OutputStream outputStream=prepareOutput(request);
  Header syncUUIDHeader=request.getFirstHeader("Sync-UUID");
  if ((syncUUIDHeader == null) || (syncUUIDHeader.getValue() == null)) {
    return outputStream;
  }
  SyncAccount syncAccount=SyncAccountService.fetchSyncAccount(syncUUIDHeader.getValue());
  if (syncAccount == null) {
    return outputStream;
  }
  RequestLine requestLine=request.getRequestLine();
  String uri=requestLine.getUri();
  if (uri.endsWith(ServerUtil.getURLPath(syncAccount.getSyncAccountId(),EventURLPaths.ADD_FILE_ENTRY)) || uri.endsWith(ServerUtil.getURLPath(syncAccount.getSyncAccountId(),EventURLPaths.UPDATE_FILE_ENTRIES)) || uri.endsWith(ServerUtil.getURLPath(syncAccount.getSyncAccountId(),EventURLPaths.UPDATE_FILE_ENTRY))) {
    return new RateLimitedOutputStream(outputStream,syncAccount.getSyncAccountId());
  }
  return outputStream;
}
