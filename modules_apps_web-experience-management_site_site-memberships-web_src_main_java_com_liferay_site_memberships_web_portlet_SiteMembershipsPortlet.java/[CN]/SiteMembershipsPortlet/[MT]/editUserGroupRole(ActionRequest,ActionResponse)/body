{
  User user=PortalUtil.getSelectedUser(actionRequest,false);
  if (user == null) {
    return;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long[] roleIds=ParamUtil.getLongValues(actionRequest,"rowIds");
  List<UserGroupRole> userGroupRoles=_userGroupRoleLocalService.getUserGroupRoles(user.getUserId(),themeDisplay.getSiteGroupId());
  List<Long> curRoleIds=ListUtil.toList(userGroupRoles,UsersAdmin.USER_GROUP_ROLE_ID_ACCESSOR);
  List<Long> removeRoleIds=new ArrayList<>();
  for (  long roleId : curRoleIds) {
    if (!ArrayUtil.contains(roleIds,roleId)) {
      removeRoleIds.add(roleId);
    }
  }
  _userGroupRoleService.addUserGroupRoles(user.getUserId(),themeDisplay.getSiteGroupId(),roleIds);
  _userGroupRoleService.deleteUserGroupRoles(user.getUserId(),themeDisplay.getSiteGroupId(),ArrayUtil.toLongArray(removeRoleIds));
}
