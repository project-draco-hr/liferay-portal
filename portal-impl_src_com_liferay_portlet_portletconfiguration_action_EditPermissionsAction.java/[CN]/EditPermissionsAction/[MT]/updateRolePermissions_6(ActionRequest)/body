{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String portletResource=ParamUtil.getString(actionRequest,"portletResource");
  String modelResource=ParamUtil.getString(actionRequest,"modelResource");
  String selResource=portletResource;
  if (Validator.isNotNull(modelResource)) {
    selResource=modelResource;
  }
  String resourcePrimKey=ParamUtil.getString(actionRequest,"resourcePrimKey");
  Group group=themeDisplay.getScopeGroup();
  if (modelResource.equals(Layout.class.getName())) {
    long plid=GetterUtil.getLong(resourcePrimKey);
    Layout layout=LayoutLocalServiceUtil.getLayout(plid);
    group=layout.getGroup();
  }
  List<Role> roles=ResourceActionsUtil.getRoles(group,modelResource);
  for (  Role role : roles) {
    String[] actionIds=getActionIds(actionRequest,role.getRoleId());
    ResourcePermissionServiceUtil.setIndividualResourcePermissions(themeDisplay.getScopeGroupId(),themeDisplay.getCompanyId(),selResource,resourcePrimKey,role.getRoleId(),actionIds);
  }
}
