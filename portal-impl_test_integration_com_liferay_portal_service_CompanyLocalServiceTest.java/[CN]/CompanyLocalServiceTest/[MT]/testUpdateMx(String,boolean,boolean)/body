{
  Company company=addCompany();
  String originalMx=company.getMx();
  Field field=ReflectionUtil.getDeclaredField(PropsValues.class,"MAIL_MX_UPDATE");
  Object value=field.get(null);
  try {
    if (mailMxUpdate) {
      field.set(null,Boolean.TRUE);
    }
 else {
      field.set(null,Boolean.FALSE);
    }
    CompanyLocalServiceUtil.updateCompany(company.getCompanyId(),company.getVirtualHostname(),mx,company.getMaxUsers(),company.getActive());
    company=CompanyLocalServiceUtil.getCompany(company.getCompanyId());
    String updatedMx=company.getMx();
    if (valid && mailMxUpdate) {
      Assert.assertNotEquals(originalMx,updatedMx);
    }
 else {
      Assert.assertEquals(originalMx,updatedMx);
    }
  }
 catch (  CompanyMxException cme) {
    Assert.assertFalse(valid);
    Assert.assertTrue(mailMxUpdate);
  }
 finally {
    CompanyLocalServiceUtil.deleteCompany(company.getCompanyId());
    field.set(null,value);
  }
}
