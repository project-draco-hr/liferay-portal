{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long groupId=themeDisplay.getSiteGroupId();
  long[] addUserIds=StringUtil.split(ParamUtil.getString(actionRequest,"addUserIds"),0L);
  addUserIds=filterAddUserIds(groupId,addUserIds);
  long[] removeUserIds=StringUtil.split(ParamUtil.getString(actionRequest,"removeUserIds"),0L);
  removeUserIds=filterRemoveUserIds(groupId,removeUserIds);
  ServiceContext serviceContext=ServiceContextFactory.getInstance(actionRequest);
  _userService.addGroupUsers(groupId,addUserIds,serviceContext);
  _userService.unsetGroupUsers(groupId,removeUserIds,serviceContext);
  LiveUsers.joinGroup(themeDisplay.getCompanyId(),groupId,addUserIds);
  LiveUsers.leaveGroup(themeDisplay.getCompanyId(),groupId,removeUserIds);
  String redirect=ParamUtil.getString(actionRequest,"assignmentsRedirect");
  if (Validator.isNotNull(redirect)) {
    actionRequest.setAttribute(WebKeys.REDIRECT,redirect);
  }
}
