{
  List<TemplateNode> nodes=new ArrayList<TemplateNode>();
  Map<String,TemplateNode> prototypeNodes=new HashMap<String,TemplateNode>();
  for (  Element el : parent.elements("dynamic-element")) {
    Element content=el.element("dynamic-content");
    String data=StringPool.BLANK;
    if (content != null) {
      data=content.getText();
    }
    String name=el.attributeValue("name","");
    if (name.length() == 0) {
      throw new TransformException("Element missing \"name\" attribute");
    }
    String type=el.attributeValue("type","");
    data=StringUtil.stripBetween(data,StringPool.CDATA_OPEN,StringPool.CDATA_CLOSE);
    TemplateNode node=new TemplateNode(themeDisplay,name,data,type);
    if (el.element("dynamic-element") != null) {
      node.appendChildren(extractDynamicContents(themeDisplay,el));
    }
 else     if ((content != null) && (content.element("option") != null)) {
      for (      Element option : content.elements("option")) {
        String value=StringUtil.stripBetween(option.getText(),StringPool.CDATA_OPEN,StringPool.CDATA_CLOSE);
        node.appendOption(value);
      }
    }
    TemplateNode prototypeNode=prototypeNodes.get(name);
    if (prototypeNode == null) {
      prototypeNode=node;
      prototypeNodes.put(name,prototypeNode);
      nodes.add(node);
    }
    prototypeNode.appendSibling(node);
  }
  return nodes;
}
