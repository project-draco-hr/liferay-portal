{
  BundleWiring bundleWiring=_bundle.adapt(BundleWiring.class);
  Collection<String> resources=bundleWiring.listResources("META-INF/","*.tld",BundleWiring.LISTRESOURCES_RECURSE);
  if (resources == null) {
    return;
  }
  for (  String resource : resources) {
    URL url=_bundle.getResource(resource);
    if (url == null) {
      continue;
    }
    try (InputStream inputStream=url.openStream()){
      ParserUtils parserUtils=new ParserUtils(true);
      TreeNode treeNode=parserUtils.parseXMLDocument(url.getPath(),inputStream,false);
      Iterator<TreeNode> iterator=treeNode.findChildren("listener");
      while (iterator.hasNext()) {
        TreeNode listenerTreeNode=iterator.next();
        TreeNode listenerClassTreeNode=listenerTreeNode.findChild("listener-class");
        if (listenerClassTreeNode == null) {
          continue;
        }
        String listenerClassName=listenerClassTreeNode.getBody();
        if (listenerClassName == null) {
          continue;
        }
        addListener(listenerClassName,_bundle.getBundleContext(),servletContext);
      }
    }
 catch (    Exception e) {
      log(e.getMessage(),e);
    }
  }
}
