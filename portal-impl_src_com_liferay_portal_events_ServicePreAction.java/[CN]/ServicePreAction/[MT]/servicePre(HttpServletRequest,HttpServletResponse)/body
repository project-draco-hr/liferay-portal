{
  ThemeDisplay themeDisplay=initThemeDisplay(request,response);
  if (themeDisplay == null) {
    return;
  }
  request.setAttribute(WebKeys.THEME_DISPLAY,themeDisplay);
  ServiceContext serviceContext=ServiceContextFactory.getInstance(request);
  ServiceContextThreadLocal.pushServiceContext(serviceContext);
  if (PropsValues.LAYOUT_AJAX_RENDER_ENABLE) {
    boolean portletAjaxRender=ParamUtil.getBoolean(request,"p_p_ajax",true);
    request.setAttribute(WebKeys.PORTLET_AJAX_RENDER,portletAjaxRender);
  }
  if (PropsValues.LAYOUT_PARALLEL_RENDER_ENABLE) {
    boolean portletParallelRender=ParamUtil.getBoolean(request,"p_p_parallel",true);
    request.setAttribute(WebKeys.PORTLET_PARALLEL_RENDER,portletParallelRender);
  }
  long mainJournalArticleId=ParamUtil.getLong(request,"p_j_a_id");
  if (mainJournalArticleId > 0) {
    try {
      JournalArticle mainJournalArticle=JournalArticleServiceUtil.getArticle(mainJournalArticleId);
      AssetEntry layoutAssetEntry=AssetEntryLocalServiceUtil.getEntry(JournalArticle.class.getName(),mainJournalArticle.getResourcePrimKey());
      request.setAttribute(WebKeys.LAYOUT_ASSET_ENTRY,layoutAssetEntry);
    }
 catch (    NoSuchArticleException nsae) {
      if (_log.isWarnEnabled()) {
        _log.warn(nsae.getMessage());
      }
    }
  }
}
