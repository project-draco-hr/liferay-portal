{
  try {
    User user=PortalUtil.getUser(request);
    if (user != null) {
      return user;
    }
  }
 catch (  NoSuchUserException nsue) {
    if (_log.isWarnEnabled()) {
      _log.warn(nsue.getMessage());
    }
    long userId=PortalUtil.getUserId(request);
    if (userId > 0) {
      HttpSession session=request.getSession();
      session.invalidate();
    }
    throw nsue;
  }
  Company company=PortalUtil.getCompany(request);
  return company.getDefaultUser();
}
