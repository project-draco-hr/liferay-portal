{
  Object[] defaultLayout=getDefaultVirtualLayout(request);
  Layout layout=(Layout)defaultLayout[0];
  List<Layout> layouts=(List<Layout>)defaultLayout[1];
  defaultLayout=getViewableLayouts(request,user,permissionChecker,layout,layouts,doAsGroupId,controlPanelCategory);
  if (defaultLayout[1] != null) {
    return defaultLayout;
  }
  if (signedIn) {
    defaultLayout=getDefaultUserPersonalLayout(user);
    if (defaultLayout[0] == null) {
      defaultLayout=getDefaultUserSiteLayout(user);
    }
    layout=(Layout)defaultLayout[0];
    layouts=(List<Layout>)defaultLayout[1];
    defaultLayout=getViewableLayouts(request,user,permissionChecker,layout,layouts,doAsGroupId,controlPanelCategory);
    if (defaultLayout[1] != null) {
      return defaultLayout;
    }
  }
  defaultLayout=getDefaultSiteLayout(user);
  layout=(Layout)defaultLayout[0];
  layouts=(List<Layout>)defaultLayout[1];
  return getViewableLayouts(request,user,permissionChecker,layout,layouts,doAsGroupId,controlPanelCategory);
}
