{
  Layout layout=null;
  List<Layout> layouts=null;
  LayoutSet layoutSet=(LayoutSet)request.getAttribute(WebKeys.VIRTUAL_HOST_LAYOUT_SET);
  if (layoutSet != null) {
    layouts=LayoutLocalServiceUtil.getLayouts(layoutSet.getGroupId(),layoutSet.isPrivateLayout(),LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
    Group group=null;
    if (!layouts.isEmpty()) {
      layout=layouts.get(0);
      group=layout.getGroup();
    }
    if ((layout != null) && layout.isPrivateLayout()) {
      layouts=LayoutLocalServiceUtil.getLayouts(group.getGroupId(),false,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
      if (!layouts.isEmpty()) {
        layout=layouts.get(0);
      }
 else {
        group=null;
        layout=null;
      }
    }
    if ((group != null) && group.isStagingGroup()) {
      Group liveGroup=group.getLiveGroup();
      layouts=LayoutLocalServiceUtil.getLayouts(liveGroup.getGroupId(),false,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
      if (!layouts.isEmpty()) {
        layout=layouts.get(0);
      }
 else {
        layout=null;
      }
    }
  }
  return new LayoutComposite(layout,layouts);
}
