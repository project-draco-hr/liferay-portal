{
  if (layout.isTypeControlPanel()) {
    if (!permissionChecker.isSignedIn()) {
      return false;
    }
    if (controlPanelCategory.equals(PortletCategoryKeys.CURRENT_SITE)) {
      if (doAsGroupId <= 0) {
        return false;
      }
      Group group=GroupLocalServiceUtil.getGroup(doAsGroupId);
      if (group.isLayout()) {
        group=group.getParentGroup();
      }
      if (GroupPermissionUtil.contains(permissionChecker,group.getGroupId(),ActionKeys.VIEW_SITE_ADMINISTRATION)) {
        return true;
      }
    }
 else     if (controlPanelCategory.equals(PortletCategoryKeys.MY) || controlPanelCategory.equals(PortletCategoryKeys.PORTLET)) {
      return true;
    }
    return PortalPermissionUtil.contains(permissionChecker,ActionKeys.VIEW_CONTROL_PANEL);
  }
  return LayoutPermissionUtil.contains(permissionChecker,layout,controlPanelCategory,checkViewableGroup,ActionKeys.VIEW);
}
