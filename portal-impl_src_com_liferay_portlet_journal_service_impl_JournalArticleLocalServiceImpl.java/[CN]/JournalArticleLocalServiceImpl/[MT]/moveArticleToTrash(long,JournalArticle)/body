{
  int oldStatus=article.getStatus();
  if (oldStatus == WorkflowConstants.STATUS_PENDING) {
    article.setStatus(WorkflowConstants.STATUS_DRAFT);
    journalArticlePersistence.update(article);
  }
  List<JournalArticle> articleVersions=journalArticlePersistence.findByG_A(article.getGroupId(),article.getArticleId());
  articleVersions=ListUtil.sort(articleVersions,new ArticleVersionComparator());
  Map<String,Serializable> workflowContext=new HashMap<String,Serializable>();
  workflowContext.put("articleVersions",(Serializable)articleVersions);
  article=updateStatus(userId,article.getId(),WorkflowConstants.STATUS_IN_TRASH,workflowContext,new ServiceContext());
  Indexer indexer=IndexerRegistryUtil.nullSafeGetIndexer(JournalArticle.class);
  indexer.delete(article);
  TrashEntry trashEntry=trashEntryLocalService.getEntry(JournalArticle.class.getName(),article.getResourcePrimKey());
  String trashArticleId=TrashUtil.getTrashTitle(trashEntry.getEntryId());
  if (!articleVersions.isEmpty()) {
    for (    JournalArticle curArticleVersion : articleVersions) {
      curArticleVersion.setArticleId(trashArticleId);
      journalArticlePersistence.update(curArticleVersion);
    }
  }
  JournalArticleResource articleResource=journalArticleResourcePersistence.fetchByPrimaryKey(article.getResourcePrimKey());
  articleResource.setArticleId(trashArticleId);
  journalArticleResourcePersistence.update(articleResource);
  article.setArticleId(trashArticleId);
  reindex(article);
  article=journalArticlePersistence.update(article);
  socialActivityCounterLocalService.disableActivityCounters(JournalFolder.class.getName(),article.getFolderId());
  socialActivityLocalService.addActivity(userId,article.getGroupId(),JournalArticle.class.getName(),article.getResourcePrimKey(),SocialActivityConstants.TYPE_MOVE_TO_TRASH,StringPool.BLANK,0);
  if (oldStatus == WorkflowConstants.STATUS_PENDING) {
    workflowInstanceLinkLocalService.deleteWorkflowInstanceLink(article.getCompanyId(),article.getGroupId(),JournalArticle.class.getName(),article.getId());
  }
  return article;
}
