{
  User user=userPersistence.findByPrimaryKey(userId);
  oldArticleId=oldArticleId.trim().toUpperCase();
  newArticleId=newArticleId.trim().toUpperCase();
  Date now=new Date();
  JournalArticle oldArticle=journalArticlePersistence.findByG_A_V(groupId,oldArticleId,version);
  if (autoArticleId) {
    newArticleId=String.valueOf(counterLocalService.increment());
  }
 else {
    validate(newArticleId);
    JournalArticle newArticle=journalArticlePersistence.fetchByG_A_V(groupId,newArticleId,version);
    if (newArticle != null) {
      throw new DuplicateArticleIdException();
    }
  }
  long id=counterLocalService.increment();
  long resourcePrimKey=journalArticleResourceLocalService.getArticleResourcePrimKey(groupId,newArticleId);
  JournalArticle newArticle=journalArticlePersistence.create(id);
  newArticle.setResourcePrimKey(resourcePrimKey);
  newArticle.setGroupId(groupId);
  newArticle.setCompanyId(user.getCompanyId());
  newArticle.setUserId(user.getUserId());
  newArticle.setUserName(user.getFullName());
  newArticle.setCreateDate(now);
  newArticle.setModifiedDate(now);
  newArticle.setArticleId(newArticleId);
  newArticle.setVersion(JournalArticleConstants.VERSION_DEFAULT);
  newArticle.setTitle(oldArticle.getTitle());
  newArticle.setDescription(oldArticle.getDescription());
  try {
    copyArticleImages(oldArticle,newArticle);
  }
 catch (  Exception e) {
    newArticle.setContent(oldArticle.getContent());
  }
  newArticle.setType(oldArticle.getType());
  newArticle.setStructureId(oldArticle.getStructureId());
  newArticle.setTemplateId(oldArticle.getTemplateId());
  newArticle.setLayoutUuid(oldArticle.getLayoutUuid());
  newArticle.setDisplayDate(oldArticle.getDisplayDate());
  newArticle.setExpirationDate(oldArticle.getExpirationDate());
  newArticle.setReviewDate(oldArticle.getReviewDate());
  newArticle.setIndexable(oldArticle.isIndexable());
  newArticle.setSmallImage(oldArticle.isSmallImage());
  newArticle.setSmallImageId(counterLocalService.increment());
  newArticle.setSmallImageURL(oldArticle.getSmallImageURL());
  newArticle.setStatus(oldArticle.getStatus());
  journalArticlePersistence.update(newArticle,false);
  addArticleResources(newArticle,true,true);
  if (oldArticle.getSmallImage()) {
    Image image=imageLocalService.getImage(oldArticle.getSmallImageId());
    byte[] smallImageBytes=image.getTextObj();
    imageLocalService.updateImage(newArticle.getSmallImageId(),smallImageBytes);
  }
  String[] assetTagNames=assetTagLocalService.getTagNames(JournalArticle.class.getName(),oldArticle.getResourcePrimKey());
  updateAsset(userId,newArticle,null,assetTagNames,null);
  return newArticle;
}
