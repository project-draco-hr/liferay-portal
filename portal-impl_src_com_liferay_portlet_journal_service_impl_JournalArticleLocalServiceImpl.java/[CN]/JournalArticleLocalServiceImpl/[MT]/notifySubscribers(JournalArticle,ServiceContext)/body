{
  if (!article.isApproved()) {
    return;
  }
  String articleURL=PortalUtil.getControlPanelFullURL(serviceContext.getScopeGroupId(),PortletKeys.JOURNAL,null);
  if (Validator.isNull(articleURL)) {
    return;
  }
  PortletPreferences preferences=ServiceContextUtil.getPortletPreferences(serviceContext);
  if (preferences == null) {
    long ownerId=article.getGroupId();
    int ownerType=PortletKeys.PREFS_OWNER_TYPE_GROUP;
    long plid=PortletKeys.PREFS_PLID_SHARED;
    String portletId=PortletKeys.JOURNAL;
    String defaultPreferences=null;
    preferences=portletPreferencesLocalService.getPreferences(article.getCompanyId(),ownerId,ownerType,plid,portletId,defaultPreferences);
  }
  if ((article.getVersion() == 1.0) && JournalUtil.getEmailArticleAddedEnabled(preferences)) {
  }
 else   if (article.getVersion() != 1.0 && JournalUtil.getEmailArticleUpdatedEnabled(preferences)) {
  }
 else {
    return;
  }
  Company company=companyPersistence.findByPrimaryKey(article.getCompanyId());
  Group group=groupPersistence.findByPrimaryKey(serviceContext.getScopeGroupId());
  String emailAddress=StringPool.BLANK;
  String fullName=article.getUserName();
  try {
    User user=userPersistence.findByPrimaryKey(article.getUserId());
    emailAddress=user.getEmailAddress();
    fullName=user.getFullName();
  }
 catch (  NoSuchUserException nsue) {
  }
  String portletName=PortalUtil.getPortletTitle(PortletKeys.JOURNAL,LocaleUtil.getDefault());
  String fromName=JournalUtil.getEmailFromName(preferences);
  String fromAddress=JournalUtil.getEmailFromAddress(preferences);
  fromName=StringUtil.replace(fromName,new String[]{"[$ARTICLE_ID$]","[$ARTICLE_TITLE$]","[$ARTICLE_USER_ADDRESS$]","[$ARTICLE_USER_NAME$]","[$ARTICLE_VERSION$]","[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$PORTLET_NAME$]"},new String[]{article.getArticleId(),article.getTitle(),emailAddress,fullName,String.valueOf(article.getVersion()),fromAddress,fromName,company.getVirtualHost(),portletName});
  fromAddress=StringUtil.replace(fromAddress,new String[]{"[$ARTICLE_ID$]","[$ARTICLE_TITLE$]","[$ARTICLE_USER_ADDRESS$]","[$ARTICLE_USER_NAME$]","[$ARTICLE_VERSION$]","[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$PORTLET_NAME$]"},new String[]{article.getArticleId(),article.getTitle(),emailAddress,fullName,String.valueOf(article.getVersion()),fromAddress,fromName,company.getVirtualHost(),portletName});
  String subject=null;
  String body=null;
  if (article.getVersion() == 1.0) {
    subject=JournalUtil.getEmailArticleAddedSubject(preferences);
    body=JournalUtil.getEmailArticleAddedBody(preferences);
  }
 else {
    subject=JournalUtil.getEmailArticleUpdatedSubject(preferences);
    body=JournalUtil.getEmailArticleUpdatedBody(preferences);
  }
  subject=StringUtil.replace(subject,new String[]{"[$ARTICLE_ID$]","[$ARTICLE_TITLE$]","[$ARTICLE_URL$]","[$ARTICLE_USER_ADDRESS$]","[$ARTICLE_USER_NAME$]","[$ARTICLE_VERSION$]","[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$PORTLET_NAME$]"},new String[]{article.getArticleId(),article.getTitle(),articleURL,emailAddress,fullName,String.valueOf(article.getVersion()),fromAddress,fromName,company.getVirtualHost(),portletName});
  body=StringUtil.replace(body,new String[]{"[$ARTICLE_ID$]","[$ARTICLE_TITLE$]","[$ARTICLE_URL$]","[$ARTICLE_USER_ADDRESS$]","[$ARTICLE_USER_NAME$]","[$ARTICLE_VERSION$]","[$FROM_ADDRESS$]","[$FROM_NAME$]","[$PORTAL_URL$]","[$PORTLET_NAME$]"},new String[]{article.getArticleId(),article.getTitle(),articleURL,emailAddress,fullName,String.valueOf(article.getVersion()),fromAddress,fromName,company.getVirtualHost(),portletName});
  Message message=new Message();
  message.put("companyId",article.getCompanyId());
  message.put("userId",article.getUserId());
  message.put("groupId",article.getGroupId());
  message.put("articleId",article.getArticleId());
  message.put("fromName",fromName);
  message.put("fromAddress",fromAddress);
  message.put("subject",subject);
  message.put("body",body);
  message.put("replyToAddress",fromAddress);
  message.put("mailId",JournalUtil.getMailId(company.getMx(),GetterUtil.getLong(article.getArticleId())));
  message.put("htmlFormat",Boolean.TRUE);
  MessageBusUtil.sendMessage(DestinationNames.JOURNALS,message);
}
