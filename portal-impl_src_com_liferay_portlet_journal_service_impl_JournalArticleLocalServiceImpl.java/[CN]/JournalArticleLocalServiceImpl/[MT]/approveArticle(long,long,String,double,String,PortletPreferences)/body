{
  User user=userPersistence.findByPrimaryKey(userId);
  Date now=new Date();
  JournalArticle article=journalArticlePersistence.findByG_A_V(groupId,articleId,version);
  article.setModifiedDate(now);
  article.setApproved(true);
  article.setApprovedByUserId(user.getUserId());
  article.setApprovedByUserName(user.getFullName());
  article.setApprovedDate(now);
  if (article.isExpired()) {
    article.setExpired(false);
    article.setExpirationDate(null);
  }
  journalArticlePersistence.update(article);
  List<JournalArticle> articles=journalArticlePersistence.findByG_A_A(groupId,articleId,true);
  for (  JournalArticle curArticle : articles) {
    if (curArticle.getVersion() != article.getVersion()) {
      curArticle.setApproved(false);
      curArticle.setExpired(true);
      curArticle.setExpirationDate(new Date());
      journalArticlePersistence.update(curArticle);
    }
  }
  sendEmail(article,articleURL,prefs,"granted");
  try {
    if (article.isIndexable()) {
      String[] tagsEntries=tagsEntryLocalService.getEntryNames(JournalArticle.class.getName(),article.getResourcePrimKey());
      Indexer.updateArticle(article.getCompanyId(),article.getGroupId(),article.getArticleId(),article.getVersion(),article.getTitle(),article.getDescription(),article.getContent(),article.getType(),article.getDisplayDate(),tagsEntries);
    }
  }
 catch (  IOException ioe) {
    _log.error("Indexing " + article.getId(),ioe);
  }
  return article;
}
