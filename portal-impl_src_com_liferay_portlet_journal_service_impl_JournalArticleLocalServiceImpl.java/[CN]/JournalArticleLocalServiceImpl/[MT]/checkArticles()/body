{
  Date now=new Date();
  List articles=JournalArticleUtil.findAll();
  for (int i=0; i < articles.size(); i++) {
    JournalArticle article=(JournalArticle)articles.get(i);
    Date expirationDate=article.getExpirationDate();
    Date reviewDate=article.getReviewDate();
    if (!article.isExpired() && (expirationDate != null) && expirationDate.before(now)) {
      article.setApproved(false);
      article.setExpired(true);
      JournalArticleUtil.update(article);
    }
 else     if (reviewDate != null) {
      long diff=reviewDate.getTime() - now.getTime();
      if ((diff > 0) && (diff < (Time.MINUTE * 15))) {
        String articleURL=StringPool.BLANK;
        long ownerId=article.getGroupId();
        int ownerType=PortletKeys.PREFS_OWNER_TYPE_GROUP;
        long plid=PortletKeys.PREFS_PLID_SHARED;
        String portletId=PortletKeys.JOURNAL;
        PortletPreferences prefs=PortletPreferencesLocalServiceUtil.getPreferences(article.getCompanyId(),ownerId,ownerType,plid,portletId);
        sendEmail(article,articleURL,prefs,"review");
      }
    }
  }
}
