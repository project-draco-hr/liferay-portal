{
  Date now=new Date();
  List articles=journalArticleFinder.findByExpirationDate(Boolean.FALSE,now,new Date(now.getTime() - CheckArticleJob.INTERVAL));
  if (_log.isDebugEnabled()) {
    _log.debug("Expiring " + articles.size() + " articles");
  }
  Set companies=new HashSet();
  for (int i=0; i < articles.size(); i++) {
    JournalArticle article=(JournalArticle)articles.get(i);
    article.setApproved(false);
    article.setExpired(true);
    JournalArticleUtil.update(article);
    try {
      if (article.isIndexable()) {
        Indexer.deleteArticle(article.getCompanyId(),article.getArticleId());
      }
    }
 catch (    IOException ioe) {
      _log.error("Removing index " + article.getId(),ioe);
    }
    JournalContentUtil.clearCache(article.getGroupId(),article.getArticleId(),article.getTemplateId());
    companies.add(new Long(article.getCompanyId()));
  }
  Iterator itr=companies.iterator();
  while (itr.hasNext()) {
    long companyId=((Long)itr.next()).longValue();
    LayoutCacheUtil.clearCache(companyId);
  }
  articles=journalArticleFinder.findByReviewDate(now,new Date(now.getTime() - CheckArticleJob.INTERVAL));
  if (_log.isDebugEnabled()) {
    _log.debug("Sending review notifications for " + articles.size() + " articles");
  }
  for (int i=0; i < articles.size(); i++) {
    JournalArticle article=(JournalArticle)articles.get(i);
    Date reviewDate=article.getReviewDate();
    if (reviewDate != null) {
      long diff=reviewDate.getTime() - now.getTime();
      if ((diff > 0) && (diff < CheckArticleJob.INTERVAL)) {
        String articleURL=StringPool.BLANK;
        long ownerId=article.getGroupId();
        int ownerType=PortletKeys.PREFS_OWNER_TYPE_GROUP;
        long plid=PortletKeys.PREFS_PLID_SHARED;
        String portletId=PortletKeys.JOURNAL;
        PortletPreferences prefs=PortletPreferencesLocalServiceUtil.getPreferences(article.getCompanyId(),ownerId,ownerType,plid,portletId);
        sendEmail(article,articleURL,prefs,"review");
      }
    }
  }
}
