{
  if (preferences == null) {
    return;
  }
 else   if (emailType.equals("denied") && JournalUtil.getEmailArticleApprovalDeniedEnabled(preferences)) {
  }
 else   if (emailType.equals("granted") && JournalUtil.getEmailArticleApprovalGrantedEnabled(preferences)) {
  }
 else   if (emailType.equals("requested") && JournalUtil.getEmailArticleApprovalRequestedEnabled(preferences)) {
  }
 else   if (emailType.equals("review") && JournalUtil.getEmailArticleReviewEnabled(preferences)) {
  }
 else {
    return;
  }
  Company company=companyPersistence.findByPrimaryKey(article.getCompanyId());
  User user=userPersistence.findByPrimaryKey(article.getUserId());
  String fromName=JournalUtil.getEmailFromName(preferences,article.getCompanyId());
  String fromAddress=JournalUtil.getEmailFromAddress(preferences,article.getCompanyId());
  String toName=user.getFullName();
  String toAddress=user.getEmailAddress();
  if (emailType.equals("requested")) {
    String tempToName=fromName;
    String tempToAddress=fromAddress;
    fromName=toName;
    fromAddress=toAddress;
    toName=tempToName;
    toAddress=tempToAddress;
  }
  Map<Locale,String> localizedSubjectMap=null;
  Map<Locale,String> localizedBodyMap=null;
  if (emailType.equals("denied")) {
    localizedSubjectMap=JournalUtil.getEmailArticleApprovalDeniedSubjectMap(preferences);
    localizedBodyMap=JournalUtil.getEmailArticleApprovalDeniedBodyMap(preferences);
  }
 else   if (emailType.equals("granted")) {
    localizedSubjectMap=JournalUtil.getEmailArticleApprovalGrantedSubjectMap(preferences);
    localizedBodyMap=JournalUtil.getEmailArticleApprovalGrantedBodyMap(preferences);
  }
 else   if (emailType.equals("requested")) {
    localizedSubjectMap=JournalUtil.getEmailArticleApprovalRequestedSubjectMap(preferences);
    localizedBodyMap=JournalUtil.getEmailArticleApprovalRequestedBodyMap(preferences);
  }
 else   if (emailType.equals("review")) {
    localizedSubjectMap=JournalUtil.getEmailArticleReviewSubjectMap(preferences);
    localizedBodyMap=JournalUtil.getEmailArticleReviewBodyMap(preferences);
  }
  SubscriptionSender subscriptionSender=new SubscriptionSender();
  subscriptionSender.setCompanyId(company.getCompanyId());
  subscriptionSender.setContextAttributes("[$ARTICLE_ID$]",article.getArticleId(),"[$ARTICLE_TITLE$]",article.getTitle(serviceContext.getLanguageId()),"[$ARTICLE_URL$]",articleURL,"[$ARTICLE_USER_NAME$]",article.getUserName(),"[$ARTICLE_VERSION$]",article.getVersion());
  subscriptionSender.setContextCreatorUserPrefix("ARTICLE");
  subscriptionSender.setCreatorUserId(article.getUserId());
  subscriptionSender.setFrom(fromAddress,fromName);
  subscriptionSender.setHtmlFormat(true);
  subscriptionSender.setLocalizedBodyMap(localizedBodyMap);
  subscriptionSender.setLocalizedSubjectMap(localizedSubjectMap);
  subscriptionSender.setMailId("journal_article",article.getId());
  String portletId=PortletProviderUtil.getPortletId(JournalArticle.class.getName(),PortletProvider.Action.EDIT);
  subscriptionSender.setPortletId(portletId);
  subscriptionSender.setScopeGroupId(article.getGroupId());
  subscriptionSender.setServiceContext(serviceContext);
  subscriptionSender.addRuntimeSubscribers(toAddress,toName);
  subscriptionSender.flushNotificationsAsync();
}
