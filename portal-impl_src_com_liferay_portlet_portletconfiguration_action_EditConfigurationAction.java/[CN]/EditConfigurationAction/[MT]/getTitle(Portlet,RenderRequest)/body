{
  ServletContext servletContext=(ServletContext)req.getAttribute(WebKeys.CTX);
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getPortletSetup(req,portlet.getPortletId());
  String title=PortletConfigurationUtil.getPortletTitle(portletSetup,themeDisplay.getLanguageId());
  if (Validator.isNull(title)) {
    title=PortalUtil.getPortletTitle(portlet,servletContext,themeDisplay.getLocale());
  }
  return title;
}
