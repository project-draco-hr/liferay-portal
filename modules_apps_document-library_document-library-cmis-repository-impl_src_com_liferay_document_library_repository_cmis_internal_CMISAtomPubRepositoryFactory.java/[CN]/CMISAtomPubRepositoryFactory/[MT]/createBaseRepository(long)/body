{
  BaseRepository baseRepository=new CMISAtomPubRepository();
  CMISRepositoryHandler cmisRepositoryHandler=null;
  if (baseRepository instanceof CMISRepositoryHandler) {
    cmisRepositoryHandler=(CMISRepositoryHandler)baseRepository;
  }
 else   if (baseRepository instanceof BaseRepositoryProxyBean) {
    BaseRepositoryProxyBean baseRepositoryProxyBean=(BaseRepositoryProxyBean)baseRepository;
    ClassLoaderBeanHandler classLoaderBeanHandler=(ClassLoaderBeanHandler)ProxyUtil.getInvocationHandler(baseRepositoryProxyBean.getProxyBean());
    Object bean=classLoaderBeanHandler.getBean();
    if (bean instanceof CMISRepositoryHandler) {
      cmisRepositoryHandler=(CMISRepositoryHandler)bean;
    }
  }
  com.liferay.portal.model.Repository repository=_repositoryLocalService.getRepository(repositoryId);
  if (cmisRepositoryHandler != null) {
    CMISRepository cmisRepository=new CMISRepository(cmisRepositoryHandler,_cmisSearchQueryBuilder);
    cmisRepositoryHandler.setCmisRepository(cmisRepository);
    setupRepository(repositoryId,repository,cmisRepository);
  }
  setupRepository(repositoryId,repository,baseRepository);
  if (!ExportImportThreadLocal.isImportInProcess()) {
    baseRepository.initRepository();
  }
  return baseRepository;
}
