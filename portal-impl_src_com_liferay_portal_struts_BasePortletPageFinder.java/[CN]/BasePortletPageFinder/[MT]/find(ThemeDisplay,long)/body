{
  String[] portletIds=getPortletIds();
  if ((themeDisplay.getPlid() != LayoutConstants.DEFAULT_PLID) && (groupId == themeDisplay.getScopeGroupId())) {
    try {
      Layout layout=LayoutLocalServiceUtil.getLayout(themeDisplay.getPlid());
      LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
      for (      String portletId : portletIds) {
        if (!layoutTypePortlet.hasPortletId(portletId,false) || !LayoutPermissionUtil.contains(themeDisplay.getPermissionChecker(),layout,ActionKeys.VIEW)) {
          continue;
        }
        portletId=getPortletId(layoutTypePortlet,portletId);
        return new ResultImpl(themeDisplay.getPlid(),portletId);
      }
    }
 catch (    NoSuchLayoutException nsle) {
    }
  }
  Object[] plidAndPortletId=fetchPlidAndPortletId(themeDisplay.getPermissionChecker(),groupId,portletIds);
  if ((plidAndPortletId == null) && SitesUtil.isUserGroupLayoutSetViewable(themeDisplay.getPermissionChecker(),themeDisplay.getScopeGroup())) {
    plidAndPortletId=fetchPlidAndPortletId(themeDisplay.getPermissionChecker(),themeDisplay.getScopeGroupId(),portletIds);
  }
  if (plidAndPortletId != null) {
    return new ResultImpl((long)plidAndPortletId[0],(String)plidAndPortletId[1]);
  }
  StringBundler sb=new StringBundler(portletIds.length * 2 + 5);
  sb.append("{groupId=");
  sb.append(groupId);
  sb.append(", plid=");
  sb.append(themeDisplay.getPlid());
  for (  String portletId : portletIds) {
    sb.append(", portletId=");
    sb.append(portletId);
  }
  sb.append("}");
  throw new NoSuchLayoutException(sb.toString());
}
