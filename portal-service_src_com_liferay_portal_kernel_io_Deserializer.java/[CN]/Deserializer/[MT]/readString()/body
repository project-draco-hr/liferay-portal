{
  detectBufferUnderflow(5);
  boolean asciiCode=BigEndianCodec.getBoolean(buffer,index++);
  int length=BigEndianCodec.getInt(buffer,index);
  index+=4;
  if (asciiCode) {
    detectBufferUnderflow(length);
    char[] chars=CharBufferPool.borrow(length);
    for (int i=0; i < length; i++) {
      chars[i]=(char)buffer[index++];
    }
    return new String(chars,0,length);
  }
 else {
    detectBufferUnderflow(length * 2);
    char[] chars=CharBufferPool.borrow(length);
    for (int i=0; i < length; i++) {
      chars[i]=BigEndianCodec.getChar(buffer,index);
      index+=2;
    }
    return new String(chars,0,length);
  }
}
