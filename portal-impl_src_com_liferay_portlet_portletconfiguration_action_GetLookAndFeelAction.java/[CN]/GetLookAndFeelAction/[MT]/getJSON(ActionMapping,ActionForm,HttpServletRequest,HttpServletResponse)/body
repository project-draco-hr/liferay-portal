{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  String portletId=ParamUtil.getString(request,"portletId");
  if (!PortletPermissionUtil.contains(permissionChecker,layout,portletId,ActionKeys.CONFIGURATION)) {
    return null;
  }
  PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getStrictLayoutPortletSetup(layout,portletId);
  JSONObject portletSetupJSONObject=PortletSetupUtil.cssToJSONObject(portletSetup);
  String rootPortletId=PortletConstants.getRootPortletId(portletId);
  JSONObject defaultPortletTitlesJSONObject=JSONFactoryUtil.createJSONObject();
  Locale[] availableLocales=LanguageUtil.getAvailableLocales(themeDisplay.getSiteGroupId());
  for (  Locale locale : availableLocales) {
    String languageId=LocaleUtil.toLanguageId(locale);
    defaultPortletTitlesJSONObject.put(languageId,PortalUtil.getPortletTitle(rootPortletId,languageId));
  }
  portletSetupJSONObject.put("defaultPortletTitles",defaultPortletTitlesJSONObject);
  return portletSetupJSONObject.toString();
}
