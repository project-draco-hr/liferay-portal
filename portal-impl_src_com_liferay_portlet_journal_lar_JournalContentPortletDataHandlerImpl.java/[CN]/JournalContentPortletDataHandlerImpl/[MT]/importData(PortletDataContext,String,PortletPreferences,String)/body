{
  try {
    if (Validator.isNull(data)) {
      return null;
    }
    Document doc=DocumentUtil.readDocumentFromXML(data);
    Element root=doc.getRootElement();
    Element structureEl=root.element("structure");
    Map<String,String> structureIds=context.getNewPrimaryKeysMap(JournalStructure.class);
    if (structureEl != null) {
      JournalPortletDataHandlerImpl.importStructure(context,structureIds,structureEl);
    }
    Element templateEl=root.element("template");
    Map<String,String> templateIds=context.getNewPrimaryKeysMap(JournalTemplate.class);
    if (templateEl != null) {
      JournalPortletDataHandlerImpl.importTemplate(context,structureIds,templateIds,templateEl);
    }
    Element articleEl=root.element("article");
    Map<String,String> articleIds=context.getNewPrimaryKeysMap(JournalArticle.class);
    if (articleEl != null) {
      JournalPortletDataHandlerImpl.importArticle(context,structureIds,templateIds,articleIds,articleEl);
    }
    String articleId=prefs.getValue("article-id",StringPool.BLANK);
    if (Validator.isNotNull(articleId)) {
      articleId=MapUtil.getString(articleIds,articleId,articleId);
      prefs.setValue("group-id",String.valueOf(context.getGroupId()));
      prefs.setValue("article-id",articleId);
    }
    List<Element> dlFolderEls=root.element("dl-folders").elements("folder");
    Map<Long,Long> dlFolderPKs=context.getNewPrimaryKeysMap(DLFolder.class);
    for (    Element folderEl : dlFolderEls) {
      String path=folderEl.attributeValue("path");
      if (context.isPathNotProcessed(path)) {
        DLFolder folder=(DLFolder)context.getZipEntryAsObject(path);
        DLPortletDataHandlerImpl.importFolder(context,dlFolderPKs,folder);
      }
    }
    List<Element> fileEntryEls=root.element("dl-file-entries").elements("file-entry");
    Map<String,String> fileEntryNames=context.getNewPrimaryKeysMap(DLFileEntry.class);
    for (    Element fileEntryEl : fileEntryEls) {
      String path=fileEntryEl.attributeValue("path");
      String binPath=fileEntryEl.attributeValue("bin-path");
      if (context.isPathNotProcessed(path)) {
        DLFileEntry fileEntry=(DLFileEntry)context.getZipEntryAsObject(path);
        DLPortletDataHandlerImpl.importFileEntry(context,dlFolderPKs,fileEntryNames,fileEntry,binPath);
      }
    }
    List<Element> fileRankEls=root.element("dl-file-ranks").elements("file-rank");
    for (    Element fileRankEl : fileRankEls) {
      String path=fileRankEl.attributeValue("path");
      if (context.isPathNotProcessed(path)) {
        DLFileRank fileRank=(DLFileRank)context.getZipEntryAsObject(path);
        DLPortletDataHandlerImpl.importFileRank(context,dlFolderPKs,fileEntryNames,fileRank);
      }
    }
    List<Element> folderEls=root.element("ig-folders").elements("folder");
    Map<Long,Long> folderPKs=context.getNewPrimaryKeysMap(IGFolder.class);
    for (    Element folderEl : folderEls) {
      String path=folderEl.attributeValue("path");
      if (context.isPathNotProcessed(path)) {
        IGFolder folder=(IGFolder)context.getZipEntryAsObject(path);
        IGPortletDataHandlerImpl.importFolder(context,folderPKs,folder);
      }
    }
    List<Element> imageEls=root.element("ig-images").elements("image");
    for (    Element imageEl : imageEls) {
      String path=imageEl.attributeValue("path");
      String binPath=imageEl.attributeValue("bin-path");
      if (context.isPathNotProcessed(path)) {
        IGImage image=(IGImage)context.getZipEntryAsObject(path);
        IGPortletDataHandlerImpl.importImage(context,folderPKs,image,binPath);
      }
    }
    return prefs;
  }
 catch (  Exception e) {
    throw new PortletDataException(e);
  }
}
