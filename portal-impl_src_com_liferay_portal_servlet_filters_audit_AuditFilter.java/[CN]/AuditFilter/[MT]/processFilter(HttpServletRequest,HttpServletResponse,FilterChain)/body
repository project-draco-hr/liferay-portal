{
  AuditRequestThreadLocal auditRequestThreadLocal=AuditRequestThreadLocal.getAuditThreadLocal();
  auditRequestThreadLocal.setClientHost(request.getRemoteHost());
  auditRequestThreadLocal.setClientIP(request.getRemoteAddr());
  auditRequestThreadLocal.setQueryString(request.getQueryString());
  auditRequestThreadLocal.setRequestURL(request.getRequestURL().toString());
  auditRequestThreadLocal.setServerName(request.getServerName());
  auditRequestThreadLocal.setServerPort(request.getServerPort());
  auditRequestThreadLocal.setSessionID(request.getSession().getId());
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  if (themeDisplay != null) {
    long realUserId=themeDisplay.getRealUserId();
    auditRequestThreadLocal.setRealUserId(realUserId);
  }
  try {
    processFilter(AuditFilter.class,request,response,filterChain);
  }
  finally {
    AuditRequestThreadLocal.removeAuditThreadLocal();
  }
}
