{
  Map<ExportPackage,Set<String>> allowedSplitPackages=_getAllowedSplitPackages();
  Map<Bundle,Set<ExportPackage>> exportPackagesMap=new HashMap<>();
  Bundle systemBundle=(Bundle)ModuleFrameworkUtilAdapter.getFramework();
  BundleContext bundleContext=systemBundle.getBundleContext();
  for (  Bundle bundle : bundleContext.getBundles()) {
    Set<ExportPackage> exportPackages=_getExportPackages(bundle);
    if (exportPackages == null) {
      continue;
    }
    for (    Map.Entry<Bundle,Set<ExportPackage>> entry : exportPackagesMap.entrySet()) {
      Set<ExportPackage> duplicatedExportPackages=new HashSet<>(entry.getValue());
      duplicatedExportPackages.retainAll(exportPackages);
      _processSplitPackages(bundle,entry.getKey(),duplicatedExportPackages,allowedSplitPackages);
    }
    exportPackagesMap.put(bundle,exportPackages);
  }
}
