{
  BatchablePipe<String,Counter<?>> pipe=(BatchablePipe<String,Counter<?>>)message.getPayload();
  IncreasableCounterEntry entry=(IncreasableCounterEntry)pipe.take();
  if (entry == null) {
    return;
  }
  String key=entry.getKey();
  if (key.endsWith("none")) {
    return;
  }
  String serviceName=entry.getService();
  Object service=PortalBeanLocatorUtil.locate(serviceName);
  Object[] args=new Object[]{entry.getId(),entry.getValue()};
  try {
    Method realUpdateMethod=service.getClass().getMethod(entry.getUpdateMethod().getName(),entry.getUpdateMethod().getParameterTypes());
    realUpdateMethod.invoke(service,args);
  }
 catch (  Exception e) {
    _log.error("Cannot write buffered counter " + "value to the database",e);
  }
}
