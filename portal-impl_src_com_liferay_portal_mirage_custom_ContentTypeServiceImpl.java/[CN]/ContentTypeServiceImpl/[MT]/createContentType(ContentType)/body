{
  JournalStructureContentType type=(JournalStructureContentType)contentType;
  JournalStructure structure=type.getStructure();
  JournalStructureContentType.CreationAttributes creationAttributes=type.getCreationAttributes();
  try {
    User user=UserUtil.findByPrimaryKey(structure.getUserId());
    String structureId=structure.getStructureId();
    structureId=structureId.trim().toUpperCase();
    Date now=new Date();
    String xsd=structure.getXsd();
    try {
      xsd=JournalUtil.formatXML(xsd);
    }
 catch (    DocumentException de) {
      throw new StructureXsdException();
    }
catch (    IOException ioe) {
      throw new StructureXsdException();
    }
    long groupId=structure.getGroupId();
    boolean autoStructureId=creationAttributes.isAutoStructureId();
    String name=structure.getName();
    String description=structure.getDescription();
    String uuid=structure.getUuid();
    validate(groupId,structureId,autoStructureId,name,description,xsd);
    if (autoStructureId) {
      structureId=String.valueOf(CounterLocalServiceUtil.increment());
    }
    long id=CounterLocalServiceUtil.increment();
    JournalStructure newStructure=JournalStructureUtil.create(id);
    newStructure.setUuid(uuid);
    newStructure.setGroupId(groupId);
    newStructure.setCompanyId(user.getCompanyId());
    newStructure.setUserId(user.getUserId());
    newStructure.setUserName(user.getFullName());
    newStructure.setCreateDate(now);
    newStructure.setModifiedDate(now);
    newStructure.setStructureId(structureId);
    newStructure.setName(name);
    newStructure.setDescription(description);
    newStructure.setXsd(xsd);
    JournalStructureUtil.update(newStructure,false);
    Boolean addCommunityPermissions=creationAttributes.getAddCommunityPermissions();
    Boolean addGuestPermissions=creationAttributes.getAddGuestPermissions();
    if ((addCommunityPermissions != null) && (addGuestPermissions != null)) {
      addStructureResources(newStructure,addCommunityPermissions.booleanValue(),addGuestPermissions.booleanValue());
    }
 else {
      addStructureResources(newStructure,type.getCommunityPermissions(),type.getGuestPermissions());
    }
  }
 catch (  PortalException ex) {
    _log.error(ex.getMessage(),ex);
    throw new CMSException(ex.getMessage(),ex);
  }
catch (  SystemException ex) {
    _log.error(ex.getMessage(),ex);
    throw new CMSException(ex.getMessage(),ex);
  }
}
