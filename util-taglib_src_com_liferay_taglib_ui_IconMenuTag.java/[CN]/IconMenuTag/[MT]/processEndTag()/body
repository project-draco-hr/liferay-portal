{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  IntegerWrapper iconCount=(IntegerWrapper)request.getAttribute("liferay-ui:icon-menu:icon-count");
  request.removeAttribute("liferay-ui:icon-menu:icon-count");
  request.removeAttribute("liferay-ui:icon-menu:id");
  Boolean singleIcon=(Boolean)request.getAttribute("liferay-ui:icon-menu:single-icon");
  request.removeAttribute("liferay-ui:icon-menu:single-icon");
  JspWriter jspWriter=pageContext.getOut();
  if ((iconCount != null) && (iconCount.getValue() >= 1) && ((singleIcon == null) || _showWhenSingleIcon)) {
    if (!FileAvailabilityUtil.isAvailable(pageContext.getServletContext(),getStartPage())) {
      if (_showExpanded) {
        jspWriter.write("<ul class=\"lfr-menu-expanded ");
        jspWriter.write("lfr-menu-list");
        if (Validator.isNotNull(_cssClass)) {
          jspWriter.write(StringPool.SPACE);
          jspWriter.print(_cssClass);
        }
        jspWriter.write("\" id=\"");
        jspWriter.write(_id);
        jspWriter.write("\">");
      }
 else {
        jspWriter.write("<div class=\"btn-group");
        if (Validator.isNotNull(_cssClass)) {
          jspWriter.write(StringPool.SPACE);
          jspWriter.print(_cssClass);
        }
        if (_direction.equals("up")) {
          jspWriter.write(" dropup");
        }
        jspWriter.write("\"><a class=\"dropdown-toggle direction-");
        jspWriter.write(_direction);
        jspWriter.write(" max-display-items-");
        jspWriter.write(String.valueOf(_maxDisplayItems));
        if (_disabled) {
          jspWriter.write(" disabled");
        }
        if (_extended) {
          jspWriter.write(" btn");
        }
        String message=_message;
        if (_localizeMessage) {
          message=LanguageUtil.get(pageContext,_message);
        }
        jspWriter.write("\" href=\"javascript:;\" id=\"");
        jspWriter.write(_id);
        jspWriter.write("\" title=\"");
        jspWriter.write(message);
        jspWriter.write("\">");
        if (_showArrow && _direction.equals("left")) {
          jspWriter.write("<i class=\"caret\"></i>&nbsp;");
        }
        boolean auiImage=false;
        if (Validator.isNotNull(_icon)) {
          auiImage=_icon.startsWith(_AUI_PATH);
          if (auiImage) {
            jspWriter.write("&nbsp;<i class=\"icon-");
            jspWriter.write(_icon.substring(_AUI_PATH.length()));
            jspWriter.write("\"></i>");
          }
 else {
            jspWriter.write("<img alt=\"\" src=\"");
            jspWriter.write(_icon);
            jspWriter.write("\" />&nbsp;");
          }
        }
        jspWriter.write(message);
        if (_showArrow && !_direction.equals("left")) {
          jspWriter.write("&nbsp;<i class=\"caret\"></i>");
        }
        jspWriter.write("</a>");
        ScriptTag.doTag(null,"liferay-menu","Liferay.Menu.register('" + _id + "');",bodyContent,pageContext);
        jspWriter.write("<ul class=\"dropdown-menu lfr-menu-list");
        jspWriter.write(" direction-");
        jspWriter.write(_direction);
        jspWriter.write("\">");
      }
    }
 else {
      PortalIncludeUtil.include(pageContext,getStartPage());
    }
  }
  writeBodyContent(jspWriter);
  if ((iconCount != null) && (iconCount.getValue() >= 1) && ((singleIcon == null) || _showWhenSingleIcon)) {
    if (!FileAvailabilityUtil.isAvailable(pageContext.getServletContext(),getEndPage())) {
      jspWriter.write("</ul>");
      if (_showExpanded) {
        ScriptTag.doTag(null,"liferay-menu","Liferay.Menu.handleFocus('#" + _id + "menu');",bodyContent,pageContext);
      }
 else {
        jspWriter.write("</div>");
      }
    }
 else {
      PortalIncludeUtil.include(pageContext,getEndPage());
    }
  }
  request.removeAttribute("liferay-ui:icon-menu:showWhenSingleIcon");
  return EVAL_PAGE;
}
