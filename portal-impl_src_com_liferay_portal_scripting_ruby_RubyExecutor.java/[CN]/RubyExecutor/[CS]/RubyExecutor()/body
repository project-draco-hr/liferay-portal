{
  RubyInstanceConfig rubyInstanceConfig=new RubyInstanceConfig();
  rubyInstanceConfig.setLoader(PortalClassLoaderUtil.getClassLoader());
  if (PropsValues.SCRIPTING_JRUBY_COMPILE_MODE.equals(_COMPILE_MODE_FORCE)) {
    rubyInstanceConfig.setCompileMode(CompileMode.FORCE);
  }
 else   if (PropsValues.SCRIPTING_JRUBY_COMPILE_MODE.equals(_COMPILE_MODE_JIT)) {
    rubyInstanceConfig.setCompileMode(CompileMode.JIT);
  }
  rubyInstanceConfig.setJitThreshold(PropsValues.SCRIPTING_JRUBY_COMPILE_THRESHOLD);
  _basePath=WebDirDetector.getRootDir(PortalClassLoaderUtil.getClassLoader());
  List<String> loadPaths=new ArrayList<String>();
  loadPaths.add(_basePath);
  _ruby=JavaEmbedUtils.initialize(loadPaths,rubyInstanceConfig);
  _ruby.setCurrentDirectory(_basePath);
}
