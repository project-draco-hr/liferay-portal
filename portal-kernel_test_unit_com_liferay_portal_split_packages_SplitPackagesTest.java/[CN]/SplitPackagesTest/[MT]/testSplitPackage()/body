{
  final Map<Path,Set<String>> moduleMap=new HashMap<>();
  final Path portalPath=Paths.get(System.getProperty("user.dir"));
  final Set<Path> ignorePaths=new HashSet<>(Arrays.asList(portalPath.resolve("portal-test"),portalPath.resolve("portal-test-integration")));
  Files.walkFileTree(portalPath,new SimpleFileVisitor<Path>(){
    @Override public FileVisitResult preVisitDirectory(    Path path,    BasicFileAttributes basicFileAttributes) throws IOException {
      if (ignorePaths.contains(path)) {
        return FileVisitResult.SKIP_SUBTREE;
      }
      if (portalPath.equals(path.getParent())) {
        Path sourcePath=path.resolve("src");
        if (Files.exists(sourcePath)) {
          Set<String> packages=_getPackageNames(sourcePath);
          _checkPackageSet(path,portalPath,moduleMap,packages);
          return FileVisitResult.SKIP_SUBTREE;
        }
      }
      if (Files.exists(path.resolve("portal.build"))) {
        Set<String> packages=new HashSet<>();
        if (Files.exists(path.resolve("docroot"))) {
          Path sourcePath=path.resolve(_DOCROOTPATH);
          if (Files.exists(sourcePath)) {
            packages=_getPackageNames(sourcePath);
          }
        }
 else {
          Path sourcePath=path.resolve(_MAINJAVAPATH);
          if (Files.exists(sourcePath)) {
            packages=_getPackageNames(sourcePath);
          }
        }
        _checkPackageSet(path,portalPath,moduleMap,packages);
        return FileVisitResult.SKIP_SUBTREE;
      }
      return FileVisitResult.CONTINUE;
    }
  }
);
}
