{
  final Map<Path,Set<String>> moduleMap=new HashMap<>();
  final Path portalPath=Paths.get(System.getProperty("user.dir"));
  final Set<Path> ignorePaths=new HashSet<>(Arrays.asList(portalPath.resolve("portal-test"),portalPath.resolve("portal-test-integration")));
  Files.walkFileTree(portalPath,new SimpleFileVisitor<Path>(){
    @Override public FileVisitResult preVisitDirectory(    Path dirPath,    BasicFileAttributes basicFileAttributes) throws IOException {
      if (ignorePaths.contains(dirPath)) {
        return FileVisitResult.SKIP_SUBTREE;
      }
      if (portalPath.equals(dirPath.getParent())) {
        Path sourcePath=dirPath.resolve("src");
        if (Files.exists(sourcePath)) {
          _checkPackageSet(dirPath,portalPath,moduleMap,sourcePath);
          return FileVisitResult.SKIP_SUBTREE;
        }
      }
      if (Files.exists(dirPath.resolve("portal.build"))) {
        Path sourcePath=dirPath.resolve("src/main/java");
        if (Files.exists(dirPath.resolve("docroot"))) {
          sourcePath=dirPath.resolve("docroot/WEB-INF/src/main/java");
        }
        if (Files.exists(sourcePath)) {
          _checkPackageSet(dirPath,portalPath,moduleMap,sourcePath);
        }
        return FileVisitResult.SKIP_SUBTREE;
      }
      return FileVisitResult.CONTINUE;
    }
  }
);
}
