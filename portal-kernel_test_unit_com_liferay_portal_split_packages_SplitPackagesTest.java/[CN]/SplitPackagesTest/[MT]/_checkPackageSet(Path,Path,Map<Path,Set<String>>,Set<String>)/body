{
  boolean addedToImpl=false;
  for (  Path mapKeyPath : moduleMap.keySet()) {
    Set<String> mapPackages=moduleMap.get(mapKeyPath);
    Set<String> currentPackages=new HashSet<>(packages);
    currentPackages.retainAll(mapPackages);
    if (!currentPackages.isEmpty()) {
      if (mapKeyPath.equals(Paths.get("portal-impl"))) {
        String text=new String(Files.readAllBytes(path.resolve("build.gradle")));
        if (text.contains("deployDir = new File(appServerPortalDir, \"WEB-INF" + "/lib\")")) {
          mapPackages.addAll(currentPackages);
          moduleMap.put(mapKeyPath,mapPackages);
          addedToImpl=true;
          currentPackages.clear();
        }
      }
    }
    Assert.assertTrue("Detected split packages in " + portalPath.relativize(path) + " and "+ mapKeyPath+ ": "+ currentPackages,currentPackages.isEmpty());
  }
  if (!addedToImpl) {
    moduleMap.put(portalPath.relativize(path),packages);
  }
}
