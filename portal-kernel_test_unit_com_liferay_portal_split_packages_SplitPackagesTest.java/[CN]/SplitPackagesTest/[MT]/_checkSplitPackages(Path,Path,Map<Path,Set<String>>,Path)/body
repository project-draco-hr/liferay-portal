{
  Set<String> packages=_getPackageNames(sourcePath);
  boolean addedToImpl=false;
  for (  Map.Entry<Path,Set<String>> entry : moduleMap.entrySet()) {
    Set<String> modulePackages=new HashSet<>(entry.getValue());
    modulePackages.retainAll(packages);
    Path modulePath=entry.getKey();
    if (!modulePackages.isEmpty() && modulePath.equals(Paths.get("portal-impl"))) {
      String buildGradleContent=new String(Files.readAllBytes(dirPath.resolve("build.gradle")));
      if (buildGradleContent.contains("deployDir = new File(appServerPortalDir, " + "\"WEB-INF/lib\")")) {
        Set<String> portalImplPackages=entry.getValue();
        portalImplPackages.addAll(packages);
        addedToImpl=true;
        modulePackages.clear();
      }
    }
    Assert.assertTrue("Detected split packages in " + portalPath.relativize(dirPath) + " and "+ modulePath+ ": "+ modulePackages,modulePackages.isEmpty());
  }
  if (!addedToImpl) {
    moduleMap.put(portalPath.relativize(dirPath),packages);
  }
}
