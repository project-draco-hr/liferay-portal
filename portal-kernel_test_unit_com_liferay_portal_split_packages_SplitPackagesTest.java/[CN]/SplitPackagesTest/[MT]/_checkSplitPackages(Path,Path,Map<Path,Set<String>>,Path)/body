{
  Set<String> packageNames=_getPackageNames(sourcePath);
  boolean addedToImpl=false;
  for (  Map.Entry<Path,Set<String>> entry : moduleMap.entrySet()) {
    Set<String> modulePackageNames=new HashSet<>(entry.getValue());
    modulePackageNames.retainAll(packageNames);
    Path modulePath=entry.getKey();
    if (!modulePackageNames.isEmpty() && modulePath.equals(Paths.get("portal-impl"))) {
      String buildGradleContent=new String(Files.readAllBytes(dirPath.resolve("build.gradle")));
      if (buildGradleContent.contains("deployDir = new File(appServerPortalDir, " + "\"WEB-INF/lib\")")) {
        Set<String> portalImplPackages=entry.getValue();
        portalImplPackages.addAll(packageNames);
        addedToImpl=true;
        modulePackageNames.clear();
      }
    }
    Assert.assertTrue("Detected split packages in " + portalPath.relativize(dirPath) + " and "+ modulePath+ ": "+ modulePackageNames,modulePackageNames.isEmpty());
  }
  if (!addedToImpl) {
    moduleMap.put(portalPath.relativize(dirPath),packageNames);
  }
}
