{
  _serviceReferenceMapper.map(serviceReference,new ServiceReferenceMapper.Emitter<K>(){
    @Override public void emit(    K key){
      ServiceTrackerBucket<S,R> serviceTrackerBucket=_serviceTrackerBuckets.get(key);
      if (serviceTrackerBucket == null) {
        ServiceTrackerBucket<S,R> newServiceTrackerBucket=_serviceTrackerMapBucketFactory.create();
        serviceTrackerBucket=_serviceTrackerBuckets.putIfAbsent(key,newServiceTrackerBucket);
        if (serviceTrackerBucket == null) {
          serviceTrackerBucket=newServiceTrackerBucket;
        }
      }
      serviceTrackerBucket.store(serviceReference);
    }
  }
);
  return serviceReference;
}
