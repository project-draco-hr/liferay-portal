{
  _serviceReferenceMapper.map(serviceReference,new ServiceReferenceMapper.Emitter<K>(){
    @Override public void emit(    K key){
      ServiceTrackerMapBucket<S,R> bucket=_indexedServices.get(key);
      if (bucket == null) {
        ServiceTrackerMapBucket<S,R> newBucket=_serviceTrackerMapBucketFactory.create();
        bucket=_indexedServices.putIfAbsent(key,newBucket);
        if (bucket == null) {
          bucket=newBucket;
        }
      }
      bucket.store(serviceReference);
    }
  }
);
  return serviceReference;
}
