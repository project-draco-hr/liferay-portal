{
  String ppInvoice=ParamUtil.getString(request,"invoice");
  ShoppingOrder order=ShoppingOrderLocalServiceUtil.getOrder(ppInvoice);
  ShoppingPreferences shoppingPrefs=ShoppingPreferences.getInstance(order.getCompanyId(),order.getGroupId());
  String ppReceiverEmail=ParamUtil.getString(request,"receiver_email");
  String payPalEmailAddress=shoppingPrefs.getPayPalEmailAddress();
  if (!payPalEmailAddress.equals(ppReceiverEmail)) {
    return false;
  }
  double ppGross=ParamUtil.getDouble(request,"mc_gross");
  double orderTotal=ShoppingUtil.calculateTotal(order);
  if (orderTotal != ppGross) {
    return false;
  }
  String ppCurrency=ParamUtil.getString(request,"mc_currency");
  String currencyId=shoppingPrefs.getCurrencyId();
  if (!currencyId.equals(ppCurrency)) {
    return false;
  }
  String ppTxnId=ParamUtil.getString(request,"txn_id");
  try {
    ShoppingOrderLocalServiceUtil.getPayPalTxnIdOrder(ppTxnId);
    return false;
  }
 catch (  NoSuchOrderException nsoe) {
  }
  return true;
}
