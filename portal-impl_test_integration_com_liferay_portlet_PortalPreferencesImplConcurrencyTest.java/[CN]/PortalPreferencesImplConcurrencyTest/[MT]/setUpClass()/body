{
  _transactionInterceptor=(TransactionInterceptor)PortalBeanLocatorUtil.locate("transactionAdvice");
  _originalTransactionExecutor=ReflectionTestUtil.getFieldValue(_transactionInterceptor,"transactionExecutor");
  _transactionInterceptor.setTransactionExecutor(new SynchronizedTransactionExecutor(_originalTransactionExecutor));
  _originalPortalPreferencesLocalService=PortalPreferencesLocalServiceUtil.getService();
  InvocationHandler invocationHandler=new SynchronousInvocationHandler(_originalPortalPreferencesLocalService);
  Class<?> clazz=_originalPortalPreferencesLocalService.getClass();
  ReflectionTestUtil.setFieldValue(PortalPreferencesLocalServiceUtil.class,"_service",ProxyUtil.newProxyInstance(clazz.getClassLoader(),clazz.getInterfaces(),invocationHandler));
  _testThread.set(true);
}
