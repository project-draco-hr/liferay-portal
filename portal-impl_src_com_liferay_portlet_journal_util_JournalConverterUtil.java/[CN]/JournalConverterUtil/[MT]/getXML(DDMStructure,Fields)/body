{
  Document document=SAXReaderUtil.createDocument();
  String availableLocales=getAvailableLocales(fields);
  Locale defaultLocale=fields.getDefaultLocale();
  Element rootElement=document.addElement("root");
  rootElement.addAttribute("available-locales",availableLocales);
  rootElement.addAttribute("default-locale",LocaleUtil.toLanguageId(defaultLocale));
  DDMFieldsCounter ddmFieldsCounter=new DDMFieldsCounter();
  for (  String fieldName : ddmStructure.getParentFieldNames()) {
    int repetitions=countFieldRepetition(fields,fieldName,null,-1);
    for (int i=0; i < repetitions; i++) {
      Element dynamicElementElement=rootElement.addElement("dynamic-element");
      dynamicElementElement.addAttribute("name",fieldName);
      updateDynamicElement(dynamicElementElement,ddmStructure,fields,ddmFieldsCounter);
    }
  }
  return DDMXMLUtil.formatXML(document.asXML());
}
