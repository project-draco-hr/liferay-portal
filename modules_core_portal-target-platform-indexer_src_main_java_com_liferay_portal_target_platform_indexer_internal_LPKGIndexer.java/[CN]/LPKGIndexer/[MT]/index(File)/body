{
  Path tempPath=Files.createTempDirectory(null);
  File tempDir=tempPath.toFile();
  _config.put("root.url",tempDir.getCanonicalPath());
  String bundleSymbolicName=_lpkgFile.getName();
  String bundleVersion="1.0.0";
  try (ZipFile zipFile=new ZipFile(_lpkgFile)){
    ResourceIndexer resourceIndexer=new RepoIndex();
    Enumeration<? extends ZipEntry> enumeration=zipFile.entries();
    Set<File> files=new LinkedHashSet<>();
    while (enumeration.hasMoreElements()) {
      ZipEntry zipEntry=enumeration.nextElement();
      String name=zipEntry.getName();
      if (name.endsWith("liferay-marketplace.properties")) {
        Properties properties=new Properties();
        properties.load(zipFile.getInputStream(zipEntry));
        bundleSymbolicName=properties.getProperty("title");
        bundleVersion=properties.getProperty("version");
        continue;
      }
 else       if (!name.endsWith(".jar")) {
        continue;
      }
      File file=new File(tempDir,name);
      Files.copy(zipFile.getInputStream(zipEntry),file.toPath());
      files.add(file);
    }
    File indexFile=new File(tempDir,bundleSymbolicName + "-" + bundleVersion+ "-index.xml");
    try (FileOutputStream fileOutputStream=new FileOutputStream(indexFile)){
      resourceIndexer.index(files,fileOutputStream,_config);
    }
     if (outputFile.isDirectory()) {
      outputFile=new File(outputFile,indexFile.getName());
    }
    Files.copy(indexFile.toPath(),outputFile.toPath(),StandardCopyOption.COPY_ATTRIBUTES,StandardCopyOption.REPLACE_EXISTING);
    return outputFile;
  }
  finally {
    PathUtil.deltree(tempPath);
  }
}
