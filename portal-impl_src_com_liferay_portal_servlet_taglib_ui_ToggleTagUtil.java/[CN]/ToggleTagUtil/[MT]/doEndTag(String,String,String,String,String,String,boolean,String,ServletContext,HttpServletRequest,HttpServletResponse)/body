{
  try {
    ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
    if (Validator.isNull(showImage) && Validator.isNull(showMessage)) {
      showImage=themeDisplay.getPathThemeImages() + "/arrows/01_down.png";
    }
    if (Validator.isNull(hideImage) && Validator.isNull(hideImage)) {
      hideImage=themeDisplay.getPathThemeImages() + "/arrows/01_right.png";
    }
    String defaultStateValue=defaultShowContent ? StringPool.BLANK : "none";
    String defaultImage=defaultShowContent ? hideImage : showImage;
    String defaultMessage=defaultShowContent ? hideMessage : showMessage;
    String clickValue=SessionClicks.get(req,id,null);
    if (defaultShowContent) {
      if ((clickValue != null) && (clickValue.equals("none"))) {
        defaultStateValue="none";
        defaultImage=showImage;
        defaultMessage=showMessage;
      }
 else {
        defaultStateValue="";
        defaultImage=hideImage;
        defaultMessage=hideMessage;
      }
    }
 else {
      if ((clickValue == null) || (clickValue.equals("none"))) {
        defaultStateValue="none";
        defaultImage=showImage;
        defaultMessage=showMessage;
      }
 else {
        defaultStateValue="";
        defaultImage=hideImage;
        defaultMessage=hideMessage;
      }
    }
    if (stateVar == null) {
      stateVar=PwdGenerator.getPassword(PwdGenerator.KEY3,8);
    }
    req.setAttribute("liferay-ui:toggle:id",id);
    req.setAttribute("liferay-ui:toggle:showImage",showImage);
    req.setAttribute("liferay-ui:toggle:hideImage",hideImage);
    req.setAttribute("liferay-ui:toggle:showMessage",showMessage);
    req.setAttribute("liferay-ui:toggle:hideMessage",hideMessage);
    req.setAttribute("liferay-ui:toggle:stateVar",stateVar);
    req.setAttribute("liferay-ui:toggle:defaultStateValue",defaultStateValue);
    req.setAttribute("liferay-ui:toggle:defaultImage",defaultImage);
    req.setAttribute("liferay-ui:toggle:defaultMessage",defaultMessage);
    RequestDispatcher rd=ctx.getRequestDispatcher(page);
    rd.include(req,res);
  }
 catch (  Exception e) {
    _log.error(e,e);
    throw new JspException(e);
  }
}
