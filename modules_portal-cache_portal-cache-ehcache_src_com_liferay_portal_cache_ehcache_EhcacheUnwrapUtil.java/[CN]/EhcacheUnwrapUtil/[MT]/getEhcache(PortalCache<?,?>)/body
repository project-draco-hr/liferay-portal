{
  PortalCache<?,?> currentPortalCache=portalCache;
  while (currentPortalCache instanceof PortalCacheWrapper) {
    PortalCacheWrapper<?,?> portalCacheWrapper=(PortalCacheWrapper<?,?>)currentPortalCache;
    currentPortalCache=portalCacheWrapper.getWrappedPortalCache();
  }
  if (currentPortalCache instanceof EhcachePortalCache) {
    EhcachePortalCache<?,?> ehcachePortalCache=(EhcachePortalCache<?,?>)currentPortalCache;
    return ehcachePortalCache.getEhcache();
  }
  throw new IllegalArgumentException("Unable to locate Ehcache from " + portalCache);
}
