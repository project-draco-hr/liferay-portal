{
  StringBundler sb=new StringBundler(3);
  sb.append(_TEMP_DIR);
  sb.append(layoutSetPrototype.getUuid());
  sb.append(".lar");
  long modifiedTime=layoutSetPrototype.getModifiedDate().getTime();
  File cacheFile=new File(sb.toString());
  File file=null;
  boolean isNewFile=false;
  if (cacheFile.exists() && (cacheFile.lastModified() >= modifiedTime)) {
    if (_log.isDebugEnabled()) {
      _log.debug("Using cached layoutSetPrototype LAR file " + cacheFile.getAbsolutePath());
    }
    file=cacheFile;
  }
  Group layoutSetPrototypeGroup=layoutSetPrototype.getGroup();
  long userId=getOwnerUserId(permissionChecker,layoutSetPrototype);
  if (file == null) {
    file=LayoutLocalServiceUtil.exportLayoutsAsFile(layoutSetPrototypeGroup.getGroupId(),true,null,parameterMap,null,null);
    isNewFile=true;
  }
  LayoutLocalServiceUtil.importLayouts(userId,groupId,privateLayout,parameterMap,file);
  if (isNewFile) {
    try {
      FileUtil.copyFile(file,cacheFile);
      if (_log.isDebugEnabled()) {
        _log.debug("Copied " + file.getAbsolutePath() + " to "+ cacheFile.getAbsolutePath());
      }
    }
 catch (    Exception e) {
      _log.error("File " + file.getAbsolutePath() + " could not be copied to "+ cacheFile.getAbsolutePath(),e);
    }
  }
}
