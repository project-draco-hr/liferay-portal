{
  _user.setTimeZoneId("Asia/Shangai");
  UserLocalServiceUtil.updateUser(_user);
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setCompanyId(_user.getCompanyId());
  CalendarResource calendarResource=CalendarResourceUtil.getUserCalendarResource(_user.getUserId(),serviceContext);
  UpgradeCalendar upgradeCalendar=new UpgradeCalendar();
  upgradeCalendar.doUpgrade();
  List<Calendar> calendars=CalendarLocalServiceUtil.getCalendarResourceCalendars(_user.getGroupId(),calendarResource.getCalendarResourceId());
  Calendar calendar=calendars.get(0);
  Assert.assertEquals("Asia/Shangai",calendar.getTimeZoneId());
}
