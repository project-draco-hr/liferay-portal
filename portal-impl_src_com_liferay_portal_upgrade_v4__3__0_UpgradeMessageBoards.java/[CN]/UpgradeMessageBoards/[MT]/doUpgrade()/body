{
  UpgradeColumn upgradeGroupIdColumn=new SwapUpgradeColumnImpl("groupId",AvailableMappersUtil.getGroupIdMapper());
  UpgradeColumn upgradeUserIdColumn=new SwapUpgradeColumnImpl("userId",new Integer(Types.VARCHAR),AvailableMappersUtil.getUserIdMapper());
  PKUpgradeColumnImpl pkUpgradeColumn=new PKUpgradeColumnImpl("categoryId",true);
  UpgradeTable upgradeTable=new DefaultUpgradeTableImpl(MBCategoryImpl.TABLE_NAME,MBCategoryImpl.TABLE_COLUMNS,pkUpgradeColumn,upgradeGroupIdColumn,upgradeUserIdColumn);
  upgradeTable.updateTable();
  ValueMapper categoryIdMapper=new DefaultPKMapper(pkUpgradeColumn.getValueMapper());
  AvailableMappersUtil.setMBCategoryIdMapper(categoryIdMapper);
  UpgradeColumn upgradeParentCategoryIdColumn=new SwapUpgradeColumnImpl("parentCategoryId",categoryIdMapper);
  upgradeTable=new DefaultUpgradeTableImpl(MBCategoryImpl.TABLE_NAME,MBCategoryImpl.TABLE_COLUMNS,upgradeParentCategoryIdColumn);
  upgradeTable.updateTable();
  UpgradeColumn upgradeCategoryIdColumn=new SwapUpgradeColumnImpl("categoryId",categoryIdMapper);
  pkUpgradeColumn=new PKUpgradeColumnImpl("messageId",true);
  UpgradeColumn upgradeThreadIdColumn=new TempUpgradeColumnImpl("threadId");
  UpgradeColumn upgradeAttachmentsColumn=new MBMessageAttachmentsUpgradeColumnImpl(pkUpgradeColumn,upgradeThreadIdColumn);
  upgradeTable=new DefaultUpgradeTableImpl(MBMessageImpl.TABLE_NAME,MBMessageImpl.TABLE_COLUMNS,pkUpgradeColumn,upgradeUserIdColumn,upgradeCategoryIdColumn,upgradeThreadIdColumn,upgradeAttachmentsColumn);
  upgradeTable.updateTable();
  ValueMapper messageIdMapper=new DefaultPKMapper(pkUpgradeColumn.getValueMapper());
  AvailableMappersUtil.setMBMessageIdMapper(messageIdMapper);
  UpgradeColumn upgradeParentMessageIdColumn=new SwapUpgradeColumnImpl("parentMessageId",messageIdMapper);
  upgradeTable=new DefaultUpgradeTableImpl(MBMessageImpl.TABLE_NAME,MBMessageImpl.TABLE_COLUMNS,upgradeParentMessageIdColumn);
  upgradeTable.updateTable();
  UpgradeColumn upgradeMessageIdColumn=new SwapUpgradeColumnImpl("messageId",messageIdMapper);
  UpgradeColumn upgradeRootMessageIdColumn=new SwapUpgradeColumnImpl("rootMessageId",messageIdMapper);
  pkUpgradeColumn=new PKUpgradeColumnImpl("messageFlagId",true);
  upgradeTable=new DefaultUpgradeTableImpl(MBMessageFlagImpl.TABLE_NAME,MBMessageFlagImpl.TABLE_COLUMNS,pkUpgradeColumn,upgradeUserIdColumn,upgradeMessageIdColumn);
  upgradeTable.updateTable();
  upgradeTable=new DefaultUpgradeTableImpl(MBStatsUserImpl.TABLE_NAME,MBStatsUserImpl.TABLE_COLUMNS,new PKUpgradeColumnImpl("statsUserId",false),upgradeGroupIdColumn,upgradeUserIdColumn);
  upgradeTable.updateTable();
  pkUpgradeColumn=new PKUpgradeColumnImpl("threadId",true);
  UpgradeColumn upgradeLastPostByUserIdColumn=new SwapUpgradeColumnImpl("lastPostByUserId",new Integer(Types.VARCHAR),AvailableMappersUtil.getUserIdMapper());
  upgradeTable=new DefaultUpgradeTableImpl(MBThreadImpl.TABLE_NAME,MBThreadImpl.TABLE_COLUMNS,pkUpgradeColumn,upgradeCategoryIdColumn,upgradeRootMessageIdColumn,upgradeLastPostByUserIdColumn);
  upgradeTable.updateTable();
  ValueMapper threadIdMapper=pkUpgradeColumn.getValueMapper();
  upgradeThreadIdColumn=new SwapUpgradeColumnImpl("threadId",threadIdMapper);
  upgradeTable=new DefaultUpgradeTableImpl(MBMessageImpl.TABLE_NAME,MBMessageImpl.TABLE_COLUMNS,upgradeThreadIdColumn);
  upgradeTable.updateTable();
  ClassNameIdUpgradeColumnImpl classNameIdColumn=new ClassNameIdUpgradeColumnImpl();
  Map classPKContainers=CollectionFactory.getHashMap();
  classPKContainers.put(new Long(PortalUtil.getClassNameId(BlogsEntry.class.getName())),new ClassPKContainer(AvailableMappersUtil.getBlogsEntryIdMapper(),true));
  UpgradeColumn upgradeClassPKColumn=new ClassPKUpgradeColumnImpl(classNameIdColumn,classPKContainers);
  upgradeTable=new DefaultUpgradeTableImpl(MBDiscussionImpl.TABLE_NAME,MBDiscussionImpl.TABLE_COLUMNS,new PKUpgradeColumnImpl("discussionId",false),classNameIdColumn,upgradeClassPKColumn,upgradeThreadIdColumn);
  upgradeTable.updateTable();
  runSQL(_UPGRADE_SCHEMA);
}
