{
  Socket socket=null;
  try {
    socket=_serverSocket.accept();
    _serverSocket.close();
    socket.shutdownInput();
    ObjectOutputStream objectOutputStream=new AnnotatedObjectOutputStream(socket.getOutputStream());
    objectOutputStream.writeObject(_CACHE_TX_START);
    Ehcache ehcache=_portalCacheManager.getCache(_cacheName);
    if (ehcache == null) {
      EhcacheStreamBootstrapCacheLoader.setSkip();
      try {
        _portalCacheManager.addCache(_cacheName);
      }
  finally {
        EhcacheStreamBootstrapCacheLoader.resetSkip();
      }
    }
 else {
      objectOutputStream.writeObject(_cacheName);
      List<Object> keys=ehcache.getKeys();
      for (      Object key : keys) {
        if (!(key instanceof Serializable)) {
          if (_log.isWarnEnabled()) {
            _log.warn("Key " + key.toString() + " cannot be serializable");
          }
          continue;
        }
        Element element=ehcache.get(key);
        Object value=element.getObjectValue();
        if (value == null) {
          continue;
        }
 else {
          if (!(value instanceof Serializable)) {
            if (_log.isWarnEnabled()) {
              _log.warn("Value " + value.toString() + " cannot be serializable");
            }
            continue;
          }
        }
        EhcacheElement ehcacheElement=new EhcacheElement((Serializable)key,(Serializable)value);
        objectOutputStream.writeObject(ehcacheElement);
      }
    }
    objectOutputStream.writeObject(_SOCKET_CLOSE);
    objectOutputStream.close();
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
 finally {
    if (socket != null) {
      try {
        socket.close();
      }
 catch (      IOException ioe) {
        throw new RuntimeException(ioe);
      }
    }
  }
}
