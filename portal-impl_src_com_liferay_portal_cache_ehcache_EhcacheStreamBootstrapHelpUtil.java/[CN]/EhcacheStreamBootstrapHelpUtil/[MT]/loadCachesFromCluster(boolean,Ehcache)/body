{
  if (acquireCachePeers() < 2) {
    return;
  }
  EhcachePortalCacheManager<?,?> ehcachePortalCacheManager=(EhcachePortalCacheManager<?,?>)PortalBeanLocatorUtil.locate(_BEAN_NAME_MULTI_VM_PORTAL_CACHE_MANAGER);
  CacheManager portalCacheManager=ehcachePortalCacheManager.getEhcacheManager();
  List<String> localCacheNames=null;
  if (synchronizeCaches) {
    localCacheNames=Arrays.asList(portalCacheManager.getCacheNames());
  }
  List<String> ehcacheNames=new ArrayList<String>();
  for (  Ehcache ehcache : ehcaches) {
    ehcacheNames.add(ehcache.getName());
  }
  ClusterRequest clusterRequest=ClusterRequest.createMulticastRequest(new MethodHandler(_createServerSocketFromClusterMethodKey,localCacheNames,ehcacheNames,synchronizeCaches),true);
  FutureClusterResponses futureClusterResponses=ClusterExecutorUtil.execute(clusterRequest);
  BlockingQueue<ClusterNodeResponse> clusterNodeResponses=futureClusterResponses.getPartialResults();
  ClusterNodeResponse clusterNodeResponse=null;
  try {
    clusterNodeResponse=clusterNodeResponses.poll(PropsValues.CLUSTER_LINK_NODE_BOOTUP_RESPONSE_TIMEOUT,TimeUnit.MILLISECONDS);
  }
 catch (  InterruptedException ie) {
    return;
  }
  if (clusterNodeResponse == null) {
    return;
  }
  ObjectInputStream objectInputStream=null;
  Socket socket=null;
  try {
    SocketAddress remoteSocketAddress=(SocketAddress)clusterNodeResponse.getResult();
    if (remoteSocketAddress == null) {
      return;
    }
    socket=new Socket();
    socket.connect(remoteSocketAddress);
    socket.shutdownOutput();
    objectInputStream=new AnnotatedObjectInputStream(socket.getInputStream());
    Ehcache ehcache=null;
    while (true) {
      Object object=objectInputStream.readObject();
      if (object instanceof EhcacheElement) {
        EhcacheElement ehcacheElement=(EhcacheElement)object;
        Element element=ehcacheElement.toElement();
        ehcache.put(element,true);
      }
 else       if (object instanceof String) {
        String command=(String)object;
        if (command.equals(_COMMAND_CACHE_TX_START)) {
          String incomingString=(String)objectInputStream.readObject();
          if (incomingString.equals(_COMMAND_SOCKET_CLOSE)) {
            break;
          }
          ehcache=portalCacheManager.getCache(incomingString);
          if (ehcache == null) {
            EhcacheStreamBootstrapCacheLoader.setSkip();
            try {
              portalCacheManager.addCache(incomingString);
              ehcache=portalCacheManager.getCache(incomingString);
            }
  finally {
              EhcacheStreamBootstrapCacheLoader.resetSkip();
            }
          }
        }
 else         if (command.equals(_COMMAND_SOCKET_CLOSE)) {
          break;
        }
      }
 else {
        throw new SystemException("Socket input stream returned invalid object " + object);
      }
    }
  }
  finally {
    if (objectInputStream != null) {
      objectInputStream.close();
    }
    if (socket != null) {
      socket.close();
    }
  }
}
