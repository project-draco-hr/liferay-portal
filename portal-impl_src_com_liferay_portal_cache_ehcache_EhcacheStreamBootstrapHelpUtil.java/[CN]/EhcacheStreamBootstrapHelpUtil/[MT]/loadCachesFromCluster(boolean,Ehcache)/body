{
  if (acquireCachePeers() < 2) {
    return;
  }
  List<String> ehcacheNames=new ArrayList<String>();
  if (synchronizeCaches) {
    for (    Ehcache ehcache : synchronizeCaches()) {
      ehcacheNames.add(ehcache.getName());
    }
  }
  for (  Ehcache ehcache : ehcaches) {
    ehcacheNames.add(ehcache.getName());
  }
  ClusterRequest clusterRequest=ClusterRequest.createMulticastRequest(new MethodHandler(_createServerSocketFromClusterMethodKey,ehcacheNames),true);
  FutureClusterResponses futureClusterResponses=ClusterExecutorUtil.execute(clusterRequest);
  BlockingQueue<ClusterNodeResponse> clusterNodeResponses=futureClusterResponses.getPartialResults();
  ClusterNodeResponse clusterNodeResponse=null;
  try {
    clusterNodeResponse=clusterNodeResponses.poll(PropsValues.CLUSTER_LINK_NODE_BOOTUP_RESPONSE_TIMEOUT,TimeUnit.MILLISECONDS);
  }
 catch (  InterruptedException ie) {
    return;
  }
  if (clusterNodeResponse == null) {
    return;
  }
  ObjectInputStream objectInputStream=null;
  Socket socket=null;
  try {
    SocketAddress remoteSocketAddress=(SocketAddress)clusterNodeResponse.getResult();
    if (remoteSocketAddress == null) {
      return;
    }
    socket=new Socket();
    socket.connect(remoteSocketAddress);
    socket.shutdownOutput();
    objectInputStream=new AnnotatedObjectInputStream(socket.getInputStream());
    EhcachePortalCacheManager<?,?> ehcachePortalCacheManager=(EhcachePortalCacheManager<?,?>)PortalBeanLocatorUtil.locate(_BEAN_NAME_MULTI_VM_PORTAL_CACHE_MANAGER);
    CacheManager portalCacheManager=ehcachePortalCacheManager.getEhcacheManager();
    Ehcache ehcache=null;
    while (true) {
      Object object=objectInputStream.readObject();
      if (object instanceof EhcacheElement) {
        EhcacheElement ehcacheElement=(EhcacheElement)object;
        Element element=ehcacheElement.toElement();
        ehcache.put(element,true);
      }
 else       if (object instanceof String) {
        String command=(String)object;
        if (command.equals(_COMMAND_CACHE_TX_START)) {
          String cacheName=(String)objectInputStream.readObject();
          ehcache=portalCacheManager.getCache(cacheName);
          if (ehcache == null) {
            EhcacheStreamBootstrapCacheLoader.setSkip();
            try {
              portalCacheManager.addCache(cacheName);
              ehcache=portalCacheManager.getCache(cacheName);
            }
  finally {
              EhcacheStreamBootstrapCacheLoader.resetSkip();
            }
          }
        }
 else         if (command.equals(_COMMAND_SOCKET_CLOSE)) {
          break;
        }
      }
 else {
        throw new SystemException("Socket input stream returned invalid object " + object);
      }
    }
  }
  finally {
    if (objectInputStream != null) {
      objectInputStream.close();
    }
    if (socket != null) {
      socket.close();
    }
  }
}
