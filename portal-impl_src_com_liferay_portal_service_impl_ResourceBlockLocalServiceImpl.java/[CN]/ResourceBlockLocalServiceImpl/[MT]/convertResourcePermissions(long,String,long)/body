{
  PermissionedModel model=getPermissionedModel(name,primKey);
  long groupId=0;
  if (model instanceof GroupedModel) {
    groupId=((GroupedModel)model).getGroupId();
  }
  ResourceBlock resourceBlock=resourceBlockPersistence.fetchByPrimaryKey(model.getResourceBlockId());
  ResourceBlockPermissionsContainer resourceBlockPermissionsContainer=resourceBlockPermissionLocalService.getResourceBlockPermissionsContainer(companyId,groupId,name,primKey);
  String permissionsHash=getPermissionsHash(resourceBlockPermissionsContainer);
  if (resourceBlock != null) {
    if (resourceBlock.getPermissionsHash() == permissionsHash) {
      return resourceBlock;
    }
    release(resourceBlock);
  }
  resourceBlock=updateResourceBlockId(companyId,groupId,name,model,permissionsHash,resourceBlockPermissionsContainer);
  return resourceBlock;
}
