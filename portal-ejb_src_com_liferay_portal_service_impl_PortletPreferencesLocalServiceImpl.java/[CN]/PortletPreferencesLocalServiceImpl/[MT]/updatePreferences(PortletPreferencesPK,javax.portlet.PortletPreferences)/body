{
  PortletPreferences portletPreferences=null;
  try {
    portletPreferences=PortletPreferencesUtil.findByPrimaryKey(pk);
  }
 catch (  NoSuchPortletPreferencesException nsppe) {
    portletPreferences=PortletPreferencesUtil.create(pk);
  }
  PortletPreferencesImpl prefsImpl=(PortletPreferencesImpl)prefs;
  String xml=PortletPreferencesSerializer.toXML(prefsImpl);
  portletPreferences.setPreferences(xml);
  PortletPreferencesUtil.update(portletPreferences);
  PortletPreferencesLocalUtil.clearPreferencesPool(pk.ownerId);
  return portletPreferences;
}
