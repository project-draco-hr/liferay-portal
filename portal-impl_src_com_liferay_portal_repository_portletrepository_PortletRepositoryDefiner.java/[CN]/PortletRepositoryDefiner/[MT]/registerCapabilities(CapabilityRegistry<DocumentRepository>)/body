{
  DocumentRepository documentRepository=capabilityRegistry.getTarget();
  DLAppServiceAdapter dlAppServiceAdapter=null;
  DLFileEntryServiceAdapter dlFileEntryServiceAdapter=null;
  DLFolderServiceAdapter dlFolderServiceAdapter=null;
  RepositoryServiceAdapter repositoryServiceAdapter=null;
  TrashEntryServiceAdapter trashEntryServiceAdapter=null;
  if (documentRepository instanceof LocalRepository) {
    dlAppServiceAdapter=new DLAppServiceAdapter(DLAppLocalServiceUtil.getService());
    dlFileEntryServiceAdapter=new DLFileEntryServiceAdapter(DLFileEntryLocalServiceUtil.getService());
    dlFolderServiceAdapter=new DLFolderServiceAdapter(DLFolderLocalServiceUtil.getService());
    repositoryServiceAdapter=new RepositoryServiceAdapter(RepositoryLocalServiceUtil.getService());
    trashEntryServiceAdapter=new TrashEntryServiceAdapter(TrashEntryLocalServiceUtil.getService());
  }
 else {
    dlAppServiceAdapter=new DLAppServiceAdapter(DLAppLocalServiceUtil.getService(),DLAppServiceUtil.getService());
    dlFileEntryServiceAdapter=new DLFileEntryServiceAdapter(DLFileEntryLocalServiceUtil.getService(),DLFileEntryServiceUtil.getService());
    dlFolderServiceAdapter=new DLFolderServiceAdapter(DLFolderLocalServiceUtil.getService(),DLFolderServiceUtil.getService());
    repositoryServiceAdapter=new RepositoryServiceAdapter(RepositoryLocalServiceUtil.getService(),RepositoryServiceUtil.getService());
    trashEntryServiceAdapter=new TrashEntryServiceAdapter(TrashEntryLocalServiceUtil.getService(),TrashEntryServiceUtil.getService());
  }
  capabilityRegistry.addExportedCapability(RelatedModelCapability.class,new LiferayRelatedModelCapability(new RepositoryEntryConverter(),new RepositoryEntryChecker(documentRepository)));
  TrashCapability trashCapability=new LiferayTrashCapability(dlAppServiceAdapter,DLAppHelperLocalServiceUtil.getService(),dlFileEntryServiceAdapter,dlFolderServiceAdapter,repositoryServiceAdapter,trashEntryServiceAdapter,TrashVersionLocalServiceUtil.getService());
  capabilityRegistry.addExportedCapability(TrashCapability.class,trashCapability);
  capabilityRegistry.addExportedCapability(WorkflowCapability.class,new MinimalWorkflowCapability(dlFileEntryServiceAdapter));
}
