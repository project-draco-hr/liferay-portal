{
  double tax=0.0;
  ShoppingGroupServiceOverriddenConfiguration shoppingGroupServiceOverriddenConfiguration=null;
  for (  Map.Entry<ShoppingCartItem,Integer> entry : items.entrySet()) {
    ShoppingCartItem cartItem=entry.getKey();
    ShoppingItem item=cartItem.getItem();
    if (shoppingGroupServiceOverriddenConfiguration == null) {
      ShoppingCategory category=item.getCategory();
      shoppingGroupServiceOverriddenConfiguration=_getShoppingGroupServiceOverriddenConfiguration(category.getGroupId());
      break;
    }
  }
  if (shoppingGroupServiceOverriddenConfiguration == null) {
    return tax;
  }
  String taxState=shoppingGroupServiceOverriddenConfiguration.getTaxState();
  if (!taxState.equals(stateId)) {
    return tax;
  }
  double subtotal=0.0;
  for (  Map.Entry<ShoppingCartItem,Integer> entry : items.entrySet()) {
    ShoppingCartItem cartItem=entry.getKey();
    Integer count=entry.getValue();
    ShoppingItem item=cartItem.getItem();
    if (item.isTaxable()) {
      subtotal+=calculatePrice(item,count.intValue());
    }
  }
  return shoppingGroupServiceOverriddenConfiguration.getTaxRate() * subtotal;
}
