{
  List<SearchResult> searchResults=new ArrayList<SearchResult>();
  for (  Document document : hits.getDocs()) {
    String entryClassName=GetterUtil.getString(document.get(Field.ENTRY_CLASS_NAME));
    long entryClassPK=GetterUtil.getLong(document.get(Field.ENTRY_CLASS_PK));
    try {
      String className=entryClassName;
      long classPK=entryClassPK;
      FileEntry fileEntry=null;
      MBMessage mbMessage=null;
      if (entryClassName.equals(DLFileEntry.class.getName())) {
        classPK=GetterUtil.getLong(document.get(Field.CLASS_PK));
        long classNameId=GetterUtil.getLong(document.get(Field.CLASS_NAME_ID));
        if ((classPK > 0) && (classNameId > 0)) {
          className=PortalUtil.getClassName(classNameId);
          fileEntry=DLAppLocalServiceUtil.getFileEntry(entryClassPK);
        }
 else {
          className=entryClassName;
          classPK=entryClassPK;
        }
      }
 else       if (entryClassName.equals(MBMessage.class.getName())) {
        classPK=GetterUtil.getLong(document.get(Field.CLASS_PK));
        long classNameId=GetterUtil.getLong(document.get(Field.CLASS_NAME_ID));
        if ((classPK > 0) && (classNameId > 0)) {
          className=PortalUtil.getClassName(classNameId);
          mbMessage=MBMessageLocalServiceUtil.getMessage(entryClassPK);
        }
 else {
          className=entryClassName;
          classPK=entryClassPK;
        }
      }
      SearchResult searchResult=new SearchResult(className,classPK);
      int index=searchResults.indexOf(searchResult);
      if (index < 0) {
        searchResults.add(searchResult);
      }
 else {
        searchResult=searchResults.get(index);
      }
      if (fileEntry != null) {
        searchResult.addAttachment(fileEntry);
      }
      if (mbMessage != null) {
        searchResult.addMBMessage(mbMessage);
      }
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn("Search index is stale and contains entry {" + entryClassPK + "}");
      }
    }
  }
  return searchResults;
}
