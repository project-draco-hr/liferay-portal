{
  if (errorTemplateResource == null) {
    try {
      processTemplate(templateResource,writer);
      return;
    }
 catch (    Exception e) {
      throw new TemplateException("Unable to process template " + templateResource.getTemplateId(),e);
    }
  }
  Writer oldWriter=(Writer)get(TemplateConstants.WRITER);
  try {
    UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
    put(TemplateConstants.WRITER,unsyncStringWriter);
    processTemplate(templateResource,unsyncStringWriter);
    StringBundler sb=unsyncStringWriter.getStringBundler();
    sb.writeTo(writer);
  }
 catch (  Exception e) {
    put(TemplateConstants.WRITER,writer);
    handleException(e,writer);
  }
 finally {
    put(TemplateConstants.WRITER,oldWriter);
  }
}
