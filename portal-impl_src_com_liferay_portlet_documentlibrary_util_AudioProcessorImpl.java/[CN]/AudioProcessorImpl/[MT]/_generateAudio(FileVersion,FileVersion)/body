{
  String tempFileId=DLUtil.getTempFileId(destinationFileVersion.getFileEntryId(),destinationFileVersion.getVersion());
  File[] previewTempFiles=new File[_PREVIEW_TYPES.length];
  for (int i=0; i < _PREVIEW_TYPES.length; i++) {
    previewTempFiles[i]=getPreviewTempFile(tempFileId,_PREVIEW_TYPES[i]);
  }
  File audioTempFile=null;
  InputStream inputStream=null;
  try {
    if (sourceFileVersion != null) {
      copy(sourceFileVersion,destinationFileVersion);
      return;
    }
    if (!XugglerUtil.isEnabled() || _hasAudio(destinationFileVersion)) {
      return;
    }
    audioTempFile=FileUtil.createTempFile(destinationFileVersion.getExtension());
    if (!hasPreviews(destinationFileVersion)) {
      File file=null;
      if (destinationFileVersion instanceof LiferayFileVersion) {
        try {
          LiferayFileVersion liferayFileVersion=(LiferayFileVersion)destinationFileVersion;
          file=liferayFileVersion.getFile(false);
        }
 catch (        UnsupportedOperationException uoe) {
        }
      }
      if (file == null) {
        inputStream=destinationFileVersion.getContentStream(false);
        FileUtil.write(audioTempFile,inputStream);
        file=audioTempFile;
      }
      try {
        _generateAudioXuggler(destinationFileVersion,file,previewTempFiles);
      }
 catch (      Exception e) {
        _log.error(e,e);
      }
    }
  }
 catch (  NoSuchFileEntryException nsfee) {
    if (_log.isDebugEnabled()) {
      _log.debug(nsfee,nsfee);
    }
  }
 finally {
    StreamUtil.cleanUp(inputStream);
    _fileVersionIds.remove(destinationFileVersion.getFileVersionId());
    for (int i=0; i < previewTempFiles.length; i++) {
      FileUtil.delete(previewTempFiles[i]);
    }
    FileUtil.delete(audioTempFile);
  }
}
