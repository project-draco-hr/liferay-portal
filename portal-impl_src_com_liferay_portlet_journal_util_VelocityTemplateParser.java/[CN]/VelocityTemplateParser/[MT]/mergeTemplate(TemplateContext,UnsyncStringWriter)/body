{
  VelocityContext velocityContext=(VelocityContext)templateContext;
  try {
    return VelocityEngineUtil.mergeTemplate(getTemplateId(),getScript(),velocityContext,unsyncStringWriter);
  }
 catch (  VelocityException ve) {
    String errorTemplateId=getErrorTemplateId();
    String errorTemplateContent=getErrorTemplateContent();
    velocityContext.put("exception",ve.getMessage());
    velocityContext.put("script",getScript());
    if (ve instanceof ParseErrorException) {
      ParseErrorException pee=(ParseErrorException)ve;
      velocityContext.put("column",pee.getColumnNumber());
      velocityContext.put("line",pee.getLineNumber());
    }
    unsyncStringWriter.reset();
    return VelocityEngineUtil.mergeTemplate(errorTemplateId,errorTemplateContent,velocityContext,unsyncStringWriter);
  }
}
