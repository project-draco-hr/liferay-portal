{
  try {
    V output=null;
    if (outputConsumer != null) {
      InputStream is=process.getInputStream();
      try {
        output=outputConsumer.consumeOutput(is);
      }
 catch (      Exception e) {
        process.destroy();
        throw new ProcessException(e);
      }
    }
    try {
      int exitCode=process.waitFor();
      if (exitCode != 0) {
        _log.warn("Subprocess terminated with exit code " + exitCode);
      }
    }
 catch (    InterruptedException ie) {
      process.destroy();
      _log.warn("Forcibly killed subprocess on interruption",ie);
    }
    return output;
  }
  finally {
    _managedProcesses.remove(process);
    try {
      process.getInputStream().close();
      process.getOutputStream().close();
      process.getErrorStream().close();
    }
 catch (    Exception ignored) {
    }
  }
}
