{
  ThemeDisplay themeDisplay=(ThemeDisplay)renderRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long nodeId=ParamUtil.getLong(renderRequest,"nodeId");
  String title=ParamUtil.getString(renderRequest,"title");
  double sourceVersion=ParamUtil.getDouble(renderRequest,"sourceVersion");
  double targetVersion=ParamUtil.getDouble(renderRequest,"targetVersion");
  WikiPage sourcePage=WikiPageServiceUtil.getPage(nodeId,title,sourceVersion);
  WikiPage targetPage=WikiPageServiceUtil.getPage(nodeId,title,targetVersion);
  WikiNode sourceNode=sourcePage.getNode();
  PortletURL viewPageURL=renderResponse.createRenderURL();
  viewPageURL.setParameter("struts_action","/wiki/view");
  viewPageURL.setParameter("nodeName",sourceNode.getName());
  PortletURL editPageURL=renderResponse.createRenderURL();
  editPageURL.setParameter("struts_action","/wiki/edit_page");
  editPageURL.setParameter("nodeId",String.valueOf(nodeId));
  editPageURL.setParameter("title",title);
  String attachmentURLPrefix=WikiUtil.getAttachmentURLPrefix(themeDisplay.getPathMain(),themeDisplay.getPlid(),nodeId,title);
  String htmlDiffResult=WikiUtil.diffHtml(sourcePage,targetPage,viewPageURL,editPageURL,attachmentURLPrefix);
  renderRequest.setAttribute(WebKeys.DIFF_HTML_RESULTS,htmlDiffResult);
  renderRequest.setAttribute(WebKeys.WIKI_NODE_ID,nodeId);
  renderRequest.setAttribute(WebKeys.TITLE,title);
  renderRequest.setAttribute(WebKeys.SOURCE_VERSION,sourceVersion);
  renderRequest.setAttribute(WebKeys.TARGET_VERSION,targetVersion);
}
