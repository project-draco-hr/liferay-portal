{
  Document doc=SAXReaderUtil.createDocument();
  doc.setXMLEncoding(StringPool.UTF8);
  Element root=doc.addElement("plugin-repository");
  Element settingsEl=root.addElement("settings");
  populateSettingsElement(settingsEl,repoSettings);
  List<SCProductEntry> productEntries=scProductEntryPersistence.findByGroupId(groupId);
  for (  SCProductEntry productEntry : productEntries) {
    if (Validator.isNull(productEntry.getRepoGroupId()) || Validator.isNull(productEntry.getRepoArtifactId())) {
      continue;
    }
    List<SCProductVersion> productVersions=scProductVersionPersistence.findByProductEntryId(productEntry.getProductEntryId());
    for (int i=0; i < productVersions.size(); i++) {
      SCProductVersion productVersion=productVersions.get(i);
      if ((maxNumOfVersions > 0) && (maxNumOfVersions < (i + 1))) {
        break;
      }
      if (!productVersion.isRepoStoreArtifact()) {
        continue;
      }
      if ((oldestDate != null) && oldestDate.after(productVersion.getModifiedDate())) {
        continue;
      }
      if (Validator.isNotNull(version) && !isVersionSupported(version,productVersion.getFrameworkVersions())) {
        continue;
      }
      Element el=root.addElement("plugin-package");
      populatePluginPackageElement(el,productEntry,productVersion,baseImageURL);
    }
  }
  return doc.asXML();
}
