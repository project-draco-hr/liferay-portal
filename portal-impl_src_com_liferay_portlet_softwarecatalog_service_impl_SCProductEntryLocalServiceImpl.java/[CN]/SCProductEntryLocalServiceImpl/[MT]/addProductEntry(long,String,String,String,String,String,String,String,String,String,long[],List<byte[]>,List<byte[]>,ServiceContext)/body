{
  User user=userPersistence.findByPrimaryKey(userId);
  long groupId=serviceContext.getScopeGroupId();
  tags=getTags(tags);
  repoGroupId=repoGroupId.trim().toLowerCase();
  repoArtifactId=repoArtifactId.trim().toLowerCase();
  Date now=new Date();
  validate(0,name,type,shortDescription,pageURL,author,repoGroupId,repoArtifactId,licenseIds,thumbnails,fullImages);
  long productEntryId=counterLocalService.increment();
  SCProductEntry productEntry=scProductEntryPersistence.create(productEntryId);
  productEntry.setGroupId(groupId);
  productEntry.setCompanyId(user.getCompanyId());
  productEntry.setUserId(user.getUserId());
  productEntry.setUserName(user.getFullName());
  productEntry.setCreateDate(now);
  productEntry.setModifiedDate(now);
  productEntry.setName(name);
  productEntry.setType(type);
  productEntry.setTags(tags);
  productEntry.setShortDescription(shortDescription);
  productEntry.setLongDescription(longDescription);
  productEntry.setPageURL(pageURL);
  productEntry.setAuthor(author);
  productEntry.setRepoGroupId(repoGroupId);
  productEntry.setRepoArtifactId(repoArtifactId);
  scProductEntryPersistence.update(productEntry,false);
  if (serviceContext.getAddCommunityPermissions() || serviceContext.getAddGuestPermissions()) {
    addProductEntryResources(productEntry,serviceContext.getAddCommunityPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addProductEntryResources(productEntry,serviceContext.getCommunityPermissions(),serviceContext.getGuestPermissions());
  }
  ExpandoBridge expandoBridge=productEntry.getExpandoBridge();
  expandoBridge.setAttributes(serviceContext);
  scProductEntryPersistence.setSCLicenses(productEntryId,licenseIds);
  saveProductScreenshots(productEntry,thumbnails,fullImages);
  try {
    Indexer.addProductEntry(productEntry.getCompanyId(),groupId,userId,user.getFullName(),productEntryId,name,now,StringPool.BLANK,type,shortDescription,longDescription,pageURL,repoGroupId,repoArtifactId,productEntry.getExpandoBridge());
  }
 catch (  SearchException se) {
    _log.error("Indexing " + productEntryId,se);
  }
  return productEntry;
}
