{
  if (portalCache instanceof LowLevelCache) {
    return new MVCCPortalCache<>((LowLevelCache<K,MVCCModel>)portalCache);
  }
  PortalCache<K,?> currentPortalCache=portalCache;
  while (currentPortalCache instanceof PortalCacheWrapper) {
    PortalCacheWrapper<K,MVCCModel> portalCacheWrapper=(PortalCacheWrapper<K,MVCCModel>)currentPortalCache;
    PortalCache<K,MVCCModel> nextPortalCache=portalCacheWrapper.getWrappedPortalCache();
    if (nextPortalCache instanceof LowLevelCache) {
      nextPortalCache=new MVCCPortalCache<>((LowLevelCache<K,MVCCModel>)nextPortalCache);
      portalCacheWrapper.setPortalCache(nextPortalCache);
      break;
    }
 else {
      currentPortalCache=nextPortalCache;
    }
  }
  return portalCache;
}
