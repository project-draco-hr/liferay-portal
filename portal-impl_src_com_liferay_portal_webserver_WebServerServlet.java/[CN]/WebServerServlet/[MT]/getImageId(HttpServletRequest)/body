{
  long imageId=ParamUtil.getLong(request,"image_id");
  if (imageId <= 0) {
    imageId=ParamUtil.getLong(request,"img_id");
  }
  if (imageId <= 0) {
    imageId=ParamUtil.getLong(request,"i_id");
  }
  User user=null;
  if (imageId <= 0) {
    long companyId=ParamUtil.getLong(request,"companyId");
    String screenName=ParamUtil.getString(request,"screenName");
    if ((companyId > 0) && Validator.isNotNull(screenName)) {
      user=UserLocalServiceUtil.fetchUserByScreenName(companyId,screenName);
      if (user != null) {
        imageId=user.getPortraitId();
      }
    }
  }
  if (PropsValues.USERS_IMAGE_PORTRAIT_ENUMERATION_CHECK && (imageId > 0)) {
    String uipec=ParamUtil.get(request,"uipec",StringPool.BLANK);
    if (user == null) {
      user=UserLocalServiceUtil.fetchUserByPortraitId(imageId);
    }
    String uuidDigest=DigesterUtil.digest(user.getUserUuid());
    if (!uipec.equals(uuidDigest)) {
      return 0;
    }
  }
  return imageId;
}
