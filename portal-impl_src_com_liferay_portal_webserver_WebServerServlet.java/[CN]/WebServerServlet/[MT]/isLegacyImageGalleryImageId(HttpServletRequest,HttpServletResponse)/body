{
  try {
    long imageId=getImageId(request);
    if (imageId == 0) {
      return false;
    }
    Repository repository=RepositoryProviderUtil.getImageRepository(imageId);
    if (!repository.isCapabilityProvided(ThumbnailCapability.class)) {
      return false;
    }
    ThumbnailCapability thumbnailCapability=repository.getCapability(ThumbnailCapability.class);
    FileEntry fileEntry=thumbnailCapability.fetchFileEntryByImageId(imageId);
    if (fileEntry == null) {
      return false;
    }
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    String queryString=StringPool.BLANK;
    if (imageId == thumbnailCapability.getSmallImageId(fileEntry)) {
      queryString="&imageThumbnail=1";
    }
 else     if (imageId == thumbnailCapability.getCustom1ImageId(fileEntry)) {
      queryString="&imageThumbnail=2";
    }
 else     if (imageId == thumbnailCapability.getCustom2ImageId(fileEntry)) {
      queryString="&imageThumbnail=3";
    }
    FileVersion fileVersion=fileEntry.getFileVersion();
    if (PropsValues.DL_FILE_ENTRY_IG_THUMBNAIL_GENERATION && Validator.isNotNull(queryString)) {
      ImageProcessorUtil.hasImages(fileVersion);
    }
    String url=DLUtil.getPreviewURL(fileEntry,fileVersion,themeDisplay,queryString);
    response.setHeader(HttpHeaders.LOCATION,url);
    response.setStatus(HttpServletResponse.SC_MOVED_PERMANENTLY);
    return true;
  }
 catch (  Exception e) {
  }
  return false;
}
