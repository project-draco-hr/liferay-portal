{
  try {
    long imageId=getImageId(request);
    if (imageId == 0) {
      return false;
    }
    DLFileEntry dlFileEntry=DLFileEntryServiceUtil.fetchFileEntryByImageId(imageId);
    if (dlFileEntry == null) {
      return false;
    }
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    String queryString=StringPool.BLANK;
    if (imageId == dlFileEntry.getSmallImageId()) {
      queryString="&imageThumbnail=1";
    }
 else     if (imageId == dlFileEntry.getCustom1ImageId()) {
      queryString="&imageThumbnail=2";
    }
 else     if (imageId == dlFileEntry.getCustom2ImageId()) {
      queryString="&imageThumbnail=3";
    }
    LiferayFileEntry fileEntry=new LiferayFileEntry(dlFileEntry);
    LiferayFileVersion fileVersion=new LiferayFileVersion(dlFileEntry.getFileVersion());
    if (PropsValues.DL_FILE_ENTRY_THUMBNAIL_LEGACY_GENERATION && Validator.isNotNull(queryString)) {
      ImageProcessorUtil.hasImages(fileVersion);
    }
    String url=DLUtil.getPreviewURL(fileEntry,fileVersion,themeDisplay,queryString);
    response.setHeader(HttpHeaders.LOCATION,url);
    response.setStatus(HttpServletResponse.SC_MOVED_PERMANENTLY);
    return true;
  }
 catch (  Exception e) {
  }
  return false;
}
