{
  try {
    long imageId=getImageId(request);
    if (imageId == 0) {
      return false;
    }
    DLFileEntry dlFileEntry=DLFileEntryServiceUtil.fetchFileEntryByImageId(imageId);
    if (dlFileEntry == null) {
      return false;
    }
    StringBundler sb=new StringBundler(9);
    sb.append("/documents/");
    sb.append(dlFileEntry.getGroupId());
    sb.append(StringPool.SLASH);
    sb.append(dlFileEntry.getFolderId());
    sb.append(StringPool.SLASH);
    sb.append(HttpUtil.encodeURL(HtmlUtil.unescape(dlFileEntry.getTitle())));
    sb.append("?version=");
    sb.append(dlFileEntry.getVersion());
    if (imageId == dlFileEntry.getSmallImageId()) {
      sb.append("&imageThumbnail=1");
    }
 else     if (imageId == dlFileEntry.getSmallImageId()) {
      sb.append("&imageThumbnail=2");
    }
 else     if (imageId == dlFileEntry.getSmallImageId()) {
      sb.append("&imageThumbnail=3");
    }
    response.setHeader(HttpHeaders.LOCATION,sb.toString());
    response.setStatus(HttpServletResponse.SC_MOVED_PERMANENTLY);
    return true;
  }
 catch (  Exception e) {
  }
  return false;
}
