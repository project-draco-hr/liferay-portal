{
  try {
    long imageId=getImageId(request);
    if (imageId == 0) {
      return false;
    }
    DLFileEntry dlFileEntry=DLFileEntryServiceUtil.fetchFileEntryByImageId(imageId);
    if (dlFileEntry == null) {
      return false;
    }
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    String queryString=StringPool.BLANK;
    if (imageId == dlFileEntry.getSmallImageId()) {
      queryString="&imageThumbnail=1";
    }
 else     if (imageId == dlFileEntry.getSmallImageId()) {
      queryString="&imageThumbnail=2";
    }
 else     if (imageId == dlFileEntry.getSmallImageId()) {
      queryString="&imageThumbnail=3";
    }
    String url=DLUtil.getPreviewURL(new LiferayFileEntry(dlFileEntry),new LiferayFileVersion(dlFileEntry.getFileVersion()),themeDisplay,queryString,true,true);
    response.setHeader(HttpHeaders.LOCATION,url);
    response.setStatus(HttpServletResponse.SC_MOVED_PERMANENTLY);
    return true;
  }
 catch (  Exception e) {
  }
  return false;
}
