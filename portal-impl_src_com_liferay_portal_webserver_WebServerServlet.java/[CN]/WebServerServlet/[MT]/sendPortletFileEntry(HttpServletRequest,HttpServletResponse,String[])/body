{
  FileEntry fileEntry=getPortletFileEntry(request,pathArray);
  if (fileEntry == null) {
    return;
  }
  String fileName=HttpUtil.decodeURL(HtmlUtil.escape(pathArray[2]));
  if (fileEntry.isInTrash()) {
    fileName=TrashUtil.getOriginalTitle(fileName);
  }
  boolean download=ParamUtil.getBoolean(request,"download");
  if (download) {
    ServletResponseUtil.sendFile(request,response,fileName,fileEntry.getContentStream(),fileEntry.getSize(),fileEntry.getMimeType(),HttpHeaders.CONTENT_DISPOSITION_ATTACHMENT);
  }
 else {
    ServletResponseUtil.sendFile(request,response,fileName,fileEntry.getContentStream(),fileEntry.getSize(),fileEntry.getMimeType());
  }
}
