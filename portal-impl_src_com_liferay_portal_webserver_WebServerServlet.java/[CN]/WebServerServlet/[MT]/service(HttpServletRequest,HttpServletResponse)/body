{
  try {
    User user=initPrincipal(request);
    String path=HttpUtil.fixPath(request.getPathInfo());
    String[] pathArray=StringUtil.split(path,StringPool.SLASH);
    if (pathArray.length == 0) {
      sendGroups(response,user,request.getServletPath() + StringPool.SLASH + path);
    }
 else {
      if (Validator.isNumber(pathArray[0])) {
        sendFile(request,response,user,pathArray);
      }
 else {
        sendDocumentLibrary(request,response,user,request.getServletPath() + StringPool.SLASH + path,pathArray);
      }
    }
  }
 catch (  NoSuchFileEntryException nsfee) {
    PortalUtil.sendError(HttpServletResponse.SC_NOT_FOUND,nsfee,request,response);
  }
catch (  Exception e) {
    PortalUtil.sendError(e,request,response);
  }
}
