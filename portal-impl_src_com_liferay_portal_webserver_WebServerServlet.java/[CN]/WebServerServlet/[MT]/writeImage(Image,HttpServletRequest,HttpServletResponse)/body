{
  if (image == null) {
    return;
  }
  String contentType=null;
  String type=image.getType();
  if (!type.equals(ImageConstants.TYPE_NOT_AVAILABLE)) {
    contentType=MimeTypesUtil.getContentType(type);
    response.setContentType(contentType);
  }
  String fileName=ParamUtil.getString(request,"fileName");
  try {
    byte[] bytes=getImageBytes(request,image);
    if (Validator.isNotNull(fileName)) {
      ServletResponseUtil.sendFile(request,response,fileName,bytes,contentType);
    }
 else {
      ServletResponseUtil.write(response,bytes);
    }
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(e,e);
    }
  }
}
