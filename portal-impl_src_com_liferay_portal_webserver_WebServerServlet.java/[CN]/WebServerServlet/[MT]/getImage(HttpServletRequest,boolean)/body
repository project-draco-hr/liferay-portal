{
  Image image=null;
  long imageId=getImageId(request);
  if (imageId > 0) {
    String path=GetterUtil.getString(request.getPathInfo());
    if (path.startsWith("/user_female_portrait") || path.startsWith("/user_male_portrait") || path.startsWith("/user_portrait")) {
      image=ImageServiceUtil.getImage(imageId);
      image=getUserPortraitImageResized(image,imageId);
    }
  }
 else {
    String uuid=ParamUtil.getString(request,"uuid");
    long groupId=ParamUtil.getLong(request,"groupId");
    boolean smallImage=ParamUtil.getBoolean(request,"igSmallImage");
    if (Validator.isNotNull(uuid) && (groupId > 0)) {
      try {
        FileEntry fileEntry=DLAppServiceUtil.getFileEntryByUuidAndGroupId(uuid,groupId);
        image=convertFileEntry(smallImage,fileEntry);
      }
 catch (      Exception e) {
      }
    }
  }
  if (getDefault) {
    if (image == null) {
      if (_log.isWarnEnabled()) {
        _log.warn("Get a default image for " + imageId);
      }
      image=getDefaultImage(request,imageId);
    }
  }
  return image;
}
