{
  BackgroundTaskExecutor backgroundTaskExecutor=getBackgroundTaskExecutor(backgroundTask);
  if (classLoader != null) {
    backgroundTaskExecutor=new ClassLoaderAwareBackgroundTaskExecutor(backgroundTaskExecutor,classLoader);
  }
  if (backgroundTaskExecutor.isSerial()) {
    backgroundTaskExecutor=new SerialBackgroundTaskExecutor(backgroundTaskExecutor);
  }
  backgroundTaskExecutor=new ThreadLocalAwareBackgroundTaskExecutor(backgroundTaskExecutor,_backgroundTaskThreadLocalManager);
  return backgroundTaskExecutor;
}
