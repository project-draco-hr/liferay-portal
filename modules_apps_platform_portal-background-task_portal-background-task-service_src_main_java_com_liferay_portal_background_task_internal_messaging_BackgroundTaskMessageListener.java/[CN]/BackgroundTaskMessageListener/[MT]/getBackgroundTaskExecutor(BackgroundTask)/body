{
  BackgroundTaskExecutor backgroundTaskExecutor=null;
  String servletContextNames=backgroundTask.getServletContextNames();
  if (Validator.isNull(servletContextNames)) {
    backgroundTaskExecutor=_backgroundTaskExecutorRegistry.getBackgroundTaskExecutor(backgroundTask.getTaskExecutorClassName());
    backgroundTaskExecutor=backgroundTaskExecutor.clone();
  }
 else {
    ClassLoader classLoader=ClassLoaderUtil.getPortalClassLoader();
    if (Validator.isNotNull(servletContextNames)) {
      classLoader=ClassLoaderUtil.getAggregatePluginsClassLoader(StringUtil.split(servletContextNames),false);
    }
    try {
      backgroundTaskExecutor=(BackgroundTaskExecutor)InstanceFactory.newInstance(classLoader,backgroundTask.getTaskExecutorClassName());
    }
 catch (    Exception e) {
      if (_log.isDebugEnabled()) {
        _log.debug("Unable to create new background task executor",e);
      }
    }
  }
  return backgroundTaskExecutor;
}
