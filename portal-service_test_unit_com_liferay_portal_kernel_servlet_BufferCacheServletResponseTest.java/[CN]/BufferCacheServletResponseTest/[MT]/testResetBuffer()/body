{
  StubHttpServletResponse stubHttpServletResponse=new StubHttpServletResponse();
  BufferCacheServletResponse bufferCacheServletResponse=new BufferCacheServletResponse(stubHttpServletResponse);
  ByteBuffer byteBuffer=ByteBuffer.wrap(_TEST_BYTES);
  bufferCacheServletResponse.setByteBuffer(byteBuffer);
  Assert.assertSame(byteBuffer,bufferCacheServletResponse.getByteBuffer());
  bufferCacheServletResponse.resetBuffer(true);
  ByteBuffer newByteBuffer=bufferCacheServletResponse.getByteBuffer();
  Assert.assertNotSame(byteBuffer,newByteBuffer);
  Assert.assertEquals(0,newByteBuffer.capacity());
  bufferCacheServletResponse=new BufferCacheServletResponse(stubHttpServletResponse);
  CharBuffer charBuffer=CharBuffer.wrap(_TEST_STRING);
  bufferCacheServletResponse.setCharBuffer(charBuffer);
  Assert.assertSame(charBuffer,bufferCacheServletResponse.getCharBuffer());
  bufferCacheServletResponse.resetBuffer(true);
  CharBuffer newCharBuffer=bufferCacheServletResponse.getCharBuffer();
  Assert.assertNotSame(charBuffer,newCharBuffer);
  Assert.assertEquals(0,newCharBuffer.capacity());
  bufferCacheServletResponse=new BufferCacheServletResponse(stubHttpServletResponse);
  ServletOutputStream servletOutputStream=bufferCacheServletResponse.getOutputStream();
  Assert.assertSame(servletOutputStream,bufferCacheServletResponse.getOutputStream());
  Assert.assertTrue(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertFalse(bufferCacheServletResponse.calledGetWriter);
  bufferCacheServletResponse.resetBuffer(true);
  Assert.assertFalse(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertFalse(bufferCacheServletResponse.calledGetWriter);
  Assert.assertNotSame(servletOutputStream,bufferCacheServletResponse.getOutputStream());
  Assert.assertTrue(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertFalse(bufferCacheServletResponse.calledGetWriter);
  bufferCacheServletResponse=new BufferCacheServletResponse(stubHttpServletResponse);
  PrintWriter printWriter=bufferCacheServletResponse.getWriter();
  Assert.assertSame(printWriter,bufferCacheServletResponse.getWriter());
  Assert.assertFalse(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertTrue(bufferCacheServletResponse.calledGetWriter);
  bufferCacheServletResponse.resetBuffer(true);
  Assert.assertFalse(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertFalse(bufferCacheServletResponse.calledGetWriter);
  Assert.assertNotSame(printWriter,bufferCacheServletResponse.getWriter());
  Assert.assertFalse(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertTrue(bufferCacheServletResponse.calledGetWriter);
  bufferCacheServletResponse=new BufferCacheServletResponse(stubHttpServletResponse);
  byteBuffer=ByteBuffer.wrap(_TEST_BYTES);
  bufferCacheServletResponse.setByteBuffer(byteBuffer);
  Assert.assertSame(byteBuffer,bufferCacheServletResponse.getByteBuffer());
  bufferCacheServletResponse.resetBuffer(false);
  newByteBuffer=bufferCacheServletResponse.getByteBuffer();
  Assert.assertNotSame(byteBuffer,newByteBuffer);
  Assert.assertEquals(0,newByteBuffer.capacity());
  bufferCacheServletResponse=new BufferCacheServletResponse(stubHttpServletResponse);
  charBuffer=CharBuffer.wrap(_TEST_STRING);
  bufferCacheServletResponse.setCharBuffer(charBuffer);
  Assert.assertSame(charBuffer,bufferCacheServletResponse.getCharBuffer());
  bufferCacheServletResponse.resetBuffer(false);
  newCharBuffer=bufferCacheServletResponse.getCharBuffer();
  Assert.assertNotSame(charBuffer,newCharBuffer);
  Assert.assertEquals(0,newCharBuffer.capacity());
  bufferCacheServletResponse=new BufferCacheServletResponse(stubHttpServletResponse);
  servletOutputStream=bufferCacheServletResponse.getOutputStream();
  Assert.assertSame(servletOutputStream,bufferCacheServletResponse.getOutputStream());
  Assert.assertTrue(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertFalse(bufferCacheServletResponse.calledGetWriter);
  servletOutputStream.write(_TEST_BYTES);
  byteBuffer=bufferCacheServletResponse.getByteBuffer();
  Assert.assertEquals(ByteBuffer.wrap(_TEST_BYTES),byteBuffer);
  bufferCacheServletResponse.resetBuffer(false);
  Assert.assertSame(servletOutputStream,bufferCacheServletResponse.getOutputStream());
  Assert.assertTrue(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertFalse(bufferCacheServletResponse.calledGetWriter);
  byteBuffer=bufferCacheServletResponse.getByteBuffer();
  Assert.assertEquals(0,byteBuffer.limit());
  bufferCacheServletResponse=new BufferCacheServletResponse(stubHttpServletResponse);
  printWriter=bufferCacheServletResponse.getWriter();
  Assert.assertSame(printWriter,bufferCacheServletResponse.getWriter());
  Assert.assertFalse(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertTrue(bufferCacheServletResponse.calledGetWriter);
  printWriter.write(_TEST_STRING);
  charBuffer=bufferCacheServletResponse.getCharBuffer();
  Assert.assertEquals(_TEST_STRING,charBuffer.toString());
  bufferCacheServletResponse.resetBuffer(false);
  Assert.assertSame(printWriter,bufferCacheServletResponse.getWriter());
  Assert.assertFalse(bufferCacheServletResponse.calledGetOutputStream);
  Assert.assertTrue(bufferCacheServletResponse.calledGetWriter);
  charBuffer=bufferCacheServletResponse.getCharBuffer();
  Assert.assertEquals(0,charBuffer.limit());
}
