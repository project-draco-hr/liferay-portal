{
  try {
    _outputDir=outputDir;
    _dbType=dbType;
    _maxBlogsEntryCommentCount=maxBlogsEntryCommentCount;
    _maxBlogsEntryCount=maxBlogsEntryCount;
    _maxGroupCount=maxGroupCount;
    _maxMBCategoryCount=maxMBCategoryCount;
    _maxMBMessageCount=maxMBMessageCount;
    _maxMBThreadCount=maxMBThreadCount;
    _maxUserCount=maxUserCount;
    _maxUserToGroupCount=maxUserToGroupCount;
    _maxWikiNodeCount=maxWikiNodeCount;
    _maxWikiPageCommentCount=maxWikiPageCommentCount;
    _maxWikiPageCount=maxWikiPageCount;
    _securityEnabled=securityEnabled;
    int totalMThreadCount=maxMBCategoryCount * maxMBThreadCount;
    int totalMBMessageCount=totalMThreadCount * maxMBMessageCount;
    int counterOffset=_maxGroupCount + (_maxGroupCount * (maxMBCategoryCount + totalMThreadCount + totalMBMessageCount)) + 1;
    _counter=new SimpleCounter(counterOffset);
    _permissionCounter=new SimpleCounter();
    _resourceCounter=new SimpleCounter();
    _resourceCodeCounter=new SimpleCounter();
    _userScreenNameIncrementer=new SimpleCounter();
    _dataFactory=new DataFactory(baseDir,_maxGroupCount,_maxUserToGroupCount,_counter,_permissionCounter,_resourceCounter,_resourceCodeCounter);
    final CharPipe charPipe=new CharPipe(1024 * 1024 * 10);
    Reader pipeReader=charPipe.getReader();
    final Writer pipeWriter=charPipe.getWriter();
    Thread genericWriterThread=new Thread(){
      public void run(){
        try {
          _writerGeneric=new UnsyncTeeWriter(pipeWriter,new FileWriter(_outputDir + "/sample.sql"));
          createSample();
          _writerGeneric.close();
          charPipe.close();
        }
 catch (        Exception e) {
          e.printStackTrace();
        }
      }
    }
;
    genericWriterThread.start();
    Writer writerSpecific=new FileWriter(_outputDir + "/sample-" + dbType+ ".sql");
    DB specificDB=DBFactoryUtil.getDB(_dbType);
    boolean previousBlankLine=false;
    UnsyncBufferedReader unsyncBufferedReader=new UnsyncBufferedReader(pipeReader);
    String s=null;
    while ((s=unsyncBufferedReader.readLine()) != null) {
      s=specificDB.buildSQL(s).trim();
      writerSpecific.write(s);
      if (previousBlankLine && Validator.isNull(s)) {
      }
 else {
        writerSpecific.write(StringPool.NEW_LINE);
      }
      if (Validator.isNull(s)) {
        previousBlankLine=true;
      }
    }
    unsyncBufferedReader.close();
    writerSpecific.close();
    genericWriterThread.join();
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
