{
  long messageId=_counter.get();
  String uuid=PortalUUIDUtil.generate();
  Map<String,Object> context=getContext();
  put(context,"body",body);
  put(context,"categoryId",categoryId);
  put(context,"messageId",messageId);
  put(context,"subject",subject);
  put(context,"threadId",threadId);
  put(context,"userId",userId);
  put(context,"uuid",uuid);
  processTemplate(_tplMBMessage,context);
  return messageId;
}
