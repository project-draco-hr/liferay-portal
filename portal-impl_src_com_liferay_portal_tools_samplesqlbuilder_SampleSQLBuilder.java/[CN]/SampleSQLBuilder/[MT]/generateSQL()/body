{
  final CharPipe charPipe=new CharPipe(_PIPE_BUFFER_SIZE);
  Thread thread=new Thread(){
    @Override public void run(){
      try {
        Writer sampleSQLWriter=new UnsyncTeeWriter(createUnsyncBufferedWriter(charPipe.getWriter()),createFileWriter(new File(_outputDir,"sample.sql")));
        Map<String,Object> context=getContext();
        FreeMarkerUtil.process(_script,context,sampleSQLWriter);
        for (        String csvFileName : _csvFileNames) {
          Writer csvWriter=(Writer)context.get(csvFileName + "CSVWriter");
          csvWriter.close();
        }
        sampleSQLWriter.close();
        charPipe.close();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
;
  thread.start();
  return charPipe.getReader();
}
