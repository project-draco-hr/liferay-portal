{
  UserResolver userResolver=new UserResolver(request);
  CompanyThreadLocal.setCompanyId(userResolver.getCompanyId());
  request.setAttribute("companyId",userResolver.getCompanyId());
  User user=userResolver.getUser();
  if (user != null) {
    PermissionChecker permissionChecker=PermissionCheckerFactoryUtil.create(user,true);
    PermissionThreadLocal.setPermissionChecker(permissionChecker);
    request.setAttribute("user",user);
    request.setAttribute("userId",user.getUserId());
  }
}
