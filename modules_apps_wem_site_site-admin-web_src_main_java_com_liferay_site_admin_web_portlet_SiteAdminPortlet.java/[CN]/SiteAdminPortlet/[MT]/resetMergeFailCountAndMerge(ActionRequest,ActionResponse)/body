{
  long layoutSetPrototypeId=ParamUtil.getLong(actionRequest,"layoutSetPrototypeId");
  LayoutSetPrototype layoutSetPrototype=layoutSetPrototypeService.getLayoutSetPrototype(layoutSetPrototypeId);
  SitesUtil.setMergeFailCount(layoutSetPrototype,0);
  long groupId=ParamUtil.getLong(actionRequest,"groupId");
  boolean privateLayoutSet=ParamUtil.getBoolean(actionRequest,"privateLayoutSet");
  LayoutSet layoutSet=layoutSetLocalService.getLayoutSet(groupId,privateLayoutSet);
  SitesUtil.resetPrototype(layoutSet);
  Group group=groupLocalService.getGroup(groupId);
  SitesUtil.mergeLayoutSetPrototypeLayouts(group,layoutSet);
  layoutSetPrototype=layoutSetPrototypeService.getLayoutSetPrototype(layoutSetPrototypeId);
  if (SitesUtil.getMergeFailCount(layoutSetPrototype) > 0) {
    SessionErrors.add(actionRequest,"resetMergeFailCountAndMerge");
  }
}
