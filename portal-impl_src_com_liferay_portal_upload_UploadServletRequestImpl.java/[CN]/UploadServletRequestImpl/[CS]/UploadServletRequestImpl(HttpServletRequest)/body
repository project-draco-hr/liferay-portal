{
  super(request);
  _params=new LinkedHashMap<String,LiferayFileItem[]>();
  try {
    ServletFileUpload servletFileUpload=new LiferayFileUpload(new LiferayFileItemFactory(UPLOAD_SERVLET_REQUEST_IMPL_TEMP_DIR),request);
    servletFileUpload.setSizeMax(PrefsPropsUtil.getLong(PropsKeys.UPLOAD_SERVLET_REQUEST_IMPL_MAX_SIZE));
    _lsr=new LiferayServletRequest(request);
    List<LiferayFileItem> list=servletFileUpload.parseRequest(_lsr);
    for (    LiferayFileItem fileItem : list) {
      if (fileItem.isFormField()) {
        fileItem.setString(request.getCharacterEncoding());
      }
      LiferayFileItem[] fileItems=_params.get(fileItem.getFieldName());
      if (fileItems == null) {
        fileItems=new LiferayFileItem[]{fileItem};
      }
 else {
        LiferayFileItem[] newFileItems=new LiferayFileItem[fileItems.length + 1];
        System.arraycopy(fileItems,0,newFileItems,0,fileItems.length);
        newFileItems[newFileItems.length - 1]=fileItem;
        fileItems=newFileItems;
      }
      _params.put(fileItem.getFieldName(),fileItems);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
}
