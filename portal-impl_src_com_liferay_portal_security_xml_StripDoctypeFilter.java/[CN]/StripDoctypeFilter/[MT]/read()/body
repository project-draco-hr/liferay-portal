{
  if (!bufferEmpty()) {
    return readFromBuffer();
  }
  int first=readFromSource();
  if (_documentStarted) {
    return first;
  }
  if (first == '<') {
    int[] next=new int[2];
    next[0]=readFromSource();
    next[1]=readFromSource();
    if (next[0] == '?') {
      setBuffer(next);
      return first;
    }
    if ((next[0] == '!') && (next[1] == '-')) {
      setBuffer(next);
      return first;
    }
    if ((next[0] == '!') && (next[1] == 'D')) {
      while (true) {
        int doctypeContent=readFromSource();
        if (doctypeContent == '[') {
          entityDeclaration=true;
        }
 else         if (doctypeContent == ']') {
          entityDeclaration=false;
        }
 else         if (doctypeContent == '>') {
          if (!entityDeclaration) {
            _documentStarted=true;
            return readFromSource();
          }
        }
      }
    }
    setBuffer(next);
    _documentStarted=true;
  }
  return first;
}
