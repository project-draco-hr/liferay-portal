{
  if (_bufferLength > 0) {
    return readFromBuffer();
  }
  int c=readFromSource();
  if (_documentStarted) {
    return c;
  }
  if (c == '<') {
    int[] buffer=new int[2];
    buffer[0]=readFromSource();
    buffer[1]=readFromSource();
    if (buffer[0] == '?') {
      setBuffer(buffer);
      return c;
    }
    if ((buffer[0] == '!') && (buffer[1] == '-')) {
      setBuffer(buffer);
      return c;
    }
    if ((buffer[0] == '!') && (buffer[1] == 'D')) {
      while (true) {
        int doctypeContent=readFromSource();
        if (doctypeContent == '[') {
          _entityDeclaration=true;
        }
 else         if (doctypeContent == ']') {
          _entityDeclaration=false;
        }
 else         if (doctypeContent == '>') {
          if (!_entityDeclaration) {
            _documentStarted=true;
            return readFromSource();
          }
        }
      }
    }
    setBuffer(buffer);
    _documentStarted=true;
  }
  return c;
}
