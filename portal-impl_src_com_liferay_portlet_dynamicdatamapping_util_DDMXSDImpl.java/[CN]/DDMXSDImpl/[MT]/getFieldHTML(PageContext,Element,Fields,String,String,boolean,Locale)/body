{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  String portletId=PortalUtil.getPortletId(request);
  String portletNamespace=PortalUtil.getPortletNamespace(portletId);
  Map<String,Object> freeMarkerContext=getFreeMarkerContext(element,locale);
  freeMarkerContext.put("portletNamespace",portletNamespace);
  freeMarkerContext.put("namespace",namespace);
  Map<String,Object> fieldStructure=(Map<String,Object>)freeMarkerContext.get("fieldStructure");
  if (fields != null) {
    freeMarkerContext.put("fields",fields);
    String name=element.attributeValue("name");
    Field field=fields.get(name);
    StringBuffer sb=new StringBuffer(field.getValuesSize());
    for (int i=0; i < field.getValuesSize(); i++) {
      fieldStructure.put("repeatableIndex",String.valueOf(i));
      String childrenHTML=getHTML(pageContext,element,fields,namespace,mode,readOnly,locale);
      fieldStructure.put("children",childrenHTML);
      sb.append(processFTL(pageContext,element,mode,readOnly,freeMarkerContext));
    }
    return sb.toString();
  }
  String childrenHTML=getHTML(pageContext,element,fields,namespace,mode,readOnly,locale);
  fieldStructure.put("children",childrenHTML);
  return processFTL(pageContext,element,mode,readOnly,freeMarkerContext);
}
