{
  Map<String,Object> freeMarkerContext=getFreeMarkerContext(request,response,portletNamespace,namespace,element,locale);
  freeMarkerContext.put("ignoreRepeatable",Boolean.TRUE);
  Map<String,Object> fieldStructure=(Map<String,Object>)freeMarkerContext.get("fieldStructure");
  DDMFieldsCounter ddmFieldsCounter=getFieldsCounter(request,response,null,portletNamespace,namespace);
  String name=element.attributeValue("name");
  if ((field != null) && Validator.isNotNull(field.getValue())) {
    Fields fields=new Fields();
    fields.put(field);
    freeMarkerContext.put("fields",fields);
  }
  fieldStructure.put("fieldNamespace",StringUtil.randomId());
  fieldStructure.put("valueIndex",ddmFieldsCounter.get(name));
  List<Element> dynamicElementElements=element.elements("dynamic-element");
  StringBundler sb=new StringBundler(dynamicElementElements.size());
  for (  Element dynamicElementElement : dynamicElementElements) {
    String type=dynamicElementElement.attributeValue("type");
    if (!type.equals("option")) {
      sb.append(StringPool.BLANK);
    }
 else {
      sb.append(getSimpleFieldHTML(request,response,dynamicElementElement,field,portletNamespace,namespace,mode,readOnly,locale));
    }
  }
  fieldStructure.put("children",sb.toString());
  return processFTL(request,response,element,mode,readOnly,freeMarkerContext);
}
