{
  if (!FreeMarkerEngineUtil.resourceExists(resourcePath)) {
    if (readOnly) {
      resourcePath=_TPL_DEFAULT_READ_ONLY_PATH;
    }
 else {
      resourcePath=_TPL_DEFAULT_PATH;
    }
  }
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  FreeMarkerVariablesUtil.insertVariables(freeMarkerContext,request);
  HttpServletResponse response=(HttpServletResponse)pageContext.getResponse();
  Writer writer=new UnsyncStringWriter();
  TaglibFactory portalTaglib=new TaglibFactory(pageContext.getServletContext());
  freeMarkerContext.put("PortalJspTagLibs",portalTaglib);
  ServletContextHashModel servletContextHashModel=new ServletContextHashModel((GenericServlet)pageContext.getPage(),ObjectWrapper.DEFAULT_WRAPPER);
  freeMarkerContext.put("Application",servletContextHashModel);
  HttpRequestHashModel httpRequestHashModel=new HttpRequestHashModel(request,response,ObjectWrapper.DEFAULT_WRAPPER);
  freeMarkerContext.put("Request",httpRequestHashModel);
  FreeMarkerEngineUtil.mergeTemplate(resourcePath,freeMarkerContext,writer);
  return ((UnsyncStringWriter)writer).toString();
}
