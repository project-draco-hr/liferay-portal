{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  template.prepare(request);
  HttpServletResponse response=(HttpServletResponse)pageContext.getResponse();
  Writer writer=new UnsyncStringWriter();
  ServletContext servletContext=request.getServletContext();
  TemplateHashModel portalTaglib=FreeMarkerTaglibFactoryUtil.createTaglibFactory(servletContext);
  template.put("PortalJspTagLibs",portalTaglib);
  GenericServlet genericServlet=new JSPSupportServlet(servletContext);
  ServletContextHashModel servletContextHashModel=new ServletContextHashModel(genericServlet,ObjectWrapper.DEFAULT_WRAPPER);
  template.put("Application",servletContextHashModel);
  HttpRequestHashModel httpRequestHashModel=new HttpRequestHashModel(request,response,ObjectWrapper.DEFAULT_WRAPPER);
  template.put("Request",httpRequestHashModel);
  template.processTemplate(writer);
  return writer.toString();
}
