{
  Map<String,Object> freeMarkerContext=new HashMap<String,Object>();
  Map<String,Object> fieldContext=getFieldContext(request,response,portletNamespace,namespace,dynamicElementElement,locale);
  Map<String,Object> parentFieldContext=new HashMap<String,Object>();
  Element parentElement=dynamicElementElement.getParent();
  if (parentElement != null) {
    parentFieldContext=getFieldContext(request,response,portletNamespace,namespace,parentElement,locale);
  }
  freeMarkerContext.put("fieldStructure",fieldContext);
  freeMarkerContext.put("namespace",namespace);
  freeMarkerContext.put("parentFieldStructure",parentFieldContext);
  freeMarkerContext.put("portletNamespace",portletNamespace);
  freeMarkerContext.put("requestedLanguageDir",LanguageUtil.get(locale,"lang.dir"));
  freeMarkerContext.put("requestedLocale",locale);
  return freeMarkerContext;
}
