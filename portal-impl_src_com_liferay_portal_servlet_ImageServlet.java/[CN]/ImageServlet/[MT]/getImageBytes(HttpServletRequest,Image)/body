{
  int height=ParamUtil.getInteger(request,"height",image.getHeight());
  int width=ParamUtil.getInteger(request,"width",image.getWidth());
  if ((height < image.getHeight()) || (width < image.getWidth())) {
    try {
      ImageBag imageBag=ImageProcessorUtil.read(image.getTextObj());
      RenderedImage renderedImage=imageBag.getRenderedImage();
      renderedImage=ImageProcessorUtil.scale(renderedImage,height,width);
      return ImageProcessorUtil.getBytes(renderedImage,imageBag.getType());
    }
 catch (    IOException ioe) {
      if (_log.isDebugEnabled()) {
        _log.debug("Error scaling Image: " + image.getImageId(),ioe);
      }
    }
  }
  return image.getTextObj();
}
