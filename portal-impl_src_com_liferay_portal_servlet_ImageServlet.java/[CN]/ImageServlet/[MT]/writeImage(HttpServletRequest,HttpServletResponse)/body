{
  Image image=getImage(req,true);
  if (image == null) {
    throw new NoSuchImageException("Image is null");
  }
 else {
    if (!image.getType().equals(ImageImpl.TYPE_NOT_AVAILABLE)) {
      res.setContentType("image/" + image.getType());
    }
    try {
      ServletResponseUtil.write(res,image.getTextObj());
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn(e,e);
      }
    }
  }
}
