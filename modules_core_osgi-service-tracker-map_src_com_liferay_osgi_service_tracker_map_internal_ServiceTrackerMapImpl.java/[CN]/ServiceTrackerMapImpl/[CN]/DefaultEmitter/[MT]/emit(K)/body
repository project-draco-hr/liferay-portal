{
  if ((_serviceReferenceServiceTuple == null) && !_invokedServiceTrackerCustomizer) {
    TS service=_serviceTrackerCustomizer.addingService(_serviceReference);
    _invokedServiceTrackerCustomizer=true;
    if (service == null) {
      return;
    }
    _serviceReferenceServiceTuple=new ServiceReferenceServiceTuple<>(_serviceReference,service);
  }
  storeKey(key,_serviceReferenceServiceTuple);
  if (_serviceTrackerMapListener != null) {
    try {
      ServiceTrackerBucket<SR,TS,R> serviceTrackerBucket=_serviceTrackerBuckets.get(key);
      _serviceTrackerMapListener.keyEmitted(ServiceTrackerMapImpl.this,key,_serviceReferenceServiceTuple.getService(),serviceTrackerBucket.getContent());
    }
 catch (    Throwable t) {
      _logger.log(Logger.LOG_ERROR,"Invocation to listener threw Exception: ",t);
    }
  }
}
