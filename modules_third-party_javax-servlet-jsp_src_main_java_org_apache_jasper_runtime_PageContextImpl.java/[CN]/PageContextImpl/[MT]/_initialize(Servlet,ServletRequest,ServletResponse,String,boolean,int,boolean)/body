{
  this.servlet=servlet;
  this.config=servlet.getServletConfig();
  this.context=config.getServletContext();
  this.needsSession=needsSession;
  this.errorPageURL=errorPageURL;
  this.bufferSize=bufferSize;
  this.request=request;
  this.response=response;
  if (request instanceof HttpServletRequest && needsSession)   this.session=((HttpServletRequest)request).getSession();
  if (needsSession && session == null)   throw new IllegalStateException("Page needs a session and none is available");
  depth=-1;
  if (this.baseOut == null) {
    this.baseOut=new JspWriterImpl(response,bufferSize,autoFlush);
  }
 else {
    this.baseOut.init(response,bufferSize,autoFlush);
  }
  this.out=baseOut;
  this.isNametableInitialized=false;
  setAttribute(Constants.FIRST_REQUEST_SEEN,"true",APPLICATION_SCOPE);
}
