{
  Object retValue;
  if (SecurityUtil.isPackageProtectionEnabled()) {
    try {
      retValue=AccessController.doPrivileged(new PrivilegedExceptionAction<Object>(){
        public Object run() throws Exception {
          ELContextImpl elContext=(ELContextImpl)pageContext.getELContext();
          elContext.setFunctionMapper(functionMap);
          ExpressionFactory expFactory=getExpressionFactory(pageContext);
          ValueExpression expr=expFactory.createValueExpression(elContext,expression,expectedType);
          return expr.getValue(elContext);
        }
      }
);
    }
 catch (    PrivilegedActionException ex) {
      Exception realEx=ex.getException();
      if (realEx instanceof ELException) {
        throw (ELException)realEx;
      }
 else {
        throw new ELException(realEx);
      }
    }
  }
 else {
    ELContextImpl elContext=(ELContextImpl)pageContext.getELContext();
    elContext.setFunctionMapper(functionMap);
    ExpressionFactory expFactory=getExpressionFactory(pageContext);
    ValueExpression expr=expFactory.createValueExpression(elContext,expression,expectedType);
    retValue=expr.getValue(elContext);
  }
  return retValue;
}
