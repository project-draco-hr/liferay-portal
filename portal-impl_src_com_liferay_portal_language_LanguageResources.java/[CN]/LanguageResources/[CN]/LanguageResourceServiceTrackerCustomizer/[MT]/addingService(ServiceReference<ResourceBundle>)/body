{
  Registry registry=RegistryUtil.getRegistry();
  ResourceBundle resourceBundle=registry.getService(serviceReference);
  String languageId=GetterUtil.getString(serviceReference.getProperty("language.id"),StringPool.BLANK);
  Map<String,String> languageMap=new HashMap<String,String>();
  Locale locale=null;
  if (Validator.isNotNull(languageId)) {
    locale=LocaleUtil.fromLanguageId(languageId,true);
  }
 else {
    locale=new Locale(StringPool.BLANK);
  }
  Enumeration<String> keys=resourceBundle.getKeys();
  while (keys.hasMoreElements()) {
    String key=keys.nextElement();
    String value=resourceBundle.getString(key);
    languageMap.put(key,value);
  }
  Map<String,String> oldLanguageMap=_putLanguageMap(locale,languageMap);
  _oldLanguageMaps.put(serviceReference,oldLanguageMap);
  return resourceBundle;
}
