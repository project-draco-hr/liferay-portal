{
  Registry registry=RegistryUtil.getRegistry();
  Object object=registry.getService(serviceReference);
  String languageId=GetterUtil.getString(serviceReference.getProperty("language.id"),StringPool.BLANK);
  Map<String,String> languageMap=new HashMap<String,String>();
  Locale locale=null;
  if (Validator.isNotNull(languageId)) {
    locale=LocaleUtil.fromLanguageId(languageId,true);
    for (    String key : serviceReference.getPropertyKeys()) {
      String value=GetterUtil.getString(serviceReference.getProperty(key));
      languageMap.put(key,value);
    }
  }
 else {
    locale=new Locale(StringPool.BLANK);
  }
  Map<String,String> oldLanguageMap=_putLanguageMap(locale,languageMap);
  _oldLanguageMaps.put(serviceReference,oldLanguageMap);
  return object;
}
