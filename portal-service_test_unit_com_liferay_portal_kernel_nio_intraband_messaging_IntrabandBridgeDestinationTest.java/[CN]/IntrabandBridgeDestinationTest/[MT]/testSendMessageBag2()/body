{
  MockSPI mockSPI=_createMockSPI("SPIProvider","SPI1");
  _installSPIs(mockSPI);
  _failSend=true;
  try {
    MessageRoutingBag messageRoutingBag=_createMessageRoutingBag();
    _intrabandBridgeDestination.sendMessageBag(messageRoutingBag);
    Assert.fail();
  }
 catch (  RuntimeException re) {
    Throwable throwable=re.getCause();
    Assert.assertEquals(RuntimeException.class,throwable.getClass());
    throwable=throwable.getCause();
    Assert.assertEquals(IOException.class,throwable.getClass());
  }
 finally {
    _failSend=false;
  }
  MessageRoutingBag messageRoutingBag=_createMessageRoutingBag();
  _intrabandBridgeDestination.sendMessageBag(messageRoutingBag);
  Message message=messageRoutingBag.getMessage();
  Assert.assertEquals(_RECEIVE_VALUE,message.get(_RECEIVE_KEY));
  messageRoutingBag=_createMessageRoutingBag();
  messageRoutingBag.appendRoutingId(_toRoutingId(mockSPI));
  _intrabandBridgeDestination.sendMessageBag(messageRoutingBag);
  message=messageRoutingBag.getMessage();
  Assert.assertNull(message.get(_RECEIVE_KEY));
}
