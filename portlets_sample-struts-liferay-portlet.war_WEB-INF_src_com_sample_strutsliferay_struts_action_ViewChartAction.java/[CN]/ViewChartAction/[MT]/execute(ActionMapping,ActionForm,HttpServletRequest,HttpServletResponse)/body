{
  try {
    if (_log.isInfoEnabled()) {
      _log.info("execute");
    }
    String portletName="sample_struts_liferay_portlet";
    String attrName="chart_name";
    HttpSession ses=req.getSession();
    String chartName=(String)ses.getAttribute(attrName);
    String chartType=req.getParameter("chart_type");
    CategoryDataset dataset=_getDataset();
    String xName="Soda";
    String yName="Votes";
    JFreeChart chart=null;
    if (chartType.equals("area")) {
      chart=ChartFactory.createAreaChart(chartName,xName,yName,dataset,PlotOrientation.VERTICAL,true,false,false);
    }
 else     if (chartType.equals("horizontal_bar")) {
      chart=ChartFactory.createBarChart(chartName,xName,yName,dataset,PlotOrientation.HORIZONTAL,true,false,false);
    }
 else     if (chartType.equals("line")) {
      chart=ChartFactory.createLineChart(chartName,xName,yName,dataset,PlotOrientation.VERTICAL,true,false,false);
    }
 else     if (chartType.equals("vertical_bar")) {
      chart=ChartFactory.createBarChart(chartName,xName,yName,dataset,PlotOrientation.VERTICAL,true,false,false);
    }
 else {
      PieDataset pieData=DatasetUtilities.createPieDatasetForRow(dataset,0);
      chart=ChartFactory.createPieChart(chartName,pieData,true,false,false);
    }
    res.setContentType("image/jpeg");
    OutputStream out=res.getOutputStream();
    ChartUtilities.writeChartAsJPEG(out,chart,400,400);
    return mapping.findForward("/common/null.jsp");
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    return mapping.findForward("/common/error.jsp");
  }
}
