{
  BrowserTracker browserTracker=browserTrackerPersistence.fetchByUserId(userId);
  if (browserTracker == null) {
    long browserTrackerId=counterLocalService.increment();
    browserTracker=browserTrackerPersistence.create(browserTrackerId);
    browserTracker.setUserId(userId);
  }
  browserTracker.setBrowserKey(browserKey);
  try {
    browserTrackerPersistence.update(browserTracker,false);
  }
 catch (  SystemException se) {
    if (_log.isWarnEnabled()) {
      _log.warn("Add failed, fetch {userId=" + userId + "}");
    }
    browserTracker=browserTrackerPersistence.fetchByUserId(userId,false);
    if (browserTracker == null) {
      throw se;
    }
  }
  return browserTracker;
}
