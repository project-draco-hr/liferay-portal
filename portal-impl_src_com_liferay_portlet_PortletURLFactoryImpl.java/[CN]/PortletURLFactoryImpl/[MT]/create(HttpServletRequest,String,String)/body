{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Layout layout=themeDisplay.getLayout();
  if (layout != null) {
    return getPortletURLFactory().create(request,portletId,layout,lifecycle);
  }
  return getPortletURLFactory().create(request,portletId,themeDisplay.getPlid(),lifecycle);
}
