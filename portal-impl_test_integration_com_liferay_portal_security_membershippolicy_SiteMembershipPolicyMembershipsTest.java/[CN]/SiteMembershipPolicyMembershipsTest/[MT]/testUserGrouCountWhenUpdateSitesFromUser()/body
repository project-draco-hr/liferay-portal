{
  addUsers();
  addStandardSites();
  addRequiredSites();
  User user=UserLocalServiceUtil.getUser(getUserIds()[0]);
  Assert.assertEquals(currentGroups(1),user.getGroups().size());
  long[] userGroupIds=ArrayUtil.append(getStandardSiteIds(),getRequiredSiteIds(),user.getGroupIds());
  MembershipPolicyTestUtil.updateUser(user,null,null,userGroupIds,null,Collections.<UserGroupRole>emptyList());
  Assert.assertEquals(currentGroups(5),user.getGroups().size());
  MembershipPolicyTestUtil.updateUser(user,null,null,getRequiredSiteIds(),null,Collections.<UserGroupRole>emptyList());
  Assert.assertEquals(currentGroups(2),user.getGroups().size());
}
