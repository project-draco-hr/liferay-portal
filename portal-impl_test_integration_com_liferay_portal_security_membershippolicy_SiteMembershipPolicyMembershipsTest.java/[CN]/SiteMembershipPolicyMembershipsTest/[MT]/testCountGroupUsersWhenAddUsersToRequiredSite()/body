{
  addUsers();
  addRequiredSites();
  int expectedUserGroupCountInRequiredSite=UserLocalServiceUtil.getGroupUsersCount(getRequiredSiteIds()[0]) + addedUsers(2);
  try {
    UserServiceUtil.addGroupUsers(getRequiredSiteIds()[0],getUserIds(),_getServiceContext());
  }
 catch (  Exception e) {
    if (e instanceof MembershipPolicyException) {
      Assert.fail("MembershipPolicyException was throw");
    }
 else {
      Assert.fail("Unexpected Exception throw: " + e.getClass().getName());
    }
  }
  int currentUserGroupCountInRequiredSite=UserLocalServiceUtil.getGroupUsersCount(getRequiredSiteIds()[0]);
  Assert.assertEquals(expectedUserGroupCountInRequiredSite,currentUserGroupCountInRequiredSite);
  Assert.assertTrue(getPropagateMembershipMethodFlag());
}
