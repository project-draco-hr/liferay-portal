{
  addUsers();
  addRequiredSites();
  int expectedUsersInFirstRequiredGroupCount=UserLocalServiceUtil.getGroupUsersCount(getRequiredSiteIds()[0]) + addedUsers(1);
  int expectedUsersInSecondRequiredGroupCount=UserLocalServiceUtil.getGroupUsersCount(getRequiredSiteIds()[1]) + addedUsers(1);
  User user=UserLocalServiceUtil.getUser(getUserIds()[0]);
  MembershipPolicyTestUtil.updateUser(user,null,null,getRequiredSiteIds(),null,Collections.<UserGroupRole>emptyList());
  int currentUsersInFirstRequiredGroupCount=UserLocalServiceUtil.getGroupUsersCount(getRequiredSiteIds()[0]);
  int currentUsersInSecondRequiredGroupCount=UserLocalServiceUtil.getGroupUsersCount(getRequiredSiteIds()[1]);
  Assert.assertEquals(expectedUsersInFirstRequiredGroupCount,currentUsersInFirstRequiredGroupCount);
  Assert.assertEquals(expectedUsersInSecondRequiredGroupCount,currentUsersInSecondRequiredGroupCount);
}
