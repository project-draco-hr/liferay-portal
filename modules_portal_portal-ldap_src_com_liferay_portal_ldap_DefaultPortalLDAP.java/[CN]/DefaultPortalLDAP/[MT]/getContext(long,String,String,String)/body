{
  LDAPConfiguration ldapConfiguration=_ldapConfigurationSettingsUtil.getLDAPConfiguration(companyId);
  Properties environmentProperties=new Properties();
  environmentProperties.put(Context.INITIAL_CONTEXT_FACTORY,ldapConfiguration.factoryInitial());
  environmentProperties.put(Context.PROVIDER_URL,providerURL);
  environmentProperties.put(Context.SECURITY_PRINCIPAL,principal);
  environmentProperties.put(Context.SECURITY_CREDENTIALS,credentials);
  environmentProperties.put(Context.REFERRAL,ldapConfiguration.referral());
  Properties ldapConnectionProperties=PropsUtil.getProperties(PropsKeys.LDAP_CONNECTION_PROPERTY_PREFIX,true);
  PropertiesUtil.merge(environmentProperties,ldapConnectionProperties);
  LogUtil.debug(_log,environmentProperties);
  LdapContext ldapContext=null;
  try {
    ldapContext=new InitialLdapContext(environmentProperties,null);
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn("Failed to bind to the LDAP server");
    }
    if (_log.isDebugEnabled()) {
      _log.debug(e,e);
    }
  }
  return ldapContext;
}
