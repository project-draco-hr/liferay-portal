{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  try {
    PortletPermissionUtil.check(themeDisplay.getPermissionChecker(),themeDisplay.getLayout(),themeDisplay.getPpid(),ActionKeys.CONFIGURATION);
    PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.getStrictPortletSetup(themeDisplay.getLayout(),themeDisplay.getPpid());
    if (portletPreferences instanceof StrictPortletPreferencesImpl) {
      throw new PrincipalException();
    }
    String color=ParamUtil.getString(portletRequest,"color");
    String data=ParamUtil.getString(portletRequest,"data");
    if (Validator.isNotNull(color)) {
      portletPreferences.setValue("color",color);
    }
    if (Validator.isNotNull(data)) {
      portletPreferences.setValue("data",data);
    }
    portletPreferences.store();
  }
 catch (  Exception e) {
    throw new PortletException(e);
  }
  return true;
}
