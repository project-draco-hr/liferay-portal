{
  String companyKey=null;
  try {
    Company company=CompanyLocalServiceUtil.getCompanyById(companyId);
    companyKey=company.getKey();
  }
 catch (  Exception e) {
    throw new RuntimeException("Invalid companyId " + companyId,e);
  }
  long timestamp=System.currentTimeMillis();
  String nonce=DigesterUtil.digestHex(Digester.MD5,remoteAddress,String.valueOf(timestamp),companyKey);
  _lock.writeLock().lock();
  try {
    _nonceMap.put(timestamp,nonce);
  }
  finally {
    _lock.writeLock().unlock();
  }
  return nonce;
}
