{
  org.dom4j.io.SAXReader reader=null;
  try {
    reader=new org.dom4j.io.SAXReader(xmlReader,validate);
    reader.setEntityResolver(new EntityResolver());
    reader.setFeature(_FEATURES_DYNAMIC,validate);
    reader.setFeature(_FEATURES_VALIDATION,validate);
    reader.setFeature(_FEATURES_VALIDATION_SCHEMA,validate);
    reader.setFeature(_FEATURES_VALIDATION_SCHEMA_FULL_CHECKING,validate);
    if (!secure) {
      reader.setFeature(_FEATURES_DISALLOW_DOCTYPE_DECL,false);
      reader.setFeature(_FEATURES_LOAD_DTD_GRAMMAR,validate);
      reader.setFeature(_FEATURES_LOAD_EXTERNAL_DTD,validate);
    }
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn("XSD validation is disabled because " + e.getMessage());
    }
    reader=new org.dom4j.io.SAXReader(xmlReader,false);
    reader.setEntityResolver(new EntityResolver());
  }
  return reader;
}
