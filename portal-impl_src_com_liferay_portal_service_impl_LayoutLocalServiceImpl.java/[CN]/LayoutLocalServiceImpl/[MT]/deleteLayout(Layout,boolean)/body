{
  if (layout.getParentLayoutId() == LayoutConstants.DEFAULT_PARENT_LAYOUT_ID) {
    List<Layout> layouts=layoutPersistence.findByG_P_P(layout.getGroupId(),layout.getPrivateLayout(),LayoutConstants.DEFAULT_PARENT_LAYOUT_ID,0,2);
    long firstLayoutId=layouts.get(0).getLayoutId();
    if (firstLayoutId == layout.getLayoutId()) {
      Layout secondLayout=layouts.get(1);
      try {
        validateFirstLayout(secondLayout.getType(),secondLayout.getHidden());
      }
 catch (      LayoutHiddenException lhe) {
        throw new LayoutParentLayoutIdException(LayoutParentLayoutIdException.FIRST_LAYOUT_HIDDEN);
      }
catch (      LayoutTypeException lte) {
        throw new LayoutParentLayoutIdException(LayoutParentLayoutIdException.FIRST_LAYOUT_TYPE);
      }
    }
  }
  List<Layout> childLayouts=layoutPersistence.findByG_P_P(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId());
  for (  Layout childLayout : childLayouts) {
    deleteLayout(childLayout,updateLayoutSet);
  }
  portletPreferencesLocalService.deletePortletPreferences(PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,layout.getPlid());
  tasksProposalLocalService.deleteProposal(Layout.class.getName(),String.valueOf(layout.getPlid()));
  ratingsStatsLocalService.deleteStats(Layout.class.getName(),layout.getPlid());
  mbMessageLocalService.deleteDiscussionMessages(Layout.class.getName(),layout.getPlid());
  journalContentSearchLocalService.deleteLayoutContentSearches(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId());
  expandoValueLocalService.deleteValues(Layout.class.getName(),layout.getPlid());
  imageLocalService.deleteImage(layout.getIconImageId());
  Group scopeGroup=layout.getScopeGroup();
  if (scopeGroup != null) {
    groupLocalService.deleteGroup(scopeGroup.getGroupId());
  }
  String primKey=layout.getPlid() + PortletConstants.LAYOUT_SEPARATOR + "%";
  List<Resource> resources=resourceFinder.findByC_P(layout.getCompanyId(),primKey);
  for (  Resource resource : resources) {
    resourceLocalService.deleteResource(resource);
  }
  resourceLocalService.deleteResource(layout.getCompanyId(),Layout.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,layout.getPlid());
  layoutPersistence.remove(layout);
  if (updateLayoutSet) {
    layoutSetLocalService.updatePageCount(layout.getGroupId(),layout.isPrivateLayout());
  }
}
