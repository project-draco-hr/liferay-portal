{
  List<Layout> childLayouts=layoutPersistence.findByG_P_P(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId());
  for (  Layout childLayout : childLayouts) {
    deleteLayout(childLayout,updateLayoutSet);
  }
  portletPreferencesLocalService.deletePortletPreferences(PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,layout.getPlid());
  ratingsStatsLocalService.deleteStats(Layout.class.getName(),layout.getPlid());
  mbMessageLocalService.deleteDiscussionMessages(Layout.class.getName(),layout.getPlid());
  journalContentSearchLocalService.deleteLayoutContentSearches(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId());
  expandoValueLocalService.deleteValues(Layout.class.getName(),layout.getPlid());
  imageLocalService.deleteImage(layout.getIconImageId());
  Group scopeGroup=layout.getScopeGroup();
  if (scopeGroup != null) {
    groupLocalService.deleteGroup(scopeGroup.getGroupId());
  }
  String primKey=layout.getPlid() + PortletConstants.LAYOUT_SEPARATOR + "%";
  List<Resource> resources=resourceFinder.findByC_P(layout.getCompanyId(),primKey);
  for (  Resource resource : resources) {
    resourceLocalService.deleteResource(resource);
  }
  resourceLocalService.deleteResource(layout.getCompanyId(),Layout.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,layout.getPlid());
  layoutPersistence.remove(layout);
  if (updateLayoutSet) {
    layoutSetLocalService.updatePageCount(layout.getGroupId(),layout.isPrivateLayout());
  }
}
