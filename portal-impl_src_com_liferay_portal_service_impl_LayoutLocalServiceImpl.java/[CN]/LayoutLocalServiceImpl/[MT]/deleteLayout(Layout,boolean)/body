{
  List childLayouts=layoutPersistence.findByG_P_P(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId());
  for (int i=0; i < childLayouts.size(); i++) {
    Layout childLayout=(Layout)childLayouts.get(i);
    deleteLayout(childLayout,updateLayoutSet);
  }
  portletPreferencesLocalService.deletePortletPreferences(PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,layout.getPlid());
  tasksProposalLocalService.deleteProposal(Layout.class.getName(),String.valueOf(layout.getPlid()));
  ratingsStatsLocalService.deleteStats(Layout.class.getName(),layout.getPlid());
  mbMessageLocalService.deleteDiscussionMessages(Layout.class.getName(),layout.getPlid());
  journalContentSearchLocalService.deleteLayoutContentSearches(layout.getGroupId(),layout.isPrivateLayout(),layout.getLayoutId());
  ImageLocalUtil.deleteImage(layout.getIconImageId());
  String primKey=layout.getPlid() + PortletImpl.LAYOUT_SEPARATOR + "%";
  Iterator itr=resourceFinder.findByC_P(layout.getCompanyId(),primKey).iterator();
  while (itr.hasNext()) {
    Resource resource=(Resource)itr.next();
    resourceLocalService.deleteResource(resource);
  }
  resourceLocalService.deleteResource(layout.getCompanyId(),Layout.class.getName(),ResourceImpl.SCOPE_INDIVIDUAL,layout.getPlid());
  layoutPersistence.remove(layout.getPlid());
  if (updateLayoutSet) {
    layoutSetLocalService.updatePageCount(layout.getGroupId(),layout.isPrivateLayout());
  }
}
