{
  Iterator itr=layoutTypePortlet.getPortletIds().iterator();
  while (itr.hasNext()) {
    String portletId=(String)itr.next();
    if (!portletIds.contains(portletId)) {
      portletIds.add(portletId);
    }
    if (layoutTypePortlet.hasPortletId(portletId)) {
      String resourceName=PortletImpl.getRootPortletId(portletId);
      String resourcePrimKey=PortletPermission.getPrimaryKey(layout.getPlid(),portletId);
      Element portletEl=permissionsEl.addElement("portlet");
      portletEl.addAttribute("portlet-id",portletId);
      exportGroupPermissions(companyId,groupId,resourceName,resourcePrimKey,portletEl,"community-actions");
      if (groupId != guestGroup.getGroupId()) {
        exportGroupPermissions(companyId,guestGroup.getGroupId(),resourceName,resourcePrimKey,portletEl,"guest-actions");
      }
      exportUserPermissions(layoutCache,companyId,groupId,resourceName,resourcePrimKey,portletEl);
      exportInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"organization");
      exportInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"location");
      exportInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"user-group");
    }
  }
}
