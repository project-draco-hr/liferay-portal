{
  for (  String portletId : layoutTypePortlet.getPortletIds()) {
    if (!portletIds.contains(portletId)) {
      portletIds.add(portletId);
    }
    if (layoutTypePortlet.hasPortletId(portletId)) {
      String resourceName=PortletConstants.getRootPortletId(portletId);
      String resourcePrimKey=PortletPermissionUtil.getPrimaryKey(layout.getPlid(),portletId);
      Element portletEl=permissionsEl.addElement("portlet");
      portletEl.addAttribute("portlet-id",portletId);
      exportGroupPermissions(companyId,groupId,resourceName,resourcePrimKey,portletEl,"community-actions");
      if (groupId != guestGroup.getGroupId()) {
        exportGroupPermissions(companyId,guestGroup.getGroupId(),resourceName,resourcePrimKey,portletEl,"guest-actions");
      }
      if (exportUserPermissions) {
        exportUserPermissions(layoutCache,companyId,groupId,resourceName,resourcePrimKey,portletEl);
      }
      exportInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"organization");
      exportInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"location");
      exportInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"user-group");
    }
  }
}
