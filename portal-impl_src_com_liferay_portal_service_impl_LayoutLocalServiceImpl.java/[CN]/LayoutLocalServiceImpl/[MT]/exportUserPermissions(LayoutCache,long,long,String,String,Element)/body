{
  StopWatch stopWatch=null;
  if (_log.isDebugEnabled()) {
    stopWatch=new StopWatch();
    stopWatch.start();
  }
  Element userPermissionsEl=DocumentHelper.createElement("user-permissions");
  List<User> users=layoutCache.getGroupUsers(groupId);
  for (  User user : users) {
    String emailAddress=user.getEmailAddress();
    Element userActionsEl=DocumentHelper.createElement("user-actions");
    List<Permission> permissions=permissionLocalService.getUserPermissions(user.getUserId(),companyId,resourceName,ResourceConstants.SCOPE_INDIVIDUAL,resourcePrimKey);
    List<String> actions=ResourceActionsUtil.getActions(permissions);
    for (    String action : actions) {
      Element actionKeyEl=userActionsEl.addElement("action-key");
      actionKeyEl.addText(action);
    }
    if (!userActionsEl.elements().isEmpty()) {
      userActionsEl.addAttribute("email-address",emailAddress);
      userPermissionsEl.add(userActionsEl);
    }
  }
  if (!userPermissionsEl.elements().isEmpty()) {
    parentEl.add(userPermissionsEl);
  }
  if (_log.isDebugEnabled()) {
    _log.debug("Export user permissions for {" + resourceName + ", "+ resourcePrimKey+ "} with "+ users.size()+ " users takes "+ stopWatch.getTime()+ " ms");
  }
}
