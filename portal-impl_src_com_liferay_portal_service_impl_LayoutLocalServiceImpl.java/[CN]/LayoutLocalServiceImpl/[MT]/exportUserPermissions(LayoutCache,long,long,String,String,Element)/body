{
  Element userPermissionsEl=DocumentHelper.createElement("user-permissions");
  List users=layoutCache.getGroupUsers(groupId);
  for (int i=0; i < users.size(); i++) {
    User user=(User)users.get(i);
    String emailAddress=user.getEmailAddress();
    Element userActionsEl=userPermissionsEl.addElement("user-actions");
    List permissions=permissionLocalService.getUserPermissions(user.getUserId(),companyId,resourceName,ResourceImpl.SCOPE_INDIVIDUAL,resourcePrimKey);
    List actions=ResourceActionsUtil.getActions(permissions);
    for (int j=0; j < actions.size(); j++) {
      String action=(String)actions.get(j);
      Element actionKeyEl=userActionsEl.addElement("action-key");
      actionKeyEl.addText(action);
    }
    if (userActionsEl.elements().isEmpty()) {
      userPermissionsEl.remove(userActionsEl);
    }
 else {
      userActionsEl.addAttribute("email-address",emailAddress);
    }
  }
  if (!userPermissionsEl.elements().isEmpty()) {
    parentEl.add(userPermissionsEl);
  }
}
