{
  if (MergeLayoutPrototypesThreadLocal.isInProgress()) {
    return false;
  }
  Group group=layout.getGroup();
  if (MergeLayoutPrototypesThreadLocal.isMergeComplete("getLayout",arguments) && (!group.isUser() || PropsValues.USER_GROUPS_COPY_LAYOUTS_TO_USER_PERSONAL_SITE)) {
    return false;
  }
  if (Validator.isNull(layout.getLayoutPrototypeUuid()) && Validator.isNull(layout.getSourcePrototypeLayoutUuid())) {
    return false;
  }
  boolean workflowEnabled=WorkflowThreadLocal.isEnabled();
  LayoutSet layoutSet=layout.getLayoutSet();
  try {
    WorkflowThreadLocal.setEnabled(false);
    SitesUtil.mergeLayoutPrototypeLayout(group,layout);
    if (Validator.isNotNull(layout.getSourcePrototypeLayoutUuid())) {
      SitesUtil.mergeLayoutSetPrototypeLayouts(group,layoutSet);
    }
  }
 catch (  PortalException pe) {
    throw pe;
  }
catch (  Exception e) {
    throw new SystemException(e);
  }
 finally {
    MergeLayoutPrototypesThreadLocal.setMergeComplete("getLayout",arguments);
    WorkflowThreadLocal.setEnabled(workflowEnabled);
  }
  return true;
}
