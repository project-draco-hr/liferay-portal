{
  Layout layout=getLayout(groupId,privateLayout,layoutId);
  List<Layout> layouts=getLayouts(groupId,privateLayout);
  for (  Layout curLayout : layouts) {
    List<PortletPreferences> portletPreferencesList=portletPreferencesLocalService.getPortletPreferencesByPlid(curLayout.getPlid());
    for (    PortletPreferences portletPreferences : portletPreferencesList) {
      String portletId=portletPreferences.getPortletId();
      Portlet portlet=portletLocalService.getPortletById(portletId);
      if ((portlet == null) || !portlet.isScopeable()) {
        continue;
      }
      javax.portlet.PortletPreferences preferences=PortletPreferencesFactoryUtil.getLayoutPortletSetup(curLayout,portletId);
      String scopeLayoutUuid=GetterUtil.getString(preferences.getValue("lfrScopeLayoutUuid",null));
      if (!scopeLayoutUuid.equals(layout.getUuid())) {
        continue;
      }
      String portletTitle=PortalUtil.getPortletTitle(portletId,languageId);
      String newPortletTitle=PortalUtil.getNewPortletTitle(portletTitle,curLayout.getName(languageId),name);
      if (newPortletTitle.equals(portletTitle)) {
        continue;
      }
      try {
        preferences.setValue("portletSetupTitle" + languageId,newPortletTitle);
        preferences.setValue("portletSetupUseCustomTitle",Boolean.TRUE.toString());
        preferences.store();
      }
 catch (      IOException ioe) {
        throw new SystemException(ioe);
      }
catch (      PortletException pe) {
        throw new SystemException(pe);
      }
    }
  }
}
