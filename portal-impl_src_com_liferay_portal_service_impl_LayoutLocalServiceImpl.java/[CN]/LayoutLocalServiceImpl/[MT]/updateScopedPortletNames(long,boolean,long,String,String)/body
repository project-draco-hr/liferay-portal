{
  List<Layout> allGroupLayouts=getLayouts(groupId,privateLayout);
  Layout updatedLayout=getLayout(groupId,privateLayout,layoutId);
  for (  Layout layout : allGroupLayouts) {
    List<PortletPreferences> portletPreferencesList=portletPreferencesLocalService.getPortletPreferencesByPlid(layout.getPlid());
    for (    PortletPreferences portletPreferences : portletPreferencesList) {
      String portletId=portletPreferences.getPortletId();
      Portlet portlet=portletLocalService.getPortletById(portletId);
      if (((portlet == null) || !portlet.isScopeable())) {
        continue;
      }
      javax.portlet.PortletPreferences preferences=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portletId);
      String scopeLayoutUuid=GetterUtil.getString(preferences.getValue("lfrScopeLayoutUuid",null));
      if (!scopeLayoutUuid.equals(updatedLayout.getUuid())) {
        continue;
      }
      String portletTitle=PortalUtil.getPortletTitle(portletId,languageId);
      String newPortletTitle=PortalUtil.getNewPortletTitle(portletTitle,layout.getName(languageId),name);
      try {
        if (!newPortletTitle.equals(portletTitle)) {
          preferences.setValue("portlet-setup-title-" + languageId,newPortletTitle);
          preferences.setValue("portlet-setup-use-custom-title",Boolean.TRUE.toString());
        }
        preferences.store();
      }
 catch (      IOException ioe) {
        throw new SystemException(ioe);
      }
catch (      PortletException pe) {
        throw new SystemException(pe);
      }
    }
  }
}
