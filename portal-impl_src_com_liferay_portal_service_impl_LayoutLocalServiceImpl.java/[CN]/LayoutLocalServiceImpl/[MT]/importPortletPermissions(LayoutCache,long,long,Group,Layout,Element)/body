{
  Iterator itr=permissionsEl.elements("portlet").iterator();
  while (itr.hasNext()) {
    Element portletEl=(Element)itr.next();
    String portletId=portletEl.attributeValue("portlet-id");
    String resourceName=PortletImpl.getRootPortletId(portletId);
    String resourcePrimKey=PortletPermissionUtil.getPrimaryKey(layout.getPlid(),portletId);
    Portlet portlet=portletLocalService.getPortletById(companyId,resourceName);
    if (portlet == null) {
      if (_log.isDebugEnabled()) {
        _log.debug("Do not import portlet permissions for " + portletId + " because the portlet does not exist");
      }
    }
 else {
      importGroupPermissions(layoutCache,companyId,groupId,resourceName,resourcePrimKey,portletEl,"community-actions",true);
      if (groupId != guestGroup.getGroupId()) {
        importGroupPermissions(layoutCache,companyId,guestGroup.getGroupId(),resourceName,resourcePrimKey,portletEl,"guest-actions",true);
      }
      importUserPermissions(layoutCache,companyId,groupId,resourceName,resourcePrimKey,portletEl,true);
      importInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"organization",true);
      importInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"location",true);
      importInheritedPermissions(layoutCache,companyId,resourceName,resourcePrimKey,portletEl,"user-group",true);
    }
  }
}
