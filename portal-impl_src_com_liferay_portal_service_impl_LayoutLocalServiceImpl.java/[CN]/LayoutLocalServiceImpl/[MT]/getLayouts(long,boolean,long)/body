{
  if (MergeLayoutPrototypesThreadLocal.isInProgress()) {
    return layoutPersistence.findByG_P_P(groupId,privateLayout,parentLayoutId);
  }
  try {
    Group group=groupLocalService.getGroup(groupId);
    LayoutSet layoutSet=layoutSetLocalService.getLayoutSet(groupId,privateLayout);
    if (!_mergeLayouts(group,layoutSet,groupId,privateLayout,parentLayoutId)) {
      return layoutPersistence.findByG_P_P(groupId,privateLayout,parentLayoutId);
    }
    List<Layout> layouts=layoutPersistence.findByG_P_P(groupId,privateLayout,parentLayoutId);
    return _injectVirtualLayouts(group,layoutSet,layouts,parentLayoutId);
  }
 catch (  PortalException pe) {
    throw new SystemException(pe);
  }
}
