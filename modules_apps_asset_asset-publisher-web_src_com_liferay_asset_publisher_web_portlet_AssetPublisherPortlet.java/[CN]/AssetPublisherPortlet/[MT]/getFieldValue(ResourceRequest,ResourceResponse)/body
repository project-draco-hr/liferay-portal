{
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  try {
    ServiceContext serviceContext=ServiceContextFactory.getInstance(resourceRequest);
    long structureId=ParamUtil.getLong(resourceRequest,"structureId");
    Fields fields=(Fields)serviceContext.getAttribute(Fields.class.getName() + structureId);
    if (fields == null) {
      String fieldsNamespace=ParamUtil.getString(resourceRequest,"fieldsNamespace");
      fields=DDMUtil.getFields(structureId,fieldsNamespace,serviceContext);
    }
    String fieldName=ParamUtil.getString(resourceRequest,"name");
    Field field=fields.get(fieldName);
    Serializable fieldValue=field.getValue(themeDisplay.getLocale(),0);
    JSONObject jsonObject=JSONFactoryUtil.createJSONObject();
    if (fieldValue != null) {
      jsonObject.put("success",true);
    }
 else {
      jsonObject.put("success",false);
      writeJSON(resourceRequest,resourceResponse,jsonObject);
      return;
    }
    DDMStructure ddmStructure=field.getDDMStructure();
    String type=ddmStructure.getFieldType(fieldName);
    Serializable displayValue=DDMUtil.getDisplayFieldValue(themeDisplay,fieldValue,type);
    jsonObject.put("displayValue",String.valueOf(displayValue));
    if (fieldValue instanceof Boolean) {
      jsonObject.put("value",(Boolean)fieldValue);
    }
 else     if (fieldValue instanceof Date) {
      DateFormat dateFormat=DateFormatFactoryUtil.getSimpleDateFormat("yyyyMM ddHHmmss");
      jsonObject.put("value",dateFormat.format(fieldValue));
    }
 else     if (fieldValue instanceof Double) {
      jsonObject.put("value",(Double)fieldValue);
    }
 else     if (fieldValue instanceof Float) {
      jsonObject.put("value",(Float)fieldValue);
    }
 else     if (fieldValue instanceof Integer) {
      jsonObject.put("value",(Integer)fieldValue);
    }
 else     if (fieldValue instanceof Number) {
      jsonObject.put("value",String.valueOf(fieldValue));
    }
 else {
      jsonObject.put("value",(String)fieldValue);
    }
    writeJSON(resourceRequest,resourceResponse,jsonObject);
  }
 catch (  Exception e) {
    throw new PortletException(e);
  }
}
