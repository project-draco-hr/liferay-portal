{
  File tempFile=new File("tempFile");
  Assert.assertTrue(tempFile.createNewFile());
  AutoDeleteFileInputStream autoRemoveFileInputStream=new AutoDeleteFileInputStream(tempFile);
  final AtomicInteger checkDeleteCount=new AtomicInteger();
  SwappableSecurityManager swappableSecurityManager=new SwappableSecurityManager(){
    @Override public void checkDelete(    String file){
      if (file.contains("tempFile")) {
        checkDeleteCount.getAndIncrement();
      }
    }
  }
;
  try (SwappableSecurityManager autoCloseSwappableSecurityManager=swappableSecurityManager){
    autoCloseSwappableSecurityManager.install();
    autoRemoveFileInputStream.close();
  }
   Assert.assertFalse(tempFile.exists());
  Assert.assertEquals(1,checkDeleteCount.get());
  checkDeleteCount.set(0);
  Assert.assertTrue(tempFile.createNewFile());
  autoRemoveFileInputStream=new AutoDeleteFileInputStream(tempFile);
  Assert.assertTrue(tempFile.delete());
  try (SwappableSecurityManager autoCloseSwappableSecurityManager=swappableSecurityManager){
    autoCloseSwappableSecurityManager.install();
    autoRemoveFileInputStream.close();
  }
   Assert.assertFalse(tempFile.exists());
  Assert.assertEquals(2,checkDeleteCount.get());
  Set<String> files=ReflectionTestUtil.getFieldValue(Class.forName("java.io.DeleteOnExitHook"),"files");
  Assert.assertTrue(files.contains(tempFile.getPath()));
}
