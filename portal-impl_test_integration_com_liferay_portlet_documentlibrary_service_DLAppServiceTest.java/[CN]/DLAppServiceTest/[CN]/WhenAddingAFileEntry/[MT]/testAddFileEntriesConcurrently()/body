{
  _users=new User[ServiceTestUtil.THREAD_COUNT];
  for (int i=0; i < ServiceTestUtil.THREAD_COUNT; i++) {
    User user=UserTestUtil.addUser("DLAppServiceTest" + (i + 1),group.getGroupId());
    _users[i]=user;
  }
  DoAsUserThread[] doAsUserThreads=new DoAsUserThread[_users.length];
  _fileEntryIds=new long[_users.length];
  for (int i=0; i < 2; i++) {
    for (int j=0; j < doAsUserThreads.length; j++) {
      if (i == 0) {
        doAsUserThreads[j]=new AddFileEntryThread(_users[j].getUserId(),j);
      }
 else {
        doAsUserThreads[j]=new GetFileEntryThread(_users[j].getUserId(),j);
      }
    }
    for (    DoAsUserThread doAsUserThread : doAsUserThreads) {
      doAsUserThread.start();
    }
    for (    DoAsUserThread doAsUserThread : doAsUserThreads) {
      doAsUserThread.join();
    }
    int successCount=0;
    for (    DoAsUserThread doAsUserThread : doAsUserThreads) {
      if (doAsUserThread.isSuccess()) {
        successCount++;
      }
    }
    String message="Only " + successCount + " out of "+ _users.length;
    if (i == 0) {
      message+=" threads added file entries successfully";
    }
 else {
      message+=" threads retrieved file entries successfully";
    }
    Assert.assertTrue(message,successCount == _users.length);
  }
}
