{
  try {
    InputStream inputStream=DLFileEntryLocalServiceUtil.getFileAsStream(fileVersion.getUserId(),fileVersion.getFileEntryId(),fileVersion.getVersion(),false);
    byte[] bytes=FileUtil.getBytes(inputStream);
    ImageBag imageBag=ImageProcessorUtil.read(bytes);
    RenderedImage renderedImage=imageBag.getRenderedImage();
    if (renderedImage != null) {
      String imageType=imageBag.getType();
      _saveThumbnailImage(fileVersion,renderedImage,PropsKeys.IG_IMAGE_THUMBNAIL_MAX_DIMENSION,getThumbnailFilePath(fileVersion,imageType));
      if (PrefsPropsUtil.getInteger(PropsKeys.IG_IMAGE_CUSTOM_1_MAX_DIMENSION) > 0) {
        _saveThumbnailImage(fileVersion,renderedImage,PropsKeys.IG_IMAGE_CUSTOM_1_MAX_DIMENSION,_getCustom1FilePath(fileVersion,imageType));
      }
      if (PrefsPropsUtil.getInteger(PropsKeys.IG_IMAGE_CUSTOM_2_MAX_DIMENSION) > 0) {
        _saveThumbnailImage(fileVersion,renderedImage,PropsKeys.IG_IMAGE_CUSTOM_2_MAX_DIMENSION,_getCustom2FilePath(fileVersion,imageType));
      }
    }
  }
 catch (  NoSuchFileEntryException nsfee) {
  }
catch (  Exception e) {
    _log.error(e,e);
  }
 finally {
    _fileEntries.remove(fileVersion.getFileVersionId());
  }
}
