{
  DDMTemplate template=getDDMTemplate(templateId);
  File smallImageFile=null;
  if (template.isSmallImage() && Validator.isNull(template.getSmallImageURL())) {
    Image smallImage=ImageUtil.fetchByPrimaryKey(template.getSmallImageId());
    if (smallImage != null) {
      smallImageFile=FileUtil.createTempFile(smallImage.getType());
      try {
        FileUtil.write(smallImageFile,smallImage.getTextObj());
      }
 catch (      IOException ioe) {
        _log.error(ioe);
      }
    }
  }
  return addTemplate(userId,template.getGroupId(),template.getClassNameId(),template.getClassPK(),null,nameMap,descriptionMap,template.getType(),template.getMode(),template.getLanguage(),template.getScript(),template.isCacheable(),template.isSmallImage(),template.getSmallImageURL(),smallImageFile,serviceContext);
}
