{
  List<DDMTemplate> newTemplates=new ArrayList<DDMTemplate>();
  List<DDMTemplate> oldTemplates=getTemplates(classNameId,oldClassPK,type);
  for (  DDMTemplate oldTemplate : oldTemplates) {
    File smallImageFile=null;
    if (oldTemplate.isSmallImage() && Validator.isNull(oldTemplate.getSmallImageURL())) {
      Image smallImage=ImageUtil.fetchByPrimaryKey(oldTemplate.getSmallImageId());
      if (smallImage != null) {
        smallImageFile=FileUtil.createTempFile(smallImage.getType());
        try {
          FileUtil.write(smallImageFile,smallImage.getTextObj());
        }
 catch (        IOException ioe) {
          _log.error(ioe);
        }
      }
    }
    String newTemplateKey=String.valueOf(counterLocalService.increment());
    DDMTemplate newTemplate=addTemplate(userId,oldTemplate.getGroupId(),oldTemplate.getClassNameId(),newClassPK,newTemplateKey,oldTemplate.getNameMap(),oldTemplate.getDescriptionMap(),oldTemplate.getType(),oldTemplate.getMode(),oldTemplate.getLanguage(),oldTemplate.getScript(),oldTemplate.isCacheable(),oldTemplate.isSmallImage(),oldTemplate.getSmallImageURL(),smallImageFile,serviceContext);
    newTemplates.add(newTemplate);
  }
  return newTemplates;
}
