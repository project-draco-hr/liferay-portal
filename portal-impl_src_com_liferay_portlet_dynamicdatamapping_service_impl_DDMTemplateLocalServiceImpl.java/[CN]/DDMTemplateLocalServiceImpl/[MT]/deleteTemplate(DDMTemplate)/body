{
  if (template.getClassNameId() == classNameLocalService.getClassNameId(DDMStructure.class.getName())) {
    DDMStructure structure=ddmStructureLocalService.fetchDDMStructure(template.getClassPK());
    if ((structure != null) && (structure.getClassNameId() == classNameLocalService.getClassNameId(JournalArticle.class.getName()))) {
      Group companyGroup=groupLocalService.getCompanyGroup(template.getCompanyId());
      int count;
      if (template.getGroupId() == companyGroup.getGroupId()) {
        count=JournalArticleUtil.countByC_DDMTK(JournalArticleConstants.CLASSNAME_ID_DEFAULT,template.getTemplateKey());
      }
 else {
        count=JournalArticleUtil.countByG_C_DDMTK(template.getGroupId(),JournalArticleConstants.CLASSNAME_ID_DEFAULT,template.getTemplateKey());
      }
      if (count > 0) {
        throw new RequiredTemplateException("Template " + template.getName() + " cannot be "+ "deleted because it is used by "+ count+ " journal articles");
      }
    }
  }
  ddmTemplatePersistence.remove(template);
  resourceLocalService.deleteResource(template.getCompanyId(),DDMTemplate.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,template.getTemplateId());
}
