{
  templateKey=StringUtil.toUpperCase(templateKey.trim());
  DDMTemplate template=ddmTemplatePersistence.fetchByG_C_T(groupId,classNameId,templateKey);
  if (template != null) {
    return template;
  }
  if (!includeAncestorTemplates) {
    throw new NoSuchTemplateException("No DDMTemplate exists with the template key " + templateKey);
  }
  for (  long curGroupId : PortalUtil.getCurrentAndAncestorSiteGroupIds(groupId)) {
    template=ddmTemplatePersistence.fetchByG_C_T(curGroupId,classNameId,templateKey);
    if (template != null) {
      return template;
    }
  }
  throw new NoSuchTemplateException("No DDMStructure exists with the structure key " + templateKey + "in the ancestor groups");
}
