{
  templateKey=StringUtil.toUpperCase(templateKey.trim());
  DDMTemplate template=ddmTemplatePersistence.fetchByG_C_T(groupId,classNameId,templateKey);
  if (template != null) {
    return template;
  }
  if (!includeGlobalTemplates) {
    throw new NoSuchTemplateException("No DDMTemplate exists with the template key " + templateKey);
  }
  Group group=groupPersistence.findByPrimaryKey(groupId);
  Group companyGroup=groupLocalService.getCompanyGroup(group.getCompanyId());
  return ddmTemplatePersistence.findByG_C_T(companyGroup.getGroupId(),classNameId,templateKey);
}
