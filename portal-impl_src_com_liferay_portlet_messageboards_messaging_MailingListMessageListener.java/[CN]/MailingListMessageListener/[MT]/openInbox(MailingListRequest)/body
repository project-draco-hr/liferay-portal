{
  Session session=null;
  Properties properties=new Properties();
  String protocol=request.getInProtocol();
  int portNumber=request.getInServerPort();
  if (request.getInUseSSL()) {
    String SSL_FACTORY="javax.net.ssl.SSLSocketFactory";
    properties.setProperty("mail." + protocol + ".socketFactory.class",SSL_FACTORY);
    properties.setProperty("mail." + protocol + ".socketFactory.fallback","false");
    properties.setProperty("mail." + protocol + ".port",String.valueOf(portNumber));
    properties.setProperty("mail." + protocol + ".socketFactory.port",String.valueOf(portNumber));
  }
  session=Session.getInstance(properties,null);
  if (_log.isDebugEnabled()) {
    session.setDebug(true);
  }
  URLName url=new URLName(protocol,request.getInServerName(),portNumber,StringPool.BLANK,request.getInUserName(),request.getInPassword());
  Store store=session.getStore(url);
  store.connect();
  Folder defaultFolder=store.getDefaultFolder();
  Folder[] folders=defaultFolder.list();
  if (folders.length == 0) {
    throw new MessagingException("Inbox not found");
  }
 else {
    _inboxFolder=folders[0];
    _inboxFolder.open(Folder.READ_WRITE);
  }
}
