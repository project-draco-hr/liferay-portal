{
  if (!isFileEntryCheckedOut(fileEntryId)) {
    return null;
  }
  if (!hasFileEntryLock(userId,fileEntryId)) {
    lockFileEntry(userId,fileEntryId);
  }
  DLFileEntry dlFileEntry=dlFileEntryPersistence.findByPrimaryKey(fileEntryId);
  DLFileVersion dlFileVersion=dlFileVersionLocalService.getLatestFileVersion(fileEntryId,false);
  removeFileVersion(dlFileEntry,dlFileVersion);
  if (dlFileEntry.getFolderId() != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    DLFolder dlFolder=dlFolderPersistence.findByPrimaryKey(dlFileEntry.getFolderId());
    dlFolder.setLastPostDate(new Date());
    dlFolderPersistence.update(dlFolder);
  }
  return dlFileVersion;
}
