{
  if (!isFileEntryCheckedOut(fileEntryId)) {
    return null;
  }
  if (!hasFileEntryLock(userId,fileEntryId)) {
    lockFileEntry(userId,fileEntryId);
  }
  DLFileEntry dlFileEntry=dlFileEntryPersistence.findByPrimaryKey(fileEntryId);
  DLFileVersion dlFileVersion=dlFileVersionLocalService.getLatestFileVersion(fileEntryId,false);
  removeFileVersion(dlFileEntry,dlFileVersion);
  if (dlFileEntry.getFolderId() != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    Date now=new Date();
    DLFolder dlfolder=dlFolderLocalService.getFolder(dlFileEntry.getFolderId());
    dlfolder.setLastPostDate(now);
    dlFolderPersistence.update(dlfolder);
  }
  return dlFileVersion;
}
