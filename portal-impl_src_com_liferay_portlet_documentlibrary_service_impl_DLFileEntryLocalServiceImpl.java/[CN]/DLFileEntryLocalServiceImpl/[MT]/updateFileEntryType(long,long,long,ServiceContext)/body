{
  User user=userPersistence.findByPrimaryKey(userId);
  DLFileEntry dlFileEntry=dlFileEntryLocalService.getFileEntry(fileEntryId);
  dlFileEntry.setFileEntryTypeId(fileEntryTypeId);
  dlFileEntryLocalService.updateDLFileEntry(dlFileEntry);
  DLFileVersion dlFileVersion=dlFileVersionLocalService.getLatestFileVersion(fileEntryId,!dlFileEntry.isCheckedOut());
  dlFileVersion.setUserId(user.getUserId());
  dlFileVersion.setUserName(user.getFullName());
  dlFileVersion.setModifiedDate(serviceContext.getModifiedDate(new Date()));
  dlFileVersion.setFileEntryTypeId(fileEntryTypeId);
  dlFileVersionLocalService.updateDLFileVersion(dlFileVersion);
  return dlFileEntry;
}
