{
  try {
    RenderedImage renderedImage=null;
    Image largeImage=imageLocalService.getImage(largeImageId);
    byte[] bytes=largeImage.getTextObj();
    String contentType=largeImage.getType();
    if (bytes != null) {
      ImageBag imageBag=ImageProcessorUtil.read(bytes);
      renderedImage=imageBag.getRenderedImage();
    }
    if (renderedImage != null) {
      int dimension=PrefsPropsUtil.getInteger(PropsKeys.IG_IMAGE_THUMBNAIL_MAX_DIMENSION);
      RenderedImage thumbnail=ImageProcessorUtil.scale(renderedImage,dimension,dimension);
      imageLocalService.updateImage(smallImageId,ImageProcessorUtil.getBytes(thumbnail,contentType));
    }
  }
 catch (  IOException ioe) {
    throw new ImageSizeException(ioe);
  }
}
