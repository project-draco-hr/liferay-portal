{
  DLFileVersion dlFileVersion=dlFileVersionLocalService.getFileVersion(fileEntryId,version);
  if (!dlFileVersion.isApproved()) {
    return;
  }
  String sourceFileName=dlFileVersion.getTitle();
  String extension=dlFileVersion.getExtension();
  String mimeType=dlFileVersion.getMimeType();
  String title=dlFileVersion.getTitle();
  String description=dlFileVersion.getDescription();
  String changeLog="Reverted to " + version;
  boolean majorVersion=true;
  String extraSettings=dlFileVersion.getExtraSettings();
  long fileEntryTypeId=dlFileVersion.getFileEntryTypeId();
  Map<String,Fields> fieldsMap=null;
  InputStream is=getFileAsStream(userId,fileEntryId,version);
  long size=dlFileVersion.getSize();
  DLFileEntry dlFileEntry=updateFileEntry(userId,fileEntryId,sourceFileName,extension,mimeType,title,description,changeLog,majorVersion,extraSettings,fileEntryTypeId,fieldsMap,is,size,serviceContext);
  DLFileVersion newDlFileVersion=dlFileVersionLocalService.getFileVersion(fileEntryId,dlFileEntry.getVersion());
  copyFileEntryMetadata(dlFileVersion.getCompanyId(),dlFileVersion.getFileEntryTypeId(),fileEntryId,newDlFileVersion.getFileVersionId(),dlFileVersion.getFileVersionId(),serviceContext);
}
