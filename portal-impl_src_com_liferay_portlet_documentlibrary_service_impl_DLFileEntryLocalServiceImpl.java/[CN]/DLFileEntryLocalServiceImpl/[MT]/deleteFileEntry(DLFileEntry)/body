{
  dlFileEntryPersistence.remove(dlFileEntry);
  resourceLocalService.deleteResource(dlFileEntry.getCompanyId(),DLFileEntry.class.getName(),ResourceConstants.SCOPE_INDIVIDUAL,dlFileEntry.getFileEntryId());
  webDAVPropsLocalService.deleteWebDAVProps(DLFileEntry.class.getName(),dlFileEntry.getFileEntryId());
  dlFileEntryMetadataLocalService.deleteFileEntryMetadata(dlFileEntry.getFileEntryId());
  List<DLFileVersion> dlFileVersions=dlFileVersionPersistence.findByFileEntryId(dlFileEntry.getFileEntryId());
  for (  DLFileVersion dlFileVersion : dlFileVersions) {
    dlFileVersionPersistence.remove(dlFileVersion);
    expandoValueLocalService.deleteValues(DLFileVersion.class.getName(),dlFileVersion.getFileVersionId());
    workflowInstanceLinkLocalService.deleteWorkflowInstanceLinks(dlFileEntry.getCompanyId(),dlFileEntry.getGroupId(),DLFileEntry.class.getName(),dlFileVersion.getFileVersionId());
  }
  expandoValueLocalService.deleteValues(DLFileEntry.class.getName(),dlFileEntry.getFileEntryId());
  for (  DLFileVersion dlFileVersion : dlFileVersions) {
    imageLocalService.deleteImage(dlFileVersion.getSmallImageId());
    imageLocalService.deleteImage(dlFileVersion.getLargeImageId());
    imageLocalService.deleteImage(dlFileVersion.getCustom1ImageId());
    imageLocalService.deleteImage(dlFileVersion.getCustom2ImageId());
  }
  lockLocalService.unlock(DLFileEntry.class.getName(),dlFileEntry.getFileEntryId());
  try {
    DLStoreUtil.deleteFile(dlFileEntry.getCompanyId(),dlFileEntry.getDataRepositoryId(),dlFileEntry.getName());
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn(e,e);
    }
  }
  FileModel fileModel=new FileModel();
  fileModel.setCompanyId(dlFileEntry.getCompanyId());
  fileModel.setFileName(dlFileEntry.getName());
  fileModel.setPortletId(PortletKeys.DOCUMENT_LIBRARY);
  fileModel.setRepositoryId(dlFileEntry.getDataRepositoryId());
  Indexer indexer=IndexerRegistryUtil.getIndexer(FileModel.class);
  indexer.delete(fileModel);
}
