{
  List<DLFileVersion> dlFileVersions=dlFileVersionPersistence.findByFileEntryId(fileEntryId);
  if (dlFileVersions.isEmpty()) {
    throw new NoSuchFileVersionException("No file versions found for fileEntryId " + fileEntryId);
  }
  dlFileVersions=ListUtil.copy(dlFileVersions);
  Collections.sort(dlFileVersions,new FileVersionVersionComparator());
  DLFileVersion dlFileVersion=dlFileVersions.get(0);
  String version=dlFileVersion.getVersion();
  if (excludeWorkingCopy && version.equals(DLFileEntryConstants.PRIVATE_WORKING_COPY_VERSION)) {
    return dlFileVersions.get(1);
  }
  return dlFileVersion;
}
