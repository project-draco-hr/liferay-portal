{
  Date now=new Date();
  long fileVersionId=counterLocalService.increment();
  DLFileVersion fileVersion=dlFileVersionPersistence.create(fileVersionId);
  String versionUserName=GetterUtil.getString(fileEntry.getVersionUserName(),fileEntry.getUserName());
  fileVersion.setGroupId(fileEntry.getGroupId());
  fileVersion.setCompanyId(fileEntry.getCompanyId());
  fileVersion.setUserId(user.getUserId());
  fileVersion.setUserName(versionUserName);
  fileVersion.setCreateDate(now);
  fileVersion.setFolderId(fileEntry.getFolderId());
  fileVersion.setName(fileEntry.getName());
  fileVersion.setVersion(version);
  fileVersion.setSize(fileEntry.getSize());
  fileVersion.setStatus(status);
  fileVersion.setStatusByUserId(user.getUserId());
  fileVersion.setStatusByUserName(user.getFullName());
  fileVersion.setStatusDate(now);
  dlFileVersionPersistence.update(fileVersion,false);
}
