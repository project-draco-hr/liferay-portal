{
  long fileVersionId=counterLocalService.increment();
  DLFileVersion fileVersion=dlFileVersionPersistence.create(fileVersionId);
  long versionUserId=fileEntry.getVersionUserId();
  if (versionUserId <= 0) {
    versionUserId=fileEntry.getUserId();
  }
  String versionUserName=GetterUtil.getString(fileEntry.getVersionUserName(),fileEntry.getUserName());
  fileVersion.setGroupId(fileEntry.getGroupId());
  fileVersion.setCompanyId(fileEntry.getCompanyId());
  fileVersion.setUserId(versionUserId);
  fileVersion.setUserName(versionUserName);
  fileVersion.setCreateDate(fileEntry.getModifiedDate());
  fileVersion.setFolderId(fileEntry.getFolderId());
  fileVersion.setName(fileEntry.getName());
  fileVersion.setVersion(version);
  fileVersion.setSize(fileEntry.getSize());
  fileVersion.setStatus(status);
  fileVersion.setStatusByUserId(user.getUserId());
  fileVersion.setStatusByUserName(user.getFullName());
  fileVersion.setStatusDate(fileEntry.getModifiedDate());
  dlFileVersionPersistence.update(fileVersion,false);
}
