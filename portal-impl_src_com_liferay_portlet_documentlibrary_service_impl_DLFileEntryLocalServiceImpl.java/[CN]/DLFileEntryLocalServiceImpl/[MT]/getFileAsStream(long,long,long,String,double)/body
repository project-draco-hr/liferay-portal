{
  if (userId > 0) {
    DLFolder folder=dlFolderPersistence.findByPrimaryKey(folderId);
    dlFileRankLocalService.updateFileRank(folder.getGroupId(),companyId,userId,folderId,name);
  }
  DLFileEntry fileEntry=dlFileEntryPersistence.findByF_N(folderId,name);
  fileEntry.setReadCount(fileEntry.getReadCount() + 1);
  dlFileEntryPersistence.update(fileEntry,false);
  tagsAssetLocalService.incrementViewCounter(DLFileEntry.class.getName(),fileEntry.getFileEntryId());
  if ((version > 0) && (fileEntry.getVersion() != version)) {
    return dlLocalService.getFileAsStream(companyId,folderId,name,version);
  }
 else {
    return dlLocalService.getFileAsStream(companyId,folderId,name);
  }
}
