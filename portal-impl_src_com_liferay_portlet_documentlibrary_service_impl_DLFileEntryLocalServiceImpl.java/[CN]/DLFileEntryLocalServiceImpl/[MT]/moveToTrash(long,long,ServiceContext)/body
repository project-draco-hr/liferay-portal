{
  if (!hasFileEntryLock(userId,fileEntryId)) {
    lockFileEntry(userId,fileEntryId);
  }
  try {
    DLFileEntry dlFileEntry=getDLFileEntry(fileEntryId);
    DLFileVersion dlFileVersion=dlFileEntry.getFileVersion();
    TrashEntry trashEntry=trashEntryLocalService.addTrashEntry(dlFileEntry.getCompanyId(),dlFileEntry.getGroupId(),DLFileEntry.class.getName(),dlFileEntry.getPrimaryKey(),dlFileVersion.getStatus(),null);
    dlFileVersion.setStatus(WorkflowConstants.STATUS_DELETED);
    dlFileVersionPersistence.update(dlFileVersion,true);
    return trashEntry;
  }
  finally {
    if (!isFileEntryCheckedOut(fileEntryId)) {
      unlockFileEntry(fileEntryId);
    }
  }
}
