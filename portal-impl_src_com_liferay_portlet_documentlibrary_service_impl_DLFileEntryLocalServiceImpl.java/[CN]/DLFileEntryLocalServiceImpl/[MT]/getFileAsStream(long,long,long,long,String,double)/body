{
  DLFileEntry fileEntry=dlFileEntryPersistence.findByG_F_N(groupId,folderId,name);
  if (userId > 0) {
    dlFileRankLocalService.updateFileRank(groupId,companyId,userId,folderId,name);
  }
  fileEntry.setReadCount(fileEntry.getReadCount() + 1);
  dlFileEntryPersistence.update(fileEntry,false);
  assetEntryLocalService.incrementViewCounter(DLFileEntry.class.getName(),fileEntry.getFileEntryId());
  List<DLFileShortcut> fileShortcuts=dlFileShortcutPersistence.findByG_TF_TN(groupId,folderId,name);
  for (  DLFileShortcut fileShortcut : fileShortcuts) {
    assetEntryLocalService.incrementViewCounter(DLFileShortcut.class.getName(),fileShortcut.getFileShortcutId());
  }
  long repositoryId=getRepositoryId(groupId,folderId);
  if ((version > 0) && (fileEntry.getVersion() != version)) {
    return dlLocalService.getFileAsStream(companyId,repositoryId,name,version);
  }
 else {
    return dlLocalService.getFileAsStream(companyId,repositoryId,name,fileEntry.getVersion());
  }
}
