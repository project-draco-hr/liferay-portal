{
  if (layout instanceof VirtualLayout) {
    VirtualLayout virtualLayout=(VirtualLayout)layout;
    layout=virtualLayout.getSourceLayout();
  }
  boolean useDefaultPortletPermissions=false;
  String resourcePermissionPrimKey=PortletPermissionUtil.getPrimaryKey(layout.getPlid(),portletId);
  int count=ResourcePermissionLocalServiceUtil.getResourcePermissionsCount(permissionChecker.getCompanyId(),portletId,ResourceConstants.SCOPE_INDIVIDUAL,resourcePermissionPrimKey);
  if (count == 0) {
    useDefaultPortletPermissions=true;
  }
  if (useDefaultPortletPermissions) {
    resourcePermissionPrimKey=portletId;
  }
  return permissionChecker.hasPermission(layout.getGroupId(),portletId,resourcePermissionPrimKey,actionId);
}
