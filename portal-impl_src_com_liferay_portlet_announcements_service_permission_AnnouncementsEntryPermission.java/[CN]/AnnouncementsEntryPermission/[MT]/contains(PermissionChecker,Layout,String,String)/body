{
  if (layout instanceof VirtualLayout) {
    VirtualLayout virtualLayout=(VirtualLayout)layout;
    layout=virtualLayout.getSourceLayout();
  }
  boolean useDefaultPortletPermissions=false;
  String primKey=PortletPermissionUtil.getPrimaryKey(layout.getPlid(),portletId);
  int count=ResourcePermissionLocalServiceUtil.getResourcePermissionsCount(permissionChecker.getCompanyId(),portletId,ResourceConstants.SCOPE_INDIVIDUAL,primKey);
  if (count == 0) {
    useDefaultPortletPermissions=true;
  }
  if (useDefaultPortletPermissions) {
    primKey=portletId;
  }
  return permissionChecker.hasPermission(layout.getGroupId(),portletId,primKey,actionId);
}
