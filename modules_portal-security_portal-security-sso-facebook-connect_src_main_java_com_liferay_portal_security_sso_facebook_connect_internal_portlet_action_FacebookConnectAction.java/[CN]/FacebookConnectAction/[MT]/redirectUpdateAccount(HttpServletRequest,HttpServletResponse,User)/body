{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PortletURL portletURL=PortletURLFactoryUtil.create(request,PortletKeys.LOGIN,themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  portletURL.setParameter("saveLastPath",Boolean.FALSE.toString());
  portletURL.setParameter("mvcRenderCommandName","/login/associate_facebook_user");
  portletURL.setParameter("redirect",ParamUtil.getString(request,"redirect"));
  portletURL.setParameter("userId",String.valueOf(user.getUserId()));
  portletURL.setParameter("emailAddress",user.getEmailAddress());
  portletURL.setParameter("firstName",user.getFirstName());
  portletURL.setParameter("lastName",user.getLastName());
  portletURL.setPortletMode(PortletMode.VIEW);
  portletURL.setWindowState(LiferayWindowState.POP_UP);
  response.sendRedirect(portletURL.toString());
}
