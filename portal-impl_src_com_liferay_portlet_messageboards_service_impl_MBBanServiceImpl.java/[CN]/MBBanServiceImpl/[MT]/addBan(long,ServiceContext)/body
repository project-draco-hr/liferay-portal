{
  PermissionChecker permissionChecker=getPermissionChecker();
  MBPermission.check(permissionChecker,serviceContext.getScopeGroupId(),ActionKeys.BAN_USER);
  User banUser=userLocalService.getUser(banUserId);
  boolean communityAdmin=false;
  try {
    communityAdmin=PortalUtil.isCommunityAdmin(banUser,serviceContext.getScopeGroupId());
  }
 catch (  Exception e) {
    throw new SystemException(e);
  }
  if (communityAdmin) {
    throw new PrincipalException();
  }
  return mbBanLocalService.addBan(getUserId(),banUserId,serviceContext);
}
