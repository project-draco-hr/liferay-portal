{
  PortletPreferences portletPreferences=PortletPreferencesFactoryUtil.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
  String searchConfiguration=portletPreferences.getValue("searchConfiguration",null);
  if (Validator.isNull(searchConfiguration)) {
    return null;
  }
  JSONObject searchConfigurationJSONObject=JSONFactoryUtil.createJSONObject(searchConfiguration);
  JSONArray oldFacetsJSONArray=searchConfigurationJSONObject.getJSONArray("facets");
  if (oldFacetsJSONArray == null) {
    return null;
  }
  JSONArray newFacetsJSONArray=JSONFactoryUtil.createJSONArray();
  for (int i=0; i < oldFacetsJSONArray.length(); i++) {
    JSONObject oldFacetJSONObject=oldFacetsJSONArray.getJSONObject(i);
    String fieldName=oldFacetJSONObject.getString("fieldName");
    if (fieldName.equals("entryClassName")) {
      JSONObject oldDataJSONObject=oldFacetJSONObject.getJSONObject("data");
      JSONObject newDataJSONObject=upgradeDataJSONObject(oldDataJSONObject);
      if (newDataJSONObject == null) {
        return null;
      }
      oldFacetJSONObject.put("data",newDataJSONObject);
    }
    newFacetsJSONArray.put(oldFacetJSONObject);
  }
  searchConfigurationJSONObject.put("facets",newFacetsJSONArray);
  portletPreferences.setValue("searchConfiguration",searchConfigurationJSONObject.toString());
  return PortletPreferencesFactoryUtil.toXML(portletPreferences);
}
