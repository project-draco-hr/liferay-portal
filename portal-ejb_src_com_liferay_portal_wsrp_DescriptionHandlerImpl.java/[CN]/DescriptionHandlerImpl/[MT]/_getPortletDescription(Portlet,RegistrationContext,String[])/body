{
  PortletDescription portletDescription=new PortletDescription();
  Set localesSet=portlet.getSupportedLocales();
  String[] locales=(String[])localesSet.toArray(new String[localesSet.size()]);
  portletDescription.setPortletHandle(portlet.getPortletId());
  Map portletModesMap=portlet.getPortletModes();
  Set mimeTypes=portletModesMap.keySet();
  MarkupType[] markupTypes=new MarkupType[mimeTypes.size()];
  Iterator it=mimeTypes.iterator();
  int i=0;
  for (i=0; it.hasNext(); i++) {
    boolean viewModeFound=false;
    String mimeType=(String)it.next();
    markupTypes[i]=new MarkupType();
    markupTypes[i].setMimeType(mimeType);
    Set portletModesSet=(Set)portletModesMap.get(mimeType);
    String[] portletModes=null;
    if (!portletModesSet.contains(PortletMode.VIEW.toString())) {
      portletModes=new String[portletModesSet.size() + 1];
      portletModes[portletModes.length - 1]=WSRPUtil.toWsrpMode(PortletMode.VIEW.toString());
    }
 else {
      portletModes=new String[portletModesSet.size()];
    }
    Iterator itr=portletModesSet.iterator();
    for (int j=0; itr.hasNext(); j++) {
      String mode=(String)itr.next();
      portletModes[j]=WSRPUtil.toWsrpMode(mode);
    }
    markupTypes[i].setModes(portletModes);
    String[] windowStates={WindowStates._normal,WindowStates._minimized,WindowStates._maximized};
    markupTypes[i].setWindowStates(windowStates);
    markupTypes[i].setLocales(locales);
  }
  if (mimeTypes.size() <= 0) {
    markupTypes=new MarkupType[1];
    markupTypes[0]=new MarkupType();
    markupTypes[0].setMimeType("text/html");
    String[] portletModes={WSRPUtil.toWsrpMode(PortletMode.VIEW.toString())};
    markupTypes[0].setModes(portletModes);
    String[] windowStates={WindowStates._normal,WindowStates._minimized,WindowStates._maximized};
    markupTypes[i].setWindowStates(windowStates);
    markupTypes[0].setLocales(locales);
  }
  portletDescription.setMarkupTypes(markupTypes);
  ServletContext ctx=WSRPUtil.getServletContext();
  ServletContext portalCtx=ctx.getContext(PropsUtil.get(PropsUtil.PORTAL_CTX));
  PortletConfig portletConfig=PortletConfigFactory.create(portlet,portalCtx);
  HttpServletRequest req=WSRPUtil.getHttpServletRequest();
  Locale requestLocale=req.getLocale();
  String lang=requestLocale.getDisplayLanguage();
  ResourceBundle resourceBundle=portletConfig.getResourceBundle(requestLocale);
  LocalizedString shortTitle=new LocalizedString();
  shortTitle.setLang(lang);
  shortTitle.setValue(_getResourceString(resourceBundle,WebKeys.JAVAX_PORTLET_SHORT_TITLE,StringPool.BLANK));
  portletDescription.setShortTitle(shortTitle);
  LocalizedString title=new LocalizedString();
  title.setLang(lang);
  title.setValue(_getResourceString(resourceBundle,WebKeys.JAVAX_PORTLET_TITLE,StringPool.BLANK));
  portletDescription.setTitle(title);
  portletDescription.setGroupID(portlet.getPortletId());
  return portletDescription;
}
