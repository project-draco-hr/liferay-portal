{
  XMLReader xmlReader=null;
  ClassLoader classLoader=getClass().getClassLoader();
  ClassLoader contextClassLoader=ClassLoaderUtil.getContextClassLoader();
  try {
    if (contextClassLoader != classLoader) {
      ClassLoaderUtil.setContextClassLoader(classLoader);
    }
    xmlReader=new SAXParser();
  }
 catch (  RuntimeException re) {
    throw new SystemException(re);
  }
 finally {
    if (contextClassLoader != classLoader) {
      ClassLoaderUtil.setContextClassLoader(contextClassLoader);
    }
  }
  if (!PropsValues.XML_SECURITY_ENABLED) {
    return xmlReader;
  }
  xmlReader=new StripDoctypeXMLReader(xmlReader);
  try {
    xmlReader.setFeature(_FEATURES_DISALLOW_DOCTYPE_DECL,true);
  }
 catch (  Exception e) {
    _log.error("Unable to initialize safe SAX parser to protect from XML " + "Bomb attacks",e);
  }
  try {
    xmlReader.setFeature(_FEATURES_EXTERNAL_GENERAL_ENTITIES,false);
    xmlReader.setFeature(_FEATURES_EXTERNAL_PARAMETER_ENTITIES,false);
  }
 catch (  Exception e) {
    _log.error("Unable to initialize safe SAX parser to protect from XXE " + "attacks",e);
  }
  return xmlReader;
}
