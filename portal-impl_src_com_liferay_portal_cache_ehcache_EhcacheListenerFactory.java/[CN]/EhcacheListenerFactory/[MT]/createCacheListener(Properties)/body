{
  String factoryClassName=properties.getProperty(EhcacheConstants.CACHE_EVENT_LISTENER_FACTORY_CLASS_NAME);
  if (Validator.isNull(factoryClassName)) {
    return null;
  }
  CacheEventListenerFactory cacheEventListenerFactory=_cacheEventListenerFactories.get(factoryClassName);
  if (cacheEventListenerFactory == null) {
    try {
      cacheEventListenerFactory=(CacheEventListenerFactory)InstanceFactory.newInstance(ClassLoaderUtil.getPortalClassLoader(),factoryClassName);
    }
 catch (    Exception e) {
      _log.error("Unable to instantiate cache event listener factory " + factoryClassName,e);
      return null;
    }
    _cacheEventListenerFactories.put(factoryClassName,cacheEventListenerFactory);
  }
  CacheEventListener cacheEventListener=cacheEventListenerFactory.createCacheEventListener(properties);
  if (cacheEventListener instanceof net.sf.ehcache.distribution.CacheReplicator) {
    return new EhcacheCacheReplicatorAdapter<Serializable,Serializable>(cacheEventListener);
  }
  return new EhcacheCacheListenerAdapter<Serializable,Serializable>(cacheEventListener);
}
