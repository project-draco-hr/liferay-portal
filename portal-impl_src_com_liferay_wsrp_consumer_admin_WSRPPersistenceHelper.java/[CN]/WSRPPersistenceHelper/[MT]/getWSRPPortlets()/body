{
  try {
    List<WSRPPortlet> wsrpPortlets=WSRPPortletLocalServiceUtil.getPortlets();
    if ((wsrpPortlets == null) || (wsrpPortlets.size() == 0)) {
      return Collections.EMPTY_LIST;
    }
    List<Portlet> portlets=new ArrayList<Portlet>();
    for (    WSRPPortlet wsrpPortlet : wsrpPortlets) {
      String portletId=PortalUtil.getJsSafePortletId(wsrpPortlet.getName());
      Portlet portlet=PortletLocalServiceUtil.newPortlet(CompanyConstants.SYSTEM,portletId);
      portlet.setPortletId(portletId);
      portlet.setTimestamp(System.currentTimeMillis());
      portlet.setPortletName(portletId);
      portlet.setActive(true);
      portlet.setRemote(true);
      portlet.setRemoteConsumerId(wsrpPortlet.getConsumerId());
      portlet.setRemoteProducerEntityId(wsrpPortlet.getProducerEntityId());
      portlet.setRemotePortletHandle(wsrpPortlet.getPortletHandle());
      portlet.setRemotePortletId(wsrpPortlet.getPortletHandle());
      MimeTypes mimeTypes=_unmarshallMimeTypes(wsrpPortlet.getMimeTypes());
      List<MimeType> mimes=mimeTypes.getMimeType();
      Map<String,Set<String>> portletModes=new HashMap<String,Set<String>>();
      for (      MimeType mimeType : mimes) {
        Set<String> modes=new HashSet<String>(mimeType.getModes());
        portletModes.put(mimeType.getMime(),modes);
      }
      portlet.setPortletModes(portletModes);
      PortletInfo portletInfo=new PortletInfo(wsrpPortlet.getTitle(),wsrpPortlet.getShortTitle(),wsrpPortlet.getKeywords());
      portlet.setPortletInfo(portletInfo);
      portlets.add(portlet);
    }
    return portlets;
  }
 catch (  Exception e) {
    throw new WSRPConsumerException(e.getMessage(),e);
  }
}
