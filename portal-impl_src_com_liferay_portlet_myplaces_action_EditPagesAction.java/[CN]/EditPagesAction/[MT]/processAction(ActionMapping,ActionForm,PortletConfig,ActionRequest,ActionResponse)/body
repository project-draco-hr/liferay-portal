{
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  long groupId=ParamUtil.getLong(req,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(req,"privateLayout");
  Layout layout=null;
  List layouts=LayoutLocalServiceUtil.getLayouts(groupId,privateLayout,LayoutImpl.DEFAULT_PARENT_LAYOUT_ID,0,1);
  if (layouts.size() > 0) {
    layout=(Layout)layouts.get(0);
  }
 else {
    long parentLayoutId=LayoutImpl.DEFAULT_PARENT_LAYOUT_ID;
    String name="New Page";
    String title=StringPool.BLANK;
    String type=LayoutImpl.TYPE_PORTLET;
    boolean hidden=false;
    String friendlyURL=StringPool.BLANK;
    layout=LayoutServiceUtil.addLayout(groupId,privateLayout,parentLayoutId,name,title,type,hidden,friendlyURL);
  }
  if (layout != null) {
    HttpServletRequest httReq=PortalUtil.getHttpServletRequest(req);
    PortletURL portletURL=new PortletURLImpl(httReq,PortletKeys.LAYOUT_MANAGEMENT,layout.getPlid(),false);
    portletURL.setWindowState(WindowState.MAXIMIZED);
    portletURL.setPortletMode(PortletMode.VIEW);
    portletURL.setParameter("struts_action","/layout_management/edit_pages");
    portletURL.setParameter("tabs2","public");
    portletURL.setParameter("groupId",String.valueOf(groupId));
    res.sendRedirect(portletURL.toString());
  }
}
