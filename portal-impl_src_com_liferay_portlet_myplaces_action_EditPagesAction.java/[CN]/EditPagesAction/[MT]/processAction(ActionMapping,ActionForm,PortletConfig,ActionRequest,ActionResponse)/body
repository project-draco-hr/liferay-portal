{
  long groupId=ParamUtil.getLong(req,"groupId");
  boolean privateLayout=ParamUtil.getBoolean(req,"privateLayout");
  Layout layout=null;
  List<Layout> layouts=LayoutLocalServiceUtil.getLayouts(groupId,privateLayout,LayoutImpl.DEFAULT_PARENT_LAYOUT_ID,0,1);
  if (layouts.size() > 0) {
    layout=layouts.get(0);
  }
 else {
    long parentLayoutId=LayoutImpl.DEFAULT_PARENT_LAYOUT_ID;
    String name="New Page";
    String title=StringPool.BLANK;
    String description=StringPool.BLANK;
    String type=LayoutImpl.TYPE_PORTLET;
    boolean hidden=false;
    String friendlyURL=StringPool.BLANK;
    layout=LayoutServiceUtil.addLayout(groupId,privateLayout,parentLayoutId,name,title,description,type,hidden,friendlyURL);
  }
  if (layout != null) {
    String tabs2="public";
    if (privateLayout) {
      tabs2="private";
    }
    HttpServletRequest httReq=PortalUtil.getHttpServletRequest(req);
    PortletURL portletURL=new PortletURLImpl(httReq,PortletKeys.LAYOUT_MANAGEMENT,layout.getPlid(),PortletRequest.RENDER_PHASE);
    portletURL.setWindowState(WindowState.MAXIMIZED);
    portletURL.setPortletMode(PortletMode.VIEW);
    portletURL.setParameter("struts_action","/layout_management/edit_pages");
    portletURL.setParameter("tabs2",tabs2);
    portletURL.setParameter("groupId",String.valueOf(groupId));
    res.sendRedirect(portletURL.toString());
  }
}
