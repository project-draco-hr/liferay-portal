{
  FastDateFormatFactoryUtil fastDateFormatFactoryUtil=new FastDateFormatFactoryUtil();
  fastDateFormatFactoryUtil.setFastDateFormatFactory(new FastDateFormatFactoryImpl());
  FileUtil fileUtil=new FileUtil();
  fileUtil.setFile(new FileImpl());
  File tempFolder=FileUtil.createTempFolder();
  com.liferay.portal.util.PropsUtil.set(PropsKeys.MODULE_FRAMEWORK_STATE_DIR,tempFolder.getCanonicalPath());
  PropsUtil.setProps(new PropsImpl());
  String[] moduleFrameworkAutoDeployDirs=PropsUtil.getArray(PropsKeys.MODULE_FRAMEWORK_INITIAL_BUNDLES);
  for (int i=0; i < moduleFrameworkAutoDeployDirs.length; i++) {
    if (moduleFrameworkAutoDeployDirs[i].endsWith("@start")) {
      moduleFrameworkAutoDeployDirs[i]=moduleFrameworkAutoDeployDirs[i].substring(0,moduleFrameworkAutoDeployDirs[i].length() - 6);
    }
  }
  com.liferay.portal.util.PropsUtil.set(PropsKeys.MODULE_FRAMEWORK_INITIAL_BUNDLES,StringUtil.merge(moduleFrameworkAutoDeployDirs));
  String bsn="com.liferay.target.platform";
  String version=ReleaseInfo.getVersion();
  File targetPlatformDir=new File(PropsValues.MODULE_FRAMEWORK_BASE_DIR,TARGET_PLATFORM);
  if (!targetPlatformDir.exists() && !targetPlatformDir.mkdirs()) {
    System.err.printf("[ERROR] Cannot create directory %s because of file " + "permissions\n",targetPlatformDir);
    return;
  }
  TargetPlatformIndexer targetPlatformIndexer=new TargetPlatformIndexer(bsn,version);
  try {
    File indexFile=targetPlatformIndexer.index(targetPlatformDir);
    System.out.println("Wrote index file " + indexFile);
  }
  finally {
    FileUtil.deltree(tempFolder);
  }
}
