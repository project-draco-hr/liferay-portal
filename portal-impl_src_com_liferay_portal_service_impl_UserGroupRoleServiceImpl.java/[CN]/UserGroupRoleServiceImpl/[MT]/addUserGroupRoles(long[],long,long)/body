{
  UserGroupRolePermissionUtil.check(getPermissionChecker(),groupId,roleId);
  List<UserGroupRole> userGroupRoles=new ArrayList<UserGroupRole>();
  for (  long userId : userIds) {
    UserGroupRolePermissionUtil.check(getPermissionChecker(),groupId,roleId);
    UserGroupRolePK userGroupRolePK=new UserGroupRolePK(userId,groupId,roleId);
    UserGroupRole userGroupRole=userGroupRoleLocalService.createUserGroupRole(userGroupRolePK);
    userGroupRoles.add(userGroupRole);
  }
  if (userGroupRoles.isEmpty()) {
    return;
  }
  Role role=roleLocalService.getRole(roleId);
  if (role.getType() == RoleConstants.TYPE_ORGANIZATION) {
    OrganizationMembershipPolicyUtil.checkRoles(userGroupRoles,null);
  }
 else   if (role.getType() == RoleConstants.TYPE_SITE) {
    SiteMembershipPolicyUtil.checkRoles(userGroupRoles,null);
  }
  userGroupRoleLocalService.addUserGroupRoles(userIds,groupId,roleId);
  if (role.getType() == RoleConstants.TYPE_ORGANIZATION) {
    OrganizationMembershipPolicyUtil.propagateRoles(userGroupRoles,null);
  }
 else   if (role.getType() == RoleConstants.TYPE_SITE) {
    SiteMembershipPolicyUtil.propagateRoles(userGroupRoles,null);
  }
}
