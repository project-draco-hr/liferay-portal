{
  long[] filteredRoles=roleIds;
  for (  long roleId : roleIds) {
    UserGroupRolePermissionUtil.check(getPermissionChecker(),groupId,roleId);
    Role role=roleLocalService.getRole(roleId);
    if (role.getType() == RoleConstants.TYPE_SITE) {
      if (GroupPermissionUtil.hasRoleProtected(getPermissionChecker(),groupId,userId,role.getRoleId())) {
        filteredRoles=ArrayUtil.remove(filteredRoles,roleId);
      }
    }
 else     if (role.getType() == RoleConstants.TYPE_ORGANIZATION) {
      if (OrganizationPermissionUtil.hasRoleProtected(getPermissionChecker(),groupId,userId,role.getRoleId())) {
        filteredRoles=ArrayUtil.remove(filteredRoles,roleId);
      }
    }
  }
  if (filteredRoles.length == 0) {
    return;
  }
  checkDeleteUserGroupRolesMembershipPolicy(new long[]{userId},groupId,filteredRoles);
  userGroupRoleLocalService.deleteUserGroupRoles(userId,groupId,filteredRoles);
}
