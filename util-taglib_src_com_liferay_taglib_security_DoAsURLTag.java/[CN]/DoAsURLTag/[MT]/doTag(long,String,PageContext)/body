{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Company company=themeDisplay.getCompany();
  String doAsURL=company.getHomeURL();
  if (Validator.isNull(doAsURL)) {
    Layout layout=null;
    List<Layout> layouts=LayoutLocalServiceUtil.getLayouts(themeDisplay.getScopeGroupId(),false,LayoutConstants.DEFAULT_PARENT_LAYOUT_ID);
    if (!layouts.isEmpty()) {
      layout=layouts.get(0);
      doAsURL=layout.getFriendlyURL();
    }
    if (Validator.isNull(doAsURL)) {
      doAsURL=_COMPANY_DEFAULT_HOME_URL;
    }
  }
  doAsURL=themeDisplay.getPathContext() + doAsURL;
  if (doAsUserId <= 0) {
    doAsUserId=company.getDefaultUser().getUserId();
  }
  String encDoAsUserId=Encryptor.encrypt(company.getKeyObj(),String.valueOf(doAsUserId));
  doAsURL=HttpUtil.addParameter(doAsURL,"doAsUserId",encDoAsUserId);
  if (Validator.isNotNull(var)) {
    pageContext.setAttribute(var,doAsURL);
  }
 else {
    JspWriter jspWriter=pageContext.getOut();
    jspWriter.write(doAsURL);
  }
}
