{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Company company=themeDisplay.getCompany();
  String doAsURL=company.getHomeURL();
  if (Validator.isNull(doAsURL)) {
    doAsURL=_PORTAL_IMPERSONATION_DEFAULT_URL;
  }
  doAsURL=themeDisplay.getPathContext() + doAsURL;
  if (doAsUserId <= 0) {
    doAsUserId=company.getDefaultUser().getUserId();
  }
  String encDoAsUserId=Encryptor.encrypt(company.getKeyObj(),String.valueOf(doAsUserId));
  return HttpUtil.addParameter(doAsURL,"doAsUserId",encDoAsUserId);
}
