{
  HttpServletRequest request=(HttpServletRequest)pageContext.getRequest();
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  Company company=themeDisplay.getCompany();
  String doAsURL=company.getHomeURL();
  if (Validator.isNull(doAsURL)) {
    doAsURL=PropsValues.COMPANY_DEFAULT_HOME_URL;
  }
  if (doAsUserId <= 0) {
    doAsUserId=company.getDefaultUser().getUserId();
  }
  String encDoAsUserId=Encryptor.encrypt(company.getKeyObj(),String.valueOf(doAsUserId));
  doAsURL=HttpUtil.addParameter(doAsURL,"doAsUserId",encDoAsUserId);
  if (Validator.isNotNull(var)) {
    pageContext.setAttribute(var,doAsURL);
  }
 else   if (writeOutput) {
    pageContext.getOut().print(doAsURL);
  }
  return doAsURL;
}
