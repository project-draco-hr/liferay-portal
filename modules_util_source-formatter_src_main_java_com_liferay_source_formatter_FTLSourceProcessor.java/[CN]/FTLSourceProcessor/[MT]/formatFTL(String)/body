{
  StringBundler sb=new StringBundler();
  try (UnsyncBufferedReader unsyncBufferedReader=new UnsyncBufferedReader(new UnsyncStringReader(content))){
    String line=null;
    while ((line=unsyncBufferedReader.readLine()) != null) {
      line=trimLine(line,false);
      String trimmedLine=StringUtil.trimLeading(line);
      if (trimmedLine.startsWith("<#assign ")) {
        line=formatWhitespace(line,trimmedLine,true);
        line=formatIncorrectSyntax(line,"=[","= [",false);
        line=formatIncorrectSyntax(line,"+[","+ [",false);
      }
      sb.append(line);
      sb.append("\n");
    }
  }
   String newContent=sb.toString();
  if (newContent.endsWith("\n")) {
    newContent=newContent.substring(0,newContent.length() - 1);
  }
  return newContent;
}
