{
  ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
  NestedPortletsPortletInstanceConfiguration nestedPortletsPortletInstanceConfiguration=portletDisplay.getPortletInstanceConfiguration(NestedPortletsPortletInstanceConfiguration.class);
  NestedPortletsDisplayContext nestedPortletsDisplayContext=new NestedPortletsDisplayContext(PortalUtil.getHttpServletRequest(portletRequest),_nestedPortletsConfiguration,nestedPortletsPortletInstanceConfiguration);
  return nestedPortletsDisplayContext.getLayoutTemplateId();
}
