{
  Resource resource=getResource(webDAVRequest);
  Lock lock=null;
  int status=HttpServletResponse.SC_OK;
  try {
    if (resource == null) {
      status=HttpServletResponse.SC_CREATED;
      HttpServletRequest request=webDAVRequest.getHttpServletRequest();
      String[] pathArray=webDAVRequest.getPathArray();
      long companyId=webDAVRequest.getCompanyId();
      long groupId=webDAVRequest.getGroupId();
      long parentFolderId=getParentFolderId(companyId,pathArray);
      String title=getTitle(pathArray);
      String extension=FileUtil.getExtension(title);
      String contentType=getContentType(request,null,title,extension);
      String description=StringPool.BLANK;
      String changeLog=StringPool.BLANK;
      File file=FileUtil.createTempFile(extension);
      file.createNewFile();
      ServiceContext serviceContext=new ServiceContext();
      serviceContext.setAddGroupPermissions(isAddGroupPermissions(groupId));
      serviceContext.setAddGuestPermissions(true);
      FileEntry fileEntry=DLAppServiceUtil.addFileEntry(groupId,parentFolderId,title,contentType,title,description,changeLog,file,serviceContext);
      resource=toResource(webDAVRequest,fileEntry,false);
    }
    if (resource instanceof DLFileEntryResourceImpl) {
      FileEntry fileEntry=(FileEntry)resource.getModel();
      ServiceContext serviceContext=new ServiceContext();
      serviceContext.setAttribute(DL.MANUAL_CHECK_IN_REQUIRED,webDAVRequest.isManualCheckInRequired());
      DLAppServiceUtil.checkOutFileEntry(fileEntry.getFileEntryId(),owner,timeout,serviceContext);
      lock=fileEntry.getLock();
    }
 else {
      boolean inheritable=false;
      long depth=WebDAVUtil.getDepth(webDAVRequest.getHttpServletRequest());
      if (depth != 0) {
        inheritable=true;
      }
      Folder folder=(Folder)resource.getModel();
      lock=DLAppServiceUtil.lockFolder(folder.getRepositoryId(),folder.getFolderId(),owner,inheritable,timeout);
    }
  }
 catch (  Exception e) {
    if (!(e instanceof DuplicateLockException)) {
      throw new WebDAVException(e);
    }
    status=WebDAVUtil.SC_LOCKED;
  }
  return new Status(lock,status);
}
