{
  User user=userPersistence.findByPrimaryKey(userId);
  long groupId=serviceContext.getScopeGroupId();
  Date expirationDate=null;
  if (!neverExpire) {
    expirationDate=PortalUtil.getDate(expirationDateMonth,expirationDateDay,expirationDateYear,expirationDateHour,expirationDateMinute,user.getTimeZone(),new QuestionExpirationDateException());
  }
  Date now=new Date();
  validate(title,description,choices);
  long questionId=counterLocalService.increment();
  PollsQuestion question=pollsQuestionPersistence.create(questionId);
  question.setUuid(uuid);
  question.setGroupId(groupId);
  question.setCompanyId(user.getCompanyId());
  question.setUserId(user.getUserId());
  question.setUserName(user.getFullName());
  question.setCreateDate(now);
  question.setModifiedDate(now);
  question.setTitle(title);
  question.setDescription(description);
  question.setExpirationDate(expirationDate);
  pollsQuestionPersistence.update(question,false);
  if (serviceContext.getAddCommunityPermissions() || serviceContext.getAddGuestPermissions()) {
    addQuestionResources(question,serviceContext.getAddCommunityPermissions(),serviceContext.getAddGuestPermissions());
  }
 else {
    addQuestionResources(question,serviceContext.getCommunityPermissions(),serviceContext.getGuestPermissions());
  }
  if (choices != null) {
    for (    PollsChoice choice : choices) {
      pollsChoiceLocalService.addChoice(questionId,choice.getName(),choice.getDescription());
    }
  }
  return question;
}
