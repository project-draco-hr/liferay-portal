{
  User user=UserUtil.findByPrimaryKey(userId);
  Date expirationDate=null;
  if (!neverExpire) {
    expirationDate=PortalUtil.getDate(expirationDateMonth,expirationDateDay,expirationDateYear,expirationDateHour,expirationDateMinute,user.getTimeZone(),new QuestionExpirationDateException());
  }
  validate(title,description,choices);
  PollsQuestion question=PollsQuestionUtil.findByPrimaryKey(questionId);
  question.setModifiedDate(new Date());
  question.setTitle(title);
  question.setDescription(description);
  question.setExpirationDate(expirationDate);
  PollsQuestionUtil.update(question);
  int oldChoicesCount=PollsChoiceUtil.countByQuestionId(questionId);
  if (oldChoicesCount != choices.size()) {
    throw new QuestionChoiceException();
  }
  Iterator itr=choices.iterator();
  while (itr.hasNext()) {
    PollsChoice choice=(PollsChoice)itr.next();
    String choiceName=choice.getName();
    String choiceDescription=choice.getDescription();
    choice=PollsChoiceUtil.fetchByQ_N(questionId,choiceName);
    if (choice == null) {
      long choiceId=CounterLocalServiceUtil.increment();
      choice=PollsChoiceUtil.create(choiceId);
      choice.setQuestionId(questionId);
      choice.setName(choiceName);
    }
    choice.setDescription(choiceDescription);
    PollsChoiceUtil.update(choice);
  }
  return question;
}
