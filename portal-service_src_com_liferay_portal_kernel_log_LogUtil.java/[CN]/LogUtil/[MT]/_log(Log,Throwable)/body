{
  StackTraceElement[] steArray=cause.getStackTrace();
  if (steArray.length > STACK_TRACE_LENGTH) {
    int count=0;
    List<StackTraceElement> steList=new ArrayList<StackTraceElement>();
    for (int i=0; i < steArray.length; i++) {
      StackTraceElement ste=steArray[i];
      String className=ste.getClassName();
      boolean addElement=true;
      if (REMOVE_UNKNOWN_SOURCE && (ste.getLineNumber() < 0)) {
        addElement=false;
      }
      if (className.startsWith("$") || className.startsWith("java.lang.reflect.") || className.startsWith("org.springframework.")|| className.startsWith("sun.reflect.")) {
        addElement=false;
      }
      if (addElement) {
        steList.add(ste);
        count++;
      }
      if (count >= STACK_TRACE_LENGTH) {
        break;
      }
    }
    steArray=steList.toArray(new StackTraceElement[steList.size()]);
    cause.setStackTrace(steArray);
  }
  log.error(StackTraceUtil.getStackTrace(cause));
}
