{
  ExecResult execResult=null;
  if (nativeSync) {
    execResult=project.exec(new Action<ExecSpec>(){
      @Override public void execute(      ExecSpec execSpec){
        if (OSDetector.isWindows()) {
          execSpec.args("/MIR","/NDL","/NFL","/NJH","/NJS","/NP",sourceDir.getAbsolutePath(),targetDir.getAbsolutePath());
          execSpec.setExecutable("robocopy");
        }
 else {
          execSpec.args("--archive","--delete",sourceDir.getAbsolutePath() + File.separator,targetDir.getAbsolutePath());
          execSpec.setExecutable("rsync");
        }
        execSpec.setIgnoreExitValue(true);
      }
    }
);
  }
  if ((execResult != null) && (execResult.getExitValue() == 0)) {
    return;
  }
  project.delete(targetDir);
  try {
    project.copy(new Action<CopySpec>(){
      @Override public void execute(      CopySpec copySpec){
        copySpec.from(sourceDir);
        copySpec.into(targetDir);
      }
    }
);
  }
 catch (  RuntimeException re) {
    project.delete(targetDir);
    throw re;
  }
}
