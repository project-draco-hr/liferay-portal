{
  try {
    if (SyncServiceConfigurationValues.SYNC_VERIFY) {
      VerifyUtil.verify();
    }
    List<Company> companies=CompanyLocalServiceUtil.getCompanies();
    for (    Company company : companies) {
      boolean oAuthEnabled=PrefsPropsUtil.getBoolean(company.getCompanyId(),SyncServiceConfigurationKeys.SYNC_OAUTH_ENABLED,SyncServiceConfigurationValues.SYNC_OAUTH_ENABLED);
      if (!oAuthEnabled) {
        continue;
      }
      ServiceContext serviceContext=new ServiceContext();
      User user=UserLocalServiceUtil.getDefaultUser(company.getCompanyId());
      serviceContext.setUserId(user.getUserId());
      SyncPreferencesLocalServiceUtil.enableOAuth(company.getCompanyId(),serviceContext);
    }
  }
 catch (  Exception e) {
    _log.error(e,e);
  }
  _dlSyncEventMessageListener=new DLSyncEventMessageListener();
  registerMessageListener(_dlSyncEventMessageListener,DestinationNames.DOCUMENT_LIBRARY_SYNC_EVENT_PROCESSOR);
  if (SyncServiceConfigurationValues.SYNC_FILE_DIFF_CACHE_ENABLED) {
    _syncDLFileVersionDiffMessageListener=new SyncDLFileVersionDiffMessageListener();
    registerMessageListener(_syncDLFileVersionDiffMessageListener,SyncDLFileVersionDiffMessageListener.DESTINATION_NAME);
    scheduleDLFileVersionDiffMessageListener();
  }
  consumeDLSyncEvents();
}
