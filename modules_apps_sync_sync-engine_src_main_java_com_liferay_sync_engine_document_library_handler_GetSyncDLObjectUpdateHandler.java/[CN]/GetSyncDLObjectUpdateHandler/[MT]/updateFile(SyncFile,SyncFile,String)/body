{
  String sourceVersion=sourceSyncFile.getVersion();
  long sourceVersionId=sourceSyncFile.getVersionId();
  boolean filePathChanged=processFilePathChange(sourceSyncFile,targetSyncFile);
  sourceSyncFile.setChangeLog(targetSyncFile.getChangeLog());
  sourceSyncFile.setChecksum(targetSyncFile.getChecksum());
  sourceSyncFile.setDescription(targetSyncFile.getDescription());
  sourceSyncFile.setExtension(targetSyncFile.getExtension());
  sourceSyncFile.setExtraSettings(targetSyncFile.getExtraSettings());
  sourceSyncFile.setLockExpirationDate(targetSyncFile.getLockExpirationDate());
  sourceSyncFile.setLockUserId(targetSyncFile.getLockUserId());
  sourceSyncFile.setLockUserName(targetSyncFile.getLockUserName());
  sourceSyncFile.setModifiedTime(targetSyncFile.getModifiedTime());
  sourceSyncFile.setSize(targetSyncFile.getSize());
  sourceSyncFile.setUserId(targetSyncFile.getUserId());
  sourceSyncFile.setUserName(targetSyncFile.getUserName());
  sourceSyncFile.setVersion(targetSyncFile.getVersion());
  sourceSyncFile.setVersionId(targetSyncFile.getVersionId());
  SyncFileService.update(sourceSyncFile);
  if (isParentUnsynced(sourceSyncFile) || sourceSyncFile.isUnsynced()) {
    return;
  }
  Path filePath=Paths.get(targetSyncFile.getFilePathName());
  if (!Files.exists(filePath)) {
    if (targetSyncFile.isFolder()) {
      Path targetFilePath=Paths.get(filePathName);
      Files.createDirectories(targetFilePath);
      sourceSyncFile.setState(SyncFile.STATE_SYNCED);
      sourceSyncFile.setUiEvent(SyncFile.UI_EVENT_UPDATED_REMOTE);
      SyncFileService.update(sourceSyncFile);
      FileKeyUtil.writeFileKey(targetFilePath,String.valueOf(sourceSyncFile.getSyncFileId()),false);
    }
 else {
      downloadFile(sourceSyncFile,null,0,false);
    }
  }
 else   if (targetSyncFile.isFile() && FileUtil.isModified(targetSyncFile,filePath)) {
    downloadFile(sourceSyncFile,sourceVersion,sourceVersionId,!IODeltaUtil.isIgnoredFilePatchingExtension(targetSyncFile));
  }
 else {
    sourceSyncFile.setState(SyncFile.STATE_SYNCED);
    if (filePathChanged) {
      sourceSyncFile.setUiEvent(SyncFile.UI_EVENT_RENAMED_REMOTE);
    }
 else {
      sourceSyncFile.setUiEvent(SyncFile.UI_EVENT_NONE);
    }
    SyncFileService.update(sourceSyncFile);
  }
}
