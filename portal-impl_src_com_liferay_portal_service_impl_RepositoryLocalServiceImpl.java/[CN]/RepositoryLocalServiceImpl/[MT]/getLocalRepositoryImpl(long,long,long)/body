{
  long repositoryEntryId=RepositoryUtil.getRepositoryEntryId(folderId,fileEntryId,fileVersionId);
  LocalRepository localRepositoryImpl=_localRepositoriesByRepositoryEntryId.get(repositoryEntryId);
  if (localRepositoryImpl != null) {
    return localRepositoryImpl;
  }
  long repositoryId=getInternalRepositoryId(folderId,fileEntryId,fileVersionId);
  if (repositoryId == 0) {
    repositoryId=getExternalRepositoryId(folderId,fileEntryId,fileVersionId);
  }
  localRepositoryImpl=LocalRepositoryFactoryUtil.create(repositoryId);
  checkRepository(localRepositoryImpl.getRepositoryId());
  _localRepositoriesByRepositoryEntryId.put(repositoryEntryId,localRepositoryImpl);
  return localRepositoryImpl;
}
