{
  long repositoryEntryId=RepositoryUtil.getRepositoryEntryId(folderId,fileEntryId,fileVersionId);
  com.liferay.portal.kernel.repository.Repository repositoryImpl=_repositoriesByEntryId.get(repositoryEntryId);
  if (repositoryImpl != null) {
    return repositoryImpl;
  }
  long repositoryId=getInternalRepositoryId(folderId,fileEntryId,fileVersionId);
  if (repositoryId == 0) {
    repositoryId=getExternalRepositoryId(folderId,fileEntryId,fileVersionId);
  }
  repositoryImpl=RepositoryFactoryUtil.create(repositoryId);
  checkRepository(repositoryImpl.getRepositoryId());
  _repositoriesByEntryId.put(repositoryEntryId,repositoryImpl);
  return repositoryImpl;
}
