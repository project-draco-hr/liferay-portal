{
  DLFolder mappedFolder=dlRepositoryLocalService.addFolder(getUserId(),groupId,DLFolderConstants.MAPPED_FOLDER_ID,name,description,new ServiceContext());
  Date now=new Date();
  long repositoryId=counterLocalService.increment();
  Repository repository=repositoryPersistence.create(repositoryId);
  repository.setCompanyId(companyId);
  repository.setGroupId(groupId);
  repository.setCreateDate(now);
  repository.setModifiedDate(now);
  repository.setName(name);
  repository.setDescription(description);
  repository.setPortletKey(portletKey);
  repository.setMappedFolderId(mappedFolder.getFolderId());
  repository.setType(type);
  repository.setTypeSettingsProperties(typeSettingsProperties);
  repositoryPersistence.update(repository,false);
  getLocalRepository(repositoryId).addRepository(companyId,groupId,name,description,portletKey,typeSettingsProperties);
  return repositoryId;
}
