{
  try {
    ServletConfig config=(ServletConfig)req.getAttribute(PortletServlet.PORTLET_SERVLET_CONFIG);
    _initQuercus(config);
    HttpServletRequest httpReq=(HttpServletRequest)req.getAttribute(PortletServlet.PORTLET_SERVLET_REQUEST);
    HttpServletResponse httpRes=(HttpServletResponse)req.getAttribute(PortletServlet.PORTLET_SERVLET_RESPONSE);
    PHPServletRequest phpReq=new PHPServletRequest(httpReq,req,res,getPortletConfig(),config,phpURI);
    StringServletResponse phpRes=new StringServletResponse(httpRes);
    _quercusServlet.service(phpReq,phpRes);
    String result=phpRes.getString();
    if (phpRes.getContentType().startsWith("text/")) {
      result=_rewriteURLs(result,res.createRenderURL());
    }
    httpRes.getWriter().write(result.toCharArray());
  }
 catch (  Exception e) {
    _log.error("Error executing PHP",e);
  }
}
