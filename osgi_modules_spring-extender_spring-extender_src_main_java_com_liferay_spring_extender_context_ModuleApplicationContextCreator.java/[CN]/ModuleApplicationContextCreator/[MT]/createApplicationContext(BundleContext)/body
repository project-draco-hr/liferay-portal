{
  Dictionary<String,String> headers=bundleContext.getBundle().getHeaders();
  String configs=headers.get("Spring-Context");
  if (configs == null) {
    return null;
  }
  Bundle bundle=bundleContext.getBundle();
  Bundle extenderBundle=_getExtenderBundle();
  ClassLoader classLoader=new BundleResolverClassLoader(bundle,extenderBundle);
  String liferayService=headers.get("Liferay-Service");
  ApplicationContext parentAppContext=null;
  if (liferayService != null) {
    parentAppContext=_buildParentContext(extenderBundle,classLoader);
  }
  String[] locations=ConfigUtils.getHeaderLocations(headers);
  OsgiBundleXmlApplicationContext osgiBundleXmlApplicationContext=new OsgiBundleXmlApplicationContext(locations,parentAppContext);
  osgiBundleXmlApplicationContext.setBundleContext(bundleContext);
  osgiBundleXmlApplicationContext.addBeanFactoryPostProcessor(new ModuleBeanFactoryPostProcessor(classLoader));
  return osgiBundleXmlApplicationContext;
}
