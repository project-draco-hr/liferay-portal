{
  Bundle bundle=bundleContext.getBundle();
  Dictionary<String,String> headers=bundle.getHeaders();
  String configs=headers.get("Spring-Context");
  if (configs == null) {
    return null;
  }
  String[] locations=ConfigUtils.getHeaderLocations(headers);
  ApplicationContext applicationContext=null;
  Bundle extenderBundle=_getExtenderBundle();
  ClassLoader classLoader=new BundleResolverClassLoader(bundle,extenderBundle);
  String liferayService=headers.get("Liferay-Service");
  if (liferayService != null) {
    applicationContext=_buildParentContext(extenderBundle,classLoader);
  }
  OsgiBundleXmlApplicationContext osgiBundleXmlApplicationContext=new OsgiBundleXmlApplicationContext(locations,applicationContext);
  osgiBundleXmlApplicationContext.setBundleContext(bundleContext);
  osgiBundleXmlApplicationContext.addBeanFactoryPostProcessor(new ModuleBeanFactoryPostProcessor(classLoader));
  return osgiBundleXmlApplicationContext;
}
