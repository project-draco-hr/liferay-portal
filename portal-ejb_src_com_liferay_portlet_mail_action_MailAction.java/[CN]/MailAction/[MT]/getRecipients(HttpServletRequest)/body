{
  String userId=PortalUtil.getUserId(req);
  String data=ParamUtil.getString(req,"data");
  PortletPreferences prefs=PortalUtil.getPreferences(req);
  List finders=RecipientFinderLocator.getInstances();
  SortedSet recipients=new TreeSet();
  for (int i=0; i < finders.size(); i++) {
    RecipientFinder finder=(RecipientFinder)finders.get(i);
    boolean enabled=GetterUtil.getBoolean(prefs.getValue(finder.getClass().getName(),Boolean.TRUE.toString()));
    if (enabled) {
      recipients.addAll(finder.getRecipients(userId,data,new HashMap()));
    }
  }
  JSONArray jsonArray=Autocomplete.arrayToJson((String[])ListUtil.fromCollection(recipients).toArray(new String[0]),50);
  return jsonArray.toString();
}
