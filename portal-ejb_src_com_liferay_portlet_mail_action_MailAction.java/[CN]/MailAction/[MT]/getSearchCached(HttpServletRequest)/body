{
  JSONObject jsonObj=new JSONObject();
  HttpSession ses=req.getSession();
  ThemeDisplay themeDisplay=(ThemeDisplay)req.getAttribute(WebKeys.THEME_DISPLAY);
  Set envelopes=new TreeSet(getComparator(req));
  envelopes.addAll((Set)ses.getAttribute(WebKeys.MAIL_SEARCH_RESULTS));
  ses.setAttribute(WebKeys.MAIL_SEARCH_RESULTS,envelopes);
  JSONArray jsonEnvelopes=_convertEnvelopes(envelopes,themeDisplay);
  jsonObj.put("headers",jsonEnvelopes);
  return jsonObj.toString();
}
