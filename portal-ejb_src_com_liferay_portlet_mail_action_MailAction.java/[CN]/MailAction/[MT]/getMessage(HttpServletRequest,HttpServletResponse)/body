{
  JSONObject jsonObj=new JSONObject();
  String folderId=ParamUtil.getString(req,"folderId");
  long messageId=ParamUtil.getLong(req,"messageId");
  MailUtil.getFolder(req.getSession(),folderId);
  MailMessage mailMessage=MailUtil.getMessage(req,messageId);
  req.setAttribute("mailMessage",mailMessage);
  StringBuffer sb=new StringBuffer();
  ServletContext ctx=(ServletContext)req.getAttribute(WebKeys.CTX);
  PortalUtil.renderPage(sb,ctx,req,res,"/html/portlet/mail/message_details.jsp");
  jsonObj.put("id",messageId);
  jsonObj.put("body",mailMessage.getHtmlBody());
  jsonObj.put("header",sb.toString());
  return jsonObj.toString();
}
