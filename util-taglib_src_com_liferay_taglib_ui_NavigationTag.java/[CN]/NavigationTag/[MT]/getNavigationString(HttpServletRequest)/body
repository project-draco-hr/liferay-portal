{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  NavItem navItem=new NavItem(request,themeDisplay.getLayout(),null);
  StringBundler sb=new StringBundler();
  try {
    List<NavItem> branchNavItems=getBranchNavItems(request);
    NavItem rootNavItem=getRootNavItem(branchNavItems);
    if ((branchNavItems.size() - getRootLayoutLevel()) > 0) {
      buildNavigation(rootNavItem,navItem,branchNavItems,themeDisplay,1,getIncludedLayouts(),getNestedChildren(),sb);
    }
  }
 catch (  Exception e) {
    _log.error(e);
  }
  return sb.toString();
}
