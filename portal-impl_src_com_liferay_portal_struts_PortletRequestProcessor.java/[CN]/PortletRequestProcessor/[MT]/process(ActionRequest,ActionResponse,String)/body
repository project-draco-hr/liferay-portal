{
  ActionResponseImpl actionResponseImpl=(ActionResponseImpl)actionResponse;
  HttpServletRequest request=PortalUtil.getHttpServletRequest(actionRequest);
  HttpServletResponse response=PortalUtil.getHttpServletResponse(actionResponse);
  ActionMapping mapping=processMapping(request,response,path);
  if (mapping == null) {
    return;
  }
  if (!processRoles(request,response,mapping,true)) {
    return;
  }
  ActionForm form=processActionForm(request,response,mapping);
  processPopulate(request,response,form,mapping);
  if (!processValidateAction(request,response,form,mapping)) {
    return;
  }
  PortletAction action=(PortletAction)processActionCreate(request,response,mapping);
  if (action == null) {
    return;
  }
  PortletConfigImpl portletConfigImpl=(PortletConfigImpl)actionRequest.getAttribute(JavaConstants.JAVAX_PORTLET_CONFIG);
  try {
    if (action.isCheckMethodOnProcessAction()) {
      if (!PortalUtil.isMethodPost(actionRequest)) {
        String currentURL=PortalUtil.getCurrentURL(actionRequest);
        if (_log.isWarnEnabled()) {
          _log.warn("This URL can only be invoked using POST: " + currentURL);
        }
        throw new PrincipalException(currentURL);
      }
    }
    action.processAction(mapping,form,portletConfigImpl,actionRequest,actionResponse);
  }
 catch (  Exception e) {
    String exceptionId=WebKeys.PORTLET_STRUTS_EXCEPTION + StringPool.PERIOD + portletConfigImpl.getPortletId();
    actionRequest.setAttribute(exceptionId,e);
  }
  String forward=(String)actionRequest.getAttribute(PortletAction.getForwardKey(actionRequest));
  if (forward != null) {
    String queryString=StringPool.BLANK;
    int pos=forward.indexOf(StringPool.QUESTION);
    if (pos != -1) {
      queryString=forward.substring(pos + 1,forward.length());
      forward=forward.substring(0,pos);
    }
    ActionForward actionForward=mapping.findForward(forward);
    if ((actionForward != null) && (actionForward.getRedirect())) {
      String forwardPath=actionForward.getPath();
      if (forwardPath.startsWith(StringPool.SLASH)) {
        LiferayPortletURL forwardURL=(LiferayPortletURL)actionResponseImpl.createRenderURL();
        forwardURL.setParameter("struts_action",forwardPath);
        StrutsURLEncoder.setParameters(forwardURL,queryString);
        forwardPath=forwardURL.toString();
      }
      actionResponse.sendRedirect(forwardPath);
    }
  }
}
