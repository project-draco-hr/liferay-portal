{
  try (CaptureAppender captureAppender=Log4JLoggerTestUtil.configureLog4JLogger(JDBCExceptionReporter.class.getName(),Level.ERROR)){
    ExecutorService executorService=Executors.newFixedThreadPool(10);
    List<Future<Void>> futures=new ArrayList<>();
    for (int i=0; i < 10; i++) {
      LockingJob lockingJob=new LockingJob("className","key","owner-" + i,10);
      futures.add(executorService.submit(lockingJob));
    }
    executorService.shutdown();
    Assert.assertTrue(executorService.awaitTermination(600,TimeUnit.SECONDS));
    for (    Future<Void> future : futures) {
      future.get();
    }
    Assert.assertFalse(LockLocalServiceUtil.isLocked("className","key"));
    for (    LoggingEvent loggingEvent : captureAppender.getLoggingEvents()) {
      Assert.assertEquals("Deadlock found when trying to get lock; try restarting " + "transaction",loggingEvent.getMessage());
    }
  }
 }
