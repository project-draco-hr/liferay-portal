{
  if (Validator.isNull(langType)) {
    return null;
  }
  long companyId=0;
  long companyGroupId=0;
  long groupId=0;
  if (themeDisplay != null) {
    companyId=themeDisplay.getCompanyId();
    companyGroupId=themeDisplay.getCompanyGroupId();
    groupId=themeDisplay.getScopeGroupId();
  }
  String templateId=String.valueOf(contextObjects.get("template_id"));
  templateId=getTemplateId(templateId,companyId,companyGroupId,groupId);
  Template template=getTemplate(templateId,script,langType);
  UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
  boolean load=false;
  try {
    if (contextObjects != null) {
      for (      String key : contextObjects.keySet()) {
        template.put(key,contextObjects.get(key));
      }
    }
    template.put("company",getCompany(themeDisplay,companyId));
    template.put("companyId",companyId);
    template.put("device",getDevice(themeDisplay));
    template.put("groupId",groupId);
    String templatesPath=getTemplatesPath(companyId,groupId);
    template.put("journalTemplatesPath",templatesPath);
    template.put("permissionChecker",PermissionThreadLocal.getPermissionChecker());
    template.put("randomNamespace",PwdGenerator.getPassword(PwdGenerator.KEY3,4) + StringPool.UNDERLINE);
    template.put("templatesPath",templatesPath);
    load=mergeTemplate(template,unsyncStringWriter);
  }
 catch (  Exception e) {
    throw new TransformException("Unhandled exception",e);
  }
  if (!load) {
    throw new TransformException("Unable to dynamically load transform script");
  }
  return unsyncStringWriter.toString();
}
