{
  String portletName=PortalUtil.getJsSafePortletId(element.elementText("portlet-name"));
  String invokerPortletName=_MODULE + _context + StringPool.SLASH+ portletName;
  XPath xPath=SAXReaderUtil.createXPath("x:init-param[x:name/text()='com.liferay.portal." + "invokerPortletName']","x","http://java.sun.com/xml/ns/portlet/portlet-app_2_0.xsd");
  Element invokerPortletNameElement=(Element)xPath.selectSingleNode(element);
  if (invokerPortletNameElement == null) {
    Element portletClassElement=element.element("portlet-class");
    List<Node> nodes=element.content();
    int index=nodes.indexOf(portletClassElement);
    Element initParamElement=SAXReaderUtil.createElement(SAXReaderUtil.createQName("init-param",qName.getNamespace()));
    addElement(initParamElement,"name","com.liferay.portal.invokerPortletName");
    addElement(initParamElement,"value",invokerPortletName);
    nodes.add(index + 1,initParamElement);
  }
 else {
    Element valueElement=invokerPortletNameElement.element("value");
    invokerPortletName=valueElement.getTextTrim();
    if (!invokerPortletName.startsWith(StringPool.SLASH)) {
      invokerPortletName=StringPool.SLASH + invokerPortletName;
    }
    invokerPortletName=Portal.PATH_MODULE.substring(1) + _context + invokerPortletName;
    valueElement.setText(invokerPortletName);
  }
}
