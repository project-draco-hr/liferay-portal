{
  List<JournalArticle> articles=journalArticleFinder.findByExpirationDate(JournalArticleConstants.CLASSNAME_ID_DEFAULT,new Date(expirationDate.getTime() + getArticleCheckInterval()),new QueryDefinition<JournalArticle>(WorkflowConstants.STATUS_APPROVED));
  if (_log.isDebugEnabled()) {
    _log.debug("Expiring " + articles.size() + " articles");
  }
  for (  JournalArticle article : articles) {
    if (isExpireAllArticleVersions(article.getCompanyId())) {
      List<JournalArticle> currentArticles=journalArticlePersistence.findByG_A(article.getGroupId(),article.getArticleId(),QueryUtil.ALL_POS,QueryUtil.ALL_POS,new ArticleVersionComparator(true));
      for (      JournalArticle currentArticle : currentArticles) {
        if ((currentArticle.getExpirationDate() == null) || (currentArticle.getVersion() > article.getVersion())) {
          continue;
        }
        currentArticle.setExpirationDate(article.getExpirationDate());
        currentArticle.setStatus(WorkflowConstants.STATUS_EXPIRED);
        journalArticlePersistence.update(currentArticle);
      }
    }
 else {
      article.setStatus(WorkflowConstants.STATUS_EXPIRED);
      journalArticlePersistence.update(article);
    }
    updatePreviousApprovedArticle(article);
    Indexer<JournalArticle> indexer=IndexerRegistryUtil.nullSafeGetIndexer(JournalArticle.class);
    indexer.reindex(article);
  }
  if (_previousCheckDate == null) {
    _previousCheckDate=new Date(expirationDate.getTime() - getArticleCheckInterval());
  }
}
