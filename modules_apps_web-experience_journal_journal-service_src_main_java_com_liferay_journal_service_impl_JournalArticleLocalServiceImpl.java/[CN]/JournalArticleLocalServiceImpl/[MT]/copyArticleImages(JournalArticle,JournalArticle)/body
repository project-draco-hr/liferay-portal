{
  Folder folder=newArticle.addImagesFolder();
  for (  FileEntry fileEntry : oldArticle.getImagesFileEntries()) {
    PortletFileRepositoryUtil.addPortletFileEntry(oldArticle.getGroupId(),newArticle.getUserId(),JournalArticle.class.getName(),newArticle.getResourcePrimKey(),JournalConstants.SERVICE_NAME,folder.getFolderId(),fileEntry.getContentStream(),fileEntry.getFileName(),fileEntry.getMimeType(),false);
  }
  Document contentDocument=oldArticle.getDocument();
  contentDocument=contentDocument.clone();
  XPath xPathSelector=SAXReaderUtil.createXPath("//dynamic-element[@type='image']");
  List<Node> imageNodes=xPathSelector.selectNodes(contentDocument);
  for (  Node imageNode : imageNodes) {
    Element imageEl=(Element)imageNode;
    List<Element> dynamicContentEls=imageEl.elements("dynamic-content");
    for (    Element dynamicContentEl : dynamicContentEls) {
      String fileName=dynamicContentEl.attributeValue("name");
      FileEntry fileEntry=PortletFileRepositoryUtil.getPortletFileEntry(newArticle.getGroupId(),folder.getFolderId(),fileName);
      String previewURL=DLUtil.getPreviewURL(fileEntry,fileEntry.getFileVersion(),null,StringPool.BLANK,false,true);
      dynamicContentEl.addAttribute("resourcePrimKey",String.valueOf(newArticle.getResourcePrimKey()));
      dynamicContentEl.clearContent();
      dynamicContentEl.addCDATA(previewURL);
    }
  }
  newArticle.setContent(contentDocument.formattedString());
}
