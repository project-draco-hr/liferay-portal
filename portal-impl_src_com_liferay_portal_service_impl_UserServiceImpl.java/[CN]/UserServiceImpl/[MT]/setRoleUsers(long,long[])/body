{
  RolePermissionUtil.check(getPermissionChecker(),roleId,ActionKeys.ASSIGN_MEMBERS);
  List<Long> unsetUserIds=new ArrayList<Long>(userIds.length);
  List<User> users=rolePersistence.getUsers(roleId);
  for (  User user : users) {
    if (!ArrayUtil.contains(userIds,user.getUserId())) {
      unsetUserIds.add(user.getUserId());
    }
  }
  RoleMembershipPolicyUtil.checkRoles(ArrayUtil.toLongArray(unsetUserIds),null,new long[]{roleId});
  RoleMembershipPolicyUtil.checkRoles(userIds,new long[]{roleId},null);
  userLocalService.setRoleUsers(roleId,userIds);
  RoleMembershipPolicyUtil.propagateRoles(ArrayUtil.toLongArray(unsetUserIds),null,new long[]{roleId});
  RoleMembershipPolicyUtil.propagateRoles(userIds,new long[]{roleId},null);
}
