{
  UserGroupPermissionUtil.check(getPermissionChecker(),userGroupId,ActionKeys.ASSIGN_MEMBERS);
  List<Long> unsetUserIds=new ArrayList<Long>(userIds.length);
  List<User> users=userGroupPersistence.getUsers(userGroupId);
  for (  User user : users) {
    if (!ArrayUtil.contains(userIds,user.getUserId())) {
      unsetUserIds.add(user.getUserId());
    }
  }
  UserGroupMembershipPolicyUtil.checkMembership(ArrayUtil.toLongArray(unsetUserIds),null,new long[]{userGroupId});
  UserGroupMembershipPolicyUtil.checkMembership(userIds,new long[]{userGroupId},null);
  userLocalService.setUserGroupUsers(userGroupId,userIds);
  UserGroupMembershipPolicyUtil.propagateMembership(ArrayUtil.toLongArray(unsetUserIds),null,new long[]{userGroupId});
  UserGroupMembershipPolicyUtil.propagateMembership(userIds,new long[]{userGroupId},null);
}
