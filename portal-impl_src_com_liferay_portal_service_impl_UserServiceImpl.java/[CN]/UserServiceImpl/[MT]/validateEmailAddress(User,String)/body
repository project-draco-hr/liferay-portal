{
  PermissionChecker permissionChecker=getPermissionChecker();
  boolean fieldEditiableUserEmailAddressAdmin=PropsValues.FIELD_EDITABLE_COM_LIFERAY_PORTAL_MODEL_USER_EMAILADDRESS_ADMIN;
  if (fieldEditiableUserEmailAddressAdmin && !permissionChecker.isCompanyAdmin()) {
    throw new UserEmailAddressException();
  }
  boolean fieldEditiableUserEmailAddressUserWithMX=PropsValues.FIELD_EDITABLE_COM_LIFERAY_PORTAL_MODEL_USER_EMAILADDRESS_USER_MX;
  if (fieldEditiableUserEmailAddressUserWithMX && !user.hasCompanyMx()) {
    throw new UserEmailAddressException();
  }
  if (!user.hasCompanyMx() && user.hasCompanyMx(emailAddress)) {
    Company company=companyPersistence.findByPrimaryKey(user.getCompanyId());
    if (!company.isStrangersWithMx()) {
      throw new ReservedUserEmailAddressException();
    }
  }
}
