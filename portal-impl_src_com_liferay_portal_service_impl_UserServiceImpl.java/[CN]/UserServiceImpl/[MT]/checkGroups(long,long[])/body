{
  List<Group> oldGroups=groupLocalService.getUserGroups(userId);
  long[] oldGroupIds=new long[oldGroups.size()];
  for (int i=0; i < oldGroups.size(); i++) {
    Group group=oldGroups.get(i);
    if (!ArrayUtil.contains(groupIds,group.getGroupId()) && !GroupPermissionUtil.contains(getPermissionChecker(),group.getGroupId(),ActionKeys.ASSIGN_MEMBERS)) {
      groupIds=ArrayUtil.append(groupIds,group.getGroupId());
    }
    oldGroupIds[i]=group.getGroupId();
  }
  for (  long groupId : groupIds) {
    if (!ArrayUtil.contains(oldGroupIds,groupId)) {
      GroupPermissionUtil.check(getPermissionChecker(),groupId,ActionKeys.ASSIGN_MEMBERS);
    }
  }
  return groupIds;
}
