{
  MembershipPolicyException membershipPolicyException=null;
  Organization organization=organizationPersistence.findByPrimaryKey(organizationId);
  for (  long userId : userIds) {
    User user=userLocalService.fetchUser(userId);
    if (!MembershipPolicyUtil.isMembershipAllowed(organization,user)) {
      if (membershipPolicyException == null) {
        membershipPolicyException=new MembershipPolicyException(MembershipPolicyException.ORGANIZATION_MEMBERSHIP_NOT_ALLOWED);
        membershipPolicyException.addOrganization(organization);
      }
      membershipPolicyException.addUser(user);
    }
  }
  if (membershipPolicyException != null) {
    throw membershipPolicyException;
  }
}
