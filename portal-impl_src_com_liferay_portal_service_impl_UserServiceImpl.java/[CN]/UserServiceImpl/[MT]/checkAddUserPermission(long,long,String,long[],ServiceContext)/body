{
  Company company=companyPersistence.findByPrimaryKey(companyId);
  boolean anonymousUser=GetterUtil.getBoolean(serviceContext.getAttribute("anonymousUser"));
  if ((creatorUserId != 0) || (!company.isStrangers() && !anonymousUser)) {
    if (!PortalPermissionUtil.contains(getPermissionChecker(),ActionKeys.ADD_USER) && !OrganizationPermissionUtil.contains(getPermissionChecker(),organizationIds,ActionKeys.ASSIGN_MEMBERS)) {
      throw new PrincipalException();
    }
  }
  if (creatorUserId == 0) {
    if (!company.isStrangersWithMx() && company.hasCompanyMx(emailAddress)) {
      throw new ReservedUserEmailAddressException();
    }
  }
}
