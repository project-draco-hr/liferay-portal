{
  if (userIds.length == 0) {
    return;
  }
  boolean hasPermission=GroupPermissionUtil.contains(getPermissionChecker(),groupId,ActionKeys.ASSIGN_MEMBERS);
  if (!hasPermission) {
    if (userIds.length == 1) {
      User user=getUser();
      if (user.getUserId() == userIds[0]) {
        Group group=groupPersistence.findByPrimaryKey(groupId);
        if (user.getCompanyId() == group.getCompanyId()) {
          int type=group.getType();
          if (type == GroupConstants.TYPE_SITE_OPEN) {
            hasPermission=true;
          }
        }
      }
    }
    if (!hasPermission) {
      throw new PrincipalException();
    }
  }
  SiteMembershipPolicyUtil.checkMembership(userIds,new long[]{groupId},null);
  userLocalService.addGroupUsers(groupId,userIds);
  SiteMembershipPolicyUtil.propagateMembership(userIds,new long[]{groupId},null);
}
