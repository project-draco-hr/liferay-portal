{
  try {
    OrganizationPermissionUtil.check(getPermissionChecker(),organizationId,ActionKeys.ASSIGN_MEMBERS);
    validateOrganizationUsers(userIds);
  }
 catch (  PrincipalException pe) {
    boolean hasPermission=false;
    if (userIds.length == 0) {
      hasPermission=true;
    }
 else     if (userIds.length == 1) {
      User user=getUser();
      if (user.getUserId() == userIds[0]) {
        Organization organization=organizationLocalService.getOrganization(organizationId);
        Group group=organization.getGroup();
        if (user.getCompanyId() == group.getCompanyId()) {
          int groupType=group.getType();
          if (groupType == GroupConstants.TYPE_COMMUNITY_OPEN) {
            hasPermission=true;
          }
        }
      }
    }
    if (!hasPermission) {
      throw new PrincipalException();
    }
  }
  userLocalService.addOrganizationUsers(organizationId,userIds);
}
