{
  long[] oldOrganizationIds=null;
  PermissionChecker permissionChecker=getPermissionChecker();
  if (userId != CompanyConstants.SYSTEM) {
    List<Organization> oldOrganizations=organizationLocalService.getUserOrganizations(userId);
    oldOrganizationIds=new long[oldOrganizations.size()];
    for (int i=0; i < oldOrganizations.size(); i++) {
      Organization organization=oldOrganizations.get(i);
      if (!ArrayUtil.contains(organizationIds,organization.getOrganizationId()) && (!OrganizationPermissionUtil.contains(permissionChecker,organization,ActionKeys.ASSIGN_MEMBERS) || OrganizationMembershipPolicyUtil.isMembershipProtected(permissionChecker,userId,organization.getOrganizationId()) || OrganizationMembershipPolicyUtil.isMembershipRequired(userId,organization.getOrganizationId()))) {
        organizationIds=ArrayUtil.append(organizationIds,organization.getOrganizationId());
      }
      oldOrganizationIds[i]=organization.getOrganizationId();
    }
  }
  for (  long organizationId : organizationIds) {
    if ((oldOrganizationIds != null) && ArrayUtil.contains(oldOrganizationIds,organizationId)) {
      continue;
    }
    Organization organization=organizationPersistence.findByPrimaryKey(organizationId);
    OrganizationPermissionUtil.check(permissionChecker,organization,ActionKeys.ASSIGN_MEMBERS);
  }
  return organizationIds;
}
