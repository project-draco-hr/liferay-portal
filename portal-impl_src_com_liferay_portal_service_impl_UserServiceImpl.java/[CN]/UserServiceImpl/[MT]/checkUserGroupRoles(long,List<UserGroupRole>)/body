{
  List<UserGroupRole> oldUserGroupRoles=null;
  PermissionChecker permissionChecker=getPermissionChecker();
  if (userId != CompanyConstants.SYSTEM) {
    oldUserGroupRoles=userGroupRoleLocalService.getUserGroupRoles(userId);
    for (    UserGroupRole oldUserGroupRole : oldUserGroupRoles) {
      if (!userGroupRoles.contains(oldUserGroupRole) && !UserGroupRolePermissionUtil.contains(permissionChecker,oldUserGroupRole.getGroupId(),oldUserGroupRole.getRoleId())) {
        userGroupRoles.add(oldUserGroupRole);
      }
    }
  }
  for (  UserGroupRole userGroupRole : userGroupRoles) {
    if ((oldUserGroupRoles == null) || !oldUserGroupRoles.contains(userGroupRole)) {
      UserGroupRolePermissionUtil.check(permissionChecker,userGroupRole.getGroupId(),userGroupRole.getRoleId());
    }
  }
  return userGroupRoles;
}
