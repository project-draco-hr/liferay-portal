{
  List<UserGroupRole> oldUserGroupRoles=userGroupRoleLocalService.getUserGroupRoles(userId);
  for (  UserGroupRole oldUserGroupRole : oldUserGroupRoles) {
    if (!userGroupRoles.contains(oldUserGroupRole) && (!GroupPermissionUtil.contains(getPermissionChecker(),oldUserGroupRole.getGroupId(),ActionKeys.ASSIGN_MEMBERS) || !RolePermissionUtil.contains(getPermissionChecker(),oldUserGroupRole.getRoleId(),ActionKeys.ASSIGN_MEMBERS))) {
      userGroupRoles.add(oldUserGroupRole);
    }
  }
  for (  UserGroupRole userGroupRole : userGroupRoles) {
    if (!oldUserGroupRoles.contains(userGroupRole)) {
      if (!GroupPermissionUtil.contains(getPermissionChecker(),userGroupRole.getGroupId(),ActionKeys.ASSIGN_MEMBERS) || !RolePermissionUtil.contains(getPermissionChecker(),userGroupRole.getRoleId(),ActionKeys.ASSIGN_MEMBERS)) {
        throw new PrincipalException();
      }
    }
  }
  return userGroupRoles;
}
