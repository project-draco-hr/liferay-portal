{
  for (  UserGroupRole userGroupRole : userGroupRoles) {
    if (!GroupPermissionUtil.contains(getPermissionChecker(),userGroupRole.getGroupId(),ActionKeys.ASSIGN_MEMBERS) || !RolePermissionUtil.contains(getPermissionChecker(),userGroupRole.getRoleId(),ActionKeys.ASSIGN_MEMBERS)) {
      throw new PrincipalException();
    }
  }
  List<UserGroupRole> previousGroupRoles=userGroupRoleLocalService.getUserGroupRoles(userId);
  for (  UserGroupRole userGroupRole : previousGroupRoles) {
    if (!userGroupRoles.contains(userGroupRole) && (!GroupPermissionUtil.contains(getPermissionChecker(),userGroupRole.getGroupId(),ActionKeys.ASSIGN_MEMBERS) || !RolePermissionUtil.contains(getPermissionChecker(),userGroupRole.getRoleId(),ActionKeys.ASSIGN_MEMBERS))) {
      userGroupRoles.add(userGroupRole);
    }
  }
  return userGroupRoles;
}
