{
  try {
    GroupPermissionUtil.check(getPermissionChecker(),groupId,ActionKeys.ASSIGN_MEMBERS);
  }
 catch (  PrincipalException pe) {
    boolean hasPermission=false;
    if (userIds.length == 0) {
      hasPermission=true;
    }
 else     if (userIds.length == 1) {
      User user=getUser();
      if (user.getUserId() == userIds[0]) {
        Group group=groupPersistence.findByPrimaryKey(groupId);
        if (user.getCompanyId() == group.getCompanyId()) {
          int type=group.getType();
          if (type == GroupConstants.TYPE_COMMUNITY_OPEN) {
            hasPermission=true;
          }
        }
      }
    }
    if (!hasPermission) {
      throw new PrincipalException();
    }
  }
  userLocalService.addGroupUsers(groupId,userIds);
}
