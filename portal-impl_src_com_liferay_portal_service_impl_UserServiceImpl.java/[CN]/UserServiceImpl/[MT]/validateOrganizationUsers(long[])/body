{
  PermissionChecker permissionChecker=getPermissionChecker();
  if (!PropsValues.ORGANIZATIONS_ASSIGNMENT_STRICT || permissionChecker.isCompanyAdmin()) {
    return;
  }
  List<Organization> organizations=organizationLocalService.getUserOrganizations(permissionChecker.getUserId());
  for (  long userId : userIds) {
    boolean allowed=false;
    for (    Organization organization : organizations) {
      boolean manageUsers=OrganizationPermissionUtil.contains(permissionChecker,organization,ActionKeys.MANAGE_USERS);
      boolean manageSuborganizations=OrganizationPermissionUtil.contains(permissionChecker,organization,ActionKeys.MANAGE_SUBORGANIZATIONS);
      if (!manageUsers && !manageSuborganizations) {
        continue;
      }
      boolean inherited=false;
      boolean includeSpecifiedOrganization=false;
      if (manageUsers && manageSuborganizations) {
        inherited=true;
        includeSpecifiedOrganization=true;
      }
 else       if (!manageUsers && manageSuborganizations) {
        inherited=true;
        includeSpecifiedOrganization=false;
      }
      if (organizationLocalService.hasUserOrganization(userId,organization.getOrganizationId(),inherited,includeSpecifiedOrganization)) {
        allowed=true;
        break;
      }
    }
    if (!allowed) {
      throw new PrincipalException();
    }
  }
}
