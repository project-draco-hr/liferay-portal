{
  try {
    String articleId=portletPreferences.getValue("article-id",null);
    if (articleId == null) {
      _log.warn("No article Id found in preferences of portlet id " + portletId);
      return null;
    }
    String articleGroupId=portletPreferences.getValue("group-id",null);
    if (articleGroupId == null) {
      _log.warn("No group Id found in preferences of portlet id " + portletId);
      return null;
    }
    JournalArticle article=null;
    try {
      article=JournalArticleLocalServiceUtil.getLatestArticle(companyId,articleGroupId,articleId);
    }
 catch (    NoSuchArticleException e) {
    }
    if (article == null) {
      _log.warn("No article found with an id of " + articleId + " for group id "+ articleGroupId+ " (referenced by portlet id "+ portletId+ ")");
      return null;
    }
    if (article.getGroupId().equals(groupId)) {
      SAXReader reader=SAXReaderFactory.getInstance();
      XStream xStream=new XStream();
      Document doc=DocumentHelper.createDocument();
      Element root=doc.addElement("journal-content");
      String xml=xStream.toXML(article);
      Document tempDoc=reader.read(new StringReader(xml));
      root.content().add(tempDoc.getRootElement().createCopy());
      String structureId=article.getStructureId();
      if (structureId != null) {
        JournalStructure structure=JournalStructureUtil.findByPrimaryKey(new JournalStructurePK(companyId,article.getGroupId(),structureId));
        xml=xStream.toXML(structure);
        tempDoc=reader.read(new StringReader(xml));
        root.content().add(tempDoc.getRootElement().createCopy());
      }
      String templateId=article.getTemplateId();
      if (templateId != null) {
        JournalTemplate template=JournalTemplateUtil.findByPrimaryKey(new JournalTemplatePK(companyId,article.getGroupId(),templateId));
        xml=xStream.toXML(template);
        tempDoc=reader.read(new StringReader(xml));
        root.content().add(tempDoc.getRootElement().createCopy());
      }
      return XMLFormatter.toString(doc);
    }
 else {
      return null;
    }
  }
 catch (  Exception e) {
    throw new PortletDataException(e);
  }
}
