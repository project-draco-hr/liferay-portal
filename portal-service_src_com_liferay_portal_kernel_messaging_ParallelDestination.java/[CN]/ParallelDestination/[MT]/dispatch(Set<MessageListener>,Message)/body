{
  if (!message.contains("companyId")) {
    message.put("companyId",CompanyThreadLocal.getCompanyId());
  }
  ThreadPoolExecutor threadPoolExecutor=getThreadPoolExecutor();
  for (  final MessageListener messageListener : messageListeners) {
    Runnable runnable=new MessageRunnable(message){
      public void run(){
        long companyId=CompanyThreadLocal.getCompanyId();
        try {
          long messageCompanyId=message.getLong("companyId");
          if (messageCompanyId > 0) {
            CompanyThreadLocal.setCompanyId(messageCompanyId);
          }
          messageListener.receive(message);
        }
 catch (        MessageListenerException mle) {
          _log.error("Unable to process message " + message,mle);
        }
 finally {
          CompanyThreadLocal.setCompanyId(companyId);
          CentralizedThreadLocal.clearShortLivedThreadLocals();
        }
      }
    }
;
    threadPoolExecutor.execute(runnable);
  }
}
