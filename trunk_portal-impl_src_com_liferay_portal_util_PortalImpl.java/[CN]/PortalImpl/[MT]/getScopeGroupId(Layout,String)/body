{
  if (layout == null) {
    return 0;
  }
  if (Validator.isNull(portletId)) {
    return layout.getGroupId();
  }
  boolean strict=PortletPreferencesThreadLocal.isStrict();
  PortletPreferencesThreadLocal.setStrict(true);
  try {
    PortletPreferences portletSetup=PortletPreferencesFactoryUtil.getLayoutPortletSetup(layout,portletId);
    String scopeType=GetterUtil.getString(portletSetup.getValue("lfr-scope-type",null));
    if (Validator.isNull(scopeType)) {
      return layout.getGroupId();
    }
    if (scopeType.equals("company")) {
      Group companyGroup=GroupLocalServiceUtil.getCompanyGroup(layout.getCompanyId());
      return companyGroup.getGroupId();
    }
 else {
      String scopeLayoutUuid=GetterUtil.getString(portletSetup.getValue("lfrScopeLayoutUuid",null));
      Layout scopeLayout=LayoutLocalServiceUtil.getLayoutByUuidAndGroupId(scopeLayoutUuid,layout.getGroupId());
      Group scopeGroup=scopeLayout.getScopeGroup();
      return scopeGroup.getGroupId();
    }
  }
 catch (  Exception e) {
    return layout.getGroupId();
  }
 finally {
    PortletPreferencesThreadLocal.setStrict(strict);
  }
}
