{
  long companyId=getCompanyId(request);
  if (companyId <= 0) {
    return null;
  }
  Company company=(Company)request.getAttribute(WebKeys.COMPANY);
  if (company == null) {
    try {
      company=CompanyLocalServiceUtil.getCompanyById(companyId);
    }
 catch (    NoSuchCompanyException nsce) {
      company=CompanyLocalServiceUtil.getCompanyById(PortalInstances.getDefaultCompanyId());
    }
    request.setAttribute(WebKeys.COMPANY,company);
  }
  return company;
}
