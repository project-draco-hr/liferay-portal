{
  colorSchemeId=GetterUtil.getString(colorSchemeId);
  Theme theme=getTheme(companyId,themeId,wapTheme);
  Map colorSchemesMap=theme.getColorSchemesMap();
  ColorScheme colorScheme=(ColorScheme)colorSchemesMap.get(colorSchemeId);
  if (colorScheme == null) {
    List colorSchemes=theme.getColorSchemes();
    if (colorSchemes.size() > 0) {
      for (int i=(colorSchemes.size() - 1); i >= 0; i--) {
        colorScheme=(ColorScheme)colorSchemes.get(i);
        if (colorScheme.isDefaultCs()) {
          break;
        }
      }
    }
  }
  if (colorScheme == null) {
    if (wapTheme) {
      colorSchemeId=ColorSchemeImpl.getDefaultWapColorSchemeId();
    }
 else {
      colorSchemeId=ColorSchemeImpl.getDefaultRegularColorSchemeId();
    }
  }
  if (colorScheme == null) {
    colorScheme=ColorSchemeImpl.getNullColorScheme();
  }
  return colorScheme;
}
