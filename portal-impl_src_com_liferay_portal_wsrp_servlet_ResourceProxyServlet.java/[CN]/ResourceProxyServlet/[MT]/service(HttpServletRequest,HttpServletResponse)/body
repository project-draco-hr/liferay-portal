{
  String targetUrl=req.getParameter("url");
  String cookie=req.getParameter("cookie");
  if (targetUrl != null) {
    try {
      long companyId=PortalInstances.getCompanyId(req);
      Company company=CompanyLocalServiceUtil.getCompanyById(companyId);
      Key key=company.getKeyObj();
      targetUrl=Encryptor.decryptRaw(key,Base64.decode(targetUrl));
      URL url=new URL(targetUrl);
      URLConnection con=url.openConnection();
      cookie=Encryptor.decryptRaw(key,Base64.decode(cookie));
      con.setRequestProperty("Cookie",cookie);
      con.connect();
      res.setContentType(con.getContentType());
      res.setContentLength(con.getContentLength());
      InputStream in=con.getInputStream();
      OutputStream out=res.getOutputStream();
      int next;
      while ((next=in.read()) != -1) {
        out.write(next);
      }
      out.flush();
      out.close();
    }
 catch (    Exception e) {
      _log.warn(e);
    }
  }
}
