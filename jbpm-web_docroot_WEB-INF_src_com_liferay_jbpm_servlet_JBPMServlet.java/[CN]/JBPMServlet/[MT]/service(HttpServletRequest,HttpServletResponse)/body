{
  String contentType=req.getHeader(HttpHeaders.CONTENT_TYPE);
  if (_log.isDebugEnabled()) {
    _log.debug("Content type " + contentType);
  }
  if ((contentType != null) && (contentType.startsWith(ContentTypes.MULTIPART_FORM_DATA))) {
    req=new UploadServletRequest(req);
  }
  WorkflowComponentImpl workflowComponentImpl=new WorkflowComponentImpl();
  String result=workflowComponentImpl.process(req);
  res.setContentType("text/xml");
  ServletOutputStream out=res.getOutputStream();
  try {
    if (!res.isCommitted()) {
      out.print(result);
    }
  }
 catch (  Exception e) {
    _log.warn(e,e);
  }
 finally {
    out.flush();
    out.close();
  }
}
