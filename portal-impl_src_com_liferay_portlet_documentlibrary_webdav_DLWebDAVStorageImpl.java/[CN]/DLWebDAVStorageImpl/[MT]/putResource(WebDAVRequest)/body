{
  File file=null;
  try {
    HttpServletRequest request=webDavRequest.getHttpServletRequest();
    String[] pathArray=webDavRequest.getPathArray();
    long groupId=webDavRequest.getGroupId();
    long parentFolderId=getParentFolderId(pathArray);
    String name=WebDAVUtil.getResourceName(pathArray);
    String title=name;
    String description=StringPool.BLANK;
    String extraSettings=StringPool.BLANK;
    ServiceContext serviceContext=new ServiceContext();
    Group group=GroupLocalServiceUtil.getGroup(groupId);
    if (!group.isUser()) {
      serviceContext.setAddCommunityPermissions(true);
    }
    serviceContext.setAddGuestPermissions(true);
    try {
      DLFileEntry entry=DLFileEntryServiceUtil.getFileEntryByTitle(groupId,parentFolderId,name);
      if (isLocked(entry,webDavRequest.getLockUuid())) {
        return WebDAVUtil.SC_LOCKED;
      }
      name=entry.getName();
      description=entry.getDescription();
      extraSettings=entry.getExtraSettings();
      String[] assetTagNames=AssetTagLocalServiceUtil.getTagNames(DLFileEntry.class.getName(),entry.getFileEntryId());
      serviceContext.setAssetTagNames(assetTagNames);
      DLFileEntryServiceUtil.updateFileEntry(groupId,parentFolderId,parentFolderId,name,title,title,description,extraSettings,FileUtil.getBytes(request.getInputStream()),serviceContext);
    }
 catch (    NoSuchFileEntryException nsfee) {
      file=FileUtil.createTempFile(FileUtil.getExtension(name));
      FileUtil.write(file,request.getInputStream());
      DLFileEntryServiceUtil.addFileEntry(groupId,parentFolderId,name,title,description,extraSettings,file,serviceContext);
    }
    return HttpServletResponse.SC_CREATED;
  }
 catch (  PrincipalException pe) {
    return HttpServletResponse.SC_FORBIDDEN;
  }
catch (  PortalException pe) {
    if (_log.isWarnEnabled()) {
      _log.warn(pe,pe);
    }
    return HttpServletResponse.SC_CONFLICT;
  }
catch (  Exception e) {
    throw new WebDAVException(e);
  }
 finally {
    if (file != null) {
      file.delete();
    }
  }
}
