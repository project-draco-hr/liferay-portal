{
  Resource resource=getResource(webDavRequest);
  Lock lock=null;
  int status=HttpServletResponse.SC_OK;
  try {
    if (resource == null) {
      status=HttpServletResponse.SC_CREATED;
      String[] pathArray=webDavRequest.getPathArray();
      long companyId=webDavRequest.getCompanyId();
      long groupId=webDavRequest.getGroupId();
      long parentFolderId=getParentFolderId(companyId,pathArray);
      String name=WebDAVUtil.getResourceName(pathArray);
      String title=name;
      String description=StringPool.BLANK;
      String changeLog=StringPool.BLANK;
      String extraSettings=StringPool.BLANK;
      File file=FileUtil.createTempFile(FileUtil.getExtension(name));
      file.createNewFile();
      ServiceContext serviceContext=new ServiceContext();
      serviceContext.setAddCommunityPermissions(isAddCommunityPermissions(groupId));
      serviceContext.setAddGuestPermissions(true);
      DLFileEntry fileEntry=DLAppServiceUtil.addFileEntry(groupId,parentFolderId,name,title,description,changeLog,extraSettings,file,serviceContext);
      resource=toResource(webDavRequest,fileEntry,false);
    }
    if (resource instanceof DLFileEntryResourceImpl) {
      DLFileEntry fileEntry=(DLFileEntry)resource.getModel();
      lock=DLAppServiceUtil.lockFileEntry(fileEntry.getGroupId(),fileEntry.getFolderId(),fileEntry.getName(),owner,timeout);
    }
 else {
      boolean inheritable=false;
      long depth=WebDAVUtil.getDepth(webDavRequest.getHttpServletRequest());
      if (depth != 0) {
        inheritable=true;
      }
      DLFolder folder=(DLFolder)resource.getModel();
      lock=DLAppServiceUtil.lockFolder(folder.getFolderId(),owner,inheritable,timeout);
    }
  }
 catch (  Exception e) {
    if (!(e instanceof DuplicateLockException)) {
      throw new WebDAVException(e);
    }
    status=WebDAVUtil.SC_LOCKED;
  }
  return new Status(lock,status);
}
