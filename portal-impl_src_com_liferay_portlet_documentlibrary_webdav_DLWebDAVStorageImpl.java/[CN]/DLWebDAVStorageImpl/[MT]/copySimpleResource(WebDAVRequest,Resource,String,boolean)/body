{
  File file=null;
  try {
    String[] destinationArray=WebDAVUtil.getPathArray(destination,true);
    long parentFolderId=DLFolderImpl.DEFAULT_PARENT_FOLDER_ID;
    try {
      parentFolderId=getParentFolderId(destinationArray);
    }
 catch (    NoSuchFolderException nsfe) {
      return HttpServletResponse.SC_CONFLICT;
    }
    DLFileEntry fileEntry=(DLFileEntry)resource.getModel();
    long groupId=WebDAVUtil.getGroupId(destination);
    long userId=webDavRequest.getUserId();
    String name=WebDAVUtil.getResourceName(destinationArray);
    String title=WebDAVUtil.getResourceName(destinationArray);
    String description=fileEntry.getDescription();
    String extraSettings=fileEntry.getExtraSettings();
    file=FileUtil.createTempFile(FileUtil.getExtension(fileEntry.getName()));
    InputStream is=DLFileEntryLocalServiceUtil.getFileAsStream(fileEntry.getCompanyId(),userId,fileEntry.getFolderId(),fileEntry.getName());
    FileUtil.write(file,is);
    ServiceContext serviceContext=new ServiceContext();
    serviceContext.setAddCommunityPermissions(true);
    serviceContext.setAddGuestPermissions(true);
    int status=HttpServletResponse.SC_CREATED;
    if (overwrite) {
      if (deleteResource(groupId,parentFolderId,title,webDavRequest.getLockUuid())) {
        status=HttpServletResponse.SC_NO_CONTENT;
      }
    }
    DLFileEntryServiceUtil.addFileEntry(parentFolderId,name,title,description,extraSettings,file,serviceContext);
    return status;
  }
 catch (  DuplicateFolderNameException dfne) {
    return HttpServletResponse.SC_PRECONDITION_FAILED;
  }
catch (  DuplicateFileException dfe) {
    return HttpServletResponse.SC_PRECONDITION_FAILED;
  }
catch (  LockException le) {
    return WebDAVUtil.SC_LOCKED;
  }
catch (  PrincipalException pe) {
    return HttpServletResponse.SC_FORBIDDEN;
  }
catch (  Exception e) {
    throw new WebDAVException(e);
  }
 finally {
    if (file != null) {
      file.delete();
    }
  }
}
