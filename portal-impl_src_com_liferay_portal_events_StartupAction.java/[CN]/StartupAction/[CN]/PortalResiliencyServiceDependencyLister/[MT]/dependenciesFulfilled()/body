{
  Registry registry=RegistryUtil.getRegistry();
  MessageBus messageBus=registry.getService(MessageBus.class);
  try {
    DistributedRegistry.registerDistributed(ComponentConstants.COMPONENT_CONTEXT,Direction.DUPLEX,MatchType.POSTFIX);
    DistributedRegistry.registerDistributed(MimeResponse.MARKUP_HEAD_ELEMENT,Direction.DUPLEX,MatchType.EXACT);
    DistributedRegistry.registerDistributed(PortletRequest.LIFECYCLE_PHASE,Direction.DUPLEX,MatchType.EXACT);
    DistributedRegistry.registerDistributed(WebKeys.class);
    Intraband intraband=MPIHelperUtil.getIntraband();
    intraband.registerDatagramReceiveHandler(SystemDataType.MAILBOX.getValue(),new MailboxDatagramReceiveHandler());
    intraband.registerDatagramReceiveHandler(SystemDataType.MESSAGE.getValue(),new MessageDatagramReceiveHandler(messageBus));
    intraband.registerDatagramReceiveHandler(SystemDataType.PROXY.getValue(),new IntrabandProxyDatagramReceiveHandler());
    intraband.registerDatagramReceiveHandler(SystemDataType.RPC.getValue(),new RPCDatagramReceiveHandler());
    if (PropsValues.PORTAL_FABRIC_ENABLED) {
      FabricServerUtil.start();
    }
  }
 catch (  Exception e) {
    throw new IllegalStateException("Unable to initialize portal resiliency",e);
  }
}
