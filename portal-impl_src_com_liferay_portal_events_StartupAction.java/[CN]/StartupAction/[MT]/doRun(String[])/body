{
  System.out.println("Starting " + ReleaseInfo.getReleaseInfo());
  ServiceDependencyManager portalResiliencyServiceDependencyManager=new ServiceDependencyManager();
  portalResiliencyServiceDependencyManager.registerDependencies(MessageBus.class,PortalExecutorManager.class);
  portalResiliencyServiceDependencyManager.addServiceDependencyListener(new PortalResiliencyServiceDependencyLister());
  if (_log.isDebugEnabled()) {
    _log.debug("Add shutdown hook");
  }
  Runtime runtime=Runtime.getRuntime();
  runtime.addShutdownHook(new Thread(new ShutdownHook()));
  IndexerRegistryUtil.register(new MBMessageIndexer());
  IndexerRegistryUtil.register(new PluginPackageIndexer());
  if (_log.isDebugEnabled()) {
    _log.debug("Upgrade database");
  }
  DBUpgrader.upgrade();
  if (_log.isDebugEnabled()) {
    _log.debug("Clear locks");
  }
  try {
    LockLocalServiceUtil.clear();
  }
 catch (  Exception e) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to clear locks because Lock table does not exist");
    }
  }
  ClusterLinkBootstrapLoaderHelperUtil.start();
  if (_log.isDebugEnabled()) {
    _log.debug("Initialize scheduler engine lifecycle");
  }
  SchedulerEngineHelperUtil.initialize();
  if (_log.isDebugEnabled()) {
    _log.debug("Verify database");
  }
  DBUpgrader.verify();
  ServiceDependencyManager backgroundTaskServiceDependencyManager=new ServiceDependencyManager();
  backgroundTaskServiceDependencyManager.registerDependencies(ClusterExecutor.class,ClusterMasterExecutor.class);
  backgroundTaskServiceDependencyManager.addServiceDependencyListener(new ServiceDependencyListener(){
    @Override public void dependenciesFulfilled(){
      Registry registry=RegistryUtil.getRegistry();
      ClusterMasterExecutor clusterMasterExecutor=registry.getService(ClusterMasterExecutor.class);
      if (!clusterMasterExecutor.isEnabled()) {
        BackgroundTaskLocalServiceUtil.cleanUpBackgroundTasks();
      }
    }
    @Override public void destroy(){
    }
  }
);
  JspFactorySwapper.swap();
  CachedLoggerProvider.install();
}
