{
  try {
    String uri=request.getRequestURI();
    if (uri.equals("/_vti_bin/shtml.dll/_vti_rpc") || uri.equals("/sharepoint/_vti_bin/_vti_aut/author.dll")) {
      User user=(User)request.getSession().getAttribute(WebKeys.USER);
      SharepointRequest sharepointRequest=new SharepointRequest(request,response,user);
      addParams(request,sharepointRequest);
      Method method=MethodFactory.create(sharepointRequest);
      String rootPath=method.getRootPath(sharepointRequest);
      if (rootPath == null) {
        throw new SharepointException("Unabled to get root path");
      }
      int pos=rootPath.lastIndexOf("sharepoint/");
      if (pos != -1) {
        rootPath=rootPath.substring(pos + 11);
      }
      pos=rootPath.lastIndexOf("webdav/");
      if (pos != -1) {
        rootPath=rootPath.substring(pos + 7);
      }
      sharepointRequest.setRootPath(rootPath);
      SharepointStorage storage=SharepointUtil.getStorage(rootPath);
      sharepointRequest.setSharepointStorage(storage);
      method.process(sharepointRequest);
    }
  }
 catch (  SharepointException se) {
    _log.error(se,se);
  }
}
