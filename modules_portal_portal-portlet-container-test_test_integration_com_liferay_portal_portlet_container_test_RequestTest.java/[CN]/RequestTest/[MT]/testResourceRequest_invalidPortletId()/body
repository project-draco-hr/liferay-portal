{
  HttpServletRequest request=getHttpServletRequest();
  String rootUrl=layout.getRegularURL(request);
  String url=rootUrl + "?p_p_id='\"><script>alert(1)</script>&p_p_lifecycle=2&";
  try (CaptureAppender captureAppender=Log4JLoggerTestUtil.configureLog4JLogger(SecurityPortletContainerWrapper.class.getName(),Level.WARN)){
    Map<String,List<String>> responseMap=request(url);
    List<LoggingEvent> loggingEvents=captureAppender.getLoggingEvents();
    Assert.assertEquals(2,loggingEvents.size());
    LoggingEvent loggingEvent=loggingEvents.get(0);
    Assert.assertEquals("Invalid portlet ID '\"><script>alert(1)</script>",loggingEvent.getMessage());
    loggingEvent=loggingEvents.get(1);
    Assert.assertEquals("Reject serveResource for " + rootUrl + " on '\"><script>alert(1)</script>",loggingEvent.getMessage());
    Assert.assertEquals("400",responseMap.get("responseCode").get(0));
  }
 }
