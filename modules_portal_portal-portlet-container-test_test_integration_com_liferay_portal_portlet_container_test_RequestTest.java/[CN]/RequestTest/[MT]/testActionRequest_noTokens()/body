{
  setUpPortlet(requestTestPortlet,properties,_TEST_PORTLET_ID);
  HttpServletRequest request=getHttpServletRequest();
  PortletURL portletURL=new PortletURLImpl(request,_TEST_PORTLET_ID,layout.getPlid(),PortletRequest.ACTION_PHASE);
  String url=portletURL.toString();
  try (CaptureAppender captureAppender=Log4JLoggerTestUtil.configureLog4JLogger(SecurityPortletContainerWrapper.class.getName(),Level.WARN)){
    Map<String,List<String>> responseMap=request(url);
    List<LoggingEvent> loggingEvents=captureAppender.getLoggingEvents();
    Assert.assertEquals(1,loggingEvents.size());
    LoggingEvent loggingEvent=loggingEvents.get(0);
    String rootUrl=url.substring(0,url.indexOf('?'));
    Assert.assertEquals("User 0 is not allowed to access URL " + rootUrl + " and portlet "+ _TEST_PORTLET_ID,loggingEvent.getMessage());
    Assert.assertEquals("200",responseMap.get("code").get(0));
    Assert.assertFalse(map.containsKey("processAction"));
  }
 }
