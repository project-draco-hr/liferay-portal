{
  setUpPortlet(requestTestPortlet,properties,PortletKeys.TEST_PORTLET);
  HttpServletRequest request=getHttpServletRequest();
  PortletURL portletURL=new PortletURLImpl(request,PortletKeys.TEST_PORTLET,layout.getPlid(),PortletRequest.ACTION_PHASE);
  String url=portletURL.toString();
  try (CaptureAppender captureAppender=Log4JLoggerTestUtil.configureLog4JLogger(SecurityPortletContainerWrapper.class.getName(),Level.WARN)){
    Map<String,List<String>> responseMap=request(url);
    List<LoggingEvent> loggingEvents=captureAppender.getLoggingEvents();
    Assert.assertEquals(1,loggingEvents.size());
    LoggingEvent loggingEvent=loggingEvents.get(0);
    String rootUrl=url.substring(0,url.indexOf('?'));
    Assert.assertEquals("User 0 is not allowed to access URL " + rootUrl + " and portlet "+ PortletKeys.TEST_PORTLET,loggingEvent.getMessage());
    Assert.assertEquals("200",responseMap.get("responseCode").get(0));
    Assert.assertFalse(map.containsKey("processAction"));
  }
 }
