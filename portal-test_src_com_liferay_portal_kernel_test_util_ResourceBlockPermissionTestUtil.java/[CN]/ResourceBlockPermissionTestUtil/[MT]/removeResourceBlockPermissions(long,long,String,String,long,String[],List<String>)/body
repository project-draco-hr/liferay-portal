{
  List<String> resourceActionsIds=ResourceActionsUtil.getResourceActions(portletResource,resourceName);
  Map<Long,String[]> roleIdsToActionIds=new HashMap<>();
  for (  String roleName : roleNames) {
    Role role=RoleLocalServiceUtil.getRole(companyId,roleName);
    List<String> roleActionIds=ListUtil.copy(resourceActionsIds);
    if (roleName.equals(RoleConstants.GUEST)) {
      List<String> unsupportedActionIds=ResourceActionsUtil.getResourceGuestUnsupportedActions(portletResource,resourceName);
      roleActionIds.removeAll(unsupportedActionIds);
    }
    roleActionIds.removeAll(actionIds);
    roleIdsToActionIds.put(role.getRoleId(),ArrayUtil.toStringArray(roleActionIds));
  }
  ResourceBlockLocalServiceUtil.setIndividualScopePermissions(companyId,groupId,resourceName,classPK,roleIdsToActionIds);
}
