{
  try {
    if (messageIds.length == 0) {
      return createJSONResult("failure","no-messages-selected");
    }
    Message message=MessageLocalServiceUtil.getMessage(messageIds[0]);
    Account account=AccountLocalServiceUtil.getAccount(message.getAccountId());
    if (account.getDraftFolderId() == message.getFolderId()) {
      for (      long messageId : messageIds) {
        MessageLocalServiceUtil.deleteMessage(messageId);
      }
      return createJSONResult("success","drafts-have-been-discarded");
    }
 else {
      Mailbox mailbox=MailboxFactoryUtil.getMailbox(_user.getUserId(),message.getAccountId(),_passwordRetriever.getPassword(message.getAccountId()));
      mailbox.deleteMessages(message.getFolderId(),messageIds);
      return createJSONResult("success","messages-have-been-deleted");
    }
  }
 catch (  MailException me) {
    _log.error(me,me);
    return createJSONResult("failure","unable-to-delete-messages");
  }
}
