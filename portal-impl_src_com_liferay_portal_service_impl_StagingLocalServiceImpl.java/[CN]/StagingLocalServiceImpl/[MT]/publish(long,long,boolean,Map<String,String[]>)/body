{
  Folder folder=PortletFileRepositoryUtil.getPortletFolder(folderId);
  List<FileEntry> fileEntries=PortletFileRepositoryUtil.getPortletFileEntries(folder.getGroupId(),folder.getFolderId());
  File tempFile=null;
  FileOutputStream fileOutputStream=null;
  try {
    tempFile=FileUtil.createTempFile("lar");
    fileOutputStream=new FileOutputStream(tempFile);
    for (    FileEntry fileEntry : fileEntries) {
      InputStream inputStream=fileEntry.getContentStream();
      try {
        StreamUtil.transfer(inputStream,fileOutputStream,false);
      }
  finally {
        StreamUtil.cleanUp(inputStream);
      }
    }
    StreamUtil.cleanUp(fileOutputStream);
    String md5Checksum=FileUtil.getMD5Checksum(tempFile);
    if (!folder.getName().equals(md5Checksum)) {
      throw new SystemException("Invalid checksum for LAR file. Please retry");
    }
    layoutLocalService.importLayouts(userId,folder.getGroupId(),privateLayout,parameterMap,tempFile);
  }
 catch (  IOException ioe) {
    throw new SystemException("Unable to concatenate lar file",ioe);
  }
 finally {
    StreamUtil.cleanUp(fileOutputStream);
    FileUtil.delete(tempFile);
  }
}
