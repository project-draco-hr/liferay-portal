{
  File file=null;
  MissingReferences missingReferences=null;
  try {
    ExportImportThreadLocal.setLayoutImportInProcess(true);
    Folder folder=PortletFileRepositoryUtil.getPortletFolder(stagingRequestId);
    FileEntry stagingRequestFileEntry=getStagingRequestFileEntry(userId,stagingRequestId,folder);
    file=FileUtil.createTempFile("lar");
    FileUtil.write(file,stagingRequestFileEntry.getContentStream());
    layoutLocalService.importLayoutsDataDeletions(userId,folder.getGroupId(),privateLayout,parameterMap,file);
    missingReferences=layoutLocalService.validateImportLayoutsFile(userId,folder.getGroupId(),privateLayout,parameterMap,file);
    layoutLocalService.importLayouts(userId,folder.getGroupId(),privateLayout,parameterMap,file);
  }
 catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
 finally {
    ExportImportThreadLocal.setLayoutImportInProcess(false);
  }
  return missingReferences;
}
