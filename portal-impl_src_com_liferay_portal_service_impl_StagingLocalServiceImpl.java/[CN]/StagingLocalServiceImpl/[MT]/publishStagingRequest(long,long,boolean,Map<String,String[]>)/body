{
  File file=null;
  FileOutputStream fileOutputStream=null;
  try {
    file=FileUtil.createTempFile("lar");
    fileOutputStream=new FileOutputStream(file);
    Folder folder=PortletFileRepositoryUtil.getPortletFolder(stagingRequestId);
    List<FileEntry> fileEntries=PortletFileRepositoryUtil.getPortletFileEntries(folder.getGroupId(),folder.getFolderId());
    for (    FileEntry fileEntry : fileEntries) {
      InputStream inputStream=fileEntry.getContentStream();
      try {
        StreamUtil.transfer(inputStream,fileOutputStream,false);
      }
  finally {
        StreamUtil.cleanUp(inputStream);
      }
    }
    String checksum=FileUtil.getMD5Checksum(file);
    if (!checksum.equals(folder.getName())) {
      throw new SystemException("Invalid checksum for LAR file");
    }
    layoutLocalService.importLayouts(userId,folder.getGroupId(),privateLayout,parameterMap,file);
  }
 catch (  IOException ioe) {
    throw new SystemException("Unable to reassemble LAR file",ioe);
  }
 finally {
    StreamUtil.cleanUp(fileOutputStream);
    FileUtil.delete(file);
  }
}
