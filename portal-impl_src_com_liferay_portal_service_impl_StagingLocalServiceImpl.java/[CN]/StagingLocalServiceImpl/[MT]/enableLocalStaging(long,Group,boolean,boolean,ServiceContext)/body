{
  if (liveGroup.isStagedRemotely()) {
    disableStaging(liveGroup,serviceContext);
  }
  UnicodeProperties typeSettingsProperties=liveGroup.getTypeSettingsProperties();
  typeSettingsProperties.setProperty("branchingPrivate",String.valueOf(branchingPrivate));
  typeSettingsProperties.setProperty("branchingPublic",String.valueOf(branchingPublic));
  typeSettingsProperties.setProperty("staged",Boolean.TRUE.toString());
  typeSettingsProperties.setProperty("stagedRemotely",String.valueOf(false));
  setCommonStagingOptions(liveGroup,typeSettingsProperties,serviceContext);
  groupLocalService.updateGroup(liveGroup.getGroupId(),typeSettingsProperties.toString());
  if (!liveGroup.hasStagingGroup()) {
    serviceContext.setAttribute("staging",String.valueOf(true));
    long parentGroupId=GroupConstants.DEFAULT_PARENT_GROUP_ID;
    if (liveGroup.getParentGroupId() != GroupConstants.DEFAULT_PARENT_GROUP_ID) {
      Group parentGroup=liveGroup.getParentGroup();
      if (parentGroup.hasStagingGroup()) {
        parentGroup=parentGroup.getStagingGroup();
      }
      parentGroupId=parentGroup.getGroupId();
    }
    Group stagingGroup=groupLocalService.addGroup(userId,parentGroupId,liveGroup.getClassName(),liveGroup.getClassPK(),liveGroup.getGroupId(),liveGroup.getDescriptiveName(),liveGroup.getDescription(),liveGroup.getType(),liveGroup.isManualMembership(),liveGroup.getMembershipRestriction(),liveGroup.getFriendlyURL(),false,liveGroup.isActive(),serviceContext);
    Map<String,String[]> parameterMap=StagingUtil.getStagingParameters();
    if (liveGroup.hasPrivateLayouts()) {
      StagingUtil.publishLayouts(userId,liveGroup.getGroupId(),stagingGroup.getGroupId(),true,parameterMap,null,null);
    }
    if (liveGroup.hasPublicLayouts() || !liveGroup.hasPrivateLayouts()) {
      StagingUtil.publishLayouts(userId,liveGroup.getGroupId(),stagingGroup.getGroupId(),false,parameterMap,null,null);
    }
  }
  StagingUtil.checkDefaultLayoutSetBranches(userId,liveGroup,branchingPublic,branchingPrivate,false,serviceContext);
}
