{
  Map<Long,Long> publishedLayoutRevisions=new HashMap<Long,Long>();
  for (  Long lastPublishDate : lastPublishDates) {
    Long layoutSetBranchId=publishedLayoutSetBranches.get(lastPublishDate);
    LayoutSetBranch layoutSetBranch=layoutSetBranchLocalService.getLayoutSetBranch(layoutSetBranchId);
    List<LayoutRevision> headRevisions=layoutRevisionLocalService.getLayoutRevisions(layoutSetBranch.getLayoutSetBranchId(),true);
    for (    LayoutRevision layoutRevision : headRevisions) {
      Date statusDate=layoutRevision.getStatusDate();
      if (statusDate.getTime() <= lastPublishDate) {
        publishedLayoutRevisions.put(layoutRevision.getPlid(),layoutRevision.getLayoutRevisionId());
      }
    }
  }
  return publishedLayoutRevisions;
}
