{
  Thread currentThread=Thread.currentThread();
  ClassLoader classLoader=currentThread.getContextClassLoader();
  sql=PortalUtil.transformSQL(sql);
  if (!_useUpgradeOptimizedPreparedStatementHandler) {
    return _connection.prepareStatement(sql);
  }
  PreparedStatement preparedStatement=_connection.prepareStatement(sql,ResultSet.TYPE_SCROLL_SENSITIVE,ResultSet.CONCUR_UPDATABLE);
  return (PreparedStatement)ProxyUtil.newProxyInstance(classLoader,new Class[]{PreparedStatement.class},new UpgradeOptimizedPreparedStatementHandler(preparedStatement));
}
