{
  MBMessage message=MBMessageUtil.findByPrimaryKey(new MBMessagePK(MBMessageImpl.DEPRECATED_TOPIC_ID,messageId));
  message.setCreateDate(createDate);
  message.setModifiedDate(modifiedDate);
  MBMessageUtil.update(message);
  MBThread thread=MBThreadUtil.findByPrimaryKey(message.getThreadId());
  if (message.isAnonymous()) {
    thread.setLastPostByUserId(null);
  }
 else {
    thread.setLastPostByUserId(message.getUserId());
  }
  thread.setLastPostDate(modifiedDate);
  MBThreadUtil.update(thread);
  MBCategory category=MBCategoryUtil.findByPrimaryKey(message.getCategoryId());
  category.setLastPostDate(modifiedDate);
  MBCategoryUtil.update(category);
  return message;
}
