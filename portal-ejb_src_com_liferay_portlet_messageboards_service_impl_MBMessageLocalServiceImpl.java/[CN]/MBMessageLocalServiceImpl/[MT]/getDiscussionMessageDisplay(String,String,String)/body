{
  MBMessage message=null;
  try {
    MBDiscussion discussion=MBDiscussionUtil.findByC_C(className,classPK);
    List messages=MBMessageUtil.findByT_P(discussion.getThreadId(),MBMessage.DEFAULT_PARENT_MESSAGE_ID);
    message=(MBMessage)messages.get(0);
  }
 catch (  NoSuchDiscussionException nsde) {
    message=MBMessageLocalServiceUtil.addDiscussionMessage(userId,className + "_" + classPK,className + "_" + classPK);
    String discussionId=Long.toString(CounterLocalServiceUtil.increment(MBDiscussion.class.getName()));
    MBDiscussion discussion=MBDiscussionUtil.create(discussionId);
    discussion.setClassName(className);
    discussion.setClassPK(classPK);
    discussion.setThreadId(message.getThreadId());
    MBDiscussionUtil.update(discussion);
  }
  return getMessageDisplay(message,userId);
}
