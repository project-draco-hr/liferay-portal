{
  User user=UserLocalServiceUtil.getUser(userId);
  Account account=AccountLocalServiceUtil.getAccount(accountId);
  MailboxFactory mailboxFactory=_mailboxFactories.get(account.getProtocol());
  if (mailboxFactory == null) {
    throw new IllegalArgumentException("Invalid protocol " + account.getProtocol());
  }
  return mailboxFactory.getMailbox(user,account,password);
}
