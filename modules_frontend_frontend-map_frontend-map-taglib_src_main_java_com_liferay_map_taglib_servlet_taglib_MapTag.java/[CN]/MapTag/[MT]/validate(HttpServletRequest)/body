{
  if (Validator.isNull(_apiKey) || Validator.isNull(_provider)) {
    ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
    Company company=themeDisplay.getCompany();
    Group group=themeDisplay.getSiteGroup();
    if (group.isStagingGroup()) {
      group=group.getLiveGroup();
    }
    UnicodeProperties groupTypeSettings=new UnicodeProperties();
    if (group != null) {
      groupTypeSettings=group.getTypeSettingsProperties();
    }
    PortletPreferences companyPortletPreferences=PrefsPropsUtil.getPreferences(company.getCompanyId());
    if (Validator.isNull(_apiKey)) {
      _apiKey=groupTypeSettings.getProperty("googleMapsAPIKey",companyPortletPreferences.getValue("googleMapsAPIKey",null));
    }
    if (Validator.isNull(_provider)) {
      _provider=groupTypeSettings.getProperty("mapsAPIProvider",companyPortletPreferences.getValue("mapsAPIProvider","Google"));
    }
  }
}
