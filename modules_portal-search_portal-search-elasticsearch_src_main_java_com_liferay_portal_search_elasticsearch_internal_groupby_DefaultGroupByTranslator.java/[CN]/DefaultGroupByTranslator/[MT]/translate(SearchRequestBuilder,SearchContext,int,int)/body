{
  GroupBy groupBy=searchContext.getGroupBy();
  TermsBuilder termsBuilder=AggregationBuilders.terms(GROUP_BY_AGGREGATION_PREFIX + groupBy.getField());
  termsBuilder=termsBuilder.field(groupBy.getField());
  TopHitsBuilder topHitsBuilder=getTopHitsBuilder(searchContext,start,end,groupBy);
  termsBuilder.subAggregation(topHitsBuilder);
  searchRequestBuilder.addAggregation(termsBuilder);
}
