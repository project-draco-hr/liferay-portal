{
  OutputStream os=null;
  try {
    String extension=".ics";
    if (Validator.isNull(fileName)) {
      fileName="liferay.";
    }
 else {
      int pos=fileName.lastIndexOf(StringPool.PERIOD);
      if (pos != -1) {
        extension=fileName.substring(pos);
        fileName=fileName.substring(0,pos);
      }
    }
    File file=File.createTempFile(fileName,extension);
    os=new BufferedOutputStream(new FileOutputStream(file.getPath()));
    CalendarOutputter calOutput=new CalendarOutputter();
    if (cal.getComponents().isEmpty()) {
      calOutput.setValidating(false);
    }
    calOutput.output(cal,os);
    return file;
  }
 catch (  Exception e) {
    _log.error(e,e);
    throw new SystemException(e);
  }
 finally {
    StreamUtil.cleanUp(os);
  }
}
