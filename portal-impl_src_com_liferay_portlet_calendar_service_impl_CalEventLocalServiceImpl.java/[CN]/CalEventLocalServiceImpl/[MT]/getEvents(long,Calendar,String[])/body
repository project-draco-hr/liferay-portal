{
  if (types != null) {
    types=ArrayUtil.distinct(types);
    Arrays.sort(types);
  }
  Map<String,List<CalEvent>> eventsPool=CalEventLocalUtil.getEventsPool(groupId);
  String key=CalUtil.toString(cal,types);
  List<CalEvent> events=eventsPool.get(key);
  if (events != null) {
    return events;
  }
  List<CalEvent> timeZoneSensitiveEvents=calEventFinder.findByG_SD_T(groupId,CalendarUtil.getGTDate(cal),CalendarUtil.getLTDate(cal),true,types);
  Calendar tzICal=CalendarFactoryUtil.getCalendar(TimeZoneUtil.getTimeZone(StringPool.UTC));
  tzICal.set(cal.get(Calendar.YEAR),cal.get(Calendar.MONTH),cal.get(Calendar.DATE));
  List<CalEvent> timeZoneInsensitiveEvents=calEventFinder.findByG_SD_T(groupId,CalendarUtil.getGTDate(tzICal),CalendarUtil.getLTDate(tzICal),false,types);
  events=new ArrayList<CalEvent>();
  events.addAll(timeZoneSensitiveEvents);
  events.addAll(timeZoneInsensitiveEvents);
  events.addAll(getRepeatingEvents(groupId,cal,types));
  events=Collections.unmodifiableList(events);
  eventsPool.put(key,events);
  return events;
}
