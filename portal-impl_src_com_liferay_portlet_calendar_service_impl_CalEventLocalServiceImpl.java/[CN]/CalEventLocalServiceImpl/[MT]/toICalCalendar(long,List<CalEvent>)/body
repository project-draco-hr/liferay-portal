{
  net.fortuna.ical4j.model.Calendar iCal=new net.fortuna.ical4j.model.Calendar();
  ProdId prodId=new ProdId("-//Liferay Inc//Liferay Portal " + ReleaseInfo.getVersion() + "//EN");
  PropertyList propertiesList=iCal.getProperties();
  propertiesList.add(prodId);
  propertiesList.add(Version.VERSION_2_0);
  propertiesList.add(CalScale.GREGORIAN);
  propertiesList.add(Method.PUBLISH);
  User user=userPersistence.findByPrimaryKey(userId);
  TimeZone timeZone=user.getTimeZone();
  List<VEvent> components=iCal.getComponents();
  for (  CalEvent event : events) {
    components.add(toICalVEvent(event,timeZone));
  }
  return iCal;
}
