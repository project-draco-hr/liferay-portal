{
  net.fortuna.ical4j.model.Calendar iCal=new net.fortuna.ical4j.model.Calendar();
  ProdId prodId=new ProdId("-//Liferay Inc//Liferay Portal " + ReleaseInfo.getVersion() + "//EN");
  PropertyList props=iCal.getProperties();
  props.add(prodId);
  props.add(Version.VERSION_2_0);
  props.add(CalScale.GREGORIAN);
  props.add(Method.PUBLISH);
  User user=userPersistence.findByPrimaryKey(userId);
  TimeZone timeZone=user.getTimeZone();
  List<VEvent> components=iCal.getComponents();
  Iterator<CalEvent> itr=events.iterator();
  while (itr.hasNext()) {
    CalEvent event=itr.next();
    components.add(toICalVEvent(event,timeZone));
  }
  return iCal;
}
