{
  Object model=_results.get(_rowIndex);
  if (isEscapedModel()) {
    try {
      ClassLoader classLoader=null;
      if (_servletContext != null) {
        classLoader=(ClassLoader)PortletBeanLocatorUtil.locate(_servletContext.getServletContextName(),"portletClassLoader");
      }
      if (classLoader == null) {
        Thread currentThread=Thread.currentThread();
        classLoader=currentThread.getContextClassLoader();
      }
      Class<?> classObj=classLoader.loadClass(_className);
      Method method=classObj.getMethod("toEscapedModel",new Class[0]);
      model=method.invoke(model,new Object[0]);
    }
 catch (    Exception e) {
      throw new JspException(e.getMessage());
    }
  }
  if (_log.isDebugEnabled()) {
    _log.debug(BeanPropertiesUtil.getBoolean(model,"escapedModel"));
  }
  if (Validator.isNull(_keyProperty)) {
    String primaryKey=String.valueOf(model);
    _row=new ResultRow(model,primaryKey,_rowIndex,_bold);
  }
 else   if (isStringKey()) {
    String primaryKey=BeanPropertiesUtil.getString(model,_keyProperty);
    _row=new ResultRow(model,primaryKey,_rowIndex,_bold);
  }
 else {
    Object primaryKey=BeanPropertiesUtil.getObject(model,_keyProperty);
    _row=new ResultRow(model,String.valueOf(primaryKey),_rowIndex,_bold);
  }
  pageContext.setAttribute(_indexVar,_rowIndex);
  pageContext.setAttribute(_modelVar,model);
  pageContext.setAttribute(_rowVar,_row);
}
