{
  User user=UserLocalServiceUtil.getUser(userId);
  Date now=new Date();
  long oAuthTokenId=counterLocalService.increment();
  OAuthToken oAuthToken=oAuthTokenPersistence.create(oAuthTokenId);
  oAuthToken.setCompanyId(user.getCompanyId());
  oAuthToken.setUserId(user.getUserId());
  oAuthToken.setUserName(user.getFullName());
  oAuthToken.setCreateDate(now);
  oAuthToken.setModifiedDate(now);
  oAuthToken.setGadgetKey(gadgetKey);
  oAuthToken.setServiceName(serviceName);
  oAuthToken.setModuleId(moduleId);
  oAuthToken.setAccessToken(accessToken);
  oAuthToken.setTokenName(tokenName);
  oAuthToken.setTokenSecret(tokenSecret);
  oAuthToken.setSessionHandle(sessionHandle);
  oAuthToken.setExpiration(expiration);
  oAuthTokenPersistence.update(oAuthToken);
  return oAuthToken;
}
