{
  try {
    String cmd=ParamUtil.get(req,Constants.CMD,"payment");
    ShoppingConfig shoppingConfig=AdminConfigServiceUtil.getShoppingConfig(PortalUtil.getCompanyId(req));
    if (cmd.equals("payment")) {
      _updatePayment(req,shoppingConfig);
    }
 else     if (cmd.equals("display")) {
      _updateDisplay(req,shoppingConfig);
    }
 else     if (cmd.equals("shipping_calculation")) {
      _updateShippingCalculation(req,shoppingConfig);
    }
 else     if (cmd.equals("insurance_calculation")) {
      _updateInsuranceCalculation(req,shoppingConfig);
    }
 else     if (cmd.equals("order_email")) {
      _updateOrderEmail(req,shoppingConfig);
    }
 else     if (cmd.equals("shipping_email")) {
      _updateShippingEmail(req,shoppingConfig);
    }
    AdminConfigServiceUtil.updateShoppingConfig(shoppingConfig);
    SessionMessages.add(req,UpdateShoppingConfigAction.class.getName());
    res.sendRedirect(ParamUtil.getString(req,"redirect"));
  }
 catch (  Exception e) {
    if (e != null && e instanceof PrincipalException) {
      SessionErrors.add(req,e.getClass().getName());
      setForward(req,"portlet.shopping.error");
    }
 else {
      req.setAttribute(PageContext.EXCEPTION,e);
      setForward(req,Constants.COMMON_ERROR);
    }
  }
}
