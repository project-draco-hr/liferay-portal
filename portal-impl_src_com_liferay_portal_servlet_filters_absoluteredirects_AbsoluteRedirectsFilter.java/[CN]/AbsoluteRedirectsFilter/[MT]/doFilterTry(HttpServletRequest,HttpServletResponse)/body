{
  request.setCharacterEncoding(StringPool.UTF8);
  long companyId=PortalInstances.getCompanyId(request);
  if (_log.isDebugEnabled()) {
    _log.debug("Company id " + companyId);
  }
  if (!PortalInstances.isCompanyActive(companyId)) {
    String html=ContentUtil.get("com/liferay/portal/dependencies/company_inactive.html");
    ServletResponseUtil.write(response,html);
    return null;
  }
  PortalUtil.getCurrentCompleteURL(request);
  PortalUtil.getCurrentURL(request);
  HttpSession session=request.getSession();
  Boolean httpsInitial=(Boolean)session.getAttribute(WebKeys.HTTPS_INITIAL);
  if (httpsInitial == null) {
    httpsInitial=Boolean.valueOf(request.isSecure());
    session.setAttribute(WebKeys.HTTPS_INITIAL,httpsInitial);
    if (_log.isDebugEnabled()) {
      _log.debug("Setting httpsInitial to " + httpsInitial);
    }
  }
  ServiceContext serviceContext=ServiceContextFactory.getInstance(request);
  ServiceContextThreadLocal.pushServiceContext(serviceContext);
  return null;
}
