{
  UploadPortletRequest uploadReq=PortalUtil.getUploadPortletRequest(req);
  String cmd=ParamUtil.getString(uploadReq,Constants.CMD);
  String folderId=ParamUtil.getString(uploadReq,"folderId");
  String newFolderId=ParamUtil.getString(uploadReq,"newFolderId");
  String name=ParamUtil.getString(uploadReq,"name");
  String sourceFileName=uploadReq.getFileName("file");
  String title=ParamUtil.getString(uploadReq,"title");
  String description=ParamUtil.getString(uploadReq,"description");
  byte[] byteArray=FileUtil.getBytes(uploadReq.getFile("file"));
  boolean addCommunityPermissions=ParamUtil.getBoolean(uploadReq,"addCommunityPermissions");
  boolean addGuestPermissions=ParamUtil.getBoolean(uploadReq,"addGuestPermissions");
  if (cmd.equals(Constants.ADD)) {
    DLFileEntryServiceUtil.addFileEntry(folderId,sourceFileName,title,description,byteArray,addCommunityPermissions,addGuestPermissions);
  }
 else {
    DLFileEntryServiceUtil.updateFileEntry(folderId,newFolderId,name,sourceFileName,title,description,byteArray);
  }
}
