{
  Analyzer analyzer=new Analyzer();
  Jar jar=null;
  try {
    URLConnection connection=url.openConnection();
    String fileName=url.getFile();
    if (connection instanceof JarURLConnection) {
      JarURLConnection jarConnection=(JarURLConnection)connection;
      fileName=jarConnection.getJarFileURL().getFile();
    }
    File file=new File(fileName);
    if (!file.exists() || !file.canRead()) {
      return manifest;
    }
    fileName=file.getName();
    Jar inputJar=new Jar(fileName,file);
    analyzer.setJar(inputJar);
    jar=analyzer.getJar();
    String bsn=fileName;
    Matcher matcher=_bsnPattern.matcher(bsn);
    if (matcher.matches()) {
      bsn=matcher.group(1);
    }
    analyzer.setProperty(Analyzer.BUNDLE_SYMBOLICNAME,bsn);
    String exportPackage=analyzer.calculateExportsFromContents(jar);
    analyzer.setProperty(Analyzer.EXPORT_PACKAGE,exportPackage);
    analyzer.mergeManifest(manifest);
    String version=analyzer.getProperty(Analyzer.BUNDLE_VERSION);
    if (version != null) {
      version=Builder.cleanupVersion(version);
      analyzer.setProperty(Analyzer.BUNDLE_VERSION,version);
    }
    return analyzer.calcManifest();
  }
 catch (  Exception e) {
    _log.error(e,e);
    return manifest;
  }
 finally {
    if (jar != null) {
      jar.close();
    }
    analyzer.close();
  }
}
