{
  String assigneeClassName=kaleoTaskAssignment.getAssigneeClassName();
  TaskAssignmentSelector taskAssignmentSelector=null;
  if (assigneeClassName.equals(ResourceAction.class.getName())) {
    taskAssignmentSelector=_taskAssignmentSelectors.get(assigneeClassName);
  }
 else {
    String taskAssignmentSelectorKey=getTaskAssignmentSelectKey(kaleoTaskAssignment.getAssigneeScriptLanguage(),kaleoTaskAssignment.getAssigneeScript());
    taskAssignmentSelector=_taskAssignmentSelectors.get(taskAssignmentSelectorKey);
  }
  if (taskAssignmentSelector == null) {
    throw new IllegalArgumentException("No task assignment selector found for " + kaleoTaskAssignment.toXmlString());
  }
  Collection<KaleoTaskAssignment> taskAssignments=taskAssignmentSelector.calculateTaskAssignments(kaleoTaskAssignment,executionContext);
  KaleoInstanceToken kaleoInstanceToken=executionContext.getKaleoInstanceToken();
  _kaleoInstanceLocalService.updateKaleoInstance(kaleoInstanceToken.getKaleoInstanceId(),executionContext.getWorkflowContext(),executionContext.getServiceContext());
  return taskAssignments;
}
