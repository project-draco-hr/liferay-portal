{
  String fieldName=ParamUtil.getString(request,"fieldName");
  String serializedDDMForm=ParamUtil.getString(request,"serializedDDMForm");
  JSONArray jsonArray=JSONFactoryUtil.createJSONArray();
  try {
    DDMForm ddmForm=_ddmFormJSONDeserializer.deserialize(serializedDDMForm);
    Map<String,DDMFormField> ddmFormFieldsMap=ddmForm.getDDMFormFieldsMap(true);
    DDMFormField ddmFormField=ddmFormFieldsMap.get(fieldName);
    long ddmDataProviderInstanceId=GetterUtil.getLong(ddmFormField.getProperty("ddmDataProviderInstanceId"));
    DDMDataProviderInstance ddmDataProviderInstance=_ddmDataProviderInstanceService.getDataProviderInstance(ddmDataProviderInstanceId);
    List<KeyValuePair> data=ddmDataProviderInstance.getData();
    for (    KeyValuePair keyValuePair : data) {
      JSONObject optionJSONObject=JSONFactoryUtil.createJSONObject();
      JSONObject labelJSONObject=JSONFactoryUtil.createJSONObject();
      labelJSONObject.put(LanguageUtil.getLanguageId(LocaleUtil.getDefault()),keyValuePair.getKey());
      optionJSONObject.put("label",labelJSONObject);
      optionJSONObject.put("value",keyValuePair.getValue());
      jsonArray.put(optionJSONObject);
    }
  }
 catch (  PortalException pe) {
    pe.printStackTrace();
  }
  response.setContentType(ContentTypes.APPLICATION_JSON);
  response.setStatus(HttpServletResponse.SC_OK);
  ServletResponseUtil.write(response,jsonArray.toJSONString());
}
