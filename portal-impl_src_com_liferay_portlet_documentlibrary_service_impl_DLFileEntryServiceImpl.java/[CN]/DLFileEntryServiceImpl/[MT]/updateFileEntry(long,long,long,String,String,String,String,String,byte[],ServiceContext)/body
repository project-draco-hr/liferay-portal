{
  DLFileEntryPermission.check(getPermissionChecker(),groupId,folderId,name,ActionKeys.UPDATE);
  if (folderId != newFolderId && !DLFolderPermission.contains(getPermissionChecker(),groupId,newFolderId,ActionKeys.ADD_DOCUMENT)) {
    throw new FolderPermissionException();
  }
  boolean hasLock=hasFileEntryLock(groupId,folderId,name);
  if (!hasLock) {
    lockFileEntry(groupId,folderId,name);
  }
  DLFileEntry fileEntry=null;
  try {
    fileEntry=dlFileEntryLocalService.updateFileEntry(getUserId(),groupId,folderId,newFolderId,name,sourceFileName,title,description,extraSettings,bytes,serviceContext);
  }
  finally {
    if (!hasLock) {
      unlockFileEntry(groupId,folderId,name);
    }
  }
  return fileEntry;
}
