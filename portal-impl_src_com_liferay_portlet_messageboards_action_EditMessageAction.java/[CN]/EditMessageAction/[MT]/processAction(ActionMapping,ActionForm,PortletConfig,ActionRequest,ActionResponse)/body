{
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  MBMessage message=null;
  try {
    UploadException uploadException=(UploadException)actionRequest.getAttribute(WebKeys.UPLOAD_EXCEPTION);
    if (uploadException != null) {
      if (uploadException.isExceededSizeLimit()) {
        throw new FileSizeException(uploadException.getCause());
      }
      throw new PortalException(uploadException.getCause());
    }
 else     if (cmd.equals(Constants.ADD) || cmd.equals(Constants.UPDATE)) {
      message=updateMessage(actionRequest,actionResponse);
    }
 else     if (cmd.equals(Constants.DELETE)) {
      deleteMessage(actionRequest);
    }
 else     if (cmd.equals(Constants.LOCK)) {
      lockThreads(actionRequest);
    }
 else     if (cmd.equals(Constants.SUBSCRIBE)) {
      subscribeMessage(actionRequest);
    }
 else     if (cmd.equals(Constants.UNLOCK)) {
      unlockThreads(actionRequest);
    }
 else     if (cmd.equals(Constants.UNSUBSCRIBE)) {
      unsubscribeMessage(actionRequest);
    }
    if (Validator.isNotNull(cmd)) {
      WindowState windowState=actionRequest.getWindowState();
      if (!windowState.equals(LiferayWindowState.POP_UP)) {
        String redirect=getRedirect(actionRequest,actionResponse,message);
        sendRedirect(actionRequest,actionResponse,redirect);
      }
 else {
        String redirect=PortalUtil.escapeRedirect(ParamUtil.getString(actionRequest,"redirect"));
        if (Validator.isNotNull(redirect)) {
          actionResponse.sendRedirect(redirect);
        }
      }
    }
  }
 catch (  Exception e) {
    if (e instanceof NoSuchMessageException || e instanceof PrincipalException || e instanceof RequiredMessageException) {
      SessionErrors.add(actionRequest,e.getClass());
      setForward(actionRequest,"portlet.message_boards.error");
    }
 else     if (e instanceof CaptchaMaxChallengesException || e instanceof CaptchaTextException || e instanceof DuplicateFileException|| e instanceof FileExtensionException|| e instanceof FileNameException|| e instanceof FileSizeException|| e instanceof LockedThreadException|| e instanceof MessageBodyException|| e instanceof MessageSubjectException|| e instanceof SanitizerException) {
      UploadException uploadException=(UploadException)actionRequest.getAttribute(WebKeys.UPLOAD_EXCEPTION);
      if (uploadException != null) {
        String uploadExceptionRedirect=ParamUtil.getString(actionRequest,"uploadExceptionRedirect");
        actionResponse.sendRedirect(uploadExceptionRedirect);
      }
      SessionErrors.add(actionRequest,e.getClass());
    }
 else     if (e instanceof AssetCategoryException || e instanceof AssetTagException) {
      SessionErrors.add(actionRequest,e.getClass(),e);
    }
 else {
      Throwable cause=e.getCause();
      if (cause instanceof SanitizerException) {
        SessionErrors.add(actionRequest,SanitizerException.class);
      }
 else {
        throw e;
      }
    }
  }
}
