{
  int initialNotInTrashCount=_page.getAttachmentsFileEntriesCount();
  int initialTrashEntriesCount=_page.getDeletedAttachmentsFileEntriesCount();
  String fileName=ServiceTestUtil.randomString() + ".docx";
  WikiTestUtil.addWikiAttachment(TestPropsValues.getUserId(),_node.getNodeId(),_page.getTitle(),fileName,getClass());
  Assert.assertEquals(initialNotInTrashCount + 1,_page.getAttachmentsFileEntriesCount());
  Assert.assertEquals(initialTrashEntriesCount,_page.getDeletedAttachmentsFileEntriesCount());
  FileEntry fileEntry=WikiPageLocalServiceUtil.movePageAttachmentToTrash(TestPropsValues.getUserId(),_page.getNodeId(),_page.getTitle(),fileName);
  Assert.assertEquals(initialNotInTrashCount,_page.getAttachmentsFileEntriesCount());
  Assert.assertEquals(initialTrashEntriesCount + 1,_page.getDeletedAttachmentsFileEntriesCount());
  if (restore) {
    TrashEntry trashEntry=TrashEntryLocalServiceUtil.getEntry(DLFileEntryConstants.getClassName(),fileEntry.getFileEntryId());
    TrashEntryServiceUtil.restoreEntry(trashEntry.getEntryId());
    Assert.assertEquals(initialNotInTrashCount + 1,_page.getAttachmentsFileEntriesCount());
    Assert.assertEquals(initialTrashEntriesCount,_page.getDeletedAttachmentsFileEntriesCount());
    WikiPageLocalServiceUtil.deletePageAttachment(_page.getNodeId(),_page.getTitle(),fileName);
  }
 else {
    WikiPageLocalServiceUtil.deletePageAttachment(_page.getNodeId(),_page.getTitle(),fileEntry.getTitle());
    Assert.assertEquals(initialNotInTrashCount,_page.getAttachmentsFileEntriesCount());
    Assert.assertEquals(initialTrashEntriesCount,_page.getDeletedAttachmentsFileEntriesCount());
  }
}
