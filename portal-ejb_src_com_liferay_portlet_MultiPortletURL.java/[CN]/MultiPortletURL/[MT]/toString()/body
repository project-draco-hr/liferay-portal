{
  String url=super.toString();
  if (Validator.isNull(url)) {
    return url;
  }
 else {
    StringBuffer sb=new StringBuffer(url);
    if (!url.endsWith(StringPool.AMPERSAND)) {
      sb.append(StringPool.AMPERSAND);
    }
    String suffix=StringPool.BLANK;
    int pos=url.lastIndexOf(StringPool.POUND);
    if (pos >= 0) {
      suffix=url.substring(pos);
      sb.delete(pos,sb.length());
    }
    Iterator itr1=_portletsParams.keySet().iterator();
    while (itr1.hasNext()) {
      String portletId=(String)itr1.next();
      String namespace=PortalUtil.getPortletNamespace(portletId);
      Map parameters=(Map)_portletsParams.get(portletId);
      Iterator itr2=parameters.keySet().iterator();
      while (itr2.hasNext()) {
        String name=(String)itr2.next();
        List values=(List)parameters.get(name);
        for (int i=0; i < values.size(); i++) {
          String value=(String)values.get(i);
          sb.append(namespace);
          sb.append(name);
          sb.append(StringPool.EQUAL);
          sb.append(HtmlUtils.htmlEscape(value));
          sb.append(StringPool.AMPERSAND);
        }
      }
    }
    return sb.toString() + suffix;
  }
}
