{
  Registry registry=RegistryUtil.getRegistry();
  MockMultiVMPool mockMultiVMPool=(MockMultiVMPool)registry.getService(_serviceRegistration.getServiceReference());
  Map<String,PortalCache<?,?>> portalCaches=mockMultiVMPool.getPortalCaches();
  Assert.assertEquals(2,portalCaches.size());
  if (tableMapper instanceof ReverseTableMapper) {
    Assert.assertSame(ReflectionTestUtil.getFieldValue(tableMapper.getReverseTableMapper(),"leftToRightPortalCache"),portalCaches.get(TableMapper.class.getName() + "-" + _TABLE_NAME+ "-LeftToRight"));
    Assert.assertSame(ReflectionTestUtil.getFieldValue(tableMapper.getReverseTableMapper(),"rightToLeftPortalCache"),portalCaches.get(TableMapper.class.getName() + "-" + _TABLE_NAME+ "-RightToLeft"));
  }
 else {
    Assert.assertSame(ReflectionTestUtil.getFieldValue(tableMapper,"leftToRightPortalCache"),portalCaches.get(TableMapper.class.getName() + "-" + _TABLE_NAME+ "-LeftToRight"));
    Assert.assertSame(ReflectionTestUtil.getFieldValue(tableMapper,"rightToLeftPortalCache"),portalCaches.get(TableMapper.class.getName() + "-" + _TABLE_NAME+ "-RightToLeft"));
  }
  tableMapper.destroy();
  Assert.assertTrue(portalCaches.isEmpty());
}
