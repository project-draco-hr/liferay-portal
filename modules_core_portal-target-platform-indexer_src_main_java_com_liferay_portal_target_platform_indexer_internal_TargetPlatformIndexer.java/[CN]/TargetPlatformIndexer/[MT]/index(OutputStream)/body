{
  Path tempPath=Files.createTempDirectory(null);
  File tempDir=tempPath.toFile();
  _config.put("root.url",tempDir.getPath());
  Set<File> jarFiles=new LinkedHashSet<>();
  try {
    _processSystemBundle(tempDir,jarFiles);
    _processSystemPackagesExtra(tempDir,jarFiles);
    for (    String dirName : _dirNames) {
      try (DirectoryStream<Path> directoryStream=Files.newDirectoryStream(Paths.get(dirName))){
        Iterator<Path> iterator=directoryStream.iterator();
        while (iterator.hasNext()) {
          _addBundle(tempPath,iterator.next(),jarFiles);
        }
      }
     }
    ResourceIndexer resourceIndexer=new RepoIndex();
    resourceIndexer.index(jarFiles,outputStream,_config);
  }
  finally {
    PathUtil.deltree(tempPath);
  }
}
