{
  try {
    String folderName=req.getParameter("folder_name");
    int msgNum=Integer.parseInt(req.getParameter("msg_num"));
    int partNum=Integer.parseInt(req.getParameter("msg_part"));
    Folder folder=MailUtil.getFolder(req,folderName);
    Message msg=folder.getMessage(msgNum);
    Part part=null;
    if (partNum < 0) {
      part=msg;
    }
 else {
      Multipart multipart=(Multipart)msg.getContent();
      part=multipart.getBodyPart(partNum);
    }
    String contentType=part.getContentType();
    if (part.isMimeType("message/rfc822")) {
      part=(Part)part.getContent();
      contentType=Constants.TEXT_HTML;
    }
    String fileName=part.getFileName();
    InputStream is=part.getInputStream();
    ServletResponseUtil.sendFile(res,fileName,is,contentType);
    return null;
  }
 catch (  Exception e) {
    req.setAttribute(PageContext.EXCEPTION,e);
    return mapping.findForward(Constants.COMMON_ERROR);
  }
}
