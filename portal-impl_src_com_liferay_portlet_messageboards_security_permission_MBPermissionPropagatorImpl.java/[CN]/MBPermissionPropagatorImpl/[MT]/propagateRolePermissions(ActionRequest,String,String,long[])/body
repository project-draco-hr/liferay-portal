{
  if (!className.equals(MBCategory.class.getName()) && !className.equals(_mbModelResource)) {
    return;
  }
  long primaryKey=GetterUtil.getLong(primKey);
  List<MBCategory> categories=null;
  List<MBMessage> messages=null;
  if (className.equals(_mbModelResource)) {
    categories=MBCategoryLocalServiceUtil.getCategories(primaryKey);
    messages=MBMessageLocalServiceUtil.getGroupMessages(primaryKey,WorkflowConstants.STATUS_ANY,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  }
 else {
    MBCategory category=MBCategoryLocalServiceUtil.getCategory(primaryKey);
    List<Object> categoriesAndThreads=MBCategoryLocalServiceUtil.getCategoriesAndThreads(category.getGroupId(),primaryKey);
    categories=new ArrayList<MBCategory>();
    for (    Object categoryOrThread : categoriesAndThreads) {
      if (categoryOrThread instanceof MBThread) {
        MBThread thread=(MBThread)categoryOrThread;
        messages=MBMessageLocalServiceUtil.getThreadMessages(thread.getThreadId(),WorkflowConstants.STATUS_ANY);
      }
 else {
        category=(MBCategory)categoryOrThread;
        List<Long> categoryIds=new ArrayList<Long>();
        categoryIds.add(category.getCategoryId());
        categoryIds=MBCategoryLocalServiceUtil.getSubcategoryIds(categoryIds,category.getGroupId(),category.getCategoryId());
        messages=new ArrayList<MBMessage>();
        for (        Long addCategoryId : categoryIds) {
          categories.add(MBCategoryLocalServiceUtil.getCategory(addCategoryId));
          messages.addAll(MBMessageLocalServiceUtil.getCategoryMessages(category.getGroupId(),addCategoryId,WorkflowConstants.STATUS_ANY,QueryUtil.ALL_POS,QueryUtil.ALL_POS));
        }
      }
    }
  }
  for (  long roleId : roleIds) {
    for (    MBCategory category : categories) {
      propagateRolePermissions(actionRequest,roleId,className,primaryKey,MBCategory.class.getName(),category.getPrimaryKey());
    }
    for (    MBMessage message : messages) {
      propagateRolePermissions(actionRequest,roleId,className,primaryKey,MBMessage.class.getName(),message.getPrimaryKey());
    }
  }
}
