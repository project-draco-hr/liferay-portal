{
  long categoryId=GetterUtil.getLong(primKey);
  MBCategory category=MBCategoryLocalServiceUtil.getCategory(categoryId);
  List<Object> categoriesAndThreads=MBCategoryLocalServiceUtil.getCategoriesAndThreads(category.getGroupId(),categoryId);
  List<MBCategory> categories=new ArrayList<MBCategory>();
  List<MBMessage> messages=null;
  for (  Object categoryOrThread : categoriesAndThreads) {
    if (categoryOrThread instanceof MBThread) {
      MBThread thread=(MBThread)categoryOrThread;
      messages=MBMessageLocalServiceUtil.getThreadMessages(thread.getThreadId(),WorkflowConstants.STATUS_ANY);
    }
 else {
      category=(MBCategory)categoryOrThread;
      List<Long> categoryIds=new ArrayList<Long>();
      categoryIds.add(category.getCategoryId());
      categoryIds=MBCategoryLocalServiceUtil.getSubcategoryIds(categoryIds,category.getGroupId(),category.getCategoryId());
      messages=new ArrayList<MBMessage>();
      for (      Long addCategoryId : categoryIds) {
        categories.add(MBCategoryLocalServiceUtil.getCategory(addCategoryId));
        messages.addAll(MBMessageLocalServiceUtil.getCategoryMessages(category.getGroupId(),addCategoryId,WorkflowConstants.STATUS_ANY,QueryUtil.ALL_POS,QueryUtil.ALL_POS));
      }
    }
  }
  propagateRolePermissions(actionRequest,className,categoryId,roleIds,categories,messages);
}
