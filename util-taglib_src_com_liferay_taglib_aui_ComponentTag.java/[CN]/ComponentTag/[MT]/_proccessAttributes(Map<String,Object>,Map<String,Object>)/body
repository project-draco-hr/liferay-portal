{
  Map<String,String> afterEventOptionsMap=new HashMap<String,String>();
  Map<String,String> onEventOptionsMap=new HashMap<String,String>();
  for (  String key : options.keySet()) {
    if (!_isValidAttribute(key)) {
      continue;
    }
    Object value=options.get(key);
    String originalKey=ReservedAttributeUtil.getOriginalName(getName(),key);
    if (value instanceof Map) {
      Map<String,Object> childOptionsMap=new HashMap<String,Object>();
      _proccessAttributes((Map)value,childOptionsMap);
      newOptions.put(originalKey,childOptionsMap);
      continue;
    }
    if (_isEventAttribute(key)) {
      _processEventAttribute(key,String.valueOf(value),afterEventOptionsMap,onEventOptionsMap);
    }
 else {
      newOptions.put(originalKey,value);
    }
  }
  if (afterEventOptionsMap.size() > 0) {
    newOptions.put(_AFTER,afterEventOptionsMap);
  }
  if (onEventOptionsMap.size() > 0) {
    newOptions.put(_ON,onEventOptionsMap);
  }
}
