{
  Map<String,String> afterEventOptions=new HashMap<>();
  Map<String,String> onEventOptions=new HashMap<>();
  for (  Map.Entry<String,Object> entry : options.entrySet()) {
    String key=entry.getKey();
    if (!isValidAttribute(key)) {
      continue;
    }
    Object value=entry.getValue();
    String originalKey=ReservedAttributeUtil.getOriginalName(getName(),key);
    if (value instanceof Map) {
      Map<String,Object> childOptions=new HashMap<>();
      proccessAttributes((Map<String,Object>)value,childOptions);
      jsonifiedOptions.put(originalKey,childOptions);
      continue;
    }
    if (isEventAttribute(key)) {
      processEventAttribute(key,String.valueOf(value),afterEventOptions,onEventOptions);
    }
 else {
      jsonifiedOptions.put(originalKey,value);
    }
  }
  if (!afterEventOptions.isEmpty()) {
    jsonifiedOptions.put("after",afterEventOptions);
  }
  if (!onEventOptions.isEmpty()) {
    jsonifiedOptions.put("on",onEventOptions);
  }
}
