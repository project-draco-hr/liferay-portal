{
  Map<String,String> afterEventOptions=new HashMap<String,String>();
  Map<String,String> onEventOptions=new HashMap<String,String>();
  for (  String key : options.keySet()) {
    if (!isValidAttribute(key)) {
      continue;
    }
    Object optionValue=options.get(key);
    String originalKey=ReservedAttributeUtil.getOriginalName(getName(),key);
    if (optionValue instanceof Map) {
      Map<String,Object> childOptions=new HashMap<String,Object>();
      proccessAttributes((Map)optionValue,childOptions);
      newOptions.put(originalKey,childOptions);
      continue;
    }
    if (isEventAttribute(key)) {
      processEventAttribute(key,String.valueOf(optionValue),afterEventOptions,onEventOptions);
    }
 else {
      newOptions.put(originalKey,optionValue);
    }
  }
  if (afterEventOptions.size() > 0) {
    newOptions.put("after",afterEventOptions);
  }
  if (onEventOptions.size() > 0) {
    newOptions.put("on",onEventOptions);
  }
}
