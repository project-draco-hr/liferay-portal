{
  Map<String,String> afterEventOptions=new HashMap<String,String>();
  Map<String,String> onEventOptions=new HashMap<String,String>();
  for (  String key : options.keySet()) {
    if (!isValidAttribute(key)) {
      continue;
    }
    Object value=options.get(key);
    String originalKey=ReservedAttributeUtil.getOriginalName(getName(),key);
    if (value instanceof Map) {
      Map<String,Object> childOptions=new HashMap<String,Object>();
      proccessAttributes((Map<String,Object>)value,childOptions);
      jsonifiedOptions.put(originalKey,childOptions);
      continue;
    }
    if (isEventAttribute(key)) {
      processEventAttribute(key,String.valueOf(value),afterEventOptions,onEventOptions);
    }
 else {
      jsonifiedOptions.put(originalKey,value);
    }
  }
  if (!afterEventOptions.isEmpty()) {
    jsonifiedOptions.put("after",afterEventOptions);
  }
  if (!onEventOptions.isEmpty()) {
    jsonifiedOptions.put("on",onEventOptions);
  }
}
