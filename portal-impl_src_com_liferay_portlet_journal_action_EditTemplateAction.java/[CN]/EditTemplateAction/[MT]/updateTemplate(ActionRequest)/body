{
  UploadPortletRequest uploadPortletRequest=PortalUtil.getUploadPortletRequest(actionRequest);
  String cmd=ParamUtil.getString(uploadPortletRequest,Constants.CMD);
  long groupId=ParamUtil.getLong(uploadPortletRequest,"groupId");
  String templateId=ParamUtil.getString(uploadPortletRequest,"templateId");
  boolean autoTemplateId=ParamUtil.getBoolean(uploadPortletRequest,"autoTemplateId");
  String structureId=ParamUtil.getString(uploadPortletRequest,"structureId");
  Map<Locale,String> nameMap=LocalizationUtil.getLocalizationMap(actionRequest,"name");
  Map<Locale,String> descriptionMap=LocalizationUtil.getLocalizationMap(actionRequest,"description");
  String xsl=getTemplateScript(uploadPortletRequest);
  String xslContent=JS.decodeURIComponent(ParamUtil.getString(uploadPortletRequest,"xslContent"));
  boolean formatXsl=ParamUtil.getBoolean(uploadPortletRequest,"formatXsl");
  if (Validator.isNull(xsl)) {
    xsl=xslContent;
  }
  String langType=ParamUtil.getString(uploadPortletRequest,"langType",JournalTemplateConstants.LANG_TYPE_XSL);
  boolean cacheable=ParamUtil.getBoolean(uploadPortletRequest,"cacheable");
  boolean smallImage=ParamUtil.getBoolean(uploadPortletRequest,"smallImage");
  String smallImageURL=ParamUtil.getString(uploadPortletRequest,"smallImageURL");
  File smallFile=uploadPortletRequest.getFile("smallFile");
  ServiceContext serviceContext=ServiceContextFactory.getInstance(JournalTemplate.class.getName(),actionRequest);
  JournalTemplate template=null;
  if (cmd.equals(Constants.ADD)) {
    template=JournalTemplateServiceUtil.addTemplate(groupId,templateId,autoTemplateId,structureId,nameMap,descriptionMap,xsl,formatXsl,langType,cacheable,smallImage,smallImageURL,smallFile,serviceContext);
  }
 else {
    template=JournalTemplateServiceUtil.updateTemplate(groupId,templateId,structureId,nameMap,descriptionMap,xsl,formatXsl,langType,cacheable,smallImage,smallImageURL,smallFile,serviceContext);
  }
  JournalUtil.addRecentTemplate(actionRequest,template);
  return template;
}
