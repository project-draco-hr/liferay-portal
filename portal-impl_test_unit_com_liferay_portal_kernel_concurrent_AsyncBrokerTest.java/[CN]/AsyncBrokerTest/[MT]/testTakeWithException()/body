{
  AsyncBroker<String,String> asyncBroker=new AsyncBroker<String,String>();
  Map<String,DefaultNoticeableFuture<String>> defaultNoticeableFutures=ReflectionTestUtil.getFieldValue(asyncBroker,"_defaultNoticeableFutures");
  Assert.assertTrue(defaultNoticeableFutures.isEmpty());
  Exception exception=new Exception();
  Assert.assertFalse(asyncBroker.takeWithException(_key,exception));
  NoticeableFuture<String> noticeableFuture=asyncBroker.post(_key);
  Assert.assertEquals(1,defaultNoticeableFutures.size());
  Assert.assertSame(noticeableFuture,defaultNoticeableFutures.get(_key));
  Assert.assertTrue(asyncBroker.takeWithException(_key,exception));
  try {
    noticeableFuture.get();
    Assert.fail();
  }
 catch (  ExecutionException ee) {
    Assert.assertSame(exception,ee.getCause());
  }
  Assert.assertTrue(defaultNoticeableFutures.isEmpty());
  Assert.assertFalse(asyncBroker.takeWithException(_key,exception));
}
