{
  long companyId=PortalUtil.getCompanyId(request);
  UnicodeProperties typeSettingsProperties=mdrAction.getTypeSettingsProperties();
  String themeId=GetterUtil.getString(typeSettingsProperties.getProperty("themeId"));
  Theme theme=_themeLocalService.fetchTheme(companyId,themeId);
  if (theme == null) {
    return;
  }
  request.setAttribute(WebKeys.THEME,theme);
  String colorSchemeId=GetterUtil.getString(typeSettingsProperties.getProperty("colorSchemeId"));
  ColorScheme colorScheme=_themeLocalService.fetchColorScheme(companyId,themeId,colorSchemeId);
  if (colorScheme == null) {
    colorScheme=ColorSchemeFactoryUtil.getColorScheme();
  }
  request.setAttribute(WebKeys.COLOR_SCHEME,colorScheme);
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  themeDisplay.setLookAndFeel(theme,colorScheme);
}
