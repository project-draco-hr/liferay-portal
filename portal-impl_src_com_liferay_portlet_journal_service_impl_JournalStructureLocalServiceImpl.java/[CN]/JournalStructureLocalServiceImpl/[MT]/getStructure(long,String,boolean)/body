{
  structureId=structureId.trim().toUpperCase();
  if (groupId == 0) {
    _log.error("No group id was passed for " + structureId + ". Group id is "+ "required since 4.2.0. Please update all custom code and "+ "data that references structures without a group id.");
    List<JournalStructure> structures=journalStructurePersistence.findByStructureId(structureId);
    if (structures.size() == 0) {
      throw new NoSuchStructureException("No JournalStructure exists with the structure id " + structureId);
    }
 else {
      return structures.get(0);
    }
  }
  JournalStructure structure=journalStructurePersistence.fetchByG_S(groupId,structureId);
  if (structure != null) {
    return structure;
  }
  if (!includeGlobalStructures) {
    throw new NoSuchStructureException("No JournalStructure exists with the structure id " + structureId);
  }
  Group group=groupPersistence.findByPrimaryKey(groupId);
  Group companyGroup=groupLocalService.getCompanyGroup(group.getCompanyId());
  return journalStructurePersistence.findByG_S(companyGroup.getGroupId(),structureId);
}
