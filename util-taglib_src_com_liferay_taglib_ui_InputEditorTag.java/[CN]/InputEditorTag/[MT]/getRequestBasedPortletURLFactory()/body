{
  LiferayPortletResponse liferayPortletResponse=(LiferayPortletResponse)request.getAttribute(JavaConstants.JAVAX_PORTLET_RESPONSE);
  if (liferayPortletResponse == null) {
    return RequestBasedPortletURLFactory.create(request);
  }
  return RequestBasedPortletURLFactory.create(liferayPortletResponse);
}
