{
  ServiceContext serviceContext=ServiceTestUtil.getServiceContext(_group.getGroupId());
  String originalContent=ServiceTestUtil.randomString();
  WikiPage originalPage=WikiTestUtil.addPage(TestPropsValues.getUserId(),_node.getNodeId(),ServiceTestUtil.randomString(),originalContent,true,serviceContext);
  ExpandoColumn column=null;
  ExpandoValue value=null;
  ExpandoBridge expandoBridge=null;
  if (hasExpandoValues) {
    ExpandoTable table=ExpandoTestUtil.addTable(PortalUtil.getClassNameId(WikiPage.class),ServiceTestUtil.randomString());
    column=ExpandoTestUtil.addColumn(table,ServiceTestUtil.randomString(),ExpandoColumnConstants.STRING);
    value=ExpandoTestUtil.addValue(table,column,originalPage.getPrimaryKey(),ServiceTestUtil.randomString());
    expandoBridge=originalPage.getExpandoBridge();
    expandoBridge.addAttribute(column.getName(),ExpandoColumnConstants.STRING,value.getString());
  }
  WikiPage updatedPage1=WikiTestUtil.updatePage(originalPage,TestPropsValues.getUserId(),originalContent + "\nAdded second line.",serviceContext);
  Assert.assertNotEquals(originalContent,updatedPage1.getContent());
  WikiPage updatedPage2=WikiTestUtil.updatePage(updatedPage1,TestPropsValues.getUserId(),updatedPage1.getContent() + "\nAdded third line.",serviceContext);
  Assert.assertNotEquals(originalContent,updatedPage2.getContent());
  WikiPage revertedPage=WikiPageLocalServiceUtil.revertPage(TestPropsValues.getUserId(),_node.getNodeId(),updatedPage2.getTitle(),originalPage.getVersion(),serviceContext);
  Assert.assertEquals(originalContent,revertedPage.getContent());
  if (hasExpandoValues) {
    expandoBridge=revertedPage.getExpandoBridge();
    Map<String,Serializable> attributes=expandoBridge.getAttributes();
    if (attributes.isEmpty()) {
      Assert.fail("Expando values have not been reverted with page");
    }
    Assert.assertEquals(value.getString(),attributes.get(column.getName()));
  }
}
