{
  String messageListenerClass=message.getString(MESSAGE_LISTENER_CLASS_NAME);
  if (messageListenerClass == null) {
    return;
  }
  String portletId=message.getString(PORTLET_ID);
  ClassLoader classLoader=null;
  if (Validator.isNull(portletId)) {
    classLoader=PortalClassLoaderUtil.getClassLoader();
  }
 else {
    classLoader=PortletClassLoaderUtil.getClassLoader(portletId);
  }
  if (classLoader == null) {
    throw new SchedulerException("Unable to find cluster for portlet " + portletId);
  }
  MessageListener schedulerEventListener=getMessageListener(messageListenerClass,classLoader);
  SchedulerEventMessageListenerWrapper schedulerEventListenerWrapper=new SchedulerEventMessageListenerWrapper();
  schedulerEventListenerWrapper.setGroupName(groupName);
  schedulerEventListenerWrapper.setJobName(jobName);
  schedulerEventListenerWrapper.setMessageListener(schedulerEventListener);
  schedulerEventListenerWrapper.afterPropertiesSet();
  MessageBusUtil.registerMessageListener(destinationName,schedulerEventListenerWrapper);
  message.put(MESSAGE_LISTENER_UUID,schedulerEventListenerWrapper.getMessageListenerUUID());
  message.put(RECEIVER_KEY,getFullName(jobName,groupName));
}
