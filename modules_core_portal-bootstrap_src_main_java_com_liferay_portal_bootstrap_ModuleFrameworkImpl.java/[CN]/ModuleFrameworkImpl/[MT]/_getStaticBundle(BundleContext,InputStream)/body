{
  try {
    JarInputStream jarInputStream=new JarInputStream(inputStream);
    Manifest manifest=jarInputStream.getManifest();
    Attributes attributes=manifest.getMainAttributes();
    String bundleSymbolicNameAttributeValue=attributes.getValue(Constants.BUNDLE_SYMBOLICNAME);
    Parameters parameters=OSGiHeader.parseHeader(bundleSymbolicNameAttributeValue);
    Set<String> bundleSymbolicNameSet=parameters.keySet();
    Iterator<String> bundleSymbolicNameIterator=bundleSymbolicNameSet.iterator();
    String bundleSymbolicName=bundleSymbolicNameIterator.next();
    String bundleVersionAttributeValue=attributes.getValue(Constants.BUNDLE_VERSION);
    Version bundleVersion=Version.parseVersion(bundleVersionAttributeValue);
    for (    Bundle bundle : bundleContext.getBundles()) {
      if (bundleSymbolicName.equals(bundle.getSymbolicName())) {
        Version curBundleVersion=Version.parseVersion(String.valueOf(bundle.getVersion()));
        if (bundleVersion.equals(curBundleVersion)) {
          return bundle;
        }
 else {
          bundle.uninstall();
          FrameworkWiring frameworkWiring=_framework.adapt(FrameworkWiring.class);
          frameworkWiring.refreshBundles(Collections.singletonList(bundle));
          return null;
        }
      }
    }
    return null;
  }
 catch (  Exception e) {
    throw new PortalException(e);
  }
}
