{
  groupId=ParamUtil.getLong(portletRequest,GROUP_ID);
  if (groupId == 0) {
    ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
    if ((themeDisplay.getScopeGroupId() == themeDisplay.getCompanyGroupId()) && ((Validator.isNotNull(structureId) && !structureId.equals("0")) || (Validator.isNotNull(templateId) && !templateId.equals("0")))) {
      return 0;
    }
    groupId=themeDisplay.getScopeGroupId();
  }
  return groupId;
}
