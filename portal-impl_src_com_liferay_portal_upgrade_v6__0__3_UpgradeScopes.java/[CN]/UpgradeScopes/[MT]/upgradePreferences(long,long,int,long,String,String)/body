{
  PortletPreferencesImpl preferences=PortletPreferencesSerializer.fromXML(companyId,ownerId,ownerType,plid,portletId,xml);
  long linkToLayoutId=GetterUtil.getLong(preferences.getValue("lfr-scope-layout-id",null));
  if (linkToLayoutId > 0) {
    String uuid=getLayoutUuid(plid,linkToLayoutId);
    if (uuid != null) {
      preferences.setValue("lfr-scope-layout-uuid",uuid);
    }
    preferences.reset("lfr-scope-layout-id");
  }
  return PortletPreferencesSerializer.toXML(preferences);
}
