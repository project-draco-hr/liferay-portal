{
  if ((credentials != null) && (credentials.length == 3)) {
    String jUsername=credentials[0];
    String jPassword=credentials[1];
    boolean encPassword=GetterUtil.getBoolean(credentials[2]);
    if (Validator.isNotNull(jUsername) && Validator.isNotNull(jPassword)) {
      try {
        long userId=GetterUtil.getLong(jUsername);
        if (userId > 0) {
          User user=UserLocalServiceUtil.getUserById(userId);
          if (user.isLockout()) {
            return null;
          }
        }
 else {
          return null;
        }
      }
 catch (      NoSuchUserException nsue) {
        return null;
      }
      session.setAttribute("j_username",jUsername);
      if (encPassword) {
        session.setAttribute("j_password",jPassword);
      }
 else {
        session.setAttribute("j_password",PwdEncryptor.encrypt(jPassword));
        if (PropsValues.SESSION_STORE_PASSWORD) {
          session.setAttribute(WebKeys.USER_PASSWORD,jPassword);
        }
      }
      session.setAttribute("j_remoteuser",jUsername);
      if (PropsValues.PORTAL_JAAS_ENABLE) {
        response.sendRedirect(PortalUtil.getPathMain() + "/portal/touch_protected");
      }
      return jUsername;
    }
  }
  return null;
}
