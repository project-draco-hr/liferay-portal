{
  if ((credentials != null) && (credentials.length == 3)) {
    String jUsername=credentials[0];
    String jPassword=credentials[1];
    boolean encPwd=GetterUtil.getBoolean(credentials[2]);
    if (Validator.isNotNull(jUsername) && Validator.isNotNull(jPassword)) {
      try {
        long userId=GetterUtil.getLong(jUsername);
        if (userId > 0) {
          User user=UserLocalServiceUtil.getUserById(userId);
          if (user.isLockout()) {
            return null;
          }
        }
 else {
          return null;
        }
      }
 catch (      NoSuchUserException nsue) {
        return null;
      }
      ses.setAttribute("j_username",jUsername);
      if (encPwd) {
        ses.setAttribute("j_password",jPassword);
      }
 else {
        ses.setAttribute("j_password",PwdEncryptor.encrypt(jPassword));
        ses.setAttribute(WebKeys.USER_PASSWORD,jPassword);
      }
      if (PropsValues.PORTAL_JAAS_ENABLE) {
        res.sendRedirect(PortalUtil.getPathMain() + "/portal/touch_protected");
      }
      return jUsername;
    }
  }
  return null;
}
