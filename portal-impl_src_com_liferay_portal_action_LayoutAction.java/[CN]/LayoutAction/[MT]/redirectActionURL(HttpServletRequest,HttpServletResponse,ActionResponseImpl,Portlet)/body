{
  ActionRequestImpl actionRequestImpl=(ActionRequestImpl)request.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  Layout layout=(Layout)request.getAttribute(WebKeys.LAYOUT);
  PortletURL portletURL=new PortletURLImpl(actionRequestImpl,actionRequestImpl.getPortletName(),layout.getPlid(),PortletRequest.RENDER_PHASE);
  Map<String,String[]> renderParameters=actionResponseImpl.getRenderParameterMap();
  for (  Map.Entry<String,String[]> entry : renderParameters.entrySet()) {
    String key=entry.getKey();
    String[] value=entry.getValue();
    portletURL.setParameter(key,value);
  }
  response.sendRedirect(portletURL.toString());
}
