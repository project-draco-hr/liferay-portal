{
  ActionRequestImpl actionRequestImpl=(ActionRequestImpl)req.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  Layout layout=(Layout)req.getAttribute(WebKeys.LAYOUT);
  PortletURL portletURL=new PortletURLImpl(actionRequestImpl,actionRequestImpl.getPortletName(),layout.getLayoutId(),PortletRequest.RENDER_PHASE);
  Map<String,String[]> renderParameters=actionResponseImpl.getRenderParameterMap();
  for (  Map.Entry<String,String[]> entry : renderParameters.entrySet()) {
    String key=entry.getKey();
    String[] value=entry.getValue();
    portletURL.setParameter(key,value);
  }
  res.sendRedirect(portletURL.toString());
}
