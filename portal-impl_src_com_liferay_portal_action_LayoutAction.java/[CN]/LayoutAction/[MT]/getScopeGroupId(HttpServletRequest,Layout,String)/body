{
  long scopeGroupId=0;
  Layout requestLayout=(Layout)request.getAttribute(WebKeys.LAYOUT);
  try {
    request.setAttribute(WebKeys.LAYOUT,layout);
    scopeGroupId=PortalUtil.getScopeGroupId(request,portletId);
  }
  finally {
    request.setAttribute(WebKeys.LAYOUT,requestLayout);
  }
  if (scopeGroupId <= 0) {
    scopeGroupId=PortalUtil.getScopeGroupId(layout,portletId);
  }
  return scopeGroupId;
}
