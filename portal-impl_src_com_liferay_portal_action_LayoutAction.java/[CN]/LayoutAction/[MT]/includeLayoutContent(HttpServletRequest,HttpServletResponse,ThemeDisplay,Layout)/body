{
  ServletContext ctx=(ServletContext)req.getAttribute(WebKeys.CTX);
  String path=Constants.TEXT_HTML_DIR;
  if (BrowserSniffer.is_wap_xhtml(req)) {
    path=Constants.TEXT_WAP_DIR;
  }
  if (themeDisplay.isStateExclusive() || Validator.isNotNull(ParamUtil.getString(req,"p_p_id"))) {
    path+="/portal/layout/view/portlet.jsp";
  }
 else {
    path+=PortalUtil.getLayoutViewPage(layout);
  }
  RequestDispatcher rd=ctx.getRequestDispatcher(path);
  StringServletResponse stringServletRes=new StringServletResponse(res);
  rd.include(req,stringServletRes);
  req.setAttribute(WebKeys.LAYOUT_CONTENT,stringServletRes.getString());
}
