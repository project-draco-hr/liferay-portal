{
  RenderRequestImpl renderRequestImpl=(RenderRequestImpl)request.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  RenderResponseImpl renderResponseImpl=(RenderResponseImpl)request.getAttribute(JavaConstants.JAVAX_PORTLET_RESPONSE);
  StringServletResponse stringResponse=(StringServletResponse)renderRequestImpl.getAttribute(WebKeys.STRING_SERVLET_RESPONSE);
  renderResponseImpl.transferHeaders(response);
  if (stringResponse.isCalledGetOutputStream()) {
    InputStream is=new ByteArrayInputStream(stringResponse.getByteArrayMaker().toByteArray());
    ServletResponseUtil.sendFile(response,renderResponseImpl.getResourceName(),is,renderResponseImpl.getContentType());
  }
 else {
    byte[] content=stringResponse.getString().getBytes(StringPool.UTF8);
    ServletResponseUtil.sendFile(response,renderResponseImpl.getResourceName(),content,renderResponseImpl.getContentType());
  }
}
