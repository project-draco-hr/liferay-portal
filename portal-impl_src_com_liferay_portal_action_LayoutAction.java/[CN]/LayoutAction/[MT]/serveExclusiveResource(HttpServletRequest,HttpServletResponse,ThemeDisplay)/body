{
  RenderRequestImpl renderReqImpl=(RenderRequestImpl)req.getAttribute(JavaConstants.JAVAX_PORTLET_REQUEST);
  RenderResponseImpl renderResImpl=(RenderResponseImpl)req.getAttribute(JavaConstants.JAVAX_PORTLET_RESPONSE);
  StringServletResponse stringServletRes=(StringServletResponse)renderReqImpl.getAttribute(WebKeys.STRING_SERVLET_RESPONSE);
  renderResImpl.transferHeaders(res);
  if (stringServletRes.isCalledGetOutputStream()) {
    InputStream is=new ByteArrayInputStream(stringServletRes.getByteArrayMaker().toByteArray());
    ServletResponseUtil.sendFile(res,renderResImpl.getResourceName(),is,renderResImpl.getContentType());
  }
 else {
    byte[] content=stringServletRes.getString().getBytes(StringPool.UTF8);
    ServletResponseUtil.sendFile(res,renderResImpl.getResourceName(),content,renderResImpl.getContentType());
  }
  RenderRequestFactory.recycle(renderReqImpl);
  RenderResponseFactory.recycle(renderResImpl);
}
