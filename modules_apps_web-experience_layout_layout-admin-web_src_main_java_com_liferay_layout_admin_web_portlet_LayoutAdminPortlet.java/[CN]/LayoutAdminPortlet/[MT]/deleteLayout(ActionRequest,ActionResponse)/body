{
  ThemeDisplay themeDisplay=(ThemeDisplay)actionRequest.getAttribute(WebKeys.THEME_DISPLAY);
  String redirect=ParamUtil.getString(actionRequest,"redirect");
  long selPlid=ParamUtil.getLong(actionRequest,"selPlid");
  if (selPlid <= 0) {
    long groupId=ParamUtil.getLong(actionRequest,"groupId");
    boolean privateLayout=ParamUtil.getBoolean(actionRequest,"privateLayout");
    long layoutId=ParamUtil.getLong(actionRequest,"layoutId");
    Layout layout=layoutLocalService.getLayout(groupId,privateLayout,layoutId);
    selPlid=layout.getPlid();
  }
  Layout deleteLayout=layoutLocalService.getLayout(selPlid);
  Object[] returnValue=SitesUtil.deleteLayout(actionRequest,actionResponse);
  if (selPlid == themeDisplay.getRefererPlid()) {
    long newRefererPlid=(Long)returnValue[2];
    Layout redirectLayout=layoutLocalService.fetchLayout(newRefererPlid);
    if (redirectLayout != null) {
      redirect=PortalUtil.getLayoutFullURL(redirectLayout,themeDisplay);
    }
 else {
      redirect=getEmptyLayoutSetURL(actionRequest,deleteLayout.getGroupId(),deleteLayout.isPrivateLayout());
    }
  }
  MultiSessionMessages.add(actionRequest,"layoutDeleted",selPlid);
  actionRequest.setAttribute(WebKeys.REDIRECT,redirect);
}
