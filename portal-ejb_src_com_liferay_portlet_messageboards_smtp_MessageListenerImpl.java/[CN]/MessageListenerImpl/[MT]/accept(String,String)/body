{
  try {
    if (!recipient.startsWith(MBUtil.SMTP_PORTLET_PREFIX)) {
      return false;
    }
    String companyId=_getCompanyId(recipient);
    String categoryId=_getCategoryId(recipient);
    CompanyLocalServiceUtil.getCompany(companyId);
    MBCategory category=MBCategoryLocalServiceUtil.getCategory(categoryId);
    if (!category.getCompanyId().equals(companyId)) {
      return false;
    }
    if (_log.isDebugEnabled()) {
      _log.debug("Checking if user exists by email: " + from);
    }
    UserLocalServiceUtil.getUserByEmailAddress(companyId,from);
    return true;
  }
 catch (  Exception e) {
    _log.warn("Mail rejected because of: " + e.toString());
    return false;
  }
}
