{
  IStream outputIStream=outputIContainer.addNewStream(index);
  outputIStreams[index]=outputIStream;
  IStreamCoder outputIStreamCoder=outputIStream.getStreamCoder();
  outputIStreamCoders[index]=outputIStreamCoder;
  int bitRate=inputIStreamCoder.getBitRate();
  if (_log.isInfoEnabled()) {
    _log.info("Original video bitrate " + bitRate);
  }
  bitRate=getVideoBitRate(bitRate);
  if (_log.isInfoEnabled()) {
    _log.info("Modified video bitrate " + bitRate);
  }
  outputIStreamCoder.setBitRate(bitRate);
  ICodec iCodec=getVideoEncodingICodec(inputICodecType,outputURL);
  if (iCodec == null) {
    throw new RuntimeException("Unable to determine " + inputICodecType + " encoder for "+ outputURL);
  }
  outputIStreamCoder.setCodec(iCodec);
  IRational iRational=inputIStreamCoder.getFrameRate();
  if (_log.isInfoEnabled()) {
    _log.info("Original frame rate " + iRational.getNumerator() + "/"+ iRational.getDenominator());
  }
  iRational=getVideoFrameRate(iRational);
  if (_log.isInfoEnabled()) {
    _log.info("Modified frame rate " + iRational.getNumerator() + "/"+ iRational.getDenominator());
  }
  outputIStreamCoder.setFrameRate(iRational);
  if (inputIStreamCoder.getHeight() <= 0) {
    throw new RuntimeException("Unable to determine height for " + _inputURL);
  }
  outputIStreamCoder.setHeight(_height);
  outputIStreamCoder.setPixelType(Type.YUV420P);
  outputIStreamCoder.setTimeBase(IRational.make(iRational.getDenominator(),iRational.getNumerator()));
  if (inputIStreamCoder.getWidth() <= 0) {
    throw new RuntimeException("Unable to determine width for " + _inputURL);
  }
  outputIStreamCoder.setWidth(_width);
  iVideoResamplers[index]=createIVideoResampler(inputIStreamCoder,outputIStreamCoder,_height,_width);
  inputIVideoPictures[index]=IVideoPicture.make(inputIStreamCoder.getPixelType(),inputIStreamCoder.getWidth(),inputIStreamCoder.getHeight());
  outputIVideoPictures[index]=IVideoPicture.make(outputIStreamCoder.getPixelType(),outputIStreamCoder.getWidth(),outputIStreamCoder.getHeight());
  ICodec.ID iCodecID=iCodec.getID();
  if (iCodecID.equals(ICodec.ID.CODEC_ID_H264)) {
    Configuration.configure(_ffpresetProperties,outputIStreamCoder);
  }
}
