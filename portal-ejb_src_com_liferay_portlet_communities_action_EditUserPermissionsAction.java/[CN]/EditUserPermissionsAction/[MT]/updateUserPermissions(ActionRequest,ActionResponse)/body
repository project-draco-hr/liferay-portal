{
  String resourceId=ParamUtil.getString(req,"resourceId");
  String assignmentType=ParamUtil.getString(req,"assignmentType");
  String[] actionIds=StringUtil.split(ParamUtil.getString(req,"actionIds"));
  int actionPos=ParamUtil.getInteger(req,"actionPos");
  String[] addUserIds=StringUtil.split(ParamUtil.getString(req,"addUserIds"));
  String[] removeUserIds=StringUtil.split(ParamUtil.getString(req,"removeUserIds"));
  if (assignmentType.equals("individual")) {
    String actionId=actionIds[actionPos];
    actionIds=new String[]{actionId};
  }
  for (int i=0; i < addUserIds.length; i++) {
    PermissionServiceUtil.setUserPermissions(addUserIds[i],actionIds,resourceId);
  }
  for (int i=0; i < removeUserIds.length; i++) {
    PermissionServiceUtil.unsetUserPermissions(removeUserIds[i],actionIds,resourceId);
  }
  String redirect=ParamUtil.getString(req,"redirect");
  redirect+="&assignmentType=" + assignmentType + "&resourceId="+ resourceId;
  if (assignmentType.equals("individual") && redirect.indexOf("actionPos=" + actionPos + "&") != -1) {
    SessionMessages.add(req,"request_processed");
  }
  res.sendRedirect(redirect);
}
