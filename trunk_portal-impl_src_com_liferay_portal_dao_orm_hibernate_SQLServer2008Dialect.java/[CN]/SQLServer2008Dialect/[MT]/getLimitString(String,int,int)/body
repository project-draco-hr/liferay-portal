{
  String sqlLowerCase=sql.toLowerCase();
  int fromPos=sqlLowerCase.indexOf(" from ");
  String selectFrom=sql.substring(0,fromPos);
  int orderByPos=sqlLowerCase.lastIndexOf(" order by ");
  String selectFromWhere=null;
  String orderBy=null;
  if (orderByPos > 0) {
    selectFromWhere=sql.substring(fromPos,orderByPos);
    orderBy=sql.substring(orderByPos + 9,sql.length());
  }
 else {
    selectFromWhere=sql.substring(fromPos);
    orderBy="CURRENT_TIMESTAMP";
  }
  StringBundler sb=null;
  if (sqlLowerCase.contains(" union ")) {
    String[] orderByColumns=getOrderByColumns(selectFrom,orderBy,false);
    sb=new StringBundler(11);
    sb.append("select * from (select *, row_number() over (order by ");
    sb.append(StringUtil.merge(orderByColumns,StringPool.COMMA));
    sb.append(") as _page_row_num from (");
    sb.append(selectFrom);
    sb.append(selectFromWhere);
    sb.append(" ) _temp_table_1 ) _temp_table_2");
  }
 else {
    String[] orderByColumns=getOrderByColumns(selectFrom,orderBy,true);
    sb=new StringBundler(12);
    sb.append("select * from (");
    sb.append(selectFrom);
    sb.append(", row_number() over (order by ");
    sb.append(StringUtil.merge(orderByColumns,StringPool.COMMA));
    sb.append(") as _page_row_num ");
    sb.append(selectFromWhere);
    sb.append(" ) _temp_table_1");
  }
  sb.append(" where _page_row_num between ");
  sb.append(offset + 1);
  sb.append(" and ");
  sb.append(limit);
  sb.append(" order by _page_row_num");
  return sb.toString();
}
