{
  String fullFileName=_DIR_NAME + StringPool.SLASH + fileName;
  SourceFormatterBean sourceFormatterBean=getSourceFormatterBean();
  SourceFormatter sourceFormatter=new SourceFormatter(sourceFormatterBean);
  sourceFormatter.format();
  List<String> processedFiles=sourceFormatter.getProcessedFiles();
  if (processedFiles.isEmpty()) {
    throw new IllegalArgumentException("The file name " + fullFileName + " does not end with a valid extension");
  }
  List<String> errorMessages=sourceFormatter.getErrorMessages();
  if (!errorMessages.isEmpty() || (expectedErrorMessages.length > 0)) {
    Assert.assertEquals(expectedErrorMessages.length,errorMessages.size());
    for (int i=0; i < errorMessages.size(); i++) {
      String actualErrorMessage=errorMessages.get(i);
      String expectedErrorMessage=expectedErrorMessages[i];
      StringBundler sb=new StringBundler(5);
      sb.append(expectedErrorMessage);
      sb.append(StringPool.SPACE);
      sb.append(fullFileName);
      if (lineNumbers != null) {
        sb.append(StringPool.SPACE);
        sb.append(lineNumbers[i]);
      }
      Assert.assertEquals(sb.toString(),actualErrorMessage);
    }
  }
 else {
    String actualFormattedContent=FileUtils.readFileToString(new File(processedFiles.get(0)));
    File file=new File(_DIR_NAME + "/expected/" + fileName);
    String expectedFormattedContent=FileUtils.readFileToString(file,StringPool.UTF8);
    expectedFormattedContent=StringUtil.replace(expectedFormattedContent,StringPool.RETURN_NEW_LINE,StringPool.NEW_LINE);
    Assert.assertEquals(expectedFormattedContent,actualFormattedContent);
  }
}
