{
  getService(DLAppServiceUtil.class,DLAppService.class);
  RepositoryEntryLocalService repositoryEntryLocalService=getService(RepositoryEntryLocalServiceUtil.class,RepositoryEntryLocalService.class);
  RepositoryEntry repositoryEntry=mock(RepositoryEntry.class);
  when(repositoryEntryLocalService.fetchRepositoryEntry(Mockito.eq(1000l))).thenReturn(repositoryEntry);
  when(repositoryEntry.getMappedId()).thenReturn("1000");
  SearchContext searchContext=getSearchContext();
  searchContext.setFolderIds(new long[]{1000});
  searchContext.setKeywords("test");
  BooleanQuery searchQuery=RepositorySearchQueryBuilderUtil.getFullQuery(searchContext);
  QueryConfig queryConfig=searchContext.getQueryConfig();
  queryConfig.setAttribute("capabilityQuery",CapabilityQuery.BOTHCOMBINED.value());
  queryConfig.setSearchSubfolders(true);
  String cmisQuery=CMISSearchQueryBuilderUtil.buildQuery(searchContext,searchQuery);
  assertQueryEquals("((IN_TREE('1000') AND (cmis:name = 'test' OR " + "cmis:createdBy = 'test')) OR CONTAINS('test'))",cmisQuery);
}
