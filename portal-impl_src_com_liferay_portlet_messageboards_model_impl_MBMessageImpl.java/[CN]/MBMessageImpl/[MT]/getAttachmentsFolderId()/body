{
  if (_attachmentsFolderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    return _attachmentsFolderId;
  }
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddGroupPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  String portletId=PortletProviderUtil.getPortletId(MBMessage.class.getName(),PortletProvider.Action.VIEW);
  Repository repository=PortletFileRepositoryUtil.fetchPortletRepository(getGroupId(),portletId);
  long threadAttachmetsFolderId=getThreadAttachmentsFolderId();
  if ((repository == null) || (threadAttachmetsFolderId == DLFolderConstants.DEFAULT_PARENT_FOLDER_ID)) {
    return DLFolderConstants.DEFAULT_PARENT_FOLDER_ID;
  }
  try {
    Folder folder=PortletFileRepositoryUtil.getPortletFolder(repository.getRepositoryId(),threadAttachmetsFolderId,String.valueOf(getMessageId()));
    _attachmentsFolderId=folder.getFolderId();
  }
 catch (  Exception e) {
  }
  return _attachmentsFolderId;
}
