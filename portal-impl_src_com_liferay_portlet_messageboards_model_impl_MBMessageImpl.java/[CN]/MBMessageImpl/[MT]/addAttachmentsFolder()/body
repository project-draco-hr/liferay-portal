{
  if (_attachmentsFolderId != DLFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
    return PortletFileRepositoryUtil.getPortletFolder(_attachmentsFolderId);
  }
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddGroupPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  String portletId=PortletProviderUtil.getPortletId(MBMessage.class.getName(),PortletProvider.Action.VIEW);
  Repository repository=PortletFileRepositoryUtil.addPortletRepository(getGroupId(),portletId,serviceContext);
  MBThread thread=getThread();
  Folder threadFolder=thread.addAttachmentsFolder();
  Folder folder=PortletFileRepositoryUtil.addPortletFolder(getUserId(),repository.getRepositoryId(),threadFolder.getFolderId(),String.valueOf(getMessageId()),serviceContext);
  _attachmentsFolderId=folder.getFolderId();
  return folder;
}
