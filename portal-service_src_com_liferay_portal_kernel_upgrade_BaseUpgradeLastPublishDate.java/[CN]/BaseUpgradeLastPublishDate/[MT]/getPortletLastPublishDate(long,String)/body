{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getUpgradeOptimizedConnection();
    ps=con.prepareStatement("select preferences from PortletPreferences where plid = ? " + "and ownerType = ? and ownerId = ? and portletId = ?");
    ps.setLong(1,LayoutConstants.DEFAULT_PLID);
    ps.setInt(2,PortletKeys.PREFS_OWNER_TYPE_GROUP);
    ps.setLong(3,groupId);
    ps.setString(4,portletId);
    rs=ps.executeQuery();
    while (rs.next()) {
      String preferences=rs.getString("preferences");
      if (Validator.isNotNull(preferences)) {
        int x=preferences.lastIndexOf("last-publish-date</name><value>");
        int y=preferences.indexOf("</value>",x);
        if (x < 0) {
          break;
        }
        String lastPublishDateString=preferences.substring(x,y);
        if (Validator.isNotNull(lastPublishDateString)) {
          return new Date(GetterUtil.getLong(lastPublishDateString));
        }
      }
    }
    return null;
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
