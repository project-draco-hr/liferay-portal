{
  long companyId=layout.getCompanyId();
  LayoutTypePortlet copyLayoutTypePortlet=(LayoutTypePortlet)copyLayout.getLayoutType();
  List copyPortletIds=copyLayoutTypePortlet.getPortletIds();
  for (int i=0; i < copyPortletIds.size(); i++) {
    String copyPortletId=(String)copyPortletIds.get(i);
    ActionRequestImpl reqImpl=(ActionRequestImpl)req;
    HttpServletRequest httpReq=(HttpServletRequest)reqImpl.getHttpServletRequest();
    String[] portletPreferencesIds=PortletPreferencesFactory.getPortletPreferencesIds(httpReq,layout.getPlid(),copyPortletId);
    PortletPreferencesLocalServiceUtil.getPreferences(companyId,portletPreferencesIds[0],portletPreferencesIds[1],portletPreferencesIds[2]);
    String[] copyPrtletPreferencesIds=PortletPreferencesFactory.getPortletPreferencesIds(httpReq,copyLayout.getPlid(),copyPortletId);
    PortletPreferences copyPrefs=PortletPreferencesLocalServiceUtil.getPreferences(companyId,copyPrtletPreferencesIds[0],copyPrtletPreferencesIds[1],copyPrtletPreferencesIds[2]);
    PortletPreferencesLocalServiceUtil.updatePreferences(portletPreferencesIds[0],portletPreferencesIds[1],portletPreferencesIds[2],copyPrefs);
    PortletPreferencesLocalServiceUtil.getPreferences(companyId,layout.getOwnerId(),layout.getLayoutId(),copyPortletId);
    copyPrefs=PortletPreferencesLocalServiceUtil.getPreferences(companyId,copyLayout.getOwnerId(),copyLayout.getLayoutId(),copyPortletId);
    PortletPreferencesLocalServiceUtil.updatePreferences(layout.getOwnerId(),layout.getLayoutId(),copyPortletId,copyPrefs);
  }
}
