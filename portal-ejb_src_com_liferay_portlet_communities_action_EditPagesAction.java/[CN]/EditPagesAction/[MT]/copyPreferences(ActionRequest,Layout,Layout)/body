{
  String companyId=layout.getCompanyId();
  LayoutTypePortlet copyLayoutTypePortlet=(LayoutTypePortlet)copyLayout.getLayoutType();
  List copyPortletIds=copyLayoutTypePortlet.getPortletIds();
  for (int i=0; i < copyPortletIds.size(); i++) {
    String copyPortletId=(String)copyPortletIds.get(i);
    ActionRequestImpl reqImpl=(ActionRequestImpl)req;
    HttpServletRequest httpReq=(HttpServletRequest)reqImpl.getHttpServletRequest();
    PortletPreferencesPK prefsPK=PortletPreferencesFactory.getPortletPreferencesPK(httpReq,copyPortletId,layout.getPlid());
    PortletPreferencesLocalServiceUtil.getPreferences(companyId,prefsPK);
    PortletPreferencesPK copyPrefsPK=PortletPreferencesFactory.getPortletPreferencesPK(httpReq,copyPortletId,copyLayout.getPlid());
    PortletPreferences copyPrefs=PortletPreferencesLocalServiceUtil.getPreferences(companyId,copyPrefsPK);
    PortletPreferencesLocalServiceUtil.updatePreferences(prefsPK,copyPrefs);
    prefsPK=new PortletPreferencesPK(copyPortletId,layout.getLayoutId(),layout.getOwnerId());
    PortletPreferencesLocalServiceUtil.getPreferences(companyId,prefsPK);
    copyPrefsPK=new PortletPreferencesPK(copyPortletId,copyLayout.getLayoutId(),copyLayout.getOwnerId());
    copyPrefs=PortletPreferencesLocalServiceUtil.getPreferences(companyId,copyPrefsPK);
    PortletPreferencesLocalServiceUtil.updatePreferences(prefsPK,copyPrefs);
  }
}
