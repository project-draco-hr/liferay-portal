{
  MembershipPolicy membershipPolicy=MembershipPolicyFactory.getInstance();
  if (membershipPolicy.getClass() == DefaultMembershipPolicy.class) {
    return;
  }
  LinkedHashMap<String,Object> groupParams=new LinkedHashMap<String,Object>();
  groupParams.put("inheritance",Boolean.FALSE);
  groupParams.put("site",Boolean.TRUE);
  groupParams.put("usersGroups",user.getUserId());
  List<Group> userGroups=groupLocalService.search(user.getCompanyId(),groupParams,QueryUtil.ALL_POS,QueryUtil.ALL_POS);
  for (  Group userGroup : userGroups) {
    List<Role> mandatoryRoles=membershipPolicy.getMandatoryRoles(userGroup,user);
    for (    Role role : mandatoryRoles) {
      if (!hasUserGroupRole(user.getUserId(),userGroup.getGroupId(),role.getRoleId(),false)) {
        addUserGroupRoles(user.getUserId(),userGroup.getGroupId(),new long[]{role.getRoleId()});
      }
    }
    List<Role> forbiddenRoles=membershipPolicy.getForbiddenRoles(userGroup,user);
    for (    Role role : forbiddenRoles) {
      if (hasUserGroupRole(user.getUserId(),userGroup.getGroupId(),role.getRoleId(),false)) {
        deleteUserGroupRoles(user.getUserId(),userGroup.getGroupId(),new long[]{role.getRoleId()});
      }
    }
  }
}
