{
  String xml=null;
  Locale[] locales=LanguageUtil.getAvailableLocales();
  Locale defaultLocale=LocaleUtil.getDefault();
  String defaultLanguageId=LocaleUtil.toLanguageId(defaultLocale);
  for (  Locale locale : locales) {
    String languageId=LocaleUtil.toLanguageId(locale);
    String localizedParameter=getPreferencesKey(parameter,languageId);
    String prefixedLocalizedParameter=localizedParameter;
    if (Validator.isNotNull(prefix)) {
      prefixedLocalizedParameter=prefix + "--" + localizedParameter+ "--";
    }
    String value=ParamUtil.getString(portletRequest,prefixedLocalizedParameter,preferences.getValue(localizedParameter,null));
    if (value != null) {
      xml=updateLocalization(xml,parameter,value,languageId);
    }
  }
  if (getLocalization(xml,defaultLanguageId,true,null) == null) {
    String oldValue=PrefsParamUtil.getString(preferences,portletRequest,parameter,defaultValue);
    if (Validator.isNotNull(oldValue)) {
      xml=updateLocalization(xml,parameter,oldValue);
    }
  }
  return xml;
}
