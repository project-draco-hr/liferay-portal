{
  Map<String,Object> map1=new LinkedHashMap<>();
  Map<String,Object> params=new LinkedHashMap<>();
  map1.put("$data = /foo/get-foo-data",params);
  params.put("id",173);
  Map<String,Object> map2=new LinkedHashMap<>();
  params.put("$spy = /foo/get-foo-data",map2);
  map2.put("id","007");
  Map<String,Object> map3=new LinkedHashMap<>();
  map2.put("$thief = /foo/get-foo-data",map3);
  map3.put("id",-13);
  Map<String,Object> map4=new LinkedHashMap<>();
  map3.put("$world = /foo/hello-world",map4);
  map4.put("@userId","$thief.id");
  map4.put("worldName","Jupiter");
  String json=toJSON(map1);
  JSONWebServiceAction jsonWebServiceAction=prepareInvokerAction(json);
  Object result=jsonWebServiceAction.invoke();
  JSONWebServiceInvokerAction.InvokerResult invokerResult=(JSONWebServiceInvokerAction.InvokerResult)result;
  Assert.assertTrue(invokerResult.getResult() instanceof Map);
  StringBundler sb=new StringBundler(5);
  sb.append("{\"height\":177,\"id\":173,\"name\":\"John Doe\",");
  sb.append("\"spy\":{\"height\":173,\"id\":7,\"name\":\"James Bond\",");
  sb.append("\"thief\":{\"height\":59,\"id\":-13,\"name\":\"Dr. Evil\",");
  sb.append("\"value\":\"fun\",\"world\":\"Welcome -13 to Jupiter\"},");
  sb.append("\"value\":\"licensed\"},\"value\":\"foo!\"}");
  Assert.assertEquals(toMap(sb.toString()),toMap(toJSON(result)));
}
