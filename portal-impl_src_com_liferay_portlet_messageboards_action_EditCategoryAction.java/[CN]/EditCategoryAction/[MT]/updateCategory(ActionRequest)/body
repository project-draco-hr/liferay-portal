{
  Layout layout=(Layout)actionRequest.getAttribute(WebKeys.LAYOUT);
  long categoryId=ParamUtil.getLong(actionRequest,"categoryId");
  long parentCategoryId=ParamUtil.getLong(actionRequest,"parentCategoryId");
  String name=ParamUtil.getString(actionRequest,"name");
  String description=ParamUtil.getString(actionRequest,"description");
  boolean mergeWithParentCategory=ParamUtil.getBoolean(actionRequest,"mergeWithParentCategory");
  String[] communityPermissions=actionRequest.getParameterValues("communityPermissions");
  String[] guestPermissions=actionRequest.getParameterValues("guestPermissions");
  String mailingListAddress=ParamUtil.getString(actionRequest,"mailingListAddress");
  String mailAddress=ParamUtil.getString(actionRequest,"mailAddress");
  String mailInProtocol=ParamUtil.getString(actionRequest,"mailInProtocol");
  String mailInServerName=ParamUtil.getString(actionRequest,"mailInServerName");
  Boolean mailInUseSSL=Boolean.valueOf(ParamUtil.getBoolean(actionRequest,"mailInUseSSL"));
  Integer mailInServerPort=new Integer(ParamUtil.getInteger(actionRequest,"mailInServerPort"));
  String mailInUserName=ParamUtil.getString(actionRequest,"mailInUserName");
  String mailInPassword=ParamUtil.getString(actionRequest,"mailInPassword");
  Integer mailInReadInterval=ParamUtil.getInteger(actionRequest,"mailInReadInterval");
  Boolean mailOutConfigured=Boolean.valueOf(ParamUtil.getBoolean(actionRequest,"mailOutConfigured"));
  String mailOutServerName=ParamUtil.getString(actionRequest,"mailOutServerName");
  Boolean mailOutUseSSL=Boolean.valueOf(ParamUtil.getBoolean(actionRequest,"mailOutUseSSL"));
  Integer mailOutServerPort=new Integer(ParamUtil.getInteger(actionRequest,"mailOutServerPort"));
  String mailOutUserName=ParamUtil.getString(actionRequest,"mailOutUserName");
  String mailOutPassword=ParamUtil.getString(actionRequest,"mailOutPassword");
  if (categoryId <= 0) {
    if (PropsValues.CAPTCHA_CHECK_PORTLET_MESSAGE_BOARDS_EDIT_CATEGORY) {
      CaptchaUtil.check(actionRequest);
    }
    MBCategoryServiceUtil.addCategory(layout.getPlid(),parentCategoryId,name,description,mailingListAddress,mailAddress,mailInProtocol,mailInServerName,mailInUseSSL,mailInServerPort,mailInUserName,mailInPassword,mailInReadInterval,mailOutConfigured,mailOutServerName,mailOutUseSSL,mailOutServerPort,mailOutUserName,mailOutPassword,communityPermissions,guestPermissions);
  }
 else {
    MBCategoryServiceUtil.updateCategory(categoryId,parentCategoryId,name,description,mergeWithParentCategory,mailingListAddress,mailAddress,mailInProtocol,mailInServerName,mailInUseSSL,mailInServerPort,mailInUserName,mailInPassword,mailInReadInterval,mailOutConfigured,mailOutServerName,mailOutUseSSL,mailOutServerPort,mailOutUserName,mailOutPassword);
  }
}
