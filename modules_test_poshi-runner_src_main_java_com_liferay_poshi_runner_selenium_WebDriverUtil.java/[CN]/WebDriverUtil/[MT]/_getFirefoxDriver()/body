{
  FirefoxProfile firefoxProfile=new FirefoxProfile();
  try {
    firefoxProfile.addExtension(WebDriverUtil.class,"/META-INF/resources/firefox/extensions/jserrorcollector.xpi");
  }
 catch (  Exception e) {
  }
  String outputDirName=PropsValues.OUTPUT_DIR_NAME;
  if (OSDetector.isWindows()) {
    outputDirName=StringUtil.replace(outputDirName,StringPool.FORWARD_SLASH,StringPool.BACK_SLASH);
  }
  firefoxProfile.setPreference("browser.download.dir",outputDirName);
  firefoxProfile.setPreference("browser.download.folderList",2);
  firefoxProfile.setPreference("browser.download.manager.showWhenStarting",false);
  firefoxProfile.setPreference("browser.download.useDownloadDir",true);
  firefoxProfile.setPreference("browser.helperApps.alwaysAsk.force",false);
  firefoxProfile.setPreference("browser.helperApps.neverAsk.saveToDisk","application/excel,application/msword,application/pdf," + "application/zip,audio/mpeg3,image/jpeg,image/png,text/plain");
  firefoxProfile.setPreference("dom.max_chrome_script_run_time",300);
  firefoxProfile.setPreference("dom.max_script_run_time",300);
  if (Validator.isNotNull(PropsValues.BROWSER_FIREFOX_BIN_FILE)) {
    File file=new File(PropsValues.BROWSER_FIREFOX_BIN_FILE);
    FirefoxBinary firefoxBinary=new FirefoxBinary(file);
    return new FirefoxDriver(firefoxBinary,firefoxProfile);
  }
 else {
    return new FirefoxDriver(firefoxProfile);
  }
}
