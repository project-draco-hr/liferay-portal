{
  ServiceContext serviceContext=getInstance(portletRequest);
  String[] groupPermissions=PortalUtil.getGroupPermissions(portletRequest,className);
  String[] guestPermissions=PortalUtil.getGuestPermissions(portletRequest,className);
  if (groupPermissions != null) {
    serviceContext.setGroupPermissions(groupPermissions);
  }
  if (guestPermissions != null) {
    serviceContext.setGuestPermissions(guestPermissions);
  }
  Map<String,Serializable> expandoBridgeAttributes=PortalUtil.getExpandoBridgeAttributes(ExpandoBridgeFactoryUtil.getExpandoBridge(serviceContext.getCompanyId(),className),portletRequest);
  serviceContext.setExpandoBridgeAttributes(expandoBridgeAttributes);
  return serviceContext;
}
