{
  ServiceContext serviceContext=getInstance(portletRequest);
  String[] groupPermissions=PortalUtil.getGroupPermissions(portletRequest,className);
  String[] guestPermissions=PortalUtil.getGuestPermissions(portletRequest,className);
  if ((groupPermissions != null) || (guestPermissions != null)) {
    serviceContext.setGroupPermissions(groupPermissions);
    serviceContext.setGuestPermissions(guestPermissions);
    ModelPermissions modelPermissions=ModelPermissionsFactory.create(serviceContext.getCompanyId(),serviceContext.getScopeGroupId(),groupPermissions,guestPermissions);
    serviceContext.setModelPermissions(modelPermissions);
  }
  Map<String,Serializable> expandoBridgeAttributes=PortalUtil.getExpandoBridgeAttributes(ExpandoBridgeFactoryUtil.getExpandoBridge(serviceContext.getCompanyId(),className),portletRequest);
  serviceContext.setExpandoBridgeAttributes(expandoBridgeAttributes);
  return serviceContext;
}
