{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(portletDisplay.getId());
  PortletURL portletURL=PortletURLFactoryUtil.create(portletRequest,PortletProviderUtil.getPortletId(JournalArticle.class.getName(),PortletProvider.Action.EDIT),themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  String articleId=portletRequest.getPreferences().getValue("articleId",null);
  PortletURL redirectURL=PortletURLFactoryUtil.create(portletRequest,JournalContentPortletKeys.JOURNAL_CONTENT,themeDisplay.getPlid(),PortletRequest.RENDER_PHASE);
  try {
    portletURL.setWindowState(LiferayWindowState.POP_UP);
    redirectURL.setWindowState(LiferayWindowState.POP_UP);
  }
 catch (  WindowStateException e) {
    _log.error("Unable to set window state",e);
  }
  redirectURL.setParameter("mvcPath","/update_journal_article_redirect.jsp");
  redirectURL.setParameter("referringPortletResource",portletDisplay.getId());
  portletURL.setParameter("hideDefaultSuccessMessage",Boolean.TRUE.toString());
  portletURL.setParameter("showBackURL",Boolean.FALSE.toString());
  portletURL.setParameter("showHeader",Boolean.FALSE.toString());
  portletURL.setParameter("mvcPath","/edit_article.jsp");
  portletURL.setParameter("redirect",redirectURL.toString());
  portletURL.setParameter("groupId",String.valueOf(themeDisplay.getScopeGroupId()));
  portletURL.setParameter("articleId",articleId);
  portletURL.setParameter("refererPortletName",JournalContentPortletKeys.JOURNAL_CONTENT);
  portletURL.setParameter("refererWebDAVToken",WebDAVUtil.getStorageToken(portlet));
  return portletURL.toString();
}
