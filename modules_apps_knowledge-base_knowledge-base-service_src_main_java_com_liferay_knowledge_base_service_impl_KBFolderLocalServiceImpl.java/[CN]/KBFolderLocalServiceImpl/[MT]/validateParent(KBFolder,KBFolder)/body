{
  if (kbFolder.getGroupId() != parentKBFolder.getGroupId()) {
    throw new NoSuchFolderException(String.format("No KB folder with KB folder ID %s found in group %s",parentKBFolder.getKbFolderId(),kbFolder.getGroupId()));
  }
  Set<Long> subfolderIds=new HashSet<>();
  getSubfolderIds(kbFolder,subfolderIds);
  if (subfolderIds.contains(parentKBFolder.getKbFolderId())) {
    throw new InvalidKBFolderNameException(String.format("Cannot move KBFolder %s inside its descendant KBFolder %s",kbFolder.getKbFolderId(),parentKBFolder.getKbFolderId()));
  }
}
