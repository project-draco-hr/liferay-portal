{
  try {
    checkPermissions(req);
  }
 catch (  PrincipalException pe) {
    return;
  }
  String cmd=ParamUtil.getString(req,Constants.CMD);
  try {
    if (cmd.equals(Constants.ADD) || cmd.equals(Constants.UPDATE)) {
      updateLayout(req,res);
    }
 else     if (cmd.equals(Constants.DELETE)) {
      CommunitiesUtil.deleteLayout(req,res);
    }
 else     if (cmd.equals("copy_from_live")) {
      StagingUtil.copyFromLive(req);
    }
 else     if (cmd.equals("display_order")) {
      updateDisplayOrder(req);
    }
 else     if (cmd.equals("logo")) {
      updateLogo(req);
    }
 else     if (cmd.equals("look_and_feel")) {
      updateLookAndFeel(req);
    }
 else     if (cmd.equals("merge_pages")) {
      updateMergePages(req);
    }
 else     if (cmd.equals("monitoring")) {
      updateMonitoring(req);
    }
 else     if (cmd.equals("publish_to_live")) {
      StagingUtil.publishToLive(req);
    }
 else     if (cmd.equals("publish_to_remote")) {
      StagingUtil.publishToRemote(req);
    }
 else     if (cmd.equals("schedule_publish_to_live")) {
      StagingUtil.schedulePublishToLive(req);
    }
 else     if (cmd.equals("schedule_publish_to_remote")) {
      StagingUtil.schedulePublishToRemote(req);
    }
 else     if (cmd.equals("staging")) {
      StagingUtil.updateStaging(req);
    }
 else     if (cmd.equals("unschedule_publish_to_live")) {
      StagingUtil.unschedulePublishToLive(req);
    }
 else     if (cmd.equals("unschedule_publish_to_remote")) {
      StagingUtil.unschedulePublishToRemote(req);
    }
 else     if (cmd.equals("virtual_host")) {
      updateVirtualHost(req);
    }
 else     if (cmd.equals("workflow")) {
      updateWorkflow(req);
    }
    String redirect=ParamUtil.getString(req,"pagesRedirect");
    sendRedirect(req,res,redirect);
  }
 catch (  Exception e) {
    if (e instanceof NoSuchLayoutException || e instanceof NoSuchProposalException || e instanceof PrincipalException) {
      SessionErrors.add(req,e.getClass().getName());
      setForward(req,"portlet.communities.error");
    }
 else     if (e instanceof RemoteExportException) {
      SessionErrors.add(req,e.getClass().getName(),e);
      String redirect=ParamUtil.getString(req,"pagesRedirect");
      sendRedirect(req,res,redirect);
    }
 else     if (e instanceof LayoutFriendlyURLException || e instanceof LayoutHiddenException || e instanceof LayoutNameException|| e instanceof LayoutParentLayoutIdException|| e instanceof LayoutSetVirtualHostException|| e instanceof LayoutTypeException|| e instanceof RequiredLayoutException|| e instanceof UploadException) {
      if (e instanceof LayoutFriendlyURLException) {
        SessionErrors.add(req,LayoutFriendlyURLException.class.getName(),e);
      }
 else {
        SessionErrors.add(req,e.getClass().getName(),e);
      }
    }
 else {
      throw e;
    }
  }
}
