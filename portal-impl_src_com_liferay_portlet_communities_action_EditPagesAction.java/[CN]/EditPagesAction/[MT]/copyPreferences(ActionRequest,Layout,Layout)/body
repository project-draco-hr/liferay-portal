{
  long companyId=layout.getCompanyId();
  LayoutTypePortlet copyLayoutTypePortlet=(LayoutTypePortlet)copyLayout.getLayoutType();
  List<String> copyPortletIds=copyLayoutTypePortlet.getPortletIds();
  for (  String copyPortletId : copyPortletIds) {
    HttpServletRequest request=PortalUtil.getHttpServletRequest(actionRequest);
    PortletPreferencesIds portletPreferencesIds=PortletPreferencesFactoryUtil.getPortletPreferencesIds(request,layout,copyPortletId);
    PortletPreferencesLocalServiceUtil.getPreferences(portletPreferencesIds);
    PortletPreferencesIds copyPortletPreferencesIds=PortletPreferencesFactoryUtil.getPortletPreferencesIds(request,copyLayout,copyPortletId);
    PortletPreferences copyPrefs=PortletPreferencesLocalServiceUtil.getPreferences(copyPortletPreferencesIds);
    PortletPreferencesLocalServiceUtil.updatePreferences(portletPreferencesIds.getOwnerId(),portletPreferencesIds.getOwnerType(),portletPreferencesIds.getPlid(),portletPreferencesIds.getPortletId(),copyPrefs);
    PortletPreferencesLocalServiceUtil.getPreferences(companyId,PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,layout.getPlid(),copyPortletId);
    copyPrefs=PortletPreferencesLocalServiceUtil.getPreferences(companyId,PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,copyLayout.getPlid(),copyPortletId);
    PortletPreferencesLocalServiceUtil.updatePreferences(PortletKeys.PREFS_OWNER_ID_DEFAULT,PortletKeys.PREFS_OWNER_TYPE_LAYOUT,layout.getPlid(),copyPortletId,copyPrefs);
  }
}
