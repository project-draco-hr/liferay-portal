{
  String lowerCaseSql=sql.toLowerCase();
  int lastOrderByPos=lowerCaseSql.lastIndexOf("order by");
  if ((lastOrderByPos < 0) || (offset == 0) || StringUtil.endsWith(sql,StringPool.CLOSE_PARENTHESIS)) {
    return super.getLimitString(sql,0,limit);
  }
 else {
    int fromPos=lowerCaseSql.indexOf("from");
    String orderBy=sql.substring(lastOrderByPos,sql.length());
    String selectFrom=sql.substring(0,fromPos);
    String selectFromWhere=sql.substring(fromPos,lastOrderByPos);
    StringBundler sb=new StringBundler(10);
    sb.append("select * from (");
    sb.append(selectFrom);
    sb.append(", _page_row_num = row_number() over(");
    sb.append(orderBy);
    sb.append(")");
    sb.append(selectFromWhere);
    sb.append(" ) temp where _page_row_num between ");
    sb.append(offset + 1);
    sb.append(" and ");
    sb.append(limit);
    return sb.toString();
  }
}
