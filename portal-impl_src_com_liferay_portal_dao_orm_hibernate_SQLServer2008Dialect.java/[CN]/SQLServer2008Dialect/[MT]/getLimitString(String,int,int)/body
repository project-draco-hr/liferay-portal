{
  int lastOrderByPos=sql.toLowerCase().lastIndexOf("order by");
  if ((lastOrderByPos < 0) || StringUtil.endsWith(sql,StringPool.CLOSE_PARENTHESIS) || offset == 0) {
    return super.getLimitString(sql,0,limit);
  }
 else {
    int fromPos=sql.toLowerCase().indexOf("from");
    String orderby=sql.substring(lastOrderByPos,sql.length());
    String selectFrom=sql.substring(0,fromPos);
    String selectFromWhere=sql.substring(fromPos,lastOrderByPos);
    StringBundler sb=new StringBundler(5);
    sb.append("select * from (");
    sb.append(selectFrom);
    sb.append(", _page_row_num = row_number() over(");
    sb.append(orderby);
    sb.append(")");
    sb.append(selectFromWhere);
    sb.append(" ) temp where _page_row_num between ");
    sb.append(offset + 1);
    sb.append(" and ");
    sb.append(limit);
    return sb.toString();
  }
}
