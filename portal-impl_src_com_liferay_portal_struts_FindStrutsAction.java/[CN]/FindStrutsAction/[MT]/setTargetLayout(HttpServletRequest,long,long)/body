{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(WebKeys.THEME_DISPLAY);
  PermissionChecker permissionChecker=themeDisplay.getPermissionChecker();
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  Layout layout=LayoutLocalServiceUtil.getLayout(plid);
  if ((groupId == layout.getGroupId()) || (group.getParentGroupId() == layout.getGroupId()) || (layout.isPrivateLayout() && !SitesUtil.isUserGroupLayoutSetViewable(permissionChecker,layout.getGroup()))) {
    return layout;
  }
  layout=new VirtualLayout(layout,group);
  request.setAttribute(WebKeys.LAYOUT,layout);
  return layout;
}
