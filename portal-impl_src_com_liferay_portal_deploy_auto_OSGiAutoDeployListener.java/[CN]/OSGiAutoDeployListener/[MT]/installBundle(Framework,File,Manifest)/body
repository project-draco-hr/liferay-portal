{
  BundleContext bundleContext=framework.getBundleContext();
  Attributes attributes=manifest.getMainAttributes();
  String bundleSymbolicNameAttribute=attributes.getValue(Constants.BUNDLE_SYMBOLICNAME);
  String bundleVersionAttribute=attributes.getValue(Constants.BUNDLE_VERSION);
  Version bundleVersion=Version.parseVersion(bundleVersionAttribute);
  Map<String,Map<String,String>> bundleSymbolicNameMap=OSGiHeader.parseHeader(bundleSymbolicNameAttribute);
  String bundleSymbolicName=bundleSymbolicNameMap.keySet().iterator().next();
  Bundle bundle=null;
  for (  Bundle curBundle : bundleContext.getBundles()) {
    if (curBundle.getSymbolicName().equals(bundleSymbolicName) && curBundle.getVersion().equals(bundleVersion)) {
      bundle=curBundle;
      break;
    }
  }
  InputStream inputStream=new FileInputStream(file);
  if (bundle != null) {
    bundle.update(inputStream);
  }
 else {
    try {
      URI uri=file.toURI();
      bundle=bundleContext.installBundle(uri.toString(),inputStream);
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
  }
  if (bundle != null) {
    bundle.start();
  }
}
