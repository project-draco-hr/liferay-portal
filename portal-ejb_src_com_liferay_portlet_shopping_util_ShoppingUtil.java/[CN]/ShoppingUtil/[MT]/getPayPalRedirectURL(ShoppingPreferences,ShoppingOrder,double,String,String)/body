{
  String payPalEmailAddress=Http.encodeURL(prefs.getPayPalEmailAddress());
  NumberFormat doubleFormat=NumberFormat.getNumberInstance();
  doubleFormat.setMaximumFractionDigits(2);
  doubleFormat.setMinimumFractionDigits(2);
  String amount=doubleFormat.format(total);
  returnURL=Http.encodeURL(returnURL);
  notifyURL=Http.encodeURL(notifyURL);
  String firstName=Http.encodeURL(order.getBillingFirstName());
  String lastName=Http.encodeURL(order.getBillingLastName());
  String address1=Http.encodeURL(order.getBillingStreet());
  String city=Http.encodeURL(order.getBillingCity());
  String state=Http.encodeURL(order.getBillingState());
  String zip=Http.encodeURL(order.getBillingZip());
  String currencyCode=prefs.getCurrencyId();
  StringBuffer sb=new StringBuffer();
  sb.append("https://www.paypal.com/cgi-bin/webscr?");
  sb.append("cmd=_xclick&");
  sb.append("business=").append(payPalEmailAddress).append("&");
  sb.append("item_name=").append(order.getOrderId()).append("&");
  sb.append("item_number=").append(order.getOrderId()).append("&");
  sb.append("invoice=").append(order.getOrderId()).append("&");
  sb.append("amount=").append(amount).append("&");
  sb.append("return=").append(returnURL).append("&");
  sb.append("notify_url=").append(notifyURL).append("&");
  sb.append("first_name=").append(firstName).append("&");
  sb.append("last_name=").append(lastName).append("&");
  sb.append("address1=").append(address1).append("&");
  sb.append("city=").append(city).append("&");
  sb.append("state=").append(state).append("&");
  sb.append("zip=").append(zip).append("&");
  sb.append("no_note=1&");
  sb.append("currency_code=").append(currencyCode).append("");
  return sb.toString();
}
