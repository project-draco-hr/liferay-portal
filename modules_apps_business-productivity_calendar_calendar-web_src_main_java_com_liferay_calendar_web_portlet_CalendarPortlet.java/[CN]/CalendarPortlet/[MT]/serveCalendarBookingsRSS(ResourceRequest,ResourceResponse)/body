{
  PortletPreferences portletPreferences=resourceRequest.getPreferences();
  boolean enableRss=GetterUtil.getBoolean(portletPreferences.getValue("enableRss",null),true);
  if (!PortalUtil.isRSSFeedsEnabled() || !enableRss) {
    PortalUtil.sendRSSFeedsDisabledError(resourceRequest,resourceResponse);
    return;
  }
  ThemeDisplay themeDisplay=(ThemeDisplay)resourceRequest.getAttribute(WebKeys.THEME_DISPLAY);
  long calendarId=ParamUtil.getLong(resourceRequest,"calendarId");
  long timeInterval=GetterUtil.getLong(portletPreferences.getValue("rssTimeInterval",StringPool.BLANK),RSSUtil.TIME_INTERVAL_DEFAULT);
  long startTime=System.currentTimeMillis();
  long endTime=startTime + timeInterval;
  int max=GetterUtil.getInteger(portletPreferences.getValue("rssDelta",StringPool.BLANK),SearchContainer.DEFAULT_DELTA);
  String rssFeedType=portletPreferences.getValue("rssFeedType",RSSUtil.FORMAT_DEFAULT);
  String type=RSSUtil.getFormatType(rssFeedType);
  double version=RSSUtil.getFeedTypeVersion(rssFeedType);
  String displayStyle=portletPreferences.getValue("rssDisplayStyle",RSSUtil.DISPLAY_STYLE_DEFAULT);
  String rss=_calendarBookingService.getCalendarBookingsRSS(calendarId,startTime,endTime,max,type,version,displayStyle,themeDisplay);
  PortletResponseUtil.sendFile(resourceRequest,resourceResponse,null,rss.getBytes(),ContentTypes.TEXT_XML_UTF8);
}
