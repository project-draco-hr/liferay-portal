{
  try {
    NodeIterator itr=dirNode.getNodes();
    FileModel fileModel=new FileModel();
    fileModel.setCompanyId(companyId);
    fileModel.setPortletId(portletId);
    fileModel.setRepositoryId(repositoryId);
    Indexer indexer=IndexerRegistryUtil.getIndexer(FileModel.class);
    while (itr.hasNext()) {
      Node node=(Node)itr.next();
      String primaryNodeTypeName=node.getPrimaryNodeType().getName();
      if (primaryNodeTypeName.equals(JCRConstants.NT_FOLDER)) {
        deleteDirectory(companyId,portletId,repositoryId,node);
      }
 else       if (primaryNodeTypeName.equals(JCRConstants.NT_FILE)) {
        fileModel.setFileName(node.getName());
        indexer.delete(fileModel);
      }
    }
    fileModel.setFileName(dirNode.getName());
    indexer.delete(fileModel);
  }
 catch (  RepositoryException e) {
    _log.error(e);
  }
}
