{
  boolean hasError=false;
  try {
    platformTransactionManager.commit(transactionStatus);
  }
 catch (  TransactionSystemException tse) {
    _log.error("Application exception overridden by commit exception",tse);
    hasError=true;
    throw tse;
  }
catch (  RuntimeException re) {
    _log.error("Application exception overridden by commit exception",re);
    hasError=true;
    throw re;
  }
catch (  Error e) {
    _log.error("Application exception overridden by commit error",e);
    hasError=true;
    throw e;
  }
 finally {
    if (transactionStatus.isNewTransaction()) {
      if (hasError) {
        TransactionalPortalCacheHelper.rollback();
        TransactionCommitCallbackUtil.popCallbackList();
        EntityCacheUtil.clearLocalCache();
        FinderCacheUtil.clearLocalCache();
      }
 else {
        TransactionalPortalCacheHelper.commit();
        invokeCallbacks();
      }
    }
  }
}
