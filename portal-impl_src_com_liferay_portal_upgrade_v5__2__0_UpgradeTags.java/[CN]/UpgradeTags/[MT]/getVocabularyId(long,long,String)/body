{
  vocabularyName=vocabularyName.trim();
  if (Validator.isNull(vocabularyName) || ArrayUtil.contains(_DEFAULT_CATEGORY_PROPERTY_VALUES,vocabularyName)) {
    vocabularyName=PropsValues.TAGS_VOCABULARY_DEFAULT;
  }
  String key=groupId + StringPool.UNDERLINE + vocabularyName;
  TagsVocabulary vocabulary=_vocabulariesMap.get(key);
  if (vocabulary == null) {
    try {
      vocabulary=TagsVocabularyLocalServiceUtil.getGroupVocabulary(groupId,vocabularyName);
    }
 catch (    NoSuchVocabularyException nsve) {
      ServiceContext serviceContext=new ServiceContext();
      serviceContext.setAddCommunityPermissions(true);
      serviceContext.setAddGuestPermissions(true);
      serviceContext.setScopeGroupId(groupId);
      vocabulary=TagsVocabularyLocalServiceUtil.addVocabulary(userId,vocabularyName,true,serviceContext);
    }
    _vocabulariesMap.put(key,vocabulary);
  }
  return vocabulary.getVocabularyId();
}
