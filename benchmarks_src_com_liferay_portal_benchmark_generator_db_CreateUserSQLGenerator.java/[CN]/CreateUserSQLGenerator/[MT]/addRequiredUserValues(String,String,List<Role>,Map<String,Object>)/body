{
  Contact contact=new Contact(_generator.generate(),_companyId,_defaultUserId,_defaultUserName,firstName,lastName);
  User user=new User(_companyId,_generator.generate(),createScreenName(firstName,lastName),createEmail(firstName,lastName,_domain),_defaultPassword,contact);
  context.put("user",user);
  user.addRoles(roles);
  Group group=new Group(_generator.generate(),_companyId,user.getUserId(),ClassName.USER.getClassNameId(),user.getUserId());
  user.setPrivateGroup(group);
  user.setPublicLayoutSet(new LayoutSet(_generator.generate(),group.getGroupId(),_companyId,false,"classic","01","mobile","01"));
  user.setPrivateLayoutSet(new LayoutSet(_generator.generate(),group.getGroupId(),_companyId,true,"classic","01","mobile","01"));
  Resource resource=new Resource(_generator.generate(IDGenerator.RESOURCE),ResourceCodes.USER_4.getCodeId(),String.valueOf(user.getUserId()));
  context.put("resource",resource);
  List<Permission> permissions=new ArrayList<Permission>();
  permissions.add(new Permission(_generator.generate(IDGenerator.PERMISSION),_companyId,ResourceAction.DELETE.name(),resource.getResourceId()));
  permissions.add(new Permission(_generator.generate(IDGenerator.PERMISSION),_companyId,ResourceAction.IMPERSONATE.name(),resource.getResourceId()));
  permissions.add(new Permission(_generator.generate(IDGenerator.PERMISSION),_companyId,ResourceAction.PERMISSIONS.name(),resource.getResourceId()));
  permissions.add(new Permission(_generator.generate(IDGenerator.PERMISSION),_companyId,ResourceAction.UPDATE.name(),resource.getResourceId()));
  permissions.add(new Permission(_generator.generate(IDGenerator.PERMISSION),_companyId,ResourceAction.VIEW.name(),resource.getResourceId()));
  context.put("permissions",permissions);
  return user;
}
