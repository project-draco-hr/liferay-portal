{
  OutputStream os=null;
  String isClassName=is.getClass().getName();
  if (!isClassName.equals(BufferedInputStream.class.getName())) {
    is=new BufferedInputStream(is);
  }
  try {
    if (!response.isCommitted()) {
      if (contentLength > 0) {
        response.setContentLength(contentLength);
      }
      os=new BufferedOutputStream(response.getOutputStream());
      int c=is.read();
      while (c != -1) {
        os.write(c);
        c=is.read();
      }
    }
  }
  finally {
    cleanUp(os,is);
  }
}
