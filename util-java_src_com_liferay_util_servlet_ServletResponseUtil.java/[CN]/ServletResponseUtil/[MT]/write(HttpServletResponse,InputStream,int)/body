{
  OutputStream os=null;
  try {
    if (!response.isCommitted()) {
      if (contentLength > 0) {
        response.setContentLength(contentLength);
      }
      os=new BufferedOutputStream(response.getOutputStream());
      if (!(is instanceof BufferedInputStream)) {
        is=new BufferedInputStream(is);
      }
      int c=is.read();
      while (c != -1) {
        os.write(c);
        c=is.read();
      }
    }
  }
  finally {
    cleanUp(os,is);
  }
}
