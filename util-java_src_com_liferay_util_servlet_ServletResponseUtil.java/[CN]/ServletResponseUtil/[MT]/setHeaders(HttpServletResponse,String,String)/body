{
  if (_log.isDebugEnabled()) {
    _log.debug("Sending file of type " + contentType);
  }
  if (Validator.isNotNull(contentType)) {
    res.setContentType(contentType);
  }
  res.setHeader(HttpHeaders.CACHE_CONTROL,HttpHeaders.PUBLIC);
  res.setHeader(HttpHeaders.PRAGMA,HttpHeaders.PUBLIC);
  if (Validator.isNotNull(fileName)) {
    String contentDisposition="attachment; filename=\"" + fileName + "\"";
    try {
      URLCodec codec=new URLCodec("UTF-8");
      String encodedFileName=StringUtil.replace(codec.encode(fileName),"+","%20");
      String escapedSpacesFileName=StringUtil.replace(fileName," ","%20");
      if (!escapedSpacesFileName.equals(encodedFileName)) {
        contentDisposition="attachment; filename*=UTF-8''" + encodedFileName;
      }
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn(e);
      }
    }
    res.setHeader(HttpHeaders.CONTENT_DISPOSITION,contentDisposition);
  }
}
