{
  UploadPortletRequest uploadReq=PortalUtil.getUploadPortletRequest(req);
  String imageId=ParamUtil.getString(uploadReq,"imageId");
  String folderId=ParamUtil.getString(uploadReq,"folderId");
  String description=ParamUtil.getString(uploadReq,"description");
  File file=uploadReq.getFile("file");
  String contentType=uploadReq.getContentType("file");
  boolean addCommunityPermissions=ParamUtil.getBoolean(uploadReq,"addCommunityPermissions");
  boolean addGuestPermissions=ParamUtil.getBoolean(uploadReq,"addGuestPermissions");
  if (Validator.isNull(imageId)) {
    IGImageServiceUtil.addImage(folderId,description,file,contentType,addCommunityPermissions,addGuestPermissions);
  }
 else {
    IGImageServiceUtil.updateImage(imageId,folderId,description,file,contentType);
  }
}
