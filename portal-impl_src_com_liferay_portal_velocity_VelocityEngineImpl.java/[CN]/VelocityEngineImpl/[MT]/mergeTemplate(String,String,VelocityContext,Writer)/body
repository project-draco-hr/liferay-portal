{
  try {
    if (Validator.isNotNull(template) && !resourceExists(templateId)) {
      StringResourceLoader.getRepository().putStringResource(templateId,template);
      _log.debug("Added " + templateId + " to the Velocity repository");
    }
    VelocityContextImpl velocityContextImpl=(VelocityContextImpl)velocityContext;
    return _velocityEngine.mergeTemplate(templateId,StringPool.UTF8,velocityContextImpl.getWrappedVelocityContext(),writer);
  }
 catch (  IOException ioe) {
    throw ioe;
  }
catch (  Exception e) {
    throw new SystemException(e);
  }
}
