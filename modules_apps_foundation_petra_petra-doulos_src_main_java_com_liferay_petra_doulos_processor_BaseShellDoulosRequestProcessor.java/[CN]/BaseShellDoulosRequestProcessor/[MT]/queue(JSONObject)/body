{
  ShellStatus shellStatus=null;
  String key=getKey(payloadJSONObject);
synchronized (this) {
    shellStatus=_shellStatuses.get(key);
    if (isRemoveRequest(payloadJSONObject)) {
      if (shellStatus != null) {
        _shellStatuses.remove(key);
      }
      shellStatus=createShellStatus(payloadJSONObject);
      shellStatus.status="removed";
      return shellStatus;
    }
    if (shellStatus != null) {
      long expiredTime=getExpiredTime();
      if ((expiredTime > 0) && (shellStatus.time < getExpiredTime())) {
        _shellStatuses.remove(key);
        shellStatus=null;
      }
    }
    if (shellStatus == null) {
      if (_log.isInfoEnabled()) {
        _log.info("Adding " + key + " to queue");
      }
      shellStatus=createShellStatus(payloadJSONObject);
      _shellStatuses.put(key,shellStatus);
      _queue.add(shellStatus);
    }
  }
  return shellStatus;
}
