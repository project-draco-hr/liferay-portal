{
  jsonObject.put("success",Boolean.FALSE);
  if (pe instanceof AntivirusScannerException || pe instanceof FileNameException || pe instanceof FileSizeException|| pe instanceof RequestContentLengthException) {
    String errorMessage=StringPool.BLANK;
    int errorType=0;
    ThemeDisplay themeDisplay=(ThemeDisplay)portletRequest.getAttribute(WebKeys.THEME_DISPLAY);
    if (pe instanceof AntivirusScannerException) {
      errorType=ServletResponseConstants.SC_FILE_ANTIVIRUS_EXCEPTION;
      AntivirusScannerException ase=(AntivirusScannerException)pe;
      errorMessage=themeDisplay.translate(ase.getMessageKey());
    }
 else     if (pe instanceof FileNameException) {
      errorType=ServletResponseConstants.SC_FILE_NAME_EXCEPTION;
    }
 else     if (pe instanceof FileSizeException) {
      errorType=ServletResponseConstants.SC_FILE_SIZE_EXCEPTION;
    }
 else     if (pe instanceof RequestContentLengthException) {
      errorType=ServletResponseConstants.SC_UPLOAD_REQUEST_CONTENT_LENGTH_EXCEPTION;
    }
    JSONObject errorJSONObject=JSONFactoryUtil.createJSONObject();
    errorJSONObject.put("errorType",errorType);
    errorJSONObject.put("message",errorMessage);
    jsonObject.put("error",errorJSONObject);
  }
 else {
    doHandleUploadException(portletRequest,portletResponse,pe,jsonObject);
  }
  try {
    JSONPortletResponseUtil.writeJSON(portletRequest,portletResponse,jsonObject);
  }
 catch (  IOException ioe) {
    throw new SystemException(ioe);
  }
}
