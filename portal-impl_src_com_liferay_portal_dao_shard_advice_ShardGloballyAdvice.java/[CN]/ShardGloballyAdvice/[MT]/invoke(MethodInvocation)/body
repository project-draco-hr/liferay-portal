{
  Object returnValue=null;
  boolean isCompanyPushed=false;
  _shardAdvice.setGlobalCall(new Object());
  try {
    if (_log.isInfoEnabled()) {
      _log.info("All shards invoked for " + methodInvocation.toString());
    }
    for (    String shardName : ShardUtil.getAvailableShardNames()) {
      ShardDataSourceTargetSource shardDataSourceTargetSource=_shardAdvice.getShardDataSourceTargetSource();
      shardDataSourceTargetSource.setDataSource(shardName);
      ShardSessionFactoryTargetSource shardSessionFactoryTargetSource=_shardAdvice.getShardSessionFactoryTargetSource();
      shardSessionFactoryTargetSource.setSessionFactory(shardName);
      _shardAdvice.pushCompanyService(shardName);
      isCompanyPushed=true;
      Object value=methodInvocation.proceed();
      _shardAdvice.popCompanyService();
      isCompanyPushed=false;
      if (shardName.equals(ShardUtil.getDefaultShardName())) {
        returnValue=value;
      }
    }
  }
  finally {
    _shardAdvice.setGlobalCall(null);
    if (isCompanyPushed) {
      _shardAdvice.popCompanyService();
    }
  }
  return returnValue;
}
