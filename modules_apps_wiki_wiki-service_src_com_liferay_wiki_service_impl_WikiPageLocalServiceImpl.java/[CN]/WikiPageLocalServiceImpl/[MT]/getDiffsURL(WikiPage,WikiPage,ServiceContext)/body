{
  if (previousVersionPage == null) {
    return StringPool.BLANK;
  }
  HttpServletRequest request=serviceContext.getRequest();
  if (request == null) {
    return StringPool.BLANK;
  }
  PortletURL portletURL=null;
  long plid=serviceContext.getPlid();
  if (plid == LayoutConstants.DEFAULT_PLID) {
    portletURL=PortalUtil.getControlPanelPortletURL(request,WikiPortletKeys.WIKI_ADMIN,0,PortletRequest.RENDER_PHASE);
    portletURL.setParameter("struts_action","/wiki_admin/compare_versions");
  }
 else {
    portletURL=PortletURLFactoryUtil.create(request,WikiPortletKeys.WIKI,plid,PortletRequest.RENDER_PHASE);
    portletURL.setParameter("struts_action","/wiki/compare_versions");
  }
  portletURL.setParameter("nodeId",String.valueOf(page.getNodeId()));
  portletURL.setParameter("title",page.getTitle());
  portletURL.setParameter("sourceVersion",String.valueOf(previousVersionPage.getVersion()));
  portletURL.setParameter("targetVersion",String.valueOf(page.getVersion()));
  portletURL.setParameter("type","html");
  return portletURL.toString();
}
