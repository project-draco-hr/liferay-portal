{
  CacheManager cacheManager=new CacheManager();
  String cacheName1="testCache1";
  cacheManager.addCache(cacheName1);
  Cache cache1=cacheManager.getCache(cacheName1);
  EhcachePortalCache<Serializable,Serializable> ehcachePortalCache=new EhcachePortalCache<Serializable,Serializable>(cache1);
  CacheListener<Serializable,Serializable> cacheListener=new DummyCacheListener();
  ehcachePortalCache.registerCacheListener(cacheListener);
  RegisteredEventListeners registeredEventListeners=cache1.getCacheEventNotificationService();
  Set<CacheEventListener> cacheEventListeners=registeredEventListeners.getCacheEventListeners();
  Assert.assertEquals(1,cacheEventListeners.size());
  Iterator<CacheEventListener> iterator=cacheEventListeners.iterator();
  CacheEventListener cacheEventListener=iterator.next();
  Assert.assertTrue(cacheEventListener instanceof PortalCacheCacheEventListener);
  PortalCacheCacheEventListener<Serializable,Serializable> portalCacheCacheEventListener=(PortalCacheCacheEventListener<Serializable,Serializable>)cacheEventListener;
  Assert.assertSame(cacheListener,portalCacheCacheEventListener.getCacheListener());
  Assert.assertSame(ehcachePortalCache,portalCacheCacheEventListener.getPortalCache());
  String cacheName2="testCache2";
  cacheManager.addCache(cacheName2);
  Cache cache2=cacheManager.getCache(cacheName2);
  ehcachePortalCache.setEhcache(cache2);
  registeredEventListeners=cache2.getCacheEventNotificationService();
  Assert.assertEquals(1,cacheEventListeners.size());
  iterator=cacheEventListeners.iterator();
  cacheEventListener=iterator.next();
  Assert.assertTrue(cacheEventListener instanceof PortalCacheCacheEventListener);
  portalCacheCacheEventListener=(PortalCacheCacheEventListener<Serializable,Serializable>)cacheEventListener;
  Assert.assertSame(cacheListener,portalCacheCacheEventListener.getCacheListener());
  Assert.assertSame(ehcachePortalCache,portalCacheCacheEventListener.getPortalCache());
}
