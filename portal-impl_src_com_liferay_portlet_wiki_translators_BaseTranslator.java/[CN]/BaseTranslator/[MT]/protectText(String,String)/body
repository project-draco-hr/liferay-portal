{
  Matcher matcher=Pattern.compile(markupRegex,Pattern.MULTILINE | Pattern.DOTALL).matcher(content);
  StringBuffer result=new StringBuffer();
  while (matcher.find()) {
    String protectedText=matcher.group();
    String hash=_digester.digest(protectedText);
    matcher.appendReplacement(result,"$1" + hash + "$3");
    _protectionMap.put(hash,matcher.group(2));
  }
  matcher.appendTail(result);
  return result.toString();
}
