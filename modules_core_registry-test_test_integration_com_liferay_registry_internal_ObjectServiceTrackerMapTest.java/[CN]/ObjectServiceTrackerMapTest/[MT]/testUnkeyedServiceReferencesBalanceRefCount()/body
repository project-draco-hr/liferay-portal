{
  Registry registry=RegistryUtil.getRegistry();
  RegistryWrapper registryWrapper=new RegistryWrapper(registry);
  try (ServiceTrackerMap<TrackedOne,TrackedOne> serviceTrackerMap=ServiceTrackerCollections.singleValueMap(TrackedOne.class,null,new ServiceReferenceMapper<TrackedOne,TrackedOne>(){
    @Override public void map(    ServiceReference<TrackedOne> serviceReference,    Emitter<TrackedOne> emitter){
    }
  }
)){
    serviceTrackerMap.open();
    ServiceRegistration<TrackedOne> serviceRegistration1=registerService(new TrackedOne());
    ServiceRegistration<TrackedOne> serviceRegistration2=registerService(new TrackedOne());
    Map<ServiceReference<?>,AtomicInteger> serviceReferenceCountsMap=registryWrapper.getServiceReferenceCountsMap();
    Collection<AtomicInteger> serviceReferenceCounts=serviceReferenceCountsMap.values();
    Assert.assertEquals(0,serviceReferenceCounts.size());
    serviceRegistration1.unregister();
    serviceRegistration2.unregister();
    Assert.assertEquals(0,serviceReferenceCounts.size());
  }
 }
