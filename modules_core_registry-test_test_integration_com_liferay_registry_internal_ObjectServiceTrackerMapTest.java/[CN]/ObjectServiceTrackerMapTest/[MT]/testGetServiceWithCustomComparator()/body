{
  ServiceTrackerMap<String,TrackedOne> serviceTrackerMap=ServiceTrackerMapFactory.createObjectServiceTrackerMap(TrackedOne.class,"(target=*)",new ServiceTrackerMapFactory.PropertyServiceReferenceMapper<String>("target"),new Comparator<ServiceReference<TrackedOne>>(){
    @Override public int compare(    ServiceReference<TrackedOne> o1,    ServiceReference<TrackedOne> o2){
      return -1;
    }
  }
);
  serviceTrackerMap.open();
  TrackedOne trackedOne1=new TrackedOne();
  ServiceRegistration<TrackedOne> sr1=registerService(trackedOne1);
  TrackedOne trackedOne2=new TrackedOne();
  ServiceRegistration<TrackedOne> sr2=registerService(trackedOne2);
  Assert.assertEquals(trackedOne2,serviceTrackerMap.getService("aTarget"));
  sr1.unregister();
  sr2.unregister();
  registerService(trackedOne2);
  registerService(trackedOne1);
  Assert.assertEquals(trackedOne1,serviceTrackerMap.getService("aTarget"));
}
