{
  ServiceTrackerMap<String,TrackedOne> serviceTrackerMap=ServiceTrackerMapFactory.createObjectServiceTrackerMap(TrackedOne.class,"(target=*)",new ServiceTrackerMapFactory.PropertyServiceReferenceMapper<String>("target"),new Comparator<ServiceReference<TrackedOne>>(){
    @Override public int compare(    ServiceReference<TrackedOne> o1,    ServiceReference<TrackedOne> o2){
      return -1;
    }
  }
);
  serviceTrackerMap.open();
  TrackedOne TrackedOne1=new TrackedOne();
  ServiceRegistration<TrackedOne> sr1=registerService(TrackedOne1);
  TrackedOne TrackedOne2=new TrackedOne();
  ServiceRegistration<TrackedOne> sr2=registerService(TrackedOne2);
  Assert.assertEquals(TrackedOne2,serviceTrackerMap.getService("aTarget"));
  sr1.unregister();
  sr2.unregister();
  registerService(TrackedOne2);
  registerService(TrackedOne1);
  Assert.assertEquals(TrackedOne1,serviceTrackerMap.getService("aTarget"));
}
