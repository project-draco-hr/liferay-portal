{
  registerURLStreamHandlerService(bundleContext);
  registerArtifactUrlTransformer(bundleContext);
  final Set<String> requiredForStartupLocations=getRequiredForStartupLocations(Paths.get(PropsValues.LIFERAY_HOME,"osgi/war"));
  if (requiredForStartupLocations.isEmpty()) {
    return;
  }
  final CountDownLatch countDownLatch=new CountDownLatch(1);
  BundleTracker<Void> bundleTracker=new BundleTracker<Void>(bundleContext,Bundle.ACTIVE,null){
    @Override public Void addingBundle(    Bundle bundle,    BundleEvent bundleEvent){
      String location=StringUtil.toLowerCase(bundle.getLocation());
      if (_log.isDebugEnabled()) {
        _log.debug("Activated bundle " + location);
      }
      if (requiredForStartupLocations.remove(location)) {
        if (_log.isDebugEnabled()) {
          _log.debug("Bundle " + location + " is required for startup");
        }
        if (requiredForStartupLocations.isEmpty()) {
          countDownLatch.countDown();
        }
      }
      return null;
    }
  }
;
  if (_log.isDebugEnabled()) {
    _log.debug("Bundles required for startup: " + requiredForStartupLocations);
  }
  bundleTracker.open();
  countDownLatch.await();
  bundleTracker.close();
}
