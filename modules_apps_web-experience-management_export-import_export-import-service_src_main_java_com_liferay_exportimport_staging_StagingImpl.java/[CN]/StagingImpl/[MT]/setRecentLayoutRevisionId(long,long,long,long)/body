{
  long layoutBranchId=0;
  try {
    LayoutRevision layoutRevision=_layoutRevisionLocalService.getLayoutRevision(layoutRevisionId);
    layoutBranchId=layoutRevision.getLayoutBranchId();
    LayoutRevision lastLayoutRevision=_layoutRevisionLocalService.getLayoutRevision(layoutSetBranchId,layoutBranchId,plid);
    if (lastLayoutRevision.getLayoutRevisionId() == layoutRevisionId) {
      deleteRecentLayoutRevisionId(userId,layoutSetBranchId,plid);
    }
 else {
      RecentLayoutRevision recentLayoutRevision=_recentLayoutRevisionLocalService.fetchRecentLayoutRevision(userId,layoutSetBranchId,plid);
      if (recentLayoutRevision == null) {
        recentLayoutRevision=_recentLayoutRevisionLocalService.addRecentLayoutRevision(userId,layoutRevisionId,layoutSetBranchId,plid);
      }
      recentLayoutRevision.setLayoutRevisionId(layoutRevisionId);
      _recentLayoutRevisionLocalService.updateRecentLayoutRevision(recentLayoutRevision);
    }
  }
 catch (  PortalException pe) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unable to set recent layout revision ID with layout set " + "branch " + layoutSetBranchId + " and PLID "+ plid+ " and layout branch "+ layoutBranchId,pe);
    }
  }
  setRecentLayoutBranchId(userId,layoutSetBranchId,plid,layoutBranchId);
}
