{
  List<Portlet> portlets=new ArrayList<Portlet>();
  Set<String> rootPortletIds=new HashSet<String>();
  for (  Layout layout : layouts) {
    if (!layout.isTypePortlet()) {
      continue;
    }
    LayoutTypePortlet layoutTypePortlet=(LayoutTypePortlet)layout.getLayoutType();
    for (    String portletId : layoutTypePortlet.getPortletIds()) {
      Portlet portlet=PortletLocalServiceUtil.getPortletById(layout.getCompanyId(),portletId);
      addPortlet(portlets,rootPortletIds,portlet,layout.getGroupId(),layout.getPlid(),layout.getPrivateLayout());
    }
  }
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  List<Portlet> dataSiteLevelPortlets=LayoutExporter.getDataSiteLevelPortlets(group.getCompanyId());
  for (  Portlet dataSiteLevelPortlet : dataSiteLevelPortlets) {
    addPortlet(portlets,rootPortletIds,dataSiteLevelPortlet,groupId,0,false);
  }
  return portlets;
}
