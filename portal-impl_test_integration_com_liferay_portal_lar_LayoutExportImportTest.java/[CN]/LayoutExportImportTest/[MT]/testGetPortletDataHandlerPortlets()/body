{
  LayoutTestUtil.addPortletToLayout(layout,PortletKeys.BOOKMARKS);
  LayoutTestUtil.addPortletToLayout(layout,PortletKeys.LOGIN);
  ServiceContext serviceContext=ServiceTestUtil.getServiceContext(group.getGroupId());
  serviceContext.setAttribute("staged-portlet_28",true);
  ServiceContextThreadLocal.pushServiceContext(serviceContext);
  StagingUtil.enableLocalStaging(TestPropsValues.getUserId(),group,group,false,false,serviceContext);
  Group stagingGroup=group.getStagingGroup();
  Layout stagingLayout=LayoutLocalServiceUtil.getLayoutByUuidAndGroupId(layout.getUuid(),stagingGroup.getGroupId(),layout.isPrivateLayout());
  List<Layout> layouts=new ArrayList<Layout>();
  layouts.add(stagingLayout);
  List<Portlet> portlets=LayoutExporter.getPortletDataHandlerPortlets(layouts);
  Assert.assertEquals(2,portlets.size());
  for (  Portlet portlet : portlets) {
    String portletId=portlet.getPortletId();
    if (!portletId.equals(PortletKeys.BOOKMARKS) && !portletId.equals(PortletKeys.LOGIN)) {
      Assert.fail();
    }
  }
  ServiceContextThreadLocal.popServiceContext();
}
