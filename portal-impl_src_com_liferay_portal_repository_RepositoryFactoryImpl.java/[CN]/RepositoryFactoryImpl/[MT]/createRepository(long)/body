{
  long classNameId=getRepositoryClassNameId(repositoryId);
  RepositoryClassDefinition repositoryClassDefinition=getRepositoryClassDefinition(classNameId);
  RepositoryFactory repositoryFactory=repositoryClassDefinition.getRepositoryFactory();
  Repository repository=repositoryFactory.createRepository(repositoryId);
  CapabilityRepository capabilityRepository=new CapabilityRepository(repository,repositoryClassDefinition.getRepositoryEventTrigger());
  RepositoryInstanceDefinition repositoryInstanceDefinition=repositoryClassDefinition.createRepositoryInstanceDefinition(capabilityRepository);
  _setupCommonCapabilities(capabilityRepository,repositoryClassDefinition,repositoryInstanceDefinition);
  _setupCapabilityRepositoryCapabilities(capabilityRepository);
  return capabilityRepository;
}
