{
  if ((s == null) || (begin == null) || (valueMapper == null)|| (valueMapper.size() == 0)) {
    return s;
  }
  char[] charArray=s.toCharArray();
  StringBundler sb=new StringBundler();
  int pos=0;
  while (true) {
    int x=s.indexOf(begin,pos);
    int y=_getEndPos(charArray,x + begin.length());
    if ((x == -1) || (y == -1)) {
      sb.append(s.substring(pos,s.length()));
      break;
    }
 else {
      sb.append(s.substring(pos,x + begin.length()));
      String oldString=s.substring(x + begin.length(),y);
      if (Validator.isNotNull(oldString)) {
        Long oldValue=new Long(GetterUtil.getLong(oldString));
        Long newValue=null;
        try {
          newValue=(Long)valueMapper.getNewValue(oldValue);
        }
 catch (        StagnantRowException sre) {
          if (_log.isWarnEnabled()) {
            _log.warn(sre);
          }
        }
        if (newValue == null) {
          newValue=oldValue;
        }
        sb.append(newValue);
      }
      pos=y;
    }
  }
  return sb.toString();
}
