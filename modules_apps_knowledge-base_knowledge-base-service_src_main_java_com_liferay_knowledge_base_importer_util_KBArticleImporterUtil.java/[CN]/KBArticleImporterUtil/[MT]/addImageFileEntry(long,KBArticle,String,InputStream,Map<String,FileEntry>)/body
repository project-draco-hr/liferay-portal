{
  FileEntry fileEntry=fileEntriesMap.get(imageFileName);
  if (fileEntry != null) {
    return fileEntry;
  }
  String mimeType=MimeTypesUtil.getContentType(imageFileName);
  try {
    PortletFileRepositoryUtil.getPortletFileEntry(kbArticle.getGroupId(),kbArticle.getAttachmentsFolderId(),imageFileName);
    PortletFileRepositoryUtil.deletePortletFileEntry(kbArticle.getGroupId(),kbArticle.getAttachmentsFolderId(),imageFileName);
  }
 catch (  NoSuchFileEntryException nsfee) {
  }
  fileEntry=PortletFileRepositoryUtil.addPortletFileEntry(kbArticle.getGroupId(),userId,KBArticle.class.getName(),kbArticle.getClassPK(),PortletKeys.KNOWLEDGE_BASE_ARTICLE,kbArticle.getAttachmentsFolderId(),inputStream,imageFileName,mimeType,false);
  fileEntriesMap.put(imageFileName,fileEntry);
  return fileEntry;
}
