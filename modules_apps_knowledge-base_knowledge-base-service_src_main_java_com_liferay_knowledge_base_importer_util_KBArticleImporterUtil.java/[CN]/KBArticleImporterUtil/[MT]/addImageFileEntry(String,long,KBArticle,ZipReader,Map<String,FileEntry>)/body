{
  KBGroupServiceConfiguration kbGroupServiceConfiguration=ConfigurationProviderUtil.getGroupConfiguration(KBGroupServiceConfiguration.class,kbArticle.getGroupId());
  try {
    validateImageFileExtension(imageFileName,kbGroupServiceConfiguration.markdownImporterImageFileExtensions());
  }
 catch (  KBArticleImportException kbaie) {
    if (_log.isWarnEnabled()) {
      _log.warn("Unsupported image file suffix used in ZIP file " + imageFileName);
    }
  }
  try {
    String zipReaderFileName=getZipReaderFileName(kbGroupServiceConfiguration.markdownImporterImageFolder(),imageFileName);
    return addImageFileEntry(userId,kbArticle,imageFileName,zipReader.getEntryAsInputStream(zipReaderFileName),fileEntriesMap);
  }
 catch (  Exception e) {
    StringBuilder sb=new StringBuilder(4);
    sb.append("Unable to import image file ");
    sb.append(imageFileName);
    sb.append(": ");
    sb.append(e.getLocalizedMessage());
    throw new KBArticleImportException(sb.toString());
  }
}
