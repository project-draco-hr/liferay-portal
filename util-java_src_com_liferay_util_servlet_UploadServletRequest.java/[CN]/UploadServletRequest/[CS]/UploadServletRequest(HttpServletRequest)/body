{
  super(req);
  _params=new LinkedHashMap();
  try {
    ServletFileUpload servletFileUpload=new LiferayFileUpload(new LiferayFileItemFactory(DEFAULT_TEMP_DIR),req);
    servletFileUpload.setSizeMax(DEFAULT_SIZE_MAX);
    _lsr=new LiferayServletRequest(req);
    List list=servletFileUpload.parseRequest(_lsr);
    for (int i=0; i < list.size(); i++) {
      LiferayFileItem fileItem=(LiferayFileItem)list.get(i);
      if (fileItem.isFormField()) {
        fileItem.setString(req.getCharacterEncoding());
      }
      LiferayFileItem[] fileItems=(LiferayFileItem[])_params.get(fileItem.getFieldName());
      if (fileItems == null) {
        fileItems=new LiferayFileItem[]{fileItem};
      }
 else {
        LiferayFileItem[] newFileItems=new LiferayFileItem[fileItems.length + 1];
        System.arraycopy(fileItems,0,newFileItems,0,fileItems.length);
        newFileItems[newFileItems.length - 1]=fileItem;
        fileItems=newFileItems;
      }
      _params.put(fileItem.getFieldName(),fileItems);
    }
  }
 catch (  FileUploadException fue) {
    fue.printStackTrace();
  }
}
