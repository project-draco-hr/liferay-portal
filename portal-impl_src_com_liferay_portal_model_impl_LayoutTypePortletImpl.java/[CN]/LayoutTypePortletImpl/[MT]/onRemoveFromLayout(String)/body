{
  Portlet portlet=PortletLocalServiceUtil.getPortletById(getCompanyId(),portletId);
  if (portlet == null) {
    return;
  }
  if (portlet.getRootPortletId().equals(PortletKeys.NESTED_PORTLETS)) {
    String portletNamespace=PortalUtil.getPortletNamespace(portletId);
    UnicodeProperties typeSettingsProperties=getTypeSettingsProperties();
    for (    Map.Entry<String,String> entry : typeSettingsProperties.entrySet()) {
      String key=entry.getKey();
      if (key.startsWith(portletNamespace)) {
        String portletIds=entry.getValue();
        String[] portletIdsArray=StringUtil.split(portletIds);
        for (        String curPortletId : portletIdsArray) {
          onRemoveFromLayout(curPortletId);
        }
      }
    }
    removeNestedColumns(portletNamespace);
  }
  if (_enablePortletLayoutListener) {
    PortletLayoutListener portletLayoutListener=portlet.getPortletLayoutListenerInstance();
    if (portletLayoutListener != null) {
      portletLayoutListener.onRemoveFromLayout(portletId,getPlid());
    }
  }
  deletePortletSetup(portletId);
}
