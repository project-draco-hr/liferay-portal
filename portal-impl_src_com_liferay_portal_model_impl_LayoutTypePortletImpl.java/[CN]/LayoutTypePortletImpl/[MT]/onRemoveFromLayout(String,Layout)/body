{
  if (!_enablePortletLayoutListener) {
    deletePortletPreference(layout,portletId);
    return;
  }
  Portlet portlet=PortletLocalServiceUtil.getPortletById(layout.getCompanyId(),portletId);
  if (portlet != null) {
    PortletLayoutListener portletLayoutListener=portlet.getPortletLayoutListener();
    if ((portletLayoutListener != null)) {
      portletLayoutListener.onRemoveFromLayout(portletId,layout.getPlid());
    }
    if (portlet.getRootPortletId().equals(PortletKeys.NESTED_LAYOUTS)) {
      Properties props=getTypeSettingsProperties();
      Iterator itr=props.keySet().iterator();
      while (itr.hasNext()) {
        String key=(String)itr.next();
        if (key.startsWith(portlet.getPortletId())) {
          String portletIds=props.getProperty(key);
          String[] portletIdsArray=StringUtil.split(portletIds);
          for (int i=0; i < portletIdsArray.length; i++) {
            onRemoveFromLayout(portletIdsArray[i],layout);
          }
        }
      }
    }
    deletePortletPreference(layout,portletId);
  }
}
