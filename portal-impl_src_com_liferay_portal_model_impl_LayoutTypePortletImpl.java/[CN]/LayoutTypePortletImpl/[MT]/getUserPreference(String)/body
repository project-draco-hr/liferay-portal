{
  String value=StringPool.BLANK;
  if (!hasUserPreferences()) {
    return value;
  }
  value=_portalPreferences.getValue(CustomizedPages.namespacePlid(getPlid()),key,StringPool.NULL);
  if (!value.equals(StringPool.NULL)) {
    return value;
  }
  if (hasLayoutSetPrototypeLayout()) {
    value=getLayoutSetPrototypeLayoutProperty(key);
  }
 else {
    value=getTypeSettingsProperty(key);
  }
  if (Validator.isNull(value)) {
    return value;
  }
  String[] portletIds=StringUtil.split(value);
  String[] newPortletIds=new String[portletIds.length];
  long userId=_portalPreferences.getUserId();
  for (int i=0; i < portletIds.length; i++) {
    if (PortletConstants.hasInstanceId(portletIds[i])) {
      newPortletIds[i]=PortletConstants.assemblePortletId(portletIds[i],userId,generateInstanceId());
      copyPreferences(portletIds[i],newPortletIds[i],userId);
    }
 else {
      newPortletIds[i]=portletIds[i];
    }
  }
  value=StringUtil.merge(newPortletIds);
  setUserPreference(key,value);
  return value;
}
