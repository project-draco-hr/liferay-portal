{
  String value=StringPool.BLANK;
  if (!hasUserPreferences()) {
    return value;
  }
  value=_portalPreferences.getValue(CustomizedPages.namespacePlid(getPlid()),key,StringPool.NULL);
  if (!value.equals(StringPool.NULL)) {
    return value;
  }
  value=getTypeSettingsProperty(key);
  if (Validator.isNull(value)) {
    return value;
  }
  String[] portletIds=StringUtil.split(value);
  List<String> newPortletIds=new ArrayList<String>();
  PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
  for (int i=0; i < portletIds.length; i++) {
    try {
      String rootPortletId=PortletConstants.getRootPortletId(portletIds[i]);
      if (!PortletPermissionUtil.contains(permissionChecker,rootPortletId,ActionKeys.ADD_TO_PAGE)) {
        continue;
      }
    }
 catch (    Exception e) {
      _log.error(e,e);
    }
    String newPortletId=null;
    if (PortletConstants.hasInstanceId(portletIds[i])) {
      newPortletId=PortletConstants.assemblePortletId(portletIds[i],_portalPreferences.getUserId(),generateInstanceId());
      copyPreferences(_portalPreferences.getUserId(),portletIds[i],newPortletId);
    }
 else {
      newPortletId=portletIds[i];
    }
    newPortletIds.add(newPortletId);
  }
  value=StringUtil.merge(newPortletIds);
  setUserPreference(key,value);
  return value;
}
