{
  if (checkPermission && !PluginSettingLocalServiceUtil.hasPermission(userId,newLayoutTemplateId,Plugin.TYPE_LAYOUT_TEMPLATE)) {
    return;
  }
  String oldLayoutTemplateId=getLayoutTemplateId();
  if (Validator.isNull(oldLayoutTemplateId)) {
    oldLayoutTemplateId=PropsValues.DEFAULT_LAYOUT_TEMPLATE_ID;
  }
  String themeId=getThemeId();
  LayoutTemplate oldLayoutTemplate=LayoutTemplateLocalServiceUtil.getLayoutTemplate(oldLayoutTemplateId,false,themeId);
  if (oldLayoutTemplate == null) {
    if (_log.isWarnEnabled()) {
      StringBundler sb=new StringBundler(5);
      sb.append("Layout template ");
      sb.append(newLayoutTemplateId);
      sb.append(" cannot be set because current template ");
      sb.append(oldLayoutTemplateId);
      sb.append(" does not exist");
      _log.warn(sb.toString());
    }
    return;
  }
  LayoutTemplate newLayoutTemplate=LayoutTemplateLocalServiceUtil.getLayoutTemplate(newLayoutTemplateId,false,themeId);
  if (newLayoutTemplate == null) {
    if (_log.isWarnEnabled()) {
      _log.warn("Layout template " + newLayoutTemplateId + " cannot be set because it does not exist");
    }
    return;
  }
  setTypeSettingsProperty(LayoutTypePortletConstants.LAYOUT_TEMPLATE_ID,newLayoutTemplateId);
  List<String> oldColumns=oldLayoutTemplate.getColumns();
  List<String> newColumns=newLayoutTemplate.getColumns();
  reorganizePortlets(newColumns,oldColumns);
}
