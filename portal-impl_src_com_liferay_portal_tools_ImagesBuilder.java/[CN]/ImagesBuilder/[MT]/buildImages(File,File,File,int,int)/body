{
  DirectoryScanner ds=new DirectoryScanner();
  ds.setBasedir(inputDir);
  ds.setIncludes(new String[]{"**\\*.png"});
  ds.scan();
  List<RenderedImage> renderedImages=new ArrayList<RenderedImage>();
  Properties properties=new SortedProperties();
  String[] files=ds.getIncludedFiles();
  float x=0;
  float y=0;
  for (int i=0; i < files.length; i++) {
    String file=files[i];
    RenderedOp renderedOp=FileLoadDescriptor.create(inputDir + "/" + file,null,null,null);
    RenderedImage renderedImage=convert(renderedOp);
    int height=renderedImage.getHeight();
    int width=renderedImage.getWidth();
    if ((height <= maxHeight) && (width <= maxWidth)) {
      renderedImage=TranslateDescriptor.create(renderedImage,x,y,null,null);
      renderedImages.add(renderedImage);
      String key=StringUtil.replace(file,StringPool.BACK_SLASH,StringPool.SLASH);
      String value=(int)y + "," + height+ ","+ width;
      properties.setProperty(key,value);
      y+=renderedOp.getHeight();
    }
  }
  RenderedOp renderedOp=MosaicDescriptor.create((RenderedImage[])renderedImages.toArray(new RenderedImage[renderedImages.size()]),MosaicDescriptor.MOSAIC_TYPE_OVERLAY,null,null,null,null,null);
  ImageIO.write(renderedOp,"png",outputFile);
  _fileUtil.write(propertiesFile,PropertiesUtil.toString(properties));
}
