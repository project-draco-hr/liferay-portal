{
  MBMessageDisplay messageDisplay=MBMessageLocalServiceUtil.getDiscussionMessageDisplay(userId,groupId,className,classPK,WorkflowConstants.STATUS_ANY,new MessageThreadComparator());
  MBTreeWalker treeWalker=messageDisplay.getTreeWalker();
  List<MBMessage> messages=treeWalker.getMessages();
  List<RatingsEntry> ratingsEntries=Collections.emptyList();
  List<RatingsStats> ratingsStats=Collections.emptyList();
  if (messages.size() > 1) {
    List<Long> classPKs=new ArrayList<>();
    for (    MBMessage curMessage : messages) {
      if (!curMessage.isRoot()) {
        classPKs.add(curMessage.getMessageId());
      }
    }
    ratingsEntries=RatingsEntryLocalServiceUtil.getEntries(userId,CommentConstants.getDiscussionClassName(),classPKs);
    ratingsStats=RatingsStatsLocalServiceUtil.getStats(CommentConstants.getDiscussionClassName(),classPKs);
  }
  ThemeDisplay themeDisplay=serviceContext.getThemeDisplay();
  Comment rootComment=new MBCommentImpl(treeWalker.getRoot(),treeWalker,ratingsEntries,ratingsStats,themeDisplay.getPathThemeImages());
  return new MBDiscussionImpl(rootComment,messageDisplay.isDiscussionMaxComments());
}
