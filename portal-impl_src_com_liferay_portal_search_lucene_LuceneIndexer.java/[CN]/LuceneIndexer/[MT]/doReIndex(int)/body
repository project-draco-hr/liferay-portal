{
  if (SearchEngineUtil.isIndexReadOnly()) {
    return;
  }
  if (_log.isInfoEnabled()) {
    _log.info("Reindexing Lucene started");
  }
  if (delay < 0) {
    delay=0;
  }
  try {
    if (delay > 0) {
      Thread.sleep(Time.SECOND * delay);
    }
  }
 catch (  InterruptedException ie) {
  }
  StopWatch stopWatch1=null;
  if (_log.isInfoEnabled()) {
    stopWatch1=new StopWatch();
    stopWatch1.start();
  }
  try {
    LuceneHelperUtil.delete(_companyId);
    List<Portlet> portlets=PortletLocalServiceUtil.getPortlets(_companyId);
    portlets=ListUtil.sort(portlets,new PortletLuceneComparator());
    for (    Portlet portlet : portlets) {
      if (!portlet.isActive()) {
        continue;
      }
      List<Indexer> indexers=portlet.getIndexerInstances();
      if (indexers == null) {
        continue;
      }
      for (      Indexer indexer : indexers) {
        StopWatch stopWatch2=null;
        if (_log.isInfoEnabled()) {
          stopWatch2=new StopWatch();
          stopWatch2.start();
        }
        if (_log.isInfoEnabled()) {
          _log.info("Reindexing with " + indexer.getClass().getName() + " started");
        }
        indexer.reindex(new String[]{String.valueOf(_companyId)});
        if (_log.isInfoEnabled()) {
          _log.info("Reindexing with " + indexer.getClass().getName() + " completed in "+ (stopWatch2.getTime() / Time.SECOND)+ " seconds");
        }
      }
    }
    if (_log.isInfoEnabled()) {
      _log.info("Reindexing Lucene completed in " + (stopWatch1.getTime() / Time.SECOND) + " seconds");
    }
  }
 catch (  Exception e) {
    _log.error("Error encountered while reindexing",e);
    if (_log.isInfoEnabled()) {
      _log.info("Reindexing Lucene failed");
    }
  }
  _finished=true;
}
