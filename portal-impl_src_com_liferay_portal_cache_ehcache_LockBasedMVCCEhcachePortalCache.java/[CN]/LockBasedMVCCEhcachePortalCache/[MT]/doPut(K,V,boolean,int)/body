{
  if (key == null) {
    throw new NullPointerException("Key is null");
  }
  if (value == null) {
    throw new NullPointerException("Value is null");
  }
  if ((timeToLive != DEFAULT_TIME_TO_LIVE) && (timeToLive < 0)) {
    throw new IllegalArgumentException("Time to live is negative");
  }
  Element newElement=new Element(key,value);
  if (timeToLive >= 0) {
    newElement.setTimeToLive(timeToLive);
  }
  Ehcache ehcache=getEhcache();
  ehcache.acquireWriteLockOnKey(key);
  try {
    Element oldElement=ehcache.get(key);
    if (oldElement == null) {
      ehcache.put(newElement,quiet);
      return;
    }
    V oldValue=(V)oldElement.getObjectValue();
    if (value.getMvccVersion() <= oldValue.getMvccVersion()) {
      return;
    }
    ehcache.put(newElement,quiet);
  }
  finally {
    ehcache.releaseWriteLockOnKey(key);
  }
}
