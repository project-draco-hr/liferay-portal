{
  if (inputStream == null) {
    return null;
  }
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddGroupPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  Repository repository=addPortletRepository(groupId,portletId,serviceContext);
  serviceContext.setAttribute("className",className);
  serviceContext.setAttribute("classPK",String.valueOf(classPK));
  boolean dlAppHelperEnabled=DLAppHelperThreadLocal.isEnabled();
  File file=null;
  try {
    DLAppHelperThreadLocal.setEnabled(false);
    file=FileUtil.createTempFile(inputStream);
    return DLAppLocalServiceUtil.addFileEntry(userId,repository.getRepositoryId(),folderId,fileName,mimeType,fileName,StringPool.BLANK,StringPool.BLANK,file,serviceContext);
  }
 catch (  IOException ioe) {
    throw new SystemException("Unable to write temporary file " + file.getAbsolutePath(),ioe);
  }
 finally {
    FileUtil.delete(file);
    DLAppHelperThreadLocal.setEnabled(dlAppHelperEnabled);
  }
}
