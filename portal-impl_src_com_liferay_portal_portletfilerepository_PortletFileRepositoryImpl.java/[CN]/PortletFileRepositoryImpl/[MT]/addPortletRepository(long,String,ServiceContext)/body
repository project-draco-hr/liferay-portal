{
  Repository repository=RepositoryLocalServiceUtil.fetchRepository(groupId,portletId);
  if (repository != null) {
    return repository;
  }
  Group group=GroupLocalServiceUtil.getGroup(groupId);
  User user=UserLocalServiceUtil.getDefaultUser(group.getCompanyId());
  long classNameId=PortalUtil.getClassNameId(PortletRepository.class.getName());
  UnicodeProperties typeSettingsProperties=new UnicodeProperties();
  boolean dlAppHelperEnabled=DLAppHelperThreadLocal.isEnabled();
  try {
    DLAppHelperThreadLocal.setEnabled(false);
    return RepositoryLocalServiceUtil.addRepository(user.getUserId(),groupId,classNameId,DLFolderConstants.DEFAULT_PARENT_FOLDER_ID,portletId,StringPool.BLANK,portletId,typeSettingsProperties,true,serviceContext);
  }
  finally {
    DLAppHelperThreadLocal.setEnabled(dlAppHelperEnabled);
  }
}
