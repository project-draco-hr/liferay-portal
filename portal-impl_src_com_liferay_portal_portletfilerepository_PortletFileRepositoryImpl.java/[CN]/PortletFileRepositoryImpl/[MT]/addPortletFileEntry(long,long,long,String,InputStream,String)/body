{
  FileEntry fileEntry=null;
  if (inputStream == null) {
    return fileEntry;
  }
  long size=0;
  try {
    byte[] bytes=FileUtil.getBytes(inputStream,-1,false);
    size=bytes.length;
  }
 catch (  IOException ioe) {
    return fileEntry;
  }
  ServiceContext serviceContext=new ServiceContext();
  serviceContext.setAddGroupPermissions(true);
  serviceContext.setAddGuestPermissions(true);
  long repositoryId=getPortletRepository(groupId,portletId,serviceContext);
  String contentType=MimeTypesUtil.getContentType(inputStream,fileName);
  boolean dlAppHelperEnabled=DLAppHelperThreadLocal.isEnabled();
  try {
    DLAppHelperThreadLocal.setEnabled(false);
    fileEntry=DLAppLocalServiceUtil.addFileEntry(userId,repositoryId,folderId,fileName,contentType,fileName,StringPool.BLANK,StringPool.BLANK,inputStream,size,serviceContext);
  }
  finally {
    DLAppHelperThreadLocal.setEnabled(dlAppHelperEnabled);
  }
  return fileEntry;
}
