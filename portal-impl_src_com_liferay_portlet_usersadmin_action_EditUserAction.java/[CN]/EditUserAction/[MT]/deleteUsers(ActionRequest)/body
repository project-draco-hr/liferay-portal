{
  String cmd=ParamUtil.getString(actionRequest,Constants.CMD);
  long[] deleteUserIds=StringUtil.split(ParamUtil.getString(actionRequest,"deleteUserIds"),0L);
  for (  long deleteUserId : deleteUserIds) {
    if (cmd.equals(Constants.DEACTIVATE) || cmd.equals(Constants.RESTORE)) {
      int status=WorkflowConstants.STATUS_APPROVED;
      if (cmd.equals(Constants.DEACTIVATE)) {
        status=WorkflowConstants.STATUS_INACTIVE;
      }
      if (cmd.equals(Constants.RESTORE)) {
        Company company=PortalUtil.getCompany(actionRequest);
        long companyId=company.getCompanyId();
        if ((company.getMaxUsers() > 0) && (company.getMaxUsers() <= UserLocalServiceUtil.searchCount(companyId,null,WorkflowConstants.STATUS_APPROVED,null))) {
          throw new CompanyMaxUsersException();
        }
      }
      UserServiceUtil.updateStatus(deleteUserId,status);
    }
 else {
      UserServiceUtil.deleteUser(deleteUserId);
    }
  }
}
