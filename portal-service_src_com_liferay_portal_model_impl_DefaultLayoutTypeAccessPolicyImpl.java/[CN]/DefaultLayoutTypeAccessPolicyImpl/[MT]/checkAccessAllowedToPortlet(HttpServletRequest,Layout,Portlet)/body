{
  if (layout.isTypeControlPanel()) {
    isAccessAllowedToControlPanelPortlet(request,layout,portlet);
    return;
  }
  if (isAccessAllowedToLayoutPortlet(request,layout,portlet)) {
    PortalUtil.addPortletDefaultResource(request,portlet);
    if (hasAccessPermission(request,layout,portlet)) {
      return;
    }
  }
  throw new PrincipalException("User does not have permission to access portlet " + portlet.getPortletId());
}
