{
  ClassLoader classLoader=ClassLoaderUtil.getPortalClassLoader();
  Store store=(Store)InstanceFactory.newInstance(classLoader,PropsValues.DL_STORE_IMPL);
  if (!(store instanceof DBStore)) {
    return store;
  }
  DB db=DBFactoryUtil.getDB();
  String dbType=db.getType();
  if (dbType.equals(DB.TYPE_POSTGRESQL)) {
    MethodInterceptor transactionAdviceMethodInterceptor=(MethodInterceptor)PortalBeanLocatorUtil.locate("transactionAdvice");
    MethodInterceptor tempFileMethodInterceptor=new TempFileMethodInterceptor();
    List<MethodInterceptor> methodInterceptors=Arrays.asList(transactionAdviceMethodInterceptor,tempFileMethodInterceptor);
    Store proxyStore=(Store)ProxyUtil.newProxyInstance(classLoader,new Class<?>[]{Store.class},new MethodInterceptorInvocationHandler(store,methodInterceptors));
    ((DBStore)store).setStoreProxy(proxyStore);
    store=proxyStore;
  }
  return store;
}
