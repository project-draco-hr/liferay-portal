{
  if (results.size() == 0 || (beginPos - margin) < 0) {
    return margin;
  }
  DiffResult lastDiff=(DiffResult)results.get(results.size() - 1);
  if (lastDiff.getChangedLines().size() == 0) {
    return margin;
  }
  int lastChangedLine=(lastDiff.getLineNumber() - 1) + lastDiff.getChangedLines().size();
  int currentChangedLine=beginPos - margin;
  if ((lastDiff.getChangedLines().size() == 1) && (lastDiff.getChangedLines().get(0).equals(CONTEXT_LINE))) {
    currentChangedLine=currentChangedLine + 1;
  }
  if (currentChangedLine < lastChangedLine) {
    return margin + currentChangedLine - lastChangedLine;
  }
  return margin;
}
