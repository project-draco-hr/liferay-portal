{
  try {
    MirageFeed mirageFeed=(MirageFeed)contentFeed;
    JournalFeed feed=mirageFeed.getFeed();
    String uuid=feed.getUuid();
    long userId=feed.getUserId();
    long groupId=feed.getGroupId();
    String feedId=feed.getFeedId();
    boolean autoFeedId=mirageFeed.isAutoFeedId();
    String name=feed.getName();
    String description=feed.getDescription();
    String type=feed.getType();
    String structureId=feed.getStructureId();
    String templateId=feed.getTemplateId();
    String rendererTemplateId=feed.getRendererTemplateId();
    int delta=feed.getDelta();
    String orderByCol=feed.getOrderByCol();
    String orderByType=feed.getOrderByType();
    String targetLayoutFriendlyUrl=feed.getTargetLayoutFriendlyUrl();
    String targetPortletId=feed.getTargetPortletId();
    String contentField=feed.getContentField();
    String feedType=feed.getFeedType();
    double feedVersion=feed.getFeedVersion();
    User user=UserUtil.findByPrimaryKey(userId);
    feedId=feedId.trim().toUpperCase();
    Date now=new Date();
    validate(user.getCompanyId(),groupId,feedId,autoFeedId,name,description,structureId,targetLayoutFriendlyUrl,contentField);
    if (autoFeedId) {
      feedId=String.valueOf(CounterLocalServiceUtil.increment());
    }
    long id=CounterLocalServiceUtil.increment();
    feed=JournalFeedUtil.create(id);
    feed.setUuid(uuid);
    feed.setGroupId(groupId);
    feed.setCompanyId(user.getCompanyId());
    feed.setUserId(user.getUserId());
    feed.setUserName(user.getFullName());
    feed.setCreateDate(now);
    feed.setModifiedDate(now);
    feed.setFeedId(feedId);
    feed.setName(name);
    feed.setDescription(description);
    feed.setType(type);
    feed.setStructureId(structureId);
    feed.setTemplateId(templateId);
    feed.setRendererTemplateId(rendererTemplateId);
    feed.setDelta(delta);
    feed.setOrderByCol(orderByCol);
    feed.setOrderByType(orderByType);
    feed.setTargetLayoutFriendlyUrl(targetLayoutFriendlyUrl);
    feed.setTargetPortletId(targetPortletId);
    feed.setContentField(contentField);
    if (Validator.isNull(feedType)) {
      feed.setFeedType(RSSUtil.DEFAULT_TYPE);
      feed.setFeedVersion(RSSUtil.DEFAULT_VERSION);
    }
 else {
      feed.setFeedType(feedType);
      feed.setFeedVersion(feedVersion);
    }
    JournalFeedUtil.update(feed,false);
    mirageFeed.setFeed(feed);
  }
 catch (  PortalException pe) {
    throw new CMSException(pe.getMessage(),pe);
  }
catch (  SystemException se) {
    throw new CMSException(se.getMessage(),se);
  }
}
