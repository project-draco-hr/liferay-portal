{
  try {
    Workspace workspace=new Workspace(_workspaceFile);
    Properties workspaceProperties=buildProperties(workspace,null,_workspacePropertiesFiles.toArray(new File[0]));
    workspace.setProperties(workspaceProperties);
    Project project=new Project(workspace,_projectFile);
    Properties projectProperties=buildProperties(project,_bndFile,_projectPropertiesFiles.toArray(new File[0]));
    project.setProperties(projectProperties);
    ProjectBuilder projectBuilder=new ProjectBuilder(project);
    projectBuilder.setBase(_baseFile);
    for (    File file : _classPath) {
      projectBuilder.addClasspath(file);
    }
    if (!_generateManifest) {
      projectBuilder.setProperty(ProjectBuilder.NOMANIFEST,"true");
    }
    return new BndArchive(projectBuilder.build());
  }
 catch (  Exception e) {
    throw new IllegalStateException(e);
  }
}
