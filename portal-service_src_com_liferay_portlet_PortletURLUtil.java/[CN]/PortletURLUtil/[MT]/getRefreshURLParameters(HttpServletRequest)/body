{
  Portlet portlet=(Portlet)request.getAttribute(WebKeys.RENDER_PORTLET);
  String portletId=portlet.getPortletId();
  String ppid=ParamUtil.getString(request,"p_p_id");
  Map<String,String[]> refreshUrlParameters=new HashMap<String,String[]>();
  if (ppid.equals(portletId)) {
    String namespace=PortalUtil.getPortletNamespace(portletId);
    Map<String,String[]> parameters=request.getParameterMap();
    for (    Map.Entry<String,String[]> entry : parameters.entrySet()) {
      String name=entry.getKey();
      if (name.startsWith(StringPool.UNDERLINE) && !name.startsWith(namespace)) {
        continue;
      }
      if (!PortalUtil.isReservedParameter(name) && !name.equals("currentURL") && !name.equals("settingsScope")&& !isRefreshURLReservedParameter(name,namespace)) {
        String[] values=entry.getValue();
        if (values == null) {
          continue;
        }
        refreshUrlParameters.put(name,values);
      }
    }
  }
  return refreshUrlParameters;
}
