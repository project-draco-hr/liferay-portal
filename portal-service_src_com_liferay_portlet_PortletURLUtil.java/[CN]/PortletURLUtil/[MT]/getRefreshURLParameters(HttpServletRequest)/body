{
  Map<String,String[]> refreshURLParameters=new HashMap<>();
  String ppid=ParamUtil.getString(request,"p_p_id");
  Portlet portlet=(Portlet)request.getAttribute(WebKeys.RENDER_PORTLET);
  if (ppid.equals(portlet.getPortletId())) {
    String namespace=PortalUtil.getPortletNamespace(portlet.getPortletId());
    Map<String,String[]> parameters=request.getParameterMap();
    for (    Map.Entry<String,String[]> entry : parameters.entrySet()) {
      String name=entry.getKey();
      if (name.startsWith(StringPool.UNDERLINE) && !name.startsWith(namespace)) {
        continue;
      }
      if (!PortalUtil.isReservedParameter(name) && !name.equals("currentURL") && !name.equals("settingsScope")&& !isRefreshURLReservedParameter(name,namespace)) {
        String[] values=entry.getValue();
        if (values == null) {
          continue;
        }
        refreshURLParameters.put(name,values);
      }
    }
  }
  return refreshURLParameters;
}
