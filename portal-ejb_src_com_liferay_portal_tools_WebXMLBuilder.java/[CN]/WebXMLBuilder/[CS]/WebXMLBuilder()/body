{
  try {
    String rootDir="../";
    String portalWebDir="portal-web/docroot/";
    String webSitesDir="web-sites/";
    if (!FileUtil.exists(rootDir + portalWebDir + "WEB-INF/web.xml") && !FileUtil.exists(rootDir + "ext-web/tmp/WEB-INF/web.xml")) {
      rootDir="";
    }
    if (!FileUtil.exists(rootDir + portalWebDir + "WEB-INF/web.xml")) {
      portalWebDir="ext-web/tmp/";
    }
    String webXML=FileUtil.read(rootDir + portalWebDir + "WEB-INF/web.xml");
    int x=webXML.indexOf("<web-app");
    x=webXML.indexOf(">",x) + 1;
    int y=webXML.indexOf("</web-app>");
    webXML=webXML.substring(x,y);
    File webSite=new File(rootDir + "web-sites");
    String[] webSites=webSite.list();
    for (int i=0; i < webSites.length; i++) {
      if (webSites[i].endsWith("-web")) {
        File webSiteXML=new File(rootDir + webSitesDir + webSites[i]+ "/docroot/WEB-INF/web.xml");
        String content=FileUtil.read(webSiteXML);
        int z=content.indexOf("<web-app");
        z=content.indexOf(">",z) + 1;
        String newContent=content.substring(0,z) + webXML + content.substring(z,content.length());
        newContent=organizeWebXML(newContent);
        if ((newContent != null) && !content.equals(newContent)) {
          FileUtil.write(webSiteXML,newContent);
        }
        for (int j=0; j < _FILES.length; j++) {
          FileUtil.copyFile(rootDir + portalWebDir + "WEB-INF/"+ _FILES[j],rootDir + webSitesDir + webSites[i]+ "/docroot/WEB-INF/"+ _FILES[j]);
        }
        CopyTask.copyDirectory(rootDir + portalWebDir + "html/layouttpl",rootDir + webSitesDir + webSites[i]+ "/docroot/html/layouttpl");
      }
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
