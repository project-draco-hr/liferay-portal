{
  try {
    long authorUserId=getUserId(userId,node,author,usersMap);
    String parentTitle=readParentTitle(content);
    String redirectTitle=readRedirectTitle(content);
    ServiceContext serviceContext=new ServiceContext();
    serviceContext.setAddGroupPermissions(true);
    serviceContext.setAddGuestPermissions(true);
    serviceContext.setAssetTagNames(readAssetTagNames(userId,node,content));
    String format=FORMAT_MEDIAWIKI;
    Collection<String> supportedFormats=WikiUtil.getFormats();
    if (Validator.isNotNull(redirectTitle)) {
      content=StringPool.DOUBLE_OPEN_BRACKET + redirectTitle + StringPool.DOUBLE_CLOSE_BRACKET;
      format=FORMAT_CREOLE;
    }
 else     if (supportedFormats.contains(FORMAT_MEDIAWIKI) && Validator.equals(_wikiGroupServiceConfiguration.defaultFormat(),FORMAT_MEDIAWIKI)) {
      content=content.replaceAll(_imagesPattern.pattern(),"$1$2" + SHARED_IMAGES_TITLE + StringPool.SLASH+ "$3$4");
    }
 else {
      _translator.setStrictImportMode(strictImportMode);
      content=_translator.translate(content);
      format=FORMAT_CREOLE;
    }
    WikiPage page=null;
    try {
      page=_wikiPageLocalService.getPage(node.getNodeId(),title);
    }
 catch (    NoSuchPageException nspe) {
      page=_wikiPageLocalService.addPage(authorUserId,node.getNodeId(),title,WikiPageConstants.NEW,null,true,serviceContext);
    }
    _wikiPageLocalService.updatePage(authorUserId,node.getNodeId(),title,page.getVersion(),content,summary,true,format,parentTitle,redirectTitle,serviceContext);
  }
 catch (  Exception e) {
    throw new PortalException("Error importing page " + title,e);
  }
}
