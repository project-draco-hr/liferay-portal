{
  MockitoAnnotations.initMocks(this);
  when(_portletLocalService.getPortletById(Matchers.anyString())).thenAnswer(new Answer<Portlet>(){
    @Override public Portlet answer(    InvocationOnMock invocation) throws Throwable {
      Object[] args=invocation.getArguments();
      if (Validator.equals(_TEST_PORTLET_ID,args[0])) {
        return _testPortlet;
      }
 else       if (Validator.equals(PortletKeys.PORTAL,args[0])) {
        return _portalPortlet;
      }
      return _portletUndeployed;
    }
  }
);
  mockStatic(PortletLocalServiceUtil.class,new CallsRealMethods());
  stub(method(PortletLocalServiceUtil.class,"getService")).toReturn(_portletLocalService);
  setUpComboServlet();
  setUpPortalServletContext();
  setUpPortalPortlet();
  setUpPluginServletContext();
  setUpTestPortlet();
  when(_portletUndeployed.isUndeployedPortlet()).thenReturn(true);
  _mockHttpServletRequest=new MockHttpServletRequest();
  _mockHttpServletRequest.setLocalAddr("localhost");
  _mockHttpServletRequest.setLocalPort(8080);
  _mockHttpServletRequest.setScheme("http");
  _mockHttpServletResponse=new MockHttpServletResponse();
}
