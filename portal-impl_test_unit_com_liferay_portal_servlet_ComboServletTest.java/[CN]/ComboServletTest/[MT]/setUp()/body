{
  MockitoAnnotations.initMocks(this);
  when(_portletLocalService.getPortletById(Matchers.anyString())).thenAnswer(new Answer<Portlet>(){
    @Override public Portlet answer(    InvocationOnMock invocation) throws Throwable {
      Object[] args=invocation.getArguments();
      if (PortletKeys.PORTAL.equals(args[0])) {
        return _portalPortlet;
      }
 else       if (PortletKeys.SERVER_ADMIN.equals(args[0])) {
        return _serverAdminPortlet;
      }
      return _portletUndeployed;
    }
  }
);
  mockStatic(PortletLocalServiceUtil.class,new CallsRealMethods());
  stub(method(PortletLocalServiceUtil.class,"getService")).toReturn(_portletLocalService);
  _comboServlet=new ComboServlet();
  _portalServletContext=spy(new MockServletContext());
  ServletConfig servletConfig=new MockServletConfig(_portalServletContext);
  _portalServletContext.setContextPath("portal");
  when(_portalPortletApp.getServletContext()).thenReturn(_portalServletContext);
  when(_portalPortlet.getPortletApp()).thenReturn(_portalPortletApp);
  when(_portalPortlet.getRootPortletId()).thenReturn(PortletKeys.PORTAL);
  _comboServlet.init(servletConfig);
  _pluginServletContext=spy(new MockServletContext());
  when(_serverAdminPortletApp.getServletContext()).thenReturn(_pluginServletContext);
  when(_serverAdminPortlet.getPortletApp()).thenReturn(_serverAdminPortletApp);
  when(_serverAdminPortlet.getRootPortletId()).thenReturn("75");
  when(_portletUndeployed.isUndeployedPortlet()).thenReturn(true);
  _mockHttpServletRequest=new MockHttpServletRequest();
  _mockHttpServletRequest.setLocalAddr("localhost");
  _mockHttpServletRequest.setLocalPort(8080);
  _mockHttpServletRequest.setScheme("http");
  _mockHttpServletResponse=new MockHttpServletResponse();
}
