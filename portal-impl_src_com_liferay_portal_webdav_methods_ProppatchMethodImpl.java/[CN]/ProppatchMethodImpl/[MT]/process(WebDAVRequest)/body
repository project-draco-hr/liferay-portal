{
  try {
    HttpServletResponse response=webDavRequest.getHttpServletResponse();
    Set<Tuple> props=processInstructions(webDavRequest);
    String xml=getResponseXML(webDavRequest,props);
    response.setContentType(ContentTypes.TEXT_XML_UTF8);
    response.setStatus(WebDAVUtil.SC_MULTI_STATUS);
    if (_log.isInfoEnabled()) {
      _log.info("Status code " + WebDAVUtil.SC_MULTI_STATUS);
    }
    try {
      ServletResponseUtil.write(response,xml);
    }
 catch (    Exception e) {
      if (_log.isWarnEnabled()) {
        _log.warn(e);
      }
    }
    return -1;
  }
 catch (  InvalidRequestException ire) {
    if (_log.isInfoEnabled()) {
      _log.info(ire.getMessage(),ire);
    }
    return HttpServletResponse.SC_BAD_REQUEST;
  }
catch (  LockException le) {
    return WebDAVUtil.SC_LOCKED;
  }
catch (  Exception e) {
    throw new WebDAVException(e);
  }
}
