{
  ThemeDisplay themeDisplay=(ThemeDisplay)liferayPortletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Map<String,PortletURL> addPortletURLs=new TreeMap<String,PortletURL>(new ModelResourceComparator(themeDisplay.getLocale()));
  if (Validator.isNull(redirect)) {
    PortletDisplay portletDisplay=themeDisplay.getPortletDisplay();
    PortletURL redirectURL=liferayPortletResponse.createLiferayPortletURL(themeDisplay.getPlid(),portletDisplay.getId(),PortletRequest.RENDER_PHASE,false);
    redirectURL.setParameter("struts_action","/asset_publisher/add_asset_redirect");
    redirectURL.setParameter("redirect",themeDisplay.getURLCurrent());
    redirectURL.setWindowState(LiferayWindowState.POP_UP);
    redirect=redirectURL.toString();
  }
  for (  long classNameId : classNameIds) {
    String className=PortalUtil.getClassName(classNameId);
    AssetRendererFactory assetRendererFactory=AssetRendererFactoryRegistryUtil.getAssetRendererFactoryByClassName(className);
    Portlet portlet=PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),assetRendererFactory.getPortletId());
    if (!portlet.isActive()) {
      continue;
    }
    ClassTypeReader classTypeReader=assetRendererFactory.getClassTypeReader();
    List<ClassType> classTypes=classTypeReader.getAvailableClassTypes(PortalUtil.getCurrentAndAncestorSiteGroupIds(themeDisplay.getScopeGroupId()),themeDisplay.getLocale());
    if ((classTypeIds.length == 0) || classTypes.isEmpty()) {
      PortletURL addPortletURL=getAddPortletURL(liferayPortletRequest,liferayPortletResponse,groupId,className,0,allAssetCategoryIds,allAssetTagNames,redirect);
      if (addPortletURL != null) {
        addPortletURLs.put(className,addPortletURL);
      }
    }
    for (    ClassType classType : classTypes) {
      long classTypeId=classType.getClassTypeId();
      if (ArrayUtil.contains(classTypeIds,classTypeId) || (classTypeIds.length == 0)) {
        PortletURL addPortletURL=getAddPortletURL(liferayPortletRequest,liferayPortletResponse,groupId,className,classTypeId,allAssetCategoryIds,allAssetTagNames,redirect);
        if (addPortletURL != null) {
          String mesage=className + CLASSNAME_SEPARATOR + classType.getName();
          addPortletURLs.put(mesage,addPortletURL);
        }
      }
    }
  }
  return addPortletURLs;
}
