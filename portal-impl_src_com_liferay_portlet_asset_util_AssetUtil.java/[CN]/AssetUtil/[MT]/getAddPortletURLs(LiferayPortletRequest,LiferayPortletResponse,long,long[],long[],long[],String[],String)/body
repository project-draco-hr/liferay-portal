{
  ThemeDisplay themeDisplay=(ThemeDisplay)liferayPortletRequest.getAttribute(WebKeys.THEME_DISPLAY);
  Map<String,PortletURL> addPortletURLs=new TreeMap<>(new ModelResourceComparator(themeDisplay.getLocale()));
  for (  long classNameId : classNameIds) {
    String className=PortalUtil.getClassName(classNameId);
    AssetRendererFactory<?> assetRendererFactory=AssetRendererFactoryRegistryUtil.getAssetRendererFactoryByClassName(className);
    if (Validator.isNull(assetRendererFactory.getPortletId())) {
      continue;
    }
    Portlet portlet=PortletLocalServiceUtil.getPortletById(themeDisplay.getCompanyId(),assetRendererFactory.getPortletId());
    if (!portlet.isActive()) {
      continue;
    }
    ClassTypeReader classTypeReader=assetRendererFactory.getClassTypeReader();
    List<ClassType> classTypes=classTypeReader.getAvailableClassTypes(PortalUtil.getCurrentAndAncestorSiteGroupIds(themeDisplay.getScopeGroupId()),themeDisplay.getLocale());
    boolean addDefaultPortletURL=true;
    for (    ClassType classType : classTypes) {
      long classTypeId=classType.getClassTypeId();
      if (classTypeId == 0) {
        addDefaultPortletURL=false;
      }
      if (ArrayUtil.contains(classTypeIds,classTypeId) || (classTypeIds.length == 0)) {
        PortletURL addPortletURL=getAddPortletURL(liferayPortletRequest,liferayPortletResponse,groupId,className,classTypeId,allAssetCategoryIds,allAssetTagNames,redirect);
        if (addPortletURL != null) {
          String mesage=className + CLASSNAME_SEPARATOR + classType.getName();
          addPortletURLs.put(mesage,addPortletURL);
        }
      }
    }
    if (((classTypeIds.length == 0) || classTypes.isEmpty()) && addDefaultPortletURL) {
      PortletURL addPortletURL=getAddPortletURL(liferayPortletRequest,liferayPortletResponse,groupId,className,0,allAssetCategoryIds,allAssetTagNames,redirect);
      if (addPortletURL != null) {
        addPortletURLs.put(className,addPortletURL);
      }
    }
  }
  return addPortletURLs;
}
