{
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    con=DataAccess.getConnection();
    StringBundler sb=new StringBundler(5);
    sb.append("select distinct User_.companyId, User_.userId, ");
    sb.append("User_.firstName, User_.middleName, User_.lastName ");
    sb.append("from User_ inner join PollsVote on PollsVote.userId = ");
    sb.append("User_.userId where PollsVote.userName is null or ");
    sb.append("PollsVote.userName = ''");
    ps=con.prepareStatement(sb.toString());
    rs=ps.executeQuery();
    while (rs.next()) {
      long companyId=rs.getLong("companyId");
      long userId=rs.getLong("userId");
      String firstName=rs.getString("firstName");
      String middleName=rs.getString("middleName");
      String lastName=rs.getString("lastName");
      FullNameGenerator fullNameGenerator=FullNameGeneratorFactory.getInstance();
      String fullName=fullNameGenerator.getFullName(firstName,middleName,lastName);
      sb=new StringBundler(6);
      sb.append("update PollsVote set companyId = ");
      sb.append(companyId);
      sb.append(", userName = '");
      sb.append(fullName);
      sb.append("' where userId = ");
      sb.append(userId);
      runSQL(sb.toString());
    }
  }
  finally {
    DataAccess.cleanUp(con,ps,rs);
  }
}
