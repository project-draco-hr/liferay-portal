{
  String languageId=null;
  XSLURIResolver xslURIResolver=_xslTemplateResource.getXSLURIResolver();
  if (xslURIResolver != null) {
    languageId=xslURIResolver.getLanguageId();
  }
  Locale locale=LocaleUtil.fromLanguageId(languageId);
  XSLErrorListener xslErrorListener=new XSLErrorListener(locale);
  _transformerFactory.setErrorListener(xslErrorListener);
  _transformerFactory.setURIResolver(xslURIResolver);
  _xmlSource=new StreamSource(_xslTemplateResource.getXMLReader());
  Transformer transformer=null;
  if (_errorTemplateResource == null) {
    try {
      transformer=_getTransformer(_transformerFactory,_xslTemplateResource);
      transformer.transform(_xmlSource,new StreamResult(writer));
      return;
    }
 catch (    Exception e) {
      throw new TemplateException("Unable to process XSL template " + _xslTemplateResource.getTemplateId(),e);
    }
  }
  UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
  transformer=_getTransformer(_transformerFactory,_xslTemplateResource);
  transformer.setParameter(TemplateConstants.WRITER,unsyncStringWriter);
  transformer.transform(_xmlSource,new StreamResult(unsyncStringWriter));
  StringBundler sb=unsyncStringWriter.getStringBundler();
  sb.writeTo(writer);
}
