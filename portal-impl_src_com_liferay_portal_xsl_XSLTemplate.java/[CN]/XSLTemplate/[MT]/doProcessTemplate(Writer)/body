{
  TransformerFactory transformerFactory=TransformerFactory.newInstance();
  String languageId=null;
  XSLURIResolver xslURIResolver=_xslTemplateResource.getXSLURIResolver();
  if (xslURIResolver != null) {
    languageId=xslURIResolver.getLanguageId();
  }
  Locale locale=LocaleUtil.fromLanguageId(languageId);
  _xslErrorListener=new XSLErrorListener(locale);
  transformerFactory.setErrorListener(_xslErrorListener);
  transformerFactory.setURIResolver(xslURIResolver);
  StreamSource xmlSource=new StreamSource(_xslTemplateResource.getXMLReader());
  Transformer transformer=null;
  if (_errorTemplateResource == null) {
    transformer=_getTransformer(transformerFactory,_xslTemplateResource);
    transformer.transform(xmlSource,new StreamResult(writer));
    return;
  }
  UnsyncStringWriter unsyncStringWriter=new UnsyncStringWriter();
  transformer=_getTransformer(transformerFactory,_xslTemplateResource);
  transformer.setParameter(TemplateConstants.WRITER,unsyncStringWriter);
  transformer.transform(xmlSource,new StreamResult(unsyncStringWriter));
  StringBundler sb=unsyncStringWriter.getStringBundler();
  sb.writeTo(writer);
}
