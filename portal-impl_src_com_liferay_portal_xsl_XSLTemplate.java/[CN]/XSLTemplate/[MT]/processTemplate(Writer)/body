{
  try {
    doProcessTemplate(writer);
  }
 catch (  Exception e1) {
    TransformerFactory transformerFactory=TransformerFactory.newInstance();
    transformerFactory.setErrorListener(_xslErrorListener);
    transformerFactory.setURIResolver(_xslTemplateResource.getXSLURIResolver());
    Transformer errorTransformer=_getTransformer(transformerFactory,_errorTemplateResource);
    errorTransformer.setParameter(TemplateConstants.WRITER,writer);
    errorTransformer.setParameter("exception",_xslErrorListener.getMessageAndLocation());
    if (_errorTemplateResource instanceof StringTemplateResource) {
      StringTemplateResource stringTemplateResource=(StringTemplateResource)_errorTemplateResource;
      errorTransformer.setParameter("script",stringTemplateResource.getContent());
    }
    if (_xslErrorListener.getLocation() != null) {
      errorTransformer.setParameter("column",new Integer(_xslErrorListener.getColumnNumber()));
      errorTransformer.setParameter("line",new Integer(_xslErrorListener.getLineNumber()));
    }
    try {
      StreamSource xmlSource=new StreamSource(_xslTemplateResource.getXMLReader());
      errorTransformer.transform(xmlSource,new StreamResult(writer));
    }
 catch (    Exception e2) {
      throw new TemplateException("Unable to process XSL template " + _errorTemplateResource.getTemplateId(),e2);
    }
  }
}
