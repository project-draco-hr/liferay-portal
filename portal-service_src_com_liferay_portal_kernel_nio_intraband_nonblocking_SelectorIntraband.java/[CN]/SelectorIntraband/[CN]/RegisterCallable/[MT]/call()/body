{
  if (_readSelectableChannel == _writeSelectableChannel) {
    SelectionKey selectionKey=_readSelectableChannel.register(selector,0);
    SelectionKeyRegistrationReference selectionKeyRegistrationReference=new SelectionKeyRegistrationReference(SelectorIntraband.this,selectionKey,selectionKey);
    ChannelContext channelContext=new ChannelContext(new ConcurrentLinkedQueue<Datagram>());
    channelContext.setRegistrationReference(selectionKeyRegistrationReference);
    selectionKey.attach(channelContext);
    selectionKey.interestOps(SelectionKey.OP_READ | SelectionKey.OP_WRITE);
    return selectionKeyRegistrationReference;
  }
 else {
    SelectionKey readSelectionKey=_readSelectableChannel.register(selector,0);
    SelectionKey writeSelectionKey=_writeSelectableChannel.register(selector,0);
    SelectionKeyRegistrationReference selectionKeyRegistrationReference=new SelectionKeyRegistrationReference(SelectorIntraband.this,readSelectionKey,writeSelectionKey);
    ChannelContext channelContext=new ChannelContext(new ConcurrentLinkedQueue<Datagram>());
    channelContext.setRegistrationReference(selectionKeyRegistrationReference);
    readSelectionKey.attach(channelContext);
    writeSelectionKey.attach(channelContext);
    readSelectionKey.interestOps(SelectionKey.OP_READ);
    writeSelectionKey.interestOps(SelectionKey.OP_WRITE);
    return selectionKeyRegistrationReference;
  }
}
