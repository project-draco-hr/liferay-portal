{
  SelectionKeyRegistrationReference selectionKeyRegistrationReference=(SelectionKeyRegistrationReference)registrationReference;
  SelectionKey writeSelectionKey=selectionKeyRegistrationReference.writeSelectionKey;
  ChannelContext channelContext=(ChannelContext)writeSelectionKey.attachment();
  Queue<Datagram> sendingQueue=channelContext.getSendingQueue();
  sendingQueue.offer(datagram);
synchronized (writeSelectionKey) {
    int ops=writeSelectionKey.interestOps();
    if ((ops & SelectionKey.OP_WRITE) == 0) {
      ops|=SelectionKey.OP_WRITE;
      writeSelectionKey.interestOps(ops);
      selector.wakeup();
    }
  }
}
