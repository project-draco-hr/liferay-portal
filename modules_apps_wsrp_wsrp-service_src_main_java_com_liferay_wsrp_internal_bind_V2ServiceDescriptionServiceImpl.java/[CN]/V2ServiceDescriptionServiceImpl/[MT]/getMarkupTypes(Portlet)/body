{
  Map<String,Set<String>> portletModes=portlet.getPortletModes();
  Map<String,Set<String>> windowStates=portlet.getWindowStates();
  Set<String> mimeTypes=new HashSet<>();
  mimeTypes.addAll(portletModes.keySet());
  mimeTypes.addAll(windowStates.keySet());
  List<MarkupType> markupTypes=new ArrayList<>();
  for (  String mimeType : mimeTypes) {
    Set<String> mimeTypePortletModes=portletModes.get(mimeType);
    if (mimeTypePortletModes == null) {
      mimeTypePortletModes=Collections.emptySet();
    }
    Set<String> mimeTypeWindowStates=windowStates.get(mimeType);
    if (mimeTypeWindowStates == null) {
      mimeTypeWindowStates=Collections.emptySet();
    }
    MarkupType markupType=new MarkupType();
    markupType.setMimeType(mimeType);
    markupType.setModes(getWSRPKeys(mimeTypePortletModes));
    markupType.setWindowStates(getWSRPKeys(mimeTypeWindowStates));
    markupTypes.add(markupType);
  }
  return markupTypes.toArray(new MarkupType[markupTypes.size()]);
}
