{
  if (ServerDetector.isGlassfish() && location.equals("mail/MailSession")) {
    location="java:comp/env/" + location;
  }
  try {
    return lookup(ctx,location,false);
  }
 catch (  NameNotFoundException n1) {
    if (location.equals("java:comp/env/mail/MailSession") && ServerDetector.isGlassfishV3()) {
      return null;
    }
    throw n1;
  }
}
