{
  File tempFile=FileUtil.createTempFile();
  Directory tempDirectory=FSDirectory.open(tempFile);
  IndexCommitSerializationUtil.deserializeIndex(inputStream,tempDirectory);
  _deleteDirectory();
  IndexReader indexReader=IndexReader.open(tempDirectory,false);
  IndexSearcher indexSearcher=new IndexSearcher(indexReader);
  try {
    TopDocs allDocuments=indexSearcher.search(new MatchAllDocsQuery(),indexReader.numDocs());
    ScoreDoc[] allScoreDocs=allDocuments.scoreDocs;
    for (    ScoreDoc scoreDoc : allScoreDocs) {
      Document doc=indexSearcher.doc(scoreDoc.doc);
      addDocument(doc);
    }
  }
 catch (  IllegalArgumentException iae) {
    if (_log.isDebugEnabled()) {
      _log.debug(iae.getMessage());
    }
  }
  indexSearcher.close();
  indexReader.flush();
  indexReader.close();
  tempDirectory.close();
  FileUtil.deltree(tempFile);
}
