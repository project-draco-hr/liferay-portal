{
  if (SearchEngineUtil.isIndexReadOnly()) {
    return;
  }
synchronized (this) {
    initIndexWriter(companyId);
    try {
      if (document != null) {
        if (term != null) {
          _indexWriter.updateDocument(term,document);
        }
 else {
          _indexWriter.addDocument(document);
        }
        _optimizeCount++;
        if ((PropsValues.LUCENE_OPTIMIZE_INTERVAL == 0) || (_optimizeCount >= PropsValues.LUCENE_OPTIMIZE_INTERVAL)) {
          _indexWriter.optimize();
          _optimizeCount=0;
        }
      }
    }
  finally {
      cleanUp();
    }
  }
}
