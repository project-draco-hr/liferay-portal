{
  JdbcDirectory jdbcDirectory=null;
  Thread currentThread=Thread.currentThread();
  ClassLoader contextClassLoader=currentThread.getContextClassLoader();
  try {
    currentThread.setContextClassLoader(PortalClassLoaderUtil.getClassLoader());
    String tableName=_getTableName();
    jdbcDirectory=(JdbcDirectory)_jdbcDirectories.get(tableName);
    if (jdbcDirectory != null) {
      return jdbcDirectory;
    }
    try {
      DataSource dataSource=InfrastructureUtil.getDataSource();
      jdbcDirectory=new LiferayJdbcDirectory(dataSource,_dialect,tableName);
      _jdbcDirectories.put(tableName,jdbcDirectory);
      if (!jdbcDirectory.tableExists()) {
        jdbcDirectory.create();
      }
    }
 catch (    IOException ioe) {
      throw new RuntimeException(ioe);
    }
catch (    UnsupportedOperationException uoe) {
      if (_log.isWarnEnabled()) {
        _log.warn("Database doesn't support the ability to check " + "whether a table exists");
      }
      _manuallyCreateJdbcDirectory(jdbcDirectory,tableName);
    }
  }
  finally {
    currentThread.setContextClassLoader(contextClassLoader);
  }
  return jdbcDirectory;
}
