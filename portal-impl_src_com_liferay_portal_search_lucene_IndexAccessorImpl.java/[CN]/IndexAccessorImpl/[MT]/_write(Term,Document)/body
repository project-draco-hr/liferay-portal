{
synchronized (this) {
    _initIndexWriter();
    try {
      if (term != null) {
        _indexWriter.updateDocument(term,document);
      }
 else {
        _indexWriter.addDocument(document);
      }
      _documentCount++;
      _optimizeCount++;
      if ((PropsValues.LUCENE_OPTIMIZE_INTERVAL == 0) || (_optimizeCount >= PropsValues.LUCENE_OPTIMIZE_INTERVAL)) {
        _indexWriter.optimize();
        _optimizeCount=0;
      }
    }
  finally {
      _cleanUp(false);
    }
  }
}
