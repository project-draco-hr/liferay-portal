{
  String url=HttpUtil.addParameter(getAccessTokenURL(companyId),"client_id",getAppId(companyId));
  url=HttpUtil.addParameter(url,"redirect_uri",FacebookConnectUtil.getRedirectURL(companyId));
  String facebookConnectRedirectURL=getRedirectURL(companyId);
  facebookConnectRedirectURL=HttpUtil.addParameter(facebookConnectRedirectURL,"redirect",redirect);
  url=HttpUtil.addParameter(url,"redirect_uri",facebookConnectRedirectURL);
  url=HttpUtil.addParameter(url,"client_secret",getAppSecret(companyId));
  url=HttpUtil.addParameter(url,"code",code);
  Http.Options options=new Http.Options();
  options.setLocation(url);
  options.setPost(true);
  try {
    String content=HttpUtil.URLtoString(options);
    if (Validator.isNotNull(content)) {
      int x=content.indexOf("access_token=");
      if (x >= 0) {
        int y=content.indexOf(CharPool.AMPERSAND,x);
        if (y < x) {
          y=content.length();
        }
        return content.substring(x + 13,y);
      }
    }
  }
 catch (  Exception e) {
    throw new SystemException("Unable to retrieve Facebook access token",e);
  }
  return null;
}
