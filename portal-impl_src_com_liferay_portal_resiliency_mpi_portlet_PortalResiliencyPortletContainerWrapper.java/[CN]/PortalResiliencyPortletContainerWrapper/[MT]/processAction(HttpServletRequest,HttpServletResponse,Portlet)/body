{
  SPIAgent spiAgent=getSPIAgentForPortlet(portlet);
  if (spiAgent == null) {
    return _portletContainer.processAction(request,response,portlet);
  }
  Object[] requestAttributeValues=captureRequestAttibutes(request,_actionRequestAttributeNames);
  request.setAttribute(WebKeys.SPI_AGENT_LIFECYCLE,SPIAgent.Lifecycle.ACTION);
  request.setAttribute(WebKeys.SPI_AGENT_PORTLET,portlet);
  try {
    spiAgent.service(request,response);
    return (ActionResult)request.getAttribute(WebKeys.SPI_AGENT_ACTION_RESULT);
  }
 catch (  PortalResiliencyException pre) {
    _log.error(pre,pre);
    return ActionResult.EMPTY_ACTION_RESULT;
  }
 finally {
    request.removeAttribute(WebKeys.SPI_AGENT_ACTION_RESULT);
    restoreRequestAttibutes(request,_actionRequestAttributeNames,requestAttributeValues);
  }
}
