{
  SPIAgent spiAgent=_getSPIAgentForPortlet(portlet);
  if (spiAgent == null) {
    _portletContainer.serveResource(request,response,portlet);
    return;
  }
  request.setAttribute(WebKeys.SPI_AGENT_LIFECYCLE,SPIAgent.Lifecycle.RESOURCE);
  request.setAttribute(WebKeys.SPI_AGENT_PORTLET,portlet);
  try {
    spiAgent.service(request,response);
  }
 catch (  PortalResiliencyException pre) {
    _log.error(pre,pre);
  }
 finally {
    request.removeAttribute(WebKeys.SPI_AGENT_LIFECYCLE);
    request.removeAttribute(WebKeys.SPI_AGENT_PORTLET);
  }
}
