{
  DDMForm ddmForm=_ddmForms.get(structureKey);
  if (ddmForm != null) {
    return ddmForm;
  }
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    ps=connection.prepareStatement("select (select structureKey from DDMStructure where " + " structureId = parentStructureId) parentStructureKey, " + " definition from DDMStructure where structureKey = ?");
    ps.setString(1,structureKey);
    rs=ps.executeQuery();
    if (rs.next()) {
      String parentStructureKey=rs.getString("parentStructureKey");
      String definition=rs.getString("definition");
      ddmForm=DDMFormXSDDeserializerUtil.deserialize(definition);
      if (parentStructureKey != null) {
        DDMForm parentDDMForm=getDDMForm(parentStructureKey);
        List<DDMFormField> ddmFormFields=ddmForm.getDDMFormFields();
        ddmFormFields.addAll(parentDDMForm.getDDMFormFields());
      }
      _ddmForms.put(structureKey,ddmForm);
      return ddmForm;
    }
    throw new UpgradeException("Unable to find dynamic data mapping structure with key " + structureKey);
  }
  finally {
    DataAccess.cleanUp(ps,rs);
  }
}
