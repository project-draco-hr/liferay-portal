{
  while (true) {
    List<FilterMapping> oldFilterMappings=_filterMappingsMap.get(filterName);
    List<FilterMapping> newFilterMappings=null;
    if (oldFilterMappings == null) {
      newFilterMappings=new ArrayList<>();
    }
 else {
      newFilterMappings=new ArrayList<>(oldFilterMappings);
    }
    if (after) {
      newFilterMappings.add(filterMapping);
    }
 else {
      newFilterMappings.add(0,filterMapping);
    }
    if (newFilterMappings.size() == 1) {
      if (_filterMappingsMap.putIfAbsent(filterName,newFilterMappings) == null) {
        _filterNames.add(filterName);
        break;
      }
    }
 else     if (_filterMappingsMap.replace(filterName,oldFilterMappings,newFilterMappings)) {
      break;
    }
  }
}
