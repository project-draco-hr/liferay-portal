{
  ClassLoader contextClassLoader=(ClassLoader)servletContext.getAttribute(PluginContextListener.PLUGIN_CLASS_LOADER);
  if (contextClassLoader == null) {
    Thread currentThread=Thread.currentThread();
    contextClassLoader=currentThread.getContextClassLoader();
  }
  FilterConfig filterConfig=new InvokerFilterConfig(servletContext,filterName,initParameterMap);
  Filter filter=null;
  Thread currentThread=Thread.currentThread();
  ClassLoader currentClassLoader=currentThread.getContextClassLoader();
  currentThread.setContextClassLoader(contextClassLoader);
  try {
    filter=(Filter)InstanceFactory.newInstance(contextClassLoader,filterClassName);
    filter.init(filterConfig);
  }
 catch (  Exception e) {
    _log.error("Unable to initialize filter " + filterClassName,e);
    return;
  }
 finally {
    currentThread.setContextClassLoader(currentClassLoader);
  }
  boolean filterEnabled=true;
  if (filter instanceof LiferayFilter) {
  }
  if (filterEnabled) {
    _filterConfigs.put(filterName,filterConfig);
    _filters.put(filterName,filter);
  }
 else {
    if (filter instanceof PortalLifecycle) {
      PortalLifecycle portalLifecycle=(PortalLifecycle)filter;
      PortalLifecycleUtil.removeDestroy(portalLifecycle);
    }
    if (_log.isDebugEnabled()) {
      _log.debug("Removing disabled filter " + filter.getClass());
    }
  }
}
