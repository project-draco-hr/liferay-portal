{
  while (ProxyUtil.isProxyClass(service.getClass())) {
    InvocationHandler invocationHandler=ProxyUtil.getInvocationHandler(service);
    if (invocationHandler instanceof AdvisedSupportProxy) {
      AdvisedSupport advisedSupport=ServiceBeanAopProxy.getAdvisedSupport(service);
      TargetSource targetSource=advisedSupport.getTargetSource();
      service=targetSource.getTarget();
    }
 else     if (invocationHandler instanceof ClassLoaderBeanHandler) {
      ClassLoaderBeanHandler classLoaderBeanHandler=(ClassLoaderBeanHandler)invocationHandler;
      Object bean=classLoaderBeanHandler.getBean();
      if (bean instanceof ServiceWrapper) {
        ServiceWrapper<?> serviceWrapper=(ServiceWrapper<?>)bean;
        service=serviceWrapper.getWrappedService();
      }
 else {
        service=bean;
      }
    }
  }
  return service.getClass();
}
