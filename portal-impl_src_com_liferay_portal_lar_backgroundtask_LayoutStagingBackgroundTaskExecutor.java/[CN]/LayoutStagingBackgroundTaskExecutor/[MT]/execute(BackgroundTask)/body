{
  Map<String,Serializable> taskContextMap=backgroundTask.getTaskContextMap();
  long userId=MapUtil.getLong(taskContextMap,"userId");
  long targetGroupId=MapUtil.getLong(taskContextMap,"targetGroupId");
  StagingUtil.lockGroup(userId,targetGroupId);
  long sourceGroupId=MapUtil.getLong(taskContextMap,"sourceGroupId");
  boolean privateLayout=MapUtil.getBoolean(taskContextMap,"privateLayout");
  long[] layoutIds=GetterUtil.getLongValues(taskContextMap.get("layoutIds"));
  Map<String,String[]> parameterMap=(Map<String,String[]>)taskContextMap.get("parameterMap");
  Date startDate=(Date)taskContextMap.get("startDate");
  Date endDate=(Date)taskContextMap.get("endDate");
  File larFile=LayoutLocalServiceUtil.exportLayoutsAsFile(sourceGroupId,privateLayout,layoutIds,parameterMap,startDate,endDate);
  try {
    LayoutLocalServiceUtil.importLayouts(userId,targetGroupId,privateLayout,parameterMap,larFile);
  }
  finally {
    larFile.delete();
    StagingUtil.unlockGroup(targetGroupId);
  }
  return BackgroundTaskResult.SUCCESS;
}
