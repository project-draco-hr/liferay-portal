{
  try {
    String virtusertable=PropsUtil.get(PropsUtil.MAIL_HOOK_SENDMAIL_VIRTUSERTABLE);
    FileReader fr=new FileReader(virtusertable);
    BufferedReader br=new BufferedReader(fr);
    StringBuffer sb=new StringBuffer();
    for (String s=br.readLine(); s != null; s=br.readLine()) {
      if (!s.endsWith(" " + userId)) {
        sb.append(s).append('\n');
      }
    }
    if ((emailAddress != null) && (!emailAddress.equals(""))) {
      sb.append(emailAddress).append(" ").append(userId).append('\n');
    }
    br.close();
    fr.close();
    FileUtil.write(virtusertable,sb.toString());
    String virtusertableRefreshCmd=PropsUtil.get(PropsUtil.MAIL_HOOK_SENDMAIL_VIRTUSERTABLE_REFRESH);
    Runtime rt=Runtime.getRuntime();
    Process p=rt.exec(virtusertableRefreshCmd);
    ProcessUtil.close(p);
  }
 catch (  Exception e) {
    _log.error(StackTraceUtil.getStackTrace(e));
  }
}
