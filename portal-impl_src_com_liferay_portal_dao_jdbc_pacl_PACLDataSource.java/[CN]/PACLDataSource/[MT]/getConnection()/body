{
  Connection connection=_dataSource.getConnection();
  boolean enabled=PortalSecurityManagerThreadLocal.isEnabled();
  if (!PACLPolicyManager.isActive() || !enabled) {
    return connection;
  }
  PACLPolicy paclPolicy=PortalSecurityManagerThreadLocal.getPACLPolicy();
  if (paclPolicy == null) {
    try {
      PortalSecurityManagerThreadLocal.setEnabled(false);
      paclPolicy=PACLClassUtil.getPACLPolicyByReflection(_log.isDebugEnabled());
    }
  finally {
      PortalSecurityManagerThreadLocal.setEnabled(enabled);
    }
  }
  if ((paclPolicy == null) || !paclPolicy.isActive()) {
    return connection;
  }
  return (Connection)ProxyUtil.newProxyInstance(paclPolicy.getClassLoader(),new Class<?>[]{Connection.class},new PACLConnectionHandler(connection,paclPolicy));
}
