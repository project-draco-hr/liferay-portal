{
  Connection connection=_dataSource.getConnection();
  if (!PACLPolicyManager.isActive() || !PortalSecurityManagerThreadLocal.isEnabled()) {
    return connection;
  }
  PACLPolicy paclPolicy=PortalSecurityManagerThreadLocal.getPACLPolicy();
  if (paclPolicy == null) {
    paclPolicy=PACLClassUtil.getPACLPolicyByReflection(_log.isDebugEnabled());
  }
  if ((paclPolicy == null) || !paclPolicy.isActive()) {
    return connection;
  }
  return (Connection)ProxyUtil.newProxyInstance(paclPolicy.getClassLoader(),new Class<?>[]{Connection.class},new PACLConnectionHandler(connection,paclPolicy));
}
