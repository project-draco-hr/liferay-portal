{
  String name=permission.getName();
  String propertyName=name;
  if (propertyName.indexOf(StringPool.PERIOD) > 0) {
    propertyName=propertyName.substring(0,propertyName.indexOf(StringPool.PERIOD));
  }
  String key=TextFormatter.format(propertyName,TextFormatter.K);
  String[] classNames=getPropertyArray("security-manager-security-permission-" + key);
  if (classNames.length != 0) {
    for (    String className : classNames) {
      if (hasClassInCallTree(className)) {
        return;
      }
    }
  }
  if (name.equals(SECURITY_PERMISSION_GET_POLICY)) {
    if (!hasGetPolicy()) {
      throwSecurityException(_log,"Attempted to get the policy");
    }
  }
 else   if (name.equals(SECURITY_PERMISSION_SET_POLICY)) {
    if (!hasSetPolicy()) {
      throwSecurityException(_log,"Attempted to set the policy");
    }
  }
 else {
    if (_log.isDebugEnabled()) {
      Thread.dumpStack();
    }
    throwSecurityException(_log,"Attempted to " + permission.getName() + " on "+ permission.getActions());
  }
}
