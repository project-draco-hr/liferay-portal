{
  try {
    Session session=getSession();
    Document document=getDocument(session,fileEntryId);
    Document oldVersion=null;
    List<Document> documentVersions=document.getAllVersions();
    for (    Document currentVersion : documentVersions) {
      String currentVersionLabel=currentVersion.getVersionLabel();
      if (Validator.isNull(currentVersionLabel)) {
        currentVersionLabel=DLFileEntryConstants.VERSION_DEFAULT;
      }
      if (currentVersionLabel.equals(version)) {
        oldVersion=currentVersion;
        break;
      }
    }
    String mimeType=oldVersion.getContentStreamMimeType();
    String changeLog=LanguageUtil.format(serviceContext.getLocale(),"reverted-to-x",version,false);
    String title=oldVersion.getName();
    ContentStream contentStream=oldVersion.getContentStream();
    updateFileEntry(userId,fileEntryId,contentStream.getFileName(),mimeType,title,StringPool.BLANK,changeLog,true,contentStream.getStream(),contentStream.getLength(),serviceContext);
  }
 catch (  PortalException|SystemException e) {
    throw e;
  }
catch (  Exception e) {
    processException(e);
    throw new RepositoryException(e);
  }
}
