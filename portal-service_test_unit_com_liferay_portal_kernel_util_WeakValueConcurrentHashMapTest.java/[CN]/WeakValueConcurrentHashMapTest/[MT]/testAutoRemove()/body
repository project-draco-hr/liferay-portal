{
  WeakValueConcurrentHashMap<String,Object> weakValueConcurrentHashMap=new WeakValueConcurrentHashMap<String,Object>();
  String testKey="testKey";
  Object testValue=new Object();
  weakValueConcurrentHashMap.put(testKey,testValue);
  long startTime=System.currentTimeMillis();
  while ((System.currentTimeMillis() - startTime) < 100) {
    System.gc();
    Thread.sleep(1);
    assertTrue(weakValueConcurrentHashMap.containsKey(testKey));
  }
  testValue=null;
  startTime=System.currentTimeMillis();
  while ((System.currentTimeMillis() - startTime) < 100) {
    System.gc();
    Thread.sleep(1);
    if (!FinalizeManager.THREAD_ENABLED) {
      FinalizeManager.register(new Object(),new DummyFinalizeAction());
    }
    if (!weakValueConcurrentHashMap.containsKey(testKey)) {
      break;
    }
  }
  assertFalse(weakValueConcurrentHashMap.containsKey(testKey));
}
