{
  if (serviceContext.getWorkflowAction() != WorkflowConstants.ACTION_PUBLISH) {
    return;
  }
  WorkflowHandler workflowHandler=getWorkflowHandler(className);
  if (workflowHandler == null) {
    throw new WorkflowException("No workflow handler found for " + className);
  }
  WorkflowDefinitionLink workflowDefinitionLink=null;
  if (WorkflowThreadLocal.isEnabled() && WorkflowEngineManagerUtil.isDeployed()) {
    try {
      workflowDefinitionLink=workflowHandler.getWorkflowDefinitionLink(companyId,groupId,classPK);
    }
 catch (    NoSuchWorkflowDefinitionLinkException nswdle) {
    }
  }
  int status=WorkflowConstants.STATUS_PENDING;
  if (workflowDefinitionLink == null) {
    status=WorkflowConstants.STATUS_APPROVED;
  }
  workflowContext=new HashMap<String,Serializable>(workflowContext);
  workflowContext.put(WorkflowConstants.CONTEXT_COMPANY_ID,String.valueOf(companyId));
  workflowContext.put(WorkflowConstants.CONTEXT_GROUP_ID,String.valueOf(groupId));
  workflowContext.put(WorkflowConstants.CONTEXT_USER_ID,String.valueOf(userId));
  workflowContext.put(WorkflowConstants.CONTEXT_ENTRY_CLASS_NAME,className);
  workflowContext.put(WorkflowConstants.CONTEXT_ENTRY_CLASS_PK,String.valueOf(classPK));
  workflowContext.put(WorkflowConstants.CONTEXT_ENTRY_TYPE,workflowHandler.getType(LocaleUtil.getDefault()));
  workflowContext.put(WorkflowConstants.CONTEXT_SERVICE_CONTEXT,serviceContext);
  workflowHandler.updateStatus(status,workflowContext);
  if (workflowDefinitionLink != null) {
    workflowHandler.startWorkflowInstance(companyId,groupId,userId,classPK,model,workflowContext);
  }
}
