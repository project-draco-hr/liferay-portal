{
  WikiTestUtil.addPage(TestPropsValues.getUserId(),_group.getGroupId(),_node.getNodeId(),"ParentPage1",true);
  WikiTestUtil.addPage(TestPropsValues.getUserId(),_group.getGroupId(),_node.getNodeId(),"ParentPage2",true);
  ServiceContext serviceContext=ServiceContextTestUtil.getServiceContext(_group.getGroupId());
  WikiPage childPage1=WikiTestUtil.addPage(TestPropsValues.getUserId(),_node.getNodeId(),"ChildPage1",RandomTestUtil.randomString(),"ParentPage1",true,serviceContext);
  boolean workflowEnabled=WorkflowThreadLocal.isEnabled();
  try {
    WorkflowThreadLocal.setEnabled(true);
    serviceContext=(ServiceContext)serviceContext.clone();
    serviceContext.setWorkflowAction(WorkflowConstants.ACTION_SAVE_DRAFT);
    WikiPageLocalServiceUtil.changeParent(TestPropsValues.getUserId(),_node.getNodeId(),childPage1.getTitle(),"ParentPage2",serviceContext);
    WikiPage childPage=WikiPageLocalServiceUtil.getPage(_node.getNodeId(),childPage1.getTitle(),true);
    Assert.assertEquals("ParentPage1",childPage.getParentTitle());
  }
  finally {
    WorkflowThreadLocal.setEnabled(workflowEnabled);
  }
}
