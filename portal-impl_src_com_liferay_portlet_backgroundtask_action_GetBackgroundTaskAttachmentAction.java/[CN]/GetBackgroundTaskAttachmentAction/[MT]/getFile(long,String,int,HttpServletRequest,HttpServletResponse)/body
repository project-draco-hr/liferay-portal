{
  BackgroundTask backgroundTask=BackgroundTaskLocalServiceUtil.getBackgroundTask(backgroundTaskId);
  FileEntry fileEntry=PortletFileRepositoryUtil.getPortletFileEntry(backgroundTask.getGroupId(),backgroundTask.getAttachmentsFolderId(),fileName);
  DLFileEntry dlFileEntry=(DLFileEntry)fileEntry.getModel();
  DLFileVersion dlFileVersion=dlFileEntry.getFileVersion();
  if ((status != WorkflowConstants.STATUS_IN_TRASH) && (dlFileVersion.isInTrash() || dlFileEntry.isInTrashContainer())) {
    return;
  }
  if (dlFileVersion.isInTrash()) {
    fileName=TrashUtil.getOriginalTitle(dlFileEntry.getTitle());
  }
  ServletResponseUtil.sendFile(request,response,fileName,fileEntry.getContentStream(),fileEntry.getSize(),fileEntry.getMimeType());
}
