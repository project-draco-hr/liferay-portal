{
  try {
    searchContext.setSearchEngineId(getSearchEngineId());
    BooleanQuery contextQuery=BooleanQueryFactoryUtil.create(searchContext);
    contextQuery.addRequiredTerm(Field.COMPANY_ID,searchContext.getCompanyId());
    BooleanQuery fullQuery=createFullQuery(contextQuery,searchContext);
    fullQuery.setQueryConfig(searchContext.getQueryConfig());
    PermissionChecker permissionChecker=PermissionThreadLocal.getPermissionChecker();
    int end=searchContext.getEnd();
    int start=searchContext.getStart();
    if (isFilterSearch(searchContext) && (permissionChecker != null)) {
      searchContext.setEnd(end + INDEX_FILTER_SEARCH_LIMIT);
      searchContext.setStart(0);
    }
    Hits hits=SearchEngineUtil.search(searchContext,fullQuery);
    if ((start != QueryUtil.ALL_POS) && (hits.getLength() <= start)) {
      int delta=end - start;
      start=(hits.getLength() / delta) * delta;
      if ((start == hits.getLength()) && (hits.getLength() > 0)) {
        start-=delta;
      }
      end=start + delta;
    }
    searchContext.setEnd(end);
    searchContext.setStart(start);
    if (isFilterSearch(searchContext) && (permissionChecker != null)) {
      hits=filterSearch(hits,permissionChecker,searchContext);
    }
    return hits;
  }
 catch (  SearchException se) {
    throw se;
  }
catch (  Exception e) {
    throw new SearchException(e);
  }
}
