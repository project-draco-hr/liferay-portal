{
  if (inputStream == null) {
    throw new IllegalArgumentException("Input stream cannot be null");
  }
  if (outputStream == null) {
    throw new IllegalArgumentException("Output stream cannot be null");
  }
  if (bufferSize <= 0) {
    bufferSize=BUFFER_SIZE;
  }
  if (!(inputStream instanceof BufferedInputStream)) {
    inputStream=new BufferedInputStream(inputStream,bufferSize);
  }
  if (!(outputStream instanceof BufferedOutputStream)) {
    outputStream=new BufferedOutputStream(outputStream,bufferSize);
  }
  try {
    byte[] bytes=new byte[bufferSize];
    int value=-1;
    while ((value=inputStream.read(bytes)) != -1) {
      outputStream.write(bytes,0,value);
    }
  }
  finally {
    cleanUp(inputStream,outputStream);
  }
}
