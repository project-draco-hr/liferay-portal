{
  if (ArrayUtil.isEmpty(classLoaders)) {
    if (_groovyShell == null) {
synchronized (this) {
        if (_groovyShell == null) {
          _groovyShell=new GroovyShell(getScriptingExecutorClassLoader());
        }
      }
    }
    return _groovyShell;
  }
  ClassLoader aggregateClassLoader=getAggregateClassLoader(classLoaders);
  GroovyShell groovyShell=_groovyShells.get(aggregateClassLoader);
  if (groovyShell == null) {
    groovyShell=new GroovyShell(aggregateClassLoader);
    GroovyShell oldGroovyShell=_groovyShells.putIfAbsent(aggregateClassLoader,groovyShell);
    if (oldGroovyShell != null) {
      groovyShell=oldGroovyShell;
    }
  }
  return groovyShell;
}
