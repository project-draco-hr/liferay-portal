{
  if (xml == null) {
    return xml;
  }
  _requestedLocale=getLanguageId();
  if (!isTemplateDriven()) {
    return LocalizationUtil.getLocalization(xml,_requestedLocale);
  }
  try {
    SAXReader reader=new SAXReader();
    Document doc=reader.read(new StringReader(xml));
    Element root=doc.getRootElement();
    String defaultLanguageId=LocaleUtil.toLanguageId(LocaleUtil.getDefault());
    String[] availableLocales=StringUtil.split(root.attributeValue("available-locales",defaultLanguageId));
    String defaultLocale=root.attributeValue("default-locale",defaultLanguageId);
    boolean isSupportedLocale=false;
    for (int i=0; i < availableLocales.length; i++) {
      if (availableLocales[i].equalsIgnoreCase(getLanguageId())) {
        isSupportedLocale=true;
        break;
      }
    }
    if (!isSupportedLocale) {
      setLanguageId(defaultLocale);
    }
    replace(root);
    xml=JournalUtil.formatXML(doc);
  }
 catch (  Exception e) {
    _log.error(e);
  }
  return xml;
}
