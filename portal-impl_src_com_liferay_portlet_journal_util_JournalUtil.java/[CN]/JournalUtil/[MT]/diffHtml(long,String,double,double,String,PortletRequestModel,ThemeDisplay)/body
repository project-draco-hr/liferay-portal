{
  JournalArticle sourceArticle=JournalArticleLocalServiceUtil.getArticle(groupId,articleId,sourceVersion);
  if (!JournalArticleLocalServiceUtil.isRenderable(sourceArticle,portletRequestModel,themeDisplay)) {
    throw new CompareVersionsException(sourceVersion);
  }
  JournalArticleDisplay sourceArticleDisplay=JournalArticleLocalServiceUtil.getArticleDisplay(sourceArticle,null,Constants.VIEW,languageId,1,portletRequestModel,themeDisplay);
  JournalArticle targetArticle=JournalArticleLocalServiceUtil.getArticle(groupId,articleId,targetVersion);
  if (!JournalArticleLocalServiceUtil.isRenderable(targetArticle,portletRequestModel,themeDisplay)) {
    throw new CompareVersionsException(targetVersion);
  }
  JournalArticleDisplay targetArticleDisplay=JournalArticleLocalServiceUtil.getArticleDisplay(targetArticle,null,Constants.VIEW,languageId,1,portletRequestModel,themeDisplay);
  return DiffHtmlUtil.diff(new UnsyncStringReader(sourceArticleDisplay.getContent()),new UnsyncStringReader(targetArticleDisplay.getContent()));
}
