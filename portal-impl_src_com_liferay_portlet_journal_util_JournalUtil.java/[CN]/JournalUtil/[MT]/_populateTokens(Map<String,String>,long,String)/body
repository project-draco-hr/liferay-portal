{
  Document requestDocument=SAXReaderUtil.read(xmlRequest);
  Element rootElement=requestDocument.getRootElement();
  Element themeDisplayElement=rootElement.element("theme-display");
  Layout layout=LayoutLocalServiceUtil.getLayout(GetterUtil.getLong(themeDisplayElement.elementText("plid")));
  Group group=layout.getGroup();
  LayoutSet layoutSet=layout.getLayoutSet();
  String friendlyUrlCurrent=null;
  if (layout.isPublicLayout()) {
    friendlyUrlCurrent=themeDisplayElement.elementText("path-friendly-url-public");
  }
 else   if (group.isUserGroup()) {
    friendlyUrlCurrent=themeDisplayElement.elementText("path-friendly-url-private-user");
  }
 else {
    friendlyUrlCurrent=themeDisplayElement.elementText("path-friendly-url-private-group");
  }
  String layoutSetFriendlyUrl=themeDisplayElement.elementText("i18n-path");
  String virtualHostname=layoutSet.getVirtualHostname();
  if (Validator.isNull(virtualHostname) || !virtualHostname.equals(themeDisplayElement.elementText("server-name"))) {
    layoutSetFriendlyUrl=friendlyUrlCurrent + group.getFriendlyURL();
  }
  tokens.put("cdn_host",themeDisplayElement.elementText("cdn-host"));
  tokens.put("company_id",themeDisplayElement.elementText("company-id"));
  tokens.put("friendly_url_current",friendlyUrlCurrent);
  tokens.put("friendly_url_private_group",themeDisplayElement.elementText("path-friendly-url-private-group"));
  tokens.put("friendly_url_private_user",themeDisplayElement.elementText("path-friendly-url-private-user"));
  tokens.put("friendly_url_public",themeDisplayElement.elementText("path-friendly-url-public"));
  tokens.put("group_friendly_url",group.getFriendlyURL());
  tokens.put("group_id",String.valueOf(groupId));
  tokens.put("image_path",themeDisplayElement.elementText("path-image"));
  tokens.put("layout_set_friendly_url",layoutSetFriendlyUrl);
  tokens.put("main_path",themeDisplayElement.elementText("path-main"));
  tokens.put("portal_ctx",themeDisplayElement.elementText("path-context"));
  tokens.put("portal_url",HttpUtil.removeProtocol(themeDisplayElement.elementText("url-portal")));
  tokens.put("protocol",HttpUtil.getProtocol(themeDisplayElement.elementText("url-portal")));
  tokens.put("root_path",themeDisplayElement.elementText("path-context"));
  tokens.put("theme_image_path",themeDisplayElement.elementText("path-theme-images"));
  _populateCustomTokens(tokens);
  tokens.put("friendly_url",themeDisplayElement.elementText("path-friendly-url-public"));
  tokens.put("friendly_url_private",themeDisplayElement.elementText("path-friendly-url-private-group"));
  tokens.put("page_url",themeDisplayElement.elementText("path-friendly-url-public"));
}
