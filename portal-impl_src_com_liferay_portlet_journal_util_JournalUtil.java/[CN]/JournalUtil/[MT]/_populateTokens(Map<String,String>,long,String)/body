{
  Document request=SAXReaderUtil.read(xmlRequest);
  Element root=request.getRootElement();
  Element themeDisplayEl=root.element("theme-display");
  Layout layout=LayoutLocalServiceUtil.getLayout(GetterUtil.getLong(themeDisplayEl.elementText("plid")));
  Group group=layout.getGroup();
  LayoutSet layoutSet=layout.getLayoutSet();
  String friendlyUrlCurrent=null;
  if (layout.isPublicLayout()) {
    friendlyUrlCurrent=themeDisplayEl.elementText("path-friendly-url-public");
  }
 else   if (group.isUserGroup()) {
    friendlyUrlCurrent=themeDisplayEl.elementText("path-friendly-url-private-user");
  }
 else {
    friendlyUrlCurrent=themeDisplayEl.elementText("path-friendly-url-private-group");
  }
  String layoutSetFriendlyUrl=StringPool.BLANK;
  String virtualHost=layoutSet.getVirtualHost();
  if (Validator.isNull(virtualHost) || !virtualHost.equals(themeDisplayEl.elementText("server-name"))) {
    layoutSetFriendlyUrl=friendlyUrlCurrent + group.getFriendlyURL();
  }
  tokens.put("cdn_host",themeDisplayEl.elementText("cdn-host"));
  tokens.put("company_id",themeDisplayEl.elementText("company-id"));
  tokens.put("friendly_url_current",friendlyUrlCurrent);
  tokens.put("friendly_url_private_group",themeDisplayEl.elementText("path-friendly-url-private-group"));
  tokens.put("friendly_url_private_user",themeDisplayEl.elementText("path-friendly-url-private-user"));
  tokens.put("friendly_url_public",themeDisplayEl.elementText("path-friendly-url-public"));
  tokens.put("group_friendly_url",group.getFriendlyURL());
  tokens.put("group_id",String.valueOf(groupId));
  tokens.put("image_path",themeDisplayEl.elementText("path-image"));
  tokens.put("layout_set_friendly_url",layoutSetFriendlyUrl);
  tokens.put("main_path",themeDisplayEl.elementText("path-main"));
  tokens.put("portal_ctx",themeDisplayEl.elementText("path-context"));
  tokens.put("portal_url",HttpUtil.removeProtocol(themeDisplayEl.elementText("url-portal")));
  tokens.put("protocol",HttpUtil.getProtocol(themeDisplayEl.elementText("url-portal")));
  tokens.put("root_path",themeDisplayEl.elementText("path-context"));
  tokens.put("theme_image_path",themeDisplayEl.elementText("path-theme-images"));
  _populateCustomTokens(tokens);
  tokens.put("friendly_url",themeDisplayEl.elementText("path-friendly-url-public"));
  tokens.put("friendly_url_private",themeDisplayEl.elementText("path-friendly-url-private-group"));
  tokens.put("page_url",themeDisplayEl.elementText("path-friendly-url-public"));
}
