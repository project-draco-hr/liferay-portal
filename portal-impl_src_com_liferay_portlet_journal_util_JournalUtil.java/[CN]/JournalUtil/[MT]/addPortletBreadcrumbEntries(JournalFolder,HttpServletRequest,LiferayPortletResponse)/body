{
  ThemeDisplay themeDisplay=(ThemeDisplay)request.getAttribute(com.liferay.portal.kernel.util.WebKeys.THEME_DISPLAY);
  String strutsAction=ParamUtil.getString(request,"struts_action");
  PortletURL portletURL=liferayPortletResponse.createRenderURL();
  if (strutsAction.equals("/journal/select_folder")) {
    portletURL.setParameter("struts_action","/journal/select_folder");
    portletURL.setWindowState(LiferayWindowState.POP_UP);
    PortalUtil.addPortletBreadcrumbEntry(request,themeDisplay.translate("home"),portletURL.toString());
  }
 else {
    portletURL.setParameter("struts_action","/journal/view");
    Map<String,Object> data=new HashMap<String,Object>();
    data.put("direction-right",Boolean.TRUE.toString());
    data.put("folder-id",JournalFolderConstants.DEFAULT_PARENT_FOLDER_ID);
    PortalUtil.addPortletBreadcrumbEntry(request,themeDisplay.translate("home"),portletURL.toString(),data);
  }
  if (folder != null) {
    List<JournalFolder> ancestorFolders=folder.getAncestors();
    Collections.reverse(ancestorFolders);
    for (    JournalFolder ancestorFolder : ancestorFolders) {
      portletURL.setParameter("folderId",String.valueOf(ancestorFolder.getFolderId()));
      Map<String,Object> data=new HashMap<String,Object>();
      data.put("direction-right",Boolean.TRUE.toString());
      data.put("folder-id",ancestorFolder.getFolderId());
      PortalUtil.addPortletBreadcrumbEntry(request,ancestorFolder.getName(),portletURL.toString(),data);
    }
    portletURL.setParameter("folderId",String.valueOf(folder.getFolderId()));
    if (folder.getFolderId() != JournalFolderConstants.DEFAULT_PARENT_FOLDER_ID) {
      JournalFolder unescapedFolder=folder.toUnescapedModel();
      Map<String,Object> data=new HashMap<String,Object>();
      data.put("direction-right",Boolean.TRUE.toString());
      data.put("folder-id",folder.getFolderId());
      PortalUtil.addPortletBreadcrumbEntry(request,unescapedFolder.getName(),portletURL.toString(),data);
    }
  }
}
