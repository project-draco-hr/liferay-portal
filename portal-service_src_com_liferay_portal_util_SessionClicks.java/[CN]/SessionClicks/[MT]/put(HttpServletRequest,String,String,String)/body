{
  if ((key.length() > _SESSION_CLICKS_MAX_SIZE_TERMS) || (value.length() > _SESSION_CLICKS_MAX_SIZE_TERMS)) {
    if (_log.isWarnEnabled()) {
      _log.warn("Session clicks has attempted to exceed the maximum " + "size allowed for keys or values with {key=" + key + ", value="+ value+ "}");
    }
    return;
  }
  while (true) {
    try {
      PortalPreferences preferences=PortletPreferencesFactoryUtil.getPortalPreferences(request);
      int size=preferences.size();
      if (size <= _SESSION_CLICKS_MAX_ALLOWED_VALUES) {
        preferences.setValue(namespace,key,value);
      }
 else {
        if (_log.isWarnEnabled()) {
          _log.warn("Session clicks has attempted to exceed the " + "maximum number of allowed values with {key=" + key + ", value="+ value+ "}");
        }
      }
      break;
    }
 catch (    ConcurrentModificationException cme) {
      continue;
    }
catch (    Exception e) {
      _log.error(e,e);
      break;
    }
  }
}
