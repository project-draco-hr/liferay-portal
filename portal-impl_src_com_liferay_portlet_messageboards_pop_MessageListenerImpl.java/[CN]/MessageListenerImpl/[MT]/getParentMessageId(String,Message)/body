{
  int pos=recipient.indexOf(CharPool.AT);
  boolean hasPrefix=StringUtil.startsWith(recipient,MBUtil.MESSAGE_POP_PORTLET_PREFIX);
  if (pos < 0 || !hasPrefix) {
    return MBUtil.getParentMessageId(message);
  }
  String target=recipient.substring(MBUtil.MESSAGE_POP_PORTLET_PREFIX.length(),pos);
  String[] parts=StringUtil.split(target,StringPool.PERIOD);
  long parentMessageId=0;
  if (parts.length == 2) {
    parentMessageId=GetterUtil.getLong(parts[1]);
  }
  if (parentMessageId > 0) {
    return parentMessageId;
  }
  return MBUtil.getParentMessageId(message);
}
