{
  if (_log.isDebugEnabled()) {
    _log.debug("Accepting ranges for the file " + fileName);
  }
  response.setHeader(HttpHeaders.ACCEPT_RANGES,HttpHeaders.ACCEPT_RANGES_BYTES_VALUE);
  List<Range> ranges=null;
  try {
    ranges=getRanges(request,response,contentLength);
  }
 catch (  IOException ioe) {
    if (_log.isErrorEnabled()) {
      _log.error(ioe);
    }
    response.setHeader(HttpHeaders.CONTENT_RANGE,"bytes */" + contentLength);
    response.sendError(HttpServletResponse.SC_REQUESTED_RANGE_NOT_SATISFIABLE);
    return;
  }
  if ((ranges == null) || ranges.isEmpty()) {
    sendFile(request,response,fileName,inputStream,contentLength,contentType);
  }
 else {
    if (_log.isDebugEnabled()) {
      _log.debug("Request has range header " + request.getHeader(HttpHeaders.RANGE));
    }
    write(request,response,fileName,ranges,inputStream,contentLength,contentType);
  }
}
