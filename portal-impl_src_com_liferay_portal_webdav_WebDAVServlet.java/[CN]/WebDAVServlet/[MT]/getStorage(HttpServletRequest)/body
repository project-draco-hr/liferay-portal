{
  String[] pathArray=WebDAVUtil.getPathArray(request.getPathInfo(),true);
  String storageClass=null;
  if (pathArray.length == 1) {
    storageClass=CompanyWebDAVStorageImpl.class.getName();
  }
 else   if (pathArray.length == 2) {
    storageClass=GroupWebDAVStorageImpl.class.getName();
  }
 else   if (pathArray.length >= 3) {
    storageClass=WebDAVUtil.getStorageClass(pathArray[2]);
  }
  if (Validator.isNull(storageClass)) {
    throw new WebDAVException("Invalid WebDAV path " + request.getPathInfo());
  }
  WebDAVStorage storage=(WebDAVStorage)InstancePool.get(storageClass);
  storage.setToken(WebDAVUtil.getStorageToken(storageClass));
  return storage;
}
