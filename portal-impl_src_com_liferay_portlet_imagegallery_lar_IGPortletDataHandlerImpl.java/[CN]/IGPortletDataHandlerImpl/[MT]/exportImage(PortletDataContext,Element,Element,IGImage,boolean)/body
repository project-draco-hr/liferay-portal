{
  if (checkDateRange && !portletDataContext.isWithinDateRange(image.getModifiedDate())) {
    return;
  }
  if (foldersElement != null) {
    exportParentFolder(portletDataContext,foldersElement,image.getFolderId());
  }
  String path=getImagePath(portletDataContext,image);
  if (portletDataContext.isPathNotProcessed(path)) {
    Element imageElement=imagesElement.addElement("image");
    imageElement.addAttribute("path",path);
    imageElement.addAttribute("bin-path",getImageBinPath(portletDataContext,image));
    if (portletDataContext.getBooleanParameter(_NAMESPACE,"categories")) {
      portletDataContext.addAssetCategories(IGImage.class,image.getImageId());
    }
    if (portletDataContext.getBooleanParameter(_NAMESPACE,"ratings")) {
      portletDataContext.addRatingsEntries(IGImage.class,image.getImageId());
    }
    if (portletDataContext.getBooleanParameter(_NAMESPACE,"tags")) {
      portletDataContext.addAssetTags(IGImage.class,image.getImageId());
    }
    image.setUserUuid(image.getUserUuid());
    Image largeImage=ImageUtil.findByPrimaryKey(image.getLargeImageId());
    image.setImageType(largeImage.getType());
    portletDataContext.addPermissions(IGImage.class,image.getImageId());
    portletDataContext.addZipEntry(getImageBinPath(portletDataContext,image),largeImage.getTextObj());
    portletDataContext.addZipEntry(path,image);
  }
}
