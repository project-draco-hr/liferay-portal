{
  if (checkDateRange && !portletDataContext.isWithinDateRange(image.getModifiedDate())) {
    return;
  }
  if (foldersElement != null) {
    exportParentFolder(portletDataContext,foldersElement,image.getFolderId());
  }
  String path=getImagePath(portletDataContext,image);
  if (!portletDataContext.isPathNotProcessed(path)) {
    return;
  }
  Element imageElement=imagesElement.addElement("image");
  imageElement.addAttribute("path",path);
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"categories")) {
    portletDataContext.addAssetCategories(IGImage.class,image.getImageId());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"ratings")) {
    portletDataContext.addRatingsEntries(IGImage.class,image.getImageId());
  }
  if (portletDataContext.getBooleanParameter(_NAMESPACE,"tags")) {
    portletDataContext.addAssetTags(IGImage.class,image.getImageId());
  }
  image.setUserUuid(image.getUserUuid());
  Image largeImage=ImageUtil.findByPrimaryKey(image.getLargeImageId());
  image.setImageType(largeImage.getType());
  portletDataContext.addPermissions(IGImage.class,image.getImageId());
  boolean performDirectBinaryImport=MapUtil.getBoolean(portletDataContext.getParameterMap(),PortletDataHandlerKeys.PERFORM_DIRECT_BINARY_IMPORT);
  if (!performDirectBinaryImport) {
    String binPath=getImageBinPath(portletDataContext,image);
    imageElement.addAttribute("bin-path",binPath);
    portletDataContext.addZipEntry(binPath,largeImage.getTextObj());
  }
  portletDataContext.addZipEntry(path,image);
}
