{
  portletDataContext.addExpandoColumns(IGImage.class.getName());
  portletDataContext.addExpandoColumns(IGFolder.class.getName());
  portletDataContext.addPermissions("com.liferay.portlet.imagegallery",portletDataContext.getScopeGroupId());
  Document document=SAXReaderUtil.createDocument();
  Element rootElement=document.addElement("image-gallery");
  rootElement.addAttribute("group-id",String.valueOf(portletDataContext.getScopeGroupId()));
  Element foldersElement=rootElement.addElement("folders");
  Element imagesElement=rootElement.addElement("images");
  List<IGFolder> folders=IGFolderUtil.findByGroupId(portletDataContext.getScopeGroupId());
  for (  IGFolder folder : folders) {
    exportFolder(portletDataContext,foldersElement,imagesElement,folder);
  }
  List<IGImage> images=IGImageUtil.findByG_F(portletDataContext.getScopeGroupId(),IGFolderConstants.DEFAULT_PARENT_FOLDER_ID);
  for (  IGImage image : images) {
    exportImage(portletDataContext,null,imagesElement,image,true);
  }
  return document.formattedString();
}
