{
  Date now=new Date();
  BackgroundTask backgroundTask=backgroundTaskPersistence.fetchByPrimaryKey(backgroundTaskId);
  if (backgroundTask == null) {
    return null;
  }
  backgroundTask.setModifiedDate(serviceContext.getModifiedDate(now));
  if (taskContextMap != null) {
    String taskContext=JSONFactoryUtil.serialize(taskContextMap);
    backgroundTask.setTaskContext(taskContext);
  }
  if ((status == BackgroundTaskConstants.STATUS_FAILED) || (status == BackgroundTaskConstants.STATUS_SUCCESSFUL)) {
    backgroundTask.setCompleted(true);
    backgroundTask.setCompletionDate(now);
  }
  backgroundTask.setStatus(status);
  if (Validator.isNotNull(statusMessage)) {
    backgroundTask.setStatusMessage(statusMessage);
  }
  backgroundTaskPersistence.update(backgroundTask);
  return backgroundTask;
}
