{
  Store store=(Store)ses.getAttribute(WebKeys.MAIL_STORE);
  String userId=(String)ses.getAttribute(WebKeys.USER_ID);
  String password=(String)ses.getAttribute(WebKeys.USER_PASSWORD);
  if (store == null) {
    store=_getSession().getStore("imap");
    store.connect(_getIMAPHost(),_getLogin(userId),password);
    ses.setAttribute(WebKeys.MAIL_STORE,store);
    List list=getAllFolders(ses);
    for (int i=0; i < DEFAULT_FOLDERS.length; i++) {
      boolean exists=false;
      for (Iterator itr=list.iterator(); itr.hasNext(); ) {
        MailFolder mf=(MailFolder)itr.next();
        if (DEFAULT_FOLDERS[i].equals(mf.getName())) {
          exists=true;
          break;
        }
      }
      if (!exists) {
        createFolder(ses,DEFAULT_FOLDERS[i]);
      }
    }
    if (ses.getAttribute(WebKeys.MAIL_FOLDER) == null) {
      setCurrentFolder(ses,MAIL_INBOX_NAME);
    }
  }
  return store;
}
