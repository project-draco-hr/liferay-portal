{
  String sql="select layoutRevisionId, typeSettings from LayoutRevision where " + getTypeSettingsCriteria(oldRootPortletId);
  try (PreparedStatement ps=connection.prepareStatement(sql);ResultSet rs=ps.executeQuery()){
    while (rs.next()) {
      long layoutRevisionId=rs.getLong("layoutRevisionId");
      String typeSettings=rs.getString("typeSettings");
      List<String> layoutColumnIds=_getLayoutColumnIds();
      layoutColumnIds.addAll(_getNestedPortletColumnIds(typeSettings));
      String newTypeSettings=getNewTypeSettings(typeSettings,oldRootPortletId,newRootPortletId,layoutColumnIds,exactMatch);
      updateLayoutRevision(layoutRevisionId,newTypeSettings);
    }
  }
 }
