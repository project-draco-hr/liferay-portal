{
  String[][] renamePortletIdsArray=getRenamePortletIdsArray();
  for (  String[] renamePortletIds : renamePortletIdsArray) {
    String oldRootPortletId=renamePortletIds[0];
    String newRootPortletId=renamePortletIds[1];
    updatePortlet(oldRootPortletId,newRootPortletId);
    updateLayouts(oldRootPortletId,newRootPortletId,false);
  }
  String[] uninstanceablePortletIds=getUninstanceablePortletIds();
  for (  String portletId : uninstanceablePortletIds) {
    PortletInstance portletInstance=new PortletInstance(portletId);
    if (portletInstance.hasInstanceId()) {
      if (_log.isWarnEnabled()) {
        _log.warn("Portlet " + portletId + " is already instanceable");
      }
      continue;
    }
    PortletInstance newPortletInstance=PortletInstance.newInstanceFor(portletId);
    String newPortletInstanceId=newPortletInstance.getPortletInstanceKey();
    updateResourcePermission(portletId,newPortletInstanceId,false);
    updateInstanceablePortletPreferences(portletId,newPortletInstanceId);
    updateLayouts(portletId,newPortletInstanceId,true);
  }
}
